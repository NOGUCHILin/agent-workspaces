---
name: staging-test
description: ステージング環境の統合テストを自動実行する。「テストして」「ステージングテストして」「ステージング確認して」「動作確認して」と言われた時に使用。公開サイトと管理アプリの両方をテストする。
---

# 概要

Playwright MCPを使用して、公開サイト（staging.applebuyers.jp）と管理アプリ（test.app.applebuyers.jp）の両方をテストします。

# テスト対象

| 環境 | URL | 認証 |
|------|-----|------|
| 公開サイト | https://staging.applebuyers.jp | 不要 |
| 管理アプリ | https://test.app.applebuyers.jp | 必要（Googleログイン） |

# 実行フロー

```
1. Slackで最新のデプロイ通知を確認
     ↓
2. 公開サイトをテスト（必須チェック項目含む）
     ↓
3. 管理アプリをテスト（必須チェック項目含む）
     ↓
4. Slackに結果を報告（スクリーンショット付き）
     ↓
5. 問題なければ「本番デプロイ可能」と報告
```

# Phase 1: Slack確認

## 1-1. Slackにアクセス

```
mcp__playwright__browser_navigate で https://app.slack.com にアクセス
```

ログインしていない場合:
- Googleアカウント（eguchinatsu@japanconsulting.co.jp）でサインイン
- japanconsultingワークスペースを選択

## 1-2. #開発チャンネルを開く

- サイドバーから「開発」チャンネルをクリック
- 「ステージング環境にデプロイしました」メッセージを探す
- スレッドを開いて返信用に準備

# Phase 2: 公開サイトテスト

## 2-1. トップページ確認

```
mcp__playwright__browser_navigate で https://staging.applebuyers.jp にアクセス
mcp__playwright__browser_snapshot でスナップショット取得
mcp__playwright__browser_console_messages level: "error" でエラー確認
```

## 2-2. 必須チェック項目（公開サイト）

### チェック1: LINEリンクの動作確認
- **場所**: 全ページフッターのSNSリンク
- **URL**: https://line.me/R/ti/p/@applebuyers
- **確認方法**:
  1. フッターまでスクロール
  2. LINEリンクをクリック
  3. 404エラーにならないことを確認
- **問題があった場合**: スクリーンショットを撮影

### チェック2: 秋葉原店の営業時間表示
- **場所**: https://staging.applebuyers.jp/stores/akihabara
- **確認項目**:
  - 営業時間「11:00〜19:00」が表示されている
  - 「13:00〜14:00はお昼休憩」が表示されている
- **問題があった場合**: スクリーンショットを撮影

## 2-3. 公開サイト基本チェック

- [ ] ページが正常に読み込まれる
- [ ] コンソールエラーがない
- [ ] 主要なUI要素が表示されている
- [ ] 画像が読み込まれている

# Phase 3: 管理アプリテスト

## 3-1. 管理アプリにアクセス

```
mcp__playwright__browser_navigate で https://test.app.applebuyers.jp にアクセス
```

認証が必要な場合:
- Googleアカウント（eguchinatsu@japanconsulting.co.jp）でログイン
- ログイン状態はセッションで保持される

## 3-2. 価格管理ページへ移動

```
mcp__playwright__browser_navigate で https://test.app.applebuyers.jp/support/price-management にアクセス
```

## 3-3. 必須チェック項目（管理アプリ）

### チェック1: 価格試算タブの動作確認
- **場所**: /support/price-management → 価格試算タブ
- **確認方法**:
  1. 「価格試算」タブをクリック
  2. 機種を選択（例: iPhone 16 Pro Max）
  3. 容量を選択（例: 256GB）
  4. 「価格試算」ボタンをクリック
  5. 結果を確認
- **確認項目**:
  - 「高額買取」価格が数値で表示される（「¥」のみではない）
  - 「特急買取」価格が数値で表示される
- **問題があった場合**:
  - スクリーンショットを撮影（ファイル名: price-estimation-bug.png）
  - 故障品でも同様にテストしてスクリーンショット撮影

### チェック2: 各タブの動作確認
以下のタブが正常に動作することを確認:
- [ ] 価格管制タブ（フィルター検索が動作する）
- [ ] 修理価格管理タブ（価格データが表示される）
- [ ] 故障減額率タブ（編集・保存が動作する）
- [ ] コンディション管理タブ（マッピングが表示される）

## 3-4. 管理アプリ基本チェック

- [ ] ページが正常に読み込まれる
- [ ] コンソールエラーがない
- [ ] APIレスポンスが正常（Network確認）

# Phase 4: Slack報告

## 4-1. 報告メッセージ作成

**重要: 必ず挨拶から始める**

```
こんにちは、えぐちなつのAIです。
ステージング環境テスト完了しました。

[テスト結果をここに記載]
```

## 4-2. 報告テンプレート

### 問題なしの場合:
```
こんにちは、えぐちなつのAIです。
ステージング環境テスト完了しました。

【公開サイト】 ✅ 正常
- トップページ: OK
- LINEリンク: OK
- 秋葉原店ページ: OK

【管理アプリ】 ✅ 正常
- 価格試算: OK（価格が正常に表示される）
- 各タブ: OK

本番デプロイ可能です。
```

### 問題ありの場合:
```
こんにちは、えぐちなつのAIです。
ステージング環境テスト完了しました。

【緊急修正（バグ）】
❌ [問題の説明]
・場所: [URL]
・現象: [詳細]

【正常動作確認済み】
✅ [正常だった項目]

スクリーンショットを添付します。
```

## 4-3. スクリーンショット添付

問題があった箇所のスクリーンショットを添付:
1. 添付ボタンをクリック
2. 「コンピューターからアップロード」を選択
3. `.playwright-mcp/` フォルダからファイルを選択
4. メッセージを送信

# Slack連携情報

| 項目 | 値 |
|------|-----|
| ワークスペース | japanconsulting |
| チャンネル | #開発 |
| ログインアカウント | eguchinatsu@japanconsulting.co.jp |
| デプロイ通知Bot | applebuyers_robot |

# 過去に発見された問題（必ず確認）

| 日付 | 環境 | 問題 | 確認方法 |
|------|------|------|----------|
| 2026-01-26 | 公開サイト | LINEリンク404エラー | フッターのLINEリンククリック |
| 2026-01-26 | 公開サイト | 秋葉原店のお昼休憩未表示 | /stores/akihabara ページ確認 |
| 2026-01-26 | 管理アプリ | 価格試算で金額が表示されない | 価格試算タブで試算実行 |

# 出力形式

```
## ステージングテスト結果

### 実行日時
[YYYY-MM-DD HH:MM]

### 公開サイト (staging.applebuyers.jp)
| チェック項目 | 結果 | 備考 |
|-------------|------|------|
| トップページ | ✅/❌ | |
| LINEリンク | ✅/❌ | |
| 秋葉原店ページ | ✅/❌ | |
| コンソールエラー | ✅/❌ | |

### 管理アプリ (test.app.applebuyers.jp)
| チェック項目 | 結果 | 備考 |
|-------------|------|------|
| ログイン | ✅/❌ | |
| 価格試算タブ | ✅/❌ | |
| 価格管制タブ | ✅/❌ | |
| 修理価格管理タブ | ✅/❌ | |
| 故障減額率タブ | ✅/❌ | |
| コンディション管理タブ | ✅/❌ | |

### 総合判定
✅ 本番デプロイ可能 / ❌ 修正必要

### 問題点（あれば）
- 問題1: [説明]
- 問題2: [説明]

### スクリーンショット
- [ファイル名1.png]
- [ファイル名2.png]
```

# 注意事項

- 認証が必要な場合はユーザーにログインを依頼（または既存セッションを使用）
- 本番環境でのテストは慎重に（データ変更を伴う操作は避ける）
- スクリーンショットは `.playwright-mcp/` フォルダに保存
- Slackへの報告は必ずスレッド内で行う
- **メッセージは必ず「こんにちは、えぐちなつのAIです。」から始める**
