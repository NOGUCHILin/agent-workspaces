# クレジットカード運用最適化システム

支払猶予を最大化しつつ、カード枠の制約を守り、最適なカード配分を自動計算するシステム

作成日: 2025-11-06

---

## 🎯 目的

毎月の支払いに対して、どのクレジットカードを使うべきかを自動的に提案します。

**最適化の優先順位:**
1. 支払猶予の最大化 ⭐（最優先）
2. 支払期限を守る
3. 運用のシンプルさ
4. カード枠の有効活用

---

## 📂 ファイル構成

```
finance-cashflow/
├── README.md                          # このファイル
├── docs/
│   ├── master-data-v2.yaml           # マスターデータ（カード情報、固定費等）
│   ├── optimization_logic.md         # 最適化ロジックの詳細説明
│   └── holidays.csv                  # 営業日カレンダー
├── data/
│   ├── input_template.yaml           # 月次入力データのテンプレート
│   ├── input_202511.yaml             # 11月分の入力データ（例）
│   └── optimization_result_202511.md # 11月分の最適化結果（例）
└── scripts/
    ├── optimize_credit_schedule.py   # 最適化スクリプト
    └── analyze_september_expenses.py # 9月実績分析スクリプト
```

---

## 🚀 使い方

### Step 1: カード利用可能額を確認

各カードのWebサイトやアプリで、最新の利用可能額を確認します。

**確認が必要なカード:**
- Amazon Mastercard
- MIカード
- トヨタファイナンス
- しんきんVisa
- しんきんJCB
- JFR（大丸）
- アメックス
- セゾン
- GPC

### Step 2: 月次入力ファイルを作成

テンプレートをコピーして、今月分の入力ファイルを作成します。

```bash
cd /Users/noguchisara/projects/work/finance-cashflow
cp data/input_template.yaml data/input_202511.yaml
```

### Step 3: 入力ファイルを編集

以下の情報を入力します：

#### 3-1. 対象月の情報

```yaml
target_month:
  year: 2025
  month: 11
  days_in_month: 30  # 広告チャージ計算用
```

#### 3-2. カード利用可能額（Step 1で確認した値）

```yaml
card_balances:
  amazon: 699000  # 69.9万円
  mi: 722000      # 72.2万円
  toyota: 0       # 枠超過中
  # ... 以下同様
```

#### 3-3. 変動費（請求書カード払い）

```yaml
variable_invoice_payments:
  jo_san: 1500000   # 徐さん 150万円
  yamato: 1200000   # ヤマト 120万円
  bizbi: 100000     # ビズビ 10万円
```

#### 3-4. 変動費（通常クレカ払い）

```yaml
variable_regular_payments:
  line_ad: 30000     # LINE広告 3万円
  supplies: 200000   # 備品・消耗品費 20万円
  fees: 110000       # 支払手数料 11万円
```

### Step 4: 最適化スクリプトを実行

```bash
uv run python scripts/optimize_credit_schedule.py data/input_202511.yaml
```

### Step 5: 結果を確認

ターミナルに最適化結果が表示されます。同時に、`data/optimization_result_202511.md` にも保存されます。

**出力内容:**
- カード情報（支払猶予期間順）
- 支払配分結果（各支払先にどのカードを使うか）
- カード別使用状況（枠超過の警告等）
- 警告（配分できない支払いがある場合）

---

## 📊 出力例

```
================================================================================
クレジットカード運用最適化レポート
対象月: 2025年11月
================================================================================

【カード情報】支払猶予期間順
--------------------------------------------------------------------------------
トヨタファイナンス            猶予 57日  枠 1,200,000円  利用可能         0円  請求書払い: ○
Amazon Mastercard    猶予 56日  枠 2,000,000円  利用可能   699,000円  請求書払い: ○
...

【支払配分結果】
--------------------------------------------------------------------------------

ユニホー (地代家賃) - 合計250,000円
  → Amazon Mastercard       250,000円  (申請 1日, 支払猶予 56日)

徐さん (仕入) - 合計1,500,000円
  → Amazon Mastercard       134,000円  (申請 1日, 支払猶予 56日)
  → しんきんJCB                  64,000円  (申請16日, 支払猶予 55日)
  → MIカード                   722,000円  (申請 6日, 支払猶予 50日)
...

【カード別使用状況】
--------------------------------------------------------------------------------

Amazon Mastercard
  利用可能額:    699,000円
  使用予定額:    699,000円
  残り枠:              0円 ✓
  内訳:
    - ユニホー                              250,000円
    - ドンキ                               250,000円
    - レンタルオフィス                           65,000円
    - 徐さん                               134,000円
...

【警告】
--------------------------------------------------------------------------------
⚠️ 徐さんの580,000円を配分できませんでした
⚠️ ヤマト（1,200,000円）を配分できるカードがありません
...
```

---

## ⚙️ マスターデータの更新

### カード情報の変更

カードの利用枠や締め日が変更になった場合は、[docs/master-data-v2.yaml](docs/master-data-v2.yaml) を編集してください。

### 固定費の変更

家賃等の固定費が変更になった場合も、`master-data-v2.yaml` の該当箇所を編集してください。

---

## 🔧 トラブルシューティング

### Q: 警告「配分できるカードがありません」が出る

**原因:** カード利用可能額が不足しています。

**対処法:**
1. 一部のカードの支払いを済ませて、枠を回復させる
2. カード会社に増枠を依頼する
3. 支払いを翌月に繰り延べる（可能な場合）

### Q: 支払猶予期間の計算が合わない

**原因:** 営業日の計算が簡易版（4日後固定）になっています。

**対処法:**
- 土日祝を考慮した正確な計算が必要な場合は、スクリプトの改修が必要です

### Q: 徐さんの分割配分を変更したい

**現在:** システムが自動的に配分
**カスタマイズ:** `scripts/optimize_credit_schedule.py` の `_allocate_splittable()` メソッドを修正

---

## 📝 メモ

### 固定費（自動設定）

以下の支払いは `master-data-v2.yaml` に登録されており、毎月自動的に計算されます：

**請求書カード払い（固定）:**
- ユニホー: 25万円
- ドンキ: 25万円
- レンタルオフィス: 6.5万円

**通常クレカ払い（固定）:**
- 通信費: 73万円（AWS、Notion、Google Workspace等）

**広告チャージ（自動計算）:**
- Google広告: 1日9万円 × 月の日数
- Yahoo広告: 1日1万円 × 月の日数

### 変動費（毎月入力が必要）

以下は毎月金額が変わるため、入力ファイルに記入が必要です：

**請求書カード払い（変動）:**
- 徐さん: 150万円前後
- ヤマト: 120万円前後
- ビズビ: 10万円前後

**通常クレカ払い（変動）:**
- LINE広告: 3万円前後
- 備品・消耗品費: 20万円前後
- 支払手数料: 11万円前後

---

## 📚 関連ドキュメント

- [最適化ロジックの詳細](docs/optimization_logic.md)
- [マスターデータ](docs/master-data-v2.yaml)
- [入力データテンプレート](data/input_template.yaml)

---

## 📜 旧ドキュメント（参考用）

- [CLAUDE.md](CLAUDE.md) - 旧版Claude向け実行指示
- [docs/master-data.md](docs/master-data.md) - 旧版マスターデータ
- [docs/decision-rules.md](docs/decision-rules.md) - 旧版判断ロジック

---

最終更新: 2025-11-06
