#!/usr/bin/env python3
"""
ä¸»è¦ãªå–å¼•å†…å®¹ã‚’åˆ†æã—ã¦åˆ—æ§‹æˆã‚’ææ¡ˆã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
"""

import polars as pl
from pathlib import Path


def main():
    project_root = Path(__file__).parent.parent
    input_file = project_root / "data" / "processed" / "transactions_cleaned.csv"

    print("ğŸ“Š ä¸»è¦ãªå–å¼•å†…å®¹ã‚’åˆ†æã—ã¾ã™\n")

    # ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    df = pl.read_csv(input_file)

    print("=" * 80)
    print("ã€åå…¥ï¼ˆå…¥é‡‘ï¼‰é …ç›®ã€‘è²¸æ–¹å‹˜å®šç§‘ç›®ã§é›†è¨ˆ")
    print("=" * 80)

    # åå…¥é …ç›®ï¼ˆè²¸æ–¹ãŒåç›Šç§‘ç›®ï¼‰
    revenue_accounts = ["å£²ä¸Šé«˜", "å—å–åˆ©æ¯", "é›‘åå…¥"]
    revenue_df = df.filter(
        pl.col("è²¸æ–¹å‹˜å®šç§‘ç›®").is_in(revenue_accounts)
    ).group_by("è²¸æ–¹å‹˜å®šç§‘ç›®").agg([
        pl.col("è²¸æ–¹é‡‘é¡(å††)").sum().alias("åˆè¨ˆé‡‘é¡"),
        pl.len().alias("ä»¶æ•°")
    ]).sort("åˆè¨ˆé‡‘é¡", descending=True)

    print(revenue_df)
    print()

    print("=" * 80)
    print("ã€åºƒå‘Šè²»ã€‘Googleã€Yahooã€LINEã®è©³ç´°")
    print("=" * 80)

    # åºƒå‘Šè²»ã®è©³ç´°
    ad_df = df.filter(
        pl.col("æ‘˜è¦").str.to_uppercase().str.contains("GOOGLE|YAHOO|ãƒ¤ãƒ•ãƒ¼|LINE")
    ).group_by("å€Ÿæ–¹å‹˜å®šç§‘ç›®").agg([
        pl.col("å€Ÿæ–¹é‡‘é¡(å††)").sum().alias("åˆè¨ˆé‡‘é¡"),
        pl.len().alias("ä»¶æ•°")
    ]).sort("åˆè¨ˆé‡‘é¡", descending=True)

    print(ad_df)
    print()

    print("=" * 80)
    print("ã€ä»•å…¥å…ˆã€‘ä¸»è¦ãªä»•å…¥å…ˆTop10")
    print("=" * 80)

    # ä»•å…¥å…ˆï¼ˆå€Ÿæ–¹å‹˜å®šç§‘ç›®ãŒã€Œä»•å…¥é«˜ã€ï¼‰
    purchase_df = df.filter(
        pl.col("å€Ÿæ–¹å‹˜å®šç§‘ç›®") == "ä»•å…¥é«˜"
    ).group_by("æ‘˜è¦").agg([
        pl.col("å€Ÿæ–¹é‡‘é¡(å††)").sum().alias("åˆè¨ˆé‡‘é¡"),
        pl.len().alias("ä»¶æ•°")
    ]).sort("åˆè¨ˆé‡‘é¡", descending=True).head(15)

    print(purchase_df)
    print()

    print("=" * 80)
    print("ã€ä¸»è¦çµŒè²»ã€‘å‹˜å®šç§‘ç›®åˆ¥Top15")
    print("=" * 80)

    # çµŒè²»ç§‘ç›®
    expense_accounts = [
        "çµ¦æ–™", "æ³•å®šç¦åˆ©è²»", "å½¹å“¡å ±é…¬", "æ”¯æ‰•å ±é…¬",
        "é€šä¿¡è²»", "åºƒå‘Šå®£ä¼è²»", "æ”¯æ‰•æ‰‹æ•°æ–™",
        "æ—…è²»äº¤é€šè²»", "æ¥å¾…äº¤éš›è²»", "ä¼šè­°è²»",
        "å‚™å“ãƒ»æ¶ˆè€—å“è²»", "æ¶ˆè€—å“è²»",
        "æ”¯æ‰•åˆ©æ¯", "æ°´é“å…‰ç†±è²»", "åœ°ä»£å®¶è³ƒ", "æ”¯æ‰•å®¶è³ƒ"
    ]

    expense_df = df.filter(
        pl.col("å€Ÿæ–¹å‹˜å®šç§‘ç›®").is_in(expense_accounts)
    ).group_by("å€Ÿæ–¹å‹˜å®šç§‘ç›®").agg([
        pl.col("å€Ÿæ–¹é‡‘é¡(å††)").sum().alias("åˆè¨ˆé‡‘é¡"),
        pl.len().alias("ä»¶æ•°")
    ]).sort("åˆè¨ˆé‡‘é¡", descending=True)

    print(expense_df)
    print()

    print("=" * 80)
    print("ã€é€šä¿¡è²»ã®å†…è¨³ã€‘ã‚µãƒ¼ãƒ“ã‚¹åˆ¥Top10")
    print("=" * 80)

    # é€šä¿¡è²»ã®å†…è¨³
    comm_df = df.filter(
        pl.col("å€Ÿæ–¹å‹˜å®šç§‘ç›®") == "é€šä¿¡è²»"
    ).group_by("æ‘˜è¦").agg([
        pl.col("å€Ÿæ–¹é‡‘é¡(å††)").sum().alias("åˆè¨ˆé‡‘é¡"),
        pl.len().alias("ä»¶æ•°")
    ]).sort("åˆè¨ˆé‡‘é¡", descending=True).head(10)

    print(comm_df)
    print()

    print("=" * 80)
    print("ã€ææ¡ˆã™ã‚‹åˆ—æ§‹æˆã€‘")
    print("=" * 80)
    print("""
ã€åå…¥ï¼ˆå…¥é‡‘ï¼‰ã€‘3åˆ—
1. å£²ä¸Šé«˜
2. å£²æ›é‡‘å›å
3. ãã®ä»–å…¥é‡‘

ã€åºƒå‘Šè²»ï¼ˆå‡ºé‡‘ï¼‰ã€‘3åˆ—
4. Googleåºƒå‘Š
5. Yahooåºƒå‘Š
6. LINEåºƒå‘Š

ã€ä»•å…¥ï¼ˆå‡ºé‡‘ï¼‰ã€‘4åˆ—
7. ã‚¤ã‚ªã‚·ã‚¹
8. ãƒ¤ãƒ•ãƒ¼ãƒ•ãƒªãƒ
9. ãƒ¤ãƒ•ãƒ¼ã‹ã‚“ãŸã‚“æ±ºæ¸ˆ
10. ãã®ä»–ä»•å…¥

ã€ä¸»è¦çµŒè²»ï¼ˆå‡ºé‡‘ï¼‰ã€‘8åˆ—
11. çµ¦æ–™ãƒ»å½¹å“¡å ±é…¬
12. AWS
13. é€šä¿¡è²»ï¼ˆAWSä»¥å¤–ï¼‰
14. OpenAI
15. Cursor
16. Adobeãƒ»Canvaç­‰
17. æ”¯æ‰•æ‰‹æ•°æ–™
18. æ—…è²»äº¤é€šè²»

ã€ãã®ä»–ï¼ˆå‡ºé‡‘ï¼‰ã€‘2åˆ—
19. å‚™å“ãƒ»æ¶ˆè€—å“
20. ãã®ä»–çµŒè²»

ã€æ®‹é«˜ã€‘2åˆ—
21. ç´”å¢—æ¸›
22. æ®‹é«˜

åˆè¨ˆï¼š23åˆ—ï¼ˆæ—¥ä»˜ãƒ»å‰æ—¥æ®‹é«˜å«ã‚ã¦25åˆ—ï¼‰
    """)


if __name__ == "__main__":
    main()
