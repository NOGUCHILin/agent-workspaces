#!/usr/bin/env python3
"""
å£²ä¸Šã®å†…è¨³ã‚’åˆ†æã™ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
"""

import polars as pl
from pathlib import Path


def main():
    project_root = Path(__file__).parent.parent
    input_file = project_root / "data" / "processed" / "transactions_cleaned.csv"

    print("ğŸ“Š å£²ä¸Šã®å†…è¨³ã‚’åˆ†æã—ã¾ã™\n")

    # ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
    df = pl.read_csv(input_file)

    print("=" * 80)
    print("ã€å£²ä¸Šé«˜ã®å†…è¨³ã€‘è£œåŠ©ç§‘ç›®åˆ¥")
    print("=" * 80)

    # å£²ä¸Šé«˜ã®è£œåŠ©ç§‘ç›®åˆ¥é›†è¨ˆ
    revenue_by_sub = df.filter(
        pl.col("è²¸æ–¹å‹˜å®šç§‘ç›®") == "å£²ä¸Šé«˜"
    ).group_by("è²¸æ–¹è£œåŠ©ç§‘ç›®").agg([
        pl.col("è²¸æ–¹é‡‘é¡(å††)").sum().alias("åˆè¨ˆé‡‘é¡"),
        pl.len().alias("ä»¶æ•°")
    ]).sort("åˆè¨ˆé‡‘é¡", descending=True)

    print(revenue_by_sub)
    print()

    print("=" * 80)
    print("ã€å£²ä¸Šé«˜ã®å†…è¨³ã€‘æ‘˜è¦ã‹ã‚‰åˆ†æï¼ˆTop20ï¼‰")
    print("=" * 80)

    # å£²ä¸Šé«˜ã®æ‘˜è¦åˆ¥é›†è¨ˆ
    revenue_by_desc = df.filter(
        pl.col("è²¸æ–¹å‹˜å®šç§‘ç›®") == "å£²ä¸Šé«˜"
    ).group_by("æ‘˜è¦").agg([
        pl.col("è²¸æ–¹é‡‘é¡(å††)").sum().alias("åˆè¨ˆé‡‘é¡"),
        pl.len().alias("ä»¶æ•°")
    ]).sort("åˆè¨ˆé‡‘é¡", descending=True).head(20)

    print(revenue_by_desc)
    print()

    print("=" * 80)
    print("ã€å£²æ›é‡‘ã€‘è£œåŠ©ç§‘ç›®åˆ¥")
    print("=" * 80)

    # å£²æ›é‡‘ã®è£œåŠ©ç§‘ç›®åˆ¥é›†è¨ˆ
    ar_by_sub = df.filter(
        pl.col("è²¸æ–¹å‹˜å®šç§‘ç›®") == "å£²æ›é‡‘"
    ).group_by("è²¸æ–¹è£œåŠ©ç§‘ç›®").agg([
        pl.col("è²¸æ–¹é‡‘é¡(å††)").sum().alias("åˆè¨ˆé‡‘é¡"),
        pl.len().alias("ä»¶æ•°")
    ]).sort("åˆè¨ˆé‡‘é¡", descending=True)

    print(ar_by_sub)
    print()

    print("=" * 80)
    print("ã€ææ¡ˆã™ã‚‹å£²ä¸Šã®åˆ—æ§‹æˆã€‘")
    print("=" * 80)
    print("""
åˆ†æçµæœã‹ã‚‰ä»¥ä¸‹ã®åˆ†é¡ã‚’ææ¡ˆã—ã¾ã™ï¼š

ã€æ¡ˆ1: è²©å£²ãƒãƒ£ãƒãƒ«åˆ¥ï¼ˆ3åˆ—ï¼‰ã€‘
1. åº—èˆ—å£²ä¸Šï¼ˆã‚¹ãƒãƒ¬ã‚¸ï¼‰
2. ã‚ªãƒ³ãƒ©ã‚¤ãƒ³å£²ä¸Šï¼ˆãƒ ã‚¹ãƒ“ãƒ¼ç­‰ï¼‰
3. ãã®ä»–å£²ä¸Š

ã€æ¡ˆ2: è©³ç´°åˆ†é¡ï¼ˆ5åˆ—ï¼‰ã€‘
1. åº—èˆ—å£²ä¸Šï¼ˆç¾é‡‘ãƒ»ãã®å ´ï¼‰
2. ãƒ ã‚¹ãƒ“ãƒ¼å£²ä¸Šï¼ˆECï¼‰
3. ãƒ¤ãƒ•ã‚ªã‚¯å£²ä¸Šï¼ˆECï¼‰
4. æ³•äººå–å¼•å£²ä¸Š
5. ãã®ä»–å£²ä¸Š

ã€æ¡ˆ3: ã‚·ãƒ³ãƒ—ãƒ«ï¼ˆ2åˆ—ï¼‰ã€‘
1. é€šå¸¸å£²ä¸Š
2. å£²æ›é‡‘å›å

ã©ã®æ¡ˆãŒã”å¸Œæœ›ã«è¿‘ã„ã§ã™ã‹ï¼Ÿ
    """)


if __name__ == "__main__":
    main()
