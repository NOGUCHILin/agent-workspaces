"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[53095,92754,99171],{24126:(e,t,n)=>{n.d(t,{c:()=>r});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"3.9 2.75 12.18 14.49",svg:(0,n(474848).jsx)("path",{d:"M12.626 2.768a.625.625 0 0 1 0 1.224l-.126.013h-.125v4.794l3.366 5.159c.893 1.369-.03 3.17-1.623 3.281l-.156.006H6.039c-1.688 0-2.703-1.873-1.78-3.287l3.366-5.157V4.005H7.5a.625.625 0 0 1 0-1.25h5zM8.875 9.173l-.102.156-1.567 2.401h5.589l-1.569-2.403-.101-.156V4.005h-2.25z"})},r=(0,n(340498).wt)("beaker",o,"default")},72897:(e,t,n)=>{n.r(t),n.d(t,{clearCoEditingOverride:()=>l,setCoEditingOverride:()=>d,setCoEditingSetting:()=>c});var o=()=>n(564884),r=()=>n(488923),i=()=>n(680977),a=()=>n(244828),s=()=>n(642046);async function c(e){var t,n;const{environment:s,userSettingsStore:c,spaceId:d,active:l}=e,u=(null===(t=c.getSettings())||void 0===t?void 0:t.beta_ai_co_editing_settings)??{};if(((null===(n=u[d])||void 0===n?void 0:n.autocorrect)??!1)===l)return;a().createAndCommit({userAction:"AiCoEditingSettings.onToggleOption",environment:s,canUndo:!0,perform:e=>{(0,i().m)({userSettingsStore:c,data:{beta_ai_co_editing_settings:{...u,[d]:{autocorrect:l}}},transaction:e})}});const p=await(0,r().uZ)();l&&p.resetSessionId(),(0,o().u)({environment:s,event:{eventName:"co_editing_toggled",eventProperties:{toggle_status:l?"on":"off",session_id:p.getSessionId()}}}),l||p.resetSessionId()}async function d(e){const{environment:t,pageId:n,active:i}=e;s().t.setOverride(n,{autocorrect:i});const a=await(0,r().uZ)();(0,o().u)({environment:t,event:{eventName:"co_editing_override_updated",eventProperties:{new_state:i?"on":"off",session_id:a.getSessionId(),page_id:n}}})}async function l(e){const{environment:t,pageId:n}=e;s().t.clearOverride(n);const i=await(0,r().uZ)();(0,o().u)({environment:t,event:{eventName:"co_editing_override_updated",eventProperties:{new_state:"cleared",session_id:i.getSessionId(),page_id:n}}})}},93723:(e,t,n)=>{function o(e){return e>=1e5?"100k-or-more":e>=5e4?"50k-100k":e>=1e4?"10k-50k":e>=5e3?"5k-10k":e>=1e3?"1k-5k":e>=500?"500-1k":e>=100?"100-500":e>=1?"1-100":"0"}n.d(t,{P:()=>o})},108184:(e,t,n)=>{n.r(t),n.d(t,{COMPLETION_THROTTLE:()=>x,PREVIEW_STEP_DELAY:()=>C,maybeUpdateAIUsageEligibilityStoreV2:()=>A,maybeUpdateAiEligibility:()=>_,postProcessAICreatedStores:()=>w,showCompletionErrorWithCode:()=>B,wrapTemporaryBlocksInList:()=>P});n(18107),n(967357);var o=()=>n(242422),r=()=>n(675133),i=()=>n(128933),a=()=>n(770063),s=()=>n(878126),c=()=>n(165358),d=()=>n(179034),l=()=>n(427419),u=()=>n(720665),p=()=>n(753812),g=()=>n(722101),f=()=>n(384944),m=()=>n(274873),h=()=>n(412669),v=()=>n(556122),y=()=>n(594794),k=()=>n(668721),S=()=>n(685377),b=()=>n(661077),I=()=>n(96563);const x=300,C=250;function B(e){const t=r().A.getIntl();return 451===e?i().D6({label:t.formatMessage({id:"completionActions.moderationError",defaultMessage:"AI does not allow content that is harmful or illegal. Please revise your input and try again. (451)"})}):413===e?i().D6({label:t.formatMessage({id:"completionActions.promptOrAttachmentTooLarge",defaultMessage:"Query or attachment is too large. Please revise your input and try again. (413)"})}):502===e||503===e||504===e?i().D6({label:t.formatMessage({id:"completionActions.providerError",defaultMessage:"We’re experiencing issues with our AI provider. Try again in a few minutes. ({errorCode})"},{errorCode:e})}):void i().D6({label:t.formatMessage({id:"completionActions.genericError",defaultMessage:"AI is temporarily unavailable. Try again in a few minutes. ({errorCode})"},{errorCode:e})})}function w(e,t){for(const n of t)m().In({environment:e,blockStore:n})}async function _(e,t,n){let r;if(o().default.checkGate({gateName:"usage_based_pricing_pfa_checks_purchased_credits_enabled"}))return void(await A(e,t,n));o().default.checkGate({gateName:"usage_based_pricing_alpha_enabled"})&&A(e,t,n).catch((e=>{c().log({level:"error",from:"ai.completionActions",type:"maybeUpdateAIUsageEligibilityStoreV2Error",spaceId:t,error:e})}));const i=v().TI();if(i.debug)r=402!==i.showErrorCode;else{const o=k().o.getState();if(o&&o.isEligible&&"unlimited"===o.type&&!n){const e=o.lastUpdatedAt;if(Date.now()-e<10*u().Xb)return}const i=await p().callCellCompatibleApi({eventName:"getAIUsageEligibility",environment:e,data:{spaceId:t},cellNavigation:{cellId:void 0,spaceId:t}});if("success"===i.type){r=i.data.isEligible,r&&h().K.state&&h().K.setState(!1);const e=!1===(null==o?void 0:o.isEligible)&&(null==o?void 0:o.requestedAccess),t=i.data.researchModeUsage??0;k().o.setState({...i.data,lastUpdatedAt:Date.now(),researchModeUsage:t,...!1===i.data.isEligible&&{requestedAccess:e}})}}void 0!==r&&b().P.setState(r)}async function A(e,t,n){const o=await s().T.awaitData(e,{spaceId:t}),r=S().y.getData(e,{spaceId:t});if(o){if(r&&(0,l().Hg)(o)&&!n){const e=r.lastUpdatedAt;if(Date.now()-e<10*u().Xb)return}await(0,I().y3)(e,t)}}function P(e){var t;const{environment:n,stores:o,listId:r,inMemoryRecordCache:i,transaction:s}=e,c=(null===(t=o.at(0))||void 0===t?void 0:t.getSpaceId())??s.spaceId,l=new(a().pm)({environment:n,pointer:{table:d().ev,id:r||(0,y().Z1)({environment:n,table:d().ev,spaceId:c}),spaceId:c},recordStoreOptions:{inMemoryRecordCache:i,userId:n.currentUser.id},path:["content"]});for(const a of o)g().BC({parentStore:l,appendStore:a,transaction:s}),f().zv({store:a,data:{parent_id:l.id,parent_table:l.table,alive:!0},transaction:s});return l}},243331:(e,t,n)=>{n.d(t,{K_:()=>r,Lf:()=>a});var o=()=>n(206267);function r(){return{currentScreen:"none",status:"not_started",isBackendConnected:!1,externalSourceName:void 0,sessionId:o().JW(),analyticsFrom:"unknown",isConnected:!1,isPersonalAuthComplete:!1,isDisconnecting:!1,isLoaded:!1,isNotionMailProhibited:!1}}class i extends(()=>n(757695))().Store{getInitialState(){return r()}}const a=new i;(0,n(852832).exposeDebugValue)("notionMailAIConnectorStore",a)},246679:(e,t,n)=>{n.d(t,{VK:()=>r,gv:()=>a});var o=()=>n(206267);function r(){return{currentScreen:"none",status:"not_started",isBackendConnected:!1,externalSourceName:void 0,sessionId:o().JW(),analyticsFrom:"unknown",isConnected:!1,isPersonalAuthComplete:!1,isDisconnecting:!1,isLoaded:!1,isNotionCalendarProhibited:!1}}class i extends(()=>n(757695))().Store{getInitialState(){return r()}}const a=new i;(0,n(852832).exposeDebugValue)("notionCalendarAIConnectorStore",a)},278994:(e,t,n)=>{n.r(t),n.d(t,{CoEditingPresenceStore:()=>O,CoEditingTasksManager:()=>le,HoverCoEditingOverlayRenderer:()=>ie,autoCorrectActions:()=>o,coEditingPresenceStoreActions:()=>r,coEditingSettingsActions:()=>M(),coEditingSuggestionActions:()=>i()});var o={};n.r(o),n.d(o,{applyAutoCorrectUnderlinesCrdt:()=>A,assignEditIdsAndDeriveContext:()=>P,getAutoCorrectInference:()=>_,getContextForEdits:()=>T,logAutoCorrectFeedback:()=>Q,modifyDiffWithEditIds:()=>E});var r={};n.r(r),n.d(r,{clearStore:()=>q,removePresenceForBlock:()=>V,setPresenceForBlock:()=>U});var i=()=>n(90881),a=(n(16280),n(944114),n(898992),n(354520),n(803949),n(581454),n(908872),()=>n(564884)),s=()=>n(221844),c=()=>n(530849),d=()=>n(785728),l=()=>n(201980),u=()=>n(439180),p=()=>n(532659),g=()=>n(498212),f=()=>n(488923),m=()=>n(753812),h=()=>n(884107),v=()=>n(108184),y=()=>n(659602),k=()=>n(335722),S=()=>n(594794),b=()=>n(244828),I=()=>n(270609),x=(n(672577),()=>n(220719)),C=()=>n(534177),B=()=>n(696419);var w=()=>n(780942);async function _(e,t,n,o,r){const i=new AbortController,a=[{id:(0,S().Z1)({environment:e,table:"thread_message",spaceId:t}),type:"autocorrect",selectedText:n,navigableBlockPointer:r},{id:(0,S().Z1)({environment:e,table:"thread_message",spaceId:t}),type:"config",value:{type:"autocorrect"}}],s=await m().callStreamApi({eventName:"runInferenceTranscript",environment:e,data:{traceId:o,spaceId:t,transcript:a,generateTitle:!1},abortSignal:i.signal,headers:(0,d().WS)({spaceId:t})});if("success"!==s.type)throw s.error;let c="";if(p().hS.is(s.data))for await(const d of s.data){if("error"===d.type)throw new Error(`Failed to get inference ${d.errorCode}${d.message}`);"markdown-chat"===d.type&&(c+=d.value)}return c}async function A(e){const{environment:t,blockStore:n,completion:o,traceId:r,sessionId:d}=e,p=await async function(e){const{environment:t,completion:n,traceId:o,spaceId:r}=e,[i,a,c]=await Promise.all([h().R.clipboardActions.load(),y().g.load(),k().S.load()]);if(!i||!a||!c)throw new Error("Required dependencies not loaded for markdown conversion");const d=new(s().A)({name:"AutocorrectMarkdownConversion",isTemporaryData:!0}),l=b().createAndCommit({userAction:"blockActionRegistry.autoCorrectAction.convertMarkdown",environment:t,canUndo:!1,perform:e=>{const s=i.markdownToBlocks({environment:t,text:n,inMemoryRecordCache:d,transaction:e,markdownOptions:{},markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:c});return s?((0,v().postProcessAICreatedStores)(t,s),s[0].getTitleValue()):(r&&o&&Q({environment:t,spaceId:r,traceId:o,feedback:"rejected",textContext:`Failed to convert markdown to blocks:\n ${n}`}),[])}}).performResult;if(!l)throw new Error("Failed to convert markdown to blocks");return d.addCacheFallback(t.defaultRecordCache.inMemoryRecordCache),l}({environment:t,completion:o,traceId:r,spaceId:n.getSpaceId()});if((0,l().w9s)(p))return;const m=function(e){const{environment:t,blockStore:n,newBlockTitleTextValue:o,editIdGenerator:r,traceId:i}=e,a=(0,x().o9)(n.getBlockTitleTextSliceTree()),s=(0,x().o9)(n.getBlockTitleTextSliceTree()),c=(0,l().q4_)(s.getTextValue()).length,d=(0,x().o9)([(0,l().Ey_)((0,l().q4_)(n.getBlockTitleStore().getValue()))]),u=(0,x().o9)([(0,l().Ey_)((0,l().q4_)(o))]),p=r(),g=(0,B().x)({environment:t,from:"coeditingDiff",mode:"word",before:d,after:u,isIncompleteAfter:!1,insertCursor:!1,insertionAnnotation:["+",p],deletionAnnotation:["-",p]});let f=[];if("undefined"==typeof Intl||!Intl.Segmenter)throw new Error("Intl.Segmenter is not supported");{const e=new Intl.Segmenter(void 0,{granularity:"word"}).segment((0,l().q4_)(d));f=Array.from(e).map((e=>e))}const m=[],h=[],v={};let y,k,S,b=0,I=0,w=!1,_=p;for(const x of g){const[e,t]=x,n=e.length;if(t&&t.find((e=>e[0]===l().BQP.Inserted&&e[1]===p))){w||(_=r()),v[_]||(v[_]={type:"crdt",editId:_,traceId:i,context:[],undoOperations:[],underlineOperations:[]});const t=v[_];let o=I;if(y){k=void 0,S=void 0;const[e,t]=y;t&&(0,l().azZ)(t)&&(o-=y[0].length)}const d=Math.max(0,Math.min(o,c)),u=s.getActiveAnnotationsBeforeIndex(d),p=[];for(const[e,n]of u.entries())p.push(n);const g=[(0,l().Ey_)(e,p)],f=a.getOperationsForInsertTextValue(b,g,!1);f.operations.forEach((e=>{switch(e.type){case"insertText":a.applyInsertTextOperation(e);break;case"addAnnotation":case"removeAnnotation":a.applyAnnotationOperation(e);break;default:(0,C().HB)(e)}})),m.push(...f.operations),h.push(...f.invertedOperations),t.underlineOperations.push(...a.getOperationsForAddAnnotation(b,b+n-1,[l().BQP.TemporarySuggestionUnderline,_]).operations),t.undoOperations.push(...f.invertedOperations);const x=(0,l().Ey_)(e,[[l().BQP.Inserted,_]]);t.context.push(x),w=!0,b+=n}else if(t&&t.find((e=>e[0]===l().BQP.Deleted&&e[1]===p))){w||(_=r()),v[_]||(v[_]={type:"crdt",editId:_,traceId:i,context:[],undoOperations:[],underlineOperations:[]});const t=v[_],o=a.getOperationsForDeleteText(b,b+n-1);m.push(...o.operations),o.operations.forEach((e=>{a.applyDeleteOperation(e)})),h.push(...o.invertedOperations),t.undoOperations.push(...o.invertedOperations);const s=(0,l().Ey_)(e,[[l().BQP.Deleted,_]]);t.context.push(s);let c="",d=0,u="",p=b-1;const g=b-I;for(const e of f)if(e.index<I&&(e.isWordLike?(c=e.segment,d=e.index+g):c+=e.segment),e.index!==I&&e.index>=I+n){if(e.isWordLike){u+=e.segment,p+=e.segment.length;break}u+=e.segment,p+=e.segment.length}k=[...c?[(0,l().Ey_)(c)]:[],(0,l().Ey_)(e,[[l().BQP.Deleted,_]]),...u?[(0,l().Ey_)(u)]:[]],S=a.getOperationsForAddAnnotation(d,p,[l().BQP.TemporarySuggestionUnderline,_]).operations,w=!0,I+=n}else w&&k&&S&&(v[_].context=k,v[_].underlineOperations.push(...S)),w=!1,b+=n,I+=n;y=x}w&&k&&S&&(v[_].context=k,v[_].underlineOperations.push(...S));for(const l of Object.values(v))for(const e of l.underlineOperations)a.applyAnnotationOperation(e);return{type:"crdt",operations:m,invertedOperations:h,edits:v,titleTextValue:a.getTextValue()}}({environment:t,blockStore:n,newBlockTitleTextValue:p,editIdGenerator:()=>(0,g().Ay)(),traceId:r});!function(e){const{environment:t,edits:n,traceId:o,sessionId:r}=e;Object.entries(n).forEach((([e,n])=>{n&&(0,a().u)({environment:t,event:{eventName:"co_editing_edit",eventProperties:{session_id:r,edit_id:e,trace_id:o}}})}))}({environment:t,edits:m.edits,traceId:r,sessionId:d}),b().createAndCommit({userAction:"aiCoEditing.applyAutocorrectCrdt",environment:t,canUndo:!0,perform:e=>{e.undoStartCallbacks.push((async()=>{const e=await(0,f().uZ)();e.submitEvent({type:"undo",blockStore:n}),(0,a().u)({environment:t,event:{eventName:"co_editing_undo",eventProperties:{session_id:e.getSessionId(),edit_id:Object.keys(m.edits)[0],edit_ids:Object.keys(m.edits),trace_id:r,source:"undo_shortcut"}}}),Q({environment:t,spaceId:n.getSpaceId(),traceId:r,feedback:"rejected",textContext:JSON.stringify(Object.values(m.edits).map((e=>(null==e?void 0:e.context)??[])).reduce(((e,t)=>[...e,...t]),[]))});const o=(0,i().getBlockSuggestion)(w().T,n.id);if(o&&"crdt"===o.type){const e={...o.edits};Object.keys(m.edits).forEach((t=>e[t]=void 0));const t={...o,edits:e,titleTextValue:(0,I().L)(n,e)};(0,i().setBlockSuggestion)(w().T,n,t)}}));const o=m.operations.map((e=>(0,u().qA)({pointer:n.pointer,crdtOperation:e}))),s=m.invertedOperations.map((e=>(0,c().c)({pointer:n.pointer,invertedCrdtOperation:e,previousTextValue:n.getTitleValue()})));b().applyCrdtTextOperations({store:n,operations:o,invertedOperations:s,transaction:e})}});const S=(0,i().getBlockSuggestion)(w().T,n.id);if(S&&"crdt"===S.type){const e={type:"crdt",operations:[...S.operations,...m.operations],invertedOperations:[...S.invertedOperations,...m.invertedOperations],titleTextValue:m.titleTextValue,edits:{...S.edits,...m.edits}};return e.edits=(0,I().q)((0,I().L)(n,e.edits),e.edits),e.titleTextValue=(0,I().L)(n,e.edits),void(0,i().setBlockSuggestion)(w().T,n,e)}(0,i().setBlockSuggestion)(w().T,n,m)}function P(e){const{diff:t,diffForContext:n,originalText:o,traceId:r}=e,{modifiedDiff:i,editIds:a}=E({diff:t});return{modifiedDiff:i,edits:T({diffForContext:n,editIds:a,originalText:o,traceId:r})}}function E(e){const{diff:t}=e,n=[];return{modifiedDiff:t.map((e=>{const[t,o]=e,r=(0,l().i54)(o??[]);if(o&&r){const e=(0,g().Ay)();n.push(e);const r=o.map((t=>(0,l().n5B)(t)?[l().Ifu.TemporarySuggestionUnderline,e]:t));return(0,l().Ey_)(t,r)}return e})),editIds:n}}function T(e){const{diffForContext:t,editIds:n,originalText:o,traceId:r}=e,i={};let a=null,s=[],c=0;function d(){i[n[c]]={type:"textValue",editId:n[c],context:s,originalText:o,traceId:r},c++,s=[]}if(t.forEach(((e,n)=>{if(s.length>0&&(0,l().byt)(s[s.length-1][1]??[])){const t=e[0].split(" ").filter(Boolean).slice(0,1)[0];s.push((0,l().Ey_)(t,e[1]??[])),d()}if((0,l().azZ)(e[1]??[])){if(a){var o;const e=(null===(o=a[0].match(/\S+\s*$/))||void 0===o?void 0:o[0])??"";s.push((0,l().Ey_)(e,a[1]??[]))}s.push(e)}(0,l().byt)(e[1]??[])&&(s.push(e),n===t.length-1&&d()),a=e})),s.length>0&&d(),c!==n.length)throw new Error("Edits length mismatch");return i}function Q(e){const{environment:t,spaceId:n,traceId:o,feedback:r,textContext:i}=e;m().callCellCompatibleApi({eventName:"saveInferenceTranscriptFeedback",environment:t,data:{type:"autocorrect",traceId:o,spaceId:n,feedbackType:"accepted"===r?"thumbs_up":"thumbs_down",userComment:i},cellNavigation:{spaceId:n}})}var M=()=>n(72897);class j extends(()=>n(757695))().Store{getInitialState(){return{presence:{}}}getPresencesForBlock(e){return this.state.presence[e]}}const O=new j;var D=()=>n(798880);function U(e){var t;const{navigableBlockId:n,blockId:o}=e;if(!n||!o)throw new Error("Invalid argument, navigableBlockId and blockId are required");const r={userId:D().zz.id,present:!0,activityTimestampNearestMinuteMs:Date.now(),blockId:o};(null===(t=O.getPresencesForBlock(n))||void 0===t?void 0:t.find((e=>e.blockId===o)))||O.setState({presence:{...O.getState().presence,[n]:[...O.getState().presence[n]||[],r]}})}function V(e){const{navigableBlockId:t,blockId:n}=e;var o;n?O.setState({presence:{...O.getState().presence,[t]:null===(o=O.getState().presence[t])||void 0===o?void 0:o.filter((e=>e.blockId!==n))}}):O.setState({presence:{...O.getState().presence,[t]:[]}})}function q(){O.setState({presence:{}})}n(296540);var F=()=>n(484714),L=()=>n(590526),R=()=>n(489295),N=()=>n(295304),H=()=>n(551864),z=(n(737550),()=>n(401497)),G=()=>n(807449),Z=()=>n(695115),W=()=>n(265060),K=()=>n(454503),J=()=>n(349679),$=()=>n(120251),X=()=>n(69708),Y=()=>n(284371),ee=()=>n(712030),te=()=>n(29554),ne=n(474848);function oe(e){return e.map((e=>{const[t,n]=e;if(!n)return e;if(!n.some(l().XKU))return e;const o=t.replaceAll(" "," ");return(0,l().Ey_)(o,n)}))}function re({textValue:e,parentStore:t,mode:n,onAccept:o,onReject:r}){const i=(0,X().tz)(),a=(0,F().v3)(),s=(0,z().DP)(),c=(0,L().K8)((()=>{const n=(0,te().S5)({environment:a,textValue:{value:oe(e),spaceId:t.getSpaceId()},parentStore:t,disableHover:!0,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disabled:!0,theme:s,emojiType:(0,ee().FN)(a),katex:a.KatexStore.getKatex(),formulaValueTypes:[]});return(0,ne.jsx)("span",{children:n})}),[a,e,s,t]),d=(0,z().IS)((()=>({container:{display:"grid",gridTemplateColumns:"auto 1fr",gap:5,alignItems:"center",padding:"5px 12px",width:"fit-content",minWidth:"min-content"},actionContainer:{display:"flex",alignItems:"center",gap:5},textContainer:{...Y().RC,fontSize:14,lineHeight:"22px",minWidth:"fit-content",whiteSpace:"pre-wrap"}})),[]);return(0,ne.jsxs)("div",{style:d.container,children:[(0,ne.jsx)("div",{style:d.actionContainer,children:"auto_accept"===n?(0,ne.jsx)(Z().A,{style:{width:16,height:16},icon:e=>(0,ne.jsx)(G().I,{icon:K().arrowUTurnUpLeftIcon,style:{...e}}),onClick:r,ariaLabel:i.formatMessage({id:"autoCorrectCard.undoAutoCorrection",defaultMessage:"Undo auto-correction"})}):(0,ne.jsxs)(ne.Fragment,{children:[(0,ne.jsx)(Z().A,{style:{width:16,height:16},icon:J().checkmarkSmallIcon,onClick:o,ariaLabel:i.formatMessage({id:"autoCorrectCard.acceptCorrection",defaultMessage:"Accept correction"})}),(0,ne.jsx)(Z().A,{style:{width:16,height:16},icon:e=>(0,ne.jsx)(W().Q,{iconGroup:$().k,variantName:"default",style:{width:16,height:16,...e}}),onClick:r,ariaLabel:i.formatMessage({id:"autoCorrectCard.rejectCorrection",defaultMessage:"Reject correction"})})]})}),(0,ne.jsx)("div",{style:d.textContainer,children:c})]})}function ie({store:e,annotation:t,onDismiss:n}){const o=(0,F().v3)(),{suggestion:r,editId:s,parentStore:d}=(0,L().K8)((()=>{const n=(0,R().aP)(e);if(!n)return{textValue:void 0,editId:void 0,parentStore:void 0};const o=l().JJX(t);if(!o)return{suggestion:void 0,editId:void 0,parentStore:void 0};const r=(0,i().getBlockSuggestion)(w().T,n.id);return r?{suggestion:r,editId:o,parentStore:n}:{suggestion:void 0,editId:void 0,parentStore:void 0}}),[e,t]);if(!r||!d||!s)return null;const u=r.edits[s];if(!u)return null;return(0,ne.jsx)(re,{textValue:u.context,parentStore:d,mode:"auto_accept",onAccept:()=>{},onReject:async()=>{switch(u.type){case"textValue":b().createAndCommit({userAction:"aiCoEditing.undoUnderlineCorrection",environment:o,canUndo:!1,perform:e=>{N().R9({environment:o,store:d.getBlockTitleStore(),value:u.originalText,transaction:e})}});break;case"crdt":b().createAndCommit({userAction:"aiCoEditing.undoUnderlineCorrectionCrdt",environment:o,canUndo:!1,perform:e=>{u.undoOperations.map((t=>(0,H().e)({environment:o,store:d,transaction:e,operation:(0,c().c)({pointer:d.pointer,invertedCrdtOperation:t,previousTextValue:d.getTitleValue()})})))}});break;default:(0,C().HB)(u)}null==n||n();const e=await(0,f().uZ)();e.submitEvent({type:"undo",blockStore:d}),(0,a().u)({environment:o,event:{eventName:"co_editing_undo",eventProperties:{session_id:e.getSessionId(),edit_id:s,trace_id:u.traceId,source:"hover_card"}}}),Q({environment:o,spaceId:d.getSpaceId(),traceId:u.traceId,feedback:"rejected",textContext:JSON.stringify(u.context)})}})}var ae=()=>n(229833),se=()=>n(102172);const ce={text:!0,bulleted_list:!0,numbered_list:!0,toggle:!0,quote:!0,header:!0,sub_header:!0,sub_sub_header:!0,header_4:!0,callout:!0,post:!0,to_do:!0,table:!1,table_row:!1,page:!1,personal_home_page:!1,home_shortcuts:!1,factory:!1,button:!1,column_list:!1,column:!1,embed:!1,framer:!1,tweet:!1,gist:!1,drive:!1,audio:!1,maps:!1,invision:!1,mixpanel:!1,image:!1,video:!1,file:!1,bookmark:!1,equation:!1,code:!1,collection_view:!1,collection_view_page:!1,form:!1,breadcrumb:!1,copy_indicator:!1,divider:!1,link_to_page:!1,link_to_collection:!1,figma:!1,loom:!1,typeform:!1,codepen:!1,pdf:!1,table_of_contents:!1,whimsical:!1,miro:!1,abstract:!1,sketch:!1,excalidraw:!1,replit:!1,alias:!1,transclusion_container:!1,transclusion_reference:!1,external_object_instance:!1,tab:!1,external_object_instance_page:!1,hex:!1,deepnote:!1,ai_block:!1,drawing:!1,slide:!1,workflow:!1,transcription:!1,mail:!1,temporary_ui:!1,edit_reference:!1},de={[l().BQP.Bold]:!0,[l().BQP.Italic]:!0,[l().BQP.Strike]:!0,[l().BQP.Code]:!0,[l().BQP.Underline]:!0,[l().BQP.Link]:!0,[l().BQP.Discussion]:!1,[l().BQP.Highlight]:!1,[l().BQP.Date]:!1,[l().BQP.User]:!1,[l().BQP.Bot]:!1,[l().BQP.Page]:!1,[l().BQP.Collection]:!1,[l().BQP.ExternalObjectInstance]:!1,[l().BQP.Group]:!1,[l().BQP.Team]:!1,[l().BQP.CustomEmoji]:!1,[l().BQP.LinkMention]:!1,[l().BQP.Equation]:!1,[l().BQP.ChatSelectionContext]:!1,[l().BQP.FormulaError]:!1,[l().BQP.Inserted]:!1,[l().BQP.Deleted]:!1,[l().BQP.TemporaryComment]:!1,[l().BQP.TemporaryPage]:!1,[l().BQP.TemporaryCollection]:!1,[l().BQP.TemplateVariable]:!1,[l().BQP.Comment]:!1,[l().BQP.Citation]:!1,[l().BQP.TemporaryCitation]:!1,[l().BQP.TemporaryEquation]:!1,[l().BQP.TemporaryInput]:!1,[l().BQP.TemporarySelection]:!1,[l().BQP.TemporaryCommentHighlight]:!1,[l().BQP.TemporarySuggestionUnderline]:!1,[l().BQP.FormulaPageProperty]:!1,[l().BQP.FormulaContextValue]:!1,[l().BQP.TemporaryFindHighlight]:!1,[l().BQP.TemporarySelectedFindHighlight]:!1,[l().BQP.TemporaryCursor]:!1,[l().BQP.SuggestionInsertText]:!1,[l().BQP.SuggestionRemoveText]:!1,[l().BQP.SuggestionAnnotate]:!1,[l().BQP.SuggestionUnannotate]:!1,[l().BQP.TemporaryHighlight]:!1,[l().BQP.TemporaryNativeMABFilter]:!1,[l().BQP.TemporaryDictation]:!1,[l().BQP.AssistantInstructionsCollection]:!1,[l().BQP.Place]:!1,[l().BQP.SlackSpecialMention]:!1,[l().BQP.TemporarySearchFilter]:!1,[l().BQP.TitleOnly]:!1,[l().BQP.Sort]:!1,[l().BQP.SearchFilterCreatedTime]:!1,[l().BQP.SearchFilterLastEditedTime]:!1,[l().BQP.DeletionMarker]:!1};class le{constructor(){this.requests=[],this.currentRequest=null,this.currentRequestCancelled=!1,this.dropUntilMs={},this.currentEnvironment=void 0,this.currentBlockStore=void 0,this.sessionId=void 0,this.handleTextSelectionStoreChange=e=>{const t=e.getState();switch(t.mode){case"readOnly":case"empty":this.submitEvent({type:"textSelectionCleared"});break;case"editing":{var n;const e=t.multiSelection.start.store,o=(0,R().aP)(e);if(!o)return void this.submitEvent({type:"textSelectionCleared"});o.id!==(null===(n=this.currentBlockStore)||void 0===n?void 0:n.id)&&this.submitEvent({type:"blockEntered",blockStore:o});break}default:(0,C().HB)(t)}},n(232615).default.addListener(this.handleTextSelectionStoreChange),this.sessionId=(0,g().lZ)()}submitEvent(e){switch(e.type){case"textSelectionCleared":case"blockEntered":this.currentBlockStore&&this.currentEnvironment&&this.isBlockStoreValidForAutoCorrect(this.currentBlockStore)&&this.addRequest({type:"blockAutoCorrectUnderlines",environment:this.currentEnvironment,blockStore:this.currentBlockStore}),this.currentBlockStore=void 0,this.currentEnvironment=void 0;break;case"blockUpdated":this.currentBlockStore||(this.currentBlockStore=e.blockStore,this.currentEnvironment=e.environment),this.currentBlockStore&&this.currentBlockStore.id!==e.blockStore.id&&this.currentEnvironment&&this.isBlockStoreValidForAutoCorrect(this.currentBlockStore)&&(this.addRequest({type:"blockAutoCorrectUnderlines",environment:this.currentEnvironment,blockStore:this.currentBlockStore}),this.currentBlockStore=e.blockStore,this.currentEnvironment=e.environment);break;case"undo":this.dropUntilMs[e.blockStore.id]=Date.now()+3e5;break;default:(0,C().HB)(e)}}addRequest(e){var t,n;if(e.blockStore.id===(null===(t=this.currentRequest)||void 0===t?void 0:t.blockStore.id)&&e.type===(null===(n=this.currentRequest)||void 0===n?void 0:n.type)&&(this.currentRequestCancelled=!0),this.requests.some((t=>t.blockStore.id===e.blockStore.id&&t.type===e.type)))return;const o=(0,x().o9)(e.blockStore.getNavigableBlockStore());o&&this.currentEnvironment&&(0,se().BP)(o,this.currentEnvironment,this.currentEnvironment.device)&&(U({navigableBlockId:o.id,blockId:o.id}),this.requests.push(e),this.triggerRun())}triggerRun(){this.currentRequest||this.run()}async run(){var e;if(this.currentRequest)throw new Error("CoEditingTasksManager.run called while a request is already in progress");if(!this.currentEnvironment)return;const t=null===(e=this.currentBlockStore)||void 0===e?void 0:e.getNavigableBlockStore();if(!this.currentBlockStore||!t)return;if(!(0,se().BP)(t,this.currentEnvironment,this.currentEnvironment.device))return;const o=this.requests.shift();if(!o)return;this.currentRequest=o;const r=(0,x().o9)(this.currentRequest.blockStore.getNavigableBlockStore());try{U({navigableBlockId:r.id,blockId:this.currentRequest.blockStore.id});const e=o.type;if("blockAutoCorrectUnderlines"===e)await this.runBlockAutoCorrectUnderlines(o);else(0,C().HB)(e)}catch(i){!function(e,t){const o=n(449412).Fg(t,{tags:{from:"coEditingTaskManager"}});n(165358).log({level:"error",from:"coEditingTaskManager",type:e,error:(0,ae().convertErrorToLog)(t),data:{},sentryEventId:o})}(o.type,i)}finally{V({navigableBlockId:r.id,blockId:this.currentRequest.blockStore.id}),this.currentRequest=null,this.currentRequestCancelled=!1}this.run()}async runBlockAutoCorrectUnderlines(e){const{environment:t,blockStore:n}=e,o=n.getTitleValue(),r=n.getNavigableBlockStore();if(!r)return;const i=(0,g().lZ)(),a=await _(t,n.getSpaceId(),o,i,r.pointer);if(!a||this.currentRequestCancelled)return;const s=(0,l().q4_)(o);s===(0,l().q4_)(n.getTitleValue())&&s!==a&&n.isCrdtEnabled()&&await A({environment:t,blockStore:n,completion:a,traceId:i,sessionId:this.sessionId})}getSessionId(){return this.sessionId}resetSessionId(){return this.sessionId=(0,g().lZ)(),this.sessionId}isBlockStoreValidForAutoCorrect(e){var t;if(this.dropUntilMs[e.id]&&this.dropUntilMs[e.id]>Date.now())return!1;if(e.isNavigableBlock()||e.isLocked()||!e.canEdit())return!1;const n=e.getType();if(!n)return!1;if(!ce[n])return!1;if(e.getDiscussionStores().filter((e=>!e.getResolved())).length>0)return!1;const o=null===(t=e.getTitleStore())||void 0===t?void 0:t.getValue();if(!o)return!1;return!o.some((e=>{if(2!==e.length)return!1;return e[1].some((e=>!de[e[0]]))}))}}},438632:(e,t,n)=>{n.d(t,{PD:()=>u,cb:()=>d,hl:()=>p});n(16280),n(944114),n(898992),n(354520),n(803949),n(581454);var o=n.n(n(625473)),r=n.n(n(716471)),i=()=>n(496603),a=()=>n(534177),s=()=>n(634201),c=()=>n(201980);let d=function(e){return e[e.removed=-1]="removed",e[e.added=1]="added",e[e.same=0]="same",e}({});const l=1e4;function u(e,t){const n=new(r())({timeout:2,editCost:6}),o=n.main(t,e);return n.cleanupSemantic(o),o}function p(e){const t=performance.now(),{before:n,after:r,isIncompleteAfter:p,insertCursor:g}=e,f=c().AhH(n),m=c().AhH(r);if(Math.max(f,m)>l)return{diffValue:r,metrics:{beforeLength:f,afterLength:m,latencyMs:performance.now()-t}};const h={count:0,encoding:{},decoding:{},annotationEncoding:{},annotationDecoding:{}},v=e=>{const t=h.encoding[e];if(t)return t;{const t=String.fromCharCode(h.count);return h.count++,h.encoding[e]=t,h.decoding[t]=e,t}},y=e=>{const t=o()(e),n=h.annotationEncoding[t];if(n)return n;{const n=String.fromCharCode(h.count);return h.count++,h.annotationEncoding[t]=n,h.annotationDecoding[n]=e,n}},k=t=>i().Bq(c().RQ(t).map((t=>{let n=[];if("word"===e.mode||"wordUnderlineFinal"===e.mode){if("undefined"==typeof Intl||!Intl.Segmenter)throw new Error("Intl.Segmenter is not supported");{const e=new Intl.Segmenter(void 0,{granularity:"word"}).segment(t[0]);n=Array.from(e).map((e=>e.segment))}}else n=s().PE(t[0]);const o=n.map(v);if(c().qXl(t)){const e=c().uPN(t),n=c().jhx(e);n&&(o[0]=y({type:"mention",value:n}),e.forEach((e=>{c().iGj(e)||c().gir(e)||c().lfl(e)||(o.unshift(y({type:"start",value:e})),o.push(y({type:"end",value:e})))})))}else if(c().GiG(t)){const e=c().uPN(t),n=c().j1D(e);if(n){o[0]=y({type:"equation",value:n});for(const t of e)c().iGj(t)||c().gir(t)||c().lfl(t)||(o.unshift(y({type:"start",value:t})),o.push(y({type:"end",value:t})))}}else if(c().BEe(t)){c().uPN(t).forEach((e=>{o.unshift(y({type:"start",value:e})),o.push(y({type:"end",value:e}))}))}return o}))).join("");if(h.count>65535)throw new Error("This string has way too many different characters.");const S=u(k(r),k(n)),b=[];let I=[],x=0;const C=p?i().Kl(S,(e=>0===e[0]||1===e[0])):0;let B=!1;const w=e.insertionAnnotation,_=e.deletionAnnotation;S.forEach((([t,n])=>{n.split("").forEach((n=>{if(h.decoding[n]){const o=h.decoding[n];t===d.added?b.push([o,[...I,"wordUnderlineFinal"===e.mode?e.underlineAnnotation:w]]):t===d.removed&&(!p||x<=C)?"wordUnderlineFinal"!==e.mode&&b.push([o,[...I,_]]):(p&&g&&!B&&x===C+1&&(B=!0,b.push(["",[["tc"]]])),b.push([o,I]))}else{const o=h.annotationDecoding[n];if(t===d.added)if("mention"===o.type)b.push([c().Sj,[...I,"wordUnderlineFinal"===e.mode?e.underlineAnnotation:w,o.value]]);else if("start"===o.type)I=[...I,o.value];else if("end"===o.type)I=I.filter((e=>!i().n4(e,o.value)));else if("equation"===o.type){const e=c().U35(o.value),t=c().G0H(e,[...I,w]);b.push(t)}else(0,a().HB)(o);else if(t===d.removed){if("mention"===o.type)"wordUnderlineFinal"!==e.mode&&b.push([c().Sj,[...I,_,o.value]]);else if("equation"===o.type){const e=c().U35(o.value),t=c().G0H(e,[...I,_]);b.push(t)}}else if(t===d.same)if("mention"===o.type)b.push([c().Sj,[...I,o.value]]);else if("start"===o.type)I=[...I,o.value];else if("end"===o.type)I=I.filter((e=>!i().n4(e,o.value)));else if("equation"===o.type){const e=c().U35(o.value),t=c().G0H(e,I);b.push(t)}else(0,a().HB)(o)}})),p&&(x+=1)}));return{diffValue:c().__s(b),metrics:{beforeLength:f,afterLength:m,latencyMs:performance.now()-t}}}},454503:(e,t,n)=>{n.r(t),n.d(t,{arrowUTurnUpLeftIcon:()=>r,iconDefinition:()=>o});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"2.12 3.72 15.76 12.16",directional:!0,svg:(0,n(474848).jsx)("path",{d:"M7.592 4.792a.625.625 0 1 0-.884-.884l-4.4 4.4a.625.625 0 0 0 0 .884l4.4 4.4a.625.625 0 1 0 .884-.884L4.259 9.375H14a2.625 2.625 0 0 1 0 5.25h-1.42a.625.625 0 1 0 0 1.25H14a3.875 3.875 0 0 0 0-7.75H4.259z"})},r=(0,n(340498).wt)("arrowUTurnUpLeft",o,"default")},556122:(e,t,n)=>{n.d(t,{QJ:()=>g,TI:()=>d});n(944114),n(581454);var o=()=>n(726637),r=()=>n(763824);let i=0;const a="clipboard",s={debug:Boolean(o().A.isDevelopingInAirplaneMode),responseText:a,showErrorCode:!1,delayBetweenChunks:20,chunkSize:5,numLoremIpsums:3},c="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec porta auctor sem vel efficitur. Vivamus efficitur eros sed erat efficitur efficitur. Vivamus et augue vel est efficitur efficitur.";function d(){return s}function l(e){return{async*[Symbol.asyncIterator](){for(const t of e)await(0,r().wR)(s.delayBetweenChunks),yield t}}}function u(e,t){const n=Math.ceil(e.length/t),o=new Array(n);for(let r=0,i=0;r<n;++r,i+=t)o[r]=e.substr(i,t);return o}function p(e){return e.map((e=>({type:"success",p:"padding",completion:e,inferenceId:"mock"})))}async function g({environment:e,data:t}){console.log("Retrieving fake completion for data",t);const{context:n}=t,r=n.selectedText,d=[];let{responseText:g}=s;if(g===a&&(g=await async function(){try{return await navigator.clipboard.readText()}catch(e){return}}()??"Unable to retrieve clipboard text."),void 0===g&&(d.push({type:"success",p:"padding",completion:"\n",inferenceId:"mock"},{type:"success",p:"padding",completion:"this is ",inferenceId:"mock"},{type:"success",p:"padding",completion:"fake ",inferenceId:"mock"},{type:"success",p:"padding",completion:`streaming response ${i++}.`,inferenceId:"mock"}),o().A.isDevelopingInAirplaneMode&&d.push({type:"success",p:"padding",completion:"\n\nTo see a real AI response, run the server with `--airplaneMode=false`.",inferenceId:"mock"}),"string"==typeof r)){d.push({type:"success",p:"padding",completion:"\n\nHere is the text you selected:\n\n",inferenceId:"mock"});for(const e of u(r,s.chunkSize))d.push({type:"success",completion:e,p:"padding",inferenceId:"mock"})}if(s.showErrorCode)d.push({type:"error",message:"alas",errorCode:s.showErrorCode,isRetryable:!1});else if(void 0===g)for(let o=0;o<s.numLoremIpsums;o++)d.push(...p([`\n\n${o+1}. `,...u(c,0===s.delayBetweenChunks?c.length:s.chunkSize)]));else if(g.length>0){const e=u(g,s.chunkSize);d.push(...p(e))}return Promise.resolve({type:"success",data:l(d),status:200,headers:{}})}(0,n(852832).exposeDebugValue)("completionDebugSettings",s)},696419:(e,t,n)=>{n.d(t,{x:()=>a});var o=()=>n(564884),r=()=>n(93723),i=()=>n(438632);function a(e){const{environment:t,from:n,...a}=e,{diffValue:s,metrics:c}=(0,i().hl)(a);return(0,o().u)({environment:t,event:{eventName:"diff_text_value_latency",eventProperties:{time:c.latencyMs,from:n,implementation:"sync",before_length:(0,r().P)(c.beforeLength),after_length:(0,r().P)(c.afterLength)}}}),s}},738508:(e,t,n)=>{n.r(t),n.d(t,{cursorIcon:()=>i,iconDefinition:()=>r});n(296540);var o=n(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"1.25 0 17.5 20",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)("g",{className:"logo-light-mode",children:[(0,o.jsxs)("g",{clipPath:"url(#clip0_16020_205)",children:[(0,o.jsx)("path",{fill:"#757575",d:"m9.995 9.987 8.658 4.999a.6.6 0 0 1-.226.226l-8.092 4.672a.68.68 0 0 1-.68 0l-8.092-4.672a.6.6 0 0 1-.226-.226z"}),(0,o.jsx)("path",{fill:"#525252",d:"M9.995 0v9.987l-8.658 4.999a.6.6 0 0 1-.082-.309v-9.38c0-.22.117-.424.308-.534L9.655.09a.7.7 0 0 1 .34-.09"}),(0,o.jsx)("path",{fill:"#404040",d:"M18.652 4.989a.6.6 0 0 0-.225-.226L10.334.09A.7.7 0 0 0 9.995 0v9.987l8.658 4.999a.6.6 0 0 0 .083-.309v-9.38c0-.11-.03-.216-.083-.308"}),(0,o.jsx)("path",{fill:"#D9D9D9",d:"M18.047 5.339a.29.29 0 0 1 0 .29l-7.859 13.61c-.053.093-.193.055-.193-.05v-8.97a.4.4 0 0 0-.054-.201z"}),(0,o.jsx)("path",{fill:"#fff",d:"m18.047 5.339-8.106 4.68a.4.4 0 0 0-.147-.147L2.027 5.387c-.092-.053-.054-.193.052-.193h15.717c.111 0 .202.06.25.145"})]}),(0,o.jsx)("defs",{children:(0,o.jsx)("clipPath",{id:"clip0_16020_205",children:(0,o.jsx)("path",{fill:"#fff",d:"M1.255 0h17.49v20H1.256z"})})})]}),(0,o.jsxs)("g",{className:"logo-dark-mode",children:[(0,o.jsxs)("g",{clipPath:"url(#clip0_16020_213)",children:[(0,o.jsx)("path",{fill:"#6E6E6E",d:"m9.995 9.987 8.658 4.999a.6.6 0 0 1-.226.226l-8.092 4.672a.68.68 0 0 1-.68 0l-8.092-4.672a.6.6 0 0 1-.226-.226z"}),(0,o.jsx)("path",{fill:"#4A4A4A",d:"M9.995 0v9.987l-8.658 4.999a.6.6 0 0 1-.082-.309v-9.38c0-.22.117-.424.308-.534L9.655.09a.7.7 0 0 1 .34-.09"}),(0,o.jsx)("path",{fill:"#383838",d:"M18.652 4.989a.6.6 0 0 0-.225-.226L10.334.09A.7.7 0 0 0 9.995 0v9.987l8.658 4.999a.6.6 0 0 0 .083-.309v-9.38c0-.11-.03-.216-.083-.308"}),(0,o.jsx)("path",{fill:"#C9C9C9",d:"M18.047 5.339a.29.29 0 0 1 0 .29l-7.859 13.61c-.053.093-.193.055-.193-.05v-8.97a.4.4 0 0 0-.054-.201z"}),(0,o.jsx)("path",{fill:"#fff",d:"m18.047 5.339-8.106 4.68a.4.4 0 0 0-.147-.147L2.027 5.387c-.092-.053-.054-.193.052-.193h15.717c.111 0 .202.06.25.145"})]}),(0,o.jsx)("defs",{children:(0,o.jsx)("clipPath",{id:"clip0_16020_213",children:(0,o.jsx)("path",{fill:"#fff",d:"M1.255 0h17.49v20H1.256z"})})})]})]})},i=(0,n(340498).wt)("cursor",r,"default")}}]);