"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[16060],{1295:(e,t,o)=>{o.d(t,{P_:()=>N,ie:()=>Z});o(16280),o(944114),o(898992),o(354520),o(672577),o(430670),o(581454);var n=()=>o(319625),r=()=>o(498212),i=()=>o(183558),c=()=>o(973647),s=()=>o(534177),l=()=>o(81252),a=()=>o(165358),d=()=>o(997769),p=()=>o(792071),u=()=>o(134025),f=()=>o(651784),h=()=>o(179034),g=()=>o(519831),m=()=>o(869558),y=()=>o(837420),b=()=>o(495585),v=()=>o(201980),k=()=>o(496703),I=()=>o(265282),_=()=>o(24153),x=()=>o(687249),w=()=>o(761865),C=()=>o(661165),U=()=>o(492736);function B(e){if(!e||0===e.length)return e;const t=[];for(const o of e){const e=(0,v().N8A)(o);if("string"==typeof e&&e.length>0){const n=E(e);if(n===e)t.push(o);else{const e=(0,v().uPN)(o);t.push((0,v().Ey_)(n,e))}}else t.push(o)}return t}function E(e){if(!e)return e;const t=function(e){if(!e.includes("\\u"))return e;return e.replace(b().BJ,b().mb)}(e);return t.split("\n").map((e=>{const t=e.match(b().jp);return t?b().KL+e.slice(t[0].length):e})).join("\n")}function M(e,t,o){const n=[],r=[...(0,d().I6)(e),...(0,x().GP)(e)].sort(((e,t)=>e.start===t.start?t.end-e.end:e.start-t.start)).filter(function(){let e=-1;return function(t){return!(t.start<=e)&&(e=t.end,!0)}}());if(0===r.length)return n.push((0,v().Ey_)(e,[])),n;let i=0;for(const d of r){if(d.start>i){const t=e.slice(i,d.start);t&&n.push((0,v().Ey_)(t,[]))}if(d.href.startsWith("collection://")){const e=x().nm.collection.parseUri(d.href);if(e instanceof Error){const e=["a",d.href];n.push((0,v().Ey_)(d.value,[e]))}else{const t=(0,v().ETy)({collectionId:e.collectionId,spaceId:o,parentCvbId:void 0}),r=(0,v().wmz)(t,[]);n.push(r)}}else if(d.href.startsWith("agent://")){const e=x().nm.agent.parseUri(d.href),o=["a",e instanceof Error?d.href:(0,k().L)({baseUrl:t.baseUrl,params:{},workflowId:e.workflowId})];n.push((0,v().Ey_)(d.value,[o]))}else if((0,_().ZI)(d.href)){var c,s;const e=_().A2.slackMessage.parseUri(d.href),t=e instanceof Error||null===(c=(s=_().A2.slackMessage).getUrl)||void 0===c?void 0:c.call(s,e),o="string"==typeof t?t:d.href,r=(0,v().Sez)(o);n.push((0,v().Ey_)(o,[r]))}else if((0,_().ph)(d.href)){var l,a;const e=_().A2.slackUser.parseUri(d.href),t=e instanceof Error||null===(l=(a=_().A2.slackUser).getUrl)||void 0===l?void 0:l.call(a,e),o="string"==typeof t?t:d.href,r=(0,v().Sez)(o);n.push((0,v().Ey_)(o,[r]))}else try{const e=(0,f().parseRoute)({url:d.href,baseUrl:t.baseUrl,publicDomainName:t.publicDomainName,isMobile:!1,protocol:void 0,currentUrl:void 0});if("page"===e.name&&e.blockId){const t=(0,v().ld4)(e.blockId,void 0,e.snapshotTimestamp);n.push((0,v().wmz)(t,[]))}else{const e=["a",d.href];n.push((0,v().Ey_)(d.value,[e]))}}catch{const e=["a",d.href];n.push((0,v().Ey_)(d.value,[e]))}i=d.end}if(i<e.length){const t=e.slice(i);t&&n.push((0,v().Ey_)(t,[]))}return n}function P(e){const{existingBlock:t,block:o,context:n,recordMap:r,uriContext:i,spaceId:c,actorPointer:l,getNow:a,parseAgentUrlFn:d}=e,p={table:h().ev,id:t.id,spaceId:c},u=(0,U().CU)(o),f=[];t.type!==u&&f.push({command:"update",path:[],pointer:p,args:{type:u}});const m={},y={},b=[];if("database"===o.type){if((0,s().O9)(o.inline)){const e=o.inline?"collection_view":"collection_view_page";t.type!==e&&f.push({command:"update",path:[],pointer:p,args:{type:e}})}if(o.dataSourceUrl){const e=(0,x().$e)(o.dataSourceUrl);if(!r.getModel({table:g().Vl,id:e}))throw new(w().Yv)("Data source not found: {dataSourceUrl}",{variables:{dataSourceUrl:o.dataSourceUrl}});m.collection_pointer={table:g().Vl,id:e,spaceId:c}}else{if(o.text){var v;const e=null===(v=t.getCollectionPointers)||void 0===v?void 0:v.call(t);if(e&&e.length>0){const t=e[0],s=N({text:o.text,uriContext:i,citationFormat:n.citationFormat,citationCounter:n.citationCounter,recordMap:r,spaceId:c,parseAgentUrlFn:d});f.push({command:"set",path:["name"],pointer:t,args:s})}}if(o.icon){var k;const e=null===(k=t.getCollectionPointers)||void 0===k?void 0:k.call(t);if(e&&e.length>0){const t=e[0];f.push({command:"set",path:["icon"],pointer:t,args:o.icon})}}}}else if("callout"===o.type)(0,s().O9)(o.icon)&&(m.page_icon=o.icon),m.callout_version=2,y.title=[];else if("to_do"===o.type)(0,s().O9)(o.checked)&&(y.checked=o.checked?[["Yes"]]:[["No"]]);else if("code"===o.type)(0,s().O9)(o.language)&&(y.language=[[o.language]]);else if("numbered_list"===o.type)(0,s().O9)(o.list_format)&&(m.list_format=o.list_format);else if("h1"===o.type||"h2"===o.type||"h3"===o.type||"h4"===o.type)m.toggleable=Boolean(o.toggleable);else if("table"===o.type)(0,s().O9)(o.headerRow)&&(m.table_block_column_header=o.headerRow),(0,s().O9)(o.headerColumn)&&(m.table_block_row_header=o.headerColumn),(0,s().O9)(o.fitPageWidth)&&(m.block_full_width=o.fitPageWidth);else if("table_row"===o.type){if((0,s().O9)(o.cells)){const e=t.parent_id,l=n.getTableColumns(e),a={};for(let t=0;t<l.length;t++){const e=l[t],s=t<o.cells.length?o.cells[t]:{text:[]};if(e){const t=N({text:s.text||[],uriContext:i,citationFormat:n.citationFormat,citationCounter:n.citationCounter,recordMap:r,spaceId:c,parseAgentUrlFn:d});if(y[e]=n.simpleBulletsEnabled?B(t):t,s.color){const t=(0,I().Ah)(s.color);t&&(a[e]={color:t})}}}Object.keys(a).length>0&&f.push({command:"update",path:["format","cell_format"],pointer:p,args:a}),(0,s().O9)(o.color)&&f.push({command:"update",path:["format"],pointer:p,args:{block_color:(0,I().Ah)(o.color)}})}}else"synced_block_reference"===o.type?(0,s().O9)(o.originalUrl)&&(m.transclusion_reference_pointer={table:h().ev,id:S(o.originalUrl,i),spaceId:c}):(0,I().Er)(o)?(T({agentBlock:o,properties:y,format:m,fileIds:b}),o.text&&(y.caption=N({text:o.text,uriContext:i,citationFormat:n.citationFormat,citationCounter:n.citationCounter,recordMap:r,spaceId:c,parseAgentUrlFn:d}))):"text"===o.type?(0,s().O9)(o.text)||(y.title=[]):"bulleted_list"===o.type||"toggle"===o.type||"column"===o.type||"column_list"===o.type||"tab"===o.type||"quote"===o.type||"equation"===o.type||"divider"===o.type||"table_of_contents"===o.type||"synced_block"===o.type||"ai_block"===o.type||"page"===o.type||"transcription"===o.type||"mail"===o.type||"edit_reference"===o.type||"unknown"===o.type||(0,s().HB)(o);if("text"in o&&o.text&&"database"!==o.type&&!(0,I().Er)(o)){const e=N({text:o.text,uriContext:i,citationFormat:n.citationFormat,citationCounter:n.citationCounter,recordMap:r,spaceId:c,parseAgentUrlFn:d,skipUrlProcessing:"code"===o.type});f.push({command:"update",path:["properties"],pointer:p,args:{title:e}})}return"color"in o&&o.color&&(m.block_color=(0,I().Ah)(o.color)),Object.keys(m).length>0&&f.push({command:"update",path:["format"],pointer:p,args:m}),Object.keys(y).length>0&&f.push({command:"update",path:["properties"],pointer:p,args:y}),b.length>0&&f.push(...b.map((e=>({command:"listAfter",pointer:p,path:["file_ids"],args:{id:e}})))),f.length>0&&f.push(...t.ops.updateLastEdited({author:l,timestamp:a()})),f}function N(e){const{text:t,uriContext:o,citationFormat:r="citation",citationCounter:i,recordMap:c,spaceId:s,parseAgentUrlFn:l,skipUrlProcessing:d}=e,p=[];for(const h of t)try{p.push(...F({inline:h,uriContext:o,spaceId:s,parseAgentUrlFn:l,citationCounter:i,citationFormat:r,recordMap:c,skipUrlProcessing:d}))}catch(u){let e;try{e="string"==typeof h?"text":h.type}catch(f){e="unknown"}const t=(0,n().A)(u);a().log({level:"error",from:"convertToNotionText",type:"convertToNotionTextError",error:{message:`Error converting agent text to notion token: ${e}`,stack:t.stack}})}return p}function F(e){const{inline:t,uriContext:o,spaceId:n,parseAgentUrlFn:r,citationCounter:i,citationFormat:c,recordMap:l,skipUrlProcessing:a}=e,d=[],p=e=>{if(!i)return;let t=i.hrefToNumber[e];return void 0===t&&(i.current+=1,t=i.current,i.hrefToNumber[e]=t),t};if("string"==typeof t)if(a)d.push([t]);else{const e=M(t,o,n);d.push(...e)}else{const e=t.annotations?function(e,t,o){const n=[];if(e.bold&&n.push(["b"]),e.italic&&n.push(["i"]),e.strikethrough&&n.push(["s"]),e.underline&&n.push(["_"]),e.code&&n.push(["c"]),e.color){const t=(0,I().Ah)(e.color);t&&n.push(["h",t])}e.href&&n.push(["a",e.href]);for(const r of e.discussionUrls??[]){const e=o(r,t);e&&"discussion"===e.type&&n.push(["m",e.discussionId])}return n}(t.annotations,o,r):[];if("annotated"===t.type)if(a)d.push((0,v().Ey_)(t.text,e));else{const r=M(t.text,o,n);for(const t of r){const[o,n]=t,r=[...n??[],...e];d.push((0,v().Ey_)(o,r))}}else if("mention"===t.type)if("user"===t.mention.type){const n=r(t.mention.url,o);if(n&&"user"===n.type){const t=(0,v().P4h)(n.userId);d.push((0,v().wmz)(t,e))}else if(n&&"slackUser"===n.type){var u,f;const o=null===(u=(f=x().nm.slackUser).getUrl)||void 0===u?void 0:u.call(f,n),r="string"==typeof o?o:t.mention.url,i=(0,v().Sez)(r);d.push((0,v().Ey_)(r,[i,...e]))}else d.push((0,v().Ey_)(t.mention.url,e))}else if("page"===t.mention.type||"database"===t.mention.type){const i=t.mention.url.replace(/([.,;:!?]+)$/,""),c=r(i,o);if(c&&"pageOrCollectionViewBlock"===c.type){const t=(0,v().ld4)(c.id,void 0);d.push((0,v().wmz)(t,e))}else if(c&&"agent"===c.type){const n=(0,k().L)({baseUrl:o.baseUrl,params:{},workflowId:c.workflowId}),r=(0,v().Sez)(n),i=(0,v().Ey_)(t.mention.title||n||"Source",[r,...e]);d.push(i)}else if(c&&"collection"===c.type){const t=(0,v().ETy)({collectionId:c.collectionId,spaceId:n,parentCvbId:void 0}),o=(0,v().wmz)(t,e);d.push(o)}else if(c){const o=(0,v().Sez)(i);d.push((0,v().Ey_)(t.mention.title||i||"Source",[o,...e]))}else d.push((0,v().Ey_)(t.mention.title||t.mention.url||"Source",e))}else if("date"===t.mention.type){const o=t.mention.end?{type:"daterange",start_date:t.mention.start,end_date:t.mention.end,date_format:"relative"}:{type:"date",start_date:t.mention.start,date_format:"relative"},n=(0,v().Ww9)(o);d.push((0,v().wmz)(n,e))}else if("custom_emoji"===t.mention.type){const o=t.mention.name,r=l.getModelsByTable(y().e).find((e=>e.name===o));if(r){const t={table:y().e,id:r.id,spaceId:n},o=(0,v().XTT)(t);d.push((0,v().wmz)(o,e))}else d.push((0,v().Ey_)(`:${o}:`,e))}else if("data-source"===t.mention.type){const i=t.mention.url.replace(/([.,;:!?]+)$/,""),c=r(i,o);if(c&&"collection"===c.type){const t=(0,v().ETy)({collectionId:c.collectionId,spaceId:n,parentCvbId:void 0}),o=(0,v().wmz)(t,e);d.push(o)}else{const o=(0,v().Sez)(i);d.push((0,v().Ey_)(t.mention.title||i||"Source",[o,...e]))}}else if("agent"===t.mention.type){const o=t.mention.url.replace(/([.,;:!?]+)$/,""),n=(0,v().Sez)(o);d.push((0,v().Ey_)(t.mention.name||o||"Agent",[n,...e]))}else(0,s().HB)(t.mention);else if("equation"===t.type){const o=(0,v().Ycj)(t.equation);d.push((0,v().Ey_)(v().Yl$,[o,...e]))}else if("citation"===t.type){if(t.href.startsWith("user://"))return d;const n=r(t.href,o);let i;if("agent"===(null==n?void 0:n.type))i=(0,k().L)({baseUrl:o.baseUrl,params:{},workflowId:n.workflowId});else if("discussion"===(null==n?void 0:n.type)&&n.pageId){var h,g;const e=null===(h=(g=x().nm.discussion).getUrl)||void 0===h?void 0:h.call(g,{type:"discussion",discussionId:n.discussionId,pageId:n.pageId,blockId:n.blockId,baseUrl:o.baseUrl});i="string"==typeof e?e:t.href}else if("slackMessage"===(null==n?void 0:n.type)){var m,b;const e=null===(m=(b=x().nm.slackMessage).getUrl)||void 0===m?void 0:m.call(b,n);i="string"==typeof e?e:t.href}else if("slackUser"===(null==n?void 0:n.type)){var _,w;const e=null===(_=(w=x().nm.slackUser).getUrl)||void 0===_?void 0:_.call(w,n);i="string"==typeof e?e:t.href}else if("citation"===(null==n?void 0:n.type)){const t=p(n.url),o=(0,v().X$)({href:n.url,blockId:n.id,spaceId:n.spaceId,type:n.recordType,...void 0!==t?{citationNumber:t}:void 0});d.push((0,v().wmz)(o,e)),i=n.url}else i=t.href;if("citation"!==(null==n?void 0:n.type))if("citation"===c){const t=(0,v().X$)({href:i,type:"url"});d.push((0,v().wmz)(t,e))}else if("link"===c){const t=p(i)??1,o=["a",i];d.push((0,v().Ey_)(`[${t}]`,[o,...e]))}else if("only-number-citations"===c){const t=p(i),o=(0,v().X$)({href:i,type:"url",...void 0!==t?{citationNumber:t}:void 0});d.push((0,v().wmz)(o,e))}}}return d}function S(e,t){const{pageOrBlockId:o,blockId:n}=(0,x().OR)(e,t);return n||o}function $(e){const{blockId:t,spaceId:o,recordMap:n}=e,r=n.getModel({table:h().ev,id:t,spaceId:o});if(!r)throw new Error(`Block not found in record map: ${t}`);return r}const A="file://";function W(e){if(e.source&&(0,U().FS)(e.source))return e.source;if(e.source&&e.source.startsWith(A))try{const t=e.source.slice(A.length),o=decodeURIComponent(t);return JSON.parse(o)}catch(t){}}function O(e){const t=W(e);if(t&&"object"==typeof t&&"permissionRecord"in t)return t.permissionRecord.id}function T(e){let t;const o=W(e.agentBlock);return o&&("string"==typeof o?(e.properties.source=[(0,v().Ey_)(o,[])],e.format.display_source=o):"object"==typeof o&&"permissionRecord"in o&&(e.properties.source=[(0,v().Ey_)(o.source,[])],e.format.display_source=o.source,e.format.copied_from_pointer=o.permissionRecord,t=o.permissionRecord,e.fileIds.push(o.source.split(":")[1]))),{copiedFromPointer:t}}function R(e){const{parentPointer:t,children:o,idCreator:n,legacyNonCrdt:r,actorPointer:i,context:s,recordMap:l,uriContext:a,getNow:d,parseAgentUrlFn:p,preservedBlocksWithUrls:u,warnings:f}=e,h=[],g=[];for(const m of o){const e=L({parentPointer:t,block:m,idCreator:n,legacyNonCrdt:r,actorPointer:i,context:s,recordMap:l,uriContext:a,getNow:d,parseAgentUrlFn:p,preservedBlocksWithUrls:u,warnings:f});if(!c().Q.isSuccess(e))throw e.error;{const{blockId:t,operations:o}=e.value;h.push(t),g.push(...o)}}return g.push({command:"insertChildrenAfter",path:["content"],pointer:t,args:{ids:h}}),g}function z(e){const{parentPointer:t,sectionChildren:o,idCreator:n,legacyNonCrdt:r,actorPointer:i,context:c,recordMap:s,uriContext:l,getNow:a,parseAgentUrlFn:d,warnings:u}=e,f=n.idInSavedSpace(h().ev),{model:g,operations:m}=p().zgg.create({id:f,type:"text",parentPointer:t,alive:!0,created_time:a(),createdBy:i,space_id:t.spaceId,legacyNonCrdt:r}),y=[...m];if(o&&o.length>0){const e=R({parentPointer:{table:h().ev,id:g.id,spaceId:t.spaceId},children:o,idCreator:n,legacyNonCrdt:r,actorPointer:i,context:c,recordMap:s,uriContext:l,getNow:a,parseAgentUrlFn:d,preservedBlocksWithUrls:new Map,warnings:u});y.push(...e)}return{sectionId:g.id,operations:y}}function j(e){const{blockId:t,parentPointer:o,collection:n,inline:r,idCreator:i,actorPointer:c,legacyNonCrdt:s,getNow:l}=e,a=[],d={table:h().ev,id:t,spaceId:o.spaceId},{model:u,operations:f}=p().lqf.create({id:i.idInSavedSpace(m().Gy),parent:d,space_id:o.spaceId,type:"table",format:{collection_pointer:{table:n.table,id:n.id,spaceId:n.spaceId}},created_time:l()});a.push(...f);const{model:g,operations:y}=p().zgg.create({id:d.id,parentPointer:o,space_id:o.spaceId,type:r?"collection_view":"collection_view_page",createdBy:c,created_time:l(),view_ids:[u.id],collection_id:n.id,legacyNonCrdt:s});return a.push(...y),{collectionViewModel:u,blockModel:g,operations:a}}function q(e){const{originalBlockId:t,newChildren:o,spaceId:n,idCreator:r,legacyNonCrdt:i,actorPointer:s,context:l,recordMap:a,uriContext:d,getNow:p,parseAgentUrlFn:u,preservedBlocksWithUrls:f,warnings:g}=e,m=[],y={table:h().ev,id:t,spaceId:n},b=[];for(const h of o){const e=L({parentPointer:y,block:h,idCreator:r,legacyNonCrdt:i,actorPointer:s,context:l,recordMap:a,uriContext:d,getNow:p,parseAgentUrlFn:u,preservedBlocksWithUrls:f,warnings:g});if(!c().Q.isSuccess(e))throw e.error;{const{blockId:t,operations:o}=e.value;b.push(t),m.push(...o)}}const v=($({blockId:t,spaceId:n,recordMap:a}).getContentIds()||[]).filter((e=>!b.includes(e)));for(const c of v)m.push({command:"set",path:["alive"],pointer:{table:h().ev,id:c,spaceId:n},args:!1});return m.push({command:"set",path:["content"],pointer:y,args:b}),m}function L(e){const{parentPointer:t,block:o,idCreator:n,legacyNonCrdt:r,actorPointer:c,context:l,recordMap:a,uriContext:d,getNow:f,parseAgentUrlFn:m,preservedBlocksWithUrls:y,warnings:b}=e;try{const e=[],v=(0,I().Er)(o)?O(o):void 0;if("page"===o.type||"database"===o.type||"unknown"===o.type){let i,s;if(!o.url){if(s=n.idInSavedSpace(h().ev),"page"===o.type){const{model:n,operations:u}=p().zgg.create({id:s,type:"page",space_id:t.spaceId,created_time:f(),createdBy:c,parentPointer:t,alive:!0,properties:{title:N({text:o.text??[],uriContext:d,citationFormat:l.citationFormat,citationCounter:l.citationCounter,recordMap:a,spaceId:t.spaceId,parseAgentUrlFn:m})},legacyNonCrdt:r});e.push(...u),i=n}else{if("database"!==o.type)throw new Error(`Cannot create ${o.type} blocks`);if(o.dataSourceUrl){const l=(0,x().$e)(o.dataSourceUrl),d=a.getModel({table:g().Vl,id:l});if(!d)throw new(w().Yv)("Data source not found: {dataSourceUrl}",{variables:{dataSourceUrl:o.dataSourceUrl}});const p=j({blockId:s,parentPointer:t,collection:d.pointer,inline:Boolean(o.inline),idCreator:n,actorPointer:c,legacyNonCrdt:r,getNow:f});e.push(...p.operations),i=p.blockModel}else{const u={table:h().ev,id:s,spaceId:t.spaceId},{model:y,operations:b}=p().WBy.create({id:n.idInSavedSpace(g().Vl),parent:u,space_id:t.spaceId,name:N({text:o.text??[],uriContext:d,citationFormat:l.citationFormat,citationCounter:l.citationCounter,recordMap:a,spaceId:t.spaceId,parseAgentUrlFn:m}),...o.icon?{icon:o.icon}:{},createdBy:c});e.push(...b);const v=j({blockId:s,parentPointer:t,collection:{table:y.table,id:y.id,spaceId:y.spaceId},inline:Boolean(o.inline),idCreator:n,actorPointer:c,legacyNonCrdt:r,getNow:f});e.push(...v.operations),i=v.blockModel}}return{value:{blockId:s,operations:e}}}{s=S(o.url,d);const l=a.getModel({table:h().ev,id:s,spaceId:t.spaceId});if(!l)throw new Error(`Cannot create database reference: Block ${s} from URL "${o.url}" does not exist in the current space`);if(i=l,!y.has(s)){if("database"===o.type){if(s=n.idInSavedSpace(h().ev),!i.isCollectionView())throw new Error(`Block ${i.id} is not a collection view block (type: ${i.type})`);const l=i.getCollectionPointers();let d;if(l&&l.length>0)d=l[0];else{const e=i.getCollectionViewPointers();if(e&&0!==e.length)for(const t of e){const e=a.getModel(t);if(d=null==e?void 0:e.getCollectionPointer(),d)break}}if(!d)throw new Error(`No collection pointers found for collection view block: ${i.id}`);const p=j({blockId:s,parentPointer:t,collection:d,inline:Boolean(o.inline),idCreator:n,actorPointer:c,legacyNonCrdt:r,getNow:f});e.push(...p.operations),i=p.blockModel}else if("page"===o.type){const o=function(e){const{parentPointer:t,targetBlockId:o,idCreator:n,actorPointer:r,legacyNonCrdt:i,getNow:c}=e,s=[],{model:l,operations:a}=p().zgg.create({id:n.idInSavedSpace(h().ev),type:"alias",parentPointer:t,space_id:t.spaceId,createdBy:r,created_time:c(),alive:!0,format:{alias_pointer:{table:h().ev,id:o,spaceId:t.spaceId}},legacyNonCrdt:i});return s.push(...a),{blockModel:l,operations:s}}({parentPointer:t,targetBlockId:s,idCreator:n,actorPointer:c,legacyNonCrdt:r,getNow:f});e.push(...o.operations),i=o.blockModel,s=o.blockModel.id}return{value:{blockId:s,operations:e}}}}return{value:{blockId:s,operations:e}}}if("synced_block_reference"===o.type){const{pageOrBlockId:i,blockId:s}=(0,x().OR)(o.originalUrl,d),u=s||i;if(!u)throw new Error("synced_block_reference must include a valid originalUrl");const g=n.idInSavedSpace(h().ev),{model:v,operations:k}=p().zgg.create({id:g,type:"transclusion_reference",parentPointer:t,alive:!0,created_time:f(),createdBy:c,space_id:t.spaceId,format:{transclusion_reference_pointer:{id:u,spaceId:t.spaceId,table:"block"}},legacyNonCrdt:r});if(e.push(...k),o.children&&o.children.length>0){const i=q({originalBlockId:u,newChildren:o.children,spaceId:t.spaceId,idCreator:n,legacyNonCrdt:r,actorPointer:c,context:l,recordMap:a,uriContext:d,getNow:f,parseAgentUrlFn:m,preservedBlocksWithUrls:y,warnings:b});e.push(...i)}return{value:{blockId:v.id,operations:e}}}if("synced_block"===o.type&&o.url){const{pageOrBlockId:i,blockId:s}=(0,x().OR)(o.url,d),p=s||i;if(!p)throw new(w().Yv)("invalid synced block url");if(y.has(p)&&a.getModel({table:h().ev,id:p,spaceId:t.spaceId})){if(o.children&&o.children.length>0){const i=q({originalBlockId:p,newChildren:o.children,spaceId:t.spaceId,idCreator:n,legacyNonCrdt:r,actorPointer:c,context:l,recordMap:a,uriContext:d,getNow:f,parseAgentUrlFn:m,preservedBlocksWithUrls:y,warnings:b});e.push(...i)}return{value:{blockId:p,operations:e}}}null==b||b.push({template:"Synced block with URL {url} was not found on the page. If you meant to create a synced block reference, use synced_block_reference tags instead. Falling back to creating a new synced block (which will not be synced with some original block).",variables:{url:o.url}})}else{if("transcription"===o.type){const i=n.idInSavedSpace(h().ev),{model:s,operations:g}=p().zgg.create({id:i,type:"transcription",parentPointer:t,alive:!0,created_time:f(),createdBy:c,space_id:t.spaceId,legacyNonCrdt:r});e.push(...g);const y={table:h().ev,id:s.id,spaceId:t.spaceId};o.text&&e.push(u().op.update({pointer:y,path:["properties"],args:{title:N({text:o.text,uriContext:d,citationFormat:l.citationFormat,citationCounter:l.citationCounter,recordMap:a,spaceId:t.spaceId,parseAgentUrlFn:m})}}));const v={transcription_state:{state:"initial"}},k=[],I=o.summary,_=I&&"children"in I?I.children:void 0,x=_&&_.length>0;if(x){const{sectionId:t,operations:o}=z({parentPointer:y,sectionChildren:_,idCreator:n,legacyNonCrdt:r,actorPointer:c,context:l,recordMap:a,uriContext:d,getNow:f,parseAgentUrlFn:m,warnings:b});e.push(...o),v.transcription_state={state:"idle"},v.transcription_summary_id=t,k.push(t)}const w=o.notes,C=w&&"children"in w?w.children:void 0,{sectionId:U,operations:B}=z({parentPointer:y,sectionChildren:C,idCreator:n,legacyNonCrdt:r,actorPointer:c,context:l,recordMap:a,uriContext:d,getNow:f,parseAgentUrlFn:m,warnings:b});e.push(...B),v.transcription_notes_id=U,k.push(U);const E=o.transcript,M=E&&"children"in E?E.children:void 0;if(x||M&&M.length>0){const{sectionId:t,operations:o}=z({parentPointer:y,sectionChildren:M,idCreator:n,legacyNonCrdt:r,actorPointer:c,context:l,recordMap:a,uriContext:d,getNow:f,parseAgentUrlFn:m,warnings:b});e.push(...o),v.transcription_transcript_id=t,k.push(t)}return e.push({command:"update",path:["format"],pointer:y,args:v}),e.push({command:"set",path:["content"],pointer:y,args:k}),{value:{blockId:s.id,operations:e}}}if(v&&y.has(v)){if(!a.getModel({table:h().ev,id:v,spaceId:t.spaceId}))throw new Error(`Media block ${v} does not exist in the current space`);return{value:{blockId:v,operations:e}}}}const k=n.idInSavedSpace(h().ev),{type:_,format:C,properties:E,fileIds:M,copiedFromPointer:P}=function(e){const{blockId:t,parentId:o,agentBlock:n,context:r,uriContext:c,parseAgentUrlFn:l,spaceId:a,recordMap:d}=e,p=(0,U().CU)(n),u={},f={};let h;const g=[];if("callout"===n.type)(0,s().O9)(n.icon)&&(u.page_icon=n.icon),u.callout_version=2;else if("to_do"===n.type)(0,s().O9)(n.checked)&&(f.checked=n.checked?[["Yes"]]:[["No"]]);else if("code"===n.type)(0,s().O9)(n.language)&&(f.language=[[n.language]]);else if("numbered_list"===n.type)(0,s().O9)(n.list_format)&&(u.list_format=n.list_format);else if("h1"===n.type||"h2"===n.type||"h3"===n.type||"h4"===n.type)u.toggleable=n.toggleable??!1;else if("table"===n.type){var m,y;const e=null===(m=n.rows)||void 0===m?void 0:m[0],o=(null==e||null===(y=e.cells)||void 0===y?void 0:y.length)||0,c=Array.from({length:o},((e,o)=>(0,i()._g)(`${t}-${o}`)));if(u.table_block_column_order=c,r.setTableColumns(t,c),u.table_block_column_header=n.headerRow,u.table_block_row_header=n.headerColumn,u.block_full_width=n.fitPageWidth,n.columnStyles&&n.columnStyles.length>0){const e={};for(let t=0;t<c.length&&t<n.columnStyles.length;t++){const o=n.columnStyles[t],r={};if(o.color){const e=(0,I().Ah)(o.color);e&&(r.color=e)}o.width&&(r.width=o.width),Object.keys(r).length>0&&(e[c[t]]=r)}Object.keys(e).length>0&&(u.table_block_column_format=e)}}else if("edit_reference"===n.type){if(n.editReferenceData){const{variableNames:e,editRefNumber:t}=n.editReferenceData;u.edit_reference={variableNames:e,editRefNumber:t}}}else if("table_row"===n.type){if((0,s().O9)(n.cells)){const e=r.getTableColumns(o);for(let t=0;t<e.length;t++){const o=e[t],i=t<n.cells.length?n.cells[t]:{text:[]};if(o){const e=N({text:i.text||[],uriContext:c,citationFormat:r.citationFormat,citationCounter:r.citationCounter,recordMap:d,spaceId:a,parseAgentUrlFn:l});if(f[o]=r.simpleBulletsEnabled?B(e):e,i.color){const e=(0,I().Ah)(i.color);e&&(u.cell_format||(u.cell_format={}),u.cell_format[o]={color:e})}}}}(0,s().O9)(n.color)&&(u.block_color=(0,I().Ah)(n.color))}else(0,I().Er)(n)?(h=T({agentBlock:n,properties:f,format:u,fileIds:g}).copiedFromPointer,n.text&&(f.caption=N({text:n.text,uriContext:c,citationFormat:r.citationFormat,citationCounter:r.citationCounter,recordMap:d,spaceId:a,parseAgentUrlFn:l}))):"text"===n.type||"bulleted_list"===n.type||"toggle"===n.type||"column"===n.type||"column_list"===n.type||"tab"===n.type||"quote"===n.type||"equation"===n.type||"divider"===n.type||"table_of_contents"===n.type||"synced_block"===n.type||"ai_block"===n.type||"mail"===n.type||(0,s().HB)(n);return{type:p,format:u,properties:f,copiedFromPointer:h,fileIds:g}}({blockId:k,parentId:t.id,agentBlock:o,context:l,uriContext:d,recordMap:a,parseAgentUrlFn:m,spaceId:t.spaceId}),F={id:k,type:_,parentPointer:t,alive:!0,created_time:f(),createdBy:c,space_id:t.spaceId,file_ids:M,copied_from:(null==P?void 0:P.table)===h().ev?P.id:void 0,properties:{..."text"in o&&o.text&&!(0,I().Er)(o)?{title:N({text:o.text,uriContext:d,citationFormat:l.citationFormat,citationCounter:l.citationCounter,recordMap:a,spaceId:t.spaceId,parseAgentUrlFn:m,skipUrlProcessing:"code"===o.type})}:{},...E},format:{..."color"in o&&o.color?{block_color:(0,I().Ah)(o.color)}:{},...C},legacyNonCrdt:r},{model:$,operations:A}=p().zgg.create(F);e.push(...A);const W={table:h().ev,id:$.id,spaceId:t.spaceId};if("children"in o&&o.children&&o.children.length>0){const t=R({parentPointer:W,children:o.children,idCreator:n,legacyNonCrdt:r,actorPointer:c,context:l,recordMap:a,uriContext:d,getNow:f,parseAgentUrlFn:m,preservedBlocksWithUrls:y,warnings:b});e.push(...t)}else if("table"===o.type&&o.rows&&o.rows.length>0){const t=R({parentPointer:W,children:o.rows,idCreator:n,legacyNonCrdt:r,actorPointer:c,context:l,recordMap:a,uriContext:d,getNow:f,parseAgentUrlFn:m,preservedBlocksWithUrls:y,warnings:b});e.push(...t)}return{value:{blockId:$.id,operations:e}}}catch(v){return console.error(v),v instanceof w().Yv?{error:v}:{error:new(w().Yv)("Failed to create block")}}}function X(e){const{parentPointer:t,blockIds:o,beforeBlockId:n,afterBlockId:r}=e;return n?{command:"insertChildrenBefore",path:["content"],pointer:t,args:{ids:o,before:n}}:{command:"insertChildrenAfter",path:["content"],pointer:t,args:{ids:o,after:r}}}function D(e){const t={...e,id:(0,r().Ay)()};return"table_row"===e.type?{...t,type:"table_row",cells:e.cells}:"table"===e.type?{...t,type:"table",rows:e.rows.map((e=>D(e)))}:"children"in e&&e.children&&e.children.length>0?{...t,children:e.children.map(D)}:t}function V(e){const{block:t,update:o,recordMap:n,uriContext:r}=e;if("replace"!==o.action&&"replace-block"!==o.action)return;const i="replace-block"===o.action?o.block:o.blocks[0];if(t.isTranscriptionBlock()&&"transcription"===i.type){var c,s;const[,,e]=(0,C()._5)({recordMap:n,spaceId:t.getSpaceId(),baseUrl:r.baseUrl,pageId:t.id}),o="text"===(null==e?void 0:e.type)&&e.children||[],a=(0,l().TF)({blocks:o,skipTranscriptionTranscript:!1}).map((e=>e.content)).join("\n").trim(),d="text"===(null===(c=i.transcript)||void 0===c?void 0:c.type)&&(null===(s=i.transcript)||void 0===s?void 0:s.children)||[],p=(0,l().TF)({blocks:d.map(D),skipTranscriptionTranscript:!1}).map((e=>e.content)).join("\n").trim();if(a!==p)throw new(w().Yv)("Editing transcripts via AI is disabled to preserve the original conversation. Users can manually edit the transcript.")}const a=n.getModel(t.getParentPointer());if(!a||a.table!==h().ev)return;const d=n.getModel(a.getParentPointer());if(d&&d.table===h().ev&&d.isTranscriptionBlock()){const e=d.getFormat().transcription_transcript_id;if(e&&e===a.id)throw new(w().Yv)("Editing transcripts via AI is disabled to preserve the original conversation. Users can manually edit the transcript.")}}function Y(e){const{agentBlock:t,uriContext:o,onBlockWithUrl:n}=e;if("url"in t&&t.url){const e=function(e,t){try{return S(e,t)}catch(o){return}}(t.url,o);e&&n(e,t)}else if((0,I().Er)(t)){const e=O(t);e&&n(e,t)}else if("children"in t&&t.children)for(const r of t.children)Y({agentBlock:r,uriContext:o,onBlockWithUrl:n})}function Z(e){const{recordMap:t,updates:o,spaceId:n,legacyNonCrdt:r,actorPointer:i,idCreator:l,pageId:a,uriContext:d,options:p,parseAgentUrlFn:u=x().X1,agentBlocksOnPage:f,warnings:g=[],suppressErrors:m=!1}=e,y={citationFormat:(null==p?void 0:p.citationFormat)??"link",simpleBulletsEnabled:(null==p?void 0:p.simpleBulletsEnabled)??!1},b=[],v=e.getNow??Date.now,k={},I={setTableColumns:(e,t)=>{k[e]=t},getTableColumns:e=>{var o;if(k[e])return k[e];const r=$({blockId:e,spaceId:n,recordMap:t});if("table"!==r.type)throw new Error(`Try to get column definition for a non-table block: ${e}`);return(null===(o=r.getFormat())||void 0===o?void 0:o.table_block_column_order)||[]},citationFormat:y.citationFormat,citationCounter:{current:0,hrefToNumber:{}},simpleBulletsEnabled:y.simpleBulletsEnabled??!1},_=new Map;for(const c of f??[])Y({agentBlock:c,uriContext:d,onBlockWithUrl:(e,t)=>{"id"in t&&e===t.id&&_.set(e,t)}});const w=new Map;for(const c of o)if("insert"===c.action||"replace"===c.action)for(const e of c.blocks)Y({agentBlock:e,uriContext:d,onBlockWithUrl:(e,t)=>{_.has(e)&&w.set(e,t)}});for(const x of o)if("delete"===x.action){const e=$({blockId:x.blockId,spaceId:n,recordMap:t}),o=w.get(x.blockId);if(o){if("database"===o.type){const t=K(o.inline??!1),r=J(x.blockId,n,e.type,t);r&&b.push(r)}continue}b.push({command:"set",path:["alive"],pointer:{table:h().ev,id:x.blockId,spaceId:n},args:!1}),b.push({command:"listRemove",path:["content"],pointer:{table:h().ev,id:e.parent_id,spaceId:n},args:{id:x.blockId}})}else if("replace"===x.action){const e=x.blockId,o=$({blockId:e,spaceId:n,recordMap:t});V({block:o,update:x,recordMap:t,uriContext:d});const s=t.getModel({table:h().ev,id:o.parent_id,spaceId:n}),a=(null==s?void 0:s.getContentIds())||[],p=a.indexOf(e);if("transclusion_container"===o.type&&1===x.blocks.length&&"synced_block"===x.blocks[0].type){var C;const s={table:h().ev,id:e,spaceId:n},a=x.blocks[0].children&&x.blocks[0].children.length>0?Q(x.blocks[0].children):[],p=[];for(const e of a){const o=L({parentPointer:s,block:e,idCreator:l,legacyNonCrdt:r,actorPointer:i,context:I,recordMap:t,uriContext:d,getNow:v,parseAgentUrlFn:u,preservedBlocksWithUrls:w,warnings:g});if(c().Q.isSuccess(o)){const{blockId:e,operations:t}=o.value;p.push(e),b.push(...t)}else if(!m)throw o.error}const f=((null===(C=o.getContentIds)||void 0===C?void 0:C.call(o))??[]).filter((e=>!p.includes(e)));for(const e of f)b.push({command:"set",path:["alive"],pointer:{table:h().ev,id:e,spaceId:n},args:!1});b.push({command:"set",path:["content"],pointer:s,args:p});continue}if(G(o.type)&&1===x.blocks.length&&"database"===x.blocks[0].type){const t=x.blocks[0];if("inline"in t&&void 0!==t.inline){const r=K(t.inline),i=J(e,n,o.type,r);i&&b.push(i);continue}}const f={table:h().ev,id:o.parent_id,spaceId:n},y=Q(x.blocks),k=[],_=[];for(const n of y){const e=L({parentPointer:f,block:n,idCreator:l,legacyNonCrdt:r,actorPointer:i,context:I,recordMap:t,uriContext:d,getNow:v,parseAgentUrlFn:u,preservedBlocksWithUrls:w,warnings:g});if(c().Q.isSuccess(e)){const{blockId:t,operations:o}=e.value;_.push(...o),k.push(t)}else if(!m)throw e.error}if(k.length>0){let e,t;p<a.length-1?e=a[p+1]:t=x.blockId,_.push(X({parentPointer:f,blockIds:k,beforeBlockId:e,afterBlockId:t}))}k.includes(e)||w.has(e)||(b.push({command:"set",path:["alive"],pointer:{table:h().ev,id:e,spaceId:n},args:!1}),b.push({command:"listRemove",path:["content"],pointer:{table:h().ev,id:o.parent_id,spaceId:n},args:{id:e}})),b.push(..._)}else if("insert"===x.action){const e=H({pageId:a,beforeBlockId:x.beforeBlockId,afterBlockId:x.afterBlockId,insideBlockId:x.insideBlockId,spaceId:n,recordMap:t,uriContext:d}),o=Q(x.blocks).map((o=>{const n=L({parentPointer:e,block:o,idCreator:l,legacyNonCrdt:r,actorPointer:i,context:I,recordMap:t,uriContext:d,getNow:v,parseAgentUrlFn:u,preservedBlocksWithUrls:w,warnings:g});if(c().Q.isSuccess(n)){const{blockId:e,operations:t}=n.value;return b.push(...t),e}if(!m)throw n.error})).filter(s().O9);b.push(X({parentPointer:e,blockIds:o,beforeBlockId:x.beforeBlockId,afterBlockId:x.afterBlockId}))}else if("replace-block"===x.action){const e=$({blockId:x.blockId,spaceId:n,recordMap:t});V({block:e,update:x,recordMap:t,uriContext:d});const o=P({existingBlock:e,block:x.block,context:I,recordMap:t,uriContext:d,spaceId:n,actorPointer:i,getNow:v,parseAgentUrlFn:u});b.push(...o)}else(0,s().HB)(x);if(b.length>0){const e=t.getModel({table:h().ev,id:a,spaceId:n});e&&b.push(...e.ops.updateLastEdited({author:i,timestamp:v()}))}return b}function H(e){const{pageId:t,beforeBlockId:o,afterBlockId:n,insideBlockId:r,spaceId:i,recordMap:c}=e;if(o){const e=$({blockId:o,spaceId:i,recordMap:c});return{table:h().ev,id:e.parent_id,spaceId:i}}if(n){const e=$({blockId:n,spaceId:i,recordMap:c});return{table:h().ev,id:e.parent_id,spaceId:i}}return r?{table:h().ev,id:r,spaceId:i}:{table:h().ev,id:t,spaceId:i}}function Q(e){return e.flatMap((e=>("h1"===e.type||"h2"===e.type||"h3"===e.type||"h4"===e.type)&&!e.toggleable&&e.children&&e.children.length>0?[{...e,children:void 0},...Q(e.children)]:"children"in e&&e.children&&e.children.length>0?[{...e,children:Q(e.children)}]:[e]))}function G(e){return"collection_view"===e||"collection_view_page"===e}function K(e){return e?"collection_view":"collection_view_page"}function J(e,t,o,n){return o===n?null:{command:"update",path:[],pointer:{table:h().ev,id:e,spaceId:t},args:{type:n}}}},63606:(e,t,o)=>{o.d(t,{v4:()=>x});o(898992),o(354520),o(581454);var n=()=>o(726637),r=()=>o(295633),i=()=>o(732810),c=()=>o(569797),s=()=>o(933528),l=()=>o(651784),a=()=>o(179034),d=()=>o(519831),p=()=>o(869558),u=()=>o(201980),f=()=>o(716500),h=()=>o(492414),g=()=>o(786702),m=()=>o(295304);function y(e,t,o){if(!e.startsWith("collection://"))return;const n=e.split("collection://")[1];if(!n)return;const r=i().m.createChildStore(t,{id:n,table:d().Vl,spaceId:t.getSpaceId()}).getParentBlockStore();return r||void 0}function b(e,t,o){const n=y(e,t);if(n)return(0,u().X$)({type:"block",href:(0,h().Ef)({environment:o,updates:{store:n}}),blockId:n.id})}function v(e,t,o){if(!e.startsWith("view://"))return;const n=e.split("view://")[1];if(!n)return;const r=c().p.createChildStore(t,{id:n,table:p().Gy,spaceId:t.getSpaceId()}).getParentBlockStore();return r?(0,u().X$)({type:"block",href:(0,h().Ef)({environment:o,updates:{store:r}}),blockId:r.id,collectionViewId:n}):void 0}function k(e,t,o){var n;if(!e.startsWith("formulaResult://"))return;const i=null===(n=e.split("formulaResult://")[1])||void 0===n?void 0:n.split("/");if(!i||i.length<2)return;const c=i[1];if(!c)return;const s=r().B.createChildStore(t,{id:c,table:a().ev,spaceId:t.getSpaceId()});return(0,u().X$)({type:"block",href:(0,h().Ef)({environment:o,updates:{store:s}}),blockId:c})}function I(e,t,o){const n=y(e,t);if(!n)return;return(0,u().ld4)(n.id,void 0)}function _(e,t){if(!e.startsWith("view://"))return;const o=e.split("view://")[1];if(!o)return;const n=c().p.createChildStore(t,{id:o,table:p().Gy,spaceId:t.getSpaceId()}).getParentBlockStore();if(!n)return;return(0,u().ld4)(n.id,void 0)}function x(e,t,o,i){for(const c of e){const e=c.getTitleStore(),d=null==e?void 0:e.getValue();if(e&&d){const p=(0,u().RQ)(d).map((e=>{const o=e[1];if(!o)return e;const d=(0,u().VtW)(o),p=null==d?void 0:d[1];if(null!=p&&p.startsWith("collection://")){const e=I(p,c);if(e)return(0,u().wmz)(e,[...(o??[]).filter((e=>!(0,u().sh$)(e)))])}if(null!=p&&p.startsWith("view://")){const e=_(p,c);if(e)return(0,u().wmz)(e,[...(o??[]).filter((e=>!(0,u().sh$)(e)))])}const m=(0,u().g2K)(o),y=null==m?void 0:m[1];let x;if("url"===(null==y?void 0:y.type)){const o=b(y.href,c,t);if(o){const t=(0,u().Ey_)(e[0],[...(e[1]??[]).filter((e=>!(0,u().bZo)(e))),o]);return t}const d=v(y.href,c,t);if(d){const t=(0,u().Ey_)(e[0],[...(e[1]??[]).filter((e=>!(0,u().bZo)(e))),d]);return t}const p=k(y.href,c,t);if(p){const t=(0,u().Ey_)(e[0],[...(e[1]??[]).filter((e=>!(0,u().bZo)(e))),p]);return t}const m=(0,g().w)(y.href);if(m){const o=r().B.createChildStore(c,{id:m,table:a().ev,spaceId:c.getSpaceId()}),i=(0,l().parseRoute)({url:y.href,isMobile:n().A.isMobile,baseUrl:n().A.domainBaseUrl,publicDomainName:n().A.publicDomainName,protocol:void 0,currentUrl:void 0}),s="page"===i.name?i.discussionId:void 0,d="page"===i.name?i.scrollToBlockId:void 0,p="page"===i.name?i.snapshotTimestamp:void 0,f=(0,h().Ef)({environment:t,updates:{store:o}}),g=(0,u().Ey_)(e[0],[...(e[1]??[]).filter((e=>!(0,u().bZo)(e))),(0,u().X$)({type:"block",href:f,blockId:m,...s?{discussionId:s}:{},...d?{scrollToBlockId:d}:{},...p?{snapshotTimestamp:p}:{}})]);return g}if(y.href.startsWith("discussion://"))return;const I=null==i?void 0:i[y.href];if(!I)return e;const _=(0,s().f9)(I.id);if(_)if("block"===_.type)x=(0,u().X$)({type:"block",href:y.href,blockId:_.blockId});else if("helpdoc"===_.type)x=(0,u().X$)({type:"helpdoc",href:y.href,url:_.url});else if("webpage"===_.type)x=(0,u().X$)({type:"webpage",href:y.href,url:_.url});else if("helpdoc-section"===_.type)x=(0,u().X$)({type:"helpdoc-section",href:y.href,url:_.url,parentPageHref:_.parentPageHref});else if("citation_unsupported"===_.type)x=void 0;else if("database_query_results"===_.type)x=void 0;else{x=(0,f().K)(_.type).getCitationAnnotationFromParsedHref({parsedData:_,href:y.href})}}return x?(0,u().Ey_)(e[0],[...(e[1]??[]).filter((e=>!(0,u().bZo)(e))),x]):e})).filter((e=>void 0!==e));m().R9({environment:t,store:e,value:p,transaction:o})}const p=c.getContentStores();p.length>0&&x(p,t,o,i)}}},145480:(e,t,o)=>{o.d(t,{W:()=>n});const n=["toggle","column","column_list","callout","page","database","table_of_contents","transcription","synced_block","synced_block_reference","ai_block","image","pdf","file","audio","video"]},663760:(e,t,o)=>{o.d(t,{FQ:()=>F,VT:()=>_,hM:()=>I});o(16280),o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(823215),o(354520),o(803949),o(581454),o(908872),o(737550);var n=()=>o(534177),r=()=>o(816750),i=()=>o(89463),c=()=>o(979004),s=()=>o(265282);const l=new Set(["toggle","column","column_list","callout","quote","page","database","equation","table_of_contents","divider","transcription","synced_block","synced_block_reference","ai_block","image","pdf","file","audio","video","table"]);const a=new Set,d=Object.values(c().fileExtensionToCodeLanguageMap).reduce(((e,t)=>(e[t.toLowerCase()]=t,e)),{}),p="[A-Za-z][\\w-]*",u=/\{color="([^"]+)"}?/,f="/>",h=" \t            　";function g(e,t){const o=e.match(u),n=!(null!=t&&t.preserveWhitespace);if(!o)return{text:n?e.trim():e};const r=e.replace(u,"").trimEnd();return{text:n?r.trim():r,color:o[1]}}function m(e){let t=0;for(;t<e.length&&(o=e[t],h.includes(o));)t++;var o;return t}function y(e=""){const t={},o=/([A-Za-z_-]+)="(.*?)"/g;let n;for(;n=o.exec(e);)t[n[1]]=n[2];return t}function b(e){for(const t of Object.keys(e))void 0===e[t]&&delete e[t];return e}function v(e,t,o,n){return[b(e),t,o,n]}function k(e){let t=1/0;for(const o of e)o.trim()&&(t=Math.min(t,m(o)));return isFinite(t)||(t=0),e.map((e=>e.slice(t))).join("\n")}function I(e,t){return _(e,(()=>!0),t).blocks}function _(e,t,o){const n=null!=o&&o.omitBlockTypes&&o.omitBlockTypes.length>0?new Set(o.omitBlockTypes):a,r=function(e){const t=e.split(/\r?\n/);let o=!1;const n=[];for(const r of t)r.trim().startsWith("```")?(o=!o,n.push(r)):(o||""!==r.trim())&&n.push(r);return n.join("\n")}(e.replace(/\[\^\s+/g,"[^")),i=r.split("\n");1===i.length&&""===i[0]&&i.pop();const[c,s,l,d]=x(i,0,0,t,n,!1,{count:0});return{blocks:c,unsafeUrls:l,missingContent:d}}function x(e,t,o,r,i=a,c=!1,s){const d=[];let p=t;const u=[],f=[];for(;p<e.length;){if(m(e[p])<o)break;const[t,c,a,g]=w(e,p,r,i,s);f.push(...g),u.push(...a),i.size>0&&(h=t.type,(0,n().y$)(l,h))&&i.has(t.type)?p=c:(d.push(t),p=c)}var h;return c&&p<e.length&&f.push(...e.slice(p,e.length)),[d,p,u,f]}function w(e,t,o,i=a,l){const u=e[t],f=m(u),h=u.trim();{const n=h.match(/^▶(#{1,4})\s+(.*)$/);if(n){const r=n[1].length,c=g(n[2]),[s,a,d,p]=C(e,t+1,f,o,i,l),u={text:F(c.text),color:c.color,toggleable:!0,children:s};return v(1===r?{type:"h1",...u}:2===r?{type:"h2",...u}:3===r?{type:"h3",...u}:{type:"h4",...u},a,d,p)}}{const n=h.match(/^▶(?:\s+(.*))?$/);if(n){const r=g(n[1]??""),[c,s,a,d]=C(e,t+1,f,o,i,l);return v({type:"toggle",text:r.text?F(r.text):void 0,color:r.color,children:c},s,a,d)}}{const e=h.match(new RegExp(`^<(${p})([^>]*)/>$`));if(e){const o=e[1],n=y(e[2]);switch(o){case"empty-block":return v({type:"text"},t+1,[],[]);case"table_of_contents":return v({type:"table_of_contents",color:n.color},t+1,[],[]);case"unknown":return v({type:"unknown",url:n.url??"",alt:n.alt},t+1,[],[])}}}{const n=h.match(new RegExp(`^<(${p})([^>]*)>([\\s\\S]*?)<\\/\\1>(.*)$`));if(n){const i=n[1],c=y(n[2]),s=g(n[3]),l=n[4].trim(),a=s.text||"callout"===i?F(s.text):void 0,d=c.color??s.color;switch(i){case"callout":const n=s.text?[{type:"text",text:a}]:void 0;return v({type:"callout",icon:(0,r().Ew)(c.icon),color:d,children:n},t+1,[],[]);case"page":return v({type:"page",url:c.url,text:a,color:d},t+1,[],[]);case"database":return v({type:"database",url:c.url,inline:"true"===c.inline,...c["data-source-url"]?{dataSourceUrl:c["data-source-url"]}:{},...void 0!==c.icon?{icon:(0,r().Ew)(c.icon)}:{},text:a,color:d},t+1,[],[]);case"audio":case"image":case"video":case"file":case"pdf":return l&&e.splice(t+1,0,l),v({type:i,...c.source&&{source:c.source},text:a,color:d},t+1,c.source&&o&&!o(c.source)?[c.source]:[],[])}}}{const n=h.match(new RegExp(`^<(${p})([^>]*)>$`));if(n){const c=n[1],a=y(n[2]),d=a.color,p=(0,r().Ew)(a.icon);let u=t+1,h=1;for(;u<e.length&&h>0;){const t=e[u].trim();if(t===`<${c}>`||t.match(new RegExp(`^<${c}\\s+[^>]*>$`)))h++;else if(t.startsWith(`</${c}`)&&(h--,0===h))break;u++}const m=e.slice(t+1,u),[b,k,I,_]=x(m,0,f,o,i,!0,l),w=b.length?b:void 0;switch(c){case"callout":return v({type:"callout",icon:p,color:d,children:w},u+1,I,_);case"columns":return v({type:"column_list",children:w},u+1,I,_);case"tabs":return v({type:"tab",children:w},u+1,I,_);case"column":return v({type:"column",children:w},u+1,I,_);case"tab":{const e=m.findIndex((e=>""!==e.trim())),t=g(e>=0?m[e].trim():""),n=e>=0?m.slice(e+1):[],[r,c,s,a]=x(n,0,f,o,i,!0,l);return v({type:"text",text:t.text?F(t.text):void 0,color:t.color,children:r.length>0?r:void 0},u+1,s,a)}case"synced_block":return v({type:"synced_block",url:a.url,children:w},u+1,I,_);case"synced_block_reference":if(!a.url)throw new Error("Synced block reference must include a valid url");return v({type:"synced_block_reference",originalUrl:a.url,children:w},u+1,I,_);case"edit_reference":{const e=function(e,t){if(!e.variableNames)return;const o=e.variableNames.split(",").map((e=>e.trim())).filter((e=>e.length>0));if(0===o.length)return;return{editReferenceData:{variableNames:o,editRefNumber:t?++t.count:0}}}(a,l);return e?v({type:"edit_reference",editReferenceData:e.editReferenceData,children:w},u+1,I,_):w&&w.length>0?v(w[0],u+1,I,_):v({type:"text",text:[]},u+1,I,_)}case"table":const n=[];let r,h=0;const b="true"===a["fit-page-width"]||"false"!==a["fit-page-width"]&&void 0,k="true"===a["header-row"]||"false"!==a["header-row"]&&void 0,C="true"===a["header-column"]||"false"!==a["header-column"]&&void 0;if(h<m.length){if(m[h].trim().startsWith("<colgroup>")){let e=h;for(;e<m.length&&!m[e].trim().includes("</colgroup>")&&!m[e].trim().startsWith("<tr");)e++;const t=[];for(let o=h+1;o<e;o++){const e=m[o].trim().match(/<col(?:\s+([^>]*?))?(?:>|$)/);if(e){const o={};if(e[1]){const t=y(e[1]);if(o.color=(0,s().Fi)(t.color)?t.color:void 0,t.width){const e=parseFloat(t.width);!isNaN(e)&&e>0&&(o.width=e)}}t.push(o)}}t.length>0&&(r=t),h=e<m.length&&m[e].trim().includes("</colgroup>")?e+1:e}}for(;h<m.length;){const e=m[h].trim();if(e.startsWith("<tr>")||e.startsWith("<tr ")){let t=h+1,o=!1;for(;t<m.length;){const e=m[t].trim();if(e.includes("</tr>")){o=!0;break}if(e.startsWith("<tr")||e.startsWith("</table")){t--;break}t++}const r=e.match(/<tr(?:\s+([^>]*))?>/);let i;if(r&&r[1]){const e=y(r[1]);e.color&&(0,s().Fi)(e.color)&&(i=e.color)}const c=t+1,l=m.slice(h,c).join("\n"),a=[];let d=l.indexOf("<",l.indexOf(">"));for(;-1!==d&&d<l.length;){const e=l.slice(d).match(/^<(th|td)(?:\s+([^>]*?))?(?:>|$)/);if(!e){d=l.indexOf("<",d+1);continue}const t=e[1],o=e[2]||"",n=d+e[0].length;let r=n;const i=`</${t}>`,c=l.indexOf(i,n);let p=l.length;const u=l.slice(n).match(/<(?:th|td|\/tr|tr)[\s>]/);if(u&&(p=n+u.index),-1!==c&&c<p)r=c,d=c+i.length;else if(r=p,d=p,u){const e=l.slice(p).match(/^<(\w+)/);e&&"tr"===e[1]&&(d=l.length)}const f=l.slice(n,r).trim(),h=F(f),g=0===h.length&&""===f?[""]:h;let m;if(o){const e=y(o);e.color&&(0,s().Fi)(e.color)&&(m=e.color)}const b={text:g};m&&(b.color=m),a.push(b)}if(a.length>0){const e={type:"table_row",cells:a};i&&(e.color=i),n.push(e)}h=o?t+1:t}else h++}if(n.length>0){const e={type:"table",rows:n};if(r&&r.length>0){const t=Math.max(...n.map((e=>e.cells.length))),o=[...r];for(;o.length<t;)o.push({});e.columnStyles=o}return void 0!==k&&(e.headerRow=k),void 0!==C&&(e.headerColumn=C),void 0!==b&&(e.fitPageWidth=b),v(e,u+1,[],[])}return v({type:"text",text:[`<${c}>`],children:w},u+1,[],[]);case"meeting-notes":const U={type:"transcription"};let B=t+1;const E=[];for(;B<u;){const t=e[B].trim();if("<summary>"===t||"<notes>"===t||"<transcript>"===t)break;E.push(e[B]),B++}if(E.length>0){const e=E.join("\n");U.text=F(e.trim())}const M=[],P=[];for(;B<u;){const t=e[B].trim();if("<summary>"!==t)if("<notes>"!==t)if("<transcript>"!==t)B++;else{let t=B+1;for(;t<u&&!e[t].trim().startsWith("</transcript>");)t++;const n=e.slice(B+1,t),r=n.some((e=>""!==e.trim()));if(r){const[e,t,r,c]=x(n,0,f+1,o,i,!0,l);M.push(...r),P.push(...c),e.length&&(U.transcript={type:"text",children:e})}B=t+1}else{let t=B+1;for(;t<u&&!e[t].trim().startsWith("</notes>");)t++;const n=e.slice(B+1,t),r=n.some((e=>""!==e.trim()));if(r){const[e,t,r,c]=x(n,0,f+1,o,i,!0,l);M.push(...r),P.push(...c),e.length&&(U.notes={type:"text",children:e})}B=t+1}else{let t=B+1;for(;t<u&&!e[t].trim().startsWith("</summary>");)t++;const n=e.slice(B+1,t),r=n.some((e=>""!==e.trim()));if(r){const[e,t,r,c]=x(n,0,f+1,o,i,!0,l);M.push(...r),P.push(...c),e.length&&(U.summary={type:"text",children:e})}B=t+1}}return v(U,u+1,M,P)}}}if(h.startsWith("```")){let o=h.slice(3).trim()||void 0;"plaintext"!==o&&"text"!==o||(o="plain text");let r=t+1;const i=[];for(;r<e.length&&!e[r].trim().startsWith("```");)i.push(e[r]),r++;let s;return"string"==typeof o&&((0,n().O)(c().fileExtensionToCodeLanguageMap,o)?s=c().fileExtensionToCodeLanguageMap[o]:(0,n().O)(d,o.toLowerCase())&&(s=d[o.toLowerCase()])),v({type:"code",language:s,text:[k(i)]},r+1,[],[])}if("$$"===h){let o=t+1;const n=[];for(;o<e.length&&"$$"!==e[o].trim();)n.push(e[o]),o++;return v({type:"equation",text:[k(n)]},o+1,[],[])}if(h.startsWith("|")){const o=[];let n=t;for(;n<e.length&&e[n].trim().startsWith("|");)o.push({type:"table_row",cells:S(e[n])}),n++;let r=!1;return o.length>=2&&o[1].cells.every((e=>{var t;return 1===(null===(t=e.text)||void 0===t?void 0:t.length)&&"string"==typeof e.text[0]&&/^-+$/.test(e.text[0])}))&&(o.splice(1,1),r=!0),v({type:"table",rows:o,...r&&{headerRow:!0}},n,[],[])}if(/^(?:-{3,}|\*{3,}|_{3,})$/.test(h))return v({type:"divider"},t+1,[],[]);{const e=h.match(/^!\[(.*?)\]\((\S+)(?:\s+"[^"]*")?\)$/);if(e){const n=e[1],r=e[2];return v({type:"image",source:r,text:n?F(g(n).text):void 0},t+1,o&&!o(r)?[r]:[],[])}}{const e=h.match(/^(#{1,6})\s+(.*)$/);if(e){const o=e[1].length,n=Math.min(o,4),r=g(e[2]);return v(1===n?{type:"h1",text:F(r.text),color:r.color}:2===n?{type:"h2",text:F(r.text),color:r.color}:3===n?{type:"h3",text:F(r.text),color:r.color}:{type:"h4",text:F(r.text),color:r.color},t+1,[],[])}}{const n=h.match(/^>\s*(.*)$/);if(n){const r=g(n[1]??"");let c=[],s=t+1;const a=[],d=[];if(t+1<e.length&&m(e[t+1])>f){const n=x(e,t+1,f+1,o,i,!1,l);c=n[0],s=n[1],a.push(...n[2]),d.push(...n[3])}return v({type:"quote",text:r.text?F(r.text):void 0,children:c.length?c:void 0,color:r.color},s,a,d)}}{const n=h.match(/^((?:-\s+)?- \[([ xX]?)\])(?:\s+(.*))?$/);if(n){const r="x"===n[2].toLowerCase(),c=n[1].length,s=f+c,a=g(h.slice(c)),[d,p,u,m]=U(e,t,s,f,o,i,l);return v({type:"to_do",checked:r,text:d.text,children:d.children,color:a.color},p,u,m)}}{const n=h.match(/^([-–—+*•])(?:\s+(.*))?$/);if(n){const r=n[1].length,c=f+r,s=g(h.slice(r)),[a,d,p,u]=U(e,t,c,f,o,i,l);return v({type:"bulleted_list",text:a.text,children:a.children,color:s.color},d,p,u)}}{const n=h.match(/^(\d+\.)(?:\s+(.*))?$/);if(n){const r=n[1].length,c=f+r,s=g(h.slice(r)),[a,d,p,u]=U(e,t,c,f,o,i,l);return v({type:"numbered_list",text:a.text,children:a.children,color:s.color},d,p,u)}}const b=g(u.slice(f),{preserveWhitespace:!0}),[I,_,w,B]=C(e,t+1,f,o,i,l);return v({type:"text",text:F(b.text),color:b.color,children:I},_,w,B)}function C(e,t,o,n,r=a,i){if(t>=e.length)return[void 0,t,[],[]];if(m(e[t])<=o)return[void 0,t,[],[]];const[c,s,l,d]=x(e,t,o+1,n,r,!1,i);return[c.length?c:void 0,s,l,d]}function U(e,t,o,n,r,i=a,c){const s=e[t].slice(o),l=[`${"\t".repeat(n)}${s}`,...e.slice(t+1)],d=[],[p,u,f,h]=C(l,0,n,r,i,c);d.push(...h);const g=0===u?t+1:t+u;if(p&&p.length>0&&"text"===p[0].type){const e=[...p[0].children??[],...p.slice(1)??[]];return[{text:p[0].text,children:e.length>0?e:void 0},g,f,d]}return[{children:p&&p.length>0?p:void 0},g,f,d]}function B(e){return!!e&&/[a-zA-Z0-9]/.test(e)}function E(e){return void 0!==e&&/\s/.test(e)}function M(e){return!!e&&/[!-/:-@\[-`{-~]/.test(e)}function P(e,t){const o=t>0?e[t-1]:void 0,n=t+1<e.length?e[t+1]:void 0,r=void 0===n||E(n);if(r)return!1;const i=void 0!==n&&M(n),c=void 0===o||E(o),s=void 0!==o&&M(o),l=!r&&(!i||c||s),a=void 0===o||E(o);if(a)return l;const d=!a&&(!s||r||i);return!(l&&d&&B(o)&&B(n))&&(l&&(!d||s))}function N(e,t){const o=t>0?e[t-1]:void 0,n=t+1<e.length?e[t+1]:void 0,r=void 0===o||E(o);if(r)return!1;const i=void 0!==o&&M(o),c=void 0===n||E(n),s=void 0!==n&&M(n),l=!r&&(!i||c||s),a=void 0===n||E(n);if(a)return l;const d=!a&&(!s||r||i);return!(d&&l&&B(o)&&B(n))&&(l&&(!d||s))}function F(e){const t=e.replace(/<br\s*\/?>/gi,"\n"),o=[];let r="";const c=()=>{r&&(o.push(r),r="")},l=e=>{c(),o.push(e)};let a=0;e:for(;a<t.length;)if("\\"===t[a]&&a+1<t.length)r+=t[a+1],a+=2;else if(t.startsWith("<span",a)){const e=t.indexOf(">",a);if(-1===e){r+=t[a++];continue}const o=y(t.slice(a+5,e)),n=t.indexOf("</span>",e);let i,c;-1===n?(i=t.slice(e+1),c=t.length):(i=t.slice(e+1,n),c=n+7);const d=F(i),p=(0,s().Fi)(o.color)?o.color:void 0,u="true"===o.underline,f=o["discussion-urls"]?o["discussion-urls"].split(","):void 0;d.forEach((e=>{"string"==typeof e?l(p||u||f?{type:"annotated",text:e,annotations:{...p&&{color:p},...u&&{underline:!0},...f&&{discussionUrls:f}}}:e):"annotated"===e.type?l({...e,annotations:{...e.annotations??{},...p&&{color:p},...u&&{underline:!0},...f&&{discussionUrls:f}}}):"mention"===e.type?l({...e,annotations:{...p&&{color:p},...u&&{underline:!0},...f&&{discussionUrls:f}}}):l(e)})),a=c}else{if(t.startsWith("<mention-date",a)){const e=t.substring(a).match(/^<mention-date\s+([^>]+?)\/>/);if(e){const t=y(e[1]);l({type:"mention",mention:{type:"date",start:t.start,end:t.end}}),a+=e[0].length;continue}}if(t.startsWith("<mention-",a)){const e=t.substring(a).match(/^<mention-(user|page|database|data-source|agent)\s+([^>]+?)(\/>|>)/);if(e){const o=e[1],r=y(e[2]),i=e[3]===f,c=a+e[0].length,s=i?f:`</mention-${o}>`,d=t.indexOf(s,i?a:c);if(-1!==d){const e=i?void 0:t.slice(c,d).trim();let p;"user"===o?(p={type:"user",url:r.url},e&&(p.name=e)):"page"===o?(p={type:"page",url:r.url},e&&(p.title=e)):"database"===o?(p={type:"database",url:r.url},e&&(p.title=e)):"data-source"===o?(p={type:"data-source",url:r.url},null!=e&&e.trim()&&(p.title=e)):"agent"===o?(p={type:"agent",url:r.url},e&&(p.name=e)):(0,n().HB)(o),l({type:"mention",mention:p}),a=d+s.length;continue}}}if("["===t[a]){let e=-1,o=a+1;for(;o<t.length;)if("\\"===t[o]&&o+1<t.length)o+=2;else{if("]"===t[o]){e=o;break}o++}const n=t.indexOf("(",e),r=t.indexOf(")",n);if(-1!==e&&n===e+1&&-1!==r){const o=t.slice(a+1,e).replace(/\\(.)/g,"$1"),i=t.slice(n+1,r);l({type:"annotated",text:o,annotations:{href:i}}),a=r+1;continue}}if(t.startsWith("[^",a)){const e=t.indexOf("]",a);if(-1!==e){const o=t.slice(a+2,e).trim();l({type:"citation",href:o}),a=e+1;continue}}if(":"===t[a]){const e=t.indexOf(":",a+1);if(-1!==e&&e>a+1){const o=t.slice(a+1,e);if(i().x.VALID_NAME_REGEX.test(o)){l({type:"mention",mention:{type:"custom_emoji",name:o}}),a=e+1;continue}}}if(t.startsWith("***",a)){const e=t.indexOf("***",a+3);if(-1!==e){F(t.slice(a+3,e)).forEach((e=>d(e,{bold:!0,italic:!0}))),a=e+3;continue}}if(t.startsWith("___",a)){const e=t.indexOf("___",a+3);if(-1!==e){F(t.slice(a+3,e)).forEach((e=>d(e,{bold:!0,italic:!0}))),a=e+3;continue}}if(t.startsWith("**",a)){const e=t.indexOf("**",a+2);if(-1!==e){F(t.slice(a+2,e)).forEach((e=>d(e,{bold:!0}))),a=e+2;continue}}if(t.startsWith("__",a)){if(P(t,a)&&P(t,a+1)){let e=a+2;for(;e<=t.length-2;){if(t.startsWith("__",e)){if(N(t,e)&&N(t,e+1)){F(t.slice(a+2,e)).forEach((e=>d(e,{bold:!0}))),a=e+2;continue e}}e++}}r+=t[a++],r+=t[a++]}else if("_"===t[a]&&P(t,a)){let e=a+1;for(;e<t.length;){if("_"===t[e]&&N(t,e)){F(t.slice(a+1,e)).forEach((e=>d(e,{italic:!0}))),a=e+1;continue e}e++}r+=t[a++]}else{if("*"===t[a]){const e=t.indexOf("*",a+1);if(-1!==e){F(t.slice(a+1,e)).forEach((e=>d(e,{italic:!0}))),a=e+1;continue}}if(t.startsWith("~~",a)){const e=t.indexOf("~~",a+2);if(-1!==e){F(t.slice(a+2,e)).forEach((e=>d(e,{strikethrough:!0}))),a=e+2;continue}}if("`"===t[a]){const e=t.indexOf("`",a+1);if(-1!==e){l({type:"annotated",text:t.slice(a+1,e),annotations:{code:!0}}),a=e+1;continue}}if("$"!==t[a])r+=t[a++];else{if("`"===t[a+1]){const e=t.indexOf("`$",a+2);if(-1!==e&&!/\s/.test(t[e-1])){l({type:"equation",equation:t.slice(a+2,e)}),a=e+2;continue}}const e=t.indexOf("$",a+1),o=0===a?" ":t[a-1],n=-1===e||e+1>=t.length?" ":t[e+1];if(-1!==e&&/\s/.test(o)&&/\s/.test(n)&&!/\s/.test(t[a+1])&&!/\s/.test(t[e-1])){l({type:"equation",equation:t.slice(a+1,e)}),a=e+1;continue}r+=t[a++]}}}return c(),o.reduce(((e,t)=>("string"==typeof t&&e.length&&"string"==typeof e[e.length-1]?e[e.length-1]=e[e.length-1]+t:e.push(t),e)),[]);function d(e,t){"string"==typeof e?l({type:"annotated",text:e,annotations:t}):"annotated"===e.type||"mention"===e.type?l({...e,annotations:{...e.annotations??{},...t}}):l(e)}}function S(e){return e.trim().replace(/^\|/,"").replace(/\|$/,"").split("|").map((e=>e.trim())).map((e=>({text:F(e)})))}}}]);