"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[5053,32626,92754,99171],{24126:(e,t,o)=>{o.d(t,{c:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.9 2.75 12.18 14.49",svg:(0,o(474848).jsx)("path",{d:"M12.626 2.768a.625.625 0 0 1 0 1.224l-.126.013h-.125v4.794l3.366 5.159c.893 1.369-.03 3.17-1.623 3.281l-.156.006H6.039c-1.688 0-2.703-1.873-1.78-3.287l3.366-5.157V4.005H7.5a.625.625 0 0 1 0-1.25h5zM8.875 9.173l-.102.156-1.567 2.401h5.589l-1.569-2.403-.101-.156V4.005h-2.25z"})},i=(0,o(340498).wt)("beaker",n,"default")},108184:(e,t,o)=>{o.r(t),o.d(t,{COMPLETION_THROTTLE:()=>w,PREVIEW_STEP_DELAY:()=>k,maybeUpdateAIUsageEligibilityStoreV2:()=>x,maybeUpdateAiEligibility:()=>M,postProcessAICreatedStores:()=>C,showCompletionErrorWithCode:()=>b,wrapTemporaryBlocksInList:()=>P});o(18107),o(967357);var n=()=>o(242422),i=()=>o(675133),r=()=>o(128933),a=()=>o(770063),s=()=>o(878126),l=()=>o(165358),c=()=>o(179034),d=()=>o(427419),u=()=>o(720665),p=()=>o(753812),m=()=>o(722101),f=()=>o(384944),g=()=>o(274873),v=()=>o(412669),y=()=>o(556122),A=()=>o(594794),h=()=>o(668721),S=()=>o(685377),_=()=>o(661077),I=()=>o(96563);const w=300,k=250;function b(e){const t=i().A.getIntl();return 451===e?r().D6({label:t.formatMessage({id:"completionActions.moderationError",defaultMessage:"AI does not allow content that is harmful or illegal. Please revise your input and try again. (451)"})}):413===e?r().D6({label:t.formatMessage({id:"completionActions.promptOrAttachmentTooLarge",defaultMessage:"Query or attachment is too large. Please revise your input and try again. (413)"})}):502===e||503===e||504===e?r().D6({label:t.formatMessage({id:"completionActions.providerError",defaultMessage:"We’re experiencing issues with our AI provider. Try again in a few minutes. ({errorCode})"},{errorCode:e})}):void r().D6({label:t.formatMessage({id:"completionActions.genericError",defaultMessage:"AI is temporarily unavailable. Try again in a few minutes. ({errorCode})"},{errorCode:e})})}function C(e,t){for(const o of t)g().In({environment:e,blockStore:o})}async function M(e,t,o){let i;if(n().default.checkGate({gateName:"usage_based_pricing_pfa_checks_purchased_credits_enabled"}))return void(await x(e,t,o));n().default.checkGate({gateName:"usage_based_pricing_alpha_enabled"})&&x(e,t,o).catch((e=>{l().log({level:"error",from:"ai.completionActions",type:"maybeUpdateAIUsageEligibilityStoreV2Error",spaceId:t,error:e})}));const r=y().TI();if(r.debug)i=402!==r.showErrorCode;else{const n=h().o.getState();if(n&&n.isEligible&&"unlimited"===n.type&&!o){const e=n.lastUpdatedAt;if(Date.now()-e<10*u().Xb)return}const r=await p().callCellCompatibleApi({eventName:"getAIUsageEligibility",environment:e,data:{spaceId:t},cellNavigation:{cellId:void 0,spaceId:t}});if("success"===r.type){i=r.data.isEligible,i&&v().K.state&&v().K.setState(!1);const e=!1===(null==n?void 0:n.isEligible)&&(null==n?void 0:n.requestedAccess),t=r.data.researchModeUsage??0;h().o.setState({...r.data,lastUpdatedAt:Date.now(),researchModeUsage:t,...!1===r.data.isEligible&&{requestedAccess:e}})}}void 0!==i&&_().P.setState(i)}async function x(e,t,o){const n=await s().T.awaitData(e,{spaceId:t}),i=S().y.getData(e,{spaceId:t});if(n){if(i&&(0,d().Hg)(n)&&!o){const e=i.lastUpdatedAt;if(Date.now()-e<10*u().Xb)return}await(0,I().y3)(e,t)}}function P(e){var t;const{environment:o,stores:n,listId:i,inMemoryRecordCache:r,transaction:s}=e,l=(null===(t=n.at(0))||void 0===t?void 0:t.getSpaceId())??s.spaceId,d=new(a().pm)({environment:o,pointer:{table:c().ev,id:i||(0,A().Z1)({environment:o,table:c().ev,spaceId:l}),spaceId:l},recordStoreOptions:{inMemoryRecordCache:r,userId:o.currentUser.id},path:["content"]});for(const a of n)m().BC({parentStore:d,appendStore:a,transaction:s}),f().zv({store:a,data:{parent_id:d.id,parent_table:d.table,alive:!0},transaction:s});return d}},200424:(e,t,o)=>{e.exports=o.p+"9ade71d75a1c0e93.png"},224682:(e,t,o)=>{o.d(t,{m:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{type:"uninitialized"}}isWriting(){return"filling"===this.state.type&&!this.state.haveAllBlocksCompletedAutofill&&!this.state.didInterruptStreaming}setIsWriting(e){const{propertySchema:t,stores:n,sessionIdForAnalytics:i,collectionId:r}=e,a=i||o(206267).JW();return this.setState({type:"filling",propertySchema:t,collectionId:r,numBlocksToAutofill:n.length,numBlocksAutofilled:0,sessionId:a,didInterruptStreaming:!1,haveAllBlocksCompletedAutofill:!1}),a}}const i=new n},243331:(e,t,o)=>{o.d(t,{K_:()=>i,Lf:()=>a});var n=()=>o(206267);function i(){return{currentScreen:"none",status:"not_started",isBackendConnected:!1,externalSourceName:void 0,sessionId:n().JW(),analyticsFrom:"unknown",isConnected:!1,isPersonalAuthComplete:!1,isDisconnecting:!1,isLoaded:!1,isNotionMailProhibited:!1}}class r extends(()=>o(757695))().Store{getInitialState(){return i()}}const a=new r;(0,o(852832).exposeDebugValue)("notionMailAIConnectorStore",a)},246679:(e,t,o)=>{o.d(t,{VK:()=>i,gv:()=>a});var n=()=>o(206267);function i(){return{currentScreen:"none",status:"not_started",isBackendConnected:!1,externalSourceName:void 0,sessionId:n().JW(),analyticsFrom:"unknown",isConnected:!1,isPersonalAuthComplete:!1,isDisconnecting:!1,isLoaded:!1,isNotionCalendarProhibited:!1}}class r extends(()=>o(757695))().Store{getInitialState(){return i()}}const a=new r;(0,o(852832).exposeDebugValue)("notionCalendarAIConnectorStore",a)},272200:(e,t,o)=>{o.r(t),o.d(t,{trackAIAction:()=>a,trackAIAssistantEngineError:()=>m,trackAICompletionPopupClose:()=>p,trackAICompletionPopupOpen:()=>u,trackAIFavoriteAction:()=>l,trackAiAutofillAction:()=>c,trackAiAutofillSettingsAction:()=>d,trackUserFlow:()=>s});var n=()=>o(314529),i=()=>o(650829),r=()=>o(383070);function a(e,t){const{user_comment:o,...i}=t;(0,n().DO_NOT_USE_trackLegacy)(e,"ai_action",i)}function s(e,t,o){const i={site:"client",...o};(0,n().DO_NOT_USE_trackLegacy)(e,t,i)}function l(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"ai_favorite_action",t)}function c(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"ai_autofill_action",t)}function d(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"ai_autofill_settings_action",t)}function u(e,t){if(r().zD.isXMLAssistantEnabled()){var o;const n=(null===(o=t.sessionContext)||void 0===o?void 0:o.evaluatorFromStoreState.getTranscript())??[];i().assistantDependency.load().then((({assistantAnalyticsActions:o})=>{o.trackAssistantOpened(e,{from:t.from,sessionId:t.session_id,isReminder:!1,reminderType:void 0,startTimestamp:Date.now(),transcript:n,hasQuery:!1,searchSessionId:void 0})}))}else(0,n().DO_NOT_USE_trackLegacy)(e,"ai_completion_popup_open",{session_id:t.session_id,prompt_key:t.prompt_key,from:t.from})}function p(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"ai_completion_popup_close",t)}function m(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"ai_assistant_error",t)}},278589:(e,t,o)=>{o.d(t,{N:()=>r});var n=()=>o(534177),i=()=>o(17680);function r(e){return"avatar"===e?i().eQ:"xsmall"===e?18:"xsmall_plus"===e?24:"small"===e?28:"small_plus"===e?32:"medium"===e?36:"medium_plus"===e?44:"medium_large"===e?48:"large"===e?50:"large_plus"===e?64:"xlarge"===e?94:"plans"===e?20:"deep_dive"===e?16:"upsell_banner"===e?74:"personalization_modal"===e?96:(0,n().HB)(e)}},299177:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().Store{getInitialState(){return{}}}const i=new n;o(852832).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",i);const r=i},332751:(e,t,o)=>{o.d(t,{I:()=>r});var n=()=>o(170722),i=()=>o(369241);function r(){n().A.state.isActive&&(i().A.setState({...i().A.state,open:!1}),n().A.setState({...n().A.state,isActive:!1,isAnimatingClosed:!0}))}},369241:(e,t,o)=>{o.d(t,{A:()=>n});const n=new(o(118307).A)},378815:(e,t,o)=>{o.r(t),o.d(t,{arrowStraightDownFillIcon:()=>i,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.72 2.12 12.56 15.76",svg:(0,o(474848).jsx)("path",{d:"M10.875 2.924c0-.441-.392-.799-.875-.799s-.875.358-.875.799v11.964L5.219 10.98a.875.875 0 0 0-1.239 1.24l5.4 5.4a.875.875 0 0 0 1.238 0l5.4-5.4a.875.875 0 1 0-1.238-1.238l-3.906 3.907z"})},i=(0,o(340498).wt)("arrowStraightDownFill",n,"fill")},388182:(e,t,o)=>{o.d(t,{A:()=>n});const n=o(757695).Store.createValue({open:!1},{name:"ConfirmOverwriteModalStore"})},404783:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{constructor(e,t){super(),this.environment=void 0,this.spaceId=void 0,this.environment=e,this.spaceId=t,this.reset()}getInitialState(){if(!this.environment)return;const e=new(o(221844).A)({name:"DiscussionInputStore",isTemporaryData:!0});return{textStore:new(o(770063).pm)({environment:this.environment,pointer:(0,o(594794).zP)({environment:this.environment,table:o(343666).SN,spaceId:this.spaceId}),path:["text"],recordStoreOptions:{inMemoryRecordCache:e}}),localRecordCache:e,files:[],showAttachFileIntro:!1,renderFileAttachIntro:!1}}isEmpty(){const e=this.state.textStore.getValue();return!e||0===e.length}hasNewLineCharacter(){const e=this.state.textStore.getValue();return o(201980).q4_(e).includes("\n")}}const i=n},405981:(e,t,o)=>{o.d(t,{HR:()=>p,_y:()=>m});var n=()=>o(907258),i=()=>o(675133),r=()=>o(792057),a=()=>o(534177),s=()=>o(878523),l=()=>o(116008),c=()=>o(681634),d=()=>o(938045);const u=(0,o(69708).YK)({discardCommentConfirmationPrompt:{id:"newDiscussionMenu.discardCommentConfirmationDialog.prompt",defaultMessage:"Do you want to discard the comment?"},discardCommentButtonLabel:{id:"newDiscussionMenu.discardCommentConfirmationDialog.discardButton.label",defaultMessage:"Discard"},draftCommentConfirmationPromptTitle:{id:"newDiscussionMenu.draftCommentConfirmationDialogTitle.prompt",defaultMessage:"Finish your draft comment?"},draftCommentConfirmationStartingNewDescription:{id:"newDiscussionMenu.draftCommentConfirmationStartingNewDescription.prompt",defaultMessage:"You have a draft comment that will be lost if you start a new one"},draftCommentConfirmationNavigateAwayPromptDescription:{id:"newDiscussionMenu.draftCommentConfirmationNavigateAwayPromptDescription.prompt",defaultMessage:"You have a draft comment that will be lost if you leave the page"},returnToPageButtonLabel:{id:"newDiscussionMenu.discardCommentConfirmationDialog.returnToPage.label",defaultMessage:"Return to draft"}});function p(e){const{discussionInputStore:t,environment:o,discussionHelpers:n,reason:a}=e;l().A.isComposingNewDiscussion()?m({environment:o,reason:a??"navigating_away"}):n.hasCommentChanged(t)?(s().yO(o),r().ui({message:i().A.formatMessage(u.discardCommentConfirmationPrompt),showCancel:!0,handleCancel:()=>s().Ie(o),keepFocus:!0,items:[{label:i().A.formatMessage(u.discardCommentButtonLabel),color:"red",onAccept:()=>{s().QP(o),(0,c().c)()}}]})):(0,c().c)()}function m(e){const{environment:t}=e;if(!l().A.isDraftCommentOnValidSelection())return;const o=l().A.getDiscussionInputStore();s().yO(t),r().ui({message:i().A.formatMessage(u.draftCommentConfirmationPromptTitle),description:(()=>{switch(e.reason){case"starting_new":return i().A.formatMessage(u.draftCommentConfirmationStartingNewDescription);case"navigating_away":return i().A.formatMessage(u.draftCommentConfirmationNavigateAwayPromptDescription);default:(0,a().HB)(e.reason)}})(),keepFocus:!0,innerStyle:{textAlign:"center"},showCancel:!1,shouldRenderDraftCommentIcon:!0,items:[{label:i().A.formatMessage(u.returnToPageButtonLabel),buttonType:"solid",color:"blue",onAccept:()=>{(0,d().x)({currentBlockStore:n().default.state.mainEditorCurrentBlockStore,discussionInputStore:o,environment:t}),s().Ie(t)}},{label:i().A.formatMessage(u.discardCommentButtonLabel),color:"red",buttonType:"outline",onAccept:()=>{s().QP(t),(0,c().c)()}}]})}},441467:(e,t,o)=>{o.d(t,{DZ:()=>E,Ek:()=>H,hN:()=>F,i5:()=>V,of:()=>W});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(803949);var n=()=>o(779315),i=()=>o(675133),r=()=>o(489295),a=()=>o(295633),s=()=>o(86159),l=()=>o(292985),c=()=>o(700500),d=()=>o(179034),u=()=>o(197959),p=()=>o(161479),m=()=>o(798880),f=()=>o(201980),g=()=>o(878523),v=()=>o(182641),y=()=>o(383594),A=()=>o(384944),h=()=>o(332751),S=()=>o(538527),_=()=>o(222138),I=()=>o(594794),w=()=>o(299545),k=()=>o(486666),b=()=>o(372154),C=()=>o(718957),M=()=>o(244828),x=()=>o(404783),P=()=>o(555776),T=()=>o(116008),D=()=>o(543225),j=()=>o(59320),R=()=>o(528787),U=()=>o(681634),N=()=>o(583824),O=()=>o(36088),L=()=>o(807060),B=()=>o(405981);const E=(0,o(69708).YK)({emojiPicker:{defaultMessage:"Reaction",id:"ReactionBar.emojiModalMenu.title"},emojiTitle:{id:"recordIcon.emojiTab.title",defaultMessage:"Emoji"}});function W(e){const{environment:t,blockStore:o,multiSelection:n,rect:r,formulasModule:a}=e;let l=r;if(!l){const e=s().get();if(!e)return;l=s().getRect(e)}if(!l)return;const c=l.width,d=l.height,u=l.right-c;T().A.setState({open:!0,rect:new DOMRect(u,l.top,c,d),type:"inline",content:"reaction",blockStore:o,blockId:o.id,multiSelection:n,emoji:void 0}),y().W(t,{originGap:4,originRect:l,popupWidth:k().jv,popupHeight:k().GF,isSmallWidth:!1,title:i().A.formatMessage(E.emojiPicker),currentTab:"emoji",onCancel:()=>T().A.reset(),tabs:[{type:"emoji",title:i().A.formatMessage(E.emojiTitle),hideRandomButton:!0,onChange:e=>{const o=T().A.state;o.open&&"reaction"===o.content&&(T().A.setState({...o,emoji:e}),V({environment:t,formulasModule:a}),y().I())}}]})}async function F(e){var t;const{environment:o,blockStore:i,multiSelection:r,rect:a,from:c,property_id:d}=e;if(T().A.hasContent())return void(0,B()._y)({environment:o,reason:"starting_new"});let u=a;if(!u){const e=s().get();if(!e)return;u=s().getRect(e)}if(!u)return;const m=u.width,f=u.height,v=u.right-m,y=new(x().A)(o,(0,p().e)(i.pointer.spaceId));T().A.setState({open:!0,rect:new DOMRect(v,u.top,m,f),type:"inline",content:"comment",blockStore:i,lastKnownBlockStore:i,blockId:i.id,multiSelection:r,lastEditables:(0,C().$W)(r),discussionInputStore:y,property_id:d,from:c}),(0,l().V)({element:null===(t=n().A.UpdateSidebarCommentScroller)||void 0===t?void 0:t.getNode(),environment:o,options:{top:0,behavior:"smooth"}}),P().A.setActiveWithSource("text_annotation"),h().I(),await(0,O().M)({discussionInputStore:y,environment:o}),g().z0(o,{from:c})}function V(e){const{environment:t,allowActionsWhileCommenting:o,skipOpeningDiscussion:n,formulasModule:i}=e,s=T().A.state;if(s.open){const e="comment"===s.content?s.property_id:void 0,l=T().A.getBlockStore()??T().A.getLastKnownBlockStore();if(T().A.hasContent()&&(!o||l))if("inline"===s.type)M().createAndCommit({userAction:"newDiscussionMenuActions.submitNewDiscussion",environment:t,canUndo:!0,perform:n=>{const i=function(e){const{environment:t,multiSelection:o,transaction:n,allowActionsWhileCommenting:i}=e,{id:s}=t.currentUser;if(!s)return;const l=i?T().A.getLastSelectedEditables():(0,C().$W)(o).filter((({store:e})=>e.table===d().ev));if(!l||0===l.length)return;const p=(0,r().zH)(l[0].store),m=(0,I().Z1)({environment:t,table:u().$Y,spaceId:p.pointer.spaceId}),g=[],v=new Set;l.forEach((({store:e,selection:o},i)=>{v.add(e.id);const s=(0,r().zH)(e);if(!(s instanceof a().B))return;const l=s.getType(),d=s.getFormat();if(l&&(0,c().pD)(l,d))return;let u=e.getValue();const p=f().xbM(u,o);S().Mw({environment:t,store:e,selection:p,annotation:[f().Ifu.Discussion,m],transaction:n}),u=e.getValue();const y=f().Ffo(u,p.startIndex,p.endIndex),A=0===i?[]:[f().Ey_("\n")];g.push(...A,...y)}));const y=(0,C().ZS)({multiSelection:o,filterCommonAncestors:!1,focus:void 0});if(y)for(const r of y.stores){if(v.has(r.id))continue;const e=r.getType(),t=r.getFormat();e&&(0,c().pD)(e,t)||(0,D().B)({blockStore:r,discussionId:m,transaction:n})}return{blockStore:p,context:g,discussionId:m}}({environment:t,multiSelection:s.multiSelection,transaction:n,allowActionsWhileCommenting:o});if(!i)return;const{context:p,blockStore:m,discussionId:v}=i;if("comment"===s.content){const i=s.discussionInputStore.state.textStore.getValue()||[],r=s.discussionInputStore.state.files,{discussionStore:a,commentStore:c}=(0,j().G)({createDiscussionArgs:{type:"default",context:p,property_id:e},blockStore:m,environment:t,transaction:n,commentTextValue:i,files:_().JC(r),discussionId:v});(0,D().B)({transaction:n,blockStore:m,discussionId:v});const{property_type:d,collection_id:u,collection_view_id:f,view_type:y,collection_view_block_id:A}=(0,L().q)(e,l);g().bJ(t,{discussion_id:a.id,discussion_type:a.getType(),comment_id:c.id,parent_block_id:a.getParentId(),from:T().A.state.open&&"comment"===T().A.state.content?T().A.state.from:void 0,property_id:e,property_type:d,collection_view_id:f,view_type:y,collection_id:u,collection_view_block_id:A}),o&&b().A.addNewDiscussionId(v)}else s.emoji&&z({context:p,blockStore:m,environment:t,transaction:n,icon:s.emoji,discussionId:v})},skipUpdatingEditedMetadata:!0});else if("block"===s.type)if("comment"===s.content){const n=s.discussionInputStore.state.textStore.getValue()||[],r=s.discussionInputStore.state.files;o?l&&M().createAndCommit({userAction:"newDiscussionMenuActions.submitNewDiscussion",environment:t,canUndo:!0,perform:o=>{(0,N().i)({environment:t,type:"default",blockStore:l,commentTextValue:n||[],files:r,transaction:o,property_id:e,formulasModule:i})},skipUpdatingEditedMetadata:!0}):M().createAndCommit({userAction:"newDiscussionMenuActions.submitNewDiscussion",environment:t,canUndo:!0,perform:o=>{(0,N().i)({environment:t,type:"default",blockStore:s.blockStore,commentTextValue:n||[],files:r,transaction:o,property_id:e,formulasModule:i})},skipUpdatingEditedMetadata:!0})}else{const e=t.currentUser.id,{emoji:o,blockStore:n}=s,i=w().O3(n,{recursivelyLoadAllDiscussions:!1}).find((e=>e.getReactions().length>0));o&&e&&M().createAndCommit({userAction:"newDiscussionMenuActions.submitNewDefaultDiscussion.addReaction",environment:t,canUndo:!0,perform:r=>{null!=i&&i.isDefined()?R().createReaction({environment:t,transaction:r,store:i,icon:o,currentActorPointer:{table:m().oo,id:e},discussionLocation:"block_menu"}):z({context:void 0,blockStore:n,environment:t,transaction:r,icon:o})},skipUpdatingEditedMetadata:!0})}(0,U().c)();const p=o?l&&l.getAssociatedCollectionStore():s.blockStore.getAssociatedCollectionStore();n||e||!p||v().B4({environment:t,blockStore:o?l??s.blockStore:s.blockStore,shouldFocusDiscussion:!0,analyticsFrom:"db_page_comments",rect:T().A.state.rect,recursivelyLoadAllDiscussions:!1})}}function z(e){const{context:t,blockStore:o,environment:n,transaction:i,icon:r}=e,a=e.discussionId??(0,I().Z1)({environment:n,table:u().$Y,spaceId:o.pointer.spaceId});if(void 0===n.currentUser.id)return;const s=A().vt({environment:n,table:"discussion",args:{type:"default",id:a,parent:o.pointer,context:t,space_id:(0,p().e)(o.pointer.spaceId)},inMemoryRecordCache:o.inMemoryRecordCache,transaction:i});(0,D().B)({transaction:i,blockStore:o,discussionId:s.id});const l={table:m().oo,id:n.currentUser.id};return R().createReaction({environment:n,transaction:i,store:s,icon:r,currentActorPointer:l,discussionLocation:"block_menu"}),s}function H(e){const{environment:t}=e;if(!t.currentUser.id)return;const o=T().A.getPropertyId();if(o){var n;const e=null===(n=T().A.getBlockStore())||void 0===n?void 0:n.getPropertyStore(o);if(e)return{blockStore:e,context:e.getValue()}}const i=T().A.getLastSelectedEditables();if(!i||0===i.length)return;const s=(0,r().zH)(i[0].store),l=[],d=new Set;return i.forEach((({store:e,selection:t},o)=>{d.add(e.id);const n=(0,r().zH)(e);if(!(n instanceof a().B))return;const i=n.getType(),s=n.getFormat();if(i&&(0,c().pD)(i,s))return;const u=e.getValue(),p=f().xbM(u,t),m=f().Ffo(u,p.startIndex,p.endIndex),g=0===o?[]:[f().Ey_("\n")];l.push(...g,...m)})),{blockStore:s,context:l}}},460957:(e,t,o)=>{o.d(t,{E:()=>a});o(581454);var n=()=>o(201980),i=()=>o(718957),r=()=>o(29554);function a(e){const{multiSelection:t}=e;return(0,i().$W)(t).map((({store:e,selection:t})=>{const o=(0,n().RQ)(e.getValue()),i=(0,n().xbM)(o,t),{tokensInsideRange:a}=(0,n().AI5)(o,i.startIndex,i.endIndex);return(0,r().r4)(a,e)})).join("\n\n")}},495159:(e,t,o)=>{o.d(t,{LB:()=>c,VT:()=>s,vr:()=>l});var n=()=>o(686131),i=()=>o(295633),r=()=>o(116089),a=()=>o(836724);const s=(0,o(69708).YK)({askAI:{defaultMessage:"Ask AI",id:"id.completions.askAI"},genericHelpMeWrite:{defaultMessage:"{filter}",id:"id.completions.genericHelpMeWrite"},summarize:{defaultMessage:"Summarize",id:"id.completions.summarize"},findActionItems:{defaultMessage:"Find action items",id:"id.completions.findActionItems"},autofillSummary:{defaultMessage:"Summary",id:"id.completions.autofillSummary"},autofillTranslate:{defaultMessage:"Translate",id:"id.completions.autofillTranslate"},autofillExtract:{defaultMessage:"Key info",id:"id.completions.autofillExtract"},autofillCustom:{defaultMessage:"Custom autofill",id:"id.completions.autofillCustom"}}),l={text:{summarize:{name:s.autofillSummary,svg:o(37719).P},translate:{name:s.autofillTranslate,svg:o(877235).textTranslateIcon},extract:{name:s.autofillExtract,svg:o(202017).n},custom:{name:s.autofillCustom,svg:r().x}},select:{select:{name:s.autofillCustom,svg:r().x}},multi_select:{select:{name:s.autofillCustom,svg:r().x}}};function c(e){const{origin:t}=e;return t instanceof i().B?function(e){let t=a().T.findNodeFromStore(e);if(t){if("table"===e.getType()){const e=t.querySelector(`.${n().rb}.notion-table-block`);t=e??t}return t.getBoundingClientRect()}}(t):t instanceof HTMLElement?t.getBoundingClientRect():t}},517288:(e,t,o)=>{o.d(t,{O:()=>c});var n=()=>o(675133),i=()=>o(383594),r=()=>o(486666),a=()=>o(129522),s=()=>o(116008),l=()=>o(441467);function c(e){const{environment:t,blockStore:o,rect:c,skipOpeningDiscussionOnSubmit:d,formulasModule:u}=e,p=c??a().K.getRect(o);if(!p)return;const m=p.width,f=p.height,g=p.right-m;s().A.setState({open:!0,rect:new DOMRect(g,p.top,m,f),type:"block",content:"reaction",blockStore:o,blockId:o.id,emoji:void 0}),i().W(t,{originGap:4,originRect:p,popupWidth:r().jv,popupHeight:r().GF,isSmallWidth:!1,title:n().A.formatMessage(l().DZ.emojiPicker),currentTab:"emoji",onCancel:()=>s().A.reset(),tabs:[{type:"emoji",title:n().A.formatMessage(l().DZ.emojiTitle),hideRandomButton:!0,onChange:e=>{const o=s().A.state;o.open&&"reaction"===o.content&&(s().A.setState({...o,emoji:e}),(0,l().i5)({environment:t,skipOpeningDiscussion:d,formulasModule:u}),i().I())}}]})}},528787:(e,t,o)=>{o.r(t),o.d(t,{createReaction:()=>I,toggleReaction:()=>_});o(898992),o(354520),o(672577),o(581454),o(737550);var n=()=>o(770063),i=()=>o(97879),r=()=>o(785082),a=()=>o(343666),s=()=>o(197959),l=()=>o(204384),c=()=>o(161479),d=()=>o(798880),u=()=>o(534177),p=()=>o(878523),m=()=>o(722101),f=()=>o(384944),g=()=>o(279922),v=()=>o(594794),y=()=>o(244828),A=()=>o(741817),h=()=>o(725332),S=()=>o(807060);function _(e){const{discussionLocation:t,environment:o,transaction:a,store:m,icon:f}=e,v=function({store:e,icon:t}){const o=(0,n().G_)(e,e.pointer,"reactions").getValue();if(void 0===o)return;return o.map((t=>{const o=i().L.createChildStore(e,{table:l().ez,id:t,spaceId:(0,c().e)(e.pointer.spaceId)});if(o.isDefined())return o})).filter(u().O9).find((e=>e.getIcon()===t))}({store:m,icon:f});if(void 0===o.currentUser.id)return;const S={table:d().oo,id:o.currentUser.id};return null!=v&&v.isDefined()?function({store:e,actorPointer:t,transaction:o,environment:n,discussionLocation:a}){var l;const c={store:e,actorPointer:t,transaction:o,environment:n,discussionLocation:a},d=e.getParentStore(),u=(null==d?void 0:d.table)===s().$Y?d:null==d?void 0:d.getParentStore(),m=(null===(l=e.getActors())||void 0===l?void 0:l.some((e=>e.id===t.id)))??!1;u&&w(u,d)&&(0,h().U)({transaction:o,discussionStore:u});return m?(function(e){var t,o;const{store:n,actorPointer:a,discussionLocation:l,transaction:c,environment:d}=e;if(!n.isDefined())return;const u=n.getParentStore(),m=(null==u?void 0:u.table)===s().$Y?u:null==u?void 0:u.getParentStore(),f=r().eR.includes(l),v=null==m||null===(t=m.getParentStore())||void 0===t?void 0:t.getNavigableBlockStore(),h=i().L.getUserVisibleReactions(u),S=1===h.length&&1===n.getActors().length&&n.getActors()[0].id===d.currentUser.id;p().fq({environment:d,reaction_value:n.getIcon(),comment_id:n.getParentId(),discussion_id:null==m?void 0:m.id,discussion_type:null==m?void 0:m.getType(),parent_block_id:null==m?void 0:m.getParentId(),parent_collection_id:null==m||null===(o=m.getParentStore())||void 0===o?void 0:o.getParentCollectionIdUpToTwoLevels(),reaction_count:n.getActors().length??0,from:l,...f&&{inbox_session_id:g().Ay.state.sessionId,notification_page_id:null==v?void 0:v.id}});const _=n.getModel();y().applyOperation({transaction:c,store:n,operation:_.ops.removeActor(a)}),S&&u&&u.table===s().$Y&&(0,A().v)({environment:d,discussionStore:u,transaction:c})}(c),"Removed"):(function(e){var t,o;const{store:n,actorPointer:i,discussionLocation:a,transaction:l,environment:c}=e;if(!n.isDefined())return;const d=n.getParentStore(),u=(null==d?void 0:d.table)===s().$Y?d:null==d?void 0:d.getParentStore(),m=r().eR.includes(a),f=null==u||null===(t=u.getParentStore())||void 0===t?void 0:t.getNavigableBlockStore();p().MP({environment:c,reaction_value:n.getIcon(),comment_id:n.getParentId(),discussion_id:null==u?void 0:u.id,discussion_type:null==u?void 0:u.getType(),parent_block_id:null==u?void 0:u.getParentId(),parent_collection_id:null==u||null===(o=u.getParentStore())||void 0===o?void 0:o.getParentCollectionIdUpToTwoLevels(),reaction_count:n.getActors().length??0,from:a,...m&&{inbox_session_id:g().Ay.state.sessionId,notification_page_id:null==f?void 0:f.id}});const v=n.getModel();y().applyOperation({transaction:l,store:n,operation:v.ops.appendActor(i)})}(c),"Added")}({environment:o,store:v,actorPointer:S,transaction:a,discussionLocation:t}):(I({environment:o,transaction:a,store:m,icon:f,currentActorPointer:S,discussionLocation:t}),"Added")}function I({environment:e,transaction:t,store:o,icon:i,currentActorPointer:a,discussionLocation:d}){var u,y;const A=(0,v().JH)({environment:e,table:l().ez,spaceId:(0,c().e)(o.pointer.spaceId)}),_=o.table===s().$Y?o:o.getParentStore(),I=r().eR.includes(d),k=null==_||null===(u=_.getParentStore())||void 0===u?void 0:u.getNavigableBlockStore(),b=null==_?void 0:_.getPropertyId(),C=null==_?void 0:_.getParentStore(),{property_type:M,collection_id:x,collection_view_id:P,view_type:T,collection_view_block_id:D}=(0,S().q)(b,C);p().MP({environment:e,reaction_value:i,comment_id:o.id,discussion_id:null==_?void 0:_.id,discussion_type:null==_?void 0:_.getType(),parent_block_id:null==_?void 0:_.getParentId(),parent_collection_id:null==_||null===(y=_.getParentStore())||void 0===y?void 0:y.getParentCollectionIdUpToTwoLevels(),reaction_count:0,from:d,...I&&{inbox_session_id:g().Ay.state.sessionId,notification_page_id:null==k?void 0:k.id},property_type:M,collection_id:x,collection_view_id:P,view_type:T,collection_view_block_id:D});const j=f().vt({environment:e,table:A.table,args:{id:A.id,spaceId:A.spaceId,commentId:o.id,icon:i,actorPointer:a},inMemoryRecordCache:o.inMemoryRecordCache,transaction:t}),R=(0,n().G_)(o,o.pointer,"reactions");m().BC({parentStore:R,appendStore:j,transaction:t}),_&&w(_,o)&&(0,h().U)({transaction:t,discussionStore:_})}function w(e,t){var o;if(!e||!t||t.table!==a().SN)return!1;const n=null===(o=e.getUserSeenRecordStore())||void 0===o?void 0:o.getLastSeenAt();return!n||n<t.getCreatedTime()}},556122:(e,t,o)=>{o.d(t,{QJ:()=>m,TI:()=>c});o(944114),o(581454);var n=()=>o(726637),i=()=>o(763824);let r=0;const a="clipboard",s={debug:Boolean(n().A.isDevelopingInAirplaneMode),responseText:a,showErrorCode:!1,delayBetweenChunks:20,chunkSize:5,numLoremIpsums:3},l="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec porta auctor sem vel efficitur. Vivamus efficitur eros sed erat efficitur efficitur. Vivamus et augue vel est efficitur efficitur.";function c(){return s}function d(e){return{async*[Symbol.asyncIterator](){for(const t of e)await(0,i().wR)(s.delayBetweenChunks),yield t}}}function u(e,t){const o=Math.ceil(e.length/t),n=new Array(o);for(let i=0,r=0;i<o;++i,r+=t)n[i]=e.substr(r,t);return n}function p(e){return e.map((e=>({type:"success",p:"padding",completion:e,inferenceId:"mock"})))}async function m({environment:e,data:t}){console.log("Retrieving fake completion for data",t);const{context:o}=t,i=o.selectedText,c=[];let{responseText:m}=s;if(m===a&&(m=await async function(){try{return await navigator.clipboard.readText()}catch(e){return}}()??"Unable to retrieve clipboard text."),void 0===m&&(c.push({type:"success",p:"padding",completion:"\n",inferenceId:"mock"},{type:"success",p:"padding",completion:"this is ",inferenceId:"mock"},{type:"success",p:"padding",completion:"fake ",inferenceId:"mock"},{type:"success",p:"padding",completion:`streaming response ${r++}.`,inferenceId:"mock"}),n().A.isDevelopingInAirplaneMode&&c.push({type:"success",p:"padding",completion:"\n\nTo see a real AI response, run the server with `--airplaneMode=false`.",inferenceId:"mock"}),"string"==typeof i)){c.push({type:"success",p:"padding",completion:"\n\nHere is the text you selected:\n\n",inferenceId:"mock"});for(const e of u(i,s.chunkSize))c.push({type:"success",completion:e,p:"padding",inferenceId:"mock"})}if(s.showErrorCode)c.push({type:"error",message:"alas",errorCode:s.showErrorCode,isRetryable:!1});else if(void 0===m)for(let n=0;n<s.numLoremIpsums;n++)c.push(...p([`\n\n${n+1}. `,...u(l,0===s.delayBetweenChunks?l.length:s.chunkSize)]));else if(m.length>0){const e=u(m,s.chunkSize);c.push(...p(e))}return Promise.resolve({type:"success",data:d(c),status:200,headers:{}})}(0,o(852832).exposeDebugValue)("completionDebugSettings",s)},583289:(e,t,o)=>{o.d(t,{U:()=>i});var n=()=>o(388182);async function i(e){return new Promise((t=>{n().A.setState({open:!0,onClose:()=>{n().A.setState({open:!1}),t(!1)},onConfirm:()=>{n().A.setState({open:!1}),t(!0)},...e})}))}},586399:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{isDuplicating:!1}}}const i=new n},591197:(e,t,o)=>{o.d(t,{VY:()=>s,ZJ:()=>r,u3:()=>a});var n=()=>o(140934);class i extends(()=>o(757695))().Store{getInitialState(){return{popupRenderedInPage:!1,popupRenderedInPeekView:!1}}}const r=new i,a=new(n().ComputedStore)((()=>!1!==r.state.popupRenderedInPage),{debugName:"AssistantWriterRenderedInPageStore"}),s=new(n().ComputedStore)((()=>!1!==r.state.popupRenderedInPeekView),{debugName:"AssistantWriterRenderedInPeekViewStore"})},645266:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{open:!1}}}const i=new n},680474:(e,t,o)=>{o.d(t,{Wx:()=>r,fM:()=>n,sM:()=>i});const n=new(o(79926).O2)("framer-motion",(async()=>await Promise.all([o.e(44711),o.e(53321),o.e(37043)]).then(o.bind(o,301716))));function i(e){return e.useAnimation()}function r(e,...t){return e.useInView(...t)}},706654:(e,t,o)=>{o.r(t),o.d(t,{autofillPropertyForBlocks:()=>X,autofillPropertyForCollection:()=>ee,fillAllPagesMessages:()=>H,getDefaultAiInference:()=>ae,saveOrRemovePropertyAiInference:()=>re,triggerAiAutofillUpsell:()=>Q});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(803949),o(581454);var n=o(296540),i=()=>o(564884),r=()=>o(907258),a=()=>o(135168),s=()=>o(242422),l=()=>o(221844),c=()=>o(675133),d=()=>o(792057),u=()=>o(128933),p=()=>o(94484),m=()=>o(770063),f=()=>o(898244),g=()=>o(713998),v=()=>o(206267),y=()=>o(134025),A=()=>o(706021),h=()=>o(69708),S=()=>o(532659),_=()=>o(973647),I=()=>o(534177);const w=(0,o(583835).Dv)("fillAutofillPropertiesInViewTask");var k=()=>o(299709),b=()=>o(753812),C=()=>o(884107),M=()=>o(583289),x=()=>o(357625),P=()=>o(203913),T=()=>o(396896),D=()=>o(272200),j=()=>o(224682),R=o(474848);const U=function({environment:e,inferenceIds:t,aiInference:i}){const r=(0,o(590526).K8)((()=>{const{state:e}=j().m;return"uninitialized"===e.type?null:{numBlocksToAutofill:e.numBlocksToAutofill,numBlocksAutofilled:e.numBlocksAutofilled,propertySchema:e.propertySchema,collectionId:e.collectionId,sessionId:e.sessionId,haveAllBlocksCompletedAutofill:e.haveAllBlocksCompletedAutofill}}),[]),a=(0,n.useCallback)((()=>{r&&(t.forEach((t=>{D().trackAiAutofillAction(e,{ai_inference_type:i.type,type:"undo_from_snackbar",inference_id:t,collection_id:r.collectionId,session_id:r.sessionId})})),o(495262).tN({environment:e,preventSelectText:!0}),u().N2(),j().m.setState({type:"filling",...r,didInterruptStreaming:!0}))}),[r,e,i,t]);if(!r)return null;const{numBlocksToAutofill:s,numBlocksAutofilled:l,propertySchema:{name:c}}=r;return l===s?(0,R.jsxs)(T().fI,{gap:4,alignItems:"center",children:[(0,R.jsx)(o(807449).I,{icon:o(29037).checkmarkIcon}),(0,R.jsx)(h().sA,{defaultMessage:"AI updated “{propertyName}” on {numPages, plural, one {1 page} other {# pages}}",id:"snackbar.aiAutofill.autofillInProgress",values:{propertyName:c,numPages:s}}),(0,R.jsx)(P().Ag,{onClick:a,children:(0,R.jsx)(h().sA,{defaultMessage:"Undo",id:"snackbar.aiAutofill.undo"})}),(0,R.jsx)(P().Ag,{onClick:()=>{u().N2()},children:(0,R.jsx)(h().sA,{defaultMessage:"Close",id:"snackbar.aiAutofill.close"})})]}):(0,R.jsxs)(T().fI,{gap:4,alignItems:"center",children:[(0,R.jsx)(o(98126).k,{}),0===l?(0,R.jsx)(h().sA,{defaultMessage:"AI updating “{propertyName}” on {numPages, plural, one {1 page} other {# pages}}",id:"snackbar.aiAutofill.autofillStarting",values:{propertyName:c,numPages:s}}):(0,R.jsx)(h().sA,{defaultMessage:"AI updated “{propertyName}” on {numFilledPages} of {numTotalPages} pages",id:"snackbar.aiAutofill.completedAutofill",values:{propertyName:c,numFilledPages:l,numTotalPages:s}}),(0,R.jsx)(P().Ag,{onClick:a,children:(0,R.jsx)(h().sA,{defaultMessage:"Stop & undo",id:"snackbar.aiAutofill.undoAndStop"})})]})};var N=()=>o(831566),O=()=>o(659602),L=()=>o(335722),B=()=>o(71304),E=()=>o(991249),W=()=>o(390366),F=()=>o(295304),V=()=>o(244828),z=()=>o(108184);const H=(0,h().YK)({fillAllPagesTooltip:{defaultMessage:"Autofill all pages in this view",id:"aiAutofill.fillAllPages.buttonTooltip"},fillAllPagesAddOnMessage:{defaultMessage:"Only with Notion AI add-on",id:"aiAutofill.fillAllPages.onlyWithAiAddOnMessageInTooltip"},fillAllPagesAddAiMessage:{defaultMessage:"Only with upgraded Notion AI",id:"aiAutofill.fillAllPages.onlyWithAiBusinessMessageInTooltip"}});function K(e){const{environment:t,propertyId:o,propertySchema:n,storesWithCompletions:i,useTemporaryStore:r,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:s,clipboardActions:l,doneStreaming:c,aiInferenceOverride:d}=e;V().createAndCommit({userAction:"BlockPropertyValue.handleActionButtonClick.aiAutofill",environment:t,canUndo:!Boolean(r),undoCheckpoint:!0,perform:e=>{$({environment:t,propertyId:o,propertySchema:n,storesWithCompletions:i,useTemporaryStore:r,markdownLinkifyIt:a,tinyMceMicrosoftWordPasteFilter:s,clipboardActions:l,doneStreaming:c,aiInferenceOverride:d,transaction:e})}})}function $(e){var t;const{environment:o,propertyId:n,propertySchema:i,storesWithCompletions:r,useTemporaryStore:a,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l,clipboardActions:c,doneStreaming:d,aiInferenceOverride:u,transaction:p}=e;for(const{store:m,temporaryStore:v,completion:y}of r){const e=a?v:m;let r;switch(i.type){case"text":r=c.getInlineTitleValueFromClipboardTextHtml({text:y.trim(),stripText:!1,stripSurroundingWhitespace:!0,markdownLinkifyIt:s,tinyMceMicrosoftWordPasteFilter:l});break;case"multi_select":case"select":const e=a?null===(t=m.getAssociatedCollectionStore())||void 0===t?void 0:t.clone(v.inMemoryRecordCache):m.getAssociatedCollectionStore(),o=(null==e?void 0:e.getSchema()[n])||i,A=u??i.select_ai_inference;let h=y.trim().split(",").map((e=>e.trim()));if(d||(h=h.slice(0,-1)),h.length>0&&"select"===i.type&&(h=h.slice(0,1)),e&&null!=A&&A.add_options){const t=(0,f().nP)({newTokenValues:[h],property:n,propertySchema:o,collectionId:e.id});if(t)for(const o of t)V().applyOperation({store:e,operation:o,transaction:p})}null!=A&&A.add_options||(h=h.filter((e=>{var t;return null===(t=i.options)||void 0===t?void 0:t.find((t=>t.value===e))}))),r=(0,g().rK)(h);break;default:(0,I().HB)(i)}F().R9({environment:o,store:e.getPropertyStore(n),value:r,transaction:p})}}const Y=(0,h().YK)({FAILED_TO_AUTOFILL:{defaultMessage:"Something went wrong. Please try again later",id:"propertyCompletionActions.propertyCompletionActions.error.unableToAutofill"},INVALID_PROPERTY_FOR_AUTOFILL:{defaultMessage:"Invalid property configuration for AI autofill",id:"propertyCompletionActions.propertyCompletionActions.error.invalidPropertyForAutofill"},NO_BLOCKS_TO_AUTOFILL:{defaultMessage:"Nothing to update with AI",id:"propertyCompletionActions.propertyCompletionActions.error.noBlocksToAutofill"}}),Z=(0,h().YK)({featureUnavailable:{id:"completionActions.featureNotEnabledError",defaultMessage:"This feature is not currently enabled"}});function q({autofillPropertyResult:e}){const t=c().A.formatMessage(Y[e]);u().N2(),d().c1(t)}const J={ai_limit_property_autofill:(0,R.jsx)(h().sA,{defaultMessage:"This workspace has used all of its free AI responses. Contact your workspace owner to upgrade Notion AI.",id:"aiAutofill.outOfAiBusinessUpsellDialogMessage"}),ai_autofill_try_on_view:(0,R.jsx)(h().sA,{defaultMessage:"This workspace has used all of its free AI responses. Contact your workspace owner to upgrade Notion AI.",id:"aiAutofill.outOfAiUpgradedUpsellDialogMessage"}),ai_autofill_on_page_edit:(0,R.jsx)(h().sA,{defaultMessage:"Auto-update requires upgraded Notion AI. Contact your workspace owner to upgrade Notion AI.",id:"aiAutofill.autoUpdateOnPageEditAiUpgradedUpsellDialogMessage"}),ai_autofill_fill_all_pages:(0,R.jsx)(h().sA,{defaultMessage:"Updating all pages requires upgraded Notion AI. Contact your workspace owner to upgrade Notion AI.",id:"aiAutofill.fillAllPagesAiUpgradedUpsellDialogMessage"}),ai_autofill_bulk_fill:(0,R.jsx)(h().sA,{defaultMessage:"Filling more pages at once requires upgraded Notion AI. Contact your workspace owner to upgrade Notion AI.",id:"aiAutofill.bulkFillAiUpgradedUpsellDialogMessage"})};function Q({environment:e,from:t,upsell:o,store:n}){const i=(0,a().f)(n);null!=i&&i.canAdmin()||d().c1(J[t]),E().K(e,{from:t,upsell:o,spaceStore:i})}function G({errorCode:e,environment:t,autofillAvailability:o,collectionStore:n}){return 405===e?u().D6({label:c().A.formatMessage(Z.featureUnavailable)}):(402===e&&o.upsell&&(u().N2(),Q({environment:t,from:"ai_limit_property_autofill",upsell:o.upsell,store:n})),z().showCompletionErrorWithCode(e))}async function X({environment:e,stores:t,property:o,propertySchema:n,userEventForAnalytics:i,sessionIdForAnalytics:s,collectionContextStore:c,from:d,isBulkAction:m,aiInferenceOverride:g,transaction:y}){var A,h;const _=s||v().JW(),w=o,M=t.map((e=>({spaceId:e.getSpaceId(),...e.pointer,propertyId:w,inferenceId:v().JW()}))),x=t[0].getAssociatedCollectionId()??(null==c||null===(A=c.collectionStore())||void 0===A?void 0:A.id)??(null===(h=t[0].getCollectionStoreIfSingleSource())||void 0===h?void 0:h.id),P=new(l().A)({name:"propertyCompletionActions.autofillPropertyForBlocks"});if(j().m.setIsWriting({stores:t,propertySchema:n,sessionIdForAnalytics:s,collectionId:x}),"uninitialized"!==j().m.state.type&&(0,f().$M)(n)&&x){u().D6({label:(0,R.jsx)(U,{environment:e,inferenceIds:M.map((e=>e.inferenceId)),aiInference:(0,f().om)(n)}),durationMs:p().LX});try{var T;if(e.defaultRecordCache.inMemoryRecordCache.addCacheOverride(P),!(0,I().EI)(M))return q({autofillPropertyResult:"NO_BLOCKS_TO_AUTOFILL"});const o=g||(0,f().om)(n);if(!o)return q({autofillPropertyResult:"INVALID_PROPERTY_FOR_AUTOFILL"});M.forEach((t=>{D().trackAiAutofillAction(e,{type:i,inference_id:t.inferenceId,ai_inference_type:o.type,collection_id:x,session_id:_})}));const s=(0,a().f)(null==c?void 0:c.collectionStore());s&&b().callApi({eventName:"publishAiSession",environment:e,data:{inference_type:"autofill",id:_,spaceId:s.id,metadata:{blockPropertyPointers:M,aiInference:o,collection_id:x}}});const l=await(0,W().B)(e,{name:"collection_property_autofill",spaceId:null==s?void 0:s.id,userId:null===(T=r().default.state.currentUserStore)||void 0===T?void 0:T.id,amount:"unknown"}),u=await b().callStreamApi({eventName:"getCompletionForProperty",environment:e,data:{blockPropertyPointers:M,aiInference:o,aiSessionId:_,model:"default"}});if("success"!==u.type)return q({autofillPropertyResult:"FAILED_TO_AUTOFILL"});c&&(0,k().E)({block_id:t[0].pointer.id,property:w,property_type:n.type,from:d,environment:e,collectionContextStore:c,isFromBulkActionsToolbar:m});const p=Object.fromEntries(t.map((e=>[e.pointer.id,{store:e,temporaryStore:e.clone(P),completion:""}]))),v=new Set,[A,h,R]=await Promise.all([O().g.load(),L().S.load(),C().R.clipboardActions.load()]);if(S().hS.is(u.data)){for await(const t of u.data){if("error"===t.type)return j().m.setState({...j().m.state,didInterruptStreaming:!0}),G({errorCode:t.errorCode,environment:e,autofillAvailability:l,collectionStore:null==c?void 0:c.collectionStore()});if(j().m.state.didInterruptStreaming)return;const o=p[t.blockPropertyPointer.id],i=o.completion+t.completion;p[t.blockPropertyPointer.id]={...o,completion:i},v.add(t.blockPropertyPointer.id),y?$({environment:e,propertyId:w,propertySchema:n,storesWithCompletions:Object.values(p),useTemporaryStore:!0,markdownLinkifyIt:A,tinyMceMicrosoftWordPasteFilter:h,clipboardActions:R,doneStreaming:!0,aiInferenceOverride:g,transaction:y}):K({environment:e,propertyId:w,propertySchema:n,storesWithCompletions:Object.values(p),useTemporaryStore:!0,markdownLinkifyIt:A,tinyMceMicrosoftWordPasteFilter:h,clipboardActions:R,aiInferenceOverride:g}),j().m.setState({...j().m.state,numBlocksAutofilled:v.size})}j().m.setState({...j().m.state,haveAllBlocksCompletedAutofill:!0})}e.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(P),y?$({environment:e,propertyId:w,propertySchema:n,storesWithCompletions:Object.values(p),useTemporaryStore:!1,markdownLinkifyIt:A,tinyMceMicrosoftWordPasteFilter:h,clipboardActions:R,doneStreaming:!0,aiInferenceOverride:g,transaction:y}):K({environment:e,propertyId:w,propertySchema:n,storesWithCompletions:Object.values(p),useTemporaryStore:!1,markdownLinkifyIt:A,tinyMceMicrosoftWordPasteFilter:h,clipboardActions:R,doneStreaming:!0,aiInferenceOverride:g})}finally{e.defaultRecordCache.inMemoryRecordCache.hasCacheOverride(P)&&e.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(P)}}}async function ee(e){const t=s().default.checkGate({gateName:"autofill_all_pages_use_new_endpoint"})?ne:ie;return await t(e)}const te=(0,h().YK)({invalidCollectionSource:{id:"propertyCompletionActions.error.invalidCollectionSource",defaultMessage:"There was a problem with the database."},noMemcachedRecord:{id:"propertyCompletionActions.error.noMemcachedRecord",defaultMessage:"Something went wrong. Please try again."},lockAlreadyTaken:{id:"propertyCompletionActions.error.lockAlreadyTaken",defaultMessage:"A fill is already in progress"},invalidUser:{id:"propertyCompletionActions.error.invalidUser",defaultMessage:"The provided user information is not valid."},invalidCollectionView:{id:"propertyCompletionActions.error.invalidCollectionView",defaultMessage:"We encountered an issue accessing the collection view."},invalidCollection:{id:"propertyCompletionActions.error.invalidCollection",defaultMessage:"The collection you are trying to access is not valid."},noLoadedUser:{id:"propertyCompletionActions.error.noLoadedUser",defaultMessage:"User information is missing."},noUserTimeZone:{id:"propertyCompletionActions.error.noUserTimeZone",defaultMessage:"User time zone information is not available."},unauthorizedCollectionAccess:{id:"propertyCompletionActions.error.unauthorizedCollectionAccess",defaultMessage:"Insufficient permissions"},unableToQueryCollection:{id:"propertyCompletionActions.error.unableToQueryCollection",defaultMessage:"We couldn’t retrieve the collection details at this time."},invalidPropertyForAutofill:{id:"propertyCompletionActions.error.invalidPropertyForAutofill",defaultMessage:"The property provided for autofill is not valid."},NoResults:{id:"propertyCompletionActions.error.noResults",defaultMessage:"No results were found. Please try again."},somethingWentWrong:{id:"propertyCompletionActions.error.somethingWentWrong",defaultMessage:"Something went wrong. Please try again later."}});function oe(e){switch(e){case"invalidCollectionSource":return(0,R.jsx)(h().sA,{...te.invalidCollectionSource});case"noMemcachedRecord":return(0,R.jsx)(h().sA,{...te.noMemcachedRecord});case"lockAlreadyTaken":return(0,R.jsx)(h().sA,{...te.lockAlreadyTaken});case"invalidUser":return(0,R.jsx)(h().sA,{...te.invalidUser});case"invalidCollectionView":return(0,R.jsx)(h().sA,{...te.invalidCollectionView});case"invalidCollection":return(0,R.jsx)(h().sA,{...te.invalidCollection});case"noLoadedUser":return(0,R.jsx)(h().sA,{...te.noLoadedUser});case"noUserTimeZone":return(0,R.jsx)(h().sA,{...te.noUserTimeZone});case"unauthorizedCollectionAccess":return(0,R.jsx)(h().sA,{...te.unauthorizedCollectionAccess});case"unableToQueryCollection":return(0,R.jsx)(h().sA,{...te.unableToQueryCollection});case"invalidPropertyForAutofill":return(0,R.jsx)(h().sA,{...te.invalidPropertyForAutofill});case"NoResults":return(0,R.jsx)(h().sA,{...te.NoResults});case"somethingWentWrong":return(0,R.jsx)(h().sA,{...te.somethingWentWrong});default:return(0,R.jsx)(h().sA,{defaultMessage:"An unexpected error occurred. Please try again.",id:"propertyCompletionActions.error.unknown"})}}async function ne(e){var t,o;const{environment:n,collectionStore:s,propertySchema:l,property:d,collectionViewStore:p}=e;if(!(0,f().$M)(l))return;const m=(0,f().om)(l);if(!s||!l||!m)return;const g=null===(t=(0,a().f)(s))||void 0===t?void 0:t.id;if(!g)return;if(!(null===(o=r().default.state.currentUserStore)||void 0===o?void 0:o.id))return;const v=c().A.getIntl(),y=(0,B().tS)({environment:n,intl:v,store:s});if(!(await M().U({sourceAction:"fill_all_pages",propertyName:l.name,collectionName:y})))return;(0,i().u)({environment:n,event:{eventName:"generate_from_fill_all_pages_in_view",eventProperties:{collection_id:s.id,ai_inference_type:m.type}}});const A=(0,x().UT)(n,w,{spaceId:g,collectionSource:{id:s.id,type:"collection",spaceId:g},collectionViewPointer:p.pointer,propertyId:d},{spaceIds:[]});for await(const i of A){var h;if(_().Q.isFail(i)||"failure"===i.taskStatus)return void u().D6({label:oe("somethingWentWrong")});if("error"===(null===(h=i.value)||void 0===h?void 0:h.status)){const e=i.value.errorType;return void u().D6({label:oe(e)})}}}async function ie({environment:e,collectionStore:t,propertySchema:o,property:n,sessionIdForAnalytics:i}){var a;if(!(0,f().$M)(o))return;const s=(0,f().om)(o);if(!t||!o||!s)return;const l=await(0,W().B)(e,{name:"collection_property_autofill",spaceId:t.getSpaceId(),userId:null===(a=r().default.state.currentUserStore)||void 0===a?void 0:a.id,amount:"unknown"});if(!(0,A().e2)(l))return void Q({environment:e,from:"ai_autofill_fill_all_pages",upsell:l.upsell,store:t});const d=c().A.getIntl(),u=(0,B().tS)({environment:e,intl:d,store:t});if(!(await M().U({sourceAction:"fill_all_pages",propertyName:o.name,collectionName:u})))return;D().trackAiAutofillAction(e,{type:"generate_from_fill_all_pages",inference_id:v().JW(),ai_inference_type:s.type,collection_id:t.id,session_id:i??v().JW()});const p=[];p.push(y().op.update({pointer:t.pointer,path:["format","update_ai_inferences_status"],args:{[n]:{type:"requested",created_time:Date.now()}}})),(0,N().p)({environment:e,collectionStore:t,performTransaction:e=>{for(const o of p)V().applyOperation({store:(0,m().v3)(t,o.pointer),operation:o,transaction:e})}})}function re(e){const{environment:t,propertySchema:o,collectionStore:n,property:i,draftAiInference:r}=e;let a="";switch(o.type){case"text":a="ai_inference";break;case"select":case"multi_select":a="select_ai_inference";break;default:return}const s=[];if(s.push({pointer:n.pointer,command:"set",path:["schema",i,a],args:r}),r)D().trackAiAutofillSettingsAction(t,{type:"set_ai_inference",ai_inference_type:r.type,collection_id:n.id});else{const e=(0,f().om)(o);D().trackAiAutofillSettingsAction(t,{type:"remove_ai_inference",ai_inference_type:null==e?void 0:e.type,collection_id:n.id})}(0,N().p)({environment:t,collectionStore:n,performTransaction:e=>{for(const t of s)V().applyOperation({store:(0,m().v3)(n,t.pointer),operation:t,transaction:e})}})}function ae(e,t){if(!(0,f().$M)(e))return;const o=(0,f().om)(e);return!o&&(0,f().lx)(e)?{type:e.type,auto_update_on_edit:t,add_options:!1}:o}},730307:(e,t,o)=>{o.d(t,{l:()=>m});var n=()=>o(779315),i=()=>o(292985),r=()=>o(161479),a=()=>o(878523),s=()=>o(129522),l=()=>o(404783),c=()=>o(555776),d=()=>o(116008),u=()=>o(36088),p=()=>o(405981);async function m(e){var t;const{environment:o,blockStore:m,rect:f,property_id:g,from:v}=e;if(d().A.hasContent())return void(0,p()._y)({environment:o,reason:"starting_new"});const y=s().K.getRect(m);if(!y)return;const A=new(l().A)(o,(0,r().e)(m.pointer.spaceId)),h=y.width,S=y.height,_=y.right-h;d().A.setState({open:!0,rect:f||new DOMRect(_,y.top,h,S),type:"block",content:"comment",blockStore:m,blockId:m.id,discussionInputStore:A,property_id:g,lastKnownBlockStore:m,from:v}),(0,i().V)({element:null===(t=n().A.UpdateSidebarCommentScroller)||void 0===t?void 0:t.getNode(),environment:o,options:{top:0,behavior:"smooth"}}),c().A.setActiveWithSource("text_annotation"),await(0,u().M)({discussionInputStore:A,environment:o}),a().j4(o,{from:v})}},738508:(e,t,o)=>{o.r(t),o.d(t,{cursorIcon:()=>r,iconDefinition:()=>i});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"1.25 0 17.5 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("g",{className:"logo-light-mode",children:[(0,n.jsxs)("g",{clipPath:"url(#clip0_16020_205)",children:[(0,n.jsx)("path",{fill:"#757575",d:"m9.995 9.987 8.658 4.999a.6.6 0 0 1-.226.226l-8.092 4.672a.68.68 0 0 1-.68 0l-8.092-4.672a.6.6 0 0 1-.226-.226z"}),(0,n.jsx)("path",{fill:"#525252",d:"M9.995 0v9.987l-8.658 4.999a.6.6 0 0 1-.082-.309v-9.38c0-.22.117-.424.308-.534L9.655.09a.7.7 0 0 1 .34-.09"}),(0,n.jsx)("path",{fill:"#404040",d:"M18.652 4.989a.6.6 0 0 0-.225-.226L10.334.09A.7.7 0 0 0 9.995 0v9.987l8.658 4.999a.6.6 0 0 0 .083-.309v-9.38c0-.11-.03-.216-.083-.308"}),(0,n.jsx)("path",{fill:"#D9D9D9",d:"M18.047 5.339a.29.29 0 0 1 0 .29l-7.859 13.61c-.053.093-.193.055-.193-.05v-8.97a.4.4 0 0 0-.054-.201z"}),(0,n.jsx)("path",{fill:"#fff",d:"m18.047 5.339-8.106 4.68a.4.4 0 0 0-.147-.147L2.027 5.387c-.092-.053-.054-.193.052-.193h15.717c.111 0 .202.06.25.145"})]}),(0,n.jsx)("defs",{children:(0,n.jsx)("clipPath",{id:"clip0_16020_205",children:(0,n.jsx)("path",{fill:"#fff",d:"M1.255 0h17.49v20H1.256z"})})})]}),(0,n.jsxs)("g",{className:"logo-dark-mode",children:[(0,n.jsxs)("g",{clipPath:"url(#clip0_16020_213)",children:[(0,n.jsx)("path",{fill:"#6E6E6E",d:"m9.995 9.987 8.658 4.999a.6.6 0 0 1-.226.226l-8.092 4.672a.68.68 0 0 1-.68 0l-8.092-4.672a.6.6 0 0 1-.226-.226z"}),(0,n.jsx)("path",{fill:"#4A4A4A",d:"M9.995 0v9.987l-8.658 4.999a.6.6 0 0 1-.082-.309v-9.38c0-.22.117-.424.308-.534L9.655.09a.7.7 0 0 1 .34-.09"}),(0,n.jsx)("path",{fill:"#383838",d:"M18.652 4.989a.6.6 0 0 0-.225-.226L10.334.09A.7.7 0 0 0 9.995 0v9.987l8.658 4.999a.6.6 0 0 0 .083-.309v-9.38c0-.11-.03-.216-.083-.308"}),(0,n.jsx)("path",{fill:"#C9C9C9",d:"M18.047 5.339a.29.29 0 0 1 0 .29l-7.859 13.61c-.053.093-.193.055-.193-.05v-8.97a.4.4 0 0 0-.054-.201z"}),(0,n.jsx)("path",{fill:"#fff",d:"m18.047 5.339-8.106 4.68a.4.4 0 0 0-.147-.147L2.027 5.387c-.092-.053-.054-.193.052-.193h15.717c.111 0 .202.06.25.145"})]}),(0,n.jsx)("defs",{children:(0,n.jsx)("clipPath",{id:"clip0_16020_213",children:(0,n.jsx)("path",{fill:"#fff",d:"M1.255 0h17.49v20H1.256z"})})})]})]})},r=(0,o(340498).wt)("cursor",i,"default")},741817:(e,t,o)=>{o.d(t,{v:()=>a});var n=()=>o(18387),i=()=>o(299545),r=()=>o(588836);function a(e){const{discussionStore:t,transaction:o}=e,a=i().No(t);a&&(0,r().u)({discussionIds:[t.id],transaction:o,blockStore:a});const s=(0,n().Z)();if(s){const e=i().zo({blockStore:s,transclusionReferences:"recurseInto",childPages:"omit"});for(const n of e){if(a&&n.table===a.table&&n.id===a.id)continue;const e=i().bN(n).getValue();null!=e&&e.includes(t.id)&&(0,r().u)({discussionIds:[t.id],transaction:o,blockStore:n})}}}},783793:(e,t,o)=>{o.d(t,{o:()=>c,x:()=>l});o(296540);var n=()=>o(401497),i=()=>o(100622),r=()=>o(278589),a=()=>o(200424),s=o(474848);function l(e){const{variant:t,imgSource:o,tintColor:a,faceStyle:l,shadowVariant:d="strong",style:u,...p}=e,m=(0,n().IS)((()=>{const e=(0,r().N)(t);return{faceImgWrap:{width:e,height:e,borderRadius:"100%",background:i().Tj.assistantCornerButtonBackground,..."strong"===d&&{boxShadow:e>=90?i().Tj.shadowMDThickerOutline:i().Tj.shadowMD},..."light"===d&&{borderRadius:"50%",boxShadow:e>=90?i().Tj.shadowSMThickerOutline:i().Tj.shadowSM},overflow:"hidden",...u}}}),[t,d,u]);return(0,s.jsx)("div",{...p,children:(0,s.jsx)("div",{style:m.faceImgWrap,children:(0,s.jsx)(c,{imgSource:o,variant:t,tintColor:a,style:l})})})}function c(e){const{imgSource:t,variant:o,tintColor:i,style:l,alt:c,...d}=e,u=(0,r().N)(o),p=t??a(),m=c??"Notion AI face",f=(0,n().IS)((()=>({faceImg:{height:u,width:u,transform:"scaleX(var(--direction, 1))",...l},tintedFace:{height:u,width:u,transform:"scaleX(var(--direction, 1))",backgroundColor:i,WebkitMaskImage:`url(${p})`,maskImage:`url(${p})`,WebkitMaskRepeat:"no-repeat",maskRepeat:"no-repeat",WebkitMaskPosition:"center",maskPosition:"center",WebkitMaskSize:"contain",maskSize:"contain",...l}})),[u,l,i,p]);return void 0!==i?(0,s.jsx)("div",{style:f.tintedFace,role:"img","aria-label":m}):(0,s.jsx)("img",{...d,style:f.faceImg,src:p,alt:m})}},797573:(e,t,o)=>{o.d(t,{B:()=>r,o:()=>i});o(581454);var n=()=>o(402390);function i(e,t){return e.map((e=>r(e,t)))}function r(e,t){const{nameMessage:o,descriptionMessage:i,...r}=e,{rootId:a,previewRootId:s,spaceId:l}=function(e,t){const o=(0,n().H)(t);return e.sources[o]||e.sources[n().q]}(e,t);return{...r,id:o.id,rootId:a,spaceId:l,previewRootId:s,name:t.formatMessage(o),description:i?t.formatMessage(i):void 0}}},820579:(e,t,o)=>{o.r(t),o.d(t,{arrowLineDownIcon:()=>i,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.52 2.39 12.95 15.21",svg:(0,o(474848).jsx)("path",{d:"M10 2.4c.345 0 .625.28.625.625v9.966l3.333-3.333a.625.625 0 1 1 .884.884l-4.4 4.4a.625.625 0 0 1-.884 0l-4.4-4.4a.625.625 0 0 1 .884-.884l3.333 3.333V3.025c0-.345.28-.625.625-.625M4.15 16.35a.625.625 0 1 0 0 1.25h11.7a.625.625 0 0 0 0-1.25z"})},i=(0,o(340498).wt)("arrowLineDown",n,"default")},831566:(e,t,o)=>{o.d(t,{p:()=>r});var n=()=>o(244828),i=()=>o(724456);function r(e){const{environment:t,collectionStore:o,performTransaction:r}=e;return n().createAndCommit({userAction:"collectionViewActions.createSchemaUpdateTransaction",environment:t,canUndo:!0,perform:e=>{const n=o.getSchema(),a=r(e),s=o.getSchema();return(0,i().H)({environment:t,collectionStore:o,oldSchema:n,newSchema:s,transaction:e}),a}}).performResult}},839754:(e,t,o)=>{o.d(t,{Bi:()=>b,My:()=>k,ZM:()=>M,_M:()=>C,navigateToWorkflowTemplateOnboardingModal:()=>x});o(16280),o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(581454);var n=()=>o(907258),i=()=>o(295633),r=()=>o(584262),a=()=>o(663077),s=()=>o(179034),l=()=>o(201980),c=()=>o(896628),d=()=>o(384944),u=()=>o(730969),p=()=>o(840153),m=()=>o(339798),f=()=>o(180762),g=()=>o(799832),v=()=>o(111379),y=()=>o(535960),A=()=>o(31173),h=()=>o(295304),S=()=>o(244828),_=()=>o(373444),I=()=>o(165592),w=()=>o(204067);function k({transaction:e,collectionStore:t,propertyTemplates:o}){var n;const i=(null===(n=t.getParentBlockStore())||void 0===n?void 0:n.getCollectionViewStores().filter((e=>"table"===e.getType())))??[];if(0===i.length)return;const r=[];for(const l of o){const e=(0,w().S1)({collectionStore:t,templateId:l.templateId,instancePointerType:"property"});e&&r.push({property:e.id,visible:!(0,a().Sz)(l),...l.tablePropertyFormat})}if(0!==r.length)for(const a of i){var s;const t=(null===(s=a.getPropertyFormatsStore("table_properties"))||void 0===s?void 0:s.getValue())??[],o=new Set(t.map((e=>e.property))),n=r.filter((e=>!o.has(e.property)));0!==n.length&&c().zA({stores:[a],update:{table_properties:[...t,...n]},transaction:e})}}function b({transaction:e,collectionStore:t,propertyTemplates:o}){const n=[];for(const s of o){const e=(0,w().S1)({collectionStore:t,templateId:s.templateId,instancePointerType:"property"});e&&n.push({property:e.id,visible:!0})}const i=t.getFormat().collection_page_properties??[],r=new Set(i.map((e=>e.property))),a=n.filter((e=>!r.has(e.property)));a.length&&c().zA({stores:[t],update:{collection_page_properties:[...i,...a]},transaction:e})}function C({environment:e,newPageStore:t,result:o}){"accepted_template"!==o.type&&"accepted_empty_collection"!==o.type||S().createAndCommit({environment:e,canUndo:!1,perform:n=>{const r=t.getTitleValue();if(d().zv({store:t,transaction:n,data:{alive:!1}}),"accepted_empty_collection"===o.type&&!(0,l().w9s)(r)){const a=i().B.createChildStore(t,{table:"block",id:o.blockId}).getTitleStore();a&&h().yr({environment:e,transaction:n,tokens:r,index:0,store:a})}const a=t.getParentStore();if((null==a?void 0:a.table)===s().ev){const e=a.getContentIds();d().zv({store:a,transaction:n,data:{content:e.filter((e=>e!==t.id))}})}},userAction:"clean_up_empty_new_page"})}function M({environment:e,userAction:t,result:o,existingCollectionViewBlockStore:n,existingCollectionStore:i}){if("canceled"!==o.type){if("accepted_empty_collection"===o.type&&i){const n=i.getKeyStore("name"),r=(0,l().x9d)(o.newCollectionTitle);n&&S().createAndCommit({userAction:t,environment:e,canUndo:!0,perform:t=>h().R9({environment:e,store:n,transaction:t,value:r})})}if(n){var r;const e=null===(r=(0,g().U)(n))||void 0===r?void 0:r.settingsStore;e&&m().os({collectionSettingsStore:e})}if("accepted_template"===o.type&&null!=n&&n.isCollectionView()&&(null==n||!n.hasSingleSourceAndNoLinkedCollections())){const t=(0,g().U)(n),i=n.getCollectionViewStores().find((e=>{var t;return(null===(t=e.getCollectionStore())||void 0===t?void 0:t.id)===o.collectionId}));if(!t||!i)return;(0,f().t)({environment:e,collectionContextStore:t,collectionViewId:i.id,isFullScreen:t.isFullScreenStore.state,isRootChild:t.isRootChildStore.state,isInPeekRenderer:t.isInPeekRendererStore.state})}}}async function x({environment:e,collectionViewBlockStore:t}){const o=t.id;if(!t.isDefined()){const n=await(0,A().$)({environment:e,blockId:o});if(!n)return;e=await p().T({environment:e,newCurrentUserId:n}),t=new(i().B)(e,{table:s().ev,id:o}),await t.load()}const a=t.getSpaceId();if(!a)throw new Error("Space ID not found for collection block");const l=(0,v().k)(a);if(!l)throw new Error(`Space view not found for space ID: ${a}`);const{sidebarSpaceStore:c}=n().default.state;(null==c?void 0:c.id)!==a&&await(0,u().y)({environment:e,spaceViewStore:l});const d=t.getFormat();if("workflow_template_placeholder"===(null==d?void 0:d.collection_view_sub_type)&&null!=d&&d.placeholder_workflow_template_id&&t.isCollectionView()){const{getCollectionTemplateFromId:o}=await I().t.load(),n=o(d.placeholder_workflow_template_id);if(!n)throw new Error(`Collection template "${d.placeholder_workflow_template_id}" not found`);const{onNavigateToPlaceholderWorkflowTemplateBlock:i}=await _().O.load();i({environment:e,collectionTemplate:n,collectionViewBlockStore:t})}else(0,y().u)({environment:e,store:t,pageVisitSource:r().y8.WorkflowTemplatesDeeplink})}},888325:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{_:()=>n})},922952:(e,t,o)=>{o.d(t,{u:()=>a});var n=()=>o(295633),i=()=>o(302996),r=()=>o(723085);function a(e){return e instanceof r().h||e instanceof i().SpaceStore||e instanceof n().B}},994006:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var n=o(474848);const i=function(e){const t={marginInlineEnd:e.avatarMarginRight??6,alignSelf:"center"},i={display:"flex",alignItems:"center",minWidth:0,...e.style},r=e.inline?{...t,width:"none",minHeight:"none"}:t,{userStore:a,avatarShouldShowShadow:s,avatarSize:l,hasTooltip:c,tooltipHeader:d,hasPersonHoverCard:u,spaceStore:p}=e,m=(0,o(69708).tz)(),f=(0,o(590526).K8)((()=>null==a?void 0:a.getDisplayName(m)),[a,m]),g=(0,n.jsxs)("div",{style:i,children:[(0,n.jsx)("div",{style:r,children:(0,n.jsx)(o(453697).A,{userStore:a,avatarShouldShowShadow:s,size:l,hasTooltip:c&&!u,hasPersonHoverCard:!1,tooltipHeader:d})}),(0,n.jsx)("div",{className:"notranslate",style:{...o(284371).RC},children:f})]});return u?(0,n.jsx)(o(436525).D,{userStore:a,spaceStore:p,children:g}):g}}}]);