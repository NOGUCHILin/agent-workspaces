"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[2411,21475,32626,90871,99171],{24126:(e,t,o)=>{o.d(t,{c:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.9 2.75 12.18 14.49",svg:(0,o(474848).jsx)("path",{d:"M12.626 2.768a.625.625 0 0 1 0 1.224l-.126.013h-.125v4.794l3.366 5.159c.893 1.369-.03 3.17-1.623 3.281l-.156.006H6.039c-1.688 0-2.703-1.873-1.78-3.287l3.366-5.157V4.005H7.5a.625.625 0 0 1 0-1.25h5zM8.875 9.173l-.102.156-1.567 2.401h5.589l-1.569-2.403-.101-.156V4.005h-2.25z"})},r=(0,o(340498).wt)("beaker",n,"default")},175213:(e,t,o)=>{o.d(t,{G:()=>r});var n=()=>o(314529);function r(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"delete_property",t)}},241319:(e,t,o)=>{o.d(t,{y:()=>a});o(898992),o(672577);var n=()=>o(534177),r=()=>o(239381);function a(e){var t;const{actionModels:o,id:a}=e,i=(0,r().y5)(a),l="action"===i.source?o.find((e=>e.id===i.action_id)):void 0,c=(0,n().O9)(l)&&l.isType("create_page")?null===(t=l.getConfig())||void 0===t?void 0:t.collection:void 0;return{automationValueInfo:i,collectionPointer:c,actionModel:l}}},299177:(e,t,o)=>{o.d(t,{A:()=>a});class n extends(()=>o(757695))().Store{getInitialState(){return{}}}const r=new n;o(852832).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",r);const a=r},326887:(e,t,o)=>{o.d(t,{$X:()=>a,H8:()=>i,x2:()=>r});var n=()=>o(534177);function r(e){return"event"===e||"recurrence"===e}function a(e){const t=e.getTrigger();return(0,n().O9)(t)&&r(t.type)}function i(e){return"event"===e?"event":"recurrence"===e?"recurrence":void(0,n().HB)(e)}},348869:(e,t,o)=>{o.d(t,{g:()=>l});o(944114);var n=()=>o(792057),r=()=>o(785728),a=()=>o(532659),i=()=>o(753812);async function l(e){const{environment:t,onResponse:o,data:l,userId:c,tracking:s,abortSignal:u}=e,d=await i().callStreamApi({eventName:"runInferenceTranscript",environment:t,data:l,userId:c,tracking:s,abortSignal:u,headers:(0,r().WS)({spaceId:l.spaceId})});if("success"!==d.type)return null!=u&&u.aborted?{error:{message:"Aborted",code:0}}:(n().Qg(d),{error:{message:d.error.message,code:d.status}});const p=[];if(a().hS.is(d.data))for await(const n of d.data){if("error"===n.type)return{error:{message:n.message,code:n.errorCode}};null==o||o(n),p.push(n)}return{value:p}}},390527:(e,t,o)=>{o.r(t),o.d(t,{DEFAULT_MAX_RECURRENCE_DUPLICATION_PER_TASK:()=>O,MAXIMUM_DAILY_RECURRENCES_IN_PATH:()=>T,MAXIMUM_NESTED_RECURRENCE_LEVEL:()=>b,MAX_RECURRENCE_INTERVAL:()=>v,MAX_RECURRENCE_NUMBER_OF_RUNS:()=>g,RRULE_WEEKDAYS_MAP:()=>_,adjustedStartDateIfPossible:()=>C,areRecurrenceSchedulesEqual:()=>F,convertFromUnpersistedRecurrenceConfig:()=>N,convertToUnpersistedRecurrenceConfig:()=>R,getFormattedEndCondition:()=>E,getFormattedNextRecurrenceTime:()=>I,getNewEndTimestamp:()=>V,getNextDateUtc:()=>A,getRecurrenceAfter:()=>k,isRunningBetweenMidnightAnd3AM:()=>w,isValidRecurrenceInterval:()=>h,isValidRecurrenceNumberOfRuns:()=>S,rruleFromRecurrence:()=>M,templateAncestorsViolateRecurrenceNesting:()=>x});o(898992),o(354520),o(581454);var n=()=>o(906745);o(944114);function r(e,...t){if(0===t.length)return e.map((e=>[e]));const o=[];for(const n of e)o.push(...r(t[0],...t.slice(1)).map((e=>[n,...e])));return o}var a=()=>o(496603),i=()=>o(534177),l=()=>o(720665),c=()=>o(597777),s=()=>o(869190),u=()=>o(416504),d=()=>o(402390);class p extends(()=>o(896346))().p3{constructor(e,t){super(e,t)}after(e,t){return super.after(e,t)}}var m=()=>o(912720);const f=(0,o(69708).YK)({dateAtTime:{id:"automations.recurrenceHelpers.dateAtTime",defaultMessage:"{date} at {time}"},dateBetweenMidnightAnd3AM:{id:"automations.recurrenceHelpers.dateBetweenMidnightAnd3AM",defaultMessage:"{date} between 12â€“3 AM"},numberEndConditionDescription:{id:"automations.recurrenceHelpers.numberEndConditionDescription",defaultMessage:"{number, plural, one {After {number} run} other {After {number} runs}}"},noEndCondition:{id:"automations.recurrenceHelpers.noEndCondition",defaultMessage:"Never"}}),y={hour:p.HOURLY,day:p.DAILY,week:p.WEEKLY,month:p.MONTHLY,year:p.YEARLY},_={MO:p.MO,TU:p.TU,WE:p.WE,TH:p.TH,FR:p.FR,SA:p.SA,SU:p.SU},v=99,g=999;function h(e){return(0,l().Et)(e)&&Number.isInteger(e)&&e>0&&e<=v}function S(e){return(0,l().Et)(e)&&Number.isInteger(e)&&e>0&&e<=g}function M(e){const{start_date:t,frequency:o,interval:n,weekdays:a,timezone:l,hour:s,minute:u}=e,d=(0,c().eU)(t);"hour"===o&&d.setUTCHours(s??0,u??0,0,0);const m="week"===o&&a?a.map((e=>_[e])):void 0,f={};return(0,i().O9)(e.end_condition)&&("date"===e.end_condition.type?f.until=(0,c().eU)(e.end_condition.end_at):"number"===e.end_condition.type?f.count=e.end_condition.number_of_occurrences:(0,i().HB)(e.end_condition)),"month"===e.frequency&&(0,i().O9)(e.monthly_restriction)&&("monthdays"===e.monthly_restriction.type?f.bymonthday=e.monthly_restriction.monthdays:"weekdays_in_month"===e.monthly_restriction.type?f.byweekday=r(e.monthly_restriction.weekdays,e.monthly_restriction.week_numbers).map((([e,t])=>_[e].nth(t))):(0,i().HB)(e.monthly_restriction)),new p({freq:y[o],dtstart:d,interval:n,byweekday:m,tzid:"hour"===o?void 0:l,..."hour"===o?{}:{byhour:s??0,byminute:u??0,bysecond:0},...f})}const b=1,T=1;function x(e){var t;if(0===e.length)return{violatesConstraint:!1,templateNestingExceedsMaxDepth:!1,ancestorHasDailyTemplate:!1,nestedDepthOfAutomationAncestors:void 0,immediateAncestorRecurrenceType:void 0};const o=e.filter((e=>{var t;return"day"===(null===(t=e.getRecurrence())||void 0===t?void 0:t.frequency)})),n=e.length,r=null===(t=e[0].getRecurrence())||void 0===t?void 0:t.frequency,a=n>b,i=o.length>=T;return{violatesConstraint:a||i,templateNestingExceedsMaxDepth:a,ancestorHasDailyTemplate:i,nestedDepthOfAutomationAncestors:n,immediateAncestorRecurrenceType:r}}function C(e){var t;const{recurrence:o,afterDate:r}=e;if("number"===(null===(t=o.end_condition)||void 0===t?void 0:t.type)||o.start_date>=r)return o;let a=n().DateTime.fromMillis(o.start_date,{zone:"utc"});const i=n().DateTime.fromMillis(r,{zone:"utc"});switch(o.frequency){case"hour":{const e=Math.floor(i.diff(a,"hours").hours/o.interval);a=a.plus({hours:e*o.interval});break}case"year":{const e=Math.floor(i.diff(a,"years").years/o.interval);a=a.plus({years:e*o.interval});break}case"month":{const e=Math.floor(i.diff(a,"months").months/o.interval);a=a.plus({months:e*o.interval});break}case"week":{const e=Math.floor(i.diff(a,"weeks").weeks/o.interval);a=a.plus({weeks:e*o.interval});break}case"day":{const e=Math.floor(i.diff(a,"days").days/o.interval);a=a.plus({days:e*o.interval});break}}return{...o,start_date:(0,c().DH)(a.toMillis())}}function k(e){const{recurrence:t,afterDate:o}=e;if((0,m().wt)(t)){const e=(0,c().l1)(o);return t.start_date>=e?new Date(t.start_date):void 0}{const e=M(C({recurrence:t,afterDate:o})).after((0,c().eU)(o));if(!e)return;return(0,c().h1)(e)}}function w(e){return 0===e.hour||1===e.hour||2===e.hour}function A(e){return M(e).after((0,c().eU)((0,c().Rz)()))||void 0}function I(e){const{recurrence:t,intl:o}=e,r=A(N(t));if(!r)return;const a=w(t),i=n().DateTime.fromJSDate(r).toUTC().setZone("local",{keepLocalTime:!0}).setLocale((0,d().H)(o)).setZone(t.timezone),l=(0,s().Yq)({date:i,dateFormat:"relative",allowRelativeDates:!0,intl:o,shortenDate:!0});if(a)return o.formatMessage(f.dateBetweenMidnightAnd3AM,{date:l});{let e=i.toLocaleString(n().DateTime.TIME_SIMPLE);return t.timezone!==(0,u().P)()&&(e+=` ${i.toFormat("ZZZZ")}`),o.formatMessage(f.dateAtTime,{date:l,time:e})}}function E(e,t){return(0,i().O9)(e)?"number"===e.type?t.formatMessage(f.numberEndConditionDescription,{number:e.number_of_occurrences}):"date"===e.type?(0,s().Yq)({date:n().DateTime.fromMillis(e.end_at),dateFormat:"relative",allowRelativeDates:!0,intl:t,shortenDate:!0}):void(0,i().HB)(e):t.formatMessage(f.noEndCondition)}const O=100;function R(e){return{...e,start_date:(0,c().l1)(e.start_date),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?{type:"date",end_at:(0,c().l1)(e.end_condition.end_at)}:(0,i().HB)(e.end_condition):void 0}}function V(e,t,o){return e.plus(o-t)}function D(e,t){const o=n().DateTime.fromMillis(t.end_at).set({hour:e.hour??0,minute:e.minute??0});return{type:"date",end_at:(0,c().Rz)(o.toJSDate())}}function N(e){return{...e,start_date:(0,c().Rz)(new Date(e.start_date)),end_condition:e.end_condition?"number"===e.end_condition.type?e.end_condition:"date"===e.end_condition.type?D(e,e.end_condition):(0,i().HB)(e.end_condition):void 0}}function F(e,t){const o=a().fN(e,(e=>void 0!==e)),n=a().fN(t,(e=>void 0!==e));return a().n4(o,n)}},422540:(e,t,o)=>{o.d(t,{$0:()=>v,Fx:()=>x,Ge:()=>f,I3:()=>p,Kj:()=>b,PP:()=>C,TK:()=>k,Yy:()=>d,aE:()=>w,cQ:()=>T,kH:()=>y,m7:()=>m,nq:()=>S,nv:()=>g,tj:()=>_});o(898992),o(354520),o(737550);var n=()=>o(496603),r=()=>o(534177),a=()=>o(381283),i=()=>o(898244),l=()=>o(651124),c=()=>o(349835),s=()=>o(390066);const u={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,place:!1},d={checkbox:[{type:"checkbox"}],date:[{type:"date"}],email:[{type:"text"}],multi_select:[{type:"text"},{of:{type:"text"},type:"array"}],number:[{type:"number"}],person:[{type:"person"},{of:{type:"person"},type:"array"}],phone_number:[{type:"text"}],relation:[{type:"block"},{of:{type:"block"},type:"array"}],select:[{type:"text"},{of:{type:"text"},type:"array"}],status:[{type:"text"},{of:{type:"text"},type:"array"}],text:void 0,title:void 0,url:[{type:"text"}]};function p(e){return Boolean(u[e.type]&&!(0,i().UU)(e)&&(!(0,i().$M)(e)||void 0===(0,i().om)(e)))}function m(e){const{collectionFormat:t,collectionSchema:o,filter:a,sort:c,sourcePropertyIds:u}=e,d=(u??(0,r().uv)(o)).filter(((t,n,r)=>{const l=o[t];return!(!l||!p(l))&&(("relation"!==l.type||!e.restrictCrossSpace||!(0,i().o2)(e.spaceId,l))&&(!a||a([t,l],n,o)))}));if(0===d.length)return[];if(!t||!1===c)return d;const m=(0,s().L)(t,o,void 0,l().jf.Page).collection_page_properties||[];return n().Ul(d,(e=>m.findIndex((t=>t.property===e))))}function f(e){const{collectionFormat:t,collectionSchema:o,sort:i}=e,c=(0,r().uv)(o).filter(((e,t,n)=>{const r=o[e];return!(!r||!(0,a().J)(r))}));if(0===c.length)return[];if(!t||!1===i)return c;const u=(0,s().L)(t,o,void 0,l().jf.Page).collection_page_properties||[];return n().Ul(c,(e=>u.findIndex((t=>t.property===e))))}function y(e){return e.type===c().M9.InvalidCharacter?{type:e.type,character:e.character}:e.type===c().M9.TokenExpected?{type:e.type,token:e.token}:e.type===c().uW.MissingSchemaPropertyOnThisRow||e.type===c().uW.MissingSchemaPropertyOnCollection?{type:e.type,collectionId:e.collectionId,property:e.property,errorSource:e.errorSource}:e.type===c().uW.ThisRowBlockPropertyMismatchCollection?{type:e.type,thisRowCollection:e.thisRowCollection,errorSource:e.errorSource}:e.type===c().uW.MissingContextVariable?{type:e.type,valueId:e.valueId,errorSource:e.errorSource}:e.type===c().uW.FunctionCallTooFewArguments?{type:e.type,numArguments:e.numArguments,errorSource:e.errorSource}:e.type===c().uW.FunctionCallUnexpectedArgument?{type:e.type,parameterIndex:e.parameterIndex,errorSource:e.errorSource}:e.type===c().uW.FunctionCallArgumentWrongType?{type:e.type,argumentType:e.argumentType,libraryFunctionName:e.libraryFunction.name,parameterIndex:e.parameterIndex,errorSource:e.errorSource}:e.type===c().uW.MissingDataDependencyBlock?{type:e.type,blockPointer:e.blockPointer,node:e.node,errorSource:e.errorSource}:e.type===c().uW.MissingDataDependencyPerson?{type:e.type,personPointer:e.personPointer,errorSource:e.errorSource}:e.type===c().uW.MemberPropertyMismatchCollection?{type:e.type,blockCollection:e.blockCollection,errorSource:e.errorSource}:e.type===c().uW.DownstreamParseFailure?{type:e.type,collectionId:e.collectionId,property:e.property,errorSource:e.errorSource}:e.type===c().uW.ContextVariableWrongType?{type:e.type,valueId:e.valueId,expectedType:e.expectedType,resultType:e.resultType,errorSource:e.errorSource}:e.type===c().uW.DisallowedValueType?{type:e.type,expressionValue:e.expressionValue,allowedValueTypes:e.allowedValueTypes,errorSource:e.errorSource}:e.type===c().uW.LibraryFunctionExecutionError?{type:e.type,error:e.error,libraryFunctionName:e.libraryFunction.name,errorSource:e.errorSource}:"errorSource"in e?{type:e.type,errorSource:e.errorSource}:{type:e.type}}const _={checkbox:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,button:!1,file:!1,verification:!1,auto_increment_id:!1,created_by:!1,created_time:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,place:!1};function v(e){return Boolean(_[e.type])}function g(e){const{collectionFormat:t,collectionSchema:o,filter:a,sort:c}=e,u=(0,r().uv)(o).filter(((e,t,n)=>{var r;const l=o[e];return!(!l||!_[l.type])&&((!(0,i().$M)(l)||null===(r=(0,i().om)(l))||void 0===r||!r.auto_update_on_edit)&&(!a||a([e,l],t,o)))}));if(0===u.length)return[];if(!t||!1===c)return u;const d=(0,s().L)(t,o,void 0,l().jf.Page).collection_page_properties||[];return n().Ul(u,(e=>d.findIndex((t=>t.property===e))))}const h={checkbox:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,auto_increment_id:!1,button:!1,created_by:!1,created_time:!1,date:!1,file:!1,formula:!1,last_edited_by:!1,last_edited_time:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,place:!1};function S(e){return h[e.type]}const M={checkbox:!0,created_by:!0,created_time:!0,date:!0,email:!0,multi_select:!0,number:!0,person:!0,phone_number:!0,relation:!0,select:!0,status:!0,text:!0,title:!0,url:!0,last_edited_by:!0,last_edited_time:!0,auto_increment_id:!1,button:!1,file:!1,formula:!1,last_visited_time:!1,location:!1,rollup:!1,verification:!1,place:!1};function b(e){return M[e.type]}function T(e){return 0===e}function x(e){return function(e){return"button_block"===e||"button_property"===e}(e)}function C(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function k(e){const{collectionSchema:t,property:o,type:n}=e,r=null==t?void 0:t[o];return!r||("action"===n?!p(r):!_[r.type])}function w({automationTrigger:e,collectionSchema:t}){if("event"===(null==e?void 0:e.type)){const{pagesAdded:o,pagePropertiesEdited:n,source:a}=e.event;if(void 0===a)return!1;const i="some"===n.type&&n.some,l="all"===n.type&&n.all;if((i||l||[]).some((e=>C({collectionSchema:t,property:e.property})||k({collectionSchema:t,property:e.property,type:"trigger"}))))return!1;const c="some"===n.type&&(!(0,r().O9)(n.some)||0===n.some.length),s="all"===n.type&&(!(0,r().O9)(n.all)||0===n.all.length);if(!o&&("none"===n.type||c||s))return!1}else{if("recurrence"!==(null==e?void 0:e.type))return!1;if(!e.recurrence)return!1}return!0}},448801:(e,t,o)=>{o.d(t,{i:()=>r});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698);var n=()=>o(371562);n();function r(e,t){const o=n().create({arrays:{detectMove:!1,includeValueOnMove:!0}}).diff(e,t);if(!o)return{beforeOps:{},removeOps:new Set};let r=[],a=[];for(const n in o)"_t"!==n&&("_"===n[0]?r.push(parseInt(n.slice(1),10)):1===o[n].length&&a.push({index:parseInt(n,10),value:o[n][0]}));const i={},l=new Set,c=[...e];r=r.sort(((e,t)=>e-t));for(let n=r.length-1;n>=0;n--){const e=r[n],t=c.splice(e,1)[0];l.add(t)}a=a.sort(((e,t)=>e.index-t.index));for(let n=0;n<a.length;n++){const e=a[n];i[e.value]=c[e.index],c.splice(e.index,0,e.value)}return{beforeOps:i,removeOps:l}}},482871:(e,t,o)=>{o.d(t,{z:()=>u});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(430670),o(581454);var n=()=>o(770063),r=()=>o(898244),a=()=>o(448801),i=()=>o(179034),l=()=>o(722101),c=(o(354520),()=>o(496603));function s(e){const{collectionContextStore:t,collectionViewStore:o,transaction:a}=e,s=o.getPageSortStore(),u=s.getValue(),d=t.groupsStore.getAllGroupStates(),p=function(e){const{pageSort:t,currentResults:o}=e;if(!t||t.length<=r().WF)return[];const n=t.filter((e=>!o.has(e)));return c().sb([...n.reverse(),...c().o8(t).reverse()]).slice(0,t.length-r().WF)}({pageSort:u,currentResults:new Set(d.flatMap((e=>e.resultsStore.state.map((e=>e.id)))))});for(const r of p)l().TF({parentStore:s,childToRemoveStore:(0,n().v3)(s,{table:i().ev,id:r}),transaction:a})}function u(e){const{resultIds:t,collectionViewStore:o,collectionContextStore:c,transaction:u}=e,d=o.getPageSortStore(),p=d.getValue()||[],{beforeOps:m}=(0,a().i)(p,t.slice(0,r().WF));for(const[r,a]of Object.entries(m))if(a){const e=(0,n().v3)(o,{table:i().ev,id:a});l().nc({parentStore:d,insertStore:(0,n().v3)(o,{table:i().ev,id:r}),beforeStore:e,transaction:u})}else{const e=t.findIndex((e=>e===r)),a=t[e-1],c=a?(0,n().v3)(o,{table:i().ev,id:a}):void 0;l().WH({parentStore:d,insertStore:(0,n().v3)(o,{table:i().ev,id:r}),afterStore:c,transaction:u})}s({collectionContextStore:c,collectionViewStore:o,transaction:u})}},491848:(e,t,o)=>{o.d(t,{w:()=>r});o(898992),o(672577);var n=()=>o(209866);function r({collectionContextStore:e,transaction:t}){const o="collectionTypedView"===e.contextTypeFromStoreState,r=e.databaseTypeFromStoreState,a=e.collectionStoresStore.state,i=a.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly()))||a[0];!o&&i&&(0,n().e)({transaction:t,databaseType:r,collectionId:i.id,spaceId:i.getSpaceId()})}},546461:(e,t,o)=>{o.d(t,{K4:()=>M,To:()=>C,fi:()=>b,q8:()=>S,u:()=>h});o(16280),o(18107),o(967357);var n=o(296540),r=()=>o(484714),a=()=>o(792485),i=()=>o(590526),l=()=>o(79926),c=()=>o(140934),s=()=>o(322867),u=()=>o(69708),d=()=>o(534177),p=()=>o(813297),m=()=>o(326887),f=()=>o(862292),y=()=>o(190019),_=()=>o(76190),v=o(474848);const g=(0,n.createContext)({ancestors:[]});g.displayName="AutomationContext";g.Consumer;function h(e){const{automationStore:t,children:o,contextType:h,enableExistenceGuarantees:S}=e,M=(0,r().v3)(),b=(0,u().tz)(),{value:C}=(0,l().fJ)(f().T.formulas),{value:k}=(0,l().fJ)(p().QV.automationTypecheck),w=(0,_().n)(t),A=(0,a().S)(),I=(0,i().K8)((()=>{if(!C)return{error:new(s().N9)("Missing formulas dependency")};if(!k)return{error:new(s().N9)("Missing automation dependency")};const e=function(e){const{environment:t,automationStore:o,automationTypecheckModule:n,contextType:r,formulasModule:a,intl:i,isSubscribed:l,pageStore:s,enableExistenceGuarantees:u}=e,p=function(e,t){if(t)return T.get(e);return T.get(e)??x.get(e)}(o,u);if(p)return p;const f=new(c().ComputedStore)((()=>{const e=o.getTriggerType();let c=r;return(0,d().O9)(e)&&(0,m().x2)(e)&&(c=(0,m().H8)(e)),(0,y().Z)({environment:t,automationStore:o,automationTypecheckModule:n,contextType:c,formulasModule:a,intl:i,isSubscribed:l,pageStore:s,enableExistenceGuarantees:u})}),{debugName:"automationContextTypecheckResultCachedStore"});return function(e,t,o){o?(T.set(e,t),x.set(e,t)):x.set(e,t)}(o,f,u),f}({automationStore:t,automationTypecheckModule:k,contextType:h,environment:M,formulasModule:C,intl:b,isSubscribed:w,pageStore:"button_block"===h?null==A?void 0:A.pageStore:void 0,enableExistenceGuarantees:S});return e.state}),[M,t,k,h,C,b,w,null==A?void 0:A.pageStore,S]),E=(0,n.useContext)(g),O=(0,n.useMemo)((()=>0===E.ancestors.length?[{automationStore:t,contextType:h,typecheckResult:I}]:[...E.ancestors,{automationStore:t,contextType:h,typecheckResult:I}]),[E,t,h,I]),R=(0,n.useMemo)((()=>({ancestors:O,enableExistenceGuarantees:S})),[O,S]);return(0,v.jsx)(g.Provider,{value:R,children:o})}function S(){const e=(0,n.useContext)(g).ancestors.at(-1);if(!e)throw new Error("No automation context found!");return e}function M(){return(0,n.useContext)(g).ancestors.at(-1)}function b(){return(0,n.useContext)(g).enableExistenceGuarantees}const T=new WeakMap,x=new WeakMap;function C(e){var t;return null===(t=T.get(e))||void 0===t?void 0:t.state}},621594:(e,t,o)=>{o.r(t),o.d(t,{exclamationMarkCircleSmallIcon:()=>a,iconDefinition:()=>r});o(296540);var n=o(474848);const r={viewBox:"0 0 16 16",fittedViewBox:"1.87 1.87 12.25 12.25",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M7.9 4.875a.625.625 0 0 0-.625.625V8a.625.625 0 1 0 1.25 0V5.5a.625.625 0 0 0-.625-.625m0 4.7a.725.725 0 1 0 0 1.45.725.725 0 0 0 0-1.45"}),(0,n.jsx)("path",{d:"M8 1.875a6.125 6.125 0 1 0 0 12.25 6.125 6.125 0 0 0 0-12.25M3.125 8a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0"})]})},a=(0,o(340498).wt)("exclamationMarkCircleSmall",r,"small")},738508:(e,t,o)=>{o.r(t),o.d(t,{cursorIcon:()=>a,iconDefinition:()=>r});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"1.25 0 17.5 20",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("g",{className:"logo-light-mode",children:[(0,n.jsxs)("g",{clipPath:"url(#clip0_16020_205)",children:[(0,n.jsx)("path",{fill:"#757575",d:"m9.995 9.987 8.658 4.999a.6.6 0 0 1-.226.226l-8.092 4.672a.68.68 0 0 1-.68 0l-8.092-4.672a.6.6 0 0 1-.226-.226z"}),(0,n.jsx)("path",{fill:"#525252",d:"M9.995 0v9.987l-8.658 4.999a.6.6 0 0 1-.082-.309v-9.38c0-.22.117-.424.308-.534L9.655.09a.7.7 0 0 1 .34-.09"}),(0,n.jsx)("path",{fill:"#404040",d:"M18.652 4.989a.6.6 0 0 0-.225-.226L10.334.09A.7.7 0 0 0 9.995 0v9.987l8.658 4.999a.6.6 0 0 0 .083-.309v-9.38c0-.11-.03-.216-.083-.308"}),(0,n.jsx)("path",{fill:"#D9D9D9",d:"M18.047 5.339a.29.29 0 0 1 0 .29l-7.859 13.61c-.053.093-.193.055-.193-.05v-8.97a.4.4 0 0 0-.054-.201z"}),(0,n.jsx)("path",{fill:"#fff",d:"m18.047 5.339-8.106 4.68a.4.4 0 0 0-.147-.147L2.027 5.387c-.092-.053-.054-.193.052-.193h15.717c.111 0 .202.06.25.145"})]}),(0,n.jsx)("defs",{children:(0,n.jsx)("clipPath",{id:"clip0_16020_205",children:(0,n.jsx)("path",{fill:"#fff",d:"M1.255 0h17.49v20H1.256z"})})})]}),(0,n.jsxs)("g",{className:"logo-dark-mode",children:[(0,n.jsxs)("g",{clipPath:"url(#clip0_16020_213)",children:[(0,n.jsx)("path",{fill:"#6E6E6E",d:"m9.995 9.987 8.658 4.999a.6.6 0 0 1-.226.226l-8.092 4.672a.68.68 0 0 1-.68 0l-8.092-4.672a.6.6 0 0 1-.226-.226z"}),(0,n.jsx)("path",{fill:"#4A4A4A",d:"M9.995 0v9.987l-8.658 4.999a.6.6 0 0 1-.082-.309v-9.38c0-.22.117-.424.308-.534L9.655.09a.7.7 0 0 1 .34-.09"}),(0,n.jsx)("path",{fill:"#383838",d:"M18.652 4.989a.6.6 0 0 0-.225-.226L10.334.09A.7.7 0 0 0 9.995 0v9.987l8.658 4.999a.6.6 0 0 0 .083-.309v-9.38c0-.11-.03-.216-.083-.308"}),(0,n.jsx)("path",{fill:"#C9C9C9",d:"M18.047 5.339a.29.29 0 0 1 0 .29l-7.859 13.61c-.053.093-.193.055-.193-.05v-8.97a.4.4 0 0 0-.054-.201z"}),(0,n.jsx)("path",{fill:"#fff",d:"m18.047 5.339-8.106 4.68a.4.4 0 0 0-.147-.147L2.027 5.387c-.092-.053-.054-.193.052-.193h15.717c.111 0 .202.06.25.145"})]}),(0,n.jsx)("defs",{children:(0,n.jsx)("clipPath",{id:"clip0_16020_213",children:(0,n.jsx)("path",{fill:"#fff",d:"M1.255 0h17.49v20H1.256z"})})})]})]})},a=(0,o(340498).wt)("cursor",r,"default")},763765:(e,t,o)=>{o.d(t,{t:()=>r});class n extends(()=>o(757695))().Store{getInitialState(){return{loaded:!1}}USEWITHCAUTION_markStatsigUserFetched(e){const{userId:t,spaceId:o,fetched:n}=e;this.setState({loaded:n,userId:t,spaceId:o})}USEWITHCAUTION_isFetchedForSpaceAndUserId(e){const{spaceId:t,userId:o}=e;return this.state.loaded&&this.state.spaceId===t&&this.state.userId===o}}const r=new n;(0,o(852832).exposeDebugValue)("statsigUserLoadingStatusStore",r)},766854:(e,t,o)=>{o.d(t,{H:()=>b,Q:()=>M});o(898992),o(672577);var n=()=>o(230711),r=()=>o(907258),a=()=>o(135168),i=()=>o(242422),l=()=>o(929219),c=()=>o(711339),s=()=>o(295633),u=()=>o(700500),d=()=>o(179034),p=()=>o(201980),m=()=>o(384944),f=()=>o(649813),y=()=>o(390650),_=()=>o(381678),v=()=>o(622811),g=()=>o(491848),h=()=>o(482871);function S(e,t,o){const r=(0,_()._)(e),a=null==r?void 0:r.id;if(!a||!o)return;if(!i().default.checkGate({gateName:"full_access_for_created_collection_pages"}))return;if(t.canAdmin())return;const l=t.getSpaceStore();return l&&(0,n().dp)(l,a).isMember()?[{role:"editor",type:"user_permission",user_id:a}]:void 0}function M(e){const{collectionContextStore:t,transaction:o}=e;return(0,g().w)({collectionContextStore:t,transaction:o}),b(e)}function b(e){var t,o,n;const{environment:_,collectionContextStore:g,groupsPointer:M,insertAtIndex:b,shouldCoerce:T,templateStore:x,transaction:C,from:k,tracker:w,inMemoryRecordCache:A,isKeyboard:I,title:E}=e,O=c().default.DO_NOT_USE_markLegacy("collections.add_item_lag");c().default.DO_NOT_USE_measureAfterNextFlushLegacy(O,{environment:_,getData:()=>({...y().kz(g),from:k.createBlock})});const R="collectionTypedView"===g.contextTypeFromStoreState,V=g.databaseTypeFromStoreState,D=g.collectionStoresStore.state,N=D.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly()))||D[0],F=null===(t=(0,a().f)(N))||void 0===t?void 0:t.id,U=r().default.state.currentUserSettingsStore,P=R&&V&&F&&U&&[...U.getAllPreferredCollections(F),...U.getPreferredCollectionsOfType(F,V)]||[];let G;const B=M[0];if("group_header"===k.createBlock&&"location"===B.value.type){const e=B.value.value;if(e){G=D.find((t=>t.id===e.id&&(t.canEdit()||t.canEditCollection()||t.canEditContentOnly())))}}else G=function(e,t){for(const o of e){const e=t.find((e=>e.id===o&&(e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));if(e)return e}}(P,D);const j=G??N,H=null==j?void 0:j.getSpaceId(),W=g.collectionViewStore(),z=g.getViewType(),L=m().Wv({environment:_,type:u().xd.page,inMemoryRecordCache:A,transaction:C,spaceId:H,tracker:w,permissions:S(_,j,H),properties:{title:(0,p().x9d)(E)}});if(!j||!W||!z)return{coercionSucceeded:!0,newStore:L};const q=null===(o=g.groupsStore.getGroupState(M))||void 0===o?void 0:o.groupUiParentStore;if(!q)return{coercionSucceeded:!0,newStore:L};const Y=s().B.createChildStore(q,{table:d().ev,id:L.id});x&&l().A.state.online&&f().TB({title:"template",environment:_,store:L,templateStore:x,isKeyboard:I??!1,isCreateIn:!1,transaction:C,from:k.initCollection??"collection_group_actions"});const $=(0,v().j)({environment:_,store:L,collectionStore:j,collectionContextStore:g,groupsPointer:M,shouldCoerce:T,transaction:C}),K=(null===(n=g.groupsStore.getGroupState(M))||void 0===n||null===(n=n.reducerResultStore.state)||void 0===n?void 0:n.blockIds)||[],Z=void 0!==b?b:K.length,X=g.permissionScopesStore.state;if((i().default.checkGate({gateName:"can_create_pages_in_collection_permission"})?X.canCreatePagesInCollection:X.canEditContent)||R){const e=[...K.slice(0,Z),Y.id,...K.slice(Z)];(0,h().z)({resultIds:e,collectionViewStore:W,collectionContextStore:g,transaction:C})}return{coercionSucceeded:$,newStore:Y}}},839754:(e,t,o)=>{o.d(t,{Bi:()=>C,My:()=>x,ZM:()=>w,_M:()=>k,navigateToWorkflowTemplateOnboardingModal:()=>A});o(16280),o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(581454);var n=()=>o(907258),r=()=>o(295633),a=()=>o(584262),i=()=>o(663077),l=()=>o(179034),c=()=>o(201980),s=()=>o(896628),u=()=>o(384944),d=()=>o(730969),p=()=>o(840153),m=()=>o(339798),f=()=>o(180762),y=()=>o(799832),_=()=>o(111379),v=()=>o(535960),g=()=>o(31173),h=()=>o(295304),S=()=>o(244828),M=()=>o(373444),b=()=>o(165592),T=()=>o(204067);function x({transaction:e,collectionStore:t,propertyTemplates:o}){var n;const r=(null===(n=t.getParentBlockStore())||void 0===n?void 0:n.getCollectionViewStores().filter((e=>"table"===e.getType())))??[];if(0===r.length)return;const a=[];for(const c of o){const e=(0,T().S1)({collectionStore:t,templateId:c.templateId,instancePointerType:"property"});e&&a.push({property:e.id,visible:!(0,i().Sz)(c),...c.tablePropertyFormat})}if(0!==a.length)for(const i of r){var l;const t=(null===(l=i.getPropertyFormatsStore("table_properties"))||void 0===l?void 0:l.getValue())??[],o=new Set(t.map((e=>e.property))),n=a.filter((e=>!o.has(e.property)));0!==n.length&&s().zA({stores:[i],update:{table_properties:[...t,...n]},transaction:e})}}function C({transaction:e,collectionStore:t,propertyTemplates:o}){const n=[];for(const l of o){const e=(0,T().S1)({collectionStore:t,templateId:l.templateId,instancePointerType:"property"});e&&n.push({property:e.id,visible:!0})}const r=t.getFormat().collection_page_properties??[],a=new Set(r.map((e=>e.property))),i=n.filter((e=>!a.has(e.property)));i.length&&s().zA({stores:[t],update:{collection_page_properties:[...r,...i]},transaction:e})}function k({environment:e,newPageStore:t,result:o}){"accepted_template"!==o.type&&"accepted_empty_collection"!==o.type||S().createAndCommit({environment:e,canUndo:!1,perform:n=>{const a=t.getTitleValue();if(u().zv({store:t,transaction:n,data:{alive:!1}}),"accepted_empty_collection"===o.type&&!(0,c().w9s)(a)){const i=r().B.createChildStore(t,{table:"block",id:o.blockId}).getTitleStore();i&&h().yr({environment:e,transaction:n,tokens:a,index:0,store:i})}const i=t.getParentStore();if((null==i?void 0:i.table)===l().ev){const e=i.getContentIds();u().zv({store:i,transaction:n,data:{content:e.filter((e=>e!==t.id))}})}},userAction:"clean_up_empty_new_page"})}function w({environment:e,userAction:t,result:o,existingCollectionViewBlockStore:n,existingCollectionStore:r}){if("canceled"!==o.type){if("accepted_empty_collection"===o.type&&r){const n=r.getKeyStore("name"),a=(0,c().x9d)(o.newCollectionTitle);n&&S().createAndCommit({userAction:t,environment:e,canUndo:!0,perform:t=>h().R9({environment:e,store:n,transaction:t,value:a})})}if(n){var a;const e=null===(a=(0,y().U)(n))||void 0===a?void 0:a.settingsStore;e&&m().os({collectionSettingsStore:e})}if("accepted_template"===o.type&&null!=n&&n.isCollectionView()&&(null==n||!n.hasSingleSourceAndNoLinkedCollections())){const t=(0,y().U)(n),r=n.getCollectionViewStores().find((e=>{var t;return(null===(t=e.getCollectionStore())||void 0===t?void 0:t.id)===o.collectionId}));if(!t||!r)return;(0,f().t)({environment:e,collectionContextStore:t,collectionViewId:r.id,isFullScreen:t.isFullScreenStore.state,isRootChild:t.isRootChildStore.state,isInPeekRenderer:t.isInPeekRendererStore.state})}}}async function A({environment:e,collectionViewBlockStore:t}){const o=t.id;if(!t.isDefined()){const n=await(0,g().$)({environment:e,blockId:o});if(!n)return;e=await p().T({environment:e,newCurrentUserId:n}),t=new(r().B)(e,{table:l().ev,id:o}),await t.load()}const i=t.getSpaceId();if(!i)throw new Error("Space ID not found for collection block");const c=(0,_().k)(i);if(!c)throw new Error(`Space view not found for space ID: ${i}`);const{sidebarSpaceStore:s}=n().default.state;(null==s?void 0:s.id)!==i&&await(0,d().y)({environment:e,spaceViewStore:c});const u=t.getFormat();if("workflow_template_placeholder"===(null==u?void 0:u.collection_view_sub_type)&&null!=u&&u.placeholder_workflow_template_id&&t.isCollectionView()){const{getCollectionTemplateFromId:o}=await b().t.load(),n=o(u.placeholder_workflow_template_id);if(!n)throw new Error(`Collection template "${u.placeholder_workflow_template_id}" not found`);const{onNavigateToPlaceholderWorkflowTemplateBlock:r}=await M().O.load();r({environment:e,collectionTemplate:n,collectionViewBlockStore:t})}else(0,v().u)({environment:e,store:t,pageVisitSource:a().y8.WorkflowTemplatesDeeplink})}},888325:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{_:()=>n})},890409:(e,t,o)=>{o.d(t,{Ah:()=>v,Dk:()=>f,Iv:()=>_,SF:()=>y,YO:()=>S,_f:()=>b,c_:()=>p,dW:()=>h,gW:()=>m,sp:()=>T,vN:()=>g});o(16280),o(944114),o(898992),o(354520),o(803949),o(581454),o(737550);var n=()=>o(496603),r=()=>o(973647),a=()=>o(534177),i=()=>o(842599),l=()=>o(239381),c=()=>o(179034),s=()=>o(798880),u=()=>o(201980),d=()=>o(241319);function p(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"add_automation_step",properties:t})}function m(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"delete_automation_step",properties:t})}function f(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_create",properties:t})}function y(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_update",properties:t})}function _(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_delete",properties:t})}function v(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_enable",properties:t})}function g(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_disable",properties:t})}function h(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_create",properties:t})}function S(e,t){e.DO_NOT_USE_commonTrackEvent({eventName:"automation_action_delete",properties:t})}function M(e){const{formulaAnalyticsModule:t,formulasModule:o,formulaTypecheckContextValues:n,getRecordModel:i,spaceId:c,value:s,featureGates:u}=e;if("formula"===s.type){if(!(0,a().O9)(s.value))return;const e=r().Q.unwrapOr(o.parseFormulaInputToAst(s.value),void 0);if(e){const r=o.addTypesToFormulaAST(e,{handleDataRequest:(0,l().zg)(i),spaceId:c,valueTypes:n,featureGates:u});return{...t.getFormulaAnalytics(e,{getRecordModel:i,typecheckContextValues:n}),formula_return_type:r.node.type,redacted_formula:t.getRedactedFormulaAsStringSync(e,{getRecordModel:i,typecheckContextValues:n})}}}else{if("simple"===s.type){if(!(0,a().O9)(s.value))return;return t.getSimpleFormulaAnalytics(s.value,{getRecordModel:i,typecheckContextValues:n})}(0,a().HB)(s.type)}}function b(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:r,formulasModule:c,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f,simpleFormulasModule:y}=e;return t.isType("complete_sprint")?{automation_action_id:t.pointer.id,type:"complete_sprint"}:t.isType("create_page")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:n,formulaTypecheckContextValues:r,getRecordModel:i,featureGates:l}=e,c=t.getConfig();let s,u=[];const d=null==c?void 0:c.collection,p=null==c?void 0:c.properties;if((0,a().O9)(d)&&(0,a().O9)(p)&&p.length>0){const e=i(d),f=null==e?void 0:e.getNormalizedSchema();(0,a().O9)(f)&&(u=p.map((e=>{var t;return(null===(t=f[e])||void 0===t?void 0:t.type)??"unknown"})));const y=null==c?void 0:c.values;if(n&&(0,a().O9)(y)){s=[];for(const e of p){var m;const a=null===(m=y[e])||void 0===m?void 0:m.value;if(!a)continue;const c=M({formulaAnalyticsModule:o,formulasModule:n,getRecordModel:i,formulaTypecheckContextValues:r,spaceId:t.spaceId,value:a,featureGates:l});c&&s.push(c)}}}return{automation_action_id:t.pointer.id,property_formula_stats:s,property_types:u,type:"create_page"}}({automationActionModel:t,formulaAnalyticsModule:r,formulasModule:c,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("duplicate_blocks")?{automation_action_id:t.pointer.id,type:"duplicate_blocks"}:t.isType("modal_confirmation")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:n,formulaTypecheckContextValues:r,getRecordModel:i,featureGates:l}=e,c=t.getConfig(),s=[];if(n&&(0,a().O9)(c)&&c.text){const e=M({formulasModule:n,formulaAnalyticsModule:o,getRecordModel:i,formulaTypecheckContextValues:r,spaceId:t.spaceId,value:c.text,featureGates:l});e&&s.push(e)}return{automation_action_id:t.pointer.id,formula_stats:s,type:"modal_confirmation"}}({automationActionModel:t,formulaAnalyticsModule:r,formulasModule:c,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("open_page")?{automation_action_id:t.pointer.id,type:"open_page"}:t.isType("query_collection")?{automation_action_id:t.pointer.id,type:"query_collection"}:t.isType("send_in_app_notification")?function(e){var t;const{automationActionModel:o,formulaAnalyticsModule:n,formulasModule:r,formulaTypecheckContextValues:i,getRecordModel:l,featureGates:c,simpleFormulasModule:s}=e,d={automation_action_id:o.pointer.id,messageCharacterCount:0,type:"send_in_app_notification"},p=o.getConfig();if(!(0,a().O9)(p))return d;if((0,a().O9)(p.target))if("formula"===p.target.type&&(0,a().O9)(p.target.value)){if(d.targetData={type:"formula",numUserFormulaTargets:(0,u().Fbh)(p.target.value.value).length,numFormulaContextTargets:s.getReferencedContextValueIds(p.target.value).length},r){const e=M({formulasModule:r,formulaAnalyticsModule:n,getRecordModel:l,formulaTypecheckContextValues:i,spaceId:o.spaceId,value:p.target.value,featureGates:c});e&&(d.formula_stats??=[],d.formula_stats.push(e))}}else if("property"===p.target.type&&(0,a().O9)(p.target.propertyId)&&(0,a().O9)(p.target.collectionPointer)){const e=l(p.target.collectionPointer),t=null==e?void 0:e.getSchema();var m;(0,a().O9)(t)&&(d.targetData={type:"property",propertyType:null===(m=t[p.target.propertyId])||void 0===m?void 0:m.type})}if((0,a().O9)(null===(t=p.notification_message)||void 0===t?void 0:t.value)&&(d.messageCharacterCount=(0,u().FAw)(p.notification_message.value),r)){const e=M({formulasModule:r,formulaAnalyticsModule:n,getRecordModel:l,formulaTypecheckContextValues:i,spaceId:o.spaceId,value:p.notification_message,featureGates:c});e&&(d.formula_stats??=[],d.formula_stats.push(e))}return d}({automationActionModel:t,formulaAnalyticsModule:r,formulasModule:c,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f,simpleFormulasModule:y}):t.isType("send_gmail_notification")?function(e){var t,o,r,l,c,d,p;const{automationActionModel:m,formulaAnalyticsModule:f,formulasModule:y,formulaTypecheckContextValues:_,getRecordModel:v,featureGates:g}=e,h=m.getConfig();if(!(0,a().O9)(h))return{automation_action_id:m.pointer.id,fields:{},recipient_domains:{},type:"send_gmail_notification"};const S=Object.fromEntries(Object.entries(h||{}).map((([e,t])=>{var o;return"formula"===(null==t?void 0:t.type)?[e,Boolean(null==t||null===(o=t.value)||void 0===o?void 0:o.value)]:"simple"===(null==t?void 0:t.type)?[e,Boolean(null==t?void 0:t.value)]:[e,Boolean(t)]}))),{to:b,cc:T,bcc:x}=h,C=[...(null==b||null===(t=b.value)||void 0===t?void 0:t.value)||[],...(null==T||null===(o=T.value)||void 0===o?void 0:o.value)||[],...(null==x||null===(r=x.value)||void 0===r?void 0:r.value)||[]],k=[...(0,u().Fbh)(C).map((e=>v({table:s().oo,id:e}))).map((e=>null==e?void 0:e.email)).filter(a().O9),...(0,i().C3)((0,u().k4p)(C))],w=n().Tr(k.map((e=>e.split("@")[1]))),A=[null===(l=h.to)||void 0===l?void 0:l.value,null===(c=h.cc)||void 0===c?void 0:c.value,null===(d=h.bcc)||void 0===d?void 0:d.value,null===(p=h.reply_to)||void 0===p?void 0:p.value,h.from_name,h.email_subject,h.email_body].map((e=>{if(y&&(0,a().O9)(e))return M({formulaAnalyticsModule:f,formulasModule:y,getRecordModel:v,formulaTypecheckContextValues:_,spaceId:m.spaceId,value:e,featureGates:g})})).filter(a().O9);return{automation_action_id:m.pointer.id,fields:S,formula_stats:A,recipient_domains:w,type:"send_gmail_notification"}}({automationActionModel:t,formulaAnalyticsModule:r,formulasModule:c,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("slack_notification")?{automation_action_id:t.pointer.id,type:"slack_notification"}:t.isType("update_pages")?function(e){const{automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:n,formulasModule:r,formulaTypecheckContextValues:i,getRecordModel:c,featureGates:s}=e,u=t.getConfig(),p=[],m=[],f=[];if((0,a().O9)(u)&&(0,a().O9)(u.target)&&(0,a().O9)(u.properties)&&u.properties.length>0){let e;if("variable"===u.target.type){const t=(0,l().y5)(u.target.id);if("action"===t.source){const t=(0,d().y)({actionModels:o,id:u.target.id}).collectionPointer;if((0,a().O9)(t)){const o=c(t);e=null==o?void 0:o.getNormalizedSchema()}}else{if("global"!==t.source||"button_page"!==t.global)throw new Error("Failed loading property schema");{const t=(0,l().IV)(i,u.target.id);if("block"===(null==t?void 0:t.type.type)&&(0,a().O9)(t.type.collection)){const o=c(t.type.collection);e=null==o?void 0:o.getNormalizedSchema()}}}}else if("collection"===u.target.type){const t=c(u.target.collection);e=null==t?void 0:t.getNormalizedSchema()}(0,a().O9)(e)&&u.properties.forEach((o=>{const l=e[o];if((0,a().O9)(l)&&(p.push(l.type),r&&(0,a().O9)(u.values))){const e=u.values[o];if((0,a().O9)(e)&&(m.push({type:l.type,operator:e.action}),e.value)){const o=M({formulasModule:r,formulaAnalyticsModule:n,getRecordModel:c,formulaTypecheckContextValues:i,spaceId:t.spaceId,value:e.value,featureGates:s});o&&f.push(o)}}}))}return{automation_action_id:t.pointer.id,property_configs:m,property_formula_stats:f,property_types:p,type:"update_pages"}}({automationActionModel:t,automationActionModels:o,formulaAnalyticsModule:r,formulasModule:c,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("define_variables")?function(e){const{automationActionModel:t,formulaAnalyticsModule:o,formulasModule:n,formulaTypecheckContextValues:r,getRecordModel:i,featureGates:l}=e,c=t.getConfig(),s=[];if(n&&(0,a().O9)(c)&&c.values)for(const a of Object.values(c.values))if(a.value){const e=M({formulasModule:n,formulaAnalyticsModule:o,getRecordModel:i,formulaTypecheckContextValues:r,spaceId:t.spaceId,value:a.value,featureGates:l});e&&s.push(e)}return{automation_action_id:t.pointer.id,formula_stats:s,type:"define_variables"}}({automationActionModel:t,formulaAnalyticsModule:r,formulasModule:c,formulaTypecheckContextValues:p,getRecordModel:m,featureGates:f}):t.isType("http_request")?{automation_action_id:t.pointer.id,type:"http_request"}:t.isType("publish_site")?{automation_action_id:t.pointer.id,type:"publish_site"}:t.isType("worker")?{automation_action_id:t.pointer.id,type:"worker"}:void(0,a().HB)(t)}function T(e){const{automationModel:t,builderType:o="sidebar",formulaAnalyticsModule:n,formulasModule:r,formulaTypecheckContextValues:i,getRecordModel:l,featureGates:s,simpleFormulasModule:u,source:d}=e,p=[],m=t.getActionPointers().map((e=>l(e))).filter(a().O9);for(const c of t.getActionPointers()){const e=l(c);(0,a().O9)(e)&&p.push(b({automationActionModel:e,automationActionModels:m,formulaAnalyticsModule:n,formulasModule:r,formulaTypecheckContextValues:i,getRecordModel:l,featureGates:s,simpleFormulasModule:u}))}const f=[];let y,_,v;if(t.isEventType()){var g;const e=t.getEventConfiguration(),o=l(t.getParentPointer());y=t.getParentId();const n=t.getEventConfiguration();if("collection_view"===(null===(g=n.source)||void 0===g?void 0:g.type)){const e=l(n.source.pointer);(null==e?void 0:e.parent_table)===c().ev&&(v=null==e?void 0:e.parent_id),_=null==n?void 0:n.source.pointer.id}const r=null==o?void 0:o.getNormalizedSchema();if((0,a().O9)(r)){const{pagesAdded:t,pagePropertiesEdited:o}=e;if(t&&f.push({type:"page"}),"any"===o.type)f.push({condition:"any",type:"property"});else if("none"===o.type)f.push({condition:"none",type:"property"});else{let e=[];"some"===o.type?e=o.some??[]:"all"===o.type&&(e=o.all??[]);const t=[],n=[];e.forEach((e=>{var o;const i=null===(o=r[e.property])||void 0===o?void 0:o.type;(0,a().O9)(i)&&(t.push({type:i,operator:e.filter.operator}),n.push(i))})),f.push({condition:o.type,property_configs:t,property_types:n,type:"property"})}}}else if(t.isButtonType())f.push({type:"button"});else if(t.isRecurrenceType()){var h;f.push({type:"recurrence",frequency:null===(h=t.getTrigger().recurrence)||void 0===h?void 0:h.frequency})}else(0,a().HB)(t);return{automation_actions:p,automation_id:t.id,automation_triggers:f,collection_id:y,collection_view_id:_,collection_view_block_id:v,builder_type:o,source:d}}},922952:(e,t,o)=>{o.d(t,{u:()=>i});var n=()=>o(295633),r=()=>o(302996),a=()=>o(723085);function i(e){return e instanceof a().h||e instanceof r().SpaceStore||e instanceof n().B}},935432:(e,t,o)=>{o.d(t,{A:()=>i});var n=()=>o(416845),r=()=>o(357264),a=()=>o(788579);function i(e,t){if((0,n().pA8)(t)){const o=(0,a().$)(t.clientData);if(o)return"messageValues"in t.clientData?e.formatMessage(o,t.clientData.messageValues):e.formatMessage(o)}return e.formatMessage(r().k.generic_error)}},962753:(e,t,o)=>{o.d(t,{EH:()=>g,FO:()=>_,P$:()=>v,VA:()=>f,h0:()=>u,lM:()=>d,mq:()=>y});o(898992),o(581454),o(737550);var n=()=>o(907258),r=()=>o(242422),a=()=>o(763765),i=()=>o(613848),l=()=>o(496603),c=()=>o(534177),s=()=>o(822789);function u(e){const{currentUserRootStore:t}=n().default.state;if(!t)return!1;const o=t.getSpaceViewStores();return(0,l().oE)(null==o?void 0:o.map((e=>e.getSpaceId()))).map((t=>i().A.getData(e,{spaceId:t,userId:e.currentUser.id}))).some((e=>p(e)))}function d(e,t){return p(i().A.getData(e,{spaceId:t,userId:e.currentUser.id}))}function p(e){switch(null==e?void 0:e.membershipType){case void 0:case"none":case"page_guest":return!1;case"restricted_member":case"member":case"membership_admin":case"owner":return!0===e.is_sales_assisted;default:(0,c().HB)(e)}}function m(e,t){if(!t)return"control";if(d(e,t))return"control";const o=r().default.getEligibleGroup({experimentId:"ai_product_retention_simplified_input",defaultGroup:"control"});return"input"===o||"input_and_ask_mode"===o?o:"control"}function f(){switch(r().default.getEligibleGroup({experimentId:"ai_product_retention_agent_follow_ups",defaultGroup:"control"})){case"button_nudge":return["button","nudge"];case"button_control":return["button","default"];case"nudge":return["nudge"];default:return}}function y(e,t){const o=r().default.checkGate({gateName:"agent_deep_find"}),n=void 0!==t&&d(e,t),i=e.currentUser.id,l=!t||!i||a().t.USEWITHCAUTION_isFetchedForSpaceAndUserId({spaceId:t,userId:i}),c=o||!n&&l&&"on"===r().default.getEligibleGroup({experimentId:"ai_product_retention_deepfind",defaultGroup:"control"}),s=v(e,t);return{agentDeepFindEnabled:c,useReadOnlyMode:c&&s}}function _(e,t){if(t?(0,s().vp)(t):(0,s().hw)())return!0;return"control"!==m(e,t)}function v(e,t){return"input_and_ask_mode"===m(e,t)}function g(){return"on"===r().default.getEligibleGroup({experimentId:"ai_product_retention_agent_speculative_search",defaultGroup:"control"})}},966759:(e,t,o)=>{o.d(t,{i:()=>a});var n=()=>o(390650),r=()=>o(175213);function a(e){const{environment:t,collectionContextStore:o,property_type:a,from:i,property:l,...c}=e,s=(0,n().sl)(o)||{};(0,r().G)(t,{property:l,property_type:a,from:i,...c,...s})}}}]);