"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[83271],{9003:(e,t,n)=>{n.d(t,{H:()=>c});var o=()=>n(907258),i=()=>n(590526),a=()=>n(21510),r=()=>n(696746),s=()=>n(482238);const l=["reply_menu_all_updates","reply_menu_archive","reply_menu_mentions_comments"];function c(){const e=(0,i().K8)((()=>a().A.state.open&&l.includes(a().A.state.discussionLocation)),[]),t=(0,i().K8)((()=>s().Ay.getIsMockText()),[]),n=(0,i().K8)((()=>(0,r().lU)(o().default.state.mainEditorCurrentBlockStore)),[]);return!t&&!e&&!n}},63476:(e,t,n)=>{n.d(t,{h:()=>s});var o=()=>n(920198),i=()=>n(590526),a=()=>n(350013),r=()=>n(743246);function s(e){const t=(0,o().L)();return(0,i().K8)((()=>{if(!e||!t)return;return a().N.createChildStore(t,{table:r().C0,id:e,spaceId:t.id})}),[e,t])}},65474:(e,t,n)=>{n.d(t,{J:()=>s});n(296540);var o=()=>n(546926),i=()=>n(890492),a=()=>n(663639),r=n(474848);function s(e){const{buttonPopupParent:t,extensionPopupButtonEvents:n,sections:s,menuType:l}=e;return(0,r.jsx)(i().A,{...n,menuType:l,width:l===o().gu.Popup?300:void 0,hideMobileTopbar:!0,children:(0,r.jsx)(a().A,{type:a().O.Vertical,initialFocus:void 0,sections:s,onAccept:t.close})})}},97835:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>i,inviteMemberIcon:()=>a});n(296540);var o=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"3.68 2.37 15.82 17.13",svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"M10 2.375c-1.137 0-2.054.47-2.674 1.242-.608.757-.9 1.765-.9 2.824s.292 2.066.9 2.824c.62.772 1.537 1.241 2.674 1.241s2.055-.469 2.675-1.241c.608-.758.9-1.766.9-2.824 0-1.059-.292-2.067-.9-2.824-.62-.773-1.538-1.242-2.675-1.242M7.676 6.441c0-.842.233-1.554.624-2.042.38-.473.937-.774 1.7-.774s1.32.301 1.7.774c.391.488.624 1.2.624 2.042s-.233 1.554-.624 2.041c-.38.473-.937.774-1.7.774s-1.32-.3-1.7-.774c-.391-.487-.624-1.2-.624-2.041M10 11.63c-2.7 0-5.101 1.315-6.12 3.305-.361.706-.199 1.421.23 1.923.412.48 1.06.767 1.74.767h5.845a4.6 4.6 0 0 1-.28-1.25H5.85c-.342 0-.634-.148-.79-.33-.138-.162-.172-.336-.067-.54.761-1.488 2.672-2.626 5.007-2.626.83 0 1.605.144 2.294.395.269-.364.59-.688.952-.96A7.9 7.9 0 0 0 10 11.63"}),(0,o.jsx)("path",{d:"M16 19.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7m2.594-3.469a.625.625 0 0 0-.625-.625h-1.375v-1.375a.625.625 0 0 0-1.25 0v1.375h-1.375a.625.625 0 0 0 0 1.25h1.375v1.375a.625.625 0 1 0 1.25 0v-1.375h1.375c.345 0 .625-.28.625-.625"})]})},a=(0,n(340498).wt)("inviteMember",i,"default")},142149:(e,t,n)=>{n.d(t,{Z:()=>d});n(296540);var o=()=>n(807449),i=()=>n(651124),a=()=>n(529099),r=()=>n(534177),s=()=>n(756123),l=()=>n(854672),c=n(474848);function d(e){const{icon:t,size:n=18}=e;if(!t)return(0,c.jsx)(o().I,{icon:a().aiFaceIcon,size:n});const d=(0,i().WO)(t);if(!d)return(0,c.jsx)(o().I,{icon:a().aiFaceIcon,size:n});switch(d.type){case"unicode_emoji":return(0,c.jsx)(s().A,{size:n,emoji:d.emoji.unicode,disableShrinking:!0});case"notion_icon":case"app_package_asset":return(0,c.jsx)(l().A,{type:d.type,size:n,icon:t,alt:"bot icon",isLoading:!1,progressPercent:0});case"custom_emoji":case"url":return(0,c.jsx)("img",{src:t,alt:"bot icon",style:{width:n,height:n,objectFit:"cover",borderRadius:2}});default:return(0,r().HB)(d)}}},144222:(e,t,n)=>{n.d(t,{yG:()=>c});n(898992),n(354520);var o=n(296540),i=()=>n(449412),a=()=>n(69708),r=()=>n(319625);const s={isError:!1,message:""};const l=(0,a().YK)({chatSubmissionError:{id:"chatErrorHandler.submissionError",defaultMessage:"Something went wrong while processing your request. Please try again."}});function c(e){const t=(0,a().tz)(),{resetState:n}=e,[c,d]=(0,o.useState)({isError:!1,message:""}),u=(0,o.useCallback)((()=>{d(s)}),[]),p=(0,o.useCallback)(((e,o,a)=>{!function(e,t,n){const o=(0,r().A)(e),a=n?Object.fromEntries(Object.entries(n).filter((([,e])=>void 0!==e))):{};i().O8(o,{from:t,type:"error",...a})}(e,o,a),null==n||n(),d({isError:!0,message:t.formatMessage(l.chatSubmissionError)})}),[n,t]);return(0,o.useMemo)((()=>({errorState:c,handleChatSubmissionError:p,clearError:u})),[c,p,u])}},172595:(e,t,n)=>{n.d(t,{RL:()=>a,Yk:()=>r,az:()=>s});n(898992),n(672577);const o={0:"enter",1:"command+enter",2:"command+alt+enter"},i={enter:0,"command+enter":1,"command+alt+enter":2};function a(e){if(0===e||1===e||2===e)return o[e]}function r(e,t){const n=t.indexOf(e);if(0===n||1===n||2===n)return o[n]}function s(e,t){return e[t?i[t]:0]}},188679:(e,t,n)=>{n.d(t,{u:()=>c});var o=()=>n(590526),i=()=>n(340644),a=()=>n(434990),r=()=>n(545390),s=()=>n(215003),l=()=>n(759418);function c(){const{variant:e}=(0,l().V)(),{variant:t}=(0,r().n)(),{variant:n}=(0,s().C)(),c=(0,o().K8)((()=>a()._.getShouldRenderTextPrompt()),[]),d=(0,o().K8)((()=>i().Y.getShouldRenderTextPrompt()),[]);return"ai_float_text"===e||"ai_sidebar_text"===e||"ai_full_page_text"===e||c&&("sidebar_d1"===t||"sidebar_nudge"===t||"sidebar_d2"===t)||d&&void 0!==n&&"control"!==n}},197836:(e,t,n)=>{n.d(t,{h:()=>Rr});n(18107),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(967357),n(898992),n(803949),n(581454);var o=n(296540),i=()=>n(907258),a=()=>n(484714),r=()=>n(588316),s=()=>n(93583),l=()=>n(590526),c=()=>n(401497),d=()=>n(232615),u=()=>n(699143),p=()=>n(584262),g=()=>n(201980),h=()=>n(69708),m=()=>n(944584),f=()=>n(965454),S=()=>n(981475),y=()=>n(741198),b=()=>n(301421),x=()=>n(21259),C=()=>n(545390),v=()=>n(215003),M=()=>n(759418),k=()=>n(340644),j=()=>n(748355),I=()=>n(434990),w=()=>n(465614),A=()=>n(242422),T=()=>n(534177),P=()=>n(383070),F=()=>n(83293),_=()=>n(791256);const E="ai_model_picker_config_override",D=(0,h().YK)({placeholder:{id:"aiInferenceTranscript.placeholder",defaultMessage:"Ask AI anything..."}}),B=(0,h().YK)({simplified:{id:"aiInferenceTranscript.placeholder.slipperySlopeSimplified",defaultMessage:"Do anything with AI..."}}),R=(0,h().YK)({new_agent_modal:{id:"AIChatInput.placeholder.newAgentModal",defaultMessage:"Answers questions and files tasks in Notion..."},new_agent_modal_v2:{id:"AIChatInput.placeholder.newAgentModalV2",defaultMessage:"Answers questions and files tasks in Notion..."},new_agent_modal_v3:{id:"AIChatInput.placeholder.newAgentModalV3",defaultMessage:"Answers questions and files tasks in Notion..."},custom_agent_activity:{id:"AIChatInput.placeholder.customAgentActivity",defaultMessage:"Ask followup questions…"}}),N=(0,h().YK)({researcher:{id:"aiInferenceTranscript.research_mode_placeholder",defaultMessage:"Ask a follow up question..."},workflow:{id:"AIChatInput.placeholder.workflow",defaultMessage:"Ask, search, or make anything…"}}),z=(0,h().YK)({search:{id:"AIChatInput.placeholder.search",defaultMessage:"Ask or find anything from your workspace…"},researcher:{id:"AIChatInput.placeholder.researcher",defaultMessage:"Research any topic and get a thorough report…"},workflow:{id:"AIChatInput.placeholder.workflow",defaultMessage:"Ask, search, or make anything…"},"setup-generator":{id:"AIChatInput.placeholder.setupGenerator",defaultMessage:"Build a custom database…"}});function U(e){const{config:t,threadStore:n,intl:o,aiChatFeatureController:i,isSimplifiedInputEnabled:a}=e;if(a??i.supportsSimplifiedLayout){return"workflow"===t.type&&Boolean(t.useReadOnlyMode)?o.formatMessage(D.placeholder):o.formatMessage(B.simplified)}const r=R[i.aiChatType];if(r)return o.formatMessage(r);if(n&&!(0,_().av)(n)){const e=N[t.type];return e?o.formatMessage(e):o.formatMessage(D.placeholder)}const s=A().default.getConfig({configName:E})[P().zD.isZeroRetentionEnabled()?"zeroRetentionModels":"nonZeroRetentionModels"]??{};if("markdown-chat"===t.type){const e=t.model;if(e){if(s[e])return o.formatMessage(F().B9.defaultAskMessage,{modelName:s[e].modelMessage});const t=(0,T().O)(F().B9,e)?F().B9[e]:void 0;if(t)return o.formatMessage(t)}}const l=z[t.type];return l?o.formatMessage(l):o.formatMessage(D.placeholder)}n(672577);var K=()=>n(639919),O=()=>n(604018),L=()=>n(300474),V=()=>n(229508),W=()=>n(244828);function H(e){const{configType:t,spaceId:n}=e,{checkIfDismissed:r,markDismissed:s}=function(){const e=(0,a().v3)(),t=(0,L().r)(),n=(0,V().a)();return{checkIfDismissed:(0,o.useCallback)((e=>{if(!n)return!1;const t=n.getSettings(),o=(null==t?void 0:t.ai_connector_incident_dismissal_map)||{};return Boolean(o[e])}),[n]),markDismissed:(0,o.useCallback)((o=>{n&&t&&o&&W().createAndCommit({userAction:"aiConnectorIncident.dismissBanner",environment:e,canUndo:!1,perform:e=>{const t=n.getSettings(),i=(null==t?void 0:t.ai_connector_incident_dismissal_map)||{};W().applyOperation({store:n,operation:{pointer:n.pointer,path:["settings"],command:"update",args:{...t,ai_connector_incident_dismissal_map:{...i,[o]:!0}}},transaction:e})}})}),[n,t,e])}}();return(0,l().K8)((()=>{var e;const o=null===(e=i().default.state.currentUserStore)||void 0===e?void 0:e.getModel();if(!o)return;const a=K().R.getDegradedServicesForInferenceTranscriptConfigType({configType:t,actor:o,spaceId:n,connectedConnectors:(0,O().wd)()}).find((e=>"ai_connector"===e.type&&!r(e.dismissalKey)));return a&&"ai_connector"===a.type?{connector:a.connector,dismissalKey:a.dismissalKey,onDismiss:()=>s(a.dismissalKey),customMessage:a.customMessage,incidentType:a.incidentType}:void 0}),[t,n,r,s])}var q=()=>n(391379),Y=()=>n(718827),$=()=>n(695115),G=()=>n(26697),J=()=>n(107023),X=()=>n(340498),Q=()=>n(100622),Z=()=>n(673962),ee=()=>n(188679),te=()=>n(59226),ne=()=>n(606712),oe=()=>n(831081),ie=n(474848);const ae={viewBox:"0 0 16 16",fittedViewBox:"3.62 1.85 8.74 12.13",svg:(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("path",{d:"M5.7 4.15a2.3 2.3 0 0 1 4.6 0v2.8a2.3 2.3 0 0 1-4.6 0z"}),(0,ie.jsx)("path",{d:"M4.634 8.657a.55.55 0 1 0-.905.625 5.19 5.19 0 0 0 3.721 2.214v1.379h-2.6a.55.55 0 1 0 0 1.1h6.3a.55.55 0 1 0 0-1.1h-2.6v-1.379a5.19 5.19 0 0 0 3.721-2.214.55.55 0 0 0-.905-.625A4.08 4.08 0 0 1 8 10.425a4.08 4.08 0 0 1-3.366-1.768"})]})},re=(0,X().wt)("microphoneFillSmall",ae,"fillSmall");var se=()=>n(962753),le=()=>n(493552),ce=()=>n(287188),de=()=>n(63476);const ue=(0,h().YK)({setupModeLabel:{id:"agentPage.setupMode",defaultMessage:"Setup mode"},setupModeTooltip:{id:"agentPage.setupMode.tooltip.on",defaultMessage:"Configure and test the agent. Turn off to use the published version of the agent."},setupModeTooltipOff:{id:"agentPage.setupMode.tooltip.off",defaultMessage:"Use the published version of the agent. Turn on to configure and test the agent."}});function pe(e){const{aiChatFeatureController:t,config:n,threadMode:i,onChangeNextConfig:a,disabled:r}=e,s=(0,h().tz)(),d=(0,te().X)("custom_agent_flippy_layout"),u="workflow"===n.type?n.workflowId:void 0,p=(0,de().h)(u),g=(0,l().K8)((()=>(null==p?void 0:p.canAdmin())??!1),[p]),m=r||"existingThread"===i,f=d&&"workflow"===n.type&&!0===n.isCustomAgent&&g,S="workflow"===n.type&&Boolean(n.useCustomAgentDraft),y=(0,c().IS)((()=>({container:{display:"flex",alignItems:"center",gap:8,pointerEvents:"auto",cursor:"pointer",marginInlineEnd:4}})),[]),b=(0,o.useCallback)((()=>{if(m||"workflow"!==n.type)return;const e=!S;a({...n,useCustomAgentDraft:e})}),[n,S,a,m]),x=(0,o.useCallback)((e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),b())}),[b]);return f?(0,ie.jsx)(G().m,{placement:"bottom",textWrap:!0,style:{minWidth:220},renderTooltip:()=>(0,ie.jsx)("div",{children:s.formatMessage(S?ue.setupModeTooltip:ue.setupModeTooltipOff)}),render:e=>(0,ie.jsxs)("div",{onClick:b,onKeyDown:x,style:y.container,role:"switch",tabIndex:0,"aria-checked":S,"aria-label":s.formatMessage(ue.setupModeLabel),...e,children:[(0,ie.jsx)(ce().A,{on:S,disabled:m,disallowTabbing:!0,onClick:e=>{e.stopPropagation(),b()},"aria-label":s.formatMessage(ue.setupModeLabel)}),(0,ie.jsx)(le().D,{styleKey:t.unifiedChatInputModeButtonStyleKey,colorVariant:"secondary",colorPalette:S?"blue":"gray",children:(0,ie.jsx)(h().sA,{...ue.setupModeLabel})})]})}):null}const ge=(0,h().YK)({stopInference:{id:"aiInferenceTranscript.stopInference",defaultMessage:"Stop AI message"}}),he=28;function me(e){const{onClick:t,disabled:n}=e,[i,a]=(0,o.useState)(!1),r=(0,h().tz)(),s=(0,c().eP)(),l=(0,c().IS)((()=>{const e="light"===s?Q().Tj.background.accentPrimary:Q().Tj.gray.background.tertiary;return{button:{width:he,height:he,borderRadius:30,pointerEvents:"auto",background:e},icon:{fill:Q().Tj.text.inversePrimary},hovered:{background:(0,ne().R)({color:e,mode:s})},pressed:{background:(0,ne().y)({color:e,mode:s})}}}),[s]),d=(0,o.useCallback)((()=>{a(!0),t({userAction:"AgentChatTranscript.StopInference.stopButtonClick"}).catch((()=>{})).finally((()=>{a(!1)}))}),[t]);return(0,ie.jsx)($().A,{testId:"agent-stop-inference-button",icon:oe().U,style:l.button,hoveredStyle:l.hovered,pressedStyle:l.pressed,onClick:d,iconStyle:l.icon,ariaLabel:r.formatMessage(ge.stopInference),disabled:i||n},"stop-inference")}var fe=()=>n(420802),Se=()=>n(270511),ye=()=>n(564884),be=()=>n(626001),xe=()=>n(975445);function Ce(e){const{config:t,onChangeNextConfig:n}=e,i=(0,a().v3)(),r=(0,L().r)(),s=(0,xe().N)({spaceId:r}),c=(0,l().K8)((()=>(0,se().P$)(i,r??void 0)),[i,r]),{isAvailable:d,isAskModeEnabled:u}=(0,o.useMemo)((()=>{if("workflow"!==t.type)return{isAvailable:!1,isAskModeEnabled:!1};return Boolean(t.isCustomAgent||t.isCustomAgentBuilder)?{isAvailable:!1,isAskModeEnabled:!1}:c?{isAvailable:!0,isAskModeEnabled:Boolean(t.useReadOnlyMode)}:{isAvailable:!1,isAskModeEnabled:!1}}),[t,c]),p=(0,o.useCallback)((e=>{if(!d||"workflow"!==t.type)return;r&&(0,be().Oq)(r,{readOnlyModeEnabled:e});const o=e?{eventName:"agent_allow_edits_turned_off",eventProperties:{ai_session_id:s.aiSessionId,ai_inference_id:s.aiInferenceId,allow_edits_enabled:!1}}:{eventName:"agent_allow_edits_turned_on",eventProperties:{ai_session_id:s.aiSessionId,ai_inference_id:s.aiInferenceId,allow_edits_enabled:!0}};(0,ye().u)({environment:i,event:o}),n({...t,useReadOnlyMode:e})}),[t,r,d,n,i,s.aiInferenceId,s.aiSessionId]),g=(0,o.useCallback)((()=>{p(!u)}),[u,p]);return{isAskModeAvailable:d,isAskModeEnabled:u,setAskModeEnabled:p,toggleAskMode:g}}const ve=(0,h().YK)({tooltipTitle:{id:"UnifiedChatReadOnlyModeButton.tooltip.title",defaultMessage:"Allow edits"},tooltipSubtitle:{id:"UnifiedChatReadOnlyModeButton.tooltip.subtitle",defaultMessage:"Allow Notion AI to make changes"},pressedLabel:{id:"UnifiedChatReadOnlyModeButton.ariaLabel.on",defaultMessage:"Allow edits mode is on"},unpressedLabel:{id:"UnifiedChatReadOnlyModeButton.ariaLabel.off",defaultMessage:"Allow edits mode is off"}});function Me(e){const{aiChatFeatureController:t,config:n,inputMode:o,onChangeNextConfig:i}=e,r=(0,h().tz)(),s=(0,a().v3)(),d=(0,a().WS)(),{isAskModeAvailable:u,isAskModeEnabled:p,toggleAskMode:g}=Ce({config:n,onChangeNextConfig:i}),m=(0,l().K8)((()=>(0,Se().A)(s)||s.device.isPhone),[s]),f=d||"sidebar"===t.agentChatFormFactor||"popup"===t.agentChatFormFactor||"full_page"===t.agentChatFormFactor&&void 0!==t.chatViewMinWidth&&m,S=(0,c().IS)((()=>({container:{display:"flex",alignItems:"center",gap:6,pointerEvents:"auto",cursor:"pointer",marginInlineEnd:10}})),[]);return u?(0,ie.jsx)(G().m,{placement:"bottom",textWrap:!0,style:{minWidth:240},renderTooltip:()=>(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("div",{children:r.formatMessage(ve.tooltipTitle)}),(0,ie.jsx)(le().D,{colorVariant:"secondary",children:r.formatMessage(ve.tooltipSubtitle)})]}),render:e=>(0,ie.jsxs)("div",{onClick:g,style:S.container,role:"checkbox",tabIndex:0,"aria-checked":!p,"aria-label":p?r.formatMessage(ve.unpressedLabel):r.formatMessage(ve.pressedLabel),...e,children:[(0,ie.jsx)(fe().S,{checked:!p,size:14}),(0,ie.jsx)(le().D,{styleKey:t.unifiedChatInputModeButtonStyleKey,colorPalette:p?"gray":"blue",colorVariant:"secondary",children:f?(0,ie.jsx)(h().sA,{id:"UnifiedChatReadOnlyModeButton.label.collapsed",defaultMessage:"Edits"}):(0,ie.jsx)(h().sA,{id:"UnifiedChatReadOnlyModeButton.label",defaultMessage:"Allow edits"})})]})}):null}const ke=(0,h().YK)({startRecording:{id:"aiInferenceTranscript.startRecording",defaultMessage:"Start recording"},stopRecording:{id:"aiInferenceTranscript.stopRecording",defaultMessage:"Stop recording"}});function je(e){const{aiChatFeatureController:t,config:n,inputMode:o,threadMode:i,onChangeNextConfig:r,onStartRecording:s,onStopInference:c,onStopRecording:d,onSubmit:u,disabled:p,allowQueuingDuringStreaming:g}=e,h=(0,a().v3)(),m=(0,L().r)(),f=(0,l().K8)((()=>(0,se().P$)(h,m)),[h,m]),S=(0,te().X)("agent_transcription"),y=(t.isChatReady(o),f);let b;return b="recording"===o?(0,ie.jsx)(Ie,{onClick:d}):"pendingStop"===o?(0,ie.jsx)(me,{onClick:c,disabled:!0}):"runningInference"===o&&t.supportsStopInference(n.type)?g&&!p?(0,ie.jsx)(_e,{onSubmit:u,aiChatFeatureController:t,inputMode:o}):(0,ie.jsx)(me,{onClick:c}):(0,ie.jsx)(_e,{onSubmit:u,aiChatFeatureController:t,inputMode:o}),(0,ie.jsxs)(ie.Fragment,{children:[y?(0,ie.jsx)(Me,{aiChatFeatureController:t,config:n,inputMode:o,onChangeNextConfig:r}):null,S&&"recording"!==o&&"runningInference"!==o?(0,ie.jsx)(we,{aiChatFeatureController:t,onClick:s,disabled:p||t.isChatCompletelyDisabled(o)}):null,(0,ie.jsx)(pe,{aiChatFeatureController:t,config:n,threadMode:i,disabled:Boolean(p),onChangeNextConfig:r}),b]})}function Ie(e){const{onClick:t}=e,n=(0,h().tz)(),o=(0,c().IS)((()=>({button:{width:Ae,height:Ae,borderRadius:30,pointerEvents:"auto"}})),[]);return(0,ie.jsx)($().A,{testId:"agent-stop-recording-button",icon:oe().U,style:o.button,onClick:t,ariaLabel:n.formatMessage(ke.stopRecording)},"stop-recording")}function we(e){const{onClick:t,aiChatFeatureController:n,disabled:i}=e,a=(0,h().tz)(),r=n.shouldUseCompactSubmitButton,s=r?Pe:Ae,l=r?X().Ev.xs:X().Ev.sm,d=(0,c().eP)(),u=(0,c().IS)((()=>{const e=Q().Tj.icon.secondary;return{button:{width:s,height:s,borderRadius:30,pointerEvents:"auto",background:e},icon:{width:l,height:l,fill:Q().Tj.text.inversePrimary},hovered:{background:(0,ne().R)({color:e,mode:d})},pressed:{background:(0,ne().y)({color:e,mode:d})}}}),[s,l,d]),p=(0,o.useCallback)((()=>{i||t()}),[i,t]);return(0,ie.jsx)($().A,{testId:"agent-start-recording-button",icon:re,onClick:p,style:u.button,iconStyle:u.icon,hoveredStyle:u.hovered,pressedStyle:u.pressed,size:"lg",disabled:i,ariaLabel:a.formatMessage(ke.startRecording)},"start-recording")}const Ae=28,Te=24,Pe=20;const Fe=(0,h().YK)({submitAiMessage:{id:"SendMessageButton.submitAiMessage",defaultMessage:"Submit AI message"}});function _e(e){const{onSubmit:t,inputMode:n,aiChatFeatureController:o}=e,i=(0,h().tz)(),a=(0,ee().u)(),r=o.shouldUseCompactSubmitButton,s=function(e){const t=e.shouldUseCompactSubmitButton,n=e.isSingleLineInput;return t?Pe:n?Te:Ae}(o),l=r?X().Ev.xs:X().Ev.sm,d=(0,c().eP)(),u=(0,c().IS)((()=>({button:{width:s,height:s,borderRadius:30,pointerEvents:"auto",background:Q().Tj.blue.icon.accentPrimary},icon:{width:l,height:l,fill:Q().Tj.text.inversePrimary},hovered:{background:(0,Y().i)({color:Q().Tj.blue.background.accentPrimary,mode:d})},pressed:{background:(0,Y().yZ)({color:Q().Tj.blue.background.accentPrimary,mode:d})}})),[s,l,d]);return o.isChatSubmitDisabled(n)||o.isChatCompletelyDisabled(n)?(0,ie.jsx)(Ee,{...e}):a?(0,ie.jsx)(Z().PulsingWrapper,{shape:"circle",withBackground:!1,size:s,children:(0,ie.jsx)($().A,{testId:"agent-send-message-button",icon:J().arrowStraightUpFillSmallIcon,onClick:t,style:u.button,iconStyle:u.icon,hoveredStyle:u.hovered,pressedStyle:u.pressed,size:"lg",ariaLabel:i.formatMessage(Fe.submitAiMessage)},"send-message")}):(0,ie.jsx)($().A,{testId:"agent-send-message-button",icon:J().arrowStraightUpFillSmallIcon,onClick:t,style:u.button,iconStyle:u.icon,hoveredStyle:u.hovered,pressedStyle:u.pressed,size:"lg",ariaLabel:i.formatMessage(Fe.submitAiMessage)},"send-message")}function Ee(e){const{inputMode:t,aiChatFeatureController:n}=e,i=(0,h().tz)(),a=n.shouldUseCompactSubmitButton,r=n.isSingleLineInput,s=a?Pe:r?Te:Ae,l=a?X().Ev.xs:X().Ev.sm,d=(0,c().IS)((()=>({button:{width:s,height:s,borderRadius:30,pointerEvents:"auto",background:Q().Tj.background.tertiaryTranslucent},icon:{width:l,height:l,fill:Q().Tj.icon.tertiary}})),[s,l]),u=(0,o.useMemo)((()=>{switch(t){case"configTypeDown":return(0,ie.jsx)(h().sA,{...K().$.cannotSubmitMessage});case"modelProviderDown":return(0,ie.jsx)(h().sA,{...K().$.modelProviderDown});case"error":return(0,ie.jsx)(h().sA,{id:"unifiedChatInput.error",defaultMessage:"Please dismiss the error to continue"});case"ready":return null;case"noContent":return(0,ie.jsx)(h().sA,{id:"unifiedChatInput.emptyInput",defaultMessage:"Please enter a message"});case"uploadingFiles":return(0,ie.jsx)(h().sA,{id:"unifiedChatInput.uploadingFiles",defaultMessage:"Please wait for the files to finish uploading"});case"filesRequireConfirmation":return(0,ie.jsx)(h().sA,{id:"unifiedChatInput.filesRequireConfirmation",defaultMessage:"Please confirm whether the uploaded files are trusted."});case"readOnlyThread":return(0,ie.jsx)(h().sA,{id:"unifiedChatInput.isReadOnlyThread",defaultMessage:"This thread is read-only"});case"upgradeRequired":return(0,ie.jsx)(h().sA,{id:"unifiedChatInput.upgradeRequired",defaultMessage:"Upgrade to continue using AI features"});case"runningInference":return(0,ie.jsx)(h().sA,{id:"unifiedChatInput.runningInference",defaultMessage:"Please wait for the request to complete"});case"pendingStop":return(0,ie.jsx)(h().sA,{id:"unifiedChatInput.pendingStop",defaultMessage:"Stopping request..."});case"aiDisabled":return(0,ie.jsx)(h().sA,{id:"unifiedChatInput.aiDisabled",defaultMessage:"AI is disabled for this workspace"});default:(0,T().HB)(t)}}),[t]);return(0,ie.jsx)(G().m,{renderTooltip:e=>(0,ie.jsx)("div",{...e,children:u}),render:e=>(0,ie.jsx)($().A,{...e,icon:J().arrowStraightUpFillSmallIcon,style:d.button,iconStyle:d.icon,colorVariant:"secondary",size:"lg",disabled:!0,ariaLabel:i.formatMessage(Fe.submitAiMessage),testId:"agent-send-message-button"},"send-message")})}var De=()=>n(609616),Be=()=>n(383036),Re=()=>n(807449);function Ne(e){const{testId:t,tooltipText:n,tooltipCaption:o,icon:i,...a}=e,r=(0,h().tz)(),s=(0,c().IS)((()=>({button:{pointerEvents:"auto",borderRadius:"50%",width:28,height:28},hoverButton:{backgroundColor:Q().Tj.buttonHoveredBackground}})),[]);return(0,ie.jsx)(G().m,{placement:"bottom",renderTooltip:()=>(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("div",{children:r.formatMessage(n)}),o?(0,ie.jsx)(le().D,{colorVariant:"secondary",children:r.formatMessage(o)}):void 0]}),render:e=>(0,ie.jsx)($().A,{...(0,Be().A)(e,a),ariaLabel:r.formatMessage(n),icon:()=>(0,ie.jsx)(Re().I,{icon:i,colorVariant:"secondary",size:"default"}),style:s.button,hoveredStyle:s.hoverButton,testId:t})})}const ze=(0,h().YK)({tooltipText:{id:"UnifiedChatAttachFileButton.tooltipText",defaultMessage:"Attach file"},tooltipCaptionWithCsv:{id:"UnifiedChatAttachFileButton.tooltipCaptionWithCsv",defaultMessage:"Most images, PDFs, and CSV files"}});function Ue(e){const{config:t,loadAttachmentData:n,aiChatFeatureController:i,threadStore:r,spaceStore:s}=e,l="workflow"===t.type?t.model:void 0,c=(0,a().v3)(),d=(0,xe().N)({threadStore:r,spaceId:s.id}),u=(0,o.useCallback)((()=>{m().trackAttachFileOpened({environment:c,from:i.analyticsFromSourceForActions,model:l,inferenceInfo:d}),n&&n.uploadFiles()}),[c,n,i.analyticsFromSourceForActions,l,d]);return n?(0,ie.jsx)(Ne,{tooltipText:ze.tooltipText,tooltipCaption:ze.tooltipCaptionWithCsv,icon:De().o,onClick:u,testId:"unified-chat-attach-file-button"}):null}n(908872);var Ke=()=>n(996755),Oe=()=>n(250910),Le=()=>n(118307),Ve=()=>n(373009),We=()=>n(599552),He=()=>n(440024),qe=()=>n(865698),Ye=()=>n(716469),$e=()=>n(403008),Ge=()=>n(652011),Je=()=>n(65474);const Xe=(0,h().YK)({modelTooltip:{id:"UnifiedChatModelButton.tooltip",defaultMessage:"Select AI model"},modelPickerDisabledForConfig:{id:"UnifiedChatModelButton.modelPickerDisabledForConfig",defaultMessage:"Model selection is not available for research mode"},modelPickerDisabledForThreadMode:{id:"UnifiedChatModelButton.modelPickerDisabledForThreadMode",defaultMessage:"Response in progress"},existingThreadModelPickerDisabled:{id:"UnifiedChatModelButton.existingThreadModelPickerDisabled",defaultMessage:"Start a new chat to switch models"}});function Qe(e){const{aiChatFeatureController:t,config:n,clientStore:i,inputMode:r,onChangeNextConfig:s,spaceStore:d,threadStore:u,threadMode:p,isSimplifiedInputEnabled:g}=e,f=(0,o.useMemo)((()=>{if("workflow"===n.type&&n.modelFromUser)return(0,We().kD)(n)}),[n]),S=(0,h().tz)(),y=(0,a().v3)(),b=(0,xe().N)({threadStore:u,spaceId:d.id}),x=(0,l().K8)((()=>(0,Se().A)(y)||y.device.isPhone),[y]),C=(0,a().WS)(),v=(0,l().uB)(void 0,Le().A),{modelTooltipMessage:M,modelPickerLimitation:k}=(0,o.useMemo)((()=>{const e=t.isModelPickerLimited({mode:r,threadMode:p,config:n});return{modelPickerLimitation:e,modelTooltipMessage:Ze({intl:S,modelPickerLimitation:e})}}),[t,r,p,n,S]),{modelName:j,modelColor:I,modelFamily:w}=(0,Ye().R)({config:n,agentModelConfig:f,intl:S}),A=(0,o.useMemo)((()=>g?"workflow"===n.type&&null!=f&&f.type?(0,qe().VX)(f.type,S)??j:"markdown-chat"===n.type&&n.model?(0,qe().VX)(n.model,S)??j:j:j),[null==f?void 0:f.type,n,S,g,j]),T=(0,o.useMemo)((()=>({close:()=>{v.setState({open:!1})}})),[v]),P=(0,$e().w)({aiChatFeatureController:t,buttonPopupParent:T,clientStore:i,config:n,environment:y,isSimplifiedInputEnabled:g,inputMode:r,threadMode:p,onChangeNextConfig:s,spaceStore:d,inferenceInfo:b}),F=!g&&void 0!==w&&"markdown-chat"!==n.type&&(C||"sidebar"===t.agentChatFormFactor||"full_page"===t.agentChatFormFactor&&void 0!==t.chatViewMinWidth&&x),_=(0,c().eP)(),E=(0,c().IS)((()=>{const e="gemini"===w?{background:"light"===_?"#F5F7FE":"#2F3951",textColor:"light"===_?"#6867CA":"#C3C2FF"}:null,t=(0,Ke().q)({variant:"tint",themeMode:_,colorPalette:"gemini"===w?void 0:(null==I?void 0:I.buttonColor)??void 0}),n=(null==e?void 0:e.background)??("string"==typeof t.resting.background?t.resting.background:Q().Tj.background.tertiaryTranslucent),o={...g&&{background:"transparent"},...void 0===I&&{background:"transparent"},...e&&!g&&{background:e.background}};return{tooltipMinWidth:"warn"===(null==k?void 0:k.action)||"disable"===(null==k?void 0:k.action)?{minWidth:150}:{},button:{...o,...F?{pointerEvents:"auto",borderRadius:"50%",width:28,height:28}:{borderRadius:50,height:28,display:"flex",alignItems:"center",justifyContent:"center",gap:x&&void 0===w?0:6,pointerEvents:"auto",minWidth:0,maxWidth:200,paddingInlineStart:void 0!==w?8:x?6:12,paddingInlineEnd:x?6:12}},hoverButton:{backgroundColor:Q().Tj.buttonHoveredBackground},simplifiedHoveredButton:{background:n},simplifiedPressedButton:{background:(0,ne().y)({color:n,mode:_})},geminiHoveredButton:e?{background:(0,ne().R)({color:e.background,mode:_})}:{},geminiPressedButton:e?{background:(0,ne().y)({color:e.background,mode:_})}:{},geminiTextColor:e&&!g?{color:e.textColor}:{}}}),[I,w,F,null==k?void 0:k.action,x,g,_]),D=(0,o.useCallback)((()=>{m().trackSourceMenuOpened({environment:y,button_name:"source_menu_model_diff",from:t.analyticsFromSourceForActions,model:null==f?void 0:f.type,inferenceInfo:b}),(0,He().I)({environment:y})}),[y,t.analyticsFromSourceForActions,null==f?void 0:f.type,b]),B=P.reduce(((e,t)=>e+t.items.length),0)>1;return t.isChatCompletelyDisabled(r)||!t.showModelButton?null:"hide"!==(null==k?void 0:k.action)&&B?(0,ie.jsx)(G().m,{placement:"bottom",textWrap:"warn"===(null==k?void 0:k.action)||"disable"===(null==k?void 0:k.action),style:E.tooltipMinWidth,renderTooltip:()=>(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("div",{children:M}),"researcher_config"!==(null==k?void 0:k.reason)?(0,ie.jsx)(le().D,{colorVariant:"secondary",children:A}):void 0]}),render:e=>P.length>0?(0,ie.jsx)(Oe().A,{buttonPopupStore:v,popupType:t.adaptiveMenuPopupType,originGap:2,placementToOrigin:"bottom",alignmentToOrigin:"start",onClick:D,renderOrigin:n=>(0,ie.jsxs)(Ve().E,{colorPalette:g||"gemini"===w?void 0:(null==I?void 0:I.buttonColor)??void 0,...n,style:E.button,...g&&{hoveredStyle:E.simplifiedHoveredButton,pressedStyle:E.simplifiedPressedButton},...!g&&void 0===w&&{hoveredStyle:E.hoverButton},...!g&&"gemini"===w&&{hoveredStyle:E.geminiHoveredButton,pressedStyle:E.geminiPressedButton},...e,disabled:"disable"===(null==k?void 0:k.action),testId:"unified-chat-model-button",children:[void 0!==w?(0,ie.jsx)(Ge().H,{modelFamily:w,defaultNoAiFace:!0}):void 0,F?void 0:(0,ie.jsx)(le().D,{styleKey:t.unifiedChatInputModeButtonStyleKey,colorPalette:g||"gemini"===w?void 0:(null==I?void 0:I.textColor)??"gray",colorVariant:"secondary",textOverflow:"ellipsis",style:"gemini"===w?E.geminiTextColor:void 0,children:A})]}),render:()=>(0,ie.jsx)(Je().J,{buttonPopupParent:T,extensionPopupButtonEvents:{},sections:P,menuType:t.adaptiveMenuType})}):(0,ie.jsx)(Ve().E,{style:{...E.button,cursor:"default",pointerEvents:"none"},colorPalette:"blue",...e,children:(0,ie.jsx)(le().D,{styleKey:"bodyMedium",colorPalette:"blue",colorVariant:"secondary",textOverflow:"ellipsis",children:j})})}):null}function Ze(e){const{intl:t,modelPickerLimitation:n}=e;if(void 0===n)return t.formatMessage(Xe.modelTooltip);switch(n.reason){case"custom_agent_config":case"researcher_config":return t.formatMessage(Xe.modelPickerDisabledForConfig);case"running_inference":return t.formatMessage(Xe.modelPickerDisabledForThreadMode);case"existing_thread":return t.formatMessage(Xe.existingThreadModelPickerDisabled)}}var et=()=>n(38679),tt=()=>n(724639),nt=()=>n(844317),ot=()=>n(36951);function it(e){const{aiChatFeatureController:t,config:n,inputMode:i,threadMode:r,onChangeNextConfig:s,threadStore:c,spaceStore:d}=e,u=(0,a().v3)(),p=(0,L().r)(),g=(0,xe().N)({threadStore:c,spaceId:d.id}),h=(0,l().K8)((()=>P().zD.isZeroRetentionEnabled()),[]),m=(0,te().X)("ai_research_mode_use_agent"),f=t.supportsWorkspaceContext(n.type),S=t.supportsConfigTypeChanges({mode:i,threadMode:r}),y="researcher"===n.type||"workflow"===n.type&&!0===n.researchMode,b=f&&(S||y),x=(0,o.useCallback)((()=>{var e;if(!b)return;const t=null===(e=(0,tt().n_)({config:n,modules:[]}))||void 0===e?void 0:e.at(0),o=!h&&(0,tt().H0)({config:n,modules:[]});let i;i=y?(0,ot().YM)({spaceId:p,searchScopes:t?[t]:void 0}):m?(0,nt().getWorkflowAgentConfig)({researchMode:!0,searchScopes:t?[t]:void 0,useWebSearch:o}):{type:"researcher",searchScope:t,useWebSearch:o},(0,ye().u)({environment:u,event:{eventName:"clicked_ai_chat_mode",eventProperties:{mode:i.type,ai_session_id:g.aiSessionId,ai_inference_id:g.aiDraftInferenceId}}}),s(i)}),[b,y,m,n,s,p,h,u,g.aiDraftInferenceId,g.aiSessionId]);return{showResearchModeToggle:b,isResearchModeEnabled:y,supportsConfigTypeChange:S,toggleResearchMode:x}}const at=(0,h().YK)({researchModeTooltip:{id:"UnifiedChatResearchModeButton.tooltip",defaultMessage:"Thorough research reports that take more time, ideal for complex questions"}});function rt(e){const{aiChatFeatureController:t,config:n,inputMode:o,threadMode:i,onChangeNextConfig:r,threadStore:s,spaceStore:d}=e,u=(0,a().v3)(),p=(0,h().tz)(),g=(0,l().K8)((()=>(0,Se().A)(u)&&void 0!==t.chatViewMinWidth),[u,t.chatViewMinWidth]),{showResearchModeToggle:m,isResearchModeEnabled:f,supportsConfigTypeChange:S,toggleResearchMode:y}=it({aiChatFeatureController:t,config:n,inputMode:o,threadMode:i,onChangeNextConfig:r,threadStore:s,spaceStore:d}),b=(0,c().IS)((()=>({button:{borderRadius:50,height:28,display:"flex",alignItems:"center",justifyContent:"center",gap:4,pointerEvents:"auto",...f?{background:Q().Tj.blue.background.secondary}:{background:"transparent"},...!S&&{opacity:1},...g&&{pointerEvents:"auto",borderRadius:"50%",width:28,height:28}},hoveredButton:{...f?{background:Q().Tj.blue.background.tertiary}:{background:Q().Tj.buttonHoveredBackground}}})),[f,S,g]);return m?(0,ie.jsx)(G().m,{placement:"bottom",textWrap:!0,style:{minWidth:200},renderTooltip:()=>(0,ie.jsx)("div",{children:p.formatMessage(at.researchModeTooltip)}),render:e=>(0,ie.jsxs)(Ve().E,{onClick:y,style:b.button,hoveredStyle:b.hoveredButton,colorPalette:f?"blue":void 0,"aria-pressed":f,disabled:!S,"aria-label":f?p.formatMessage({id:"ResearchModeToggle.ariaLabel.on",defaultMessage:"Research mode is on"}):p.formatMessage({id:"ResearchModeToggle.ariaLabel.off",defaultMessage:"Research mode is off"}),...e,testId:"unified-chat-research-mode-button",children:[(0,ie.jsx)(Re().I,{icon:et().P,colorPalette:f?"blue":"gray",colorVariant:"secondary",size:"default"}),g?void 0:(0,ie.jsx)(le().D,{styleKey:t.unifiedChatInputModeButtonStyleKey,colorPalette:f?"blue":"gray",colorVariant:"secondary",children:(0,ie.jsx)(h().sA,{id:"ResearchModeToggle.label",defaultMessage:"Research"})})]})}):null}n(354520),n(737550);var st=()=>n(951500),lt=()=>n(477336),ct=()=>n(297173),dt=()=>n(12193),ut=()=>n(850902),pt=()=>n(915671),gt=()=>n(655600),ht=()=>n(176983),mt=()=>n(476488),ft=()=>n(255350);const St=(0,h().YK)({everythingScope:{id:"useSearchScopeName.everythingScope",defaultMessage:"All sources I can access"},webSearchOnly:{id:"useSearchScopeName.webSearchOnly",defaultMessage:"Web search only"},noSources:{id:"useSearchScopeName.noSources",defaultMessage:"No sources"},multipleScopes:{id:"useSearchScopeName.multipleScopes",defaultMessage:"{scopeCount, plural, one {# scope} other {# scopes}}"}});function yt(e){const{config:t,spaceStore:n,aiChatFeatureController:o,showEverythingLabel:i=!0}=e,r=(0,a().v3)(),s=(0,h().tz)();return(0,l().K8)((()=>{const e=function(e){return"workflow"===e.type?(0,tt().n_)({config:e,modules:[]})??[]:"researcher"===e.type?e.searchScope?[e.searchScope]:[]:"search"===e.type&&e.scopeForNextSearch?[e.scopeForNextSearch]:[]}(t);if(0===e.length)return s.formatMessage(St.everythingScope);if(e.length>1)return s.formatMessage(St.multipleScopes,{scopeCount:e.length});const a=e[0];if("ai-knowledge"===a.type){const e=o.supportsWebSearch(t.type),n=(0,tt().H0)({config:t,modules:[]});return e&&n?s.formatMessage(St.webSearchOnly):s.formatMessage(St.noSources)}const{scopeTitle:l}=(0,ft().tu)({environment:r,searchScope:a,spaceStore:n,intl:s,showEverythingLabel:i});return l??s.formatMessage(St.everythingScope)}),[t,r,n,s,i,o])}var bt=()=>n(380801),xt=(n(823215),()=>n(106702)),Ct=()=>n(852507),vt=()=>n(118884),Mt=()=>n(574359),kt=()=>n(265060),jt=()=>n(546926),It=()=>n(758304),wt=()=>n(890492),At=()=>n(81068),Tt=()=>n(424400),Pt=()=>n(663639),Ft=()=>n(736847),_t=()=>n(452004),Et=()=>n(902006),Dt=()=>n(173614),Bt=()=>n(105819),Rt=()=>n(617668),Nt=()=>n(96563),zt=()=>n(140022),Ut=()=>n(574036),Kt=()=>n(453697),Ot=()=>n(528093),Lt=()=>n(663929),Vt=(n(430670),n.n(n(844751))),Wt=()=>n(755531),Ht=()=>n(726637),qt=()=>n(991003),Yt=()=>n(710515),$t=()=>n(98126),Gt=()=>n(382607),Jt=()=>n(471095),Xt=()=>n(245241),Qt=()=>n(284371),Zt=()=>n(879643),en=()=>n(419357),tn=()=>n(187820),nn=()=>n(305390),on=()=>n(16006),an=()=>n(662971),rn=()=>n(606273),sn=()=>n(396301),ln=()=>n(159588),cn=()=>n(135599),dn=()=>n(898808);const un=280,pn=325,gn=20,hn=12,mn=(0,h().YK)({inputPlaceholder:{id:"UnifiedChatNotionScopeMenu.inputPlaceholder",defaultMessage:"Find or use knowledge in…"},selectedNotionScopeCount:{id:"UnifiedChatSpaceScopeMenu.selectedNotionScopeCount",defaultMessage:"{count, plural, one {# scope} other {# scopes}}"},expandTeamspace:{id:"UnifiedChatSpaceScopeMenu.expandTeamspace",defaultMessage:"Expand teamspace"},collapseTeamspace:{id:"UnifiedChatSpaceScopeMenu.collapseTeamspace",defaultMessage:"Collapse teamspace"},expandPage:{id:"UnifiedChatSpaceScopeMenu.expandPage",defaultMessage:"Expand page"},collapsePage:{id:"UnifiedChatSpaceScopeMenu.collapsePage",defaultMessage:"Collapse page"},expandDatabase:{id:"UnifiedChatSpaceScopeMenu.expandDatabase",defaultMessage:"Expand database"},collapseDatabase:{id:"UnifiedChatSpaceScopeMenu.collapseDatabase",defaultMessage:"Collapse database"}}),fn=(0,h().YK)({notion:{id:"UnifiedChatNotionScopeMenu.workspaceFuzzyName",defaultMessage:"{workspaceName} Notion workspace"},workspace:{id:"UnifiedChatNotionScopeMenu.workspaceFuzzyName",defaultMessage:"{workspaceName} Notion workspace"},teamspace:{id:"UnifiedChatNotionScopeMenu.teamspaceFuzzyName",defaultMessage:"Teamspace"},page:{id:"UnifiedChatNotionScopeMenu.pageFuzzyName",defaultMessage:"Page"},collection:{id:"UnifiedChatNotionScopeMenu.collectionFuzzyName",defaultMessage:"Database"}});function Sn(e){switch(e.type){case"notion":return"notion";case"workspace":return"workspace";case"teamspace":return`teamspace-${e.teamId}`;case"page":return`page-${e.pageId}`;case"collection":return`collection-${e.pageId}-${e.collectionId}`}}function yn(e,t,n,o=0){const i=[];for(const a of e){const e=Sn(a),r=t.has(e),s=bn(a),l=s.length>0,c={item:a,depth:o,parentId:n,itemId:e,hasChildren:l,childrenStores:s,visible:!0};if(i.push(c),l&&r&&o<gn){const n=yn(s.map(((e,t)=>{const n=(0,ft().D0)(e);return n.type,{...n,pageId:e.id,pageStore:e}})),t,e,o+1);i.push(...n)}}return i}function bn(e){const t=(0,ft().hX)();switch(e.type){case"workspace":case"collection":case"notion":default:return[];case"teamspace":return e.teamStore.getTeamPageStores();case"page":return(0,sn().yD)({rootStore:e.pageStore,shouldSkipItemTypes:ft().j8,shouldShowItemTypes:t})}}function xn(e){const{aiChatFeatureController:t,buttonPopupParent:n,config:a,currentSearchScopes:r,extensionPopupButtonEvents:s,onChange:c}=e,d=(0,be().in)(a),u=(0,h().tz)(),p=(0,l().O$)(i().AppStoreSidebarSpaceViewStore),g="workflow"===a.type,[m,f]=(0,o.useState)(""),[S,y]=(0,o.useState)(new Set),b=(0,l().K8)((()=>{var e;return(null===(e=(0,Wt().S)())||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.getRenderTitle())??""}),[]),x=(0,o.useCallback)((e=>{const t="workflow"===a.type,o=function(e){return"teamspace"===e.type?{type:"teamspace",teamId:e.teamId}:"page"===e.type?{type:"page",pageId:e.pageId}:"collection"===e.type?{type:"collection",pageId:e.pageId,collectionId:e.collectionId}:e}(e),i=(0,be().Af)({currentScopes:r??[],scope:o,isMultiScopeEnabled:t});t||n.close();const s=(0,be().Zd)(a,i);null==c||c(s)}),[n,r,a,c]),C=(0,o.useMemo)((()=>[{type:"notion"}]),[]),v=(0,o.useMemo)((()=>C.filter((e=>{const t=u.formatMessage(fn[e.type],{workspaceName:b});return Vt().test(m,t)}))),[m,u,C,b]),M=(0,l().K8)((()=>p?(0,Yt().r)(p).map((e=>({type:"teamspace",teamId:e.id,teamStore:e}))):[]),[p]),k=(0,l().K8)((()=>M.filter((e=>{var t;const n=(null===(t=e.teamStore.getModel())||void 0===t?void 0:t.getRenderTitle())??"",o=`${u.formatMessage(fn.teamspace)} ${n}`;return Vt().test(m,o)}))),[m,M,u]),{results:j,isResultsLoading:I}=(0,cn().W)({source:"ai_chat_search_scope_menu",query:m,limit:20,type:Xt().Vz.BlocksInSpace,filters:{requireEditPermissions:!1,excludeTemplates:!0},options:{disable:!m},peopleBlocksToInclude:"none"}),w=(0,qt().A)(I,400,0),A=(0,l().K8)((()=>j.flatMap((e=>{var t;const n=e.store,o=(null===(t=n.getCollectionPointers())||void 0===t?void 0:t.map((e=>e.id)))??[];return n.isCollectionView()&&o.length>0?o.map((e=>({type:"collection",pageId:n.id,pageStore:n,collectionId:e}))):[{type:"page",pageId:n.id,pageStore:n}]}))),[j]),T=(0,l().K8)((()=>{const e={sections:[],addSection(e){e&&this.sections.push(e)}};return m?(e.addSection(kn({filteredEligibleSearchScopes:v,currentSearchScope:d,currentSearchScopes:r,isWorkflowMultiScopeEnabled:g,handleSelectScope:x})),e.addSection(function(e){const{filteredTeamSpaceScopes:t,currentSearchScope:n,currentSearchScopes:o,isWorkflowMultiScopeEnabled:i,handleSelectScope:a}=e;return Mn({key:"teamspace-results-section",title:(0,ie.jsx)(h().sA,{id:"UnifiedChatNotionScopeMenu.teamspaceResultsSectionTitle",defaultMessage:"Teamspaces"}),items:t.map(((e,t)=>({key:(0,Zt().S)(e,t),render:t=>(0,ie.jsx)(In,{...t,item:e,currentSearchScope:n,currentSearchScopes:o,isWorkflowMultiScopeEnabled:i}),action:()=>{a(e)}})))})}({filteredTeamSpaceScopes:k,currentSearchScope:d,currentSearchScopes:r,isWorkflowMultiScopeEnabled:g,handleSelectScope:x})),e.addSection(function(e){const{filteredBlockScopes:t,currentSearchScope:n,currentSearchScopes:o,isWorkflowMultiScopeEnabled:i,handleSelectScope:a}=e;return Mn({key:"block-results-section",title:(0,ie.jsx)(h().sA,{id:"UnifiedChatNotionScopeMenu.blockResultsSectionTitle",defaultMessage:"Pages"}),items:t.map(((e,t)=>({key:(0,Zt().S)(e,t),render:t=>(0,ie.jsx)(In,{...t,item:e,currentSearchScope:n,currentSearchScopes:o,isWorkflowMultiScopeEnabled:i}),action:()=>{a(e)}})))})}({filteredBlockScopes:A,currentSearchScope:d,currentSearchScopes:r,isWorkflowMultiScopeEnabled:g,handleSelectScope:x})),0===e.sections.length&&e.addSection({key:"no-results-section",render:e=>(0,ie.jsx)(Ft().A,{...e}),items:[{key:"no-results-item",render:e=>(0,ie.jsx)(At().A,{...e,title:(0,ie.jsx)(h().sA,{id:"UnifiedChatNotionScopeMenu.noResultsItemTitle",defaultMessage:"No results"})}),action:()=>null}]})):(e.addSection(kn({filteredEligibleSearchScopes:v,currentSearchScope:d,currentSearchScopes:r,isWorkflowMultiScopeEnabled:g,handleSelectScope:x})),e.addSection(function(e){const{filteredTeamSpaceScopes:t,currentSearchScope:n,currentSearchScopes:o,isWorkflowMultiScopeEnabled:i,handleSelectScope:a,expandedItems:r,setExpandedItems:s,aiChatFeatureController:l}=e;if(0===t.length)return;return{key:"outliner-teamspace-scopes-section",render:e=>(0,ie.jsx)(Ft().A,{...e,title:(0,ie.jsx)(h().sA,{id:"UnifiedChatNotionScopeMenu.outlinerTeamspaceScopesSectionTitle",defaultMessage:"Select a team or page"})}),items:jn({items:t,onClick:a,currentSearchScope:n,currentSearchScopes:o,isWorkflowMultiScopeEnabled:i,expandedItems:r,setExpandedItems:s,aiChatFeatureController:l})}}({filteredTeamSpaceScopes:k,currentSearchScope:d,currentSearchScopes:r,isWorkflowMultiScopeEnabled:g,handleSelectScope:x,expandedItems:S,setExpandedItems:y,aiChatFeatureController:t}))),e.sections}),[m,v,k,A,d,r,x,S,y,g,t]),P="agent_mobile"===t.aiChatType,F=(0,o.useMemo)((()=>P?{menuType:jt().gu.Modal}:{menuType:jt().gu.Popup,width:un,maxHeight:pn}),[P]);return(0,ie.jsx)(wt().A,{...s,...F,children:(0,ie.jsx)(Pt().A,{type:Pt().O.Vertical,initialFocus:void 0,sections:[{key:"input-section",render:e=>(0,ie.jsx)(Ft().A,{...e}),items:[{key:"input",render:e=>(0,ie.jsx)(en().Ay,{...e,style:{padding:4},placeholder:u.formatMessage(mn.inputPlaceholder),value:m,onChange:e=>{f(e.target.value)},inputRight:w&&(0,ie.jsx)($t().A,{style:{marginInlineEnd:2}})}),action:()=>null}]},...T]})})}function Cn(e){const{menuListItemProps:t,menuListParent:n,item:i,showToggle:a,currentSearchScope:r,currentSearchScopes:s,isWorkflowMultiScopeEnabled:d,isExpanded:u=!1,onToggle:p,hasChildren:g=!1,aiChatFeatureController:m}=e,f=e.depth??0,S=(0,h().tz)(),y="agent_mobile"===(null==m?void 0:m.aiChatType)||Ht().A.isMobile,b=(0,o.useMemo)((()=>"teamspace"===i.type?S.formatMessage(u?mn.collapseTeamspace:mn.expandTeamspace):"collection"===i.type?S.formatMessage(u?mn.collapseDatabase:mn.expandDatabase):S.formatMessage(u?mn.collapsePage:mn.expandPage)),[i.type,u,S]),x=(0,o.useMemo)((()=>d?s.some((e=>wn({scopeMenuItem:i,scope:e}))):!!r&&wn({scopeMenuItem:i,scope:r})),[d,s,i,r]),C=(0,o.useCallback)((e=>{e.stopPropagation(),null==p||p()}),[p]),v=t.focused??!1,M=(0,c().IS)((()=>({menuItem:{...y&&{height:56,backgroundColor:Q().Tj.background.primary,borderBottom:`1px ${Q().Tj.border.primaryTranslucent} solid`}},toggleButton:{width:20,height:20},iconAndToggleContainer:{display:"grid",width:20,height:20,alignItems:"center",justifyContent:"center"},toggle:{gridColumn:1,gridRow:1,opacity:v&&!y?1:0,order:v&&!y?1:0,transition:`opacity ${ln().bM}`},icon:{gridColumn:1,gridRow:1,opacity:v&&!y?0:1,order:v&&!y?0:1,transition:`opacity ${ln().bM}`},tooltipBody:{display:"flex",flexDirection:"column"},tooltip:{whiteSpace:"pre-wrap"}})),[y,v]),k=(0,o.useMemo)((()=>!!a&&("notion"!==i.type&&"workspace"!==i.type&&("teamspace"===i.type||"page"===i.type||"collection"===i.type||void 0))),[i,a]);if(!(0,l().K8)((()=>"teamspace"===i.type||"workspace"===i.type||"notion"===i.type||("page"===i.type||"collection"===i.type)&&(0,ft().JW)(i.pageStore)),[i]))return null;const j=(0,ie.jsx)(_n,{item:i,iconSize:18}),I=y?void 0:k&&g?(0,ie.jsxs)("div",{style:M.iconAndToggleContainer,children:[(0,ie.jsx)("div",{style:M.icon,children:j}),(0,ie.jsx)("div",{style:M.toggle,children:(0,ie.jsx)(rn().f,{isSidebar:!1,fill:!0,icon:"chevron",open:u,color:Q().Tj.icon.secondary,onClick:C,style:M.toggleButton,disabled:!v,ariaLabel:b})})]}):j,w=y?k&&g?(0,ie.jsx)(rn().f,{isSidebar:!1,fill:!0,icon:"chevron",open:u,color:Q().Tj.icon.secondary,onClick:C,style:M.toggleButton,ariaLabel:b}):(0,ie.jsx)("div",{style:M.toggleButton}):void 0,A=y?j:void 0;return(0,ie.jsx)(G().m,{style:M.tooltip,placement:"left",renderTooltip:()=>(0,ie.jsx)("div",{style:M.tooltipBody,children:(0,ie.jsx)(Bn,{item:i})}),render:e=>(0,ie.jsx)(At().A,{...t,...(0,Be().A)(t,e),onFocus:n.onFocus,left:w,leftStyle:y&&f>0?{paddingInlineStart:vn(f)}:void 0,icon:I,right:A,desktopIconStyle:{flexShrink:0},title:(0,ie.jsx)(Dn,{item:i}),isChecked:x,style:{...M.menuItem,paddingInlineStart:y?void 0:Gt().Qm+vn(f)}})})}function vn(e){return e*hn}function Mn(e){const{key:t,title:n,items:o}=e;if(0!==o.length)return{key:t,render:e=>(0,ie.jsx)(Ft().A,{...e,title:n}),items:o}}function kn(e){const{filteredEligibleSearchScopes:t,currentSearchScope:n,currentSearchScopes:o,isWorkflowMultiScopeEnabled:i,handleSelectScope:a}=e;return Mn({key:"suggested-scopes-section",items:t.map((e=>({key:e.type,render:t=>(0,ie.jsx)(In,{...t,item:e,currentSearchScope:n,currentSearchScopes:o,isWorkflowMultiScopeEnabled:i}),action:()=>{a(e)}})))})}function jn(e){const{items:t,onClick:n,currentSearchScope:o,currentSearchScopes:i,isWorkflowMultiScopeEnabled:a,expandedItems:r,setExpandedItems:s,aiChatFeatureController:l}=e,c=yn(t,r);return c.filter((e=>{if(0===e.depth)return!0;let t=e;for(;t.parentId;){if(!r.has(t.parentId))return!1;const e=c.find((e=>e.itemId===t.parentId));if(!e)return!1;t=e}return!0})).map((e=>({key:e.itemId,render:(t,n)=>(0,ie.jsx)(Cn,{menuListParent:n,menuListItemProps:t,item:e.item,showToggle:!0,depth:e.depth,currentSearchScope:o,currentSearchScopes:i,isWorkflowMultiScopeEnabled:a,isExpanded:r.has(e.itemId),onToggle:()=>{return t=e.itemId,void s((e=>{const n=new Set(e);return n.has(t)?n.delete(t):n.add(t),n}));var t},hasChildren:e.hasChildren,aiChatFeatureController:l}),action:()=>{n(e.item)}})))}const In=o.forwardRef(((e,t)=>{const{item:n,currentSearchScope:i,currentSearchScopes:a,isWorkflowMultiScopeEnabled:r,...s}=e,l=(0,o.useMemo)((()=>r?a.some((e=>wn({scopeMenuItem:n,scope:e}))):!!i&&wn({scopeMenuItem:n,scope:i})),[r,a,i,n]);return"page"===n.type||"collection"===n.type?(0,ie.jsx)(nn().A,{...s,ref:t,store:n.pageStore}):"teamspace"===n.type?(0,ie.jsx)(nn().A,{...s,ref:t,store:n.teamStore}):(0,ie.jsx)(At().A,{...s,ref:t,icon:(0,ie.jsx)(_n,{item:n}),title:(0,ie.jsx)(Dn,{item:n}),isChecked:l})}));function wn(e){const{scopeMenuItem:t,scope:n}=e;switch(n.type){case"notion":return"notion"===t.type;case"workspace":return"workspace"===t.type;case"teamspace":return"teamspace"===t.type&&t.teamId===n.teamId;case"page":return"page"===t.type&&t.pageId===n.pageId;case"collection":return"collection"===t.type&&t.pageId===n.pageId&&t.collectionId===n.collectionId;default:return!1}}In.displayName="ScopedSearchMenuItem";const An=20,Tn={display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,flexGrow:0,width:20,height:20,position:"relative"},Pn={alignItems:"center",display:"flex",...Qt().RC,minWidth:0,flex:1,marginInlineEnd:12,width:"100%"},Fn={...Qt().RC,minWidth:0};function _n(e){const{item:t}=e,n=(0,l().O$)(i().AppStoreSidebarSpaceStore),o=(0,l().K8)((()=>{var e;return null==n||null===(e=n.getModel())||void 0===e?void 0:e.getRenderIcon()}),[n]),a=(0,l().K8)((()=>{var e;return null==n||null===(e=n.getModel())||void 0===e?void 0:e.getRenderTitle()}),[n]),r="page"===t.type||"collection"===t.type?t.pageStore:null,s=(0,l().K8)((()=>null==r?void 0:r.getIcon()),[r]),c=(0,l().K8)((()=>(null==r?void 0:r.isEmptyPage())??!1),[r]),d=(0,l().K8)((()=>r?(0,tn().Te)(r):"pageBlock"),[r]),u=(null==e?void 0:e.iconSize)??An;return"workspace"===t.type||"notion"===t.type?(0,ie.jsx)("div",{style:Tn,children:(0,ie.jsx)(tn().B6,{icon:o,title:a,iconRecordCategory:"workspace",isEmptyPage:!1,size:u,disabled:!0})}):"teamspace"===t.type?(0,ie.jsx)("div",{style:Tn,children:(0,ie.jsx)(dn().x,{disabled:!0,store:t.teamStore,size:u})}):"page"===t.type||"collection"===t.type?(0,ie.jsx)("div",{style:Tn,children:(0,ie.jsx)(tn().B6,{icon:s,iconRecordCategory:d,isEmptyPage:c,title:void 0,size:u,disabled:!0})}):null}function En(e){const{title:t,suffix:n}=e;return(0,ie.jsxs)("div",{style:Pn,children:[(0,ie.jsx)("div",{style:Fn,children:t}),(0,ie.jsxs)("div",{style:{color:Q().Tj.text.tertiary,whiteSpace:"nowrap"},children:[(0,ie.jsx)("div",{style:{display:"inline-block",marginInlineStart:3,marginInlineEnd:3},children:"—"}),n]})]})}function Dn(e){const{item:t}=e,n=(0,h().tz)(),o=(0,l().K8)((()=>{var e;return null===(e=(0,Wt().S)())||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.getRenderTitle()}),[]),i=(0,l().K8)((()=>(0,ft().Nr)({item:t,intl:n})),[t,n]),a=(0,c().IS)((()=>({lockIcon:{marginInlineStart:4}})),[]);return"notion"===i.type?(0,ie.jsx)(En,{title:o??"",suffix:"Workspace"}):"workspace"===i.type?(0,ie.jsx)(En,{title:o??"",suffix:"Public Workspace"}):"teamspace"===i.type?"private"===i.accessLevel?(0,ie.jsxs)("div",{style:Pn,children:[(0,ie.jsx)(on().A,{store:i.store}),(0,ie.jsx)(Re().I,{icon:Jt().lockFillIcon,size:"xs",colorVariant:"secondary",style:a.lockIcon})]}):(0,ie.jsx)("div",{style:Pn,children:(0,ie.jsx)(on().A,{store:i.store})}):"page"===i.type?i.isCurrentPage?(0,ie.jsx)(En,{title:i.title,suffix:"Current page"}):(0,ie.jsx)("div",{style:Pn,children:(0,ie.jsx)(on().A,{store:i.store})}):null}function Bn(e){const{item:t}=e,n=(0,h().tz)(),o=(0,l().K8)((()=>(0,ft().Nr)({item:t,intl:n})),[t,n]);return"notion"===o.type?(0,ie.jsx)(h().sA,{id:"UnifiedChatNotionScopeTooltip.notionItem.tooltip",defaultMessage:"Find in Notion workspace"}):"workspace"===o.type?(0,ie.jsx)(h().sA,{id:"UnifiedChatNotionScopeTooltip.workspaceItem.tooltip",defaultMessage:"Find in your Notion workspace"}):"teamspace"===o.type?(0,ie.jsx)(h().sA,{id:"UnifiedChatNotionScopeTooltip.teamspaceItem.tooltip",defaultMessage:"Find in this teamspace"}):"page"===o.type?o.isCurrentPage?(0,ie.jsx)(h().sA,{id:"UnifiedChatNotionScopeTooltip.currentPageItem.tooltip",defaultMessage:"Find in the currently opened page for context"}):(0,ie.jsx)(h().sA,{id:"UnifiedChatNotionScopeTooltip.pageItem.tooltip",defaultMessage:"Find in a specific Notion page"}):null}function Rn(e){if(e&&e.length>1)return e;const t={type:"everything"},n=(null==e?void 0:e.at(0))||t;return"ai-knowledge"===n.type?[t]:[n]}const Nn=(0,h().YK)({askMode:{id:"UnifiedChatPlusMenuButton.askMode",defaultMessage:"Can make changes"},appsAndIntegrationsTitle:{id:"UnifiedChatScopeMenu.appsAndIntegrationsTitle",defaultMessage:"Apps and integrations"},everythingScope:{id:"UnifiedChatScopePopup.everythingScope",defaultMessage:"All sources I can access"},connectingStatus:{id:"UnifiedChatScopeMenu.connectingStatus",defaultMessage:"Connecting"},connectingStatusWithProgress:{id:"UnifiedChatScopeMenu.connectingStatusWithProgress",defaultMessage:"Connecting {progress}%"},disconnectingStatus:{id:"UnifiedChatScopeMenu.disconnectingStatus",defaultMessage:"Disconnecting"},connectingTooltipTitle:{id:"UnifiedChatScopeMenu.connectingTooltipTitle",defaultMessage:"Connecting {appName}"},connectingTooltipSubtitle:{id:"UnifiedChatScopeMenu.connectingTooltipSubtitle",defaultMessage:"This can take up to 36h"},disconnectingTooltipTitle:{id:"UnifiedChatScopeMenu.disconnectingTooltipTitle",defaultMessage:"Disconnecting {appName}"},disconnectingTooltipSubtitle:{id:"UnifiedChatScopeMenu.disconnectingTooltipSubtitle",defaultMessage:"Your workspace owner has disconnected {appName}. This can take up to 3 hours."},unavailableStatus:{id:"UnifiedChatScopeMenu.unavailableStatus",defaultMessage:"Unavailable"},unavailableTooltipTitle:{id:"UnifiedChatScopeMenu.unavailableTooltipTitle",defaultMessage:"{appName} unavailable"},unavailableTooltipSubtitle:{id:"UnifiedChatScopeMenu.unavailableTooltipSubtitle",defaultMessage:"The {appName} AI Connector is currently unavailable. Our team is working on it — please try again shortly."}});function zn(e){const{aiChatFeatureController:t,buttonPopupParent:n,clientStore:i,config:r,extensionPopupButtonEvents:s,intl:d,onChangeNextConfig:u,spaceStore:p,threadStore:g,isSimplifiedInputEnabled:f,askModeToggleProps:S}=e,y=(0,a().v3)(),b=(0,L().r)(),x=(0,xt().$)(),C=(0,ht().J)(p),{spaceName:v,spaceIcon:M}=(0,l().K8)((()=>({spaceName:(0,Mt().G)(y,p),spaceIcon:p.getIcon()})),[y,p]),k=(0,Ot()._)({name:"ai_connectors",spaceId:b,userId:y.currentUser.id}),j=(0,te().X)("notion_ai_workspace_settings"),I=(0,tt().n_)({config:r,modules:[]}),w="workflow"===r.type,A=(0,xe().N)({threadStore:g,spaceId:p.id}),{aiSessionId:T,aiDraftInferenceId:P}=A,F=(0,o.useRef)((0,be().Cs)({config:r,includeWeb:!0})),_=(0,o.useRef)((0,be().Cs)({config:r,includeWeb:!0})),E=(0,o.useCallback)((e=>{_.current=(0,be().Cs)({config:e,includeWeb:!0}),u(e)}),[u]);(0,Ct().w)((()=>{(0,zt().trackScopeSearchMenuOpen)(y,{from:t.analyticsSource(g),config_type:r.type,options_displayed:["notion","workspace","teamspace","page","collection"],ai_session_id:T,ai_inference_id:P})})),(0,vt().X)((()=>{const e=_.current,n=F.current;(n.length!==e.length||!n.every((t=>e.some((e=>(0,be().YJ)(t,e))))))&&(0,zt().trackScopeSearchToggle)(y,{from:t.analyticsSource(g),original_scopes:n,new_scopes:e,config_type:r.type,ai_session_id:T,ai_inference_id:P})}));const D=(0,o.useCallback)((e=>(null==I?void 0:I.some((t=>(0,be().YJ)(t,e))))??!1),[I]),[B,R]=(0,o.useState)(),N=(0,l().K8)((()=>function(e){return!e||0===e.length||!e.some((e=>"ai-knowledge"===e.type))}((0,tt().n_)({config:r,modules:[]}))),[r]),z=(0,l().K8)((()=>(0,mt().J)({}).filter((e=>"web"!==e.type&&"notion"!==e.type))),[]),U=(0,l().K8)((()=>z.filter((e=>{if(e.isAvailable({})||e.isInProgress()||e.isDisconnecting())return!0;if((0,Et().SC)(e.type)){return(0,gt().uD)(e.type,C).length>0}return!1}))),[z,C]),V=(0,o.useCallback)((()=>{const e=!(0,tt().H0)({config:r,modules:[]});switch(b&&(0,be().Oq)(b,{webEnabled:e}),r.type){case"workflow":const t=((0,tt().n_)({config:r,modules:[]})??[]).filter((e=>"web"!==e.type));E({...r,searchScopes:t,useWebSearch:e});break;case"researcher":case"search":E({...r,useWebSearch:e})}}),[r,E,b]),W=(0,o.useCallback)((e=>{const t=(0,be().Af)({currentScopes:I??[],scope:e,isMultiScopeEnabled:w}),n=(0,be().Zd)(r,t);E(n)}),[r,E,I,w]),H=(0,o.useCallback)((()=>{if("workflow"===r.type){if(N){const e=(null==I?void 0:I.filter((e=>"ai-knowledge"!==e.type)))??[];R(e.length>0?e:void 0),E({...r,searchScopes:[{type:"ai-knowledge"}]})}else{const e=Rn(B);E({...r,searchScopes:e}),R(void 0)}return}const{scopeToSelect:e,scopesToSave:t}=function(e,t,n){const o=null==t?void 0:t[0];if(e){const e=[{type:"ai-knowledge"}];return{newSearchScopes:e,scopeToSelect:e[0],scopesToSave:void 0!==o&&"ai-knowledge"!==o.type?[o]:void 0}}{const e=Rn(n),t=e[0]??{type:"everything"};return{newSearchScopes:e.length>0?e:[t],scopeToSelect:t,scopesToSave:void 0}}}(N,I,B);t&&R(t),"search"===r.type?E({...r,scopeForNextSearch:e}):"researcher"===r.type&&E({...r,searchScope:e}),N||R(void 0)}),[N,I,B,r,E]),q=(0,l().K8)((()=>(0,O().Nr)()),[]),Y=(0,o.useCallback)((()=>{m().trackConnectAppsClicked({environment:y,from:"ai_chat_scoped_search_menu",inferenceInfo:A}),(0,Nt().pp)({environment:y,connector:"generic",analyticsFrom:"multi_search_scope_menu",connectorsFeatureAvailability:k})}),[k,y,A]),$=(0,l().K8)((()=>(0,bt().xX)()),[]),G=(0,c().IS)((()=>({footerTextArea:{width:"100%",userSelect:"none",whiteSpace:"normal"}})),[]),J=(0,l().K8)((()=>{const e=[],o=t.supportsWebSearch(r.type),a=K().R.isWebSearchDown(),s=[];f&&S&&s.push({key:"ask-mode-toggle",render:(e,t)=>(0,ie.jsx)(Ut().A,{...e,onFocus:t.onFocus,disabled:S.isAskModeDisabled,icon:(0,ie.jsx)(Re().I,{icon:Bt().pencilLineIcon,size:"default"}),title:d.formatMessage(Nn.askMode),on:S.allowEditsEnabled,onClick:S.onToggleAskMode}),action:()=>{S.isAskModeDisabled||S.onToggleAskMode()}}),o&&s.push({key:"web-toggle",render:(e,t)=>(0,ie.jsx)(Ut().A,{...e,onFocus:t.onFocus,disabled:a,icon:(0,ie.jsx)(Re().I,{icon:dt().globeIcon,size:"default"}),title:(0,ie.jsx)(h().sA,{id:"UnifiedChatScopePopup.webSearchMenuItemTitle",defaultMessage:"Web search"}),on:!a&&(0,tt().H0)({config:r,modules:[]}),onClick:V}),action:V}),s.length>0&&e.push({key:"web-search",render:e=>(0,ie.jsx)(Ft().A,{...e}),items:s});const l=[];if(l.push({key:"apps-integrations-toggle",render:(e,t)=>(0,ie.jsx)(Ut().A,{...e,onFocus:t.onFocus,icon:(0,ie.jsx)(Re().I,{icon:Dt().c,size:"default"}),title:(0,ie.jsx)(h().sA,{...Nn.appsAndIntegrationsTitle}),on:N,onClick:H}),action:H}),N){l.push({key:"everything-scope",render:(e,t)=>(0,ie.jsx)(At().A,{...e,onFocus:t.onFocus,icon:(0,ie.jsx)(Kt().A,{size:20,userStore:x}),title:d.formatMessage(Nn.everythingScope),role:"menuitemradio","aria-checked":D({type:"everything"}),isChecked:D({type:"everything"})}),action:()=>{W({type:"everything"})}}),l.push(function(e){const{aiChatFeatureController:t,buttonPopupParent:n,clientStore:o,config:i,onChangeNextConfig:a,currentSearchScopes:r,spaceName:s,spaceIcon:l}=e,c=(0,be().in)(i),d="workflow"===i.type?r.some((e=>"notion"===e.type)):"notion"===(null==c?void 0:c.type),u="workflow"===i.type?r.filter((e=>(0,be().ZB)(e))).length:(0,be().ZB)(c)?1:0,p=u>0?(0,ie.jsx)(le().D,{styleKey:"bodySmRegular",colorVariant:"secondary",children:(0,ie.jsx)(h().sA,{...mn.selectedNotionScopeCount,values:{count:u}})}):void 0,g="agent_mobile"===t.aiChatType;return{key:"workspace-scope",render:(e,c)=>(0,ie.jsx)(an().A,{...e,onFocus:c.onFocus,disableDefaultClick:!0,allowOptionalExtensionMenu:!g,disableCloseOnEnter:g,isChecked:d,right:p,alignmentToOrigin:"start",renderOrigin:(e,t)=>(0,ie.jsx)(At().A,{...e,ref:t,icon:(0,ie.jsx)(tn().B6,{bucket:"public",disabled:!0,icon:l,iconRecordCategory:"workspace",isEmptyPage:!1,size:20,title:s}),title:s}),renderExtension:(e,s)=>{const l={close:()=>{s.close(),n.close()}};return(0,ie.jsx)(xn,{aiChatFeatureController:t,buttonPopupParent:l,clientStore:o,config:i,currentSearchScopes:r,extensionPopupButtonEvents:e,onChange:a})}}),action:()=>{const e=(0,be().Af)({currentScopes:r,scope:{type:"notion"},isMultiScopeEnabled:"workflow"===i.type}),t=(0,be().Zd)(i,e);a(t)}}}({aiChatFeatureController:t,buttonPopupParent:n,clientStore:i,config:r,onChangeNextConfig:E,currentSearchScopes:I??[],spaceName:v,spaceIcon:M}));for(const e of U){const n=e.createSearchScope(),o=D(n),i=(0,Et().SC)(e.type)&&e.isAvailable({})&&$.includes(e.type),a=e.moduleKey??e.type;l.push({key:a,render:(n,i)=>(0,ie.jsx)(Un,{menuListItemProps:n,menuListParent:i,scope:e,isSelected:o,downConnectorsList:$,canTakeAction:t.supportsConnectingNewIntegrations,spaceStore:p}),action:()=>{if(!i){if((0,Et().SC)(e.type)){const t=(0,gt().uD)(e.type,C)[0];if(t){const{isDismissible:n}=(0,bt().w3)(e.type,t.type);if(!e.isInProgress()&&!e.isDisconnecting()&&!n)return void(b&&(0,bt().yU)(e.type,t,y,b))}}W(n)}}})}}else l.push({key:"search-footer-label",render:e=>(0,ie.jsx)(Tt().Ay,{...e,caption:(0,ie.jsx)("div",{style:G.footerTextArea,children:(0,ie.jsx)(le().D,{styleKey:"captionRegular",colorVariant:"secondary",children:(0,ie.jsx)(h().sA,{id:"UnifiedChatScopePopup.searchFooter",defaultMessage:"Notion AI will only search information from the sources selected here."})})})}),action:()=>{}});return l.length>0&&e.push({key:"search-scope",render:e=>(0,ie.jsx)(Ft().A,{...e,topBorder:o,topBorderExtendToEdge:o,desktopStyle:{marginTop:0}}),items:l}),e}),[t,N,U,p,n,i,r,I,x,W,H,V,d,E,M,v,C,b,y,$,G,D,S,f]),X=j&&q.length>0&&N,Q=(0,l().uB)(void 0,_t().$),Z=(0,o.useCallback)((()=>{Q.unsetFocus()}),[Q]);return(0,ie.jsx)(wt().A,{...s,menuType:t.adaptiveMenuType,hideMobileTopbar:!0,width:t.adaptiveMenuType===jt().gu.Popup?280:void 0,footer:N&&t.supportsConnectingNewIntegrations?(0,ie.jsxs)(Ft().A,{topBorder:!0,topBorderExtendToEdge:!0,children:[X?(0,ie.jsx)(At().A,{icon:(0,ie.jsx)(Re().I,{icon:Rt().plusIcon,size:"default"}),focused:!1,onMouseEnter:Z,onClick:Y,title:(0,ie.jsx)(h().sA,{id:"UnifiedChatScopeMenu.connectApps",defaultMessage:"Connect apps"}),right:(0,ie.jsx)(Lt().hC,{connectors:q,maxBubbles:2,iconSize:12,bubbleStyles:{width:16,height:16}})}):void 0,(0,ie.jsx)(Tt().Ay,{caption:(0,ie.jsx)("div",{style:G.footerTextArea,children:(0,ie.jsx)(le().D,{styleKey:"captionRegular",colorVariant:"secondary",children:(0,ie.jsx)(h().sA,{id:"UnifiedChatScopePopup.searchFooter",defaultMessage:"Notion AI will only search information from the sources selected here."})})})})]}):void 0,children:(0,ie.jsx)(Pt().A,{type:Pt().O.Vertical,initialFocus:0,sections:J,...w?{}:{onAccept:n.close},store:Q})})}function Un(e){const{menuListItemProps:t,menuListParent:n,scope:o,isSelected:a,downConnectorsList:r,canTakeAction:s,spaceStore:c}=e,d=(0,h().tz)(),u=(0,ht().J)(c),p=(0,l().O$)(i().AppStoreSidebarSpaceViewStore),g=(0,Et().SC)(o.type),m=(0,l().K8)((()=>g&&o.isAvailable({})&&r.includes(o.type)),[g,o,r]),{actionsRequired:f,isInProgress:S,isDisconnecting:y,ingestionProgress:b,isAdminOnlyAction:x}=(0,l().K8)((()=>{const e=g?(0,gt().uD)(o.type,u):[];let t=!1;if(g&&e.length>0){const n=(0,gt().uD)(o.type,!1);t=e.some((e=>!n.some((t=>t.type===e.type))))}let n,i=!1,a=!1;if(g){const e=(0,gt().LT)(o.type);i=e.isInProgress,e.isInProgress&&(n=e.ingestionProgress),a=(0,gt().$t)(o.type)}else i=o.isInProgress(),a=o.isDisconnecting();return{actionsRequired:e,isInProgress:i,isDisconnecting:a,ingestionProgress:n,isAdminOnlyAction:t}}),[o,u,g]),C=f[0],v=(0,l().K8)((()=>{if(!C||!p)return!1;const e=(0,bt().DP)(C.type);if(!e)return!1;const t=p.getSettings();return Boolean(null==t?void 0:t[e])}),[C,p]),M=S?void 0!==b?(0,ie.jsx)(h().sA,{...Nn.connectingStatusWithProgress,values:{progress:b}}):(0,ie.jsx)(h().sA,{...Nn.connectingStatus}):y?(0,ie.jsx)(h().sA,{...Nn.disconnectingStatus}):null,k=S||y,j=m||k||C&&!s,I=(()=>{if(m)return(0,ie.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[(0,ie.jsx)(Re().I,{icon:ct().exclamationMarkCircleFillSmallIcon,size:"xs",colorPalette:"gray",colorVariant:"secondary"}),(0,ie.jsx)(le().D,{colorVariant:"tertiary",children:(0,ie.jsx)(h().sA,{...Nn.unavailableStatus})})]});if(C&&!k&&g){const{buttonText:e,isDismissible:t}=(0,bt().w3)(o.type,C.type);return t?null:(0,ie.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:4},children:[v?(0,ie.jsx)(Re().I,{icon:ct().exclamationMarkCircleFillSmallIcon,size:"xs",colorPalette:u&&x?"red":"gray",colorVariant:"secondary"}):void 0,(0,ie.jsx)(le().D,{colorVariant:"tertiary",children:e})]})}return M?(0,ie.jsx)(It().N,{styleKey:"bodyRegular",colorVariant:"secondary",animate:!0,text:M}):null})(),w=(0,ie.jsx)(At().A,{...t,role:"menuitemradio","aria-checked":a,focused:t.focused,disabled:j,icon:(0,ie.jsx)(kt().Q,{iconGroup:o.icon,variantName:"default"}),title:o.displayName,isChecked:a,onFocus:n.onFocus,right:I});if((()=>{if(m||k)return!0;if(C&&g){const{isDismissible:e}=(0,bt().w3)(o.type,C.type);return!e}return!1})()){let e,t;if(m)e=d.formatMessage(Nn.unavailableTooltipTitle,{appName:o.displayName}),t=d.formatMessage(Nn.unavailableTooltipSubtitle,{appName:o.displayName});else if(k)e=S?d.formatMessage(Nn.connectingTooltipTitle,{appName:o.displayName}):d.formatMessage(Nn.disconnectingTooltipTitle,{appName:o.displayName}),t=S?d.formatMessage(Nn.connectingTooltipSubtitle):d.formatMessage(Nn.disconnectingTooltipSubtitle,{appName:o.displayName});else if(C&&g){const{title:n,subtitle:i}=(0,bt().w3)(o.type,C.type);e=n,t=i}return(0,ie.jsx)(G().m,{textWrap:!0,renderTooltip:()=>(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("div",{children:e}),(0,ie.jsx)(le().D,{colorVariant:"secondary",children:t})]}),render:e=>(0,ie.jsx)("div",{...e,children:w}),placement:"right"})}return w}const Kn={"web-only-enabled":{button:{colorPalette:void 0},icon:{icon:dt().globeIcon,colorPalette:"gray",colorVariant:"accentPrimary",reducedOpacity:!1},text:{colorPalette:"gray",colorVariant:"accentPrimary",reducedOpacity:!1}},"web-only-disabled":{button:{colorPalette:void 0},icon:{icon:ut().u,colorPalette:"gray",colorVariant:"accentPrimary",reducedOpacity:!0},text:{colorPalette:"gray",colorVariant:"accentPrimary",reducedOpacity:!0}},"web-only-not-supported":{button:{colorPalette:void 0},icon:null,text:{colorPalette:"gray",colorVariant:"secondary",reducedOpacity:!1}},"custom-enabled":{button:{colorPalette:"blue"},icon:{icon:dt().globeIcon,colorPalette:"blue",colorVariant:"accentPrimary",reducedOpacity:!1},text:{colorPalette:"blue",colorVariant:"accentPrimary",reducedOpacity:!1}},"custom-disabled":{button:{colorPalette:"blue"},icon:{icon:ut().u,colorPalette:"blue",colorVariant:"accentPrimary",reducedOpacity:!0},text:{colorPalette:"blue",colorVariant:"accentPrimary",reducedOpacity:!1}},"custom-not-supported":{button:{colorPalette:"blue"},icon:null,text:{colorPalette:"blue",colorVariant:"secondary",reducedOpacity:!1}},"default-enabled":{button:{colorPalette:void 0},icon:{icon:dt().globeIcon,colorPalette:"gray",colorVariant:"accentPrimary",reducedOpacity:!1},text:{colorPalette:"gray",colorVariant:"secondary",reducedOpacity:!1}},"default-disabled":{button:{colorPalette:void 0},icon:{icon:ut().u,colorPalette:void 0,colorVariant:"disabled",reducedOpacity:!1},text:{colorPalette:"gray",colorVariant:"secondary",reducedOpacity:!1}},"default-not-supported":{button:{colorPalette:void 0},icon:null,text:{colorPalette:"gray",colorVariant:"secondary",reducedOpacity:!1}}};function On(e){const{isCustomScope:t,webSearchAllowed:n,webSearchEnabled:o,hasAiKnowledgeScope:i}=e;let a,r;return a=i&&o?"web-only":t?"custom":"default",r=n?o?"enabled":"disabled":"not-supported",`${a}-${r}`}function Ln(e){const{aiChatFeatureController:t,clientStore:n,config:r,inputMode:s,onChangeNextConfig:c,spaceStore:d,threadStore:u,isSimplifiedInputEnabled:p,onMenuOpenChange:g}=e,f=(0,h().tz)(),S=(0,a().v3)(),y=(0,xe().N)({threadStore:u,spaceId:d.id}),b=(0,ht().J)(d),x=(0,l().O$)(i().AppStoreSidebarSpaceViewStore),C=(0,l().uB)(void 0,Le().A),v=yt({config:r,spaceStore:d,showEverythingLabel:!0,aiChatFeatureController:t}),{isCustomScope:M,hasAiKnowledgeScope:k,searchScopes:j}=(0,l().K8)((()=>{const e=(0,be().in)(r),t=(0,tt().n_)({config:r,modules:[]})??[];return{isCustomScope:t&&t.length>1||void 0!==e&&!(0,pt().rz)(e),hasAiKnowledgeScope:t.some((e=>"ai-knowledge"===e.type)),searchScopes:t}}),[r]),I=Boolean(M),{webSearchAllowed:w,webSearchEnabled:A}=(0,l().K8)((()=>{const e=t.supportsWebSearch(r.type);return{webSearchAllowed:e,webSearchEnabled:e&&(0,tt().H0)({config:r,modules:[]})}}),[t,r]),T=(0,l().K8)((()=>(0,mt().J)({}).some((e=>e.isInProgress()||e.isDisconnecting()))),[]),P=(0,l().K8)((()=>{if(!x||!b)return!1;const e=(0,O().kB)(),t=x.getSettings();for(const n of e){const e=(0,gt().uD)(n,!0),o=(0,gt().uD)(n,!1),i=e.filter((e=>!o.some((t=>t.type===e.type))));for(const n of i){const e=(0,bt().DP)(n.type);if(e&&null!=t&&t[e])return!0}}return!1}),[b,x]),F=(0,l().K8)((()=>{const e=(0,bt().xX)();if(0===e.length)return!1;return(0,O().kB)().some((t=>e.includes(t)))}),[]),_=!("workflow"===r.type&&r.isCustomAgent)&&t.supportsSearchScopePopup(r.type)&&t.supportsScopePicker(r.type),E=(0,st().l)({isCustomScope:M,webSearchAllowed:w,webSearchEnabled:A,hasAiKnowledgeScope:k}),D=(0,o.useMemo)((()=>function(e){if(e.hasAiKnowledgeScope&&e.webSearchEnabled&&e.isCustomScope){const t=Kn[On({...e,isCustomScope:!1})];return{...t,button:{colorPalette:"blue"},icon:t.icon?{...t.icon,colorPalette:"blue"}:null,text:{...t.text,colorPalette:"blue"}}}return Kn[On(e)]}(E)),[E]),B=(0,o.useMemo)((()=>{if("workflow"===r.type&&r.modelFromUser)return(0,We().kD)(r)}),[r]),{isAskModeAvailable:R,isAskModeEnabled:N,toggleAskMode:z}=Ce({config:r,onChangeNextConfig:c}),U=(0,o.useMemo)((()=>p&&R?{allowEditsEnabled:!N,isAskModeDisabled:"researcher"===r.type,onToggleAskMode:z}:void 0),[p,R,N,r.type,z]),K=(0,o.useCallback)((()=>{m().trackSourceMenuOpened({environment:S,button_name:"source_menu_search_scope_diff",from:t.analyticsFromSourceForActions,model:null==B?void 0:B.type,inferenceInfo:y}),S.device.isMobileNative&&(0,He().I)({environment:S})}),[S,t.analyticsFromSourceForActions,null==B?void 0:B.type,y]),L=(0,o.useMemo)((()=>b?F?(0,ie.jsx)(Re().I,{icon:ct().exclamationMarkCircleFillSmallIcon,size:"xs",colorPalette:I?"blue":"gray",colorVariant:I?"primary":"secondary"}):P?(0,ie.jsx)(Re().I,{icon:ct().exclamationMarkCircleFillSmallIcon,size:"xs",colorPalette:"red",colorVariant:"secondary"}):T?(0,ie.jsx)(Re().I,{icon:lt().l,size:"xs",colorPalette:I?"blue":"gray",colorVariant:I?"primary":"secondary"}):null:null),[b,F,P,T,I]),V=(0,o.useCallback)((e=>(0,ie.jsx)(zn,{aiChatFeatureController:t,buttonPopupParent:e,clientStore:n,config:r,extensionPopupButtonEvents:{},intl:f,onChangeNextConfig:c,spaceStore:d,threadStore:u,isSimplifiedInputEnabled:p,askModeToggleProps:U})),[t,n,r,f,c,d,u,p,U]);return{canRenderPopup:!t.isChatCompletelyDisabled(s)&&_,buttonPopupStore:C,renderMenu:V,onOriginClick:()=>{null==g||g(!0),K()},uiState:{buttonState:E,buttonStyles:D,shouldHighlightScopeButton:I,scopeName:v,connectorStatusIcon:L,webSearchAllowed:w,webSearchEnabled:A,hasAiKnowledgeScope:k,isCustomScope:M,searchScopes:j}}}const Vn=(0,h().YK)({searchScopeTooltip:{id:"UnifiedChatSearchScopeButton.tooltip",defaultMessage:"Select search scope"},searchScopeTooltipCaptionNoWeb:{id:"UnifiedChatSearchScopeButton.tooltipCaptionNoWeb",defaultMessage:"Choose from Notion pages and third party connectors"},searchScopeTooltipCaptionWeb:{id:"UnifiedChatSearchScopeButton.tooltipCaptionWeb",defaultMessage:"Choose from web, Notion pages, and third party connectors"}});function Wn(e){const{aiChatFeatureController:t,onMenuOpenChange:n}=e,o=(0,h().tz)(),i=Ln(e),{buttonPopupStore:a,renderMenu:r,onOriginClick:s,uiState:l}=i,{buttonStyles:d,shouldHighlightScopeButton:u,scopeName:p,connectorStatusIcon:g,webSearchAllowed:m}=l,f=(0,c().IS)((()=>({button:{borderRadius:50,height:28,display:"flex",alignItems:"center",justifyContent:"center",gap:4,pointerEvents:"auto",flexShrink:1,minWidth:0,paddingInlineStart:Boolean(d.icon)?6:10,paddingInlineEnd:10,backgroundColor:u?Q().Tj.blue.background.secondary:"transparent"},hoveredButton:{backgroundColor:u?Q().Tj.blue.background.tertiary:Q().Tj.buttonHoveredBackground},buttonText:{minWidth:0}})),[d,u]);return i.canRenderPopup?(0,ie.jsx)(Oe().A,{buttonPopupStore:a,popupType:t.adaptiveMenuPopupType,originGap:4,placementToOrigin:"bottom",alignmentToOrigin:"start",bottomSheetDisableDrag:!1,onOpen:()=>null==n?void 0:n(!0),onClose:()=>null==n?void 0:n(!1),onClick:s,renderOrigin:e=>(0,ie.jsx)(G().m,{placement:"bottom",textWrap:!0,style:{minWidth:200},renderTooltip:()=>(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("div",{children:o.formatMessage(Vn.searchScopeTooltip)}),m?(0,ie.jsx)(le().D,{colorVariant:"secondary",children:o.formatMessage(Vn.searchScopeTooltipCaptionWeb)}):(0,ie.jsx)(le().D,{colorVariant:"secondary",children:o.formatMessage(Vn.searchScopeTooltipCaptionNoWeb)})]}),render:n=>(0,ie.jsxs)(Ve().E,{...e,...n,style:f.button,hoveredStyle:f.hoveredButton,colorPalette:d.button.colorPalette,testId:"unified-chat-search-scope-button",children:[d.icon?(0,ie.jsx)(Re().I,{icon:d.icon.icon,size:"default",colorPalette:d.icon.colorPalette,colorVariant:d.icon.colorVariant,style:d.icon.reducedOpacity?{opacity:.5}:void 0}):void 0,(0,ie.jsx)(le().D,{styleKey:t.unifiedChatInputModeButtonStyleKey,colorPalette:d.text.colorPalette,colorVariant:d.text.colorVariant,textOverflow:"ellipsis",style:d.text.reducedOpacity?{...f.buttonText,opacity:.5}:f.buttonText,children:p}),g]})}),render:r}):null}function Hn(e){const{aiChatFeatureController:t,clientStore:n,config:o,inputMode:i,threadMode:a,loadAttachmentData:r,onChangeNextConfig:s,spaceStore:l,threadStore:c}=e;return t.isChatCompletelyDisabled(i)?null:(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(Ue,{config:o,loadAttachmentData:r,aiChatFeatureController:t,threadStore:c,spaceStore:l}),(0,ie.jsx)(Qe,{aiChatFeatureController:t,config:o,inputMode:i,threadMode:a,onChangeNextConfig:s,spaceStore:l,threadStore:c,clientStore:n,isSimplifiedInputEnabled:!1}),(0,ie.jsx)(rt,{aiChatFeatureController:t,config:o,inputMode:i,threadMode:a,onChangeNextConfig:s,threadStore:c,spaceStore:l}),(0,ie.jsx)(Wn,{aiChatFeatureController:t,config:o,inputMode:i,onChangeNextConfig:s,spaceStore:l,threadStore:c,clientStore:n,isSimplifiedInputEnabled:!1})]})}var qn=()=>n(995847),Yn=()=>n(723085),$n=()=>n(126617);const Gn={viewBox:"0 0 16 16",fittedViewBox:"1.96 1.94 12.09 12.1",svg:(0,ie.jsx)("path",{d:"M3.142 2.332a.55.55 0 0 1 .695-.017l.081.077.228.264.006.011 8.773 10.234.056.082a.55.55 0 0 1-.818.702l-.081-.077-.58-.676a6.05 6.05 0 0 1-7.84-9.147l-.58-.677-.063-.091a.55.55 0 0 1 .123-.685m3.42 6.218c.048 1.194.25 2.247.539 3.016.167.445.353.766.532.967s.304.234.367.234.188-.033.367-.234c.179-.2.365-.522.532-.967.138-.364.252-.793.343-1.27L7.746 8.55zm-3.481 0a4.95 4.95 0 0 0 3.326 4.137 5.4 5.4 0 0 1-.336-.734c-.343-.912-.562-2.1-.61-3.403zm7.047 2.78q-.091.329-.2.623-.147.396-.336.734a5 5 0 0 0 1.191-.594zM4.38 4.623a4.93 4.93 0 0 0-1.3 2.826h2.38a14 14 0 0 1 .127-1.418zM6.56 7.45h.243l-.228-.265zM8 1.95a6.05 6.05 0 0 1 5.04 9.394l-.75-.876a4.9 4.9 0 0 0 .629-1.918h-2.274L9.42 7.12c-.07-1.058-.257-1.988-.52-2.685-.167-.445-.353-.767-.532-.968S8.063 3.233 8 3.233s-.188.033-.367.234c-.177.199-.362.516-.528.954l-.794-.928q.046-.093.096-.18-.096.033-.19.07l-.752-.877A6 6 0 0 1 8 1.95m1.592 1.363q.188.336.337.734c.343.912.562 2.1.61 3.403h2.38a4.95 4.95 0 0 0-3.327-4.137"})},Jn=(0,X().wt)("globeSlashSmall",Gn,"small");var Xn=()=>n(737693);const Qn={viewBox:"0 0 16 16",fittedViewBox:"1.07 1.61 13.5 13.5",svg:(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("path",{d:"M5.066 8.077a.463.463 0 1 1 0 .927.463.463 0 0 1 0-.927m0-1.544a.463.463 0 1 1 0 .927.463.463 0 0 1 0-.927"}),(0,ie.jsx)("path",{d:"M1.222 1.757a.5.5 0 0 1 .707 0l.632.633a.5.5 0 0 0 .06.074l11.871 11.871a.5.5 0 0 1-.77.629l-2.016-2.016H2.75a.55.55 0 0 1-.547-.547V4.912c0-.413.136-.794.364-1.102L1.222 2.464a.5.5 0 0 1 0-.707m2.14 2.848a.8.8 0 0 0-.065.307v6.943h1.178v-1.616c0-.241.195-.437.437-.437h2.47c.242 0 .438.196.438.437v1.616h1.177v-1.616l-1.41-1.41a.461.461 0 1 1-.649-.648zm1.988 7.25h1.595v-1.178H5.35zm4.74 0h.522l-.521-.522zM8.231 3.053a1.86 1.86 0 0 1 1.86 1.86v2h1.847a1.86 1.86 0 0 1 1.859 1.86v3.453l-1.094-1.094v-2.36a.766.766 0 0 0-.765-.765H10.09v.513L8.997 7.426V4.912a.766.766 0 0 0-.766-.765H5.718L4.624 3.053z"}),(0,ie.jsx)("path",{d:"M11.397 8.695a.463.463 0 1 1 0 .926.463.463 0 0 1 0-.926M7.228 4.99a.46.46 0 0 1 .207.874l-.62-.62a.46.46 0 0 1 .412-.255"})]})},Zn=(0,X().wt)("teamspaceSlashSmall",Qn,"small");var eo=()=>n(854150),to=()=>n(987267);function no({themeMode:e,shouldRenderHeadless:t,usesElevatedDarkModeBackground:n}){if(!t)return"dark"===e?n?Q().Tj.gray.background.elevated:Q().Tj.background.secondary:Q().Tj.background.primary}const oo=(0,h().YK)({noWebSearchTooltip:{id:"UnifiedChatContextFacepile.noWebSearchTooltip",defaultMessage:"No web search"},noAppsAndIntegrationsTooltip:{id:"UnifiedChatContextFacepile.noAppsAndIntegrationsTooltip",defaultMessage:"No apps and integrations"},workspaceSourceFallback:{id:"UnifiedChatContextFacepile.workspaceSourceFallback",defaultMessage:"Workspace"},teamspaceSourceFallback:{id:"UnifiedChatContextFacepile.teamspaceSourceFallback",defaultMessage:"Teamspace"},notionSourceName:{id:"UnifiedChatContextFacepile.notionSourceName",defaultMessage:"Notion"},unknownSourceName:{id:"UnifiedChatContextFacepile.unknownSourceName",defaultMessage:"Connected source"}}),io=2,ao=24+2*io,ro=-6,so=X().Ev.sm,lo=3,co=2,uo={chatgpt:"ChatGPT",claude:"Claude",composio:"Composio",cursor:"Cursor",devin:"Devin",figma_make:"Figma Make",github:"GitHub",hubspot:"HubSpot",lovable:"Lovable",make:"Make",microsoft_365_copilot:"Microsoft 365 Copilot",mistral:"Mistral",notion:"Notion",perplexity:"Perplexity",poke:"Poke",vscode:"VS Code",zapier:"Zapier"};function po(e){const{sourcePickerProps:t,controller:n}=e;return(0,ie.jsx)(go,{sourcePickerProps:t,controller:n})}function go(e){const{sourcePickerProps:t,controller:n}=e,i=(0,h().tz)(),{uiState:a}=n,{searchScopes:r,webSearchEnabled:s,isCustomScope:d,hasAiKnowledgeScope:u}=a,p=(0,l().K8)((()=>n.buttonPopupStore.state.open),[n.buttonPopupStore]),g=(0,o.useMemo)((()=>function(e){const t=[];return e.forEach(((e,n)=>{switch(e.type){case"workspace":t.push({kind:"workspace",key:`workspace-${n}`});break;case"teamspace":t.push({kind:"teamspace",teamId:e.teamId,key:`teamspace-${e.teamId}-${n}`});break;default:{const o=(0,Lt().vd)(e);o&&t.push({kind:"connector",iconType:o,key:`connector-${o}-${n}`})}}})),t}(r)),[r]),m=g.length>lo,f=m?g.slice(0,co):g.slice(0,lo),S=m?g.slice(co):[],y=!s,b=u,x=d||y||b,C=(0,c().IS)((()=>({row:{display:"flex",alignItems:"center",pointerEvents:"auto"}})),[]),v=(0,o.useCallback)((()=>{n.canRenderPopup&&(n.onOriginClick(),n.buttonPopupStore.setState({...n.buttonPopupStore.state,open:!0}))}),[n]),M=(0,o.useCallback)((e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),v())}),[v]);if(!x)return null;const k=(y?1:0)+(b?1:0),j=k+f.length+(m?1:0);return(0,ie.jsxs)("div",{style:{...C.row,cursor:n.canRenderPopup?"pointer":"default"},role:"button",tabIndex:n.canRenderPopup?0:-1,"aria-haspopup":"menu","aria-expanded":p,"aria-label":a.scopeName,"aria-disabled":!n.canRenderPopup,onClick:v,onKeyDown:M,children:[y?(0,ie.jsx)(ho,{index:0,totalItems:j,aiChatFeatureController:t.aiChatFeatureController,tooltip:i.formatMessage(oo.noWebSearchTooltip),children:(0,ie.jsx)(Re().I,{icon:Jn,size:"sm",colorVariant:"tertiary"})}):void 0,b?(0,ie.jsx)(ho,{index:y?1:0,totalItems:j,aiChatFeatureController:t.aiChatFeatureController,tooltip:i.formatMessage(oo.noAppsAndIntegrationsTooltip),children:(0,ie.jsx)(Re().I,{icon:Zn,size:"sm",colorVariant:"tertiary"})}):void 0,f.map(((e,n)=>(0,ie.jsx)(ho,{index:n+k,totalItems:j,aiChatFeatureController:t.aiChatFeatureController,tooltip:(0,ie.jsx)(So,{descriptor:e,spaceStore:t.spaceStore,intl:i}),children:(0,ie.jsx)(fo,{descriptor:e,spaceStore:t.spaceStore})},e.key))),m?(0,ie.jsx)(mo,{index:k+f.length,totalItems:j,aiChatFeatureController:t.aiChatFeatureController,tooltip:S.length?(I=S,(0,ie.jsx)(ie.Fragment,{children:I.map(((e,n)=>(0,ie.jsxs)(o.Fragment,{children:[(0,ie.jsx)(So,{descriptor:e,spaceStore:t.spaceStore,intl:i}),n<I.length-1?(0,ie.jsx)("br",{}):null]},`${e.key}-tooltip`)))})):void 0}):null]});var I}function ho(e){const{index:t,totalItems:n,aiChatFeatureController:o,children:i,highlighted:a,tooltip:r}=e,s=(0,c().eP)(),l=(0,c().IS)((()=>{const e=no({themeMode:s,shouldRenderHeadless:o.shouldRenderHeadless,usesElevatedDarkModeBackground:o.usesElevatedDarkModeBackground})??Q().Tj.background.primary,i=function(e){return"dark"===e?Q().Tj.palette.gray[400]:Q().Tj.background.tertiary}(s);return{iconWrapper:{minWidth:ao,height:ao,borderRadius:ao/2,border:`${io}px solid ${e}`,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"none",paddingInlineStart:4,paddingInlineEnd:4,gap:4,position:"relative",overflow:"hidden",background:a?Q().Tj.blue.background.secondary:i,marginInlineStart:0===t?0:ro,zIndex:n-t}}}),[t,n,a,o.shouldRenderHeadless,o.usesElevatedDarkModeBackground,s]);return(0,ie.jsx)(G().m,{renderTooltip:()=>r,render:e=>(0,ie.jsx)("div",{...e,style:l.iconWrapper,children:i}),placement:"top",textWrap:!1})}function mo(e){const{index:t,totalItems:n,aiChatFeatureController:o,tooltip:i}=e;return(0,ie.jsx)(ho,{index:t,totalItems:n,aiChatFeatureController:o,tooltip:i??"",children:(0,ie.jsx)(Re().I,{icon:$n().ellipsisSmallIcon,size:"sm",colorVariant:"secondary"})})}function fo(e){const{descriptor:t,spaceStore:n}=e;switch(t.kind){case"workspace":return(0,ie.jsx)(Co,{spaceStore:n});case"teamspace":return(0,ie.jsx)(vo,{spaceStore:n,teamId:t.teamId});case"connector":return(0,ie.jsx)(Mo,{iconType:t.iconType});default:return null}}function So(e){const{descriptor:t,spaceStore:n,intl:o}=e;switch(t.kind){case"workspace":return(0,ie.jsx)(yo,{spaceStore:n,intl:o});case"teamspace":return(0,ie.jsx)(bo,{spaceStore:n,teamId:t.teamId,intl:o});case"connector":return(0,ie.jsx)(xo,{iconType:t.iconType,intl:o});default:return null}}function yo(e){const{spaceStore:t,intl:n}=e,o=(0,l().K8)((()=>t.getName()),[t]);return(0,ie.jsx)("span",{children:o??n.formatMessage(oo.workspaceSourceFallback)})}function bo(e){const{spaceStore:t,teamId:n,intl:i}=e,a=(0,o.useMemo)((()=>Yn().h.createChildStore(t,{table:eo().yK,id:n})),[t,n]),r=(0,l().K8)((()=>null==a?void 0:a.getName()),[a]);return(0,ie.jsx)("span",{children:r??i.formatMessage(oo.teamspaceSourceFallback)})}function xo(e){const{iconType:t,intl:n}=e;return(0,ie.jsx)("span",{children:ko(t,n)})}function Co(e){const{spaceStore:t}=e,n=(0,l().K8)((()=>t.getIcon()),[t]);return n?(0,ie.jsx)(tn().B6,{icon:n,size:so,disabled:!0,isEmptyPage:!1}):(0,ie.jsx)(Re().I,{icon:Xn().V,size:"sm",colorVariant:"secondary"})}function vo(e){const{spaceStore:t,teamId:n}=e,i=(0,o.useMemo)((()=>Yn().h.createChildStore(t,{table:eo().yK,id:n})),[t,n]),a=(0,l().K8)((()=>null==i?void 0:i.getIcon()),[i]);return a?(0,ie.jsx)(tn().B6,{icon:a,size:so,disabled:!0,isEmptyPage:!1}):(0,ie.jsx)(Re().I,{icon:Xn().V,size:"sm",colorVariant:"secondary"})}function Mo(e){const{iconType:t}=e;return(0,ie.jsx)(kt().Q,{iconGroup:(0,Lt().e1)(t),overrideSize:()=>so,variantName:"default"})}function ko(e,t){return"notion"===e?t.formatMessage(oo.notionSourceName):(0,Et().SC)(e)?to().w0[e]:function(e){return"chatgpt"===e||"claude"===e||"composio"===e||"cursor"===e||"devin"===e||"figma_make"===e||"github"===e||"hubspot"===e||"lovable"===e||"make"===e||"microsoft_365_copilot"===e||"mistral"===e||"notion"===e||"perplexity"===e||"poke"===e||"vscode"===e||"zapier"===e}(e)?uo[e]:t.formatMessage(oo.unknownSourceName)}var jo=()=>n(735790);const Io=(0,h().YK)({tooltipLabel:{id:"UnifiedChatModeMenuButton.tooltipLabel",defaultMessage:"Settings"}});function wo(e){const{aiChatFeatureController:t,onMenuOpenChange:n,controller:o}=e;return o.canRenderPopup?(0,ie.jsx)(Oe().A,{buttonPopupStore:o.buttonPopupStore,popupType:t.adaptiveMenuPopupType,originGap:4,placementToOrigin:"bottom",alignmentToOrigin:"start",bottomSheetDisableDrag:!1,onOpen:()=>null==n?void 0:n(!0),onClose:()=>null==n?void 0:n(!1),onClick:o.onOriginClick,renderOrigin:e=>(0,ie.jsx)(Ne,{...e,icon:jo().M,testId:"unified-chat-mode-menu-button",tooltipText:Io.tooltipLabel}),render:o.renderMenu}):null}var Ao=()=>n(537193),To=()=>n(47373),Po=(n(16280),()=>n(791177)),Fo=()=>n(792071),_o=()=>n(728272),Eo=()=>n(179034),Do=()=>n(798880),Bo=()=>n(496603),Ro=()=>n(320865),No=()=>n(115512),zo=()=>n(845098),Uo=()=>n(953490),Ko=()=>n(269516),Oo=()=>n(390719),Lo=()=>n(99366),Vo=()=>n(712505);const Wo="no-results",Ho=(0,h().YK)({inputPlaceholder:{id:"AgentChatContextChips.menu.searchPlaceholder",defaultMessage:"Search..."},usersSectionTitle:{id:"AgentChatContextChips.menu.usersSectionTitle",defaultMessage:"Users"},pagesSectionTitle:{id:"AgentChatContextChips.menu.pagesSectionTitle",defaultMessage:"Pages"},agentsSectionTitle:{id:"AgentChatContextChips.menu.agentsSectionTitle",defaultMessage:"Agents"},noResultsMessage:{id:"AgentChatContextChips.menu.noResults",defaultMessage:"No results"}});function qo(e){const{mentions:t,onChangeMentions:n,config:r,menuType:s,threadStore:c,spaceStore:d,disableAgentMentions:u}=e,p="workflow"===r.type?r.model:void 0,g=(0,a().v3)(),f=(0,h().tz)(),[S,y]=(0,o.useState)(""),b=(0,xe().N)({threadStore:c,spaceId:d.id}),[x,C]=(0,Po().$)(),v=(0,l().O$)(i().AppStoreMainEditorCurrentBlockStore),M=(0,l().O$)(Vo().default.peekTargetStore),{results:k,isLoading:j}=(0,Oo().uE)({query:S,disabled:!1,useMentionMenuStore:!1,open:!0}),{results:I,isLoading:w}=(0,Lo().h)(S,{useMentionMenuStore:!1,open:!0},{includeDataSources:!1}),{results:A,isLoading:P}=(0,Oo().oY)({query:S,environment:g,useMentionMenuStore:!1,open:!0,disabled:u}),F=(0,o.useMemo)((()=>{if(j)return{key:"loading-users",items:[{key:"loading",render:()=>(0,ie.jsx)(Ro().A,{}),action:()=>{}}],render:e=>(0,ie.jsx)(Ft().A,{...e,title:(0,ie.jsx)(h().sA,{...Ho.usersSectionTitle})})};const e=k.filter((e=>!t.has({id:e.id,table:Do().oo})));return 0!==e.length?{key:"users",items:e.map((e=>({key:e.id,render:t=>(0,o.createElement)(Uo().i,{...t,key:e.id,user:e}),action:()=>{const{model:o}=Fo().Fvx.create(e),i=new(_o().d)(t);i.add(o.pointer),m().trackMentionAdded({environment:g,mention:o.pointer,model:p,inferenceInfo:b}),n(i)}}))),render:e=>(0,ie.jsx)(Ft().A,{...e,title:(0,ie.jsx)(h().sA,{...Ho.usersSectionTitle})})}:void 0}),[p,g,b,j,t,n,k]),_=(0,o.useMemo)((()=>{if(w)return{key:"loading-pages",items:[{key:"loading",render:()=>(0,ie.jsx)(Ro().A,{}),action:()=>{}}],render:e=>(0,ie.jsx)(Ft().A,{...e,title:(0,ie.jsx)(h().sA,{...Ho.pagesSectionTitle})})};const e=I.filter((({store:e})=>!t.has({id:e.id,table:Eo().ev}))),o=[];""===S&&(M&&!t.has({id:M.id,table:Eo().ev})&&o.push(M),v&&!t.has({id:v.id,table:Eo().ev})&&o.push(v));const i=new(_o().d)(o.map((e=>e.pointer))),a=e.filter((({store:e})=>!i.has(e.pointer))),r=[...o,...a.map((e=>e.store))];if(0===r.length)return;const s=r.filter(T().O9).map((e=>({key:e.id,render:t=>(0,ie.jsx)(nn().A,{...t,store:e,showVerifiedPageBadge:!0}),action:()=>{const o=e.getModel();if(!o)throw new Error("Expected to find model");const i=new(_o().d)(t);i.add(o.pointer),m().trackMentionAdded({environment:g,mention:o.pointer,model:p,inferenceInfo:b}),n(i)}})));return{key:"pages",items:s,render:e=>(0,ie.jsx)(Ft().A,{...e,title:(0,ie.jsx)(h().sA,{...Ho.pagesSectionTitle})})}}),[p,g,b,v,t,n,I,w,M,S]),E=(0,o.useMemo)((()=>{if(P)return{key:"loading-workflows",items:[{key:"loading",render:()=>(0,ie.jsx)(Ro().A,{}),action:()=>{}}],render:e=>(0,ie.jsx)(Ft().A,{...e,title:(0,ie.jsx)(h().sA,{...Ho.agentsSectionTitle})})};const e=A.filter((e=>!t.has(e.workflowStore.pointer)));if(0===e.length)return;const i=e.filter((e=>{var t;return Boolean(null==e||null===(t=e.workflowStore)||void 0===t?void 0:t.id)})).map((e=>{const i=e.workflowStore.id;return{key:i,render:t=>(0,o.createElement)(zo().M,{...t,key:i,name:e.name,icon:e.icon}),action:()=>{const o=new(_o().d)(t);o.add(e.workflowStore.pointer),m().trackMentionAdded({environment:g,mention:e.workflowStore.pointer,model:p,inferenceInfo:b}),n(o)}}}));return{key:"workflows",items:i,render:e=>(0,ie.jsx)(Ft().A,{...e,title:(0,ie.jsx)(h().sA,{...Ho.agentsSectionTitle})})}}),[p,A,g,b,t,n,P]),D=(0,o.useMemo)((()=>({key:Wo,items:[{key:Wo,action:()=>{},render:e=>(0,ie.jsx)(Tt().Ay,{...e,title:(0,ie.jsx)(h().sA,{...Ho.noResultsMessage})})}],render:e=>(0,ie.jsx)(Ft().A,{...e})})),[]),B=(0,o.useMemo)((()=>{const e=F||_||E?(0,Bo().oE)([_,E,F]):[D];return(0,Bo().oE)([{key:"input-section",render:e=>(0,ie.jsx)(Ft().A,{...e}),items:[{key:"input",render:e=>(0,ie.jsx)(en().Ay,{...e,...x,focus:!0,placeholder:f.formatMessage(Ho.inputPlaceholder),value:S,onChange:e=>{y(e.target.value)},ignoreKeyboardMode:!0,style:{paddingBlockStart:8}}),action:()=>{}}]},...e])}),[x,f,_,S,F,E,D]),R=B.some((e=>e.key===D.key));return(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("div",{role:"status","aria-live":"polite",style:No().Qg,children:R?f.formatMessage(Ho.noResultsMessage):void 0}),(0,ie.jsx)(wt().A,{menuType:s,width:s===jt().gu.Popup?(0,Ko().W)():void 0,maxHeight:s===jt().gu.Popup?300:void 0,hideMobileTopbar:!0,children:(0,ie.jsx)(Pt().A,{type:Pt().O.Vertical,initialFocus:1,sections:B,comboboxProps:C})})]})}const Yo=(0,h().YK)({tooltipLabel:{id:"UnifiedChatPlusMenuButton.tooltipLabel",defaultMessage:"Add…"},addContext:{id:"UnifiedChatNewContextButton.label",defaultMessage:"Add context"},uploadFile:{id:"UnifiedChatPlusMenuButton.uploadFile",defaultMessage:"Add images, PDFs or CSVs"},uploadFileDisabled:{id:"UnifiedChatPlusMenuButton.uploadFile.disabled",defaultMessage:"File uploads are unavailable"},researchMode:{id:"UnifiedChatPlusMenuButton.researchMode",defaultMessage:"Research mode"},researchModeDisabled:{id:"UnifiedChatPlusMenuButton.researchMode.disabled",defaultMessage:"Start a new chat to change this mode"}});function $o(e){const{aiChatFeatureController:t,config:n,inputMode:i,threadMode:r,loadAttachmentData:s,onChangeNextConfig:d,spaceStore:u,threadStore:p,mentions:g,onChangeMentions:f,onAddContextMenuOpenChange:S}=e,y=(0,h().tz)(),b=(0,a().v3)(),x=(0,l().uB)(void 0,Le().A),C=(0,c().IS)((()=>({disabledMenuItemText:{color:Q().Tj.gray.text.secondary}})),[]),v=(0,o.useCallback)((e=>e?C.disabledMenuItemText:void 0),[C.disabledMenuItemText]),M=(0,o.useMemo)((()=>({close:()=>{x.setState({open:!1})}})),[x]),k="workflow"===n.type?n.model:void 0,j=t.supportsUserSpecifiedContext(n.type)&&!t.isChatCompletelyDisabled(i),I=(0,To().Ue)(),{showResearchModeToggle:w,isResearchModeEnabled:A,supportsConfigTypeChange:T,toggleResearchMode:P}=it({aiChatFeatureController:t,config:n,inputMode:i,threadMode:r,onChangeNextConfig:d,threadStore:p,spaceStore:u}),[F,_]=(0,o.useState)("root"),E=(0,xe().N)({threadStore:p,spaceId:u.id}),D=(0,o.useCallback)((()=>{s&&(m().trackAttachFileOpened({environment:b,from:t.analyticsFromSourceForActions,model:k,inferenceInfo:E}),s.uploadFiles())}),[t.analyticsFromSourceForActions,k,b,E,s]),B=(0,o.useCallback)((()=>{S(!1),_("root")}),[S]),R=(0,o.useCallback)((()=>{j&&(_("context"),S(!0),m().trackMentionMenuOpened({environment:b,from:t.analyticsFromSourceForActions,model:k,inferenceInfo:E}))}),[t.analyticsFromSourceForActions,k,j,b,E,S]),N=(0,o.useCallback)((e=>{const t=[],n=void 0===s;if(t.push({key:"upload",action:()=>{D(),e.close()},render:e=>(0,ie.jsx)(At().A,{...e,title:y.formatMessage(Yo.uploadFile),disabled:n,textWrapperStyle:v(n),caption:n?y.formatMessage(Yo.uploadFileDisabled):void 0,icon:(0,ie.jsx)(Re().I,{icon:De().o})})}),j&&t.push({key:"add-context",action:R,render:e=>(0,ie.jsx)(At().A,{...e,title:y.formatMessage(Yo.addContext),icon:(0,ie.jsx)(Re().I,{icon:Ao().b})})}),w){const e=()=>{T&&P()},n=!T;t.push({key:"research-mode",action:e,render:t=>(0,ie.jsx)(At().A,{...t,title:y.formatMessage(Yo.researchMode),caption:n?y.formatMessage(Yo.researchModeDisabled):void 0,disabled:n,textWrapperStyle:v(n),icon:(0,ie.jsx)(Re().I,{icon:et().P,size:"sm"}),right:(0,ie.jsx)(ce().A,{on:A,disabled:n,onClick:t=>{t.stopPropagation(),e()}})})})}if(0!==t.length)return{key:"actions",render:e=>(0,ie.jsx)(Ft().A,{...e}),items:t}}),[j,T,v,R,D,y,A,s,w,P]),z=(0,o.useMemo)((()=>{const e=[],t=N(M);return t&&e.push(t),e}),[M,N]),U=(0,o.useCallback)((e=>"context"===F?(0,ie.jsx)(qo,{mentions:g,onChangeMentions:t=>{f(t),requestAnimationFrame((()=>{B(),e.close()}))},config:n,menuType:t.adaptiveMenuType,threadStore:p,spaceStore:u,disableAgentMentions:!I}):(0,ie.jsx)(wt().A,{menuType:t.adaptiveMenuType,width:240,hideMobileTopbar:!0,children:(0,ie.jsx)(Pt().A,{type:Pt().O.Vertical,initialFocus:0,sections:z})})),[t.adaptiveMenuType,I,B,n,g,f,F,z,u,p]);return(0,ie.jsx)(Oe().A,{buttonPopupStore:x,popupType:Oe().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",originGap:6,onOpen:()=>{_("root"),S(!1)},onClose:()=>{_("root"),S(!1)},renderOrigin:e=>(0,ie.jsx)(Ne,{...e,icon:Rt().plusIcon,testId:"unified-chat-plus-menu-button",tooltipText:Yo.tooltipLabel}),render:U})}const Go=(0,h().YK)({noEditsPillLabel:{id:"unifiedChatLeftSimplifiedButtons.noEditsPill.label",defaultMessage:"Ask mode"},noEditsPillCloseAria:{id:"unifiedChatLeftSimplifiedButtons.noEditsPill.closeAriaLabel",defaultMessage:"Allow edits"},researchPillLabel:{id:"unifiedChatLeftSimplifiedButtons.researchPill.label",defaultMessage:"Research"},researchPillCloseAria:{id:"unifiedChatLeftSimplifiedButtons.researchPill.closeAriaLabel",defaultMessage:"Turn off research mode"}});function Jo(e){const{aiChatFeatureController:t,clientStore:n,config:i,inputMode:a,threadMode:r,onChangeNextConfig:s,loadAttachmentData:l,spaceStore:c,threadStore:d,mentions:p,onChangeMentions:g,onAddContextMenuOpenChange:m,isSimplifiedInputEnabled:f,sourcePickerProps:S}=e,y=(0,h().tz)(),b=Ln(S),{isAskModeAvailable:x,isAskModeEnabled:C,setAskModeEnabled:v}=Ce({config:i,onChangeNextConfig:s}),{showResearchModeToggle:M,isResearchModeEnabled:k,supportsConfigTypeChange:j,toggleResearchMode:I}=it({aiChatFeatureController:t,config:i,inputMode:a,threadMode:r,onChangeNextConfig:s,threadStore:d,spaceStore:c}),w=t.unifiedChatInputModeButtonStyleKey,A=(0,o.useMemo)((()=>{const e=[];return x&&C&&e.push((0,ie.jsx)(Xo,{label:y.formatMessage(Go.noEditsPillLabel),closeAriaLabel:y.formatMessage(Go.noEditsPillCloseAria),onClose:()=>{v(!1)},testId:"unified-chat-no-edits-pill",textStyleKey:w},"no-edits-pill")),M&&k&&e.push((0,ie.jsx)(Xo,{label:y.formatMessage(Go.researchPillLabel),closeAriaLabel:y.formatMessage(Go.researchPillCloseAria),onClose:()=>{j&&I()},testId:"unified-chat-research-pill",textStyleKey:w,isCloseDisabled:!j},"research-mode-pill")),e}),[j,y,x,C,w,v,M,k,I]);return(0,ie.jsxs)(u().Y1,{direction:"horizontal",gap:4,align:"center-left",width:"hug",children:[(0,ie.jsxs)(u().Y1,{direction:"horizontal",align:"center",width:"hug",children:[(0,ie.jsx)($o,{aiChatFeatureController:t,config:i,inputMode:a,threadMode:r,loadAttachmentData:l,onChangeNextConfig:s,spaceStore:c,threadStore:d,mentions:p,onChangeMentions:g,onAddContextMenuOpenChange:m}),(0,ie.jsx)(wo,{aiChatFeatureController:t,clientStore:n,config:i,inputMode:a,onChangeNextConfig:s,spaceStore:c,threadStore:d,isSimplifiedInputEnabled:f,controller:b})]}),(0,ie.jsx)(po,{sourcePickerProps:S,controller:b}),A.length>0?(0,ie.jsx)(u().Y1,{direction:"horizontal",gap:6,align:"center-left",width:"hug",children:A}):null]})}function Xo(e){const{label:t,onClose:n,closeAriaLabel:i,testId:a,textStyleKey:r,isCloseDisabled:s}=e,[l,d]=(0,o.useState)(!1),u=(0,c().IS)((()=>({container:{position:"relative",display:"inline-flex",alignItems:"center",borderRadius:999,height:24,pointerEvents:"auto",overflow:"hidden",whiteSpace:"nowrap",textOverflow:"ellipsis",background:"transparent",paddingInlineStart:6,paddingInlineEnd:26},label:{pointerEvents:"none",transition:"opacity 120ms ease-in-out"},closeButton:{position:"absolute",insetInlineEnd:4,top:"50%",transform:"translateY(-50%)",opacity:l?1:0,visibility:l?"visible":"hidden",pointerEvents:l?"auto":"none",transition:"opacity 120ms ease-in-out, visibility 120ms ease-in-out",borderRadius:999}})),[l]),p=(0,o.useCallback)((()=>{s||n()}),[s,n]),g=(0,o.useCallback)((()=>{d(!0)}),[]),h=(0,o.useCallback)((()=>{d(!1)}),[]);return(0,ie.jsxs)("div",{style:u.container,onMouseEnter:g,onMouseLeave:h,onFocusCapture:g,onBlurCapture:h,children:[(0,ie.jsx)(le().D,{styleKey:r,colorVariant:"secondary",style:u.label,children:t}),(0,ie.jsx)($().A,{icon:qn().xMarkSmallIcon,size:"xs",colorPalette:"gray",colorVariant:"secondary",onClick:p,ariaLabel:i,disabled:s,testId:`${a}-close`,style:u.closeButton})]})}var Qo=()=>n(771540),Zo=()=>n(324254),ei=()=>n(172595),ti=()=>n(965913),ni=()=>n(271205),oi=()=>n(756117),ii=()=>n(148860);const ai=28,ri=8,si=8,li=X().Ev.sm,ci=6,di=14,ui=11,pi=100,gi=(0,h().YK)({sidebar:{id:"SendDestinationMenuItem.sendInSidebar",defaultMessage:"Send in sidebar"},fullPage:{id:"SendDestinationMenuItem.sendInFullPage",defaultMessage:"Send in full page"},background:{id:"SendDestinationMenuItem.sendInBackground",defaultMessage:"Send in background"}}),hi={sidebar:n(177256).A,fullPage:n(258522).q,background:n(598900).f},mi={sidebar:gi.sidebar,fullPage:gi.fullPage,background:gi.background};function fi(e){const{destination:t,isDefault:n,shortcutKeys:i,onActivate:a,onIconHoverChange:r,isIconHovered:s}=e,l=(0,h().tz)(),[d,u]=(0,o.useState)(!1),p=(0,o.useRef)(void 0),g=function(e){const{isRowHovered:t}=e;return(0,c().IS)((()=>({container:{display:"flex",alignItems:"center",width:"100%",height:ai,paddingInline:ri,gap:si,borderRadius:ci,cursor:"pointer",background:t?Q().Tj.gray.background.secondary:"transparent",transition:"background 0.1s ease"},iconContainer:{position:"relative",width:li,height:li,flexShrink:0,cursor:"grab"},animatedIconStyle:{width:li,height:li,display:"flex",alignItems:"center",justifyContent:"center"},animatedDragHandleStyle:{position:"absolute",top:0,insetInlineStart:0,width:li,height:li,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},title:{flex:1,fontSize:di,color:Q().Tj.text.primary,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},shortcut:{display:"inline-flex",gap:2},shortcutRow:{display:"inline-flex",gap:2,alignItems:"center",color:Q().Tj.text.tertiary,fontSize:ui+1,fontWeight:Qt().Wy.medium},defaultIconCircle:{width:li,height:li,borderRadius:li/2,background:Q().Tj.blue.background.accentPrimary,color:Q().Tj.text.inversePrimary,display:"flex",alignItems:"center",justifyContent:"center"}})),[t])}({isRowHovered:d}),m=hi[t],f=mi[t],S=l.formatMessage(f),y=(0,o.useCallback)((()=>{void 0!==p.current&&(window.clearTimeout(p.current),p.current=void 0),u(!0)}),[]),b=(0,o.useCallback)((()=>{void 0!==p.current&&window.clearTimeout(p.current),p.current=window.setTimeout((()=>{u(!1),p.current=void 0}),pi)}),[]),x=(0,o.useCallback)((e=>{(function(e){const t=e.target;if(!(t instanceof Element))return!1;return Boolean(t.closest('[data-drag-handle="true"]'))})(e)||a()}),[a]),C=(0,o.useCallback)((e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),x(e))}),[x]);return(0,o.useEffect)((()=>()=>{void 0!==p.current&&window.clearTimeout(p.current)}),[]),(0,ie.jsxs)("div",{style:g.container,onMouseEnter:y,onMouseLeave:b,onClick:x,onKeyDown:C,role:"button",tabIndex:0,children:[(0,ie.jsx)(Si,{icon:m,isDefault:n,isIconHovered:s,onHoverChange:r,styles:g}),(0,ie.jsx)("span",{style:g.title,children:S}),(0,ie.jsx)("span",{style:g.shortcutRow,"aria-hidden":"true",children:i.map((e=>(0,ie.jsx)("span",{children:e},e)))})]})}function Si(e){const{icon:t,isDefault:n,isIconHovered:i,onHoverChange:a,styles:r}=e,s=(0,o.useCallback)((()=>{a(!0)}),[a]),l=(0,o.useCallback)((()=>{a(!1)}),[a]);return(0,ie.jsxs)("div",{style:r.iconContainer,onMouseEnter:s,onMouseLeave:l,"data-drag-handle":!0,children:[(0,ie.jsx)(oi().A,{animate:{opacity:i?0:1},initial:{opacity:1},exit:{opacity:1},style:r.animatedIconStyle,children:n?(0,ie.jsx)("div",{style:r.defaultIconCircle,children:(0,ie.jsx)(Re().I,{icon:J().arrowStraightUpFillSmallIcon,size:"xxs",colorVariant:"inversePrimary"})}):(0,ie.jsx)(Re().I,{icon:t,size:"sm",colorVariant:"secondary"})}),(0,ie.jsx)(oi().A,{animate:{opacity:i?1:0},initial:{opacity:0},exit:{opacity:0},style:r.animatedDragHandleStyle,children:(0,ie.jsx)(ii().t,{iconSize:"sm"})})]})}const yi=230,bi=6,xi=4,Ci=100,vi=30;function Mi(e){const{aiChatFeatureController:t,buttonPopupStore:n,destinationOrder:i,onDestinationSelect:r,onChangeDestinationOrder:s}=e,l=(0,a().v3)(),d=(0,c().IS)((()=>({container:{paddingBlock:bi,paddingInline:xi}})),[]),u=(0,o.useRef)(void 0),[p,g]=(0,o.useState)(null),h=null!==p,m=(0,Qo()._w)({environment:l,forTooltip:!1}),f=(0,o.useCallback)(((e,t)=>{void 0!==u.current&&(window.clearTimeout(u.current),u.current=void 0),t?g(e):u.current=window.setTimeout((()=>{g(null),u.current=void 0}),Ci)}),[]);(0,o.useEffect)((()=>()=>{void 0!==u.current&&window.clearTimeout(u.current)}),[]);const S=(0,o.useCallback)((e=>{const[t,o,i]=e;void 0!==t&&void 0!==o&&void 0!==i&&(s([t,o,i]),n&&window.setTimeout((()=>{n.setState({...n.state,open:!0})}),vi))}),[n,s]);return(0,ie.jsx)(wt().A,{menuType:t.adaptiveMenuType,width:yi,hideMobileTopbar:!0,children:(0,ie.jsx)("div",{style:d.container,children:(0,ie.jsx)(ni().Ay,{direction:"vertical",keys:[...i],shouldStartDrag:e=>function(e){const t=e.target;if(!(t instanceof Element))return!1;return Boolean(t.closest('[data-drag-handle="true"]'))}(e),onDrop:S,renderKey:(e,t)=>{const n=0===t,o=h||p===e,i=(e=>{const t=(0,ei().RL)(e);return t?t.split("+").map((e=>(0,Qo().dx)({shortcut:e,shortcutItemMap:m}))):[]})(t);return(0,ie.jsx)(fi,{destination:e,isDefault:n,shortcutKeys:i,isIconHovered:o,onActivate:()=>r(e),onIconHoverChange:t=>f(e,t)})}})})})}const ki=18,ji=4,Ii=1,wi=2,Ai=2,Ti=6,Pi=(0,h().YK)({moreOptions:{id:"SendMessageSplitButton.moreOptions",defaultMessage:"More send options"},sendInSidebar:{id:"SendMessageSplitButton.sendInSidebar",defaultMessage:"Send in sidebar"},sendInFullPage:{id:"SendMessageSplitButton.sendInFullPage",defaultMessage:"Send in full page"},sendInBackground:{id:"SendMessageSplitButton.sendInBackground",defaultMessage:"Send in background"}});function Fi(e){const{aiChatFeatureController:t,spaceId:n,onSubmitFromKeyCommand:i}=e,r=(0,l().K8)((()=>(0,ti().Bd)(n)),[n]),s=(0,a().v3)(),d=(0,h().tz)(),u=(0,c().eP)(),p=(0,l().uB)(void 0,Le().A),g=function(e){const{themeMode:t}=e;return(0,c().IS)((()=>{const e=Q().Tj.blue.icon.accentPrimary,n=(0,Y().i)({color:Q().Tj.blue.background.accentPrimary,mode:t}),o=(0,Y().yZ)({color:Q().Tj.blue.background.accentPrimary,mode:t});return{container:{display:"flex",alignItems:"center",background:e,borderRadius:Ae/2,overflow:"hidden",pointerEvents:"auto"},mainButton:{width:Ae+wi-Ai,height:Ae,background:"transparent",borderRadius:0,paddingInlineStart:wi},mainButtonHovered:{background:n},mainButtonPressed:{background:o},mainIcon:{width:X().Ev.sm,height:X().Ev.sm,fill:Q().Tj.text.inversePrimary},chevronButton:{width:ki+Ii+ji,height:Ae,background:"transparent",borderRadius:0,paddingInlineStart:Ii,paddingInlineEnd:ji},chevronButtonHovered:{background:n},chevronButtonPressed:{background:o},chevronIcon:{width:X().Ev.xs,height:X().Ev.xs,fill:Q().Tj.text.inversePrimary}}}),[t])}({themeMode:u}),m=r[0],f={sidebar:Pi.sendInSidebar,fullPage:Pi.sendInFullPage,background:Pi.sendInBackground},S=d.formatMessage(f[m]),y=(0,Qo()._w)({environment:s,forTooltip:!1}),b=(e=>{const t=(0,ei().RL)(e);return t?t.split("+").map((e=>(0,Qo().dx)({shortcut:e,shortcutItemMap:y}))):[]})(0),x=(0,o.useCallback)((()=>{i("enter")}),[i]),C=(0,o.useCallback)((e=>{p.setState({open:!1});const t=(0,ei().Yk)(e,r);t&&i(t)}),[p,r,i]),v=(0,o.useCallback)((e=>{(0,ti().TU)(n,e)}),[n]),M=d.formatMessage(Pi.moreOptions);return(0,ie.jsxs)("div",{style:g.container,children:[(0,ie.jsx)(G().m,{placement:"bottom",renderTooltip:()=>(0,ie.jsxs)("span",{style:{display:"inline-flex",gap:6,alignItems:"center"},children:[(0,ie.jsx)("span",{children:S}),b.length>0?(0,ie.jsx)("span",{style:{display:"inline-flex",gap:3,color:Q().Tj.text.tertiary,fontSize:12,fontWeight:500},children:b.map((e=>(0,ie.jsx)("span",{children:e},e)))}):null]}),render:e=>(0,ie.jsx)($().A,{...e,testId:"agent-send-message-button",icon:J().arrowStraightUpFillSmallIcon,onClick:x,style:g.mainButton,iconStyle:g.mainIcon,hoveredStyle:g.mainButtonHovered,pressedStyle:g.mainButtonPressed,ariaLabel:S})}),(0,ie.jsx)(Oe().A,{buttonPopupStore:p,popupType:Oe().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"end",originGap:Ti,renderOrigin:e=>(0,ie.jsx)(G().m,{placement:"bottom",renderTooltip:()=>(0,ie.jsx)(h().sA,{...Pi.moreOptions}),render:t=>(0,ie.jsx)($().A,{...t,...e,testId:"agent-send-destination-dropdown",icon:Zo().arrowChevronSingleDownSmallIcon,style:g.chevronButton,iconStyle:g.chevronIcon,hoveredStyle:g.chevronButtonHovered,pressedStyle:g.chevronButtonPressed,ariaLabel:M})}),render:()=>(0,ie.jsx)(Mi,{aiChatFeatureController:t,buttonPopupStore:p,destinationOrder:r,onDestinationSelect:C,onChangeDestinationOrder:v})})]})}function _i(e){const{aiChatFeatureController:t,allowQueuingDuringStreaming:n,clientStore:o,config:i,disabled:a,inputMode:r,onChangeNextConfig:s,onStopInference:l,onSubmit:c,spaceStore:d,threadStore:u,threadMode:p}=e,g=t.isChatReady(r),h=(0,te().X)("slippery_slope_send_dropdown"),m=t.canUseSendDestinationShortcuts({inputMode:r,threadMode:p})&&h,f=()=>m?(0,ie.jsx)(Fi,{aiChatFeatureController:t,spaceId:d.id,onSubmitFromKeyCommand:c}):(0,ie.jsx)(_e,{onSubmit:c,aiChatFeatureController:t,inputMode:"recording"===r?"ready":r});let S=null;return"pendingStop"===r?S=(0,ie.jsx)(me,{onClick:l,disabled:!0}):"runningInference"===r&&t.supportsStopInference(i.type)?S=n&&!a?f():(0,ie.jsx)(me,{onClick:l}):(g&&!a&&"recording"!==r||"recording"!==r)&&(S=f()),(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(pe,{aiChatFeatureController:t,config:i,threadMode:p,disabled:Boolean(a),onChangeNextConfig:s}),(0,ie.jsx)(Qe,{aiChatFeatureController:t,clientStore:o,config:i,inputMode:r,onChangeNextConfig:s,spaceStore:d,threadStore:u,threadMode:p,isSimplifiedInputEnabled:!0}),S]})}function Ei(e){const{aiChatFeatureController:t,clientStore:n,config:o,inputMode:i,threadMode:a,loadAttachmentData:r,onChangeNextConfig:s,onStartRecording:l,onStopInference:d,onStopRecording:p,onSubmit:g,spaceStore:h,threadStore:m,disabled:f,allowQueuingDuringStreaming:S,mentions:y,onChangeMentions:b,onAddContextMenuOpenChange:x,sourcePickerProps:C,isSimplifiedInputEnabled:v}=e,M=(0,c().IS)((()=>({root:{pointerEvents:"none",minWidth:0},left:{pointerEvents:"none",minWidth:0,flexGrow:1},right:{pointerEvents:"none"}})),[]);return(0,ie.jsxs)(u().Y1,{direction:"horizontal",gap:12,align:"center",padding:"4px 8px 8px 8px",style:M.root,children:[(0,ie.jsx)(u().Y1,{direction:"horizontal",gap:2,align:"center-left",width:"hug",style:M.left,children:v?(0,ie.jsx)(Jo,{aiChatFeatureController:t,clientStore:n,config:o,inputMode:i,threadMode:a,loadAttachmentData:r,onChangeNextConfig:s,spaceStore:h,threadStore:m,mentions:y,onChangeMentions:b,onAddContextMenuOpenChange:x,isSimplifiedInputEnabled:v,sourcePickerProps:C}):(0,ie.jsx)(Hn,{aiChatFeatureController:t,clientStore:n,config:o,inputMode:i,threadMode:a,loadAttachmentData:r,onChangeNextConfig:s,spaceStore:h,threadStore:m})}),(0,ie.jsx)(u().Y1,{direction:"horizontal",gap:4,align:"center-right",width:"hug",style:M.right,children:v?(0,ie.jsx)(_i,{aiChatFeatureController:t,clientStore:n,inputMode:i,config:o,threadMode:a,onChangeNextConfig:s,onStopInference:d,onSubmit:g,allowQueuingDuringStreaming:S,disabled:f,spaceStore:h,threadStore:m}):(0,ie.jsx)(je,{aiChatFeatureController:t,inputMode:i,config:o,threadMode:a,onChangeNextConfig:s,onStartRecording:l,onStopInference:d,onStopRecording:p,onSubmit:()=>g(),disabled:f,allowQueuingDuringStreaming:S})})]})}var Di=()=>n(943101),Bi=()=>n(384944),Ri=()=>n(882016);const Ni=16,zi=9,Ui=16,Ki=6,Oi=(0,h().YK)({connectorsBanner:{id:"connectorsBanner.bannerText",defaultMessage:"Get better answers from your apps"}}),Li=["notion-mail","notion-calendar"];function Vi(e){const{aiChatFeatureController:t,inputMode:n}=e,r=(0,a().Y0)(),s=(0,h().tz)(),d="dark"===(0,c().eP)(),u=(0,l().K8)((()=>function(e){const t=[],n=[],o=[],i=[],a=[];for(const r of e)(0,T().Xk)(Et().Si,r)?t.push(r):(0,T().Xk)(Et().B6,r)?n.push(r):(0,T().Xk)(Li,r)?o.push(r):"slack"===r?i.push(r):a.push(r);return[...o,...i,...t,...n,...a]}((0,O().kB)())),[]),[p,g]=(0,o.useState)(!1),m=(0,o.useRef)(null),f=(0,o.useRef)(null),S=(0,a().v3)(),y=(0,L().r)(),b=(0,Ot()._)({name:"ai_connectors",spaceId:y,userId:S.currentUser.id}),x=(0,c().eP)(),C=(0,c().IS)((()=>({animationWrapper:{zIndex:-1,position:"relative"},bannerContainer:{position:"absolute",cursor:"pointer",backgroundColor:d?p?"rgba(255, 255, 255, 0.04)":"rgba(255, 255, 255, 0.02)":p?Q().Tj.background.tertiary:Q().Tj.background.secondary,color:Q().Tj.text.secondary,fontWeight:Qt().Wy.medium,borderStartStartRadius:0,borderStartEndRadius:0,borderEndEndRadius:12,borderEndStartRadius:12,top:-14,paddingTop:22,paddingInlineEnd:zi,paddingBottom:8,paddingInlineStart:Ni,display:"flex",alignItems:"center",fontSize:"12px",width:"100%",border:"none",justifyContent:"space-between",boxShadow:(0,Ri().O)({isPhone:r.isPhone,themeMode:x})},leftSection:{display:"flex",alignItems:"center",gap:8,flexShrink:0},iconsContainer:{display:"flex",alignItems:"center",gap:Ki,marginInlineStart:"auto",flexShrink:1,minWidth:0,overflow:"hidden"},textWrapper:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",flexShrink:0},rightSection:{display:"flex",alignItems:"center",gap:4,paddingInlineStart:8}})),[r.isPhone,p,d,x]),v=(0,o.useCallback)((()=>g(!0)),[]),M=(0,o.useCallback)((()=>g(!1)),[]),k=function(e,t,n){const i=(0,Di().wY)(e);return(0,o.useMemo)((()=>{if(!i||!t.current)return n;const e=i.width-(t.current.scrollWidth+40+(Ni+zi)+8),o=Ui+Ki,a=Math.max(0,Math.floor(e/o));return n.slice(0,a)}),[n,i,t])}(m,f,u),{currentUserSettingsStore:j,dismissedBanner:I}=(0,l().K8)((()=>{var e;const t=i().default.state.currentUserSettingsStore;return{currentUserSettingsStore:t,dismissedBanner:null==t||null===(e=t.getSettings())||void 0===e?void 0:e.dismissed_ai_chat_home_connectors_banner}}),[]),w=(0,o.useCallback)((e=>{e.stopPropagation(),j&&!I&&W().createAndCommit({environment:S,userAction:"UnifiedChatInput.dismissConnectorsBanner",canUndo:!1,perform:e=>{Bi().zv({store:j,data:{settings:{...j.getSettings(),dismissed_ai_chat_home_connectors_banner:!0}},transaction:e})}})}),[j,I,S]),A=(0,o.useCallback)((()=>{(0,Nt().pp)({environment:S,connector:"generic",analyticsFrom:"ai_chat_connectors_banner",connectorsFeatureAvailability:b})}),[S,b]);return t.supportsConnectorsBanner?I||"upgradeRequired"===n||0===u.length?null:(0,ie.jsx)("div",{style:C.animationWrapper,children:(0,ie.jsx)(oi().A,{visible:!0,initial:{opacity:0,height:0,translateY:-100},animate:{opacity:1,height:40,visibility:"visible",translateY:0},exit:{opacity:0,height:0},config:{duration:500},children:(0,ie.jsxs)(Y().Ay,{ref:m,style:C.bannerContainer,onClick:A,onMouseEnter:v,onMouseLeave:M,children:[(0,ie.jsx)("div",{style:C.leftSection,children:(0,ie.jsx)("div",{ref:f,style:C.textWrapper,children:s.formatMessage(Oi.connectorsBanner)})}),(0,ie.jsx)("div",{style:C.iconsContainer,children:k.map(((e,t)=>(0,ie.jsx)(kt().Q,{iconGroup:(0,Lt().e1)(e),overrideSize:()=>Ui,variantName:"default"},e)))}),(0,ie.jsx)("div",{style:C.rightSection,children:(0,ie.jsx)($().A,{ariaLabel:s.formatMessage({id:"connectorsBanner.close",defaultMessage:"Close"}),icon:qn().xMarkSmallIcon,onClick:w})})]})})}):null}var Wi=()=>n(312788),Hi=()=>n(765974),qi=()=>n(846523),Yi=()=>n(599813),$i=()=>n(704658);const Gi=(0,h().YK)({learnMore:{id:"infoBanner.learnMore",defaultMessage:"Learn more"},dismiss:{id:"infoBanner.dismiss",defaultMessage:"Dismiss"}});function Ji(e){const{inputMode:t,aiChatFeatureController:n,aiConnectorIncident:o}=e;if("agent_collections_new_view"===n.aiChatType||"agent_new_db_quick_access"===n.aiChatType)return!1;switch(t){case"configTypeDown":case"modelProviderDown":case"upgradeRequired":case"error":case"aiDisabled":return!0;case"ready":case"readOnlyThread":case"uploadingFiles":case"filesRequireConfirmation":case"recording":case"runningInference":case"pendingStop":case"noContent":return!!o;default:return(0,T().HB)(t)}}function Xi(e){const{navigate:t}=(0,o.useContext)(Wi().E),{aiChatFeatureController:n,upsellMessage:i,upgradeButtonTextProps:r,isUpgradeSystemEnabled:s,inputMode:l,errorMessage:d,onErrorDismiss:u,aiConnectorIncident:p}=e,g=(0,a().v3)(),m=(0,h().tz)(),f="configTypeDown"===l||"modelProviderDown"===l,S="error"===l,y=(0,o.useMemo)((()=>{if("configTypeDown"===l)return()=>{t({environment:g,url:"https://www.notion-status.com",openInNew:"tab"})}}),[l,g,t]),b=(0,o.useMemo)((()=>f?(0,ie.jsx)(h().sA,{..."modelProviderDown"===l?K().$.modelProviderDown:K().$.cannotSubmitMessageSeeStatusPage}):S&&d?d:"aiDisabled"===l?(0,ie.jsx)(h().sA,{id:"unifiedChatInput.aiDisabled",defaultMessage:"AI is disabled for this workspace"}):p?p.customMessage?p.customMessage:"degraded"===p.incidentType?(0,ie.jsx)(h().sA,{id:"infoBanner.aiConnectorDegraded",defaultMessage:"{connectorName} AI connector is experiencing issues. You may experience degraded performance.",values:{connectorName:to().w0[p.connector]}}):(0,ie.jsx)(h().sA,{id:"infoBanner.aiConnectorIncident",defaultMessage:"{connectorName} AI connector is temporarily unavailable. We’re working to resolve the issue.",values:{connectorName:to().w0[p.connector]}}):s?r?(0,ie.jsx)($i().UpgradeButton,{...r}):null:i),[f,p,S,d,i,s,r,l]),x=Ji({inputMode:l,aiChatFeatureController:n,aiConnectorIncident:p}),C=(0,c().IS)((()=>({inlineErrorContainer:{marginBottom:-12,position:"relative",display:"flex",flexDirection:"column",zIndex:-1},inlineError:{backgroundColor:f||S?Q().Tj.red.background.primary:Q().Tj.blue.background.secondary,color:f||S?Q().Tj.red.text.primary:Q().Tj.text.secondary,fontWeight:Qt().Wy.medium,borderStartStartRadius:16,borderStartEndRadius:16,borderEndEndRadius:0,borderEndStartRadius:0,paddingTop:8,paddingInlineEnd:16,paddingBottom:18,paddingInlineStart:16,display:"flex",alignItems:"center",fontSize:"12px",width:"100%",border:"none",justifyContent:"space-between",position:"relative",overflow:"hidden"},inlineErrorContent:{display:"flex",alignItems:"center",gap:8,flex:1},warningIcon:{fill:f||S?Q().Tj.red.text.primary:Q().Tj.text.secondary},messageAndInfoWrapper:{display:"flex",alignItems:"center",gap:8,flex:1},inlineErrorText:{textWrap:"pretty"},learnMoreIcon:{fill:f||S?Q().Tj.red.text.primary:Q().Tj.text.secondary},dismissIcon:{fill:Q().Tj.text.secondary},inlineErrorExtension:{position:"absolute",bottom:0,insetInlineStart:0,insetInlineEnd:0,height:32,zIndex:-1}})),[f,S]),v=(0,o.useMemo)((()=>({visible:x,initial:{opacity:0,translateY:40},animate:{opacity:x?1:0,translateY:x?0:40},exit:{opacity:0,translateY:40},config:{duration:300}})),[x]);return(0,ie.jsx)(oi().A,{visible:v.visible,initial:v.initial,animate:v.animate,exit:v.exit,config:v.config,children:(0,ie.jsx)("div",{style:C.inlineErrorContainer,children:(0,ie.jsxs)("div",{style:C.inlineError,children:[(0,ie.jsxs)("div",{style:C.inlineErrorContent,children:[f||S?(0,ie.jsx)(Re().I,{icon:Hi().exclamationMarkTriangleFillIcon,size:"sm",style:C.warningIcon}):null,(0,ie.jsxs)("div",{style:C.messageAndInfoWrapper,children:[(0,ie.jsx)("div",{style:C.inlineErrorText,children:b}),y?(0,ie.jsx)(G().m,{renderTooltip:()=>m.formatMessage(Gi.learnMore),render:e=>(0,ie.jsx)($().A,{onClick:y,icon:()=>(0,ie.jsx)(kt().Q,{iconGroup:qi().u,variantName:"default",size:"lg",colorVariant:"secondary",style:C.learnMoreIcon}),ariaLabel:m.formatMessage(Gi.learnMore),size:"xs",...e})}):void 0,S&&u?(0,ie.jsx)(G().m,{renderTooltip:()=>m.formatMessage(Gi.dismiss),render:e=>(0,ie.jsx)($().A,{onClick:u,icon:()=>(0,ie.jsx)(Re().I,{icon:Yi().xMarkIcon,style:C.learnMoreIcon}),ariaLabel:m.formatMessage(Gi.dismiss),size:"xs",...e})}):void 0]})]}),p?(0,ie.jsx)(G().m,{renderTooltip:()=>m.formatMessage(Gi.dismiss),render:e=>(0,ie.jsx)($().A,{onClick:p.onDismiss,icon:()=>(0,ie.jsx)(Re().I,{icon:Yi().xMarkIcon,size:"xs",style:C.dismissIcon}),ariaLabel:m.formatMessage(Gi.dismiss),size:"xs",...e})}):void 0,(0,ie.jsx)("div",{style:C.inlineErrorExtension})]})})})}var Qi=()=>n(782482);function Zi(e){const{aiChatFeatureController:t,children:n,inputMode:i,loadAttachmentData:a,onEsc:r,textStoreFocus:s,threadStore:d}=e,p=t.isChatCompletelyDisabled(i),g=(0,l().K8)((()=>(0,_().OT)(d)),[d]),[h,m]=(0,o.useState)(!1),f=(0,c().eP)(),S=(0,c().IS)((()=>{const e=t.shouldRenderHeadless;let n;e||(n=s.isFocused?t.isChatInputElevated?Q().Tj.shadow.outline.lg:Q().Tj.shadow.outline.md:t.isChatInputElevated?Q().Tj.shadow.outline.md:Q().Tj.shadow.outline.sm);return{container:{boxShadow:n,backgroundColor:no({themeMode:f,shouldRenderHeadless:e,usesElevatedDarkModeBackground:t.usesElevatedDarkModeBackground}),...e||"filesRequireConfirmation"!==i?e?{}:{borderRadius:16}:{borderStartStartRadius:0,borderStartEndRadius:0,borderEndStartRadius:16,borderEndEndRadius:16},outline:!e&&(h||s.isFocused&&!g&&t.supportsBlueFocusRing)?`2px solid ${Q().Tj.blue.border.accentPrimary}`:void 0,minWidth:0,transition:e?void 0:"box-shadow 0.1s ease-in-out",pointerEvents:"none"}}}),[s.isFocused,h,g,t.supportsBlueFocusRing,t.isChatInputElevated,t.usesElevatedDarkModeBackground,t.shouldRenderHeadless,i,f]),y=(0,o.useCallback)((e=>{e.preventDefault(),m(!0)}),[]),b=(0,o.useCallback)((e=>{e.preventDefault(),m(!1)}),[]),x=(0,o.useCallback)((e=>{if(!a||!a.onDropFiles)return;e.stopPropagation(),e.preventDefault(),m(!1);const t=Array.from(e.dataTransfer.files);t.length>0&&a.onDropFiles(t)}),[a]),C=!p&&void 0!==(null==a?void 0:a.onDropFiles),v=(0,o.useRef)(null),M=(0,o.useCallback)((e=>{e.target===v.current&&s.focus()}),[s]);return(0,ie.jsx)(Qi().N,{onEsc:r,debugName:"UnifiedChatBorder",capture:s.isFocused&&!p,children:(0,ie.jsx)("div",{ref:v,role:"presentation",style:{position:"relative"},onDragOver:C?y:void 0,onDragLeave:C?b:void 0,onDrop:C?x:void 0,onPointerDown:M,children:(0,ie.jsx)(u().Y1,{direction:"vertical",width:"fill",style:S.container,children:n})})})}var ea=()=>n(186441),ta=()=>n(366437),na=()=>n(401040),oa=()=>n(857048),ia=()=>n(295304),aa=()=>n(405623),ra=()=>n(298182),sa=()=>n(827368),la=()=>n(392899);const ca={sm:44,default:56,md:84,lg:112},da={sm:240,default:240,md:240,lg:240},ua=2,pa=["currentPage","page"];function ga(e){const{aiChatFeatureController:t,inputMode:n,loadAttachmentData:i,onEsc:r,onSubmit:s,onCommandEnter:l,onCommandAltEnter:u,onTextChange:p,placeholder:g,textStore:h,textStoreFocus:m,ignoreKeyboardMode:f,alignWithSimplifiedActions:y}=e,b=(0,a().v3)(),{bodyStyleKey:x}=(0,sa().yq)(),C=t.isChatCompletelyDisabled(n),v=t.isChatSubmitDisabled(n),M=t.isSingleLineInput,k=(0,te().X)("agent_enable_context_block_selection")&&!M,j=(0,To().Ue)(),I=(0,o.useMemo)((()=>j?{...ra().md,bot:!1}:ra().md),[j]),w=(0,o.useCallback)((()=>{Ht().A.isMobile&&m.blur()}),[m]),A=(0,la().t)(),T=(0,o.useCallback)((()=>{if(k){const e=(0,na().G)();A(e)&&S().globalChatPanelRuntimeStore.update((t=>({...t,completionContext:e})))}oa().wr(),(0,ea().w)(),Ht().A.isMobile&&m.focus()}),[m,k,A]),P=(0,o.useCallback)((()=>{v||s()}),[s,v]),F=(0,o.useCallback)((()=>{const e=d().default.state;"editing"===e.mode&&W().createAndCommit({userAction:"UnifiedChatTextInput.handleEnterNewLine",environment:b,canUndo:!0,perform:t=>{ia().$D({environment:b,editorMode:"default",string:"\n",multiSelection:e.multiSelection,disableMentions:!0,disableSlashCommands:!0,disableEmojiCommands:!0,transaction:t})}})}),[b]),_=t.isSubmitOnReturnEnabled?P:F,E=(0,o.useCallback)((e=>{v||null==l||l(e)}),[v,l]),D=(0,o.useCallback)((e=>{v||null==u||u(e)}),[v,u]),B=(0,c().IS)((()=>{const e=M?40:ca[t.chatInputContainerMinHeight],n=t.chatInputHeightCanGrow?da[t.chatInputContainerMinHeight]:e,o=t.shouldShowInlineSubmit?t.shouldUseCompactSubmitButton?30:44:t.shouldRenderHeadless?0:12,i=function(e){return e.shouldRenderHeadless?0:e.isSingleLineInput?10:12}(t),a=Boolean(y)&&!t.shouldRenderHeadless,r=function(e){const{isSingleLine:t,basePadding:n,paddingInlineEnd:o,alignWithSimplifiedActions:i}=e;return`${n}px ${o}px ${i?0:n}px ${(t?14:n)+(i?ua:0)}px`}({basePadding:i,paddingInlineEnd:o,isSingleLine:M,alignWithSimplifiedActions:a});return{placeholder:{opacity:1,cursor:"text",minHeight:e},wrapper:{flexGrow:1,flexShrink:1,minWidth:0,display:"flex"},scrollContainer:{flexGrow:1,flexShrink:1,minWidth:0,maxWidth:"calc(100% - 40px)",width:0,overflowX:"auto",overflowY:"hidden"},textContainer:M?{padding:r,minHeight:e,maxHeight:n,whiteSpace:"pre",width:"100%",boxSizing:"border-box",pointerEvents:"auto"}:{flexGrow:1,padding:r,minHeight:e,maxHeight:n,overflow:"auto",width:"100%",pointerEvents:"auto"}}}),[t,y,M]),R=(0,ie.jsx)(aa().A,{disableComment:!0,disabled:C,disabledMentionTypes:I,disableEmbedMenu:!0,disableEmojiCommands:!1,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableSlashCommands:!0,disableStyleAnnotations:!1,disableSuggestEdit:!0,disableRichTextActions:!0,disableTryCloseSidePeek:!0,disableShiftEnter:M,inPageFind:ta().Os.none,onChange:p,onEnter:_,onCommandEnter:l?E:void 0,onCommandAltEnter:u?D:void 0,onEsc:r,onBlur:w,onFocus:T,onPasteFiles:null==i?void 0:i.onPasteFiles,onTab:()=>!0,onUntab:()=>!0,pasteBehavior:"inline",placeholder:g,placeholderStyle:B.placeholder,preserveBlockSelection:k,store:h,style:B.textContainer,usePopupForMentionOnMobile:!0,emptyMentionSectionOrdering:pa,testId:"agent-chat-input",ignoreKeyboardMode:f,context:"agent-chat-input",enableChatSelectionContextTokens:!0});return(0,ie.jsx)(le().D,{colorVariant:C?"secondary":"primary",styleKey:x,children:M?(0,ie.jsx)("div",{style:B.wrapper,children:(0,ie.jsx)("div",{className:"hide-scrollbar",style:B.scrollContainer,children:R})}):R})}var ha=()=>n(611648),ma=()=>n(187174),fa=()=>n(804138),Sa=()=>n(876544),ya=()=>n(848392),ba=()=>n(234459),xa=()=>n(220719),Ca=()=>n(738471),va=()=>n(376254);function Ma(e){return"image/png"===e||"image/jpeg"===e||"image/gif"===e||"image/webp"===e||"image/heic"===e}function ka(e){const{onRemove:t,ariaLabel:n}=e,o=(0,c().IS)((()=>({container:{position:"absolute",top:4,insetInlineEnd:4,borderRadius:9999,background:"rgba(0, 0, 0, 0.5)",height:16,width:16},hovered:{background:"rgba(0, 0, 0, 0.8)"},icon:{width:12,height:12}})),[]);return(0,ie.jsx)($().A,{icon:qn().xMarkSmallIcon,ariaLabel:n,style:o.container,iconStyle:o.icon,hoveredStyle:o.hovered,hasBackground:!0,colorVariant:"inversePrimary",onClick:t})}function ja(e){const{attachment:t,onDeleteStagedAttachment:n,isDisabled:o,permissionRecord:i}=e,r=(0,h().tz)(),s=function(e){const{attachment:t,permissionRecord:n}=e,o=(0,a().v3)(),[{value:i}]=(0,ma().Yb)((async()=>{if("complete"!==t.status)return;if(!n)return Ma(t.contentType)?t.fileUrl:void 0;const e=await o.api.callCellCompatibleApi({eventName:"getSignedFileUrls",environment:o,data:{urls:[{url:t.fileUrl,download:!1,downloadName:t.fileName,permissionRecord:n}]},cellNavigation:{spaceId:n.spaceId}});if("failed"===e.type)throw e.error;return e.data.signedUrls[0]}),[t,o,n]);return i}({attachment:t,permissionRecord:i}),l=function(e){const t=e.fileName.toLowerCase();return"application/pdf"===e.contentType||t.endsWith(".pdf")?"PDF":"text/csv"===e.contentType||t.endsWith(".csv")?"CSV":Ma(e.contentType)?"Image":"File"}(t),d="PDF"===(p=l)?Sa().U:"CSV"===p?fa().Q:ya().M;var p;const g=Ma(t.contentType),m="complete"===t.status?s??t.fileUrl:void 0,f=g&&m,S="in_progress"===t.status,y=S||f,b=(0,c().IS)((()=>({card:{position:"relative",minWidth:y?64:210,maxWidth:y?64:240,height:64,borderRadius:10,boxShadow:Q().Tj.shadow.outline.sm,flexShrink:0},image:{width:"100%",height:"100%",objectFit:"cover",borderRadius:10},fileIconWrapper:{borderRadius:6,backgroundColor:"PDF"===l?Q().Tj.red.background.primary:"CSV"===l?Q().Tj.green.background.secondary:Q().Tj.gray.background.secondary},fileIcon:{width:22,height:22,fill:"PDF"===l?Q().Tj.red.icon.accentPrimary:"CSV"===l?Q().Tj.green.icon.accentPrimary:Q().Tj.icon.secondary},fileTextContainer:{minWidth:0,overflow:"hidden"},fileText:{maxWidth:"100%"}})),[y,l]);return S?(0,ie.jsx)(u().Y1,{align:"center",height:64,width:64,style:b.card,children:(0,ie.jsx)($t().k,{size:"lg"})}):(0,ie.jsxs)(u().Y1,{align:"center-left",height:64,gap:8,style:b.card,children:[f?(0,ie.jsx)(Ca().A,{src:(0,xa().o9)(m),alt:t.fileName,style:b.image}):(0,ie.jsxs)(u().Y1,{direction:"horizontal",align:"center-left",width:"fill",gap:8,padding:"0 12px 0 4px",children:[(0,ie.jsx)(u().Y1,{align:"center",height:56,width:56,style:b.fileIconWrapper,children:d(b.fileIcon)}),(0,ie.jsxs)(u().Y1,{gap:4,align:"center-left",width:"fill",style:b.fileTextContainer,children:[(0,ie.jsx)(le().D,{styleKey:"bodyMedium",textOverflow:"ellipsis",colorVariant:"primary",style:b.fileText,children:t.fileName}),(0,ie.jsx)(le().D,{styleKey:"captionMedium",colorVariant:"secondary",children:l})]})]}),o?null:(0,ie.jsx)(ka,{ariaLabel:r.formatMessage({id:"unifiedChatAttachmentsCarousel.removeAttachment",defaultMessage:"Remove {fileName} from context"},{fileName:t.fileName}),onRemove:()=>{"complete"===t.status&&n(t.fileUrl)}})]})}function Ia(e){const{attachments:t,onDeleteStagedAttachment:n,threadId:i,spaceId:a,isDisabled:r}=e,s=(0,o.useMemo)((()=>{if(!i)return;return{table:ba().To,id:i,spaceId:a}}),[i,a]),l=(0,c().IS)((()=>({scroller:{padding:"12px 12px 2px",pointerEvents:"auto",width:"100%"}})),[]);return 0===t.length?null:(0,ie.jsx)(va().H,{type:ha().A.X,style:l.scroller,preventType:ha().A.Y,children:(0,ie.jsx)(u().Y1,{direction:"horizontal",gap:10,align:"center-left",children:t.map((e=>(0,ie.jsx)(ja,{attachment:e,permissionRecord:s,onDeleteStagedAttachment:n,isDisabled:r},function(e){return"complete"===e.status?e.fileUrl:`in-progress-${e.fileName}-${e.timeUploaded??"unknown"}`}(e))))})})}var wa=()=>n(219348),Aa=()=>n(761894),Ta=()=>n(601751),Pa=()=>n(379178),Fa=()=>n(554283);const _a="medium",Ea=(0,n(278589).N)(_a),Da=-(Ea-14),Ba=-20;function Ra(e){const{aiChatFeatureController:t}=e,n=(0,a().v3)(),r=(0,h().tz)(),s=(0,l().O$)(i().AppStoreSidebarSpaceViewStore),d=(0,wa().DV)(s),u=t.supportsUpdatingExistingPersonalizationSettings(),p=(0,l().K8)((()=>{var e;if(!s)return;const t=null===(e=s.getSettings())||void 0===e?void 0:e.agent_personalization_settings;return(null==t?void 0:t.name)??void 0}),[s]),g=(0,o.useMemo)((()=>{const e=(0,Pa().N)(d,p);return e||(0,ie.jsx)(h().sA,{id:"assistantOriginElement.accessoryWithoutName.tooltipHeading",defaultMessage:"Hi, it’s Notion AI"})}),[d,p]),[m,f]=(0,Fa().B)(),S=(0,c().IS)((()=>({outerContainer:{position:"absolute",insetInlineEnd:0,top:Da,paddingInlineStart:12,paddingInlineEnd:16,paddingBottom:12,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"auto"},faceContainer:{width:Ea,height:Ea,display:"flex",alignItems:"center",justifyContent:"center",transform:"translateY(0)",transition:"transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1)",cursor:u?"pointer":"default"},hovered:{transform:`translateY(${Ba}px)`}})),[u]),y=(0,o.useCallback)((e=>{e.stopPropagation(),u&&(0,wa().cP)({store:Ta().r,from:"unified_chat_input_peek_face",shouldSetSeenPersonalizationSettingsModal:!0,environment:n})}),[n,u]);return(0,ie.jsx)(G().m,{placement:"left",originRectTransform:e=>new DOMRect(e.x+10,e.y-26,e.width,e.height),renderTooltip:()=>g,render:e=>(0,ie.jsx)("div",{ref:m,style:S.outerContainer,onClick:y,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),y(e))},role:"button",tabIndex:0,"aria-label":r.formatMessage({id:"AgentChatHeader.personalize",defaultMessage:"Personalize"}),...e,children:(0,ie.jsx)("div",{style:{...S.faceContainer,...f?S.hovered:{}},children:(0,ie.jsx)(Aa().x,{variant:_a,accessory:d,shadowVariant:"light"})})})})}var Na=()=>n(416783),za=()=>n(452745),Ua=()=>n(108715);const Ka="https://www.notion.com/help/notion-ai-security-practices";function Oa(e){const{attachments:t,onAllowUploads:n,onRemoveFiles:i}=e,a=(0,o.useMemo)((()=>t.filter((e=>"complete"===e.status&&"risky"===e.attachmentRisk))),[t]).length,r=(0,c().IS)((()=>({container:{position:"relative",borderStartStartRadius:12,borderStartEndRadius:12,borderEndStartRadius:0,borderEndEndRadius:0,boxShadow:Q().Tj.shadowXS,backgroundColor:Q().Tj.background.primary,paddingTop:12,paddingInlineEnd:14,paddingBottom:16,paddingInlineStart:14,gap:8},topRow:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",marginBottom:8},agentSecurityImage:{width:32,height:32,flexShrink:0},badge:{display:"inline-flex",alignItems:"center",gap:6,backgroundColor:Q().Tj.blue.background.secondary,color:Q().Tj.blue.icon.accentPrimary,borderRadius:1e3,padding:"4px 10px",width:"fit-content"},buttonRow:{paddingTop:8,display:"flex",gap:8,justifyContent:"flex-start"},learnMoreLink:{color:Q().Tj.blue.text.accentPrimary}})),[]);return 0===a?null:(0,ie.jsx)(oi().A,{visible:!0,initial:{opacity:0,height:0,translateY:100},animate:{opacity:1,height:"auto",translateY:0},config:{duration:1100},children:(0,ie.jsxs)(u().Y1,{direction:"vertical",style:r.container,children:[(0,ie.jsxs)("div",{style:r.topRow,children:[(0,ie.jsx)("img",{src:Ua(),alt:"Security",style:r.agentSecurityImage}),(0,ie.jsxs)("div",{style:r.badge,children:[(0,ie.jsx)(Re().I,{icon:za().checkmarkShieldFillSmallIcon,size:"sm"}),(0,ie.jsx)(le().D,{styleKey:"captionMedium",colorPalette:"blue",colorVariant:"accentPrimary",children:(0,ie.jsx)(h().sA,{id:"unifiedChatFileConfirmationBanner.automaticallyScanned",defaultMessage:"Automatically scanned"})})]})]}),(0,ie.jsx)(le().D,{styleKey:"bodyMedium",colorVariant:"primary",children:(0,ie.jsx)(h().sA,{id:"unifiedChatFileConfirmationBanner.trustFilesHeading",defaultMessage:"Do you trust these files?"})}),(0,ie.jsxs)(le().D,{styleKey:"bodyRegular",children:[(0,ie.jsx)(h().sA,{id:"unifiedChatFileConfirmationBanner.securityWarning",defaultMessage:"Allowing Notion AI to access untrusted files can be a security risk."})," ",(0,ie.jsx)(Na().V,{hoverColor:"blue",style:r.learnMoreLink,href:Ka,external:!0,disableUnderline:!0,children:(0,ie.jsx)(h().sA,{id:"unifiedChatFileConfirmationBanner.learnMore",defaultMessage:"Learn more"})})]}),(0,ie.jsx)(le().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,ie.jsx)(h().sA,{id:"unifiedChatFileConfirmationBanner.flaggedCount",defaultMessage:"{count, plural, one {# file} other {# files}} flagged as potentially harmful",values:{count:a}})}),(0,ie.jsxs)("div",{style:r.buttonRow,children:[(0,ie.jsx)(Ve().E,{onClick:i,children:(0,ie.jsx)(le().D,{styleKey:"bodyMedium",colorVariant:"primary",children:(0,ie.jsx)(h().sA,{id:"unifiedChatFileConfirmationBanner.removeButton",defaultMessage:"Remove"})})}),(0,ie.jsx)(Ve().E,{onClick:n,children:(0,ie.jsx)(le().D,{styleKey:"bodyMedium",colorVariant:"primary",children:(0,ie.jsx)(h().sA,{id:"unifiedChatFileConfirmationBanner.allowUploadsButton",defaultMessage:"Allow uploads"})})})]})]})})}var La=()=>n(153321),Va=()=>n(203066),Wa=()=>n(381175),Ha=()=>n(295633),qa=()=>n(77311),Ya=()=>n(277153),$a=()=>n(743246),Ga=()=>n(496703),Ja=()=>n(770160),Xa=()=>n(617711),Qa=()=>n(975394),Za=()=>n(406094),er=()=>n(70899),tr=()=>n(78080);const nr=(0,h().YK)({addContextTooltip:{id:"UnifiedChatNewContextButton.tooltip",defaultMessage:"Mention a person, page, or date"},addContextTooltipWithAgents:{id:"UnifiedChatNewContextButton.agentTooltip",defaultMessage:"Mention a person, page, date, or agent"},addContextLabel:{id:"UnifiedChatNewContextButton.label",defaultMessage:"Add context"}}),or=.15,ir=.1,ar=[.45,0,.55,1];function rr(e){const{mentions:t,onChangeMentions:n,showLabel:i,isDisabled:r,aiChatFeatureController:s,config:l,threadStore:d,spaceStore:u,onMenuOpenChange:p}=e,g=(0,a().v3)(),f=(0,c().eP)(),S=(0,c().IS)((()=>({iconArea:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20,flexShrink:0},container:{borderRadius:50,fontSize:12,fontWeight:400,height:28,padding:"2px 3px",display:"flex",alignItems:"center",outline:"none",position:"relative",pointerEvents:"auto",border:`1px solid ${(0,tr().p)({themeMode:f,usesElevatedDarkModeBackground:null==s?void 0:s.usesElevatedDarkModeBackground})}`},textArea:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",minWidth:0,flex:1}})),[null==s?void 0:s.usesElevatedDarkModeBackground,f]),y=(0,h().tz)(),b=(0,To().Ue)(),x="workflow"===l.type?l.model:void 0,C=(0,xe().N)({threadStore:d,spaceId:u.id}),v=(0,o.useCallback)((()=>{m().trackMentionMenuOpened({environment:g,from:s.analyticsFromSourceForActions,model:x,inferenceInfo:C})}),[g,s.analyticsFromSourceForActions,x,C]);return(0,ie.jsx)(G().m,{placement:"top",renderTooltip:()=>(0,ie.jsx)("div",{children:y.formatMessage(b?nr.addContextTooltipWithAgents:nr.addContextTooltip)}),render:e=>(0,ie.jsx)(Oe().A,{ariaPopupType:"menu",originGap:4,render:e=>(0,ie.jsx)(qo,{mentions:t,onChangeMentions:t=>{n(t),requestAnimationFrame((()=>{e.close(),null==p||p(!1)}))},config:l,menuType:s.adaptiveMenuType,threadStore:d,spaceStore:u,disableAgentMentions:!b}),renderOrigin:t=>(0,ie.jsxs)(Za().A,{style:S.container,disabled:r,...t,...e,testId:"unified-chat-add-context-button",children:[(0,ie.jsx)("div",{style:S.iconArea,children:(0,ie.jsx)(Re().I,{icon:er().U,size:"sm",colorVariant:"secondary"})}),(0,ie.jsx)(La().P.div,{initial:!1,animate:i?"visible":"hidden",transition:{ease:ar},variants:{visible:{width:4,transition:{duration:or}},hidden:{width:0,transition:{duration:ir}}},style:{flexShrink:0}}),(0,ie.jsx)(La().P.div,{initial:!1,animate:i?"visible":"hidden",transition:{ease:ar},variants:{visible:{opacity:1,width:"auto",transition:{duration:or}},hidden:{opacity:0,width:0,transition:{duration:ir}}},style:{overflow:"hidden"},children:(0,ie.jsx)("div",{style:S.textArea,children:(0,ie.jsx)(le().D,{styleKey:"captionRegular",colorVariant:"secondary",children:(0,ie.jsx)(h().sA,{...nr.addContextLabel})})})}),(0,ie.jsx)(La().P.div,{initial:!1,animate:i?"visible":"hidden",transition:{ease:ar},variants:{visible:{width:8,transition:{duration:or}},hidden:{width:0}},style:{flexShrink:0}})]}),popupType:s.adaptiveMenuPopupType,placementToOrigin:"bottom",alignmentToOrigin:"start",onOpen:()=>{v(),null==p||p(!0)},onClose:()=>{requestAnimationFrame((()=>{null==p||p(!1)}))},bottomSheetDisableDrag:!1,keepFocus:!1})})}var sr=()=>n(350013),lr=()=>n(582418),cr=()=>n(799288),dr=()=>n(622936);function ur(e){const{aiChatFeatureController:t,isSimplifiedInputEnabled:n,pointer:i,spaceStore:a,onRemove:r,onClick:s,isDisabled:c}=e,d=(0,h().tz)(),u=(0,cr().ut)(i.id),p=(0,l().K8)((()=>u?void 0:sr().N.createChildStore(a,i)),[a,i,u]),g=(0,l().K8)((()=>null==p?void 0:p.getRawIcon()),[p]),m=(0,l().K8)((()=>u?d.formatMessage(lr().D):null==p?void 0:p.getName()),[p,u,d]),f=(0,o.useCallback)((()=>{r(i)}),[r,i]);return(0,ie.jsx)(tr().E,{aiChatFeatureController:t,isDisabled:c,useSecondaryForeground:n,icon:p?(0,ie.jsx)(dr().AgentIcon,{agentIcon:g,workflowStore:p,size:20}):(0,ie.jsx)(dr().DefaultAgentIcon,{size:20}),text:m,onClickRemove:f,onClick:e=>{null==s||s(i,e)}})}var pr=()=>n(209969),gr=()=>n(428390);const hr={viewBox:"0 0 16 16",fittedViewBox:"3.37 2.12 12.22 11.76",svg:(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("path",{d:"M5.125 2.125a1.75 1.75 0 0 0-1.75 1.75v8.25c0 .966.784 1.75 1.75 1.75h5.75c.756 0 1.4-.479 1.644-1.15a.075.075 0 0 0-.07-.1H5.125a.5.5 0 0 1-.5-.5v-.134a1 1 0 0 1-.006-.091V7.7a1 1 0 0 1 .006-.091V3.875a.5.5 0 0 1 .5-.5h2.604v1.831c0 .929.713 1.691 1.622 1.769h3.199a.075.075 0 0 0 .075-.075v-.309c0-.464-.184-.91-.513-1.237L9.396 2.638a1.75 1.75 0 0 0-1.237-.513zm3.754 3.081V3.888l1.943 1.943H9.504a.625.625 0 0 1-.625-.625"}),(0,ie.jsx)("path",{d:"M10.606 7.76c-.38 0-.753.089-1.049.286-.304.203-.533.533-.533.955 0 .358.134.688.43.939.267.227.632.359 1.047.439l.008.001c.343.066.51.152.582.214a.2.2 0 0 1 .051.063.2.2 0 0 1 .015.09.1.1 0 0 1-.01.036.2.2 0 0 1-.066.063c-.086.057-.246.113-.476.113-.441 0-.606-.184-.642-.237a.515.515 0 1 0-.849.583c.23.335.714.684 1.491.684.38 0 .753-.09 1.048-.287.305-.203.534-.533.534-.955 0-.358-.134-.688-.43-.938-.267-.228-.632-.36-1.047-.44h-.008c-.344-.066-.51-.153-.582-.215a.2.2 0 0 1-.051-.062.2.2 0 0 1-.015-.09q-.001-.017.01-.037a.2.2 0 0 1 .066-.063c.086-.057.246-.113.475-.113.442 0 .607.185.643.237a.515.515 0 1 0 .849-.583c-.23-.335-.714-.684-1.492-.684m-2.213.271c-.54-.305-1.304-.37-1.95-.106-.693.284-1.218.935-1.218 1.95s.525 1.667 1.219 1.95c.645.264 1.41.2 1.95-.105a.515.515 0 1 0-.507-.897c-.265.149-.7.193-1.054.049a.87.87 0 0 1-.403-.321c-.105-.156-.175-.373-.175-.676 0-.302.07-.52.175-.676a.87.87 0 0 1 .403-.32c.355-.145.79-.1 1.054.048a.515.515 0 1 0 .506-.896m5.031.202a.515.515 0 0 0-.968.352l1.066 2.933a.515.515 0 0 0 .968 0l1.067-2.933a.515.515 0 0 0-.968-.352l-.583 1.602z"})]})},mr=(0,X().wt)("fileCsvSmall",hr,"small"),fr={viewBox:"0 0 16 16",fittedViewBox:"3.17 1.77 12.42 12.46",svg:(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)("path",{d:"M8.103 1.775c.484 0 .948.192 1.29.535l2.897 2.897.121.134c.266.324.414.733.414 1.156v1.278h-1.25V6.75H9.601A1.75 1.75 0 0 1 7.85 5V3.025H5a.576.576 0 0 0-.575.576v8.8l.012.116a.576.576 0 0 0 .563.459h6l.049-.005h1.684A1.83 1.83 0 0 1 11 14.226H5a1.826 1.826 0 0 1-1.815-1.64l-.01-.186V3.6c0-1.007.817-1.824 1.825-1.825zM8.95 5c0 .359.292.65.65.65h1.366L8.95 3.634z"}),(0,ie.jsx)("path",{d:"M7.007 8.56c.84 0 1.299.566 1.299 1.244 0 .672-.46 1.226-1.3 1.226H6.1v.83a.487.487 0 0 1-.483.487.487.487 0 0 1-.481-.488V9.07c0-.33.18-.51.51-.51zM6.1 10.214h.778c.257 0 .447-.162.447-.414 0-.258-.19-.426-.447-.426H6.1zm9.084-1.654a.41.41 0 0 1 .402.41.41.41 0 0 1-.402.403h-1.417v.621h1.377a.41.41 0 0 1 0 .817h-1.377v1.048a.487.487 0 0 1-.482.488.487.487 0 0 1-.482-.488V9.07c0-.33.18-.51.51-.51zm-4.881 0c1.176 0 2.021.707 2.021 1.866s-.846 1.87-2.016 1.87H9.244c-.33 0-.51-.18-.51-.51V9.07c0-.33.18-.51.51-.51zm-.606 2.896h.606c.655 0 1.036-.476 1.036-1.03 0-.577-.348-1.026-1.031-1.026h-.61z"})]})},Sr=(0,X().wt)("filePdfSmall",fr,"small");var yr=()=>n(782798);const br=(0,h().YK)({attachmentSafeTooltip:{id:"unifiedChatContextChipAttachment.attachmentSafe",defaultMessage:"File uploaded"},attachmentRiskyTooltip:{id:"unifiedChatContextChipAttachment.attachmentRisky",defaultMessage:"File may contain risky content"}});function xr(e){const{aiChatFeatureController:t,isSimplifiedInputEnabled:n,attachment:o,onDeleteStagedAttachment:i,isDisabled:a}=e;return"in_progress"===o.status?(0,ie.jsx)(tr().E,{aiChatFeatureController:t,isDisabled:a,useSecondaryForeground:n,icon:(0,ie.jsx)(Cr,{attachment:o}),text:(0,ie.jsx)(Mr,{attachment:o}),onClickRemove:void 0}):"complete"===o.status?(0,ie.jsx)(tr().E,{aiChatFeatureController:t,isDisabled:a,useSecondaryForeground:n,icon:(0,ie.jsx)(Cr,{attachment:o}),text:(0,ie.jsx)(Mr,{attachment:o}),onClickRemove:()=>i(o.fileUrl)}):void(0,T().HB)(o)}function Cr(e){const{attachment:t}=e,n=(0,c().IS)((()=>({riskyIcon:{fill:Q().Tj.red.text.accentPrimary}})),[]);return"in_progress"===t.status?(0,ie.jsxs)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",children:[(0,ie.jsx)(La().P.circle,{cx:"12",cy:"12",r:"10",fill:"none",stroke:"#e0e0e0",strokeWidth:"2"}),(0,ie.jsx)(La().P.circle,{cx:"12",cy:"12",r:"10",fill:"none",stroke:Q().Tj.blue.icon.accentPrimary,strokeWidth:"2",strokeLinecap:"round",initial:{pathLength:0},animate:{pathLength:t.uploadPercentage/100},transition:{duration:.5,ease:"easeInOut"},style:{rotate:-90,transformOrigin:"center"}})]}):"risky"===t.attachmentRisk?(0,ie.jsx)(G().m,{placement:"top",renderTooltip:()=>(0,ie.jsx)(h().sA,{...br.attachmentRiskyTooltip}),render:e=>(0,ie.jsx)("span",{...e,children:(0,ie.jsx)(Re().I,{icon:gr().exclamationMarkCircleFillIcon,style:n.riskyIcon})})}):(0,ie.jsx)(vr,{contentType:t.contentType})}function vr(e){const{contentType:t}=e,n=(0,c().IS)((()=>({safeIcon:{fill:Q().Tj.blue.icon.accentPrimary}})),[]);let o;o="application/pdf"===t?Sr:"text/csv"===t?mr:yr().R;const i={delay:1.3,duration:.3,ease:"easeInOut"};return(0,ie.jsxs)(ie.Fragment,{children:[(0,ie.jsx)(La().P.div,{initial:{opacity:1},animate:{opacity:0},transition:i,style:{position:"absolute"},children:(0,ie.jsx)(G().m,{placement:"top",renderTooltip:()=>(0,ie.jsx)(h().sA,{...br.attachmentSafeTooltip}),render:e=>(0,ie.jsx)("span",{...e,children:(0,ie.jsx)(Re().I,{icon:pr().checkmarkCircleFillIcon,style:n.safeIcon})})})}),(0,ie.jsx)(La().P.div,{initial:{opacity:0},animate:{opacity:1},transition:i,style:{position:"absolute"},children:(0,ie.jsx)(Re().I,{icon:o,colorVariant:"secondary",size:"sm"})})]})}function Mr(e){const{attachment:t}=e;return"in_progress"===t.status?(0,ie.jsx)(It().N,{text:t.fileName,animate:!0,colorVariant:"secondary",textOverflow:"ellipsis"}):"complete"===t.status?(0,ie.jsx)("span",{children:t.fileName}):void(0,T().HB)(t)}function kr(e){const{aiChatFeatureController:t,isSimplifiedInputEnabled:n,pointer:i,spaceStore:a,onRemove:r,onClick:s,isDisabled:c}=e,d=(0,o.useMemo)((()=>Ha().B.createChildStore(a,i)),[a,i]),u=(0,l().K8)((()=>{if(!d)return;return{icon:d.getIcon(),iconRecordCategory:(0,tn().Te)(d)}}),[d]),p=(0,o.useCallback)((()=>{r(i)}),[r,i]);return(0,ie.jsx)(tr().E,{aiChatFeatureController:t,isDisabled:c,useSecondaryForeground:n,icon:u?(0,ie.jsx)(tn().B6,{disabled:!0,icon:u.icon,isEmptyPage:!1,size:16,iconRecordCategory:u.iconRecordCategory}):null,text:(0,ie.jsx)(on().A,{store:d}),onClickRemove:p,onClick:e=>{null==s||s(i,e)}})}var jr=()=>n(15857),Ir=()=>n(431404);function wr(e){const{aiChatFeatureController:t,isSimplifiedInputEnabled:n,selectedBlocks:i,onRemove:a,onClick:r,isDisabled:s}=e,d=(0,c().IS)((()=>({container:{display:"flex",alignItems:"center",minWidth:0},ellipsisText:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",minWidth:0,flexShrink:1},additionalBlocksCount:{opacity:.5,marginInlineStart:4,flexShrink:0}})),[]),u=(0,o.useMemo)((()=>i.length>0?i[0]:void 0),[i]),p=i.length-1,g=(0,l().K8)((()=>{if(u)return function(e){const t=e.getType();if(!t)return;const n=(0,Ir().Z)(t);if(!n)return;return(0,ie.jsx)(h().sA,{...n})}(u)}),[u]);return u?(0,ie.jsx)(tr().E,{aiChatFeatureController:t,isDisabled:s,useSecondaryForeground:n,icon:(0,ie.jsx)(Re().I,{icon:jr().a,size:"sm",colorVariant:n?"secondary":void 0}),text:(0,ie.jsxs)("div",{style:d.container,children:[(0,ie.jsx)("span",{style:d.ellipsisText,children:(0,ie.jsx)(on().A,{store:u,shouldWrap:!0,placeholder:g})}),p>0?(0,ie.jsx)("span",{style:d.additionalBlocksCount,children:(0,ie.jsx)(h().sA,{id:"unifiedChatContextChipSelectedBlocks.additionalBlocksCount",defaultMessage:"+{count}",values:{count:p}})}):null]}),onClickRemove:a,onClick:r}):null}var Ar=()=>n(755125),Tr=()=>n(453607),Pr=()=>n(460957),Fr=()=>n(836724);function _r(e){const{aiChatFeatureController:t,isDisabled:n,isSimplifiedInputEnabled:i,textSelection:r}=e,s=(0,a().v3)(),c=(0,l().K8)((()=>(0,Pr().E)({mode:"editing",multiSelection:r,forceExtendAnnotations:{}})),[r]).trim(),d=(0,o.useCallback)((()=>{S().globalChatPanelRuntimeStore.state.completionContext?S().globalChatPanelRuntimeStore.update((e=>({...e,completionContext:void 0}))):(0,Ar().clear)({environment:s})}),[s]),u=(0,o.useCallback)((()=>{const e=r.start.store.id,t=Fr().T.findScrollToSelectablesFromIds([e]).at(0);t&&(0,Tr().p)({environment:s,handle:t,vertical:{reveal:"top"},horizontal:{reveal:"closest"},animate:!0})}),[s,r]);return c?(0,ie.jsx)(tr().E,{aiChatFeatureController:t,isDisabled:n,useSecondaryForeground:i,icon:(0,ie.jsx)(Re().I,{icon:jr().a,size:"sm",colorVariant:i?"secondary":void 0}),text:(0,ie.jsx)("span",{children:c}),onClick:n?void 0:u,onClickRemove:n?void 0:d}):null}var Er=()=>n(849255);function Dr(e){const{aiChatFeatureController:t,isSimplifiedInputEnabled:n,pointer:i,spaceStore:a,onRemove:r,onClick:s,isDisabled:c}=e,d=(0,h().tz)(),u=(0,l().K8)((()=>Er().L.createChildStore(a,i)),[a,i]),p=(0,l().K8)((()=>{var e;return null===(e=u.getModel())||void 0===e?void 0:e.getFullName(d)}),[u,d]),g=(0,o.useCallback)((()=>{r(i)}),[r,i]);return(0,ie.jsx)(tr().E,{aiChatFeatureController:t,isDisabled:c,useSecondaryForeground:n,icon:(0,ie.jsx)(Kt().A,{userStore:u,size:16}),text:(0,ie.jsx)("span",{children:p}),onClickRemove:g,onClick:e=>{null==s||s(i,e)}})}function Br(e){const{navigate:t}=(0,o.useContext)(Wi().E),{aiChatFeatureController:n,attachments:i,config:r,inputMode:s,mentions:l,currentPageInContext:d,onChangeMentions:g,onDeleteStagedAttachment:h,isSimplifiedInputEnabled:m,onRemoveMentionChip:f,onRemoveSelectedBlocks:S,onClickSelectedBlocks:y,selectedBlocks:b=[],spaceStore:x,pageVisitSource:C=p().y8.NewAiChatInput,multiTextSelection:v,isAddContextMenuOpen:M,isAddContextMenuRecentlyClosed:k,onAddContextMenuOpenChange:j,forceFocusWhenContextPresent:I,persistContextVisibility:w=!1}=e,A=n.isChatCompletelyDisabled(s),P=n.supportsUserSpecifiedContext(r.type),F=!m&&!A&&P,_=(0,a().v3)(),E=(0,Ja().useThreadStoreFromCurrentRoute)(),D=(0,c().IS)((()=>({container:{flexWrap:"wrap",gap:"6px 4px",pointerEvents:"none"}})),[]),B=(0,o.useCallback)((e=>{A||f(e)}),[f,A]),R=(0,o.useCallback)((()=>{A||null==S||S()}),[S,A]),N=(0,o.useCallback)(((e,n)=>{if(A)return;const o=(0,Wa().V)(n),i=e.table;switch(i){case Eo().ev:const n=Ha().B.createChildStore(x,e);(0,Qa().Y)({store:n,environment:_,pageVisitSource:C,openInNew:o,chatThreadId:null==E?void 0:E.id});break;case Do().oo:const a=e.id,r=x.id,s=_.idCreator.getSpaceIdCreatorSync(r),l=(0,Xa().o4)({userId:a,spaceIdCreator:s,pageVisitSource:C});l&&t({environment:_,url:l,openInNew:o});break;case $a().C0:const c=(0,Ga().L)({pageVisitSource:C,workflowId:e.id,params:{}});c&&t({environment:_,url:c,openInNew:o});break;default:(0,T().HB)(i)}}),[_,x,C,A,E,t]),z=P&&l.size()>0,U=m?[]:i,K=U.length>0,O=void 0!==v&&!(0,qa().k)(v),L="none"===n.selectionContextInsertionMode,V=L&&(O||b.length>0),W=0===l.size()&&!K&&!V,H=void 0!==I?I:n.showUserContextOnlyWhenFocused,q=z||K||V,Y=(w||!H||Boolean(e.focusWithin||M||k))&&(q||F);return(0,ie.jsx)(La().P.div,{initial:!1,animate:Y?"visible":"hidden",variants:{visible:{height:"auto",opacity:1,transition:{height:{type:"spring",duration:.25,bounce:0},opacity:{duration:.1,delay:.1}}},hidden:{height:0,opacity:0,transition:{height:{type:"spring",duration:.25,bounce:0,delay:.05},opacity:{duration:.1}}}},style:{pointerEvents:Y?"auto":"none"},children:(0,ie.jsx)("div",{children:(0,ie.jsx)(u().Y1,{direction:"horizontal",style:D.container,align:"center-left",padding:n.shouldRenderHeadless?void 0:"10px 10px 0",width:"fill",children:(0,ie.jsxs)(Va().N,{children:[F?(0,ie.jsx)(La().P.div,{initial:!1,animate:"visible",exit:"hidden",variants:{visible:{opacity:1,filter:"blur(0px)",width:"auto"},hidden:{opacity:0,filter:"blur(2px)",width:U.length>0?0:"auto"}},transition:{duration:.15},children:(0,ie.jsx)(rr,{mentions:l,onChangeMentions:g,showLabel:W,isDisabled:!F,aiChatFeatureController:n,config:r,threadStore:e.threadStore,onMenuOpenChange:j,spaceStore:x})},"addContext"):null,P?Array.from(l).map((e=>{switch(e.table){case Do().oo:return(0,ie.jsx)(Dr,{aiChatFeatureController:n,isDisabled:A,isSimplifiedInputEnabled:m,pointer:e,spaceStore:x,onRemove:B,onClick:N},Ya().L3.toKey(e));case Eo().ev:return(0,ie.jsx)(kr,{aiChatFeatureController:n,isDisabled:A,isSimplifiedInputEnabled:m,pointer:e,spaceStore:x,onRemove:B,onClick:N},Ya().L3.toKey(e));case $a().C0:return(0,ie.jsx)(ur,{aiChatFeatureController:n,onClick:N,isDisabled:A,isSimplifiedInputEnabled:m,pointer:e,spaceStore:x,onRemove:B},Ya().L3.toKey(e));default:return(0,T().HB)(e)}})):void 0,P&&L&&b.length>0?(0,ie.jsx)(wr,{aiChatFeatureController:n,isDisabled:A,isSimplifiedInputEnabled:m,selectedBlocks:b,onRemove:R,onClick:y}):void 0,P&&L&&O?(0,ie.jsx)(_r,{aiChatFeatureController:n,isDisabled:A,isSimplifiedInputEnabled:m,textSelection:v}):void 0,U.map(((e,t)=>(0,ie.jsx)(xr,{aiChatFeatureController:n,isDisabled:A,isSimplifiedInputEnabled:m,attachment:e,onDeleteStagedAttachment:h},t)))]})})})})}function Rr(e){const{aiChatFeatureController:t,attachments:A,clientStore:T,currentPageInContext:P,mentions:F,nextConfig:_,onChangeMentions:E,onChangeNextConfig:D,onDeleteStagedAttachment:B,onEsc:R,onStartTyping:N,onRemoveMentionChip:z,onStopInference:K,onSubmit:O,onTextChange:L,pageVisitSource:V,spaceStore:W,textStore:Y,disabled:$,threadStore:G,errorState:J,onClearError:X,placeholder:Q,ignoreKeyboardMode:Z,selectedBlockStores:ee=[],multiTextSelection:te,isSimplifiedInputEnabled:ne=!1,inputMode:oe,threadMode:ae,upsellMessage:re,upgradeButtonTextProps:se,isUpgradeSystemEnabled:le,onStartRecording:ce,onStopRecording:de,hidePeekFace:ue}=e,pe=(0,h().tz)(),ge=(0,a().v3)(),he=(0,l().O$)(i().AppStoreMainEditorCurrentBlockStore),[me,fe]=(0,r().A)(),Se=(0,o.useRef)(null),ye=t.isChatCompletelyDisabled(oe),be=(0,c().IS)((()=>{const e=t.shouldUseCompactSubmitButton,n=t.isSingleLineInput;return{inlineSendButton:{position:"absolute",bottom:e?0:n?6:8,insetInlineEnd:e?0:8}}}),[t]),[xe,Ce]=(0,o.useState)(!1),[ve,Me]=(0,o.useState)(!1),[ke,je]=(0,o.useState)(!1),Ie=(0,y().Q7)({textStore:Y,initialFocus:t.shouldHaveInitialFocusOnInput}),we=F.size(),Ae=A.length,Te=ee.length,Pe=void 0!==te,Fe=ne&&Ae>0;(0,o.useEffect)((()=>{(fe||we>0||Ae>0||!ne&&(Te>0||Pe))&&je(!0)}),[ne,fe,we,Ae,Te,Pe]);const Ee=(0,o.useRef)(void 0),De=(0,o.useCallback)((e=>{if(e)return Ce(!0),Me(!1),void(Ee.current&&(window.clearTimeout(Ee.current),Ee.current=void 0));Ce(!1),Me(!0),Ee.current=window.setTimeout((()=>{Me(!1),Ee.current=void 0}),200)}),[]);(0,o.useEffect)((()=>()=>{Ee.current&&window.clearTimeout(Ee.current)}),[]);const Be=(0,f().AD)(),Re=(0,l().K8)((()=>Be.getOrCreateThreadId({environment:ge,spaceId:W.id,maybeThreadStore:G})),[ge,W.id,Be,G]),Ne=(0,l().K8)((()=>T.getOrCreateClientAIChatThreadStore(Re)),[T,Re]),ze=(0,l().K8)((()=>null==Ne?void 0:Ne.getStagedAttachmentUploadStoreIfExists()),[Ne]),{variant:Ue}=(0,M().V)(),{variant:Ke}=(0,C().n)(),{variant:Oe}=(0,v().C)(),Le=H({configType:_.type,spaceId:W.id}),Ve=(0,o.useCallback)((()=>{(0,x().D)({stores:[]})}),[]),We=(0,o.useCallback)((()=>{if(0===ee.length)return;const e=ee.map((e=>e.pointer));(0,w().e)({environment:ge,spaceStore:W,blockPointers:e,currentPageId:null==he?void 0:he.id,pageVisitSource:V??p().y8.NewAiChatInput,chatThreadId:null==G?void 0:G.id})}),[ge,he,V,ee,W,G]),He=(0,q().q)({threadStore:G,clientAiChatStore:T,aiChatFeatureController:t,config:_}),qe=(0,o.useCallback)((e=>{const t=F.size();E(e),e.size()>t&&je(!0)}),[F,E]),Ye=(0,o.useCallback)((e=>{switch(oe){case"runningInference":K({userAction:"AgentChatTranscript.StopInference.keyboardInterrupt"});break;case"recording":de();break;default:null==R||R(e)}}),[K,oe,de,R]),$e=(0,o.useCallback)((async({shouldRefocus:e,submitFrom:n})=>{const o=Y.getValue();await O({prompt:o,config:_,submitFrom:n}),e&&requestAnimationFrame((()=>{if(t.supportsClearSelectionOnSubmit)Ie.blur();else{const e=b().n.findNodeFromStore(Y);e&&e.focus()}})),Ue&&"control"!==Ue&&j().$.setState({...j().$.state,shouldRenderTextPrompt:!1}),Ke&&"control"!==Ke&&I()._.setState({...I()._.state,shouldRenderTextPrompt:!1}),Oe&&"control"!==Oe&&k().Y.setState({...k().Y.state,shouldRenderTextPrompt:!1})}),[Y,O,_,t.supportsClearSelectionOnSubmit,Ie,Ue,Ke,Oe]),Ge=(0,o.useCallback)((async()=>{await $e({shouldRefocus:!0})}),[$e]),Je=t.canUseSendDestinationShortcuts({inputMode:oe,threadMode:ae}),Xe="slippery_slope"===t.aiChatType,Qe=(0,o.useCallback)((async e=>{await $e({shouldRefocus:!0,submitFrom:e})}),[$e]),Ze=(0,o.useCallback)((e=>{Xe&&("function"==typeof e.preventDefault&&e.preventDefault(),"stopPropagation"in e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),Qe("command+enter"))}),[Qe,Xe]),et=(0,o.useCallback)((e=>{Je&&("function"==typeof e.preventDefault&&e.preventDefault(),"stopPropagation"in e&&"function"==typeof e.stopPropagation&&e.stopPropagation(),Qe("command+alt+enter"))}),[Je,Qe]),tt=(0,l().K8)((()=>Q||U({config:_,threadStore:G,intl:pe,aiChatFeatureController:t,isSimplifiedInputEnabled:ne})),[Q,G,pe,_,t,ne]),nt=t.shouldShowInlineSubmit,ot=Ie.focus;(0,o.useEffect)((()=>{if(t.shouldHaveInitialFocusOnInput){if(t.shouldHaveDelayedFocusOnInput){const e=setTimeout((()=>{ot()}),300);return()=>clearTimeout(e)}requestAnimationFrame((()=>{ot()}))}}),[G,ot,t.shouldHaveInitialFocusOnInput,t.shouldHaveDelayedFocusOnInput]),function(e){const{focus:t}=e,n=(0,o.useRef)(void 0),i=(0,l().K8)((()=>S().globalChatPanelRuntimeStore.state.focusRequest),[]);(0,o.useEffect)((()=>{i&&i.id!==n.current&&(n.current=i.id,requestAnimationFrame((()=>{t()})),S().globalChatPanelRuntimeStore.update((e=>{var t;return(null===(t=e.focusRequest)||void 0===t?void 0:t.id)!==i.id?e:{...e,focusRequest:void 0}})))}),[i,t])}({focus:ot});!function(e){const{containerRef:t,blur:n,textStoreId:i}=e;(0,o.useEffect)((()=>{const e=e=>{const o=e.target;if(!(o&&o instanceof Node))return;if(o instanceof Element){if(o.closest('[data-testid="popup-overlay"]'))return;let e=o;for(;e;){const t=e.parentElement;if(t){if(t.querySelector('[data-testid="popup-overlay"]'))return}e=t}if(o.closest('[role="dialog"]'))return}const a=t.current;if(!a)return;const r=d().default.state;if("empty"===r.mode)return;r.multiSelection.start.store.id===i&&(a.contains(o)||n())};return document.addEventListener("mousedown",e,!0),()=>{document.removeEventListener("mousedown",e,!0)}}),[n,i,t])}({containerRef:Se,blur:Ie.blur,textStoreId:Y.id}),(0,o.useEffect)((()=>{const e=S().globalChatPanelRuntimeStore.state.agentTimeToRenderMetric,t=S().globalChatPanelRuntimeStore.state.openSource;e&&t&&(e.endTime=performance.now(),requestAnimationFrame((()=>{Promise.resolve().then(n.bind(n,944584)).then((({trackAgentTimeToRender:n})=>{n({environment:ge,metric:e,from:t,threadStore:G}),S().globalChatPanelRuntimeStore.setState({...S().globalChatPanelRuntimeStore.state,agentTimeToRenderMetric:void 0,openSource:void 0})}))})))}),[ge,G]);const it=(0,o.useRef)(!0),at=(0,o.useRef)(!1),rt=Array.from(F).at(-1),st=(0,o.useCallback)((e=>{J.isError&&X();const t=Y.getValue();null==L||L(t);e&&"keydown"===e.type&&"Backspace"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey&&rt&&it.current&&z(rt);const n=(0,g().w9s)(t);at.current||n||(null==N||N(),at.current=!0),it.current=n}),[J.isError,Y,L,X,N,z,rt]),lt=(0,o.useCallback)((()=>{if(!ze)return;const e=[],t=new Set;for(const n of A)"complete"===n.status&&"risky"===n.attachmentRisk&&(e.push(n.fileUrl),t.add(n.contentType));0!==e.length&&(ze.markUploadedFilesAsSafe(e),m().trackAgentUserActionOnRiskyAttachments({environment:ge,action:"allow",numFiles:e.length,fileTypes:Array.from(t)}))}),[ze,A,ge]),ct=(0,o.useCallback)((()=>{let e=0;const t=new Set;A.forEach((n=>{"complete"===n.status&&"risky"===n.attachmentRisk&&(B(n.fileUrl),e+=1,t.add(n.contentType))})),m().trackAgentUserActionOnRiskyAttachments({environment:ge,action:"remove",numFiles:e,fileTypes:Array.from(t)})}),[A,B,ge]),dt=(0,s().A)(me,Se);return(0,ie.jsx)(u().Y1,{ref:dt,direction:"vertical",width:"fill",style:{minWidth:0,position:"relative"},children:(0,ie.jsxs)(u().Y1,{direction:"vertical",width:"fill",children:[Ji({inputMode:oe,aiChatFeatureController:t,aiConnectorIncident:Le})?(0,ie.jsx)(Xi,{upsellMessage:re,upgradeButtonTextProps:se,isUpgradeSystemEnabled:le,inputMode:oe,errorMessage:J.isError?J.message:void 0,onErrorDismiss:J.isError?X:void 0,aiChatFeatureController:t,aiConnectorIncident:Le}):"filesRequireConfirmation"===oe?(0,ie.jsx)(Oa,{attachments:A,onAllowUploads:lt,onRemoveFiles:ct}):null,!Boolean(ue)&&t.shouldShowPeekingFace?(0,ie.jsx)(Ra,{aiChatFeatureController:t}):null,(0,ie.jsxs)(Zi,{aiChatFeatureController:t,inputMode:oe,loadAttachmentData:He,onEsc:Ye,textStoreFocus:Ie,threadStore:G,children:[Fe?(0,ie.jsx)(Ia,{attachments:A,onDeleteStagedAttachment:B,threadId:(null==G?void 0:G.id)??Re,spaceId:W.id,isDisabled:ye}):null,(0,ie.jsx)(Br,{aiChatFeatureController:t,attachments:A,config:_,inputMode:oe,isSimplifiedInputEnabled:ne,mentions:F,currentPageInContext:P,onChangeMentions:qe,onDeleteStagedAttachment:B,onRemoveMentionChip:z,onRemoveSelectedBlocks:Ve,onClickSelectedBlocks:We,selectedBlocks:ee,spaceStore:W,threadStore:G,pageVisitSource:V,focusWithin:fe,isAddContextMenuOpen:xe,isAddContextMenuRecentlyClosed:ve,onAddContextMenuOpenChange:De,persistContextVisibility:ke,multiTextSelection:te}),(0,ie.jsx)(ga,{aiChatFeatureController:t,inputMode:oe,loadAttachmentData:He,onEsc:Ye,onSubmit:Ge,onCommandEnter:Xe?Ze:void 0,onCommandAltEnter:Je?et:void 0,placeholder:tt,textStore:Y,textStoreFocus:Ie,onTextChange:st,ignoreKeyboardMode:Z,alignWithSimplifiedActions:ne}),nt&&"recording"!==oe?(0,ie.jsx)("div",{style:be.inlineSendButton,children:(0,ie.jsx)(_e,{aiChatFeatureController:t,inputMode:oe,onSubmit:Ge})}):(0,ie.jsx)(Ei,{aiChatFeatureController:t,clientStore:T,config:_,inputMode:oe,threadMode:ae,loadAttachmentData:He,onChangeNextConfig:D,onStartRecording:ce,onStopInference:K,onStopRecording:de,onSubmit:Qe,spaceStore:W,threadStore:G,disabled:$,mentions:F,onChangeMentions:qe,onAddContextMenuOpenChange:De,sourcePickerProps:{aiChatFeatureController:t,clientStore:T,config:_,inputMode:oe,onChangeNextConfig:D,spaceStore:W,threadStore:G,isSimplifiedInputEnabled:ne},isSimplifiedInputEnabled:ne})]}),t.supportsConnectorsBanner?(0,ie.jsx)(Vi,{aiChatFeatureController:t,inputMode:oe}):null]})})}},248681:(e,t,n)=>{n.d(t,{T:()=>i});const o="ShowMentionInvite";function i(e){return`${o}-${e}`}},258522:(e,t,n)=>{n.d(t,{q:()=>a});n(296540);var o=n(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 15.25 11.75",directional:!0,svg:(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("path",{d:"M11.93 9.125a.5.5 0 0 0-.5.5v3.75a.5.5 0 0 0 .5.5h3.145a.5.5 0 0 0 .5-.5v-3.75a.5.5 0 0 0-.5-.5z"}),(0,o.jsx)("path",{d:"M4.5 4.125A2.125 2.125 0 0 0 2.375 6.25v7.5c0 1.174.951 2.125 2.125 2.125h11a2.125 2.125 0 0 0 2.125-2.125v-7.5A2.125 2.125 0 0 0 15.5 4.125zM3.625 6.25c0-.483.392-.875.875-.875h11c.483 0 .875.392.875.875v7.5a.875.875 0 0 1-.875.875h-11a.875.875 0 0 1-.875-.875z"})]})},a=(0,n(340498).wt)("peekCorner",i,"default")},269516:(e,t,n)=>{function o(){return 330}n.d(t,{W:()=>o})},270511:(e,t,n)=>{n.d(t,{A:()=>o});const o=function(e){return!!n(726637).A.isMobile||e.WindowSizeStore.state.width<960}},297173:(e,t,n)=>{n.r(t),n.d(t,{exclamationMarkCircleFillSmallIcon:()=>i,iconDefinition:()=>o});n(296540);const o={viewBox:"0 0 16 16",fittedViewBox:"1.95 1.94 12.11 12.1",svg:(0,n(474848).jsx)("path",{d:"M8 1.95a6.05 6.05 0 1 0 0 12.1 6.05 6.05 0 0 0 0-12.1m-.1 3a.55.55 0 0 1 .55.55V8a.55.55 0 0 1-1.1 0V5.5a.55.55 0 0 1 .55-.55m0 6a.65.65 0 1 1 0-1.3.65.65 0 0 1 0 1.3"})},i=(0,n(340498).wt)("exclamationMarkCircleFillSmall",o,"fillSmall")},343601:(e,t,n)=>{n.d(t,{G:()=>o});const o=(0,n(340498).xh)("aiFace",{default:{loader:()=>n.e(89256).then(n.bind(n,529099))},small:{loader:()=>n.e(89256).then(n.bind(n,412237))},fill:{loader:()=>n.e(89256).then(n.bind(n,769607))},fillSmall:{loader:()=>n.e(89256).then(n.bind(n,9918))}},["ai","artificial","intelligence","sparkle","technology","nosy"])},380801:(e,t,n)=>{n.d(t,{DP:()=>U,Xg:()=>V,w3:()=>L,xX:()=>z,yU:()=>K});n(944114),n(898992),n(581454),n(737550);var o=n(296540),i=()=>n(564884),a=()=>n(920198),r=()=>n(907258),s=()=>n(242422),l=()=>n(726637),c=()=>n(484714),d=()=>n(590526),u=()=>n(401497),p=()=>n(695115),g=()=>n(265060),h=()=>n(160432),m=()=>n(493552),f=()=>n(203717),S=()=>n(995847),y=()=>n(69708),b=()=>n(100622),x=()=>n(209660),C=()=>n(987267),v=()=>n(576590),M=()=>n(399613),k=()=>n(170139),j=()=>n(655600),I=()=>n(311546),w=()=>n(272286),A=()=>n(102271),T=()=>n(751699),P=()=>n(610083),F=()=>n(604018),_=()=>n(176983),E=()=>n(217714),D=()=>n(244828),B=()=>n(476488),R=n(474848);function N(e,t){if(!t)return!1;const n=t.getSettings(),o=U(e);return!!o&&Boolean(null==n?void 0:n[o])}function z(){const e=s().default.getConfigKey("ai_connectors_down","connectors");return Array.isArray(e)?e:[]}function U(e){switch(e){case"slack_re_auth":return"dismissed_slack_personal_auth_prompt";case"github_re_auth":return"dismissed_github_personal_auth_prompt";case"jira_connection_pending":return"dismissed_jira_installation_pending_prompt";case"jira_connect_user":return"dismissed_jira_user_auth_prompt";case"jira_select_projects":return"dismissed_jira_select_projects_prompt";case"jira_migrate":return"dismissed_jira_migrate_prompt";case"slack_migrate":return"dismissed_slack_migrate_prompt";case"linear_re_auth":return"dismissed_linear_personal_auth_prompt";case"salesforce_re_auth":return"dismissed_salesforce_personal_auth_prompt";case"slack_v2_user_connection":return"dismissed_slack_v2_user_connection_prompt";case"asana_select_workspace":return"dismissed_asana_select_workspace_prompt";default:return null}}function K(e,t,n,o){if(o)switch(t.type){case"slack_select_channels":T().nh();break;case"sharepoint_select_sites":A().o();break;case"microsoft_teams_select_teams":A().v();break;case"slack_re_auth":(0,M().t)({connector:"slack",environment:n,spaceId:o,analyticsProperties:{buttonName:"connect_slack_user_mapping_agent"}});break;case"slack_v2_user_connection":T().JR({environment:n,spaceId:o});break;case"github_re_auth":(0,M().t)({connector:"github",environment:n,spaceId:o,analyticsProperties:{buttonName:"connect_github_user_mapping_agent"}});break;case"linear_re_auth":(0,M().t)({connector:"linear",environment:n,spaceId:o,analyticsProperties:{buttonName:"connect_linear_user_mapping_agent"}});break;case"jira_connection_pending":(0,v().navigateToAIConnectorOnboarding)({connector:"jira",analyticsFrom:"chat_menu",sessionId:w().yg.state.sessionId});break;case"google_drive_connection_pending":(0,v().navigateToAIConnectorOnboarding)({connector:"google-drive",analyticsFrom:"chat_menu",sessionId:E().d.state.sessionId});break;case"jira_connect_user":I().ol({environment:n,spaceId:o,analyticsProperties:{buttonName:"user_auth_connect_agent",analyticsFrom:"chat_menu",sessionId:w().yg.state.sessionId}});break;case"jira_select_projects":I().G({analyticsFrom:"chat_menu",screenToShow:"connection_complete_screen"});break;case"jira_migrate":(0,v().navigateToAIConnectorOnboarding)({connector:"jira",analyticsFrom:"chat_menu"});break;case"slack_migrate":T().FM({environment:n,spaceId:o});break;case"asana_select_workspace":k().g()}}function O({icon:e,title:t,subtitle:n,buttonText:o,onAction:i,onDismiss:a,isSingleConnector:r=!0,showDismissIcon:s=!0}){const l=(0,y().tz)(),c=(0,u().eP)(),d=(0,u().IS)((()=>({container:{boxSizing:"border-box",display:"flex",flexDirection:r?"row":"column",alignItems:"flex-start",padding:12,gap:8,width:"100%",marginBottom:8,background:"dark"===c?b().Tj.background.secondary:b().Tj.background.primary,boxShadow:`0px 0px 0px 1px ${b().Tj.border.secondary}, 0px 3px 8px rgba(0, 0, 0, 0.04)`,borderRadius:16,position:"relative"},iconContainer:{display:"flex",alignItems:"center",flexShrink:0},contentWithButton:{flex:1,display:"flex",flexDirection:"column",gap:8},content:{flex:1,display:"flex",flexDirection:"column"},closeButton:{position:"absolute",top:8,insetInlineEnd:8,borderRadius:"50%"},closeButtonIcon:{fill:b().Tj.icon.secondary},buttonContainer:{display:"flex",width:"100%"}})),[r,c]);return(0,R.jsxs)("div",{style:d.container,children:[(0,R.jsx)("div",{style:d.iconContainer,children:e}),(0,R.jsxs)("div",{style:d.contentWithButton,children:[(0,R.jsxs)("div",{style:d.content,children:[(0,R.jsx)(m().D,{styleKey:"bodyMedium",colorVariant:"primary",children:t}),(0,R.jsx)(m().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:n})]}),(0,R.jsx)("div",{style:d.buttonContainer,children:(0,R.jsx)(h().A,{colorPalette:"blue",onClick:i,children:o})})]}),s?(0,R.jsx)(p().A,{style:d.closeButton,icon:S().xMarkSmallIcon,iconStyle:d.closeButtonIcon,onClick:a,ariaLabel:l.formatMessage({id:"agentConnectionStatus.dismissAriaLabel",defaultMessage:"Dismiss"})}):void 0]})}function L(e,t){switch(t){case"slack_migrate":return{title:(0,R.jsx)(y().sA,{id:"agentSlackStatus.migrateTitle",defaultMessage:"Connect Private Channels and Messages"}),subtitle:(0,R.jsx)(y().sA,{id:"agentSlackStatus.migrateSubtitle",defaultMessage:"Update the Slack AI Connector to enable answers from private channels and messages for your workspace. Every user must authenticate."}),buttonText:(0,R.jsx)(y().sA,{id:"agentSlackStatus.migrateButton",defaultMessage:"Update"}),isDismissible:!0};case"jira_migrate":return{title:(0,R.jsx)(y().sA,{id:"agentJiraStatus.migrateTitle",defaultMessage:"Update Jira AI connector"}),subtitle:(0,R.jsx)(y().sA,{id:"agentJiraStatus.migrateSubtitle",defaultMessage:"Update to the latest Jira connector to continue getting Jira answers in Notion AI"}),buttonText:(0,R.jsx)(y().sA,{id:"agentJiraStatus.migrateButton",defaultMessage:"Update"})};case"microsoft_teams_select_teams":return{title:(0,R.jsx)(y().sA,{id:"agentMicrosoftTeamsStatus.selectTeamsTitle",defaultMessage:"No Microsoft Teams Team selected"}),subtitle:(0,R.jsx)(y().sA,{id:"agentMicrosoftTeamsStatus.selectTeamsSubtitle",defaultMessage:"Finish your setup to get answers from Microsoft Teams"}),buttonText:(0,R.jsx)(y().sA,{id:"agentMicrosoftTeamsStatus.selectTeamsButton",defaultMessage:"Select Teams"})};case"jira_select_projects":return{title:(0,R.jsx)(y().sA,{id:"agentJiraStatus.selectProjectsTitle",defaultMessage:"Select Jira projects"}),subtitle:(0,R.jsx)(y().sA,{id:"agentJiraStatus.selectProjectsSubtitle",defaultMessage:"Choose which Jira projects to sync with Notion AI"}),buttonText:(0,R.jsx)(y().sA,{id:"agentJiraStatus.selectProjectsButton",defaultMessage:"Select projects"})};case"jira_connection_pending":return{title:(0,R.jsx)(y().sA,{id:"agentJiraStatus.pendingTitle",defaultMessage:"Complete Jira setup"}),subtitle:(0,R.jsx)(y().sA,{id:"agentJiraStatus.pendingSubtitle",defaultMessage:"Jira installation is pending. Complete setup to use Jira with Notion AI"}),buttonText:(0,R.jsx)(y().sA,{id:"agentJiraStatus.pendingButton",defaultMessage:"Continue setup"})};case"jira_connect_user":return{title:(0,R.jsx)(y().sA,{id:"agentJiraStatus.connectUserTitle",defaultMessage:"Connect your Jira account"}),subtitle:(0,R.jsx)(y().sA,{id:"agentJiraStatus.connectUserSubtitle",defaultMessage:"Link your personal Jira account to access your issues in Notion AI"}),buttonText:(0,R.jsx)(y().sA,{id:"agentJiraStatus.connectUserButton",defaultMessage:"Connect account"})};case"google_drive_connection_pending":return{title:(0,R.jsx)(y().sA,{id:"agentGoogleDriveStatus.pendingTitle",defaultMessage:"Complete Google Drive setup"}),subtitle:(0,R.jsx)(y().sA,{id:"agentGoogleDriveStatus.pendingSubtitle",defaultMessage:"Google Drive installation is pending. Complete setup to use Google Drive with Notion AI"}),buttonText:(0,R.jsx)(y().sA,{id:"agentGoogleDriveStatus.pendingButton",defaultMessage:"Continue setup"})};case"slack_select_channels":return{title:(0,R.jsx)(y().sA,{id:"agentSlackStatus.selectChannelsTitle",defaultMessage:"No Slack channels selected"}),subtitle:(0,R.jsx)(y().sA,{id:"agentSlackStatus.selectChannelsSubtitle",defaultMessage:"Finish your setup to get answers from Slack"}),buttonText:(0,R.jsx)(y().sA,{id:"agentSlackStatus.selectChannelsButton",defaultMessage:"Select channels"})};case"slack_v2_user_connection":return{title:(0,R.jsx)(y().sA,{id:"agentSlackStatus.v2UserConnectionTitle",defaultMessage:"Log in to Slack"}),subtitle:(0,R.jsx)(y().sA,{id:"agentSlackStatus.v2UserConnectionSubtitle",defaultMessage:"Connect your Slack account to search private channels and DMs"}),buttonText:(0,R.jsx)(y().sA,{id:"agentSlackStatus.v2UserConnectionButton",defaultMessage:"Log in"}),isDismissible:!0};case"sharepoint_select_sites":return{title:(0,R.jsx)(y().sA,{id:"agentSharepointStatus.selectSitesTitle",defaultMessage:"No SharePoint sites selected"}),subtitle:(0,R.jsx)(y().sA,{id:"agentSharepointStatus.selectSitesSubtitle",defaultMessage:"Finish your setup to get answers from SharePoint"}),buttonText:(0,R.jsx)(y().sA,{id:"agentSharepointStatus.selectSitesButton",defaultMessage:"Select sites"})};case"slack_re_auth":return{title:(0,R.jsx)(y().sA,{id:"agentSlackStatus.reAuthTitle",defaultMessage:"Log in to Slack"}),subtitle:(0,R.jsx)(y().sA,{id:"agentSlackStatus.reAuthSubtitle",defaultMessage:"We couldn’t verify your Slack email. Authenticate to continue using Slack with Notion AI"}),buttonText:(0,R.jsx)(y().sA,{id:"agentSlackStatus.reAuthButton",defaultMessage:"Log in"})};case"github_re_auth":return{title:(0,R.jsx)(y().sA,{id:"agentGithubStatus.reAuthTitle",defaultMessage:"Log in to GitHub"}),subtitle:(0,R.jsx)(y().sA,{id:"agentGithubStatus.reAuthSubtitle",defaultMessage:"Connect your GitHub account to search repositories"}),buttonText:(0,R.jsx)(y().sA,{id:"agentGithubStatus.reAuthButton",defaultMessage:"Log in"})};case"linear_re_auth":return{title:(0,R.jsx)(y().sA,{id:"agentLinearStatus.reAuthTitle",defaultMessage:"Log in to Linear"}),subtitle:(0,R.jsx)(y().sA,{id:"agentLinearStatus.reAuthSubtitle",defaultMessage:"Connect your Linear account to access issues in Notion AI"}),buttonText:(0,R.jsx)(y().sA,{id:"agentLinearStatus.reAuthButton",defaultMessage:"Log in"})};default:return{title:(0,R.jsx)(y().sA,{id:"agentConnectionStatus.singleConnectorTitle",defaultMessage:"Finish {connector} setup",values:{connector:C().w0[e]}}),subtitle:(0,R.jsx)(y().sA,{id:"agentConnectionStatus.singleConnectorSubtitle",defaultMessage:"Your workspace has added {connector} to Notion AI. Link your account for higher quality AI results",values:{connector:C().w0[e]}}),buttonText:(0,R.jsx)(y().sA,{id:"agentConnectionStatus.singleConnectorButton",defaultMessage:"Finish setup"})}}}function V({isCustomAgent:e}){const t=(0,c().v3)(),n=(0,a().L)(),u=(0,_().J)(n),p=(0,d().O$)(r().AppStoreSidebarSpaceViewStore),h=null==n?void 0:n.id,m=(0,d().K8)((()=>{const e=(0,F().kB)(),t=[];for(const n of e){if("custom"===n)continue;const e=(0,j().uD)(n,u);for(const o of e){N(o.type,p)||t.push({connector:n,action:o})}}return t}),[u,p]),S=(0,o.useMemo)((()=>{const e=new Map;for(const t of m)e.has(t.connector)||e.set(t.connector,t);return Array.from(e.values())}),[m]),b=(0,o.useMemo)((()=>S.map((({connector:e})=>({connector:e,scopeModule:(0,B().L)(e)})))),[S]),C=(0,o.useCallback)((()=>{p&&h&&D().createAndCommit({userAction:"agentConnectionStatus.dismissCard",environment:t,canUndo:!0,perform:e=>{const t={...p.getSettings()};for(const{action:n}of S){const e=U(n.type);e&&Object.assign(t,{[e]:!0})}D().applyOperation({store:p,operation:{pointer:p.pointer,path:["settings"],command:"update",args:t},transaction:e})}})}),[p,h,t,S]),v=1===S.length,M=(0,o.useCallback)((()=>{if(v&&S.length>0){const{connector:e,action:n}=S[0];K(0,n,t,h)}else{const e=s().default.checkGate({gateName:"notion_ai_settings_tab_v2"});x().Ow({openedFrom:"assistant",currentTab:"ai",subtab:e?"ai_connectors":void 0})}}),[S,t,h,v]);if((0,o.useEffect)((()=>{var e;v&&("slack_v2_user_connection"===(null===(e=S[0])||void 0===e||null===(e=e.action)||void 0===e?void 0:e.type)&&(0,i().u)({environment:t,event:{eventName:"universal_qna_button_click",eventProperties:{button_name:"slack_v2_private_connect_shown",integration_type:"slack",setup_session_id:P().Rh.state.sessionId,from:P().Rh.state.analyticsFrom,connection_version:2}}}))}),[v,S,t]),0===S.length||l().A.isMobile||e)return null;if(v){const{connector:e,action:t}=S[0],{title:n,subtitle:o,buttonText:i}=L(e,t.type),a=U(t.type);return(0,R.jsx)(O,{icon:(0,R.jsx)(g().Q,{iconGroup:f().G[e],overrideSize:()=>24,variantName:"default"}),title:n,subtitle:o,buttonText:i,onAction:M,onDismiss:C,showDismissIcon:null!==a})}const k=(0,R.jsx)("div",{style:{display:"flex",alignItems:"center",gap:8},children:b.map((({connector:e})=>(0,R.jsx)(g().Q,{iconGroup:f().G[e],overrideSize:()=>24,variantName:"default"},e)))}),I=S.some((({action:e})=>null!==U(e.type)));return(0,R.jsx)(O,{icon:k,title:(0,R.jsx)(y().sA,{id:"agentConnectionStatus.multipleConnectorsTitle",defaultMessage:"Finish setting up Notion AI connected apps"}),subtitle:(0,R.jsx)(y().sA,{id:"agentConnectionStatus.multipleConnectorsSubtitle",defaultMessage:"Get answers from your team’s connected apps"}),buttonText:(0,R.jsx)(y().sA,{id:"agentConnectionStatus.multipleConnectorsButton",defaultMessage:"Finish setup"}),onAction:M,onDismiss:C,isSingleConnector:!1,showDismissIcon:I})}},390719:(e,t,n)=>{n.d(t,{oY:()=>A,uE:()=>w});n(944114),n(898992),n(430670);var o=n(296540),i=()=>n(106702),a=()=>n(920198),r=()=>n(907258),s=()=>n(484714),l=()=>n(590526),c=()=>n(79926),d=()=>n(187174),u=()=>n(68263),p=()=>n(69708),g=()=>n(778078),h=()=>n(496603),m=()=>n(381678),f=()=>n(47373),S=()=>n(761309),y=()=>n(106628),b=()=>n(534619),x=()=>n(977870),C=()=>n(271084),v=()=>n(233692),M=()=>n(482238);const k=75,j=75,I=4;function w(e){const{query:t,useMentionMenuStore:n}=e,i=(0,l().K8)((()=>!(!e.disabled&&!n)&&!M().Ay.state.mentionTypes.user),[e.disabled,n]),{results:a,isLoading:f}=function(e){const{query:t,disabled:n,useMentionMenuStore:i,open:a}=e,f=(0,p().tz)(),v=(0,s().v3)(),j=(0,l().K8)((()=>i?M().Ay.state.open:a),[a,i]),I=(0,l().O$)(r().AppStoreSidebarSpaceStore),w=!n&&t.length>0&&I&&j,A=(0,l().K8)((()=>{var e;const t=C().k.getSortedUserIds(),n=null===(e=(0,m()._)(v))||void 0===e?void 0:e.id;return[...(0,h().oE)([n]),...t]}),[v]),T=(0,l().K8)((()=>{const e=r().default.state.mainEditorCurrentBlockStore;return e?(0,S().i0)(e).flatMap((({permissionItem:e})=>(0,u().B2)(e)?[e.user_id]:[])):[]}),[]),P=(0,c().fJ)(y().T.searchActions),[{value:F=[],status:_}]=(0,d().Yb)((async()=>{if(!w||"resolved"!==P.status)return[];const e=(0,h().sb)([...A,...T]),n=P.value;return(await n.searchUsers({environment:v,parentStore:I,query:t,userIds:e,minFuzzyScore:g().XR,placeSelfFirst:n.isPersonalPronoun(t,f.locale)})).slice(0,3)}),[w,P.status,P.value,A,T,v,I,t,f.locale]),E=(0,l().K8)((()=>I&&x().c.state.wasGetVisibleUsersCalled[I.id]),[I]),[{value:D=[],status:B}]=(0,d().Yb)((async()=>w&&E?(0,b().searchSpaceUsers)({environment:v,query:t,membersOnly:!1,limit:20,minFuzzyScore:g().XR}):[]),[w,v,t,E],{debounce:k}),R=(0,o.useMemo)((()=>{const e=[...F,...D];return(0,h().hS)(e,(e=>e.id))}),[F,D]),N="pending"===B||"pending"===_;return{results:R,isLoading:N}}({query:t,disabled:i,...n?{useMentionMenuStore:!0}:{useMentionMenuStore:!1,open:!0}}),v=(0,l().K8)((()=>M().Ay.state.emptyQueryUserRequestStore.state.result??[]),[]);return{results:0===t.length?v.slice(0,I):a.slice(0,20),isLoading:f}}function A(e){const{query:t,environment:n,useMentionMenuStore:o,open:r}=e,s=(0,l().K8)((()=>o?M().Ay.state.open:r),[r,o]),c=(0,f().ke)(),u=(0,a().L)(),p=(0,i().$)(),g=!(0,l().K8)((()=>!(!e.disabled&&!o)&&!M().Ay.state.mentionTypes.bot),[e.disabled,o])&&c&&s&&Boolean(u)&&Boolean(p),[{value:h=[],status:m}]=(0,d().Yb)((async()=>{if(!g)return[];try{if(!u||!p)return[];const e=await y().T.customAgentSearchService.load(),{workflowStores:o}=await e.getCustomAgents({environment:n,spaceStore:u,userStore:p}),i=e.searchWorkflowStores({query:t,workflowStores:o,limit:5}),a=[];for(const t of i){const e=(0,v().m)(t);a.push({workflowStore:t,name:e.name,icon:e.icon})}return a}catch{return[]}}),[g,u,p,t,n],{debounce:j});return{results:h,isLoading:"pending"===m}}},391379:(e,t,n)=>{n.d(t,{q:()=>v});n(944114);var o=n(296540),i=()=>n(106702),a=()=>n(907258),r=()=>n(484714),s=()=>n(590526),l=()=>n(356983),c=()=>n(965454),d=(n(581454),()=>n(564884)),u=()=>n(128933),p=()=>n(68169),g=()=>n(234459),h=()=>n(155792),m=()=>n(760342),f=()=>n(69708),S=()=>n(624652),y=()=>n(128555),b=()=>n(74831),x=()=>n(594794),C=()=>n(791256);n(474848);function v(e){const t=(0,s().O$)(a().AppStoreSidebarSpaceStore),n=(0,i().$)(),v=(0,s().O$)(a().AppStoreSidebarSpaceViewStore),M=(0,r().v3)(),{threadStore:k,clientAiChatStore:j,aiChatFeatureController:I,config:w}=e,A=(0,c().AD)(),T=(0,s().K8)((()=>{const e=w??j.state.configForNewTranscripts;return I.shouldSupportAttachments(e.type)}),[I,j,w]),P=(0,s().K8)((()=>{if(!t)return;return A.getOrCreateThreadId({environment:M,maybeThreadStore:k,spaceId:t.id})}),[t,M,k,A]),F=(0,s().K8)((()=>{if(P)return j.getOrCreateClientAIChatThreadStore(P)}),[j,P]),_=(0,l().z)({threadClientStore:F,aiChatFeatureController:I,config:w,clientChatStore:j}),{onPasteFiles:E,uploadAttachments:D,onDropFiles:B}=function(e){const{clientAiChatStore:t,threadStore:n,threadId:i,spaceStore:a,config:c,aiChatFeatureController:v}=e,M=(0,r().v3)(),k=(0,b().yB)(),j=(0,s().K8)((()=>{if(i&&t)return t.getOrCreateClientAIChatThreadStore(i)}),[t,i]),I=(0,s().K8)((()=>null==j?void 0:j.getTemporaryAttachmentStagedDataOrInstantiate().stagedAttachmentUploadStore),[j]),w=(0,s().K8)((()=>(null==I?void 0:I.state.originalFileUrlToSuccessfullyUploadedFiles.size)??0),[I]),A=(0,s().K8)((()=>void 0!==c?c:(0,C().zj)({threadStore:n,clientStore:t})),[t,n,c]),T=A.type,P=(0,m().BI)(A),F=(0,o.useCallback)((e=>{if(!j||!a)return;const t=j.getTemporaryAttachmentStagedDataOrInstantiate(),n=(0,x().Z1)({environment:M,table:h().mS,spaceId:a.id}),o=(0,p().jx)({uploadedFileData:e,id:n});j.stageAttachmentInferenceTranscriptStep({step:o}),t.stagedAttachmentUploadStore.onFileUploadCompleted(e.uploadIdentifier,e),(0,d().u)({environment:M,event:{eventName:"assistant_attachment_upload_successful",eventProperties:{content_type:o.contentType,source:"custom_upload",framework:"inference_transcript",config_type:T}}})}),[j,M,a,T]),_=(0,s().K8)((()=>v.analyticsSource(n)),[v,n]),E=(0,S().U)({currentSpaceId:null==a?void 0:a.id,progressOverrides:{threadPointer:i&&a?{spaceId:a.id,table:g().To,id:i}:void 0,onSuccess:F,progressStore:I},analyticsArgs:{configType:T,source:_},threadStore:n,workflowId:P}),D=(0,l().z)({threadClientStore:j,config:c,clientChatStore:t,aiChatFeatureController:v}),B=(0,f().tz)(),R=(0,o.useCallback)((e=>{0!==e.files.length&&(D.canUpload?e.files.length+w>k?u().D6({label:B.formatMessage(y().E.multiple_uploads,{maxAttachments:k})}):E({files:e.files,method:"paste"}):u().D6({label:B.formatMessage(y().E[D.reason],{maxAttachments:k})}))}),[D,B,E,k,w]),N=(0,o.useCallback)((async e=>{0!==e.length&&(D.canUpload?e.length+w>k?u().D6({label:B.formatMessage(y().E.multiple_uploads,{maxAttachments:k})}):await E({files:e,method:"paste"}):u().D6({label:B.formatMessage(y().E[D.reason],{maxAttachments:k})}))}),[D,B,E,k,w]);return{uploadAttachments:E,onPasteFiles:R,onDropFiles:N}}({threadStore:k,threadId:P,spaceStore:t,config:w,clientAiChatStore:j,aiChatFeatureController:I}),R=(0,o.useCallback)((async()=>{await D({files:void 0,method:"clicked_attachment_button"})}),[D]),N=(0,o.useCallback)((e=>{e.transaction.postSubmitCallbacks.push((()=>{E(e)}))}),[E]),z=(0,o.useCallback)((async e=>{await B(e)}),[B]);if(t&&n&&v&&T&&_&&P)return{onPasteFiles:N,uploadFiles:R,onDropFiles:z,threadStore:k,threadId:P,spaceStore:t,userStore:n,spaceViewStore:v}}},392899:(e,t,n)=>{n.d(t,{b:()=>c,t:()=>d});n(18107),n(967357);var o=n(296540),i=()=>n(907258),a=()=>n(590526),r=()=>n(534177),s=()=>n(747100),l=()=>n(712505);function c(){const e=(0,a().O$)(i().AppStoreMainEditorCurrentBlockStore);return(0,o.useCallback)((t=>{const n=t.getRecordStoreUIRoot()===e,o=(0,s().cq)(t)&&l().default.isSidePeekOpen();return n||o}),[e])}function d(){const e=c();return(0,o.useCallback)((t=>{if(!t)return!1;if("textSelection"===t.type)return e(t.textSelection.start.store);if("blockSelection"===t.type){const n=t.stores.at(0);if(n)return e(n)}else{if("cursor"===t.type)return!1;(0,r().HB)(t)}return!1}),[e])}},403008:(e,t,n)=>{n.d(t,{w:()=>F});var o=n(296540),i=()=>n(59226),a=()=>n(590526),r=()=>n(599552),s=()=>n(69708),l=()=>n(46986),c=(n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(354520),n(803949),n(581454),()=>n(564884)),d=()=>n(907258),u=()=>n(383036),p=()=>n(874832),g=()=>n(493552),h=()=>n(26697),m=()=>n(81068),f=()=>n(736847),S=()=>n(365646),y=()=>n(289106),b=()=>n(534177),x=()=>n(639919),C=()=>n(13898),v=()=>n(36951),M=()=>n(865698),k=()=>n(272136),j=()=>n(676953),I=()=>n(626001),w=()=>n(652011),A=n(474848);function T(e){const{askDropdownConfigSections:t,buttonPopupParent:n,config:o,environment:i,supportsConfigTypeChange:a,intl:r,onChangeNextConfig:l,spaceStore:T,showAgentModelPicker:F,agentModelConfig:_,showOnlyOpenAiModels:E,inferenceInfo:D}=e,B=T.id,R=function(e){const{askDropdownConfigSections:t,spaceStore:n}=e,o=[];return t.forEach((e=>{e.items.forEach((e=>{"default"!==e.askMode&&x().R.isModelDown({actor:y().S,spaceId:n.id,model:e.askMode})&&o.push(e.askMode)}))})),o}({askDropdownConfigSections:t,spaceStore:T}),N=e=>{let t=e.items;if(a||(t=t.filter((e=>e.config.type===o.type))),0===t.length)return;const n=t.map((e=>({key:e.askMode,render:t=>{const n="default"!==e.askMode?(0,M().DL)(e.askMode):void 0,i="default"!==e.askMode&&R.includes(e.askMode);return(0,A.jsx)(h().m,{disableTooltip:!i,renderTooltip:()=>(0,A.jsx)(s().sA,{...x().$.modelProviderDown}),render:a=>(0,A.jsx)(m().A,{...(0,u().A)(t,a),icon:(0,A.jsx)(w().H,{modelFamily:n}),isChecked:P(o,e,_),title:(0,A.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6},children:[(0,A.jsx)(g().D,{styleKey:"bodyRegular",children:e.title}),e.beta?(0,A.jsx)(C().A,{}):void 0]}),disabled:i,disabledFeedback:i})})},action:()=>{(0,c().u)({environment:i,event:{eventName:"clicked_ai_chat_mode",eventProperties:{mode:e.config.type,model:e.askMode,ai_session_id:D.aiSessionId,ai_inference_id:D.aiDraftInferenceId}}});const t=e.config;"default"!==e.askMode?"markdown-chat"===t.type?l({...o,model:t.model,type:t.type}):"workflow"===t.type&&void 0!==t.model&&(l({...o,model:t.model,modelFromUser:t.modelFromUser,type:t.type}),(0,I().Oq)(B,{model:t.model})):"workflow"===t.type?(l({...o,model:void 0,modelFromUser:!1,type:"workflow"}),(0,I().Oq)(B,{model:void 0})):"search"===t.type&&l((0,v().YM)({spaceId:B}))}}))),d=e.isLoading?[...n,{key:"loading",render:()=>(0,A.jsx)("div",{style:{paddingInline:8,paddingBlock:6},children:(0,A.jsx)(p().P,{style:{height:28,borderRadius:4}})}),action:()=>{}}]:n;return{key:e.id,render:t=>(0,A.jsx)(f().A,{...t,title:e.sectionTitle?r.formatMessage(e.sectionTitle):void 0}),items:d}},z=t.filter((e=>"markdown-chat"!==e.configType)).map(N).filter(b().O9),U=t.filter((e=>"markdown-chat"===e.configType)).map(N).filter(b().O9),K=[...z];if(F){var O;const e=null===(O=d().default.state.currentUserStore)||void 0===O?void 0:O.getModel(),t=T.getModel();if(!t)return K;const i=!1,a=(0,k().h)(),c=new Set;Object.keys(a).forEach((e=>{c.add(e)}));const u=(0,j().BU)(M().T3.filter((e=>!c.has(e)))),p=(0,j().BU)(M().At.filter((e=>!c.has(e)))),g=e=>e.filter((e=>{const t=i||!M().oT.includes(e);return E?M().xM.includes(e)&&t:t})),b={},C=[...u,...p];for(const n of C)b[n]=x().R.isModelDown({spaceId:t.id,actor:e??y().S,model:S().UO[n]});const v=e=>e.map((e=>{const i=b[e]??!1,a=(0,M().DL)(e);return{key:e,render:t=>(0,A.jsx)(h().m,{disableTooltip:!i,placement:"bottom",alignment:"start",renderTooltip:()=>r.formatMessage(x().$.modelProviderDown),render:n=>(0,A.jsx)(m().A,{...t,...n,icon:(0,A.jsx)(w().H,{modelFamily:a}),title:r.formatMessage(M().Wg[e]),isChecked:(null==_?void 0:_.type)===e,disabled:i,disabledFeedback:i})}),action:()=>{i||(l({...o,type:"workflow",model:e,modelFromUser:!0}),(0,I().Oq)(t.id,{model:e}),n.close())}}})),P=g(u);P.length>0&&K.push({key:"agent-fast",render:e=>(0,A.jsx)(f().A,{...e,title:(0,A.jsx)(s().sA,{...M().Wg.fastSection})}),items:v(P)});const F=g(p);F.length>0&&K.push({key:"agent-intelligent",render:e=>(0,A.jsx)(f().A,{...e,title:(0,A.jsx)(s().sA,{...M().Wg.intelligentSection})}),items:v(F)})}return K.push(...U),K}function P(e,t,n){return e.type===t.config.type&&("markdown-chat"===e.type&&"markdown-chat"===t.config.type?e.model===t.config.model:"workflow"===e.type&&("default"===t.askMode?void 0===(null==n?void 0:n.type):(null==n?void 0:n.type)===t.askMode))}function F(e){const{aiChatFeatureController:t,buttonPopupParent:n,config:c,environment:d,isSimplifiedInputEnabled:u,inputMode:p,threadMode:g,onChangeNextConfig:h,spaceStore:m,inferenceInfo:f}=e,S=(0,s().tz)(),y=(0,l().i7)(),b=(0,i().X)("agent_model_picker"),x=(0,o.useMemo)((()=>(0,r().kD)(c)),[c]),C=(0,i().X)("sams_specials");return(0,a().K8)((()=>{if(!m)return[];const e=(0,j()._y)({intl:S,isAgentEnabled:y,environment:d,spaceId:m.id,hideWorkspaceSectionTitle:u}),o=t.supportsConfigTypeChanges({mode:p,threadMode:g});return T({askDropdownConfigSections:e,buttonPopupParent:n,config:c,environment:d,inferenceInfo:f,supportsConfigTypeChange:o,intl:S,onChangeNextConfig:h,spaceStore:m,showAgentModelPicker:y&&b,agentModelConfig:x,showOnlyOpenAiModels:C})}),[x,b,t,n,c,d,u,p,g,S,y,h,m,C,f])}},452745:(e,t,n)=>{n.r(t),n.d(t,{checkmarkShieldFillSmallIcon:()=>i,iconDefinition:()=>o});n(296540);const o={viewBox:"0 0 16 16",fittedViewBox:"2.85 2.2 10.29 11.6",svg:(0,n(474848).jsx)("path",{d:"M7.755 2.26a.55.55 0 0 1 .49 0l.962.482a7.3 7.3 0 0 0 3.277.774h.11c.302 0 .547.244.547.547v4.333a4.92 4.92 0 0 1-2.983 4.524l-1.943.833a.55.55 0 0 1-.43 0l-1.943-.833A4.92 4.92 0 0 1 2.86 8.396V4.062c0-.302.245-.546.547-.546h.11c1.138 0 2.26-.265 3.277-.774zm2.567 4.123a.55.55 0 0 0-.944-.566L7.371 9.163 6.268 7.875a.55.55 0 1 0-.836.716l1.6 1.867a.55.55 0 0 0 .89-.075z"})},i=(0,n(340498).wt)("checkmarkShieldFillSmall",o,"fillSmall")},582418:(e,t,n)=>{n.d(t,{D:()=>o});const o=(0,n(69708).YK)({personalAgentMentionName:{id:"botMention.personalAgent.name",defaultMessage:"Notion AI"}}).personalAgentMentionName},652011:(e,t,n)=>{n.d(t,{H:()=>c});n(296540);var o=()=>n(265060),i=()=>n(343601),a=()=>n(684462),r=()=>n(890856),s=()=>n(230510),l=n(474848);function c(e){const{modelFamily:t,defaultNoAiFace:n}=e;switch(t){case"anthropic":return(0,l.jsx)(o().Q,{iconGroup:a().j,variantName:"default",overrideSize:()=>16});case"openai":return(0,l.jsx)(o().Q,{iconGroup:s().P,variantName:"default",overrideSize:()=>16});case"gemini":return(0,l.jsx)(o().Q,{iconGroup:r().t,variantName:"default",overrideSize:()=>16});default:return n?null:(0,l.jsx)(o().Q,{iconGroup:i().G,variantName:"default",colorVariant:"primary",overrideSize:()=>16})}}},673962:(e,t,n)=>{n.r(t),n.d(t,{PulsingWrapper:()=>d});var o=n(296540),i=()=>n(401497),a=()=>n(558842),r=()=>n(100622),s=n(474848);function l(e){const{children:t,withBackground:n,onReturnPressed:l,shape:c,framerMotion:d,forwardedRef:u}=e,p="square"!==c&&void 0!==e.size?e.size:22,g="square"===c?e.width||"auto":p,h="square"===c?e.height||"auto":p,m="pill"===c,f=(0,o.useRef)(null),S="square"===c?e.borderRadius:p+2;(0,o.useEffect)((()=>{l&&f.current&&f.current.focus()}),[l]);const[y,b]=(0,o.useState)(!0),x=(0,i().eP)(),C=(0,r().O4)({theme:x}),v=C.palette.uiBlue[400],M=C.palette.uiBlue[200],k="rgba(35, 131, 226, 0)",j={animate:{boxShadow:y?[`0 0 0 0px ${v}, 0 0 0 0px ${M}`,`0 0 0 2px ${v}, 0 0 4px 4px ${M}`,`0 0 0 5px ${k}, 0 0 4px 8px ${k}`]:void 0,transition:{duration:1.8,repeatDelay:.4,repeat:1/0,ease:"easeInOut"}}},I=(0,o.useCallback)((e=>{"Enter"===e.key&&l&&l()}),[l]),w=(0,i().IS)((()=>({pulseStyle:{borderRadius:S,display:"flex",justifyContent:"center",alignItems:"center",width:m?"auto":g,height:m?p+4:h,padding:"square"===c?void 0:2,backgroundColor:n?r().Tj.palette.uiBlue[300]:void 0}})),[S,m,g,p,h,c,n]);if(!d)return(0,s.jsx)(o.Fragment,{children:t});const{motion:A}=d;return(0,s.jsx)(A.div,{variants:j,animate:y?"animate":void 0,style:w.pulseStyle,ref:(0,a().Px)(f,u),onBlur:()=>{b(!1)},tabIndex:l?0:void 0,onKeyDown:l?I:void 0,children:t})}function c(e,t){const{onDependencyLoaded:i,...a}=e,{value:r,status:c}=(0,n(79926).fJ)(n(680474).fM);return o.useEffect((()=>{"resolved"===c&&(null==i||i())}),[c,i]),r?(0,s.jsx)(l,{...a,framerMotion:r,forwardedRef:t}):(0,s.jsx)(o.Fragment,{children:e.children})}const d=o.forwardRef(c);d.displayName="PulsingWrapper"},684335:(e,t,n)=>{n.d(t,{W:()=>A});var o=n(296540),i=()=>n(907258),a=()=>n(590526),r=()=>n(365646),s=()=>n(639919),l=()=>n(383070),c=()=>n(791256),d=()=>n(626001),u=()=>n(484714),p=()=>n(201980),g=()=>n(184136),h=()=>n(295304),m=()=>n(244828);var f=()=>n(300474),S=()=>n(59226),y=()=>n(96563),b=()=>n(949305),x=()=>n(330966),C=()=>n(920198),v=()=>n(84262),M=()=>n(534177);const k=(0,n(69708).YK)({default:{id:"customAgentUpgradeButtonProps.default",defaultMessage:"Custom agents are not available on your current plan. <highlight>Upgrade</highlight> to {productName}"},request:{id:"customAgentUpgradeButtonProps.request",defaultMessage:"Custom agents are not available on your current plan. <highlight>Request upgrade</highlight> to {productName}."},requestPending:{id:"customAgentUpgradeButtonProps.requestPending",defaultMessage:"Custom agents are not available on your current plan. Your upgrade request is pending."},notEligible:{id:"customAgentUpgradeButtonProps.notEligible",defaultMessage:"Custom agents are not available on your current plan."}});var j=()=>n(921614),I=()=>n(528093);function w(e){const{config:t}=e,n="workflow"===t.type&&!0===t.isCustomAgent,i=(0,u().v3)(),r=(0,f().r)(),s=i.currentUser.id,l=(0,a().K8)((()=>{var e;if(r&&s)return null===(e=(0,y().Lx)({spaceId:r,userId:s,config:t}))||void 0===e?void 0:e.pfaFeatureLoadArgs}),[r,s,t]),c=(0,I()._)(l||{name:"ai_usage",spaceId:r,userId:s}),d=(0,I()._)({name:"custom_agents",spaceId:r,userId:s}),p=n?d:c,{upsellMessage:g}=(0,b().x)({featureAvailability:p,upsellFrom:(0,y().bl)(t),showOptimisticUpsell:!1}),h=(0,y().bl)(t),m=(0,x().o)({featureAvailability:c,source:h,type:"text"}),w=function(e){const{featureAvailability:t,source:n,type:o}=e,i=(0,C().L)(),a=(0,v().Pd)(t)?null==t?void 0:t.upsell:void 0;if(!a||"none"===a.type)return;const r={source:n,upsell:a,featureName:"custom_agents",spaceStore:i};switch(o){case"primary":return{...r,display:"primary"};case"button":return{...r,display:"button",size:"small"};case"icon":return{...r,showPlanName:!0,display:"icon"};case"text":return{...r,display:"text",size:e.size??"small",customMessages:{eligible_to_purchase:k.default,eligible_for_trial:k.default,sales_eligible:k.request,sales_assisted:k.request,eligible_to_request:k.request,request_pending:k.requestPending,not_eligible:k.notEligible}};default:(0,M().HB)(o)}}({featureAvailability:d,source:h,type:"text"}),A=n?w:m,T=(0,S().X)("upgrade_system_ai"),P=(0,a().K8)((()=>p&&"available"!==p.type&&Boolean(g||T&&A)),[p,g,T,A]);return(0,o.useEffect)((()=>{P&&j().d.setState({...j().d.state,inlineUsageErrorVisible:!0})}),[P]),(0,o.useMemo)((()=>({upsellMessage:P?g:void 0,upgradeButtonTextProps:A,isUpgradeSystemEnabled:T})),[P,g,A,T])}function A(e){const{errorState:t,attachments:n,clientStore:f,threadStore:S,nextConfig:y,spaceStore:b,textStore:x}=e,{upsellMessage:C,upgradeButtonTextProps:v,isUpgradeSystemEnabled:M}=w({config:y}),{isRecording:k,handleStartRecording:j,handleStopRecording:I}=function(e){const{textStore:t,spaceStore:n}=e,i=(0,u().v3)(),[a,r]=(0,o.useState)(!1),s=(0,o.useCallback)((async()=>{const e=await g().i.load(),o=(0,p().q4_)(t.getValue()||[]);await e.StreamingDictationManager.start({environment:i,spaceId:null==n?void 0:n.id,onTranscription:e=>{const n=o?`${o}\n${e}`:e;m().createAndCommit({userAction:"useTranscription.handleDictation",environment:i,canUndo:!0,perform:e=>{h().R9({environment:i,store:t,value:(0,p().x9d)(n),transaction:e})}})}}),r(!0)}),[i,t,n]),l=(0,o.useCallback)((async()=>{(await g().i.load()).StreamingDictationManager.stop(),r(!1)}),[]);return(0,o.useEffect)((()=>()=>{l()}),[l]),{isRecording:a,handleStartRecording:s,handleStopRecording:l}}({textStore:x,spaceStore:b}),A=(0,o.useMemo)((()=>{if("workflow"===y.type&&y.model&&Boolean(y.modelFromUser))return r().UO[y.model]}),[y]),T=(0,a().K8)((()=>!S||(0,c().av)(S)?"newThread":"existingThread"),[S]);return{inputMode:(0,a().K8)((()=>{var e;if(!b)return"aiDisabled";const o=x.getValue(),a=l().zD.isAiEnabled(),r=null===(e=i().default.state.currentUserStore)||void 0===e?void 0:e.getModel(),u=null==S?void 0:S.id,p=u?f.getOrCreateClientAIChatThreadStore(u):void 0;if(!a)return"aiDisabled";if(t.isError)return"error";if(null!=p&&p.state.pendingStop)return"pendingStop";if((0,d().Re)(n))return"filesRequireConfirmation";if((0,d().X4)(n))return"uploadingFiles";if(null!=p&&p.state.currentUserInitiatedRunningInference&&(0,c().Ft)({clientStore:f,threadStore:S}))return"runningInference";if(k)return"recording";if(r&&s().R.isInferenceTranscriptConfigTypeDown({configType:y.type,spaceId:b.id,actor:r}))return"configTypeDown";if(r&&A&&s().R.isModelDown({actor:r,spaceId:b.id,model:A}))return"modelProviderDown";if(M?Boolean(v):Boolean(C))return"upgradeRequired";if(S&&!S.canEdit())return"readOnlyThread";return(0,d().d2)(o,n)?"ready":"noContent"}),[t.isError,n,f,S,k,C,b,y.type,v,M,A,x]),threadMode:T,upsellMessage:C,upgradeButtonTextProps:v,isUpgradeSystemEnabled:M,isRecording:k,onStartRecording:j,onStopRecording:I}}},716469:(e,t,n)=>{n.d(t,{R:()=>d});var o=()=>n(590526),i=()=>n(69708),a=()=>n(843014),r=()=>n(865698),s=()=>n(272136),l=()=>n(676953);function c(e,t){if(e&&t)return t[e]}function d(e){const{config:t,agentModelConfig:n,intl:d}=e,u=(0,i().tz)(),p=d??u;return(0,o().K8)((()=>{const e=(0,s().h)();if("workflow"===t.type&&null!=n&&n.type){const t=c(n.type,e),o=(0,r().DL)(n.type);return{modelFamily:o,modelName:(0,r().tv)(n.type,p,t),modelColor:(0,r().G2)(o)}}const o=function(e){if("markdown-chat"===e.type)return e.model}(t),i=c(o,e),d=(0,r().DL)(o);return{modelFamily:d,modelName:(null==i?void 0:i.modelMessage)??(0,l().hg)({model:o,intl:p})??p.formatMessage(a().D.notionAIAutomatic),modelColor:(0,r().G2)(d)}}),[t,n,p],{useDeepEqual:!0})}},845098:(e,t,n)=>{n.d(t,{M:()=>a});var o=n(296540),i=n(474848);const a=o.forwardRef((function(e,t){const{name:o,icon:a,...r}=e,s=o;return(0,i.jsx)(n(81068).A,{...r,ref:t,icon:(0,i.jsx)(n(142149).Z,{icon:a}),title:s})}))},850902:(e,t,n)=>{n.d(t,{u:()=>i});n(296540);const o={viewBox:"0 0 20 20",fittedViewBox:"2.38 2.37 15.25 15.25",svg:(0,n(474848).jsx)("path",{d:"M3.893 2.875a.63.63 0 0 1 .79-.02l.091.087.127.149.016.034.072.104 11.272 13.15a.623.623 0 0 1-1.035.678l-.756-.881A7.625 7.625 0 0 1 4.58 4.638l-.755-.881-.072-.105a.626.626 0 0 1 .14-.777m4.244 7.75c.054 1.559.31 2.937.681 3.943.212.572.449.992.68 1.256.232.266.404.318.502.318s.27-.052.502-.318c.231-.264.468-.684.68-1.256.18-.488.332-1.065.448-1.707l-1.917-2.236zm-4.48 0a6.38 6.38 0 0 0 4.509 5.48 6.5 6.5 0 0 1-.52-1.104c-.431-1.167-.704-2.697-.76-4.376zm8.992 3.426q-.131.507-.294.95c-.15.405-.324.779-.522 1.104a6.4 6.4 0 0 0 1.82-.883zM5.396 5.59a6.35 6.35 0 0 0-1.74 3.785h3.23c.022-.647.075-1.272.158-1.863zm2.74 3.785h.505l-.477-.556q-.017.274-.027.556m1.863-7A7.625 7.625 0 0 1 17.625 10a7.6 7.6 0 0 1-1.407 4.407l-.844-.983c.526-.824.87-1.775.97-2.799h-3.23l-.009.152-1.245-1.453c-.058-1.538-.31-2.897-.678-3.892-.212-.572-.449-.99-.68-1.255-.232-.266-.404-.319-.502-.319-.099 0-.27.053-.502.319-.231.264-.468.683-.68 1.255q-.043.119-.084.245l-.926-1.081q.163-.38.358-.702-.375.112-.73.268l-.843-.984A7.6 7.6 0 0 1 10 2.375m1.833 1.519c.198.326.372.7.521 1.105.432 1.167.704 2.697.76 4.376h3.23a6.38 6.38 0 0 0-4.511-5.481"})},i=(0,n(340498).wt)("globeSlash",o,"default")},882016:(e,t,n)=>{n.d(t,{O:()=>r});var o=()=>n(100622),i=()=>n(496603),a=()=>n(665579);function r({isPhone:e,themeMode:t}){if("dark"===t)return"unset";const n=(0,a().O0)({mode:t});return(0,i().oE)(["light"===t?"0 12px 32px rgba(0, 0, 0, 0.03)":o().Tj.homeShadow.card.hovered,`0 0 0 ${n}px rgba(0, 0, 0, 0.05)`]).join(", ")}},890856:(e,t,n)=>{n.d(t,{t:()=>o});const o=(0,n(340498).xh)("googleGemini",{default:{loader:()=>n.e(19365).then(n.bind(n,965670))}})},921614:(e,t,n)=>{n.d(t,{d:()=>i});class o extends(()=>n(757695))().Store{getInitialState(){return{inlineUsageErrorVisible:!1,featureAvailability:void 0,counterToTriggerRerender:0}}drawAttentionToError(){this.setState({...this.state,inlineUsageErrorVisible:!0,...this.state.inlineUsageErrorVisible?{counterToTriggerRerender:this.state.counterToTriggerRerender+1}:{}})}}const i=new o;n(852832).exposeDebugValue("AiChatInlineUsageErrorStore",i)},953490:(e,t,n)=>{n.d(t,{i:()=>v});var o=n(296540),i=()=>n(907258),a=()=>n(726637),r=()=>n(590526),s=()=>n(278729),l=()=>n(807449),c=()=>n(764880),d=n(474848);const u={viewBox:"0 0 16 16",fittedViewBox:"2.49 2.19 11.01 11.97",svg:(0,d.jsx)("path",{d:"m4.145 2.922-.227-.265a.55.55 0 1 0-.836.716l1.491 1.739a3.9 3.9 0 0 0-.46 1.836v.895a2.78 2.78 0 0 1-.687 1.83l-.616.703c-.709.81-.134 2.078.942 2.078h2.2a2.081 2.081 0 0 0 4.095 0h.819l1.216 1.419a.55.55 0 0 0 .843-.707L4.153 2.931zm1.068 4.026c0-.32.054-.626.152-.912l4.558 5.318h-6.17a.153.153 0 0 1-.116-.253l.617-.705a3.88 3.88 0 0 0 .959-2.553zm1.773 5.506h2.028a1.081 1.081 0 0 1-2.028 0m6.302-.554a1.244 1.244 0 0 0-.098-1.524l-.616-.704a2.78 2.78 0 0 1-.687-1.829v-.895a3.89 3.89 0 0 0-2.124-3.465 1.85 1.85 0 0 0-3.526 0l-.112.06.738.86.062-.027.29-.121.042-.312A.75.75 0 0 1 8 3.29c.378 0 .692.281.743.653l.043.312.29.121a2.79 2.79 0 0 1 1.711 2.572v.895c0 .513.102 1.016.294 1.482z"})},p=(0,n(340498).wt)("bellSlashSmall",u,"small");var g=()=>n(848538),h=()=>n(69708),m=()=>n(100622),f=()=>n(534177),S=()=>n(284371),y=()=>n(231704),b=()=>n(313171),x=()=>n(486674);function C(e,t){const{user:o,focused:s}=e,u=(0,n(484714).v3)(),g=(0,h().tz)(),f=(0,n(401497).IS)((()=>({tooltip:{color:m().Tj.text.inverseSecondary,fontWeight:S().Wy.regular,maxWidth:240},tooltipHeader:{color:m().Tj.text.inversePrimary,fontWeight:S().Wy.medium}})),[]),y=(0,c().A7)(o),b=(0,c().lR)(g,y),C=(0,r().K8)((()=>{const e=(0,x().a)();return!(e&&(0,n(928074).Aj)({store:e}))||"none"!==(0,n(761309).om)(o.id)}),[o.id]),v=(0,r().K8)((()=>{var e;return o.id===(null===(e=i().default.state.currentUserStore)||void 0===e?void 0:e.id)}),[o.id]),j=(0,n(9003).H)(),I=(0,r().K8)((()=>{if(!j)return;if(!s)return;if(C)return;const e=(0,x().a)(),t=e&&Boolean(n(763884).K.get({userId:u.currentUser.id,key:(0,n(248681).T)(e.id)})),o=null==e?void 0:e.canAdmin();return!t&&o?(0,d.jsx)(l().I,{icon:n(97835).inviteMemberIcon,size:17,colorVariant:"secondary"}):(0,d.jsx)(l().I,{icon:p,size:17,colorVariant:"secondary"})}),[j,u.currentUser.id,C,s]),w=(0,r().K8)((()=>{if(!j)return null;const e=o.email;return(0,d.jsxs)("div",{style:f.tooltip,children:[(0,d.jsx)("header",{style:f.tooltipHeader,children:(0,d.jsx)(k,{userName:b,userHasAccessToPage:C,userIsSelf:v})}),e]})}),[j,C,v,b,o.email,f.tooltip,f.tooltipHeader]);return(0,d.jsx)(n(457688).A,{...e,ref:t,actor:y,right:I,tooltip:w,badge:(0,d.jsx)(M,{user:o}),tooltipPlacement:j?"right":void 0,useEmailAsTooltip:!j,customUserTitleStyles:a().A.isMobile?{fontSize:14}:void 0,iconSizeOverride:a().A.isMobile?24:void 0})}const v=o.forwardRef(C);function M({user:e}){const t=(0,r().O$)(i().AppStoreSidebarSpaceStore),n=(0,r().K8)((()=>{if(t)return s().V.createChildStore(t,(0,g().i1)({userId:e.id,spaceId:t.id})).getMembershipType()}),[t,e.id]);if(!n)return null;switch(n){case"none":case"member":case"membership_admin":case"owner":return null;case"page_guest":return(0,d.jsx)(y().w,{labelType:"guest"});case"restricted_member":return(0,d.jsx)(b().L,{});default:(0,f().HB)(n)}}function k({userName:e,userHasAccessToPage:t,userIsSelf:n}){return n?(0,d.jsx)(h().sA,{defaultMessage:"You",id:"activitySection.authorPhrase.forOneAuthorCurrentUser.label"}):t?null:(0,d.jsx)(h().sA,{id:"mentionMenu.UserMentionMenuItem.noAccessTooltip",defaultMessage:"{userName} won’t be notified because they don’t have page access",values:{userName:e}})}},965913:(e,t,n)=>{n.d(t,{Bd:()=>s,TU:()=>l});n(944114);var o=()=>n(534177);const i=["sidebar","fullPage","background"],a=["sidebar","fullPage","background"],r=new(n(29923).R)({key:"sendDestinationOrder",namespace:n(553737).Bq,important:!0,trackingType:"preference"});function s(e){const t=r.getState(),n=c(null==t?void 0:t[e]);return t&&!function(e,t){if(!Array.isArray(e)||e.length!==t.length)return!1;for(let n=0;n<e.length;n+=1)if(e[n]!==t[n])return!1;return!0}(t[e],n)&&r.setState({...t,[e]:n}),n}function l(e,t){const n=r.getState()??{},o=c(t);r.setState({...n,[e]:o})}function c(e){if(!Array.isArray(e))return a;const t=[];for(const a of e)(0,o().Xk)(i,a)&&(t.includes(a)||t.push(a));const n=[...t];for(const o of a)n.includes(o)||n.push(o);const[r,s,l]=n;return r&&s&&l?[r,s,l]:a}}}]);