"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[11922],{117686:(e,t,o)=>{o.r(t),o.d(t,{TimelineItemDateRange:()=>Q,propertiesWidth:()=>q,scrollArrowLeftOffset:()=>H});o(581454);var n=o(296540),r=()=>o(255311),l=()=>o(242422),i=()=>o(484714),a=()=>o(590526),s=()=>o(401497),c=()=>o(79926),d=()=>o(882722),u=()=>o(807449),g=()=>o(158661),S=()=>o(69708),m=()=>o(100622),p=()=>o(496603),h=()=>o(284371),b=()=>o(427571),y=()=>o(27542),v=()=>o(752773),f=()=>o(3700),x=()=>o(236030),k=()=>o(999140),C=()=>o(187820),I=()=>o(16006),w=()=>o(366437),D=()=>o(862292),P=()=>o(970501),j=()=>o(836724),M=()=>o(230062),T=()=>o(405623),R=()=>o(244828),A=()=>o(317406),E=()=>o(378518),B=()=>o(887957),F=()=>o(209199),K=()=>o(323550),L=()=>o(222321),z=o(474848);const O=24;function W(e){const{store:t,schema:o,timelineState:r,dateValueStore:l,collectionContextStore:c,isFullScreen:d,isRootChild:u}=e,g=(0,n.useRef)(null),[S,p]=(0,n.useState)(!1),h=(0,i().v3)(),b=(0,a().K8)((()=>{const e=r.drawStateStore.state;if(e)return e.startStore===t}),[t,r.drawStateStore]),y=(0,a().K8)((()=>!b&&r.hoveredItemStore.state===t&&!M().A.state),[b,t,r.hoveredItemStore]),v=(0,a().K8)((()=>(0,E().tH)(c)),[c]),f=(0,n.useCallback)((e=>{if(e.preventDefault(),!r.scrollLeftStore.state||!g.current)return;const n=(0,B().NM)(g.current);A().vt({timelineState:r,store:t,startX:e.startX,startY:e.startY,schema:o,collectionContextStore:c,verticalScroller:n}),p(!1)}),[c,o,t,r]),k=(0,n.useCallback)((e=>{if(!g.current)return;const t=(0,B().NM)(g.current);A().GZ({timelineState:r,currentX:e.currentX,currentY:e.currentY,verticalScroller:t})}),[r]),C=(0,n.useCallback)((()=>{R().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.handleDraggableDragEnd",environment:h,canUndo:!0,perform:e=>{A().sd({timelineState:r,environment:h,transaction:e,collectionContextStore:c,isFullScreen:d,isRootChild:u})}})}),[h,r,c,d,u]),I=(0,n.useCallback)((e=>{A().P7({timelineState:r,environment:h})}),[h,r]),w=(0,n.useCallback)((()=>{p(!0)}),[p]),D=(0,n.useCallback)((()=>{p(!1)}),[p]),P=(0,s().IS)((()=>({draggableStyle:{position:"absolute",top:0,insetInlineEnd:-O,width:O,height:"100%",zIndex:1,isolation:"auto"},draggableSvgStyle:{position:"absolute",insetInlineStart:0,cursor:"pointer"},svgPathStyle:{stroke:v?m().Tj.collectionValidDependencyArrow:m().Tj.collectionUnsetDependencyArrow,strokeWidth:E().cC},svgCircleFill:{color:m().Tj.white}})),[v]),j=(0,n.useCallback)((e=>{if(!l.state)return;const t=(0,F().A1)(),o=t?22:0,n=x().wc/2-1,r=t?12:10,i=x().wc/2-1,a=t?S?r-E().EZ:r:S?r+E().EZ:r;return(0,z.jsx)("div",{ref:g,style:P.draggableStyle,...e,children:y?(0,z.jsx)("div",{style:P.draggableSvgStyle,children:(0,z.jsxs)("svg",{style:{width:22,height:30},onMouseMove:w,onMouseLeave:D,children:[(0,z.jsx)(K().A,{startPoint:{x:o,y:n},endPoint:{x:r,y:i},style:P.svgPathStyle,showArrowHead:S,isRtl:t}),(0,z.jsx)("circle",{cx:a,cy:i,r:S?E().EZ:E().w7,style:P.svgPathStyle,fill:P.svgCircleFill.color})]})}):void 0})}),[l,D,w,y,P.draggableStyle,P.draggableSvgStyle,P.svgCircleFill.color,P.svgPathStyle,S]);return(0,z.jsx)(L().A,{render:j,onDraggableDragStart:f,onDraggableDragMove:k,onDraggableDragEnd:C,onDraggableDragCancel:I})}var N=()=>o(839106);const V=n.memo((function(e){const{type:t,store:o,query:r,schema:l,timelineState:u,dateValueStore:g,collectionContextStore:p,isInPeekRenderer:h,isFullScreen:b,isRootChild:y}=e,v=(0,i().v3)(),f=(0,S().tz)(),{value:k}=(0,c().fJ)(D().T.formulas),[C,I]=(0,n.useState)(!1),w=(0,a().K8)((()=>{const e=u.dragStateStore.state;return e?e.stores[0]===o&&("left"===t?e.type===E().MB.LeftResizer:e.type===E().MB.RightResizer):C&&!M().A.state}),[C,o,u,t]),P=(0,a().O$)(g),j=(0,a().O$)(u.zoomLevelStore),T=(0,s().IS)((()=>{const e={position:"absolute",top:6,borderRadius:3,width:3,bottom:6,background:m().Tj.text.primary},t={fontSize:12,position:"absolute",width:200,lineHeight:`${x().wc}px`,pointerEvents:"none"};return{leftDraggableIndicator:{...e,insetInlineStart:Math.ceil(3.5)},rightDraggableIndicator:{...e,insetInlineStart:Math.floor(.5)},leftDraggableLabel:{...t,insetInlineEnd:12,textAlign:"end"},rightDraggableLabel:{...t,insetInlineStart:12},timelineBackground:{background:h?m().Tj.peekTimelineBackground:m().Tj.timelineBackground,padding:4,borderRadius:6},rightDraggableStyle:{position:"absolute",top:0,insetInlineEnd:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"},leftDraggableStyle:{position:"absolute",top:0,insetInlineStart:-6,width:8,height:"100%",zIndex:1,cursor:"col-resize"}}}),[h]),B=(0,n.useCallback)((()=>I(!0)),[]),F=(0,n.useCallback)((()=>I(!1)),[]),K=(0,n.useCallback)((e=>{A().GB({timelineState:u,currentX:e.currentX})}),[u]),O=(0,n.useCallback)((()=>{R().createAndCommit({userAction:"TimelineItemResizer.handleDraggableDragEnd",environment:v,canUndo:!0,perform:e=>{A().eW({timelineState:u,collectionContextStore:p,query:r,schema:l,intl:f,environment:v,transaction:e})}}),(0,N().gp)(v,{...(0,N().ZR)({environment:v,collectionContextStore:p,timelineState:u,isFullScreen:b,isRootChild:y}),type:t})}),[p,v,f,b,y,r,l,u,t]),W=(0,n.useCallback)((e=>{e.preventDefault(),A().v7({timelineState:u,store:o,startX:e.startX,type:"left"===t?E().MB.LeftResizer:E().MB.RightResizer,query:r,schema:l,intl:f,environment:v,formulasModule:k})}),[v,f,r,l,o,u,t,k]),V=(0,n.useCallback)((()=>{A().Pt({timelineState:u,environment:v})}),[v,u]),$=(0,n.useCallback)((e=>{const o="left"===t;if(P)return(0,z.jsx)("div",{className:o?d().gPW:d().Zi0,style:o?T.leftDraggableStyle:T.rightDraggableStyle,onMouseMove:B,onMouseLeave:F,...e,children:w?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{style:o?T.leftDraggableIndicator:T.rightDraggableIndicator}),(0,z.jsx)("span",{style:o?T.leftDraggableLabel:T.rightDraggableLabel,children:(0,z.jsx)("span",{style:T.timelineBackground,children:o?(0,E()._D)(P,j):(0,E().ji)(P,j)})})]}):void 0})}),[P,j,F,B,w,T,t]);return(0,z.jsx)(L().A,{render:$,onDraggableDragStart:W,onDraggableDragMove:K,onDraggableDragEnd:O,onDraggableDragCancel:V})}),o(821062).A),$=Object.freeze({property:!0}),X=(0,S().YK)({typeAName:{defaultMessage:"Type a nameâ€¦",id:"timelineItem.itemName.placeholder"}}),H=21,q=800,Z=400;var U=function(e){return e[e.Absolute=0]="Absolute",e[e.Sticky=1]="Sticky",e}(U||{});function _({themeMode:e,position:t,backgroundColor:o,isInPeekRenderer:n}){return null!=t&&t.isPlaceholder?m().Tj.buttonHoveredBackground:o||("light"===e?m().Tj.background.primary:n?m().Tj.calendarItemBackground:m().Tj.popoverBackground)}function Y({themeMode:e,position:t}){if(null==t||!t.isPlaceholder)return"light"===e?m().Tj.shadowXS:m().Tj.shadowSM}function G(e){var t;const{timelineState:r,scrollerLeftOffset:u,itemPositionStore:g,store:m,query:p,schema:h,dateValueStore:b,disabled:y,isDraggingViaTimelineItemStore:v,collectionContextStore:f,isFullScreen:C,isRootChild:I,parentStore:w,toggleButton:P,isInPeekRenderer:j,handleOpenPeekPage:T,showProperties:B,clonedStore:F,blockPropertyValueOverlayStore:K,propertiesWrapElementRef:L}=e,O=(0,i().v3)(),N=(0,S().tz)(),{value:$}=(0,c().fJ)(D().T.formulas),X=(0,o(106412).Zp)(),Z=(0,a().O$)(g),G=(0,a().K8)((()=>{if(Z){const{left:e,right:t}=Z,o=t-e;if(!((0,E().zZ)(O)&&o>50))return{position:U.Absolute,left:e};{const n=r.scrollLeftStore.state;if(void 0!==n){const r=n+u-e+H;if(r<0)return{position:U.Absolute,left:e};if(r>o)return{position:U.Absolute,left:t};if(r>0)return{position:U.Sticky,left:u+H}}}}}),[O,Z,u,r.scrollLeftStore]),Q=(0,a().K8)((()=>{var e;const t=o(232615).default.state;if("editing"!==t.mode)return!1;const n=null===(e=(0,o(465628).H)(t.multiSelection))||void 0===e?void 0:e.store;return m&&n&&n===m.getBlockTitleStore()}),[m]),oe=(0,a().K8)((()=>(0,E().tH)(f)),[f]),re=(0,a().K8)((()=>r.hoveredItemStore.state===m),[m,r.hoveredItemStore]),le=(0,a().K8)((()=>{const{mainEditorCurrentBlockStore:e}=o(907258).default.state;if(m&&e)return k().wy({environment:O,store:m,mainEditorCurrentBlockStore:e,collectionContextStore:f,fullyQualified:!1})}),[O,f,m]),ie=(0,a().K8)((()=>{if(m)return(0,o(492414).Ay)({store:m,fullyQualified:!1,pageVisitSource:o(584262).y8.LinkInPage})}),[m]),ae=(0,a().K8)((()=>!y&&(null==m?void 0:m.canEdit())),[y,m]),se=(0,i().WS)(),ce=(0,a().K8)((()=>"collectionTypedView"===f.contextTypeFromStoreState),[f]),de=(0,a().K8)((()=>ae&&!se&&(oe||f.permissionScopesStore.state.canConfigureBlock)&&!ce),[ae,f.permissionScopesStore,se,ce,oe]),ue=(0,a().K8)((()=>f.currentSubitemFormatStoreForUiDisplayStore.state),[f]),ge=ue?42:10,Se=Z?Math.max(Z.right-Z.left,ge)+1:ge+1,me=(0,a().O$)(v),pe=(0,a().K8)((()=>{const e=w,t=(0,o(696887).AU)({collectionContextStore:f,collectionStore:e,environment:O}),n=null==m?void 0:m.getModel(),r=null==m?void 0:m.getRecordModel;if(!t||!n||!r)return!0;const i=l().default.getConfigKey("collection_request_settings","clientFormulaTimeoutMs");return(0,o(214388).oR)(t)({block:n,getRecordModel:r,propertyMapping:null==e?void 0:e.getPropertyMapping(),formulaTimeoutTimestampMs:Date.now()+i,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,experimentService:l().default,formulasModule:$,spaceIdCreator:O.idCreator.getSpaceIdCreatorSync((null==m?void 0:m.getSpaceId())||""),getRelationEdgeList:(0,o(842076).Y)({environment:O,spaceId:n.space_id})})}),[f,O,w,m,$]),he=(0,a().K8)((()=>m&&(0,o(968913).Wi)(O,m.id)),[O,m]),be=(0,a().O$)(f.isInHomeWidgetStore),ye=(0,a().K8)((()=>!!m&&k().NM(m)),[m]),ve=(0,a().K8)((()=>{const e=r.drawStateStore.state;return e&&e.startStore!==m}),[m,r.drawStateStore]),fe=null===(t=(0,o(825225).y)(m))||void 0===t?void 0:t.background,xe=(0,n.useMemo)((()=>(0,z.jsx)(J,{collectionContextStore:f,toggleButton:P,itemPositionStore:g})),[f,g,P]),ke=(0,s().eP)(),Ce=(0,s().IS)((()=>({linkBoxStyle:{width:"100%",height:"100%",borderRadius:6},linkBoxInnerStyle:{width:"100%",height:"100%",display:"flex",paddingInlineStart:6,paddingInlineEnd:6,borderRadius:6},container:{position:"absolute",insetInlineStart:null==Z?void 0:Z.left,marginTop:1,marginBottom:1,width:Se,height:x().wc-2,borderRadius:6,display:"flex",...null!=Z&&Z.isExistingSubitemPlaceholder?void 0:{background:_({themeMode:ke,position:Z,backgroundColor:fe,isInPeekRenderer:j}),boxShadow:Y({themeMode:ke,position:Z})},...(null==Z?void 0:Z.isPlaceholder)&&{cursor:"crosshair"},...me&&{display:"none"},...!pe&&{opacity:.5},...he&&{opacity:.5},zIndex:85},halo:{...k().wh(ye),borderRadius:6},propertiesContainer:{width:"100%",WebkitMaskImage:null!=Z&&Z.maskPercent&&(null==Z?void 0:Z.maskPercent)<1&&re?`linear-gradient(90deg, rgba(0,0,0,1) ${100*Z.maskPercent}%, rgba(0,0,0,0.4) ${100*Z.maskPercent}%)`:void 0,pointerEvents:"none",...me&&{display:"none"},zIndex:85,opacity:!pe||he?.5:1},propertiesWrapInnerStyle:{display:"flex",height:x().wc-2,paddingInlineStart:ue&&xe?24:6,width:q,overflow:"hidden"}})),[fe,me,re,j,pe,Z,ye,ue,xe,Se,he,ke]),Ie=(0,n.useCallback)((()=>{const e=null==L?void 0:L.current,t=G;e&&t&&(e.style.position=t.position===U.Absolute?"absolute":"sticky",e.style.insetInlineStart=`${t.left}px`)}),[G,L]),we=(0,n.useMemo)((()=>(0,z.jsx)("div",{style:Ce.propertiesContainer,children:(0,z.jsx)("div",{style:Ce.propertiesWrapInnerStyle,ref:L,className:d().st6,children:B.map(((e,t)=>(0,z.jsx)(ne,{showProperties:B,store:m,disabled:y,blockPropertyValueOverlayStore:K,clonedStore:F,collectionContextStore:f,parentStore:w,editingTitle:Q,property:e,index:t},e)))})})),[K,F,f,y,Q,w,L,B,m,Ce]),De=(0,n.useCallback)((e=>{m&&(r.dragStateStore.state||A().v7({timelineState:r,store:m,startX:e.startX,type:E().MB.ItemDrag,query:p,schema:h,intl:N,environment:O,formulasModule:$}),A().GB({timelineState:r,currentX:e.currentX}))}),[r,m,p,h,N,O,$]),Pe=(0,n.useCallback)((()=>{R().createAndCommit({userAction:"TimelineItemDateRange.handleSelectableDragEnd",environment:O,canUndo:!0,perform:e=>{A().eW({timelineState:r,collectionContextStore:f,query:p,schema:h,intl:N,environment:O,transaction:e})}})}),[r,f,p,h,N,O]),je=(0,n.useCallback)((()=>{A().Pt({timelineState:r,environment:O})}),[r,O]),Me=(0,n.useCallback)((e=>{const t=r.dragStateStore.state;(M().A.state||t)&&!ve||O.device.isPhone||r.hoveredItemStore.setState(m)}),[r,ve,O,m]),Te=(0,n.useCallback)((()=>{const e=r.dragStateStore.state;M().A.state}),[r,ve]);return(0,n.useEffect)((()=>{Ie()}),[G,Ie]),Z?!m||null!=Z&&Z.isPlaceholder?(0,z.jsxs)(z.Fragment,{children:[(0,z.jsx)("div",{style:Ce.container,className:d().KfS}),we]}):(0,z.jsxs)(z.Fragment,{children:[(0,z.jsxs)(o(692763).Ay,{style:Ce.container,haloStyle:Ce.halo,className:d().KfS,store:m,canSelect:!0,shouldShowHalo:!be,shouldForceRenderSelectionHalo:ye,canDrag:ae,analyticsName:"timeline",onDraggableDragStart:ee,onDraggableDragMove:De,onDraggableDragEnd:Pe,onDraggableDragCancel:je,canTriggerContextMenu:ae,getGhostElement:te,disableScrollToReveal:!0,onMouseMove:Me,onMouseLeave:Te,showBlockMenuInput:!0,children:[xe,(0,z.jsx)(o(996332).Q,{style:Ce.linkBoxStyle,innerStyle:Ce.linkBoxInnerStyle,onClick:T,href:ie,metaHref:le,hovered:re,ignoreLocalHoverState:!0,disabled:null==X?void 0:X.disablePageLinks,disableForOffline:he}),de&&m?(0,z.jsx)(W,{store:m,isFullScreen:C,isRootChild:I,schema:h,timelineState:r,dateValueStore:b,collectionContextStore:f}):void 0,ae&&!se?(0,z.jsx)(V,{type:"left",store:m,query:p,schema:h,timelineState:r,dateValueStore:b,collectionContextStore:f,isFullScreen:C,isInPeekRenderer:j,isRootChild:I}):void 0,ae&&!se?(0,z.jsx)(V,{type:"right",store:m,query:p,schema:h,timelineState:r,dateValueStore:b,collectionContextStore:f,isFullScreen:C,isInPeekRenderer:j,isRootChild:I}):void 0]}),we]}):null}const Q=n.memo(G);function J({collectionContextStore:e,toggleButton:t,itemPositionStore:o}){const n=(0,a().O$)(e.currentSubitemFormatStoreForUiDisplayStore),r=(0,a().O$)(o);return!n||!t||null!=r&&r.isExistingSubitemPlaceholder?null:(0,z.jsx)("span",{style:{display:"flex",alignItems:"center",zIndex:1,height:"100%"},children:t})}function ee(e){e.preventDefault()}function te(e){const t=j().T.findSelectablesFromStore(e),o=p().oE(t.map((e=>e.getNode()))),n=p().oE(o.map((e=>e.closest(`.${d().ZLF}`))))[0];if(n){const e=(0,r().u)(n),t=e.cloned.querySelector(`.${d().KfS}`),o=e.cloned.querySelector(`.${d().st6}`);return t&&o&&"sticky"===o.style.position&&(o.style.position="absolute",o.style.insetInlineStart=t.style.insetInlineStart),[e]}return o.map(r().u)}function oe({isLast:e,store:t,collectionContextStore:o,parentStore:r,editingTitle:l}){const s=(0,i().v3)(),c=(0,S().tz)(),d=(0,a().K8)((()=>null==t?void 0:t.getIcon()),[t]),b=(0,a().K8)((()=>null==o?void 0:o.shouldShowPageIcon()),[o]),x=(0,a().K8)((()=>null==t?void 0:t.hasError()),[t]),k=(0,a().K8)((()=>!t||t.isEmptyPage()),[t]),D=(0,a().K8)((()=>(0,C().Te)(t)),[t]),j=(0,a().O$)(o.currentSubitemFormatStoreForUiDisplayStore),M=(0,a().K8)((()=>{var e;return j&&r?null===(e=r.getSchema()[j.property])||void 0===e?void 0:e.name:""}),[r,j]),R=(0,a().K8)((()=>null==t?void 0:t.getBlockTitleStore()),[t]),{showParentItemIndicatorForBlock:A,showSubitemCountIndicatorForBlock:E}=(0,a().K8)((()=>t?{showParentItemIndicatorForBlock:(0,f().xC)({collectionContextStore:o,blockStore:t}),showSubitemCountIndicatorForBlock:(0,f().Kk)({collectionContextStore:o,blockStore:t})}:{showParentItemIndicatorForBlock:!1,showSubitemCountIndicatorForBlock:!1}),[o,t]),B=(0,n.useCallback)((()=>{t&&(0,P().L)({environment:s,store:t})}),[s,t]);return(0,z.jsxs)("div",{style:{display:"flex",marginInlineEnd:e?0:10,fontSize:14,fontWeight:h().Wy.medium,alignItems:"center"},children:[b&&d&&!x?(0,z.jsx)(C().B6,{disabled:!0,icon:d,iconRecordCategory:D,isEmptyPage:k,size:20,style:{marginInlineStart:2,marginInlineEnd:6}}):void 0,x?(0,z.jsx)(u().I,{icon:g().exclamationMarkTriangleFillSmallIcon,size:"sm",colorPalette:"orange",colorVariant:"accentPrimary",style:{display:"inline-block",verticalAlign:"text-top",marginInlineStart:4,marginInlineEnd:6}}):void 0,t&&!l?(0,z.jsx)(I().A,{style:{whiteSpace:"nowrap",maxWidth:Z},store:t}):void 0,l&&t&&R?(0,z.jsx)(T().A,{store:R,style:{whiteSpace:s.device.isFirefox?"pre":"nowrap"},disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:B,onEsc:B,onTab:p().D_,placeholder:c.formatMessage(X.typeAName),disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:w().Os.none,disabledMentionTypes:$}):void 0,t&&A?(0,z.jsx)("div",{style:{paddingTop:2,paddingInlineStart:4},children:(0,z.jsx)(y().n,{blockStore:t,collectionContextStore:o})}):void 0,t&&E?(0,z.jsx)("div",{style:{paddingTop:2,paddingInlineStart:8,color:m().Tj.text.tertiary},children:(0,z.jsx)(v().W,{blockStore:t,collectionContextStore:o})}):void 0,t?void 0:(0,z.jsx)("span",{children:r&&M?(0,z.jsx)(S().sA,{defaultMessage:"New page in {propertyName}",id:"timeline.itemPlaceholder.nest.addSubitemWithPropertyName",values:{propertyName:M}}):(0,z.jsx)(S().sA,{id:"timeline.itemPlaceholder.newPage",defaultMessage:"New page"})})]},"title")}function ne({property:e,index:t,showProperties:o,store:n,disabled:r,blockPropertyValueOverlayStore:l,clonedStore:i,collectionContextStore:s,parentStore:c,editingTitle:d}){const u=t===o.length-1,g=(0,a().K8)((()=>null==n?void 0:n.getAssociatedCollectionStore()),[n]),S=(0,a().K8)((()=>null==n?void 0:n.canEdit()),[n]),m=(0,a().K8)((()=>s.collectionViewStore()),[s]);return g?"title"===e?(0,z.jsx)(oe,{store:n,collectionContextStore:s,parentStore:c,editingTitle:d,isLast:u}):n&&i?(0,z.jsx)(b().BlockPropertyRouter,{store:i,property:e,disabled:r||!S,locked:!1,surface:"timeline",tableWrap:!1,isLast:u,blockPropertyValueOverlayStore:l,enablePointerEventsForInteractiveTypes:!0,collectionStore:g,collectionViewStore:m},e):null:null}}}]);