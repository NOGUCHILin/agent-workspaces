(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[65213],{32243:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});class a extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}}const i=new a},37458:(e,t,n)=>{e.exports=n(708009)},117184:(e,t,n)=>{"use strict";function a(e){return Boolean(e.getSetting("self_serve_enterprise_eligible"))}n.d(t,{h:()=>a})},166947:(e,t,n)=>{"use strict";n.d(t,{n:()=>r});var a=()=>n(613848),i=()=>n(124958);async function r({environment:e,spaceStore:t}){const n=t.id;await Promise.all([(0,i().x)(e,n),a().A.resetData(e,{spaceId:n,userId:e.currentUser.id})])}},227151:(e,t,n)=>{"use strict";n.d(t,{R:()=>l});var a=()=>n(613848),i=()=>n(973992),r=()=>n(805061),s=()=>n(981046),o=()=>n(329862),d=()=>n(779795),c=()=>n(124958);async function l({environment:e,spaceStore:t}){const n=t.id;s().H.setState({...s().H.state,status:"init"}),await Promise.all([d().$W({environment:e,spaceId:n}),(0,c().x)(e,n),r().c.resetData(e,{spaceId:n}),i().L.resetData(e,{spaceId:n}),o().A.resetData(e,{spaceId:n}),a().A.resetData(e,{spaceId:n,userId:e.currentUser.id})])}},271084:(e,t,n)=>{"use strict";n.d(t,{k:()=>i});n(581454);class a extends(()=>n(757695))().Store{getInitialState(){}waitUntilLoaded(){return this.waitUntil((()=>Boolean(this.state)))}getSortedUserIds(){return Object.entries(this.state||{}).sort((([e,t],[n,a])=>a-t)).map((([e,t])=>e))}}const i=new a;(0,n(852832).exposeDebugValue)("UserSimilarityStore",i)},350893:(e,t,n)=>{"use strict";n.r(t),n.d(t,{applyStudentGitHubGrant:()=>ne,closeSubscriptionUpgradeModal:()=>G,ensureSubscriptionDataIsFetched:()=>x,handleIntentNextAction:()=>l().u,handlePaymentIntentNextActions:()=>te().X,handlePlanChangeClick:()=>ee,maybeOpenPostUpgradeModal:()=>i().u,messages:()=>c().D,openSubscriptionUpgradeModal:()=>q,refreshAllBillingData:()=>u().o,refreshNonReactiveBillingData:()=>w().R,refreshSubscriptionData:()=>_().x,refreshUserData:()=>I().n,trackSubscriptionUpdate:()=>r().i,updateAddress:()=>y,updateBillingEmail:()=>h,updatePaymentMethod:()=>p,updateSidebarSpace:()=>F,updateSubscription:()=>a().n,updateSubscriptionToEducationPlan:()=>ce,updateVatId:()=>b,validatePaymentMethod:()=>m});var a=()=>n(589531),i=()=>n(800168),r=()=>n(311638),s=()=>n(675133),o=()=>n(792057),d=()=>n(753812),c=()=>n(435777),l=()=>n(565744),u=()=>n(335014);async function p(e){const{environment:t,stripe:n,spaceStore:a,paymentMethodId:i}=e,r=await d().callApi({eventName:"updatePaymentMethod",environment:t,data:{spaceId:a.id,paymentMethodId:i}});if("failed"!==r.type){if(r.data.clientSecret&&"requires_action"===r.data.status){if("succeeded"!==await(0,l().u)({stripe:n,clientSecret:r.data.clientSecret}))return void o().f1(s().A.formatMessage(c().D.paymentMethodUpdateAuthFailed));const e=await d().callApi({eventName:"setDefaultPaymentMethod",environment:t,data:{spaceId:a.id,paymentMethodId:i}});if("failed"===e.type)return void o().Qg(e)}await(0,u().o)({environment:t,spaceStore:a})}else o().Qg(r)}async function m(e){const{environment:t,spaceStore:n,paymentMethodId:a}=e,i=await t.api.callCellCompatibleApi({eventName:"updatePaymentMethod",environment:t,data:{spaceId:n.id,paymentMethodId:a},cellNavigation:{spaceId:n.id}});return"failed"===i.type?(o().Qg(i),"failed"):i.data.clientSecret&&"requires_action"===i.data.status?(o().f1(s().A.formatMessage(c().D.useAnotherPaymentMethod)),"failed"):"success"}var f=()=>n(702538),v=()=>n(934839),S=()=>n(496414),g=()=>n(150193);async function y(e){const{environment:t,spaceStore:n,address:a}=e;v().Re({bannerStore:g().A}),S().m({message:c().D.updatingSubscription});const i=await d().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,address:a}});if("failed"===i.type)throw S().V(),o().Qg(i),i.error;(0,f().p)(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!0}),await(0,u().o)({environment:t,spaceStore:n}),S().V()}async function b(e){const{environment:t,spaceStore:n,vatId:a}=e;v().Re({bannerStore:g().A}),S().m({message:c().D.updatingSubscription});const i=await t.api.callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,vatId:a}});if("failed"===i.type)throw S().V(),o().Qg(i),i.error;(0,f().p)(t,{billing_email_changed:!1,plan_changed:!1,billing_address_changed:!1}),await(0,u().o)({environment:t,spaceStore:n}),S().V()}async function h(e){const{environment:t,spaceStore:n,email:a}=e;v().Re({bannerStore:g().A}),S().m({message:c().D.updatingSubscription});const i=await d().callApi({eventName:"updateBillingInformation",environment:t,data:{spaceId:n.id,billingEmail:a}});if("failed"===i.type)throw S().V(),o().Qg(i),i.error;(0,f().p)(t,{billing_email_changed:!0,plan_changed:!1,billing_address_changed:!1}),await(0,u().o)({environment:t,spaceStore:n}),S().V()}var w=()=>n(227151),I=()=>n(166947),_=()=>n(124958),A=()=>n(755531),D=()=>n(983610);async function x(e){var t;const{environment:n}=e,a=e.spaceId??(null===(t=(0,A().S)())||void 0===t?void 0:t.id),i=n.currentUser.id;a&&i&&(D().subscriptionDataStoreInstance.state&&D().subscriptionDataStoreInstance.spaceId===a&&D().subscriptionDataStoreInstance.userId===i||await(0,_().x)(n,a))}var M=()=>n(529803),C=()=>n(780262),P=()=>n(271084),O=()=>n(852273),N=()=>n(921997),T=()=>n(496603),E=()=>n(134217);async function U(e){const{environment:t,spaceId:n}=e,a=(0,N().GM)({spaceId:n});if(!B||B!==a){let n;!function(e){k&&O().Ay.removeListener(k,e)}(t);const i=({value:t})=>{void 0!==n&&n!==t&&j(e),n=t},r=T().nF(i,5e3);k=O().Ay.addListener(a,void 0,r,void 0,t),B=a;const s=M().A.state;if(!Object.keys(s).length)return j(e)}}async function j(e){const{environment:t,spaceId:n}=e;if((0,E().e9)(t,n))return;const a=await d().callCellCompatibleApi({eventName:"getBillingSubscriptionBannerData",environment:t,data:{spaceId:n},cellNavigation:{cellId:void 0,spaceId:n}});var i;"success"===a.type&&((null===(i=(0,A().S)())||void 0===i?void 0:i.id)===n&&M().A.setState(a.data.bannerData));const r=await d().callApi({eventName:"getSubscriptionEntitlements",environment:t,data:{spaceId:n}});var s;"success"===r.type&&((null===(s=(0,A().S)())||void 0===s?void 0:s.id)===n&&C().A.setState(r.data))}let k,B;async function F(e){const{environment:t,spaceId:n,isNewlyCreatedSpace:a}=e,i=D().subscriptionDataStoreInstance.spaceId;if(!t.currentUser.isLoggedIn()||i&&i===n)await D().subscriptionDataStoreInstance.waitUntilLoaded();else{if(M().A.setState({}),U({environment:t,spaceId:n}),C().A.setState({}),a){const e={type:"unsubscribed_admin",accountBalance:0,users:[],joinedMemberIds:[],blockUsage:0,hasPaidNonzero:!1,userSimilarity:{},spaceUsers:[],members:[],customerData:void 0,revenueCatEnabled:!1};D().subscriptionDataStoreInstance.setState(e),D().subscriptionDataStoreInstance.spaceId=n,D().subscriptionDataStoreInstance.userId=t.currentUser.id,P().k.setState(e.userSimilarity)}(0,_().x)(t,n)}}var L=()=>n(206267),V=()=>n(720503);function q(e){const{subscriptionTier:t,from:n,addOnFeature:a,isTrial:i,dismissMobilePlansModal:r,postUpgradeCallback:s,offer:o}=e,d=L().JW();V().A.open({from:n,subscriptionTier:t,billingInterval:"month",addOnFeature:a,isTrial:i,sessionId:d,dismissMobilePlansModal:r,postUpgradeCallback:s,offer:o})}var Q=()=>n(805501);function G(e){const t=V().A.state;t.open&&((0,Q().O)(e,{modal_id:t.sessionId}),V().A.setState({open:!1}))}n(16280);var H=()=>n(342641),R=()=>n(165358),W=()=>n(795523),$=()=>n(47273),J=()=>n(323063),Y=()=>n(166386),Z=()=>n(534177),z=()=>n(931513),K=()=>n(995604),X=()=>n(779795);async function ee(e){var t,n;const{environment:i,product:r,spaceStore:s,from:o,pageSection:d,churnState:c,billingData:l}=e,u=await X().p_({environment:i,spaceId:s.id}),p=l.subscription;if(!(p&&(0,Z().O9)(l.paymentMethod)||"free"===r))return void q({subscriptionTier:r,from:o});const m=(0,W().lQ)(l),f=(0,W().Ry)(l),v=(0,$().yw)(m),S=(0,$().yw)(p),g=v??S,y=(null===(t=(0,W().KH)(l,"sites_custom_hostnames"))||void 0===t?void 0:t.quantity)??0,b=(null===(n=(0,W().KH)(l,"ai_credit_pack"))||void 0===n?void 0:n.quantity)??0,h=(0,$().GB)({spaceId:s.id,logFunction:R().log.bind(R()),subscriptionState:m}),w=(0,$().GB)({spaceId:s.id,logFunction:R().log.bind(R()),subscriptionState:p}),I=h??w;let _;if("free"===r)_=(0,J().gL)(m,"plan");else{if(!(f&&g&&I))throw new Error("Trying to update plan on a subscription with no items");_=(0,J().ef)({state:m,prices:u,quantities:{numSeats:I,numCustomHostnames:y,numAiCreditPacks:b},params:{currency:f,interval:g},products:[r]})}if(!T().n4(m,_)){if((0,J().V5)(m,_)){if("no_churn"===c||!c)return;const e=H().default.getData(i,{spaceId:null==s?void 0:s.id}),t=(0,Y().e8)(e,"coupon");if((0,K().s)(t,m,_,(0,W().DS)(l))){if(!(await(0,K().Z)(i)))return}return await(0,a().n)({environment:i,spaceStore:s,desiredState:_,from:o,performImmediately:"churn_immediately"===c})}(0,z().o)(i,{desiredProducts:[r],from:o,analyticsArgs:{from:o,pageSection:d}})}}var te=()=>n(585262);async function ne(e){const{environment:t,data:n}=e;await d().callApi({eventName:"applyStudentGitHubGrant",environment:t,data:n})}n(296540);var ae=()=>n(314529);var ie=()=>n(965378),re=()=>n(634596),se=()=>n(482813),oe=n(474848);async function de({data:e,spaceId:t,environment:n}){const a=()=>{(0,i().u)({oldTier:e.subscriptionTier??"free",newTier:"student",oldAddOns:[],newAddOns:[]})||o().rG({message:s().A.formatMessage(c().D.educationPlusFree)}),H().default.resetData(n,{spaceId:t}),se().Ay.setState({...se().Ay.state,currentTab:"billing",defaultSubtab:void 0});const a=E().RJ(e);!function(e,t){(0,ae().DO_NOT_USE_trackLegacy)(e,"subscription_update_plan",t)}(n,{plan:"student_free",old_plan:a?a.plan:void 0})};await re().TQ(n)?ie().r({onSubmit:a,onCancel:a}):a()}const ce=(0,T().sg)((async function(e){const{environment:t,spaceStore:a,code:i}=e;S().m({message:c().D.verifyingEligibility});const r=D().subscriptionDataStoreInstance.state;if(!r)throw new Error("Subscription data not loaded.");const s=await t.api.callApi({eventName:"updateSubscriptionToEducationPlan",environment:t,data:{spaceId:a.id,code:i}});"failed"===s.type?o().Qg(s):s.data.isEligible?(await(0,u().o)({environment:t,spaceStore:a}),de({data:r,spaceId:a.id,environment:t})):n(32243).A.setState({open:!0,handlePromoCode:async e=>{S().m({message:c().D.updatingSubscription});const i=await t.api.callApi({eventName:"updateSubscriptionToEducationPlan",environment:t,data:{spaceId:a.id,code:e}});"failed"===i.type?o().Qg(i):i.data.isEligible?(await(0,u().o)({environment:t,spaceStore:a}),de({data:r,spaceId:a.id,environment:t})):o().f1((0,oe.jsx)(n(69708).sA,{id:"subscriptionSettings.invalidPromoCodeError.message",defaultMessage:"This promo code is not valid."})),S().V()}}),S().V()}),1e3,{leading:!0,trailing:!1})},495106:(e,t,n)=>{"use strict";n.d(t,{T:()=>a});const a=new(n(62175).U)((e=>`${e.currentUser.id}`),(async e=>{const t=await e.api.callApi({eventName:"getExternalOrgData",environment:e,data:{}});return"success"===t.type?t.data:void 0}));n(852832).exposeDebugValue("ExternalOrgDataStore",a)},503416:(e,t,n)=>{"use strict";n.d(t,{r:()=>a});const a=(0,n(340498).xh)("arrowInCircleDown",{default:{loader:()=>n.e(96029).then(n.bind(n,973238))},small:{loader:()=>n.e(96029).then(n.bind(n,747012))},fill:{loader:()=>n.e(96029).then(n.bind(n,561604))},fillSmall:{loader:()=>n.e(96029).then(n.bind(n,613131))}},["arrow","circle","down","direction","pointer","downgrade"])},529803:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});class a extends(()=>n(757695))().Store{}const i=new a},565744:(e,t,n)=>{"use strict";n.d(t,{u:()=>a});n(16280);async function a({stripe:e,clientSecret:t}){const{paymentIntent:n,setupIntent:a,error:i}=await e.handleNextAction({clientSecret:t});if(n)return n.status;if(a)return a.status;if(i.payment_intent)return i.payment_intent.status;if(i.setup_intent)return i.setup_intent.status;throw new Error(`Unexpected error handling intent: ${i.message}`)}},585262:(e,t,n)=>{"use strict";n.d(t,{X:()=>s});var a=()=>n(496414),i=()=>n(435777),r=()=>n(565744);async function s(e){a().m({message:i().D.finishingUp});const{paymentIntentData:t,stripe:n,onSuccess:s,onFailure:o}=e,d=t.paymentIntentClientSecret;let c=t.paymentIntentStatus;d&&"requires_action"===c&&(c=await(0,r().u)({stripe:n,clientSecret:d})),"succeeded"===c||"processing"===c?null==s||s():function({status:e}){return["requires_payment_method","requires_source"].includes(e)}({status:c})&&(null==o||o()),a().V()}},644837:(e,t,n)=>{"use strict";n.d(t,{j:()=>i});class a extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}open(e){this.setState({open:!0,...e})}}const i=new a},708009:(e,t)=>{"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}var a,i="https://js.stripe.com/v3",r=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,s="loadStripe.setLoadParameters was called but an existing Stripe.js script already exists in the document; existing script parameters will be used",o=null,d=function(e){return null!==o||(o=new Promise((function(t,n){if("undefined"!=typeof window&&"undefined"!=typeof document)if(window.Stripe&&e&&console.warn(s),window.Stripe)t(window.Stripe);else try{var a=function(){for(var e=document.querySelectorAll('script[src^="'.concat(i,'"]')),t=0;t<e.length;t++){var n=e[t];if(r.test(n.src))return n}return null}();a&&e?console.warn(s):a||(a=function(e){var t=e&&!e.advancedFraudSignals?"?advancedFraudSignals=false":"",n=document.createElement("script");n.src="".concat(i).concat(t);var a=document.head||document.body;if(!a)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return a.appendChild(n),n}(e)),a.addEventListener("load",(function(){window.Stripe?t(window.Stripe):n(new Error("Stripe.js not available"))})),a.addEventListener("error",(function(){n(new Error("Failed to load Stripe.js"))}))}catch(o){return void n(o)}else t(null)}))),o},c=function(e){var t="invalid load parameters; expected object of shape\n\n    {advancedFraudSignals: boolean}\n\nbut received\n\n    ".concat(JSON.stringify(e),"\n");if(null===e||"object"!==n(e))throw new Error(t);if(1===Object.keys(e).length&&"boolean"==typeof e.advancedFraudSignals)return e;throw new Error(t)},l=!1,u=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];l=!0;var i=Date.now();return d(a).then((function(e){return function(e,t,n){if(null===e)return null;var a=e.apply(void 0,t);return function(e,t){e&&e._registerWrapper&&e._registerWrapper({name:"stripe-js",version:"1.52.1",startTime:t})}(a,n),a}(e,t,i)}))};u.setLoadParameters=function(e){if(l&&a){var t=c(e);if(Object.keys(t).reduce((function(t,n){var i;return t&&e[n]===(null===(i=a)||void 0===i?void 0:i[n])}),!0))return}if(l)throw new Error("You cannot change load parameters after calling loadStripe");a=c(e)},t.loadStripe=u},720503:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});class a extends(()=>n(757695))().Store{getInitialState(){return{open:!1}}closeWithSuccess(){this.setState({open:!1,succeeded:!0})}closeWithFailure(){this.setState({open:!1,succeeded:!1})}open(e){const{subscriptionTier:t,addOnFeature:n,billingInterval:a,isTrial:i,sessionId:r,dismissMobilePlansModal:s,postUpgradeCallback:o,from:d,offer:c}=e;this.setState({open:!0,temporaryBillingInterval:a,temporaryAddress:{name:"",businessName:"",addressLine1:"",addressLine2:"",zipCode:"",city:"",state:"",country:""},appliedPromo:void 0,error:void 0,subscriptionTier:t,vatApplicable:!1,calculatingTax:!1,payButtonState:"enabled",type:"current_space",addOnFeature:n,onlyShowAddOn:void 0!==n,sessionId:r,isTrial:i,dismissMobilePlansModal:s,postUpgradeCallback:o,from:d,offer:c})}setAddressField(e){this.state.open&&this.setState({...this.state,temporaryAddress:{...this.state.temporaryAddress,...e},taxCalculationError:void 0})}}const i=new a},805501:(e,t,n)=>{"use strict";n.d(t,{O:()=>i});var a=()=>n(314529);function i(e,t){(0,a().DO_NOT_USE_trackLegacy)(e,"subscription_upgrade_modal_exit",t)}},931513:(e,t,n)=>{"use strict";n.d(t,{A:()=>d,o:()=>o});var a=()=>n(314529);var i=()=>n(206267),r=()=>n(981046),s=()=>n(644837);function o(e,t){const n=i().JW();!function(e,t){(0,a().DO_NOT_USE_trackLegacy)(e,"subscription_update_modal_open",t)}(e,{modal_id:n,currency_code:r().H.selectedCurrencyCode,...t.analyticsArgs,desiredProducts:t.desiredProducts,desiredInterval:t.desiredInterval}),s().j.open({modalId:n,...t})}function d(e,t){!function(e,t){(0,a().DO_NOT_USE_trackLegacy)(e,"subscription_update_modal_exit",{modal_id:t.modalId})}(e,{modalId:t}),s().j.setState({open:!1})}},946473:(e,t,n)=>{"use strict";n.d(t,{H:()=>s,q:()=>r});var a=()=>n(117184),i=()=>n(795523);function r(e,t,n){return s(e,t,n)&&!(0,i().N8)(n)&&Boolean(!t||!(0,a().h)(t))}function s(e,t,n){if(n&&(0,i().N8)(n))return!0;if(null!=t&&t.getSpaceId()){const e=t.getMemberCountFromPublicSpaceData()??1;if(e&&e>99)return!0}return!!(0,i().N8)(n)||!(!e||!("company_employee_count"in e))&&parseInt(e.company_employee_count)>99}},995604:(e,t,n)=>{"use strict";n.d(t,{s:()=>h,Z:()=>w});n(296540);var a=()=>n(564884),i=()=>n(755531),r=()=>n(394888),s=()=>n(740461),o=()=>n(753812),d=()=>n(49210),c=()=>n(89002),l=()=>n(416783),u=()=>n(503416),p=()=>n(69708),m=()=>n(241021),f=()=>n(838239),v=()=>n(227358),S=()=>n(232930),g=n(474848);function y({onAccept:e}){return(0,g.jsx)(c().t,{header:(0,g.jsx)(f().Y,{iconAndTitle:(0,g.jsx)(v().Z,{iconGroup:u().r,iconColorPalette:"red",iconColorVariant:"accentPrimary",title:(0,g.jsx)(p().sA,{id:"voidOfferModal.title",defaultMessage:"Are you sure?"})}),description:(0,g.jsx)(p().sA,{id:"voidOfferModal.subtitle",defaultMessage:"If you continue, your current discount will no longer be applied. See <terms>terms and conditions</terms> for more information.",values:{terms:e=>(0,g.jsx)(l().V,{external:!0,href:(0,S().x)("resurrectionLearnMore"),children:e})}})}),footer:(0,g.jsx)(m().a,{layout:"vertical",primaryButtons:[{buttonType:"destructive",label:(0,g.jsx)(p().sA,{id:"voidOfferModal.primaryAction",defaultMessage:"Yes and remove discount"}),onClick:e}],secondaryButtons:[{buttonType:"dismiss",label:(0,g.jsx)(p().sA,{id:"voidOfferModal.cancelButton",defaultMessage:"Cancel"})}]})})}const b=406;function h(e,t,n,a){const i=(0,s().ex)(e,t,a);return!!i&&!(0,s().d$)(i.campaign,n)}async function w(e){var t;const n=null===(t=(0,i().S)())||void 0===t?void 0:t.id;return await d().T.showAsyncModal((t=>(0,g.jsx)(r().s,{isOpen:t.isOpen,onDismiss:()=>{(0,a().u)({environment:e,event:{eventName:"void_offer_modal_dismiss",eventProperties:{}}}),t.onDismiss()},onClosed:t.onClosed,areaConstraint:{width:{type:"min",length:b},height:{type:"unlimited",scroll:"allow"}},render:()=>(0,g.jsx)(y,{onAccept:async()=>{(0,a().u)({environment:e,event:{eventName:"void_offer_modal_accept",eventProperties:{}}}),n&&await o().callApi({eventName:"voidCustomerOffer",environment:e,data:{spaceId:n}}),t.resolve("accepted")}})})))}}}]);