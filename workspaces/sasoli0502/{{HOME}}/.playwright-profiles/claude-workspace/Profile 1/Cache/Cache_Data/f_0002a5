"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[14344,17693,33220,48486,95576],{31902:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=()=>o(69708),i=o(474848);const r=function({collectionViewName:e,collectionViewType:t}){return(0,o(59226).X)("allow_empty_view_name")&&""===e?null:e?(0,i.jsx)(o(288722).A,{children:e}):"page"===t?(0,i.jsx)(n().sA,{id:"database.collectionView.untitledName.untitled",defaultMessage:"Untitled"}):(0,i.jsx)(n().sA,{...o(403905).X[t]})}},37824:(e,t,o)=>{o.d(t,{A:()=>r});var n=()=>o(821062);class i extends(()=>o(757695))().Store{getInitialState(){return{automationActionStore:void 0,automationStore:void 0,contextType:void 0,typecheckResult:void 0}}blur(e){void 0!==this.state.automationStore&&(void 0===e||(0,n().A)(this.state,e))&&this.setState({automationActionStore:void 0,automationStore:void 0,contextType:void 0,typecheckResult:void 0})}focus(e){(0,n().A)(this.instanceState,e)||this.setState(e)}}const r=new i;(0,o(852832).exposeDebugValue)("AutomationFocusStore",i)},39620:(e,t,o)=>{o.d(t,{L:()=>we,g:()=>j});o(898992),o(672577);var n=o(296540),i=()=>o(726637),r=()=>o(590526),a=()=>o(420802),s=()=>o(898244),l=()=>o(713998),c=()=>o(784892),d=()=>o(239381),u=()=>o(791089),p=()=>o(201980),m=()=>o(973647),g=()=>o(534177),y=()=>o(529135),h=()=>o(436876),f=()=>o(576241),v=()=>o(546461),x=()=>o(554548),S=()=>o(399762),b=()=>o(79877),A=()=>o(744951),C=()=>o(805452),k=o(474848);function j(e){const{token:t,disabled:o,setCurrentTokens:n,currentSimpleFormulaValueTokens:j,context:I,parentRecordStore:M}=e,T=(0,v().K4)(),w=null==T?void 0:T.typecheckResult,P=(0,r().K8)((()=>{if("collection"===I.type)return(0,C().aS)(I)}),[I]),_=(0,r().K8)((()=>{if("collection"===I.type)return I.collectionStore.getSchema()[I.property]}),[I]);if("string"==typeof t){if(!_||!(0,s().DQ)(_))return null;const e=(0,l().jy)((null==_?void 0:_.options)??[],t);if(!e)return(0,k.jsx)(y().A,{isSingle:!1,showRemoveButton:!o,onClickRemove:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))}},`deleted_option_value_${t}`);const r={value:e.value,color:e.color,isSingle:!1,showRemoveButton:!o,format:i().A.isMobile?c().NY.Medium:c().NY.Small,onClickRemove:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))}};if((0,s().DD)(_)){var B;const t=null===(B=_.groups)||void 0===B||null===(B=B.find((t=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)})))||void 0===B?void 0:B.color;return(0,k.jsx)(S().q,{...r,groupColor:t})}return(0,k.jsx)(S().O,{...r})}if("boolean"==typeof t)return(0,k.jsx)(a().S,{checked:t,disabled:!0,size:16,style:{marginBottom:6}},t.toString());if((0,p().rie)(t)||(0,p().RaC)(t)){const e=(0,p().RaC)(t)?{marginBottom:6,marginInlineEnd:6}:void 0;return(0,k.jsx)(f().A,{parentRecordStore:M,handleRemoveToken:o?void 0:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))},token:t,style:e})}if((0,p().s1Y)(t)){const e=(0,p().iVq)(t).id,i=w&&m().Q.isSuccess(w)?(0,d().IV)(w.value.valueTypes,e):void 0;return i?(0,k.jsx)(A().F,{value:i,format:c().NY.Small,isSingle:!1,shouldShrink:!0,showRemoveButton:!o,onClickRemove:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))},style:{marginTop:0,marginInlineEnd:6,marginBottom:6,marginInlineStart:0}}):null}if((0,p().qsB)(t)){const e=j[0],t=e&&(0,u().isAnnotationSimpleValueToken)(e)&&(0,p().qsB)(e)?(0,p().K7D)(e):void 0;return t&&P?(0,k.jsx)(b().A,{value:t,dateFormat:P.dateFormat,timeFormat:P.timeFormat,style:{marginBottom:6}}):null}if((0,p().jIt)(t)){const e=(0,p().v55)(t);return e?(0,k.jsx)(x().A,{format:i().A.isMobile?c().NY.Medium:c().NY.Small,blockId:e,shouldWrap:!1,shouldShrink:!0,isSingle:!1,parentStore:M,showRemoveButton:!o,onClickRemove:()=>{null==n||n((0,u().simpleFormulaValueWithoutToken)(j,t))}},e):null}if((0,p().iz3)(t))return(0,k.jsx)(h().A,{token:t});(0,g().HB)(t)}var I=()=>o(300474),M=(o(18107),o(967357),()=>o(439612)),T=()=>o(37824);function w(){const e=(0,v().K4)(),{menuStore:t}=(0,n.useContext)(M().S),{automationActionId:o,insertionPoint:i}=(0,r().K8)((()=>{const e=null==t?void 0:t.getCurrentTab();return{automationActionId:"eventActionProperty"===(null==e?void 0:e.type)?e.actionId:void 0,insertionPoint:null==t?void 0:t.getInsertionPoint()}}),[t]),a=(0,r().K8)((()=>{var t;return o?null==e||null===(t=e.automationStore)||void 0===t?void 0:t.findActionStoreById(o):function(e,t){if(!e)return;const o=e.getActionIds(),n=e.getActionStores();if(!t)return;if("beforeActionId"in t){const e=o.indexOf(t.beforeActionId)-1;return e<=0?n.at(0):n.at(e)}if("afterActionId"in t){const e=o.indexOf(t.afterActionId);if(-1===e)return;return n.at(e+1)}(0,g().HB)(t)}(null==e?void 0:e.automationStore,i)}),[o,i,null==e?void 0:e.automationStore]);(0,n.useEffect)((()=>{if(e&&m().Q.isSuccess(e.typecheckResult)){const{automationStore:t,contextType:o,typecheckResult:n}=e;return T().A.focus({automationStore:t,contextType:o,typecheckResult:n.value,automationActionStore:a}),function(){T().A.blur({automationStore:t,contextType:o,typecheckResult:n.value,automationActionStore:a})}}}),[a,e])}var P=()=>o(227124),_=()=>o(862314),B=()=>o(717322),R=()=>o(626792),V=(o(944114),o(581454),()=>o(401497)),E=()=>o(245720),F=()=>o(546926),D=()=>o(890492),L=()=>o(449279),O=()=>o(663639),K=()=>o(736847),N=()=>o(69708),W=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(354520),o(908872),()=>o(908006)),z=()=>o(484714),U=()=>o(352321),H=()=>o(452004),Y=()=>o(247331),G=()=>o(778078),q=()=>o(496603),$=()=>o(821481),Q=()=>o(534674),X=()=>o(120423);function Z({disabled:e,handleRemoveToken:t,propertySchema:o,token:r}){const a=(0,n.useCallback)((()=>{t&&t(r)}),[t,r]);if("string"!=typeof r||!o||!(0,s().DQ)(o))return null;const d=(0,l().jy)((null==o?void 0:o.options)??[],r);if(!d)return(0,k.jsx)(y().A,{isSingle:!1,showRemoveButton:!e,onClickRemove:a},`deleted_option_value_${r}`);if((0,s().DD)(o)){var u;const t=null===(u=o.groups)||void 0===u||null===(u=u.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(d.id)})))||void 0===u?void 0:u.color;return(0,k.jsx)(S().q,{color:d.color,format:i().A.isMobile?c().NY.Medium:c().NY.Small,groupColor:t,isSingle:!1,onClickRemove:a,showRemoveButton:!e,value:d.value})}return(0,k.jsx)(S().O,{color:d.color,format:i().A.isMobile?c().NY.Medium:c().NY.Small,isSingle:!1,onClickRemove:a,showRemoveButton:!e,value:d.value})}var J=()=>o(262509),ee=()=>o(238259),te=()=>o(81068);function oe({isChecked:e,checkType:t,menuArgs:o,onCheckboxClick:n,option:r}){return(0,k.jsx)(te().A,{...o,..."single"===t?{isChecked:e}:{},..."multi"===t?{icon:(0,k.jsx)(a().S,{checked:e,size:14,onClick:n})}:{},title:(0,k.jsx)(S().O,{value:r.value,color:r.color,showRemoveButton:!1,isSingle:!0,shouldShrink:!0,format:i().A.isMobile?c().NY.Large:c().NY.Small}),isTokenTitle:!0})}function ne({isChecked:e,checkType:t,menuArgs:o,onCheckboxClick:n,option:r,group:s}){return(0,k.jsx)(te().A,{...o,..."single"===t?{isChecked:e}:{},..."multi"===t?{icon:(0,k.jsx)(a().S,{checked:e,size:14,onClick:n})}:{},title:(0,k.jsx)(S().q,{color:r.color,format:i().A.isMobile?c().NY.Large:c().NY.Small,groupColor:null==s?void 0:s.color,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:r.value},r.value),isTokenTitle:!0})}function ie(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:a,formulaValueContext:l,isSingle:c,menuProps:m,onChange:g,onClose:y,showClearButton:h=!1,showInputMenuItem:f=!1,showReplaceAddRemoveToggle:v=!1,type:x,value:S,parentRecordStore:b}=e,A=(0,V().IS)((()=>({replaceAddRemoveToggleButton:{marginInlineStart:"8px",marginInlineEnd:"8px",marginTop:"8px"}})),[]),{footer:C,groupedItems:j,menuListStore:I,noResultsMessage:M,replaceAddRemoveToggleButton:T,searchInput:w,selectItems:P,valueItems:_}=function(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:a,formulaValueContext:l,isSingle:c,onChange:m,onClose:g,showClearButton:y,showReplaceAddRemoveToggle:h,type:f,value:v}=e,[x,S]=(0,n.useState)(""),b=(0,r().uB)(void 0,H().$),A=(0,z().Y0)(),C=(0,N().tz)(),{collectionStore:j,property:I}=l,M=(0,r().K8)((()=>j.getSchema()[I]),[j,I]),T=M&&(0,s().DD)(M),w=(0,n.useMemo)((()=>T?M.groups??[]:[]),[T,M]),P=(0,r().K8)((()=>M&&(0,s().DQ)(M)&&M.options||[]),[M]),_=(0,n.useMemo)((()=>a.filter((e=>(0,d().o5)(e.type,{type:"select",collection:f.collection,property:f.property})))),[a,f.collection,f.property]),B=(0,r().K8)((()=>({valueResults:x?(0,G().Ay)(x,_,(e=>e.kind===Y().FormulaContextValueKind.ContextValue?e.name:"")):_,selectResults:x?(0,G().Ay)(x,P,(e=>e.value)):P})),[x,_,P]),R=(0,n.useCallback)((()=>{S(""),b.setState({...b.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[b]),V=(0,n.useCallback)(((e,o)=>{m(e||v,o||t)}),[t,m,v]),E=(0,n.useCallback)((()=>{c&&W().default.afterNextFlush((()=>{g()}))}),[c,g]),F=(0,n.useCallback)((e=>{V({type:"simple",value:c?(0,u().toSimpleFormulaSingleValue)(e[0]):(0,u().toSimpleFormulaArrayValue)(e)}),E(),R()}),[V,c,E,R]),D=(0,n.useCallback)((()=>{F(o.slice(0,o.length-1))}),[o,F]),L=(0,n.useCallback)((e=>{F((0,u().simpleFormulaValueWithoutToken)(o,e))}),[o,F]),O=(0,n.useMemo)((()=>q().oE(o.map(((e,t)=>(0,k.jsx)(Z,{disabled:!1,handleRemoveToken:L,propertySchema:M,token:e},`select_option_token_${t}`))))),[o,L,M]),K=(0,n.useMemo)((()=>new Set(q().oE(o.map((e=>(0,u().isAnnotationSimpleValueToken)(e)&&(0,p().s1Y)(e)&&(0,p().iVq)(e).id))))),[o]),J=(0,n.useMemo)((()=>q().oE((B.valueResults??[]).map((e=>{const t=e.kind===Y().FormulaContextValueKind.ContextValue&&e.id||"";if(!t||!K.has(t))return{action:c?"replace":"append",currentSimpleFormulaValueTokens:o,onCheckboxClick:E,id:t,isStatusProperty:Boolean(T),setCurrentTokens:F,value:e}})))),[K,o,E,c,T,B.valueResults,F]),ee=c?"single":"multi",te=(0,n.useMemo)((()=>q().oE(B.selectResults??[]).reduce(((e,t)=>{const n=Boolean(o.find((e=>"string"==typeof e&&e===t.value)));return e[t.id]={isChecked:n,checkType:ee,group:void 0,id:t.id,isStatusProperty:Boolean(T),onCheckboxClick:()=>{F(c?n?[]:[t.value]:n?(0,u().simpleFormulaValueWithoutToken)(o,t.value):[...o,t.value]),c&&W().default.afterNextFlush((()=>{g()}))},option:t},e}),{})),[ee,o,c,T,g,B.selectResults,F]),oe=(0,n.useMemo)((()=>Object.values(te)),[te]),ne=(0,n.useMemo)((()=>w.map((e=>({items:P.filter((t=>(e.optionIds??[]).includes(t.id))).map((e=>te[e.id])),group:e})))),[te,P,w]),ie=w.length>0&&0===ne.length||0===w.length&&0===oe.length,re=(0,k.jsx)("div",{style:{...!i().A.isMobile&&{padding:"0 8px 4px 8px"}},children:(0,k.jsx)(U().Ay,{dontShowBorderBottom:A.isAndroid,focus:!i().A.isMobile||void 0,focusAfterAnimation:!0,format:U().le.FilterValue,onChange:e=>S(e.target.value),onClearButtonClick:()=>F([]),onRemoveLastToken:D,placeholder:C.formatMessage($().D.searchPlaceHolder),showClearButton:y,tokens:O,value:x})}),ae=(0,k.jsx)(Q().A,{value:v,onChange:V}),se=(0,k.jsx)(X().A,{action:t,handleOnChange:V});return{footer:ae,groupedItems:ne,menuListStore:b,noResultsMessage:ie&&C.formatMessage($().D.noResults),replaceAddRemoveToggleButton:Boolean(h)&&se,searchInput:re,selectItems:oe,valueItems:J}}({action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:a,formulaValueContext:l,isSingle:c,onChange:g,onClose:y,showClearButton:h,showReplaceAddRemoveToggle:v,type:x,value:S})||{},B=(0,n.useMemo)((()=>_.map((e=>{const{annotation:t,itemAction:o}=(0,ee().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:e=>(0,k.jsx)(J().A,{annotation:t,disabled:!1,formulaTypecheckContextValues:a,menuArgs:e,parentRecordStore:b}),action:o}}))),[a,_,b]),{groupedMenuItems:R,selectMenuItems:te}=(0,n.useMemo)((()=>{let e=[],t=[];return j.length>0?e=j.map((({group:e,items:t})=>({key:e.name,render:t=>(0,k.jsx)(K().A,{...t,title:e.name,topBorder:!0}),items:t.map((e=>({key:e.id,render:t=>(0,k.jsx)(ne,{...t,isChecked:e.isChecked,checkType:e.checkType,group:e.group,menuArgs:t,onCheckboxClick:e.onCheckboxClick,option:e.option}),action:e.onCheckboxClick})))}))):t=P.map((e=>({key:e.id,render:t=>(0,k.jsx)(oe,{...t,isChecked:e.isChecked,checkType:e.checkType,menuArgs:t,onCheckboxClick:e.onCheckboxClick,option:e.option}),action:e.onCheckboxClick}))),{groupedMenuItems:e,selectMenuItems:t}}),[j,P]),ie=[...B,...te];let re,ae=[];ie.length>0&&ae.push({key:"options",render:e=>(0,k.jsx)(K().A,{...e}),items:ie}),R.length>0&&(ae=[...ae,...R]),re=i().A.isMobile?{menuType:F().gu.Modal,right:(0,k.jsx)(N().sA,{...E().W.done}),onClickRight:y,footer:C&&(0,k.jsx)(K().A,{topBorder:!0,children:C})}:{menuType:F().gu.Popup,maxHeight:"50vh",width:260,footer:C&&(0,k.jsx)(K().A,{topBorder:!0,children:C}),disableHeaderBorder:!0};const se=(0,k.jsxs)(k.Fragment,{children:[i().A.isMobile||null==m?void 0:m.header,f?(0,k.jsx)(K().A,{children:w}):void 0]});return(0,k.jsxs)(D().A,{...re,header:se,children:[T?(0,k.jsx)("div",{style:A.replaceAddRemoveToggleButton,children:T}):void 0,M?(0,k.jsx)(K().A,{children:(0,k.jsx)(L().u,{title:M})}):void 0,ae.length>0?(0,k.jsx)(O().A,{type:O().O.Vertical,initialFocus:0,sections:ae,store:I}):void 0]})}var re=()=>o(403129),ae=(o(737550),o(16280),()=>o(295633)),se=()=>o(26697),le=()=>o(764880),ce=()=>o(179034),de=()=>o(798880),ue=()=>o(305390),pe=()=>o(448693);const me=(0,N().YK)({maximumPeopleSelectedTooltip:{defaultMessage:"Maximum people selected",id:"valuePickerItem.maximumSelectedReached"}});function ge(e){const{args:t,isChecked:o,checkType:n,context:y,disabled:f,onCheckboxClick:x,parentRecordStore:b,token:A}=e,C=(0,r().K8)((()=>{if((0,u().isAnnotationSimpleValueToken)(A)&&(0,p().rie)(A)){const e=(0,p().NcG)(A);if(e)return(0,le().xC)({pointer:{table:de().oo,id:e},getRecordValue:b.getRecordModel})}}),[b.getRecordModel,A]),j=(0,r().K8)((()=>y.collectionStore.getSchema()[y.property]),[y]),I=(0,r().K8)((()=>j&&(0,s().DQ)(j)?j.options??[]:[]),[j]),M=(0,r().K8)((()=>j&&(0,s().DD)(j)?j.groups??[]:[]),[j]),T=(0,v().K4)(),w=null==T?void 0:T.typecheckResult,P=(0,V().IS)((()=>({disabledMenuItem:{cursor:"not-allowed",opacity:.4}})),[]),_=Boolean(j&&(0,s().DD)(j)),B="single"===n?{isChecked:o}:"multi"===n?{icon:(0,k.jsx)(a().S,{style:f?P.disabledMenuItem:void 0,checked:o,size:14,onClick:x,disabled:f})}:{};if("string"==typeof A){if(_){const e=(0,l().jy)(I,A),o=M.find((t=>{var o;return e&&(null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id))}));return e?(0,k.jsx)(te().A,{...t,...B,title:(0,k.jsx)(S().q,{format:i().A.isMobile?c().NY.Large:c().NY.Small,isSingle:!0,value:e.value,color:e.color,groupColor:null==o?void 0:o.color,shouldShrink:!0,showRemoveButton:!1},A),isTokenTitle:!0,disabled:f,style:f?P.disabledMenuItem:void 0,...t}):null}{const e=(0,l().jy)(I,A);return e?(0,k.jsx)(te().A,{...t,...B,title:(0,k.jsx)(S().O,{value:e.value,color:e.color,showRemoveButton:!1,isSingle:!0,shouldShrink:!0,format:i().A.isMobile?c().NY.Large:c().NY.Small}),isTokenTitle:!0,disabled:f,style:f?P.disabledMenuItem:void 0,...t}):null}}if("boolean"==typeof A)return null;if((0,p().rie)(A))return null!=C&&C.asActor&&C.table===de().oo?(0,k.jsx)(te().A,{...t,...B,title:f?(0,k.jsx)(se().m,{renderTooltip:()=>(0,k.jsx)(N().sA,{...me.maximumPeopleSelectedTooltip}),placement:"right",render:e=>(0,k.jsx)("div",{style:{width:"100%"},...e,children:(0,k.jsx)(pe().t_,{isSingle:!0,shouldShrink:!0,format:i().A.isMobile?pe().t_.Format.Large:pe().t_.Format.Medium,userValue:C.asActor,hasPersonHoverCard:!1})})}):(0,k.jsx)(pe().t_,{isSingle:!0,shouldShrink:!0,format:i().A.isMobile?pe().t_.Format.Large:pe().t_.Format.Medium,userValue:C.asActor,hasPersonHoverCard:!1}),disabled:f,style:f?P.disabledMenuItem:void 0,isTokenTitle:!0}):null;if((0,p().s1Y)(A)){const e=(0,p().iVq)(A).id,n=w&&m().Q.isSuccess(w)?(0,d().IV)(w.value.valueTypes,e):void 0;return n?(0,k.jsx)(J().A,{isChecked:o,contextValue:n,disabled:Boolean(f),menuArgs:t,parentRecordStore:b}):null}if((0,p().qsB)(A))return null;if((0,p().RaC)(A))return null;if((0,p().jIt)(A)){const e=(0,p().v55)(A);if(!e)return null;const n=ae().B.createChildStore(b,{id:e,table:ce().ev});return(0,k.jsx)(ue().A,{store:n,isChecked:o,hidePath:!0,...t})}if((0,p().iz3)(A))return(0,k.jsx)(h().A,{token:A});(0,g().HB)(A)}function ye(e){const{currentSimpleFormulaValueTokens:t,value:o,setCurrentTokens:n,action:i,context:r,checkType:a,onCheckboxClick:s,isDisabled:l,parentRecordStore:c}=e;if(o.kind!==Y().FormulaContextValueKind.ContextValue)throw new Error("Not implemented yet.");const d=Boolean(t.find((e=>(0,u().isAnnotationSimpleValueToken)(e)&&(0,p().s1Y)(e)&&(0,p().iVq)(e).id===o.id))),m=(0,p().CA$)({id:o.id}),g=()=>{n("append"===i?d?(0,u().simpleFormulaValueWithoutToken)(t,m):[...t,m]:[m]),null==s||s()};return{key:o.id,render:e=>(0,k.jsx)(ge,{disabled:l,token:m,args:e,isChecked:d,checkType:a,context:r,onCheckboxClick:g,parentRecordStore:c}),action:g}}function he(e){const{context:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:r,menuProps:a,onChange:s,onClose:l,parentRecordStore:c,value:d}=e,p=(0,N().tz)(),m=r.filter((e=>"checkbox"===e.type.type)),g=(0,n.useCallback)((e=>{s({type:"simple",value:void 0!==e[0]?(0,u().toSimpleFormulaSingleValue)(e[0]):void 0})}),[s]),y=(0,n.useCallback)((e=>{g(e),l()}),[g,l]),h=q().oE(m.map((e=>ye({currentSimpleFormulaValueTokens:o,value:e,setCurrentTokens:y,action:"replace",context:t,checkType:"single",parentRecordStore:c})))),f=[],v=o.some((e=>!0===e)),x=[...h,...[{key:0,render:e=>(0,k.jsx)(te().A,{title:(0,k.jsx)(N().sA,{...$().D.unchecked}),isChecked:!v,...e}),action:()=>{y([!1])}},{key:1,render:e=>(0,k.jsx)(te().A,{title:(0,k.jsx)(N().sA,{...$().D.checked}),isChecked:v,...e}),action:()=>{y([!0])}}]],S=void 0!==(null==a?void 0:a.header)?a.header:(0,k.jsx)(K().A,{style:{paddingBottom:0},title:p.formatMessage($().D.genericMenuHeader)}),b=Boolean(S);f.push({key:"checkbox",render:e=>(0,k.jsx)(K().A,{...e,topBorder:b}),items:x});const A=(0,k.jsx)(K().A,{topBorder:!0,children:(0,k.jsx)(Q().A,{onChange:s,value:d})});let C;C=i().A.isMobile?{menuType:F().gu.Modal,right:(0,k.jsx)(N().sA,{...E().W.done}),onClickRight:l,footer:A}:{menuType:F().gu.Popup,maxHeight:"50vh",width:260,disableHeaderBorder:!0,header:S,footer:A};const j={...C,...a,header:i().A.isMobile?null:S};return(0,k.jsx)(D().A,{...j,children:(0,k.jsx)(O().A,{type:O().O.Vertical,initialFocus:0,sections:f})})}var fe=()=>o(807449),ve=()=>o(42583),xe=()=>o(79926),Se=()=>o(695115),be=()=>o(631524),Ae=()=>o(597777),Ce=()=>o(62900),ke=()=>o(100622),je=()=>o(75858),Ie=()=>o(180252);function Me(e){const{context:t,currentSimpleFormulaValueTokens:o,disabled:i,onClose:a,setCurrentTokens:s,setInDatePicker:l}=e,c=o[0],d=c&&(0,u().isAnnotationSimpleValueToken)(c)&&p().qsB(c)?p().K7D(c):void 0,m=(0,N().tz)(),g=(0,r().O$)(Ie().XX),y=(0,n.useCallback)((()=>{l(!1)}),[l]),h=(0,n.useCallback)((e=>{e&&(0,Ae().kC)(e)?s([p().Ww9(e)]):s([])}),[s]),f=(0,V().IS)((()=>({header:{display:"flex",alignItems:"center",fontSize:12,paddingInline:14,color:ke().Tj.text.secondary,marginTop:8,fontWeight:500},iconWrap:{width:18,height:18,marginInlineEnd:4},title:{flex:"1 1 auto"}})),[]),v=(0,r().K8)((()=>(0,C().aS)(t)),[t]);return(0,k.jsx)(xe().u2,{dependency:je().cm,children:({DatePropertyMenu:e})=>(0,k.jsx)(e,{firstDayOfWeek:g,value:d,canConfigureCollection:!1,onChangeValue:h,dateFormat:v.dateFormat,timeFormat:v.timeFormat,onDismiss:a,disabled:i,shouldShowReminder:!1,header:(0,k.jsxs)("div",{style:f.header,children:[(0,k.jsx)(Se().A,{ariaLabel:m.formatMessage($().D.back),icon:Ce().arrowStraightLeftSmallIcon,onClick:y,style:f.iconWrap}),(0,k.jsx)("span",{style:f.title,children:(0,k.jsx)(N().sA,{...$().D.pickADate})}),(0,k.jsx)(be().p,{onClick:a,colorPalette:"blue",children:(0,k.jsx)(N().sA,{...E().W.done})})]}),isTemplatePage:!1})})}function Te(e){const{context:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:r,menuProps:a,onChange:s,onClose:l,parentRecordStore:c,value:d}=e,p=(0,N().tz)(),[m,g]=(0,n.useState)(!1),y=r.filter((e=>"date"===e.type.type)),h=(0,n.useCallback)((e=>{s({type:"simple",value:void 0!==e[0]?(0,u().toSimpleFormulaSingleValue)(e[0]):void 0})}),[s]),f=(0,n.useCallback)((e=>{h(e),l()}),[h,l]),v=(0,n.useCallback)((()=>{g(!0)}),[]),x=(0,n.useCallback)((()=>{h([]),l()}),[h,l]);if(m)return(0,k.jsx)(Me,{context:t,currentSimpleFormulaValueTokens:o,disabled:!1,onClose:l,setCurrentTokens:h,setInDatePicker:g});const S=void 0!==(null==a?void 0:a.header)?a.header:(0,k.jsx)(K().A,{style:{paddingBottom:0},title:p.formatMessage($().D.genericMenuHeader)}),b=q().oE(y.map((e=>ye({currentSimpleFormulaValueTokens:o,value:e,setCurrentTokens:f,parentRecordStore:c,action:"replace",context:t,checkType:"single"})))),A=[];if(b.length>0){const e=Boolean(S);A.push({key:"values",render:t=>(0,k.jsx)(K().A,{topBorder:e,...t}),items:b})}const C=(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(K().A,{topBorder:!0,children:[(0,k.jsx)(te().A,{icon:(0,k.jsx)(fe().I,{icon:ve().D,colorVariant:"secondary"}),title:(0,k.jsx)(N().sA,{...$().D.pickADate}),focused:!1,showExtensionArrow:!0,onClick:v}),(0,k.jsx)(Q().A,{onChange:s,value:d})]}),o.length>0?(0,k.jsx)(K().A,{topBorder:!0,children:(0,k.jsx)(te().A,{title:(0,k.jsx)(N().sA,{...$().D.clear}),focused:!1,onClick:x})}):void 0]});let j;j=i().A.isMobile?{menuType:F().gu.Modal,right:(0,k.jsx)(N().sA,{...E().W.done}),onClickRight:l,footer:C}:{menuType:F().gu.Popup,maxHeight:"50vh",width:260,footer:C,disableHeaderBorder:!0};const I={...j,...a,header:i().A.isMobile?null:S};return(0,k.jsx)(D().A,{...I,children:(0,k.jsx)(O().A,{type:O().O.Vertical,initialFocus:0,sections:A})})}function we(e){const{action:t,allowedFormulaReturnTypes:o,currentSimpleFormulaValueTokens:i,disableEmojiCommands:r,disableFormattingAndMentions:a,disableMobileActionBar:s,formulaTypecheckContextValues:l,formulaValueContext:c,limit:d,menuProps:u,onChange:p,onClose:m,parentRecordStore:y,showClearButton:h,showInputMenuItem:f,showReplaceAddRemoveToggle:v,type:x,value:S}=e;w();const b="formula"===(null==S?void 0:S.type),A=(0,I().r)(),C=n.useCallback((()=>{p({type:"simple",value:null==S?void 0:S.value})}),[p,null==S?void 0:S.value]);return b&&A?(0,k.jsx)(P().A,{allowedReturnTypes:o,disabled:!1,formulaTypecheckContextValues:l,onBack:C,onChange:p,onClose:m,parentRecordStore:y,restrictUnaccessibleProperties:"cross_space_and_read_permissions",spaceId:A,value:S}):"person_array"===x.type?(0,k.jsx)(Be,{action:t,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:l,formulaValueContext:c,limit:d,menuProps:u,onChange:p,onClose:m,showClearButton:h??!0,showInputMenuItem:f??!0,showFormulaValueItems:!0,showGenericHeader:!0,showReplaceAddRemoveToggle:v,showPersonCheckbox:v,getRecordModel:y.getRecordModel,value:S,parentRecordStore:y}):"collection"!==c.type?null:"text"===x.type?(0,k.jsx)(_e,{currentSimpleFormulaValueTokens:i,disableEmojiCommands:r,disableFormattingAndMentions:a,disableMobileActionBar:s,formulaTypecheckContextValues:l,menuProps:u,onChange:p,onClose:m,parentRecordStore:y,showGenericHeader:!0,value:S}):"number"===x.type?(0,k.jsx)(Pe,{currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:l,menuProps:u,onChange:p,onClose:m,showGenericHeader:!0,value:S,parentRecordStore:y}):"checkbox"===x.type?(0,k.jsx)(he,{context:c,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:l,menuProps:u,onChange:p,onClose:m,parentRecordStore:y,value:S}):"date"===x.type?(0,k.jsx)(Te,{context:c,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:l,menuProps:u,onChange:p,onClose:m,parentRecordStore:y,value:S}):"block_array"===x.type?(0,k.jsx)(Re,{action:t,collection:"block_array"===x.type?x.collection:void 0,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:l,formulaValueContext:c,menuProps:u,onChange:p,onClose:m,showClearButton:h??!0,showFormulaValueItems:!0,showGenericHeader:!0,showInputMenuItem:f??!0,showReplaceAddRemoveToggle:v,value:S,parentRecordStore:y}):"select"===x.type?(0,k.jsx)(ie,{currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:l,formulaValueContext:c,isSingle:!0,menuProps:u,onChange:p,onClose:m,showClearButton:h??!0,showInputMenuItem:f??!0,type:x,value:S,parentRecordStore:y}):"select_array"===x.type?(0,k.jsx)(ie,{action:t,currentSimpleFormulaValueTokens:i,formulaTypecheckContextValues:l,formulaValueContext:c,isSingle:!1,menuProps:u,onChange:p,onClose:m,showClearButton:h??!0,showInputMenuItem:f??!0,showReplaceAddRemoveToggle:v,type:x,value:S,parentRecordStore:y}):void(0,g().HB)(x)}function Pe({currentSimpleFormulaValueTokens:e,formulaTypecheckContextValues:t,menuProps:o,onChange:n,onClose:i,showGenericHeader:r,value:a,parentRecordStore:s}){const{numberMenu:l}=(0,_().A)({currentSimpleFormulaValueTokens:e,formulaTypecheckContextValues:t,menuProps:o,onChange:n,onClose:i,showGenericHeader:r,value:a,parentRecordStore:s});return l}function _e({currentSimpleFormulaValueTokens:e,formulaTypecheckContextValues:t,menuProps:o,onChange:n,onClose:i,parentRecordStore:r,showGenericHeader:a,value:s}){const{textMenu:l}=(0,re().A)({currentSimpleFormulaValueTokens:e,formulaTypecheckContextValues:t,menuProps:o,onChange:n,onClose:i,parentRecordStore:r,showGenericHeader:a,value:s});return l}function Be({action:e,currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,formulaValueContext:n,limit:i,menuProps:r,onChange:a,onClose:s,showClearButton:l,showInputMenuItem:c,showFormulaValueItems:d,showGenericHeader:u,showReplaceAddRemoveToggle:p,showPersonCheckbox:m,getRecordModel:g,value:y,parentRecordStore:h}){const{personArrayMenu:f}=(0,B().A)({action:e,currentSimpleFormulaValueTokens:t,formulaTypecheckContextValues:o,formulaValueContext:n,limit:i,menuProps:r,onChange:a,onClose:s,showClearButton:l,showInputMenuItem:c,showFormulaValueItems:d,showGenericHeader:u,showReplaceAddRemoveToggle:p,showPersonCheckbox:m,getRecordModel:g,value:y,parentRecordStore:h});return f}function Re({action:e,collection:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:n,formulaValueContext:i,menuProps:r,onChange:a,onClose:s,showClearButton:l,showFormulaValueItems:c,showGenericHeader:d,showInputMenuItem:u,showReplaceAddRemoveToggle:p,value:m,parentRecordStore:g}){const{relationMenu:y}=(0,R().A)({action:e,collection:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:n,formulaValueContext:i,menuProps:r,onChange:a,onClose:s,showClearButton:l,showFormulaValueItems:c,showGenericHeader:d,showInputMenuItem:u,showReplaceAddRemoveToggle:p,value:m,parentRecordStore:g});return y}},45178:(e,t,o)=>{o.d(t,{R:()=>_});var n=o(296540),i=()=>o(692031),r=()=>o(212497),a=()=>o(587682),s=()=>o(908006),l=()=>o(484714),c=()=>o(275144),d=()=>o(401497),u=()=>o(295633),p=()=>o(874832),m=()=>o(718827),g=()=>o(249046),y=()=>o(250910),h=()=>o(807449),f=()=>o(695115),v=()=>o(951105),x=()=>o(126617),S=()=>o(703778),b=()=>o(523389),A=()=>o(69708),C=()=>o(100622),k=()=>o(284371),j=()=>o(347100),I=()=>o(854672),M=()=>o(738471),T=()=>o(115512),w=()=>o(668143),P=o(474848);function _(e){const t=(0,l().v3)(),{hoverData:o,href:_,handleEditClick:B,showEditButton:R,loading:V,store:E,token:F,onDismiss:D}=e,L=(0,d().eP)(),O=(0,d().IS)((()=>({newWrapper:{width:280,flexDirection:"column",alignItems:"flex-start"},coverContainer:{width:280,height:120},contentNew:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:"12px 16px",gap:12,width:280},titleAndDescription:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:0,gap:2,width:248},linkTitle:{...(0,T().pA)(2),fontStyle:"normal",fontWeight:k().Wy.semibold,fontSize:14,lineHeight:"143%",fontFeatureSettings:"'case' on",textOverflow:"ellipsis",color:C().Tj.text.primary},newDescription:{display:"flex",flexDirection:"column",alignItems:"flex-start",padding:0,...(0,T().pA)(3),textOverflow:"ellipsis",width:248},newText:{fontSize:12,fontWeight:400,whiteSpace:"normal",wordBreak:"break-word",color:C().Tj.text.primary},buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:4,fill:C().Tj.icon.tertiary,background:o?j().xA:"dark"===L?C().Tj.palette.gray[100]:C().Tj.background.elevated,border:o?void 0:"1px solid rgba(227, 226, 224, 0.5)"},iconBoxImageStyle:{margin:1}})),[o,L]),K=(0,A().tz)(),N=(0,n.useRef)(null),W=(0,A().YK)({copyLink:{defaultMessage:"Copy link",id:"hoverPreviewOverlay.copyLink"},editLink:{defaultMessage:"Edit link",id:"hoverPreviewOverlay.editLink"}}),z=(0,n.useCallback)((async()=>{await s().default.afterNextFlush();const[e,o]=await Promise.all([(0,i().r)(),(0,r().jd)()]),n=e.copiedLinkToClipboard;o({environment:t,stringValue:_,copiedMessage:n})}),[t,_]),U=E&&E.recordStoreUIParentStore&&E.recordStoreUIParentStore instanceof u().B?E.recordStoreUIParentStore:E instanceof u().B?E:void 0,H=(null==o?void 0:o.thumbnail_url)??((null==o?void 0:o.images)&&o.images.length>0&&o.images[0].url);return(0,P.jsxs)(g().wt,{style:O.newWrapper,children:[R?(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(f().A,{onClick:z,icon:v().k,colorVariant:"primary",ariaLabel:K.formatMessage(W.copyLink),hasBackground:!0,style:{position:"absolute",top:8,insetInlineEnd:8}}),(0,P.jsx)(f().A,{onClick:B,icon:b().pencilLineSmallIcon,colorVariant:"primary",ariaLabel:K.formatMessage(W.editLink),hasBackground:!0,style:{position:"absolute",top:8,insetInlineEnd:35}})]}):void 0,F&&U&&!R?(0,P.jsx)("div",{style:{position:"absolute",top:8,insetInlineEnd:8,zIndex:1},children:(0,P.jsx)(y().A,{popupType:y().z.Popup,placementToOrigin:"right",alignmentToOrigin:"start",originGap:4,onClose:()=>{let e=!1;const t=N.current;t&&(e=(0,a().ux)(t.getBoundingClientRect(),c().$C.x,c().$C.y)),e||null==D||D()},renderOrigin:e=>(0,P.jsx)(m().Ay,{style:O.buttonStyle,...e,children:(0,P.jsx)(h().I,{icon:x().ellipsisSmallIcon,size:"sm",style:{fill:o?C().oZ.white:C().oZ.uiGray}})}),render:e=>(0,P.jsx)(w().A,{parentBlockStore:U,store:E,token:F,href:_,hoverData:o,onAccept:()=>e.close()})})}):void 0,H?(0,P.jsx)(g().Ye,{style:O.coverContainer,children:(0,P.jsx)(M().A,{src:H,style:{width:"100%",height:"100%",insetInlineStart:0,top:"calc(50% - 280px/2)"}})}):void 0,(0,P.jsxs)(g().wt,{style:O.contentNew,children:[null!=o&&o.title||null!=o&&o.description?(0,P.jsxs)(g().wt,{style:O.titleAndDescription,children:[null!=o&&o.title?(0,P.jsx)(g().Ye,{gap:2,children:(0,P.jsx)("div",{style:O.linkTitle,children:null==o?void 0:o.title})}):void 0,null!=o&&o.description?(0,P.jsx)(g().Ye,{gap:2,children:(0,P.jsx)("div",{style:O.newDescription,children:(0,P.jsx)("div",{spellCheck:!1,style:O.newText,children:(0,P.jsx)("div",{children:null==o?void 0:o.description})})})}):void 0]}):void 0,V?(0,P.jsx)(p().P,{style:{width:200,height:16}}):(0,P.jsxs)(g().Ye,{alignItems:"left",style:{display:"flex",flexDirection:"row",alignItems:"center",padding:0,gap:4,width:205,height:16},children:[null!=o&&o.favicon_url?(0,P.jsx)(I().A,{type:"image_url",imageURL:null==o?void 0:o.favicon_url,size:16,style:O.iconBoxImageStyle}):null!=o&&o.icon_url?(0,P.jsx)(I().A,{type:"image_url",imageURL:null==o?void 0:o.icon_url,size:16,style:O.iconBoxImageStyle}):(0,P.jsx)(h().I,{icon:S().linkSmallIcon,size:"sm",colorVariant:"secondary"}),(0,P.jsx)("div",{style:{flexGrow:0,fontWeight:k().Wy.medium,color:"#787774",fontSize:12,...k().RC},children:(null==o?void 0:o.provider_name)||(null==o?void 0:o.link_provider)||_})]})]})]})}},59110:(e,t,o)=>{o.r(t),o.d(t,{loadLocalSubtree:()=>b});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(803949);var n=()=>o(726637),i=()=>o(700500),r=()=>o(175482),a=()=>o(777447),s=()=>o(792071),l=()=>o(976618),c=()=>o(388821),d=()=>o(277153),u=()=>o(912720),p=()=>o(199378),m=()=>o(179034),g=()=>o(519831),y=()=>o(869558),h=()=>o(37165),f=()=>o(144081),v=()=>o(743246),x=()=>o(201980),S=()=>o(534177);function b(e){const{environment:t,blockId:o,inMemoryRecordCache:n,options:i}=e,r=t.currentUser.id,a=c().RecordMap.create(),s=new Set,l=[{pointer:{table:m().ev,id:o},parentId:"doesn't matter"}];for(;l.length>0;){const e=l.shift();if(!e)continue;if(s.has(e.pointer.id))continue;const t=o===e.pointer.id,c=A({pointer:e.pointer,recordMap:a,inMemoryRecordCache:n,currentUserId:r,cursors:l,cursor:e,options:i,isRootRequest:t});if(c)return c;s.add(e.pointer.id)}return{type:"success",recordMap:a}}function A(e){const{pointer:t,recordMap:o,inMemoryRecordCache:c,currentUserId:b,cursors:A,cursor:C,options:k,isRootRequest:j}=e;let I;return(0,d().Yt)(t,m().ev)?I=function(e){var t,o,l,c;const{pointer:d,recordMap:p,inMemoryRecordCache:g,currentUserId:h,cursors:f,cursor:b,options:A,isRootRequest:C}=e,k=g.getRecord({pointer:d,userId:h}),j=null==k?void 0:k.value;if(!j)return A.requireFullSubtree?{type:"error",reason:"missing_record",pointer:d}:void 0;const I=A.excludeCrdtData?r().ir(j):j;if(A.includeLegacyTransclusionBlockValues){if(!C&&I.parent_id!==b.parentId&&!b.isBlockContentChild)return}else if(!C&&I.parent_id!==b.parentId)return;if(I.type===i().xd.externalObjectInstance&&!A.allowCopyExternalObjectInstances)return{type:"error",reason:"encountered_external_object_instance",pointer:d};if(p.setValue(d,I),!A.skipNavigableChildren){const e=s().Bj6.fromBlock(I).getCollectionPointers();for(const t of e){const e=g.getRecord({pointer:t,userId:h});var M,T;if(e)(null===(M=e.value)||void 0===M?void 0:M.parent_table)===m().ev&&(null===(T=e.value)||void 0===T?void 0:T.parent_id)===I.id&&f.push({pointer:t,parentId:I.id});else if(A.requireFullSubtree)return{type:"error",reason:"missing_record",pointer:t}}if(I.view_ids)for(const t of I.view_ids)f.push({pointer:{table:y().Gy,id:t,spaceId:I.space_id},parentId:I.id})}if(!(A.skipBlockContent||A.skipTransclusionContainerChildren&&"transclusion_container"===I.type||A.skipNavigableChildren&&(0,i().$I)(I.type))){const e=s().Bj6.fromBlock(I).getRenderableContentIds();for(const t of e)f.push({pointer:{table:m().ev,id:t},parentId:I.id,isBlockContentChild:!0})}const w=s().Bj6.fromBlock(I).getNonContentChildren();for(const n of w)f.push({pointer:{table:m().ev,id:n},parentId:I.id,isBlockContentChild:!0});if(I.type===i().xd.externalObjectInstance){var P,_;const e=(null===(P=I.format)||void 0===P?void 0:P.related_external_object_uris_to_instance_ids)&&Object.values(null===(_=I.format)||void 0===_?void 0:_.related_external_object_uris_to_instance_ids)||[];for(const t of e)f.push({pointer:{table:m().ev,id:t,spaceId:I.space_id},parentId:I.id})}if(!A.skipNavigableChildren&&I.properties){const e=Object.values(I.properties).filter(S().O9);for(const t of e)for(const e of t)for(const t of x().uPN(e)){if(x().jIt(t)){const e=x().v55(t);f.push({pointer:{table:m().ev,id:e},parentId:I.id})}if(x().sh$(t)){const e=x().cQR(t),o=(0,a().lX)({url:e,baseUrl:n().A.domainBaseUrl,publicDomainName:n().A.publicDomainName});o&&f.push({pointer:{table:m().ev,id:o},parentId:I.id})}if(x().N53(t)){const e=x().T$c(t);e&&f.push({pointer:{table:m().ev,id:e,spaceId:I.space_id},parentId:I.id})}}}"form"===I.type&&null!==(t=I.format)&&void 0!==t&&t.form_layout_pointer&&f.push({pointer:I.format.form_layout_pointer,parentId:I.id});null!==(o=I.format)&&void 0!==o&&o.automation_id&&f.push({pointer:{table:u().yB,id:I.format.automation_id,spaceId:I.space_id},parentId:I.id});null!==(l=I.format)&&void 0!==l&&l.workflow_id&&f.push({pointer:{table:v().C0,id:I.format.workflow_id,spaceId:I.space_id},parentId:I.id});null!==(c=I.format)&&void 0!==c&&c.ai_instructions_page_pointer&&f.push({pointer:I.format.ai_instructions_page_pointer,parentId:I.id})}({pointer:t,recordMap:o,inMemoryRecordCache:c,currentUserId:b,cursors:A,cursor:C,options:k,isRootRequest:j}):(0,d().Yt)(t,g().Vl)?I=function(e){var t,o;const{pointer:n,recordMap:i,inMemoryRecordCache:r,currentUserId:a,cursors:s,cursor:l,options:c}=e;if(!c.allowCopyCollections)return{type:"error",reason:"encountered_collection",pointer:n};const d=r.getRecord({pointer:n,userId:a});if(null==d||!d.value)return c.requireFullSubtree?{type:"error",reason:"missing_record",pointer:n}:void 0;if(d.value.parent_id!==l.parentId)return;const p=d.value;i.setValue(n,p),r.forEachRecord(a,(({model:e})=>{e.table===m().ev&&e&&e.parent_id===n.id&&e.alive&&s.push({pointer:e.pointer,parentId:n.id})}));const g=(null===(t=p.format)||void 0===t?void 0:t.automation_ids)??[];for(const m of g)s.push({pointer:{table:u().yB,id:m,spaceId:p.space_id},parentId:p.id});p.schema&&Object.values(p.schema).forEach((e=>{e&&"button"===e.type&&e.automation_id&&s.push({pointer:{id:e.automation_id,spaceId:p.space_id,table:u().yB},parentId:p.id})}));null!==(o=p.format)&&void 0!==o&&o.layout_pointer&&s.push({pointer:p.format.layout_pointer,parentId:p.id})}({pointer:t,recordMap:o,inMemoryRecordCache:c,currentUserId:b,cursors:A,cursor:C,options:k}):(0,d().Yt)(t,y().Gy)?I=function(e){var t,o;const{pointer:n,recordMap:i,inMemoryRecordCache:r,currentUserId:a,cursors:s,cursor:l,options:c}=e,d=r.getRecord({pointer:n,userId:a});if(null==d||!d.value)return c.requireFullSubtree?{type:"error",reason:"missing_record",pointer:n}:void 0;if(d.value.parent_id!==l.parentId)return;"form_editor"===d.value.type&&null!==(t=d.value.format)&&void 0!==t&&t.form_block_pointer&&s.push({pointer:d.value.format.form_block_pointer,parentId:d.value.id});null!==(o=d.value.format)&&void 0!==o&&o.dashboard_layout_pointer&&s.push({pointer:d.value.format.dashboard_layout_pointer,parentId:d.value.id});i.setValue(n,d.value)}({pointer:t,recordMap:o,inMemoryRecordCache:c,currentUserId:b,cursors:A,cursor:C,options:k}):(0,d().Yt)(t,u().yB)?I=function(e){const{pointer:t,recordMap:o,inMemoryRecordCache:n,currentUserId:i,cursors:r,cursor:a,options:s}=e,l=n.getRecord({pointer:t,userId:i});if(null==l||!l.value)return s.requireFullSubtree?{type:"error",reason:"missing_record",pointer:t}:void 0;if(l.value.parent_id!==a.parentId)return;o.setValue(t,l.value);for(const c of l.value.action_ids??[])r.push({pointer:{table:p().SC,id:c,spaceId:l.value.space_id},parentId:l.value.id})}({pointer:t,recordMap:o,inMemoryRecordCache:c,currentUserId:b,cursors:A,cursor:C,options:k}):(0,d().Yt)(t,p().SC)?I=function(e){const{pointer:t,recordMap:o,inMemoryRecordCache:n,currentUserId:i,cursors:r,cursor:a,options:s}=e,l=n.getRecord({pointer:t,userId:i});if(null==l||!l.value)return s.requireFullSubtree?{type:"error",reason:"missing_record",pointer:a.pointer}:void 0;if(l.value.parent_id!==a.parentId)return;o.setValue(t,l.value);for(const c of l.value.blocks??[])r.push({pointer:{table:m().ev,id:c,spaceId:l.value.space_id},parentId:l.value.id})}({pointer:t,recordMap:o,inMemoryRecordCache:c,currentUserId:b,cursors:A,cursor:C,options:k}):(0,d().Yt)(t,v().C0)?I=function(e){const{pointer:t,recordMap:o,inMemoryRecordCache:n,currentUserId:i,cursor:r,options:a}=e,s=n.getRecord({pointer:t,userId:i});if(null==s||!s.value)return a.requireFullSubtree?{type:"error",reason:"missing_record",pointer:r.pointer}:void 0;if(s.value.parent_id!==r.parentId)return;o.setValue(t,s.value)}({pointer:t,recordMap:o,inMemoryRecordCache:c,currentUserId:b,cursor:C,options:k}):(0,d().Yt)(t,f().zx)?I=function(e){const{pointer:t,recordMap:o,inMemoryRecordCache:n,currentUserId:i,cursors:r,options:a}=e,c=n.getRecord({pointer:t,userId:i}),d=null==c?void 0:c.value;if(!d)return a.requireFullSubtree?{type:"error",reason:"missing_record",pointer:t}:void 0;o.setValue(t,d);const u=s().Bj6.fromValue(f().zx,d);for(const s of u.getBlockChildrenPointers())r.push({pointer:s,parentId:t.id});const p=e=>{const o={id:e.collection_view_id,table:y().Gy,spaceId:d.space_id};return r.push({pointer:o,parentId:t.id}),e};(0,l().E)(d.modules,(e=>{if("formQuestion"===e.type){const o={id:e.formQuestionId,table:h().lo,spaceId:d.space_id};r.push({pointer:o,parentId:t.id})}else if("view"===e.type)p(e);else if("row"===e.type)for(const t of e.modules)"view"===t.type&&p(t)}))}({pointer:t,recordMap:o,inMemoryRecordCache:c,currentUserId:b,cursors:A,cursor:C,options:k}):(0,d().Yt)(t,h().lo)&&(I=function(e){const{pointer:t,recordMap:o,inMemoryRecordCache:n,currentUserId:i,options:r}=e,a=n.getRecord({pointer:t,userId:i});if(null==a||!a.value)return r.requireFullSubtree?{type:"error",reason:"missing_record",pointer:t}:void 0;o.setValue(t,a.value)}({pointer:t,recordMap:o,inMemoryRecordCache:c,currentUserId:b,cursors:A,cursor:C,options:k})),I}},70899:(e,t,o)=>{o.d(t,{U:()=>i});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.87 1.87 12.25 12.26",svg:(0,o(474848).jsx)("path",{d:"M11.904 3.28a6.125 6.125 0 1 0-1.648 10.415.625.625 0 1 0-.46-1.163 4.875 4.875 0 1 1 2.808-2.93c-.102.294-.43.523-.878.523a.87.87 0 0 1-.872-.872V5.705a.625.625 0 0 0-1.242-.098 3.04 3.04 0 0 0-1.746-.527c-.792 0-1.542.277-2.095.825-.557.55-.871 1.332-.871 2.256s.313 1.714.864 2.276 1.3.858 2.102.858c.8 0 1.55-.294 2.104-.85a2.12 2.12 0 0 0 1.756.93c.835 0 1.738-.441 2.058-1.361a6.125 6.125 0 0 0-1.88-6.734M6.65 6.793c.294-.29.715-.463 1.216-.463.5 0 .929.173 1.228.466.296.289.508.735.508 1.365 0 .631-.213 1.095-.515 1.4-.303.306-.73.484-1.221.484-.49 0-.91-.178-1.209-.482-.296-.303-.507-.767-.507-1.402 0-.633.21-1.08.5-1.368"})},i=(0,o(340498).wt)("atSmall",n,"small")},75858:(e,t,o)=>{o.d(t,{Li:()=>w,Tb:()=>P,iD:()=>T,yA:()=>E,V6:()=>S,_n:()=>k,Yk:()=>_,rD:()=>I,w_:()=>D,xX:()=>C,wh:()=>W,dr:()=>N,Gx:()=>L,q4:()=>K,MX:()=>O,fs:()=>F,VT:()=>A,fA:()=>j,LX:()=>R,l:()=>V,L:()=>M,kb:()=>b,Sh:()=>B,cm:()=>x});var n=()=>o(79926),i=o(296540),r=()=>o(564884),a=()=>o(484714),s=()=>o(590526),l=()=>o(371722),c=()=>o(127833),d=()=>o(546926),u=()=>o(890492),p=()=>o(663639),m=()=>o(69708),g=()=>o(457717),y=()=>o(864040),h=o(474848);function f(e){const{store:t}=e,n=(0,s().K8)((()=>g().F.state.open),[]),r=(0,i.useCallback)((()=>{g().F.setState({open:!1})}),[]);return o(726637).A.isMobile?(0,h.jsx)(c().zD,{popupType:c().nl.BottomSheet,bottomSheetInitialState:"half",trapFocus:!0,open:n,render:()=>(0,h.jsx)(v,{store:t,onClose:r}),onDismiss:r}):null}function v(e){const{store:t,onClose:o}=e,n=(0,a().v3)(),i=(0,s().K8)((()=>{const e=(0,l().f)(t,{includeTeamHomeFeed:!1,includeDataSources:!0});return e.reverse(),e}),[t]),c={menuType:d().gu.Modal,title:(0,h.jsx)(m().sA,{defaultMessage:"Breadcrumb",id:"breadcrumb.mobileBreadcrumbMenu.title"})};return(0,h.jsx)(u().A,{...c,children:(0,h.jsx)(p().A,{type:p().O.Vertical,onAccept:o,initialFocus:void 0,sections:(0,y().A)(n,i,(e=>{const t=void 0!==e.collectionId;(0,r().u)({environment:n,event:{eventName:"topbar_breadcrumb_page_click",eventProperties:{page_id:e.pageId,is_data_source:t}}})}))})})}const x=new(n().O2)("menus",(async()=>{const[{default:e},{TopbarPageAnalyticsOptOutMenu:t},{default:n},{default:i},{default:r},{default:a},{default:s},{default:l},{default:c},{DatePropertyMenu:d},{default:u},{SidebarTeamModal:p},{SidebarCreateTeamModal:m},{CreateTeamFromPageConfirmModal:g},{CollectionTypedDatabaseMigrationModal:y},{default:h},{default:v},{CollectionMentionContextMenu:x},{default:S},{MobilePageBacklinksMenuRenderer:b},{MobileShareMenuRenderer:A},{MobilePageUpdatesMenuRenderer:C},{MobileCommentsModalRenderer:k}]=await Promise.all([Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,809125)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,687110)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,723931)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,207240)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,98749)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,19780)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,432202)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,693007)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,856790)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,525639)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,936529)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,555367)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,83842)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,296431)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,122204)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,992757)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,138221)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,928744)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,160803)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,33047)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,417242)),Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(71562),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(62475),o.e(3151),o.e(98629),o.e(22926),o.e(22900),o.e(42838),o.e(85128),o.e(49889),o.e(20108),o.e(46174),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(71003),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(29357),o.e(64242),o.e(39986),o.e(22585),o.e(47160),o.e(76677),o.e(68609),o.e(37384),o.e(15553),o.e(77345),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(42056),o.e(41751),o.e(41714),o.e(5181),o.e(19456),o.e(3261),o.e(23371),o.e(17729),o.e(32116),o.e(65375),o.e(94995),o.e(98339),o.e(51240),o.e(54219),o.e(20029),o.e(68395),o.e(81803),o.e(96654),o.e(68643),o.e(32625),o.e(79231),o.e(63687),o.e(95885),o.e(27083),o.e(11424),o.e(40119),o.e(54742),o.e(88522),o.e(90880),o.e(49175),o.e(69668),o.e(5331),o.e(92924),o.e(71381),o.e(92192),o.e(96385),o.e(80326),o.e(53352),o.e(2373),o.e(73069),o.e(995),o.e(76690),o.e(60713),o.e(31106),o.e(63248),o.e(54719),o.e(48570),o.e(78862),o.e(54234),o.e(85160),o.e(15381),o.e(77149),o.e(86036),o.e(68466),o.e(77651),o.e(51204),o.e(57105),o.e(3759),o.e(44128),o.e(95103),o.e(58071),o.e(75681)]).then(o.bind(o,485253)),Promise.all([o.e(71003),o.e(93963),o.e(90880),o.e(95768),o.e(7595),o.e(18331)]).then(o.bind(o,479820))]);return{CustomizePageMenuRenderer:e,TopbarPageAnalyticsOptOutMenu:t,ImportModal:n,ExportModal:i,PageTemplateModal:r,GoogleAuthPromptModal:a,StudentNotEligibleModal:s,CookieModal:l,ForkPagePopup:c,DatePropertyMenu:d,ReportPageModal:u,SidebarCreateTeamModal:m,SidebarTeamModal:p,CreateTeamFromPageConfirmModal:g,CollectionTypedDatabaseMigrationModal:y,OpenInDesktopAppPopup:h,BlockMenu:v,CollectionMentionContextMenu:x,ImportIntoNewPageModal:S,MobilePageBacklinksMenuRenderer:b,MobileShareMenuRenderer:A,MobilePageUpdatesMenuRenderer:C,MobileCommentsModalRenderer:k,MobileBreadcrumbMenuRenderer:f}})),S=(0,n()._h)(x,(e=>e.CustomizePageMenuRenderer)),b=(0,n()._h)(x,(e=>e.TopbarPageAnalyticsOptOutMenu)),A=(0,n()._h)(x,(e=>e.PageTemplateModal)),C=(0,n()._h)(x,(e=>e.ImportModal)),k=(0,n()._h)(x,(e=>e.ExportModal)),j=(0,n()._h)(x,(e=>e.ReportPageModal)),I=(0,n()._h)(x,(e=>e.GoogleAuthPromptModal)),M=(0,n()._h)(x,(e=>e.StudentNotEligibleModal)),T=(0,n()._h)(x,(e=>e.CookieModal)),w=(0,n()._h)(x,(e=>e.BlockMenu)),P=(0,n()._h)(x,(e=>e.CollectionMentionContextMenu)),_=(0,n()._h)(x,(e=>e.ForkPagePopup)),B=(0,n()._h)(x,(e=>e.CollectionTypedDatabaseMigrationModal)),R=(0,n()._h)(x,(e=>e.SidebarCreateTeamModal)),V=(0,n()._h)(x,(e=>e.SidebarTeamModal)),E=(0,n()._h)(x,(e=>e.CreateTeamFromPageConfirmModal)),F=(0,n()._h)(x,(e=>e.OpenInDesktopAppPopup)),D=(0,n()._h)(x,(e=>e.ImportIntoNewPageModal)),L=(0,n()._h)(x,(e=>e.MobilePageBacklinksMenuRenderer)),O=(0,n()._h)(x,(e=>e.MobileShareMenuRenderer)),K=(0,n()._h)(x,(e=>e.MobilePageUpdatesMenuRenderer)),N=(0,n()._h)(x,(e=>e.MobileCommentsModalRenderer)),W=(0,n()._h)(x,(e=>e.MobileBreadcrumbMenuRenderer))},79976:(e,t,o)=>{o.r(t),o.d(t,{duplicateBlock:()=>I});o(16280),o(898992),o(823215),o(581454),o(737550);var n=()=>o(907258),i=()=>o(929219),r=()=>o(675133),a=()=>o(711339);class s{constructor(e){this.environment=void 0,this.metricName=void 0,this.startMetric=void 0,this.prevLapMetric=void 0,this.extraData=void 0,this.environment=e.environment,this.metricName=e.metricName,this.startMetric=a().default.mark(e.metricName),this.prevLapMetric=a().default.mark(e.metricName),this.extraData=e.extraData??{}}mark(e){a().default.measure(this.prevLapMetric,{environment:this.environment,data:{type:e,...this.extraData},sampleDecision:"default"}),this.prevLapMetric=a().default.mark(this.metricName)}end(){a().default.measure(this.startMetric,{environment:this.environment,data:{type:"total",...this.extraData},sampleDecision:"default"})}}var l=()=>o(792057),c=()=>o(489295),d=()=>o(723085),u=()=>o(700500),p=()=>o(665344),m=()=>o(854150),g=()=>o(763824),y=()=>o(973647),h=()=>o(863168),f=()=>o(37450),v=()=>o(931729),x=()=>o(418375),S=()=>o(360886),b=()=>o(977529),A=()=>o(761986),C=()=>o(731892),k=()=>o(949653),j=()=>o(677733);function I(e){if(e.skipUserFacingMessages)return M(e);const t=C().CU({sourceBlocks:e.stores});try{const o=M({...e,onRedundantDuplicationError:()=>{(0,b().Yv)()}});return{...o,onComplete:o.onComplete.then((e=>("success"===e.status?C().MK(t):C().UO(t),e))).catch((e=>{throw C().UO(t),e}))}}catch(o){throw C().UO(t),o}}function M(e){const{environment:t,stores:o,transaction:a,targetSpaceId:b,executionTarget:C,from:I,options:M,installationImprint:T,templateInstallationMetadata:w,shouldUseSynchronousDuplicationAPI:P,skipUserFacingMessages:_,onRedundantDuplicationError:B}=e,R="local"===(x().A.getState().executionTarget??C)?"local_duplication":P?"server_synchronous_duplication":"server_duplication",V=new s({environment:t,metricName:"duplicate_block_stopwatch",extraData:{duplication_type:R,from:I}});if(0===o.length)throw new Error("Must duplicate at least one block");const E=o[0].getSpaceId();if(!o.every((e=>e.getSpaceId()===E)))throw new Error("All stores must be in the same space");if(o.length>1&&!M.useSharedContext&&!o.every((e=>e.isTypedCollectionViewBlock())))throw new Error("Multiple source blocks only supported for grouped typed DB duplication unless useSharedContext option is true");!function(e){const{environment:t,stores:o}=e;for(const i of o){const e=(0,c().zH)(i).getValue();if(!e)continue;const{sidebarSpaceStore:o}=n().default.getState();let r;o&&e.parent_table===m().yK&&(r=d().h.createChildStore(o,{table:m().yK,id:e.parent_id}));const{collectionId:a,ownedCollectionCount:s,linkedCollectionCount:l}=(0,v().P)(i,{skipPages:!1}),p={from:"copy",type:e.type,teamStore:r,is_toggleable:(0,u().Yt)(e.type,e.format),collection_id:a,owned_collection_count:s,linked_collection_count:l,new_page_id:"page"===e.type?i.id:void 0,creating_block_id:i.id,parent_collection_id:i.getParentCollectionIdUpToTwoLevels(),form_id:i.getFirstFormIdInCollectionViewBlock()};f().tP(e.type)?f().vH(t,{...p,type:e.type,collection_id:a||""}):f().vH(t,{...p,type:e.type})}}({environment:t,stores:o}),V.mark("track_create_blocks"),M.convertExternalObjectInstancesToPlaceholders=E!==b;const F=w&&(0,p().Fe)(w.source)&&w.isListedTemplate;if(1===o.length&&"local_duplication"===R&&!F){const e=(0,k().tryLocalDuplicateWithTransaction)({environment:t,store:o[0],options:M,sourceSpaceId:E,targetSpaceId:b,transaction:a,installationImprint:T,templateInstallationMetadata:w,stopwatch:V,from:I});if(e)return V.mark("try_local_duplication_success"),V.end(),{blockStores:[e],onComplete:Promise.resolve({status:"success"})};V.mark("try_local_duplication_failure")}const D=t.defaultRecordCache.inMemoryRecordCache;if(o.some((e=>e.inMemoryRecordCache!==D)))throw new Error("Can only server duplicate from the environment.defaultRecordCache.inMemoryRecordCache.");i().A.state.online||l().f1(r().A.formatMessage(S().V.offlineError));const L=(0,j().serverDuplicate)({environment:t,sourceBlocks:o.map((e=>({id:e.id,spaceId:e.getSpaceId()}))),targetInMemoryRecordCache:D,transaction:a,targetSpaceId:b,installationImprint:T,templateInstallationMetadata:w,stopwatch:V,shouldUseSynchronousDuplicationAPI:P,options:M,from:I,onRedundantDuplicationError:B});if(V.mark("duplicate_block_immediate_return"),y().Q.isFail(L))throw _||(0,A().x)({environment:t,duplicateError:L.error}),L.error;const{blockStores:O,onComplete:K}=L.value,N=g().yX();return K.then((e=>{if(V.end(),y().Q.isSuccess(e)){for(const e of O)if("ai_block"===e.getType()){h().EF.setState(e.pointer.id);break}N.resolve({status:"success",recordIdMap:e.value.recordIdMap})}else{var o;_||(0,A().x)({environment:t,duplicateError:e.error,blockStores:O}),N.resolve({status:"error",error:e.error,errorMessage:null===(o=(0,A().V2)(e.error))||void 0===o?void 0:o.description})}})),{blockStores:O,onComplete:N.promise}}},95199:(e,t,o)=>{o.d(t,{Ud:()=>z});o(898992),o(354520),o(581454);var n=o(296540),i=()=>o(726637),r=()=>o(484714),a=()=>o(590526),s=()=>o(401497),l=()=>o(755125),c=()=>o(699143),d=()=>o(250910),u=()=>o(31511),p=()=>o(890492),m=()=>o(81068),g=()=>o(663639),y=()=>o(736847),h=()=>o(422540),f=()=>o(462618),v=()=>o(352271),x=()=>o(80979),S=()=>o(791089),b=()=>o(519831),A=()=>o(69708),C=()=>o(100622),k=()=>o(496603),j=()=>o(534177),I=()=>o(384944),M=()=>o(89053),T=()=>o(166006),w=()=>o(658160),P=()=>o(546461),_=()=>o(653417),B=()=>o(122414),R=()=>o(366360),V=()=>o(858163),E=()=>o(133518),F=()=>o(781697),D=()=>o(656134),L=()=>o(548526),O=()=>o(464004),K=()=>o(938818),N=o(474848);const W=(0,A().YK)({replaceActionLabel:{id:"automations.AutomationActionSetPropertiesSection.replaceAction.label",defaultMessage:"Replace with"},appendActionLabel:{id:"automations.AutomationActionSetPropertiesSection.appendAction.label",defaultMessage:"Add"},removeActionLabel:{id:"automations.AutomationActionSetPropertiesSection.removeAction.label",defaultMessage:"Remove"},toggleActionLabel:{id:"automations.AutomationActionSetPropertiesSection.toggleAction.label",defaultMessage:"Toggle"},titlePlaceholder:{id:"automations.AutomationActionSetPropertiesSection.titlePlaceholder",defaultMessage:"Untitled"},automationActionPropertyDeleted:{id:"automations.AutomationActionSetPropertiesSection.automationActionPropertyDeleted",defaultMessage:"This property was deleted"},automationActionPropertyUnsupported:{id:"automations.AutomationActionSetPropertiesSection.automationActionPropertyUnsupported",defaultMessage:"This property is unsupported"}});function z(e){const{actionStore:t,collectionStore:o,disabled:i,showSetPropertyActions:s}=e,l=(0,r().v3)(),{automationStore:c}=(0,P().q8)(),{maybePersistedTransactionActions:d}=(0,R().b)(),u=(0,a().K8)((()=>{var e;return(null===(e=t.getConfig())||void 0===e?void 0:e.values)??{}}),[t]),p=(0,a().K8)((()=>{var e;return(null===(e=t.getConfig())||void 0===e?void 0:e.properties)??[]}),[t]),m=(0,n.useCallback)((e=>{const o=p.concat([e]),n={...u,[e]:void 0};d.createAndCommit({userAction:"AutomationActionSetPropertiesSection.propertiesChange",perform:e=>{U({configStore:t.getConfigStore(),properties:o,transaction:e,values:n})}}),(0,B().UB)(l,{automationActionStore:t,automationStore:c})}),[p,u,d,l,c,t]),g=(0,n.useCallback)(((e,o)=>{const n=p.indexOf(e);if(-1===n)return;const i=p.slice(0);i[n]=o;const r={...u,[o]:void 0};d.createAndCommit({userAction:"AutomationActionSetPropertiesSection.setProperties",perform:e=>{U({configStore:t.getConfigStore(),properties:i,transaction:e,values:r})}}),(0,B().UB)(l,{automationActionStore:t,automationStore:c})}),[p,u,d,l,c,t]),y=(0,n.useCallback)((e=>{const o=p.filter((t=>t!==e)),n={...u,[e]:void 0};d.createAndCommit({userAction:"AutomationActionSetPropertiesSection.removeProperty",perform:e=>{U({configStore:t.getConfigStore(),properties:o,transaction:e,values:n})}}),(0,B().UB)(l,{automationActionStore:t,automationStore:c})}),[p,u,d,l,c,t]),h=(0,n.useCallback)(((e,o)=>{const n={...u,[e]:o};d.createAndCommit({userAction:"AutomationActionSetPropertiesSection.handleValueChange",perform:e=>{U({configStore:t.getConfigStore(),properties:p,transaction:e,values:n})}}),(0,B().UB)(l,{automationActionStore:t,automationStore:c})}),[u,d,l,t,c,p]);return(0,N.jsx)(H,{actionStore:t,collectionStore:o,disabled:i,onPropertyAdd:m,onPropertyChange:g,onPropertyRemove:y,onPropertyValueChange:h,showSetPropertyActions:s})}function U(e){const{configStore:t,properties:o,transaction:n,values:i}=e;I().zv({store:t,data:{properties:o,values:i},transaction:n})}function H(e){const{actionStore:t,collectionStore:o,onPropertyAdd:n,onPropertyChange:i,onPropertyRemove:r,onPropertyValueChange:l,disabled:c,showSetPropertyActions:d}=e,u=(0,s().IS)((()=>({addPropertyRow:{display:"flex",alignItems:"center"}})),[]),p=(0,a().K8)((()=>t.getConfigStore().getKeyStore("properties").getValue()??[]),[t]),m=(0,a().K8)((()=>(0,h().m7)({collectionFormat:o.getFormat(),collectionSchema:o.getSchema(),filter:([e])=>!p.includes(e),spaceId:o.getSpaceId(),restrictCrossSpace:!0})),[o,p]),g=0===m.length;return(0,N.jsxs)(N.Fragment,{children:[p.length>0?(0,N.jsx)(Y,{actionStore:t,availablePropertyIds:m,collectionStore:o,disabled:c,onPropertyChange:i,onPropertyRemove:r,onPropertyValueChange:l,showSetPropertyActions:d}):void 0,c||g?void 0:(0,N.jsx)("div",{style:u.addPropertyRow,children:(0,N.jsx)(O().l,{availablePropertyIds:m,currentValue:void 0,collectionStore:o,onChange:n,disabled:c,alreadyHaveProperties:p.length>0})})]})}function Y(e){const{actionStore:t,availablePropertyIds:o,collectionStore:n,onPropertyChange:r,onPropertyRemove:l,onPropertyValueChange:c,showSetPropertyActions:d,disabled:u}=e,p=(0,s().IS)((()=>({wrap:{alignItems:"start",columnGap:4,display:"grid",gridTemplateColumns:i().A.isMobile?"100%":"160px 1fr",minWidth:0,rowGap:i().A.isMobile?4:8},propertyValue:{...i().A.isMobile?{fontSize:14,marginBlockEnd:16}:{}},lastPropertyValue:{...i().A.isMobile?{fontSize:14,marginBlockEnd:0}:{}}})),[]),[m,g]=(0,a().K8)((()=>{const e=t.getConfig();return[(null==e?void 0:e.properties)??[],(null==e?void 0:e.values)??{}]}),[t]);return(0,N.jsx)("div",{style:p.wrap,children:m.map(((e,i)=>{const a=i===m.length-1;return(0,N.jsx)(G,{actionStore:t,availablePropertyIds:o,collectionStore:n,disabled:u,onPropertyChange:r,onPropertyRemove:l,onPropertyValueChange:c,property:e,showSetPropertyActions:d,value:g[e],valueStyle:a?p.lastPropertyValue:p.propertyValue},e)}))})}function G(e){const{actionStore:t,availablePropertyIds:o,collectionStore:i,disabled:r,onPropertyChange:l,onPropertyRemove:d,onPropertyValueChange:p,property:m,showSetPropertyActions:g,value:y,valueStyle:C}=e,k={type:"collection",collectionStore:i,property:m},j=(0,A().tz)(),I=(0,s().IS)((()=>({propertyName:{display:"flex"},propertyValue:{display:"flex",gap:4,minWidth:50,...C},propertyValueInput:{minWidth:50}})),[C]),T=(0,n.useMemo)((()=>{if("title"===m)return j.formatMessage(W.titlePlaceholder)}),[j,m]),w=(0,a().K8)((()=>i.getSchema()[m]||i.getDeletedSchema()[m]),[i,m]),B=(0,a().K8)((()=>Boolean(!i.getSchema()[m])),[i,m]),V=(0,a().K8)((()=>{if(w)return(0,S().setPropertyValueToSimpleFormulaReturnType)({table:b().Vl,id:i.id,spaceId:i.getSpaceId()},m,w)}),[i,w,m]),F=(0,n.useMemo)((()=>{if(w&&(0,h().I3)(w))return w.type}),[w]),D=(0,n.useMemo)((()=>w&&!(0,h().I3)(w)),[w]),L=null==y?void 0:y.value,z=(0,a().K8)((()=>(0,v().tz)(y)),[y]),{automationStore:U}=(0,P().q8)(),H=(0,P().fi)(),Y=(0,E().i)(),G=(0,a().K8)((()=>U.getSpaceId()),[U]),$=(0,E().F)({actionId:t.id}),Q=(0,a().K8)((()=>{if(F&&G)return(0,S().analyzeSimpleFormulaOrFormulaSync)({context:{allowedReturnTypes:h().Yy[F],handleDataRequest:(0,x().createFormulaDataRequestSyncHandler)(t.getRecordModel),spaceId:G,valueTypes:$.slice(0),featureGates:(0,M().i)(),guaranteedPropertyIds:Y,enableExistenceGuarantees:H},value:null==y?void 0:y.value})}),[t.getRecordModel,H,$,Y,G,F,null==y?void 0:y.value]),{suppressActionErrors:Z}=(0,R().b)(),J=(0,n.useMemo)((()=>!Z.includes(t.id)),[Z,t]),{errorMessage:ee}=(0,_().useErrorComponentForAction)({actionId:t.id,errorKey:m,shouldShow:J}),te=(0,n.useCallback)((e=>{l(m,e)}),[l,m]),oe=(0,n.useCallback)((()=>d(m)),[d,m]),ne=(0,n.useCallback)((e=>{p(m,e)}),[p,m]),ie=(0,n.useCallback)((e=>{ne({action:e,value:L})}),[L,ne]),re=(0,n.useCallback)((e=>{ne({action:z,value:e})}),[z,ne]);if(!G)return null;const ae=function(e){if("email"===e||"phone_number"===e||"url"===e)return{disableEmojiCommands:!0,disableFormattingAndMentions:!0};return{}}(F);let se;return B?se=(0,N.jsx)(A().sA,{...W.automationActionPropertyDeleted}):D?se=(0,N.jsx)(A().sA,{...W.automationActionPropertyUnsupported}):ee&&(se=ee),(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("div",{style:I.propertyName,children:(0,N.jsx)(O().l,{availablePropertyIds:o,currentValue:m,collectionStore:i,onChange:te,disabled:r,onRemove:oe,errorMessage:se})}),(0,N.jsxs)("div",{style:I.propertyValue,children:[!B&&g&&w&&f().M[w.type]?(0,N.jsx)(q,{disabled:r,onChange:ie,value:z}):void 0,B?(0,N.jsx)(u().A,{disabled:!0,placeholder:j.formatMessage(W.automationActionPropertyDeleted)}):D?(0,N.jsx)(u().A,{disabled:!0,placeholder:j.formatMessage(W.automationActionPropertyUnsupported)}):F&&V?(0,N.jsxs)(c().Y1,{direction:"vertical",gap:7,style:I.propertyValueInput,children:[(0,N.jsx)(X,{...ae,analyzedFormulaOutput:Q,automationActionStore:t,disabled:r,disableMobileActionBar:!0,simpleFormulaContext:k,formulaTypecheckContextValues:$,onChange:re,parentRecordStore:t,placeholder:T,propertyType:F,spaceId:G,type:V,value:null==y?void 0:y.value}),Q?(0,N.jsx)(K().J,{analyzedFormulaOutput:Q}):void 0]}):null]})]})}function q(e){const{disabled:t,onChange:o,value:n}=e,i=(0,s().IS)((()=>({button:{boxShadow:C().Tj.inputBoxShadow,minWidth:120}})),[]),r=(0,D().j)();return(0,N.jsx)(d().A,{popupType:r,alignmentToOrigin:"end",placementToOrigin:"bottom",originGap:0,disabled:t,renderOrigin:e=>(0,N.jsx)(L().x,{...e,disabled:t,style:i.button,dropdownButtonType:"button",children:(0,N.jsx)(Q,{action:n})}),render:e=>(0,N.jsx)($,{onChange:o,parent:e,value:n})})}function $(e){const{value:t,onChange:o,parent:n}=e,i=(0,F().e)({width:250}),r=k().oE(v().Au.map(((e,i)=>({key:i,render:o=>(0,N.jsx)(m().A,{...o,disabled:!1,title:(0,N.jsx)(Q,{action:e}),isChecked:t===e}),action:()=>{e!==t&&o(e),n.close()}}))));return(0,N.jsx)(p().A,{...i,children:(0,N.jsx)(g().A,{type:g().O.Vertical,sections:[{key:0,render:e=>(0,N.jsx)(y().A,{enableActionSheetTitle:!0,...e}),items:r}],initialFocus:0})})}function Q(e){const{action:t}=e;return"replace"===t?(0,N.jsx)(A().sA,{...W.replaceActionLabel}):"append"===t?(0,N.jsx)(A().sA,{...W.appendActionLabel}):"remove"===t?(0,N.jsx)(A().sA,{...W.removeActionLabel}):"toggle"===t?(0,N.jsx)(A().sA,{...W.toggleActionLabel}):void(0,j().HB)(t)}function X(e){const{analyzedFormulaOutput:t={},automationActionStore:o,disabled:i,disableEmojiCommands:a,disableFormattingAndMentions:c,disableMobileActionBar:d,formulaTypecheckContextValues:u,onChange:p,parentRecordStore:m,placeholder:g,propertyType:y,simpleFormulaContext:f,spaceId:v,type:x,value:S}=e,{parseErrors:b=[],typeErrors:A=[]}=t,C=b.length>0||A.length>0,{onTextStoreSelect:k,onTextStoreUnselect:j}=(0,V().W)(o),I=(0,s().IS)((()=>({input:{width:"100%"}})),[]),M=(0,r().v3)(),P=(0,n.useCallback)((()=>{(0,l().clear)({environment:M})}),[M]);return"text"===x.type?(0,N.jsx)(T().Y,{allowedReturnTypes:h().Yy[y],disabled:i,disableEmojiCommands:a,disableMobileActionBar:d,formulaTypecheckContextValues:u,onChange:p,onTextStoreSelect:k,onTextStoreUnselect:j,onTextEsc:P,parentRecordStore:m,spaceId:v,placeholder:g,style:I.input,shouldShowErrorStyles:C,value:S}):"number"===x.type?(0,N.jsx)(T().Y,{allowedReturnTypes:h().Yy[y],disabled:i,disableEmojiCommands:!0,disableInsertedDeletedAnnotations:!0,disableMentions:!0,disableMobileActionBar:!0,disableStyleAnnotations:!0,formulaTypecheckContextValues:u,onChange:p,onTextStoreSelect:k,onTextStoreUnselect:j,onTextEsc:P,parentRecordStore:m,spaceId:v,style:I.input,shouldShowErrorStyles:C,value:S}):(0,N.jsx)(w().U,{allowedReturnTypes:h().Yy[y],disabled:i,disableEmojiCommands:a,disableFormattingAndMentions:c,disableMobileActionBar:d,formulaTypecheckContextValues:u,onChange:p,parentRecordStore:m,placeholder:g,simpleFormulaContext:f,spaceId:v,type:x,value:S})}},100762:(e,t,o)=>{o.d(t,{z:()=>i});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.25 3.23 13.5 9.53",svg:(0,o(474848).jsx)("path",{fillRule:"evenodd",d:"m6.947 10.005.87 2.352a.625.625 0 0 0 1.172-.433l-2.99-8.09a.916.916 0 0 0-1.718 0l-2.99 8.09a.625.625 0 0 0 1.173.433l.869-2.352zm-.462-1.25L5.14 5.115l-1.345 3.64zm7.637-1.905c.345 0 .625.28.625.625v4.665a.625.625 0 0 1-1.243.094 2.75 2.75 0 0 1-1.65.531 2.7 2.7 0 0 1-1.972-.822c-.514-.537-.804-1.288-.804-2.16 0-.874.29-1.616.81-2.142.519-.524 1.222-.79 1.967-.79.6 0 1.177.173 1.652.515a.625.625 0 0 1 .615-.516m-3.794 2.933c0-.59.191-1.002.45-1.264.26-.263.632-.419 1.076-.419s.824.157 1.09.422c.262.263.456.674.456 1.26 0 1.137-.72 1.733-1.546 1.733a1.45 1.45 0 0 1-1.07-.437c-.264-.276-.456-.704-.456-1.295",clipRule:"evenodd"})},i=(0,o(340498).wt)("textFormatSmall",n,"small")},106702:(e,t,o)=>{o.d(t,{$:()=>r});var n=()=>o(590526);const i=new(o(140934).ComputedStore)((()=>o(907258).default.state.currentUserStore),{debugName:"AppStoreCurrentUserStore"});function r(){return(0,n().O$)(i)}},108184:(e,t,o)=>{o.r(t),o.d(t,{COMPLETION_THROTTLE:()=>C,PREVIEW_STEP_DELAY:()=>k,maybeUpdateAIUsageEligibilityStoreV2:()=>T,maybeUpdateAiEligibility:()=>M,postProcessAICreatedStores:()=>I,showCompletionErrorWithCode:()=>j,wrapTemporaryBlocksInList:()=>w});o(18107),o(967357);var n=()=>o(242422),i=()=>o(675133),r=()=>o(128933),a=()=>o(770063),s=()=>o(878126),l=()=>o(165358),c=()=>o(179034),d=()=>o(427419),u=()=>o(720665),p=()=>o(753812),m=()=>o(722101),g=()=>o(384944),y=()=>o(274873),h=()=>o(412669),f=()=>o(556122),v=()=>o(594794),x=()=>o(668721),S=()=>o(685377),b=()=>o(661077),A=()=>o(96563);const C=300,k=250;function j(e){const t=i().A.getIntl();return 451===e?r().D6({label:t.formatMessage({id:"completionActions.moderationError",defaultMessage:"AI does not allow content that is harmful or illegal. Please revise your input and try again. (451)"})}):413===e?r().D6({label:t.formatMessage({id:"completionActions.promptOrAttachmentTooLarge",defaultMessage:"Query or attachment is too large. Please revise your input and try again. (413)"})}):502===e||503===e||504===e?r().D6({label:t.formatMessage({id:"completionActions.providerError",defaultMessage:"Were experiencing issues with our AI provider. Try again in a few minutes. ({errorCode})"},{errorCode:e})}):void r().D6({label:t.formatMessage({id:"completionActions.genericError",defaultMessage:"AI is temporarily unavailable. Try again in a few minutes. ({errorCode})"},{errorCode:e})})}function I(e,t){for(const o of t)y().In({environment:e,blockStore:o})}async function M(e,t,o){let i;if(n().default.checkGate({gateName:"usage_based_pricing_pfa_checks_purchased_credits_enabled"}))return void(await T(e,t,o));n().default.checkGate({gateName:"usage_based_pricing_alpha_enabled"})&&T(e,t,o).catch((e=>{l().log({level:"error",from:"ai.completionActions",type:"maybeUpdateAIUsageEligibilityStoreV2Error",spaceId:t,error:e})}));const r=f().TI();if(r.debug)i=402!==r.showErrorCode;else{const n=x().o.getState();if(n&&n.isEligible&&"unlimited"===n.type&&!o){const e=n.lastUpdatedAt;if(Date.now()-e<10*u().Xb)return}const r=await p().callCellCompatibleApi({eventName:"getAIUsageEligibility",environment:e,data:{spaceId:t},cellNavigation:{cellId:void 0,spaceId:t}});if("success"===r.type){i=r.data.isEligible,i&&h().K.state&&h().K.setState(!1);const e=!1===(null==n?void 0:n.isEligible)&&(null==n?void 0:n.requestedAccess),t=r.data.researchModeUsage??0;x().o.setState({...r.data,lastUpdatedAt:Date.now(),researchModeUsage:t,...!1===r.data.isEligible&&{requestedAccess:e}})}}void 0!==i&&b().P.setState(i)}async function T(e,t,o){const n=await s().T.awaitData(e,{spaceId:t}),i=S().y.getData(e,{spaceId:t});if(n){if(i&&(0,d().Hg)(n)&&!o){const e=i.lastUpdatedAt;if(Date.now()-e<10*u().Xb)return}await(0,A().y3)(e,t)}}function w(e){var t;const{environment:o,stores:n,listId:i,inMemoryRecordCache:r,transaction:s}=e,l=(null===(t=n.at(0))||void 0===t?void 0:t.getSpaceId())??s.spaceId,d=new(a().pm)({environment:o,pointer:{table:c().ev,id:i||(0,v().Z1)({environment:o,table:c().ev,spaceId:l}),spaceId:l},recordStoreOptions:{inMemoryRecordCache:r,userId:o.currentUser.id},path:["content"]});for(const a of n)m().BC({parentStore:d,appendStore:a,transaction:s}),g().zv({store:a,data:{parent_id:d.id,parent_table:d.table,alive:!0},transaction:s});return d}},114912:(e,t,o)=>{o.d(t,{_:()=>d});o(296540);var n=()=>o(726637),i=()=>o(718827),r=()=>o(807449),a=()=>o(302501),s=()=>o(324254),l=()=>o(424400),c=o(474848);function d(e){return(0,c.jsx)(i().Ay,{onClick:e.onClick,hovered:e.focused,disabled:e.disabled,style:{width:"100%",...!n().A.isMobile&&{borderRadius:6},...e.buttonStyle},hoveredStyle:e.hoveredButtonStyle,pressedStyle:e.pressedButtonStyle,children:(0,c.jsx)(l().Ay,{...e,dontShrinkTitle:!0,right:(0,c.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"nowrap",gap:4},children:[e.right?(0,c.jsx)(a().A,{isSecondaryColor:!0,children:e.right}):void 0,n().A.isMobile?void 0:(0,c.jsx)("div",{style:{flexShrink:0,transform:"right"===e.chevronType?"rotate(calc(var(--direction, 1) * -90deg))":void 0,transition:"transform 0.2s ease"},children:(0,c.jsx)(r().I,{icon:s().arrowChevronSingleDownSmallIcon,size:"xs",colorVariant:"tertiary"})})]})})})}},118849:(e,t,o)=>{o.d(t,{u:()=>h});o(296540);var n=()=>o(726637),i=()=>o(484714),r=()=>o(590526),a=()=>o(401497),s=()=>o(26697),l=()=>o(979340),c=()=>o(69708),d=()=>o(100622),u=()=>o(534177),p=()=>o(284371),m=()=>o(824160),g=()=>o(991249),y=o(474848);function h({subscriptionTier:e,mobileStyle:t,desktopStyle:o,analyticsName:h,onClick:f,disableTooltip:v,tooltipContent:x,spaceStore:S}){const b=(0,a().eP)(),A=(0,i().v3)(),{device:C}=A,k=(0,r().K8)((()=>null==S?void 0:S.canAdmin()),[S]),j=(0,r().K8)((()=>function(e,t){switch(e){case"plus":case"business":case"enterprise":return{color:d().Tj.blue.text.accentPrimary,background:"light"===t?d().oZ.diffBackground:"rgba(35, 131, 226, 0.2)",fontWeight:p().Wy.medium};default:return{}}}(e,b)),[e,b]);if(C.isMobileNative)return null;let I;return"personal"===e?I=(0,y.jsx)(c().sA,{defaultMessage:"Personal Pro",id:"upgradeButton.personal.text"}):(0,l().$P)(e)?I=(0,y.jsx)(c().sA,{defaultMessage:"Plus ",id:"upgradeButton.plus.textWithArrow"}):(0,l().tL)(e)?I=(0,y.jsx)(c().sA,{defaultMessage:"Business ",id:"upgradeButton.business.textWithArrow"}):(0,l().OX)(e)?I=(0,y.jsx)(c().sA,{defaultMessage:"Enterprise ",id:"upgradeButton.enterprise.textWithArrow"}):(0,u().HB)(e),n().A.isMobile||!k?(0,y.jsx)(m().A,{mobileStyle:t,children:I}):(0,y.jsx)(s().m,{delayThreshold:120,disableTooltip:v,placement:"bottom",renderTooltip:()=>(0,y.jsx)("div",{style:{maxWidth:500},children:x?(0,y.jsx)(c().sA,{defaultMessage:"{tooltipText}",id:"upgradeButton.upgrade.custom.tooltip",values:{tooltipText:x}}):(0,y.jsx)(c().sA,{defaultMessage:"Upgrade to use this feature.",id:"upgradeButton.upgrade.tooltip"})}),originGap:6,render:t=>(0,y.jsx)(m().A,{desktopStyle:o,innerStyle:j,onClick:t=>function(e,t,o,n,i,r){g().K(n,{from:t,upsell:{type:"product",product:o,limit:{type:"none"},trialability:"none"},spaceStore:i}),r&&r(e)}(t,h,e,A,S,f),...t,children:I})})}},132389:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var n=o(474848);function i(e){const t={display:"inline-block",minWidth:e.size,minHeight:e.size};return"x"===e.axis?t.minHeight=1:"y"===e.axis&&(t.minWidth=1),(0,n.jsx)("div",{style:t})}},169413:(e,t,o)=>{o.r(t),o.d(t,{AutomationWorkflowEditor:()=>wr,AutomationWorkflowEditorActionSection:()=>Cr,ButtonBlockUrlPreviewPopup:()=>Nr,PlacedButtonBlockEditor:()=>_r,automationActions:()=>i(),automationErrorHelpers:()=>ge(),automationExecutionActions:()=>n});var n={};o.r(n),o.d(n,{executeClientAutomation:()=>pe,shouldShowSuccessSnackbar:()=>me});var i=()=>o(324587),r=(o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(823215),o(354520),o(581454),()=>o(564884)),a=()=>o(242422),s=()=>o(726637),l=()=>o(381175),c=()=>o(675133),d=()=>o(128933),u=()=>o(570672),p=()=>o(483226),m=()=>o(584262),g=()=>o(368609),y=()=>o(496603),h=()=>o(973647),f=()=>o(534177),v=()=>o(322867),x=()=>o(648651),S=()=>o(103966);function b(e,t){if(e instanceof v().iA){var n;return{type:"external_http_request_failed",actionId:t,host:o(188835).parse(e.data.url).host||"unknown",errorCode:(null===(n=e.data.statusCode)||void 0===n?void 0:n.toString())||"unknown"}}if(e instanceof v().F_){const o=e.data.cause;let n;return"errorSource"in o&&(0,f().O9)(o.errorSource)&&(n=o.errorSource),{type:"formula_execution_error",actionId:t,errorSource:n}}return{type:"unknown",actionId:t}}const A=(0,v().kB)((async function(e){const{context:t,executeAutomationActionFn:o}=e,{actionModels:n,automationModel:i,contextType:r,runtimeStats:a}=t;let s=t.values;const l=performance.now();let c,d={value:{success:!0,stopExecution:!1}};if("button_block"===r||"button_property"===r){if(!i.isButtonType())return{error:new(v().zK)({message:`Automation trigger (${i.getTriggerType()}) does not match context type (${r}).`})};const e=i.getTrigger();c=(0,S().Z)(i.getTriggerType()).execute(t,e)}else if("event"===r){if(!i.isEventType())return{error:new(v().zK)({message:`Automation trigger (${i.getTriggerType()}) does not match context type (${r}).`})};const e=i.getTrigger();c=(0,S().Z)(i.getTriggerType()).execute(t,e)}else if("recurrence"===r){if(!i.isRecurrenceType())return{error:new(v().zK)({message:`Automation trigger (${i.getTriggerType()}) does not match context type (${r}).`})};const e=i.getTrigger();c=(0,S().Z)(i.getTriggerType()).execute(t,e)}else(0,f().HB)(t);if(h().Q.isFail(c))return c;s=s.concat((0,y().o8)(c.value.values));const u=o??C;let p;for(const y of n){var m,g;if(null!==(m=t.abortSignal)&&void 0!==m&&m.aborted)return{error:new(v().be)({actionId:y.id})};const e=await u({action:y,values:s,executionContext:t}),o=null==a||null===(g=a.actionStats)||void 0===g||null===(g=g[y.id])||void 0===g?void 0:g.executionDurationMs;if((0,f().O9)(o)&&o>=5e3&&t.executeEffectMap.logMessage({from:"executeAutomation",level:"warning",type:"longRunningAutomationAction",data:{durationMs:o,automationId:i.id,actionId:y.id,actionType:y.getType()}}),h().Q.isFail(e)){d=e,p=y.id;break}if(s=s.concat(e.value.values),e.value.stopExecution){d={value:{success:!0,stopExecution:!0}};break}}const b=await t.executeEffectMap.updateLastRunTimesForObservability({automationModel:t.automationModel,executeResult:d,failedActionId:p});h().Q.isFail(b)&&(d=b);const A=Math.trunc(performance.now()-l);a&&(a.executionStartTime=l,a.executionDurationMs=A,a.executionSuccess=h().Q.isSuccess(d),x().hs.aggregate(a));var k,j;A>=3e4&&t.executeEffectMap.logMessage({from:"executeAutomation",level:"warning",type:"longRunningAutomation",data:{automationId:i.id,durationMs:A,miscDataToConvertToString:{automationContextType:t.contextType,automationEventId:t.eventId,eventRecordId:null===(k=t.event)||void 0===k?void 0:k.record_id,eventRecordTable:null===(j=t.event)||void 0===j?void 0:j.record_table}},spaceId:i.space_id});return d}),(e=>e.context.automationModel.id));async function C(e){const{action:t,values:o,executionContext:n}=e,i=(0,g().getActionRegistryItem)(t.getType());return i.requiresPriorTransactionsCommitted&&await n.executeEffectMap.waitForTransactionsCommitted(),await i.execute({...n,values:o},t)}var k=()=>o(247331),j=()=>o(201980),I=()=>o(352271);var M=()=>o(502856),T=()=>o(165358),w=()=>o(416504),P=()=>o(728272),_=()=>o(798880),B=()=>o(498212),R=()=>o(495262),V=()=>o(479788),E=()=>o(89053),F=()=>o(842076),D=()=>o(862292),L=()=>o(211716),O=()=>o(535960),K=()=>o(711339);const N={...x().hs,logNotionPerformance(e){const{automationStats:t,environment:o}=e;if((0,x().oh)(t)){var n;const e={metricName:"automation_client_execution_duration",startTime:t.executionStartTime,endTime:t.executionStartTime+t.executionDurationMs};K().default.measure(e,{environment:o,data:{success:t.executionSuccess,has_formulas:((null===(n=t.formulaStats)||void 0===n?void 0:n.totalFormulas)??0)>0}})}for(const r of Object.values(t.actionStats))if((0,x().WV)(r)){var i;const e={metricName:"automation_client_action_execution_duration",startTime:r.executionStartTime,endTime:r.executionStartTime+r.executionDurationMs};K().default.measure(e,{data:{automation_action_type:r.actionType,success:r.executionSuccess,has_formulas:((null===(i=r.formulaStats)||void 0===i?void 0:i.totalFormulas)??0)>0},environment:o})}}};var W=()=>o(433337),z=()=>o(69708);const U=(0,z().YK)({genericSuccessMessage:{id:"automations.buttonTrigger.genericSuccessMessage",defaultMessage:"Button automation ran successfully"},createdBlocks:{defaultMessage:"Created {numBlocksDuplicated, plural, one {1 block} other {{numBlocksDuplicated} blocks}} on page",id:"automations.buttonTrigger.createdBlocks"},createdSprintsUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.createdSprints"},updatedSprintsUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.updatedSprints"},createdSprintsLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.createdSprintsLowercase"},updatedSprintsLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 sprint} other {{numPagesModified} sprints}}",id:"automations.buttonTrigger.updatedSprintsLowercase"},createdTasksUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.createdTasks"},updatedTasksUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.updatedTasks"},createdTasksLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.createdTasksLowercase"},updatedTasksLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 task} other {{numPagesModified} tasks}}",id:"automations.buttonTrigger.updatedTasksLowercase"},createdProjectsUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.createdProjects"},updatedProjectsUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.updatedProjects"},createdProjectsLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.createdProjectsLowercase"},updatedProjectsLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 project} other {{numPagesModified} projects}}",id:"automations.buttonTrigger.updatedProjectsLowercase"},createdPagesUppercase:{defaultMessage:"Created {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.createdPages"},updatedPagesUppercase:{defaultMessage:"Edited {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.updatedPages"},createdPagesLowercase:{defaultMessage:"created {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.createdPagesLowercase"},updatedPagesLowercase:{defaultMessage:"edited {numPagesModified, plural, one {1 page} other {{numPagesModified} pages}}",id:"automations.buttonTrigger.updatedPagesLowercase"}}),H=["sprint","task","project","page"],Y={[W().Tw]:"project",[W().dC]:"task",[W().yH]:"page",[W().TC]:"page",[W().av]:"sprint",[W().pW]:"page",[W().BF]:"page",[W().wZ]:"page"};function G(e){const{typedAutomationExecutionSummary:t,numBlocksDuplicated:o,intl:n}=e,i=function(e){const{typedAutomationExecutionSummary:t,intl:o}=e,n=[];for(const r of H){const e=t[r];if(e){const{numPagesCreated:t,numPagesEdited:o}=e;t>0&&n.push({pageType:r,modificationType:"created",numPagesModified:t}),o>0&&n.push({pageType:r,modificationType:"updated",numPagesModified:o})}}const i=n.slice(0,q).map((({pageType:e,modificationType:t,numPagesModified:n},i)=>{const r=$[e][t],a=0===i?r.start:r.append;return o.formatMessage(a,{numPagesModified:n})}));if(i.length>0)return o.formatList(i,{type:"conjunction",style:"long"})}({typedAutomationExecutionSummary:t,intl:n});return i||(o>0?n.formatMessage(U.createdBlocks,{numBlocksDuplicated:o}):n.formatMessage(U.genericSuccessMessage))}const q=3;const $={sprint:{created:{start:U.createdSprintsUppercase,append:U.createdSprintsLowercase},updated:{start:U.updatedSprintsUppercase,append:U.updatedSprintsLowercase}},task:{created:{start:U.createdTasksUppercase,append:U.createdTasksLowercase},updated:{start:U.updatedTasksUppercase,append:U.updatedTasksLowercase}},project:{created:{start:U.createdProjectsUppercase,append:U.createdProjectsLowercase},updated:{start:U.updatedProjectsUppercase,append:U.updatedProjectsLowercase}},page:{created:{start:U.createdPagesUppercase,append:U.createdPagesLowercase},updated:{start:U.updatedPagesUppercase,append:U.updatedPagesLowercase}}};var Q=()=>o(295633),X=()=>o(732810),Z=()=>o(179034);o(18107),o(967357);var J=()=>o(907258),ee=()=>o(908006),te=()=>o(489295),oe=()=>o(134025),ne=()=>o(763824),ie=()=>o(753812),re=()=>o(384944),ae=()=>o(492414),se=()=>o(246766),le=()=>o(712505),ce=()=>o(244828),de=()=>o(458267);class ue{constructor(e){this.environment=void 0,this.clientContext=void 0,this.automationModel=void 0,this.numBlocksDuplicated=0,this.transactionServerCommitResults=[],this.saveTransactionInfos=[],this.undoCheckpointName=void 0,this.waitForTransactionsCommitted=async()=>{await Promise.all(this.transactionServerCommitResults),this.transactionServerCommitResults=[]},this.getCollectionSchema=async e=>{const t=await this.clientContext.parentRecordStore.loadRecordModel(e.pointer);return t?{value:{collectionSchema:t.getNormalizedSchema()}}:{error:new(v().WY)({actionId:e.actionId,pointer:e.pointer})}},this.logMessage=e=>{T().log(e)},this.incrementMetric=()=>{},this.queryCollection=async e=>{const t=await o(634054).mA(this.environment,{source:"automation",parentRecordStore:this.clientContext.parentRecordStore,collectionPointer:e.collection,filter:e.filter,sort:e.sort,limit:e.limit});return h().Q.isFail(t)?{error:new(v().rl)({actionId:e.actionId,type:t.error.type,message:t.error.message,cause:t.error})}:{value:{blockIds:t.value.blockIds}}},this.saveTransaction=e=>{const{info:t,operations:n}=e,i=[];if(this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.saveTransaction",environment:this.environment,perform:e=>{for(const t of n)if((0,o(439180).ph)(t)){const o=Q().B.createChildStore(this.clientContext.parentRecordStore,t.pointer);ce().applyCrdtTextOperation({store:o,operation:t,invertedOperation:void 0,transaction:e})}else if((0,oe().$Y)(t)||(0,oe().mP)(t)){const n=(0,o(770063).v3)(this.clientContext.parentRecordStore,t.pointer);ce().applyOperation({store:n,operation:t,transaction:e})}else(0,f().HB)(t);i.push(e.id)}}),this.saveTransactionInfos.push(t),"create_page"===t.type)o(37450).vH(this.environment,{type:"page",automation_id:this.automationModel.id,from:"button_automation",new_page_id:t.pageId,creating_block_id:t.pageId});else if("update_pages"===t.type){const{editedProperties:e,pageIds:n,collection:i}=t,r=this.clientContext.parentRecordStore.getRecordModel(i),a=(0,o(390650).L0)(r);for(const t of n)for(const{id:n,type:i}of e)(0,o(810519).u)(this.environment,{block_id:t,property:n,property_type:i,from:"button_automation",automation_id:this.automationModel.id,...a},!1)}else"publish_site"===t.type||(0,f().HB)(t);return Promise.resolve({value:{stats:{totalOperations:n.length,transactionIds:i}}})},this.navigateToPage=e=>{const{route:t}=this.environment.RouterStore.state,n="chat"===t.name,{mainEditorCurrentBlockStore:i}=J().default.state,r=this.clientContext.parentRecordStore.getSpaceStore();if(!r)return;const a=Q().B.createChildStore(r,e.page),l="full_page"===e.openIn?(0,ae().Ay)({store:a,fullyQualified:!1,pageVisitSource:m().y8.ButtonAutomation}):n?(0,o(172385).EY)({currentRoute:t,pageId:e.page.id,pageVisitSource:m().y8.ButtonAutomation,peekModeParam:(0,le().getUrlParamFromPeekMode)(e.openIn),scrollToBlockId:void 0,isMobile:s().A.isMobile}):(0,ae().Ay)({store:i,peekViewBlockId:a.id,peekMode:(0,le().getUrlParamFromPeekMode)(e.openIn),fullyQualified:!1,pageVisitSource:m().y8.ButtonAutomation});(0,se().navigate)({environment:this.environment,url:l})},this.openUrl=e=>{(0,se().navigate)({environment:this.environment,url:e.url,openInNew:"tab"})},this.sendSlackNotification=async e=>{const{action:t,customMessage:o}=e;return(0,r().u)({environment:this.environment,event:{eventName:"button_automation_slack_action",eventProperties:{type:this.clientContext.type}}}),this.executeServerSideEffect({effect:"send_slack_notification",actionPointer:t.pointer,contextType:this.clientContext.type,args:{custom_message:o}})},this.executeWorker=async e=>{var t,o;return(0,r().u)({environment:this.environment,event:{eventName:"button_automation_worker_action",eventProperties:{type:this.clientContext.type}}}),this.executeServerSideEffect({effect:"execute_worker",actionPointer:e.action.pointer,contextType:this.clientContext.type,args:{eventId:e.eventId,workerId:null===(t=e.action.getConfig())||void 0===t?void 0:t.workerId,capabilityKey:null===(o=e.action.getConfig())||void 0===o?void 0:o.capabilityKey,pagePointer:e.pagePointer}})},this.duplicateBlockChildren=async e=>{if("button_block"!==this.clientContext.type)return{error:new(v().g7)({contextType:this.clientContext.type})};const t=this.clientContext.blockStore,n=t.getRecordStoreUIParent();if(!n)return{value:{}};const i={};let r,a=t;if("before"===e.insertionPoint)r=!0;else if("after"===e.insertionPoint)r=!1;else if("topOfPage"===e.insertionPoint){let e;if(r=!0,this.clientContext.pageStore?e=this.clientContext.pageStore:n&&n.isTable(Z().ev)&&(0,te().Y2)(n)&&(e=(0,te().Y2)(n)),!e)return{error:new(v()._r)("invalid_record","Missing page store in client context for top of page insertion")};const o=e.getContentStores().at(0);a=o||t}else if("bottomOfPage"===e.insertionPoint){let e;if(r=!1,this.clientContext.pageStore?e=this.clientContext.pageStore:n&&n.isTable(Z().ev)&&(0,te().Y2)(n)&&(e=(0,te().Y2)(n)),!e)return{error:new(v()._r)("invalid_record","Missing page store in client context for bottom of page insertion")};const o=e.getContentStores().at(-1);a=o||t}else(0,f().HB)(e.insertionPoint);const s=Q().B.createChildStore(n,e.blockPointer);await s.load();const l=s.getContentStores();r||l.reverse();const c=[],d=this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.duplicateBlockChildren",environment:this.environment,perform:e=>{const t=l.map((t=>{const{blockStores:n,onComplete:i}=o(79976).duplicateBlock({environment:this.environment,stores:[t],transaction:e,targetSpaceId:(0,o(161479).e)(t.pointer.spaceId),executionTarget:"local",from:"automation",options:{addCopyName:!1,allowRedundancy:!0,deepCopyTransclusionContainers:!1,resolveTemplateVariables:!0},skipUserFacingMessages:!0}),s=n[0],l=o(836724).T.findSelectableFromStoreAndLocation(a,"listItemBlock");return l&&(r?l.props.onInsertAbove&&c.push(l.props.onInsertAbove({insertStores:[s],transaction:e})[0]):l.props.onInsertBelow&&c.push(l.props.onInsertBelow({insertStores:[s],transaction:e})[0])),{copy:s,onComplete:i}}));return N.aggregateActionStats(i,{transactionIds:[e.id]}),t}}).performResult;return r||c.reverse(),(0,o(747674).t)({environment:this.environment,stores:c}),await ne().lX(d,10,(e=>e.onComplete)),ee().default.afterNextFlush((()=>{for(const e of c){if(o(547392).Il({environment:this.environment,isAtStartOfLine:!1,store:e}))break}})),this.numBlocksDuplicated+=c.length,N.aggregateActionStats(i,{blocksCreated:this.getNumBlocksDuplicated()}),{value:{stats:i}}},this.displayModal=async e=>{de().A.setState({open:!0,format:e.format,recordStore:this.clientContext.parentRecordStore}),await de().A.waitUntil((()=>!de().A.state.open));const t=de().A.state;let o;return t.open||(o=t.result),o=o??"continue",{value:{result:o}}},this.initializeTemplateInDatabase=async e=>{const t=this.clientContext.parentRecordStore,n={},i=Q().B.createChildStore(t,{table:Z().ev,id:e.templateId});await i.load();const r=X().m.createChildStore(t,e.collection),a=(0,o(594794).Z1)({environment:this.environment,table:Z().ev,spaceId:r.pointer.spaceId}),{performResult:s}=this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.initializeTemplateInDatabase",environment:this.environment,perform:s=>{const l=re().Wv({environment:this.environment,transaction:s,inMemoryRecordCache:t.inMemoryRecordCache,type:o(700500).xd.page,id:a});return o(44729).X$({parentStore:r,childStore:l,transaction:s}),o(649813).TB({environment:this.environment,store:l,transaction:s,templateStore:i,title:"template",isCreateIn:!1,isKeyboard:!1,from:"automation_actions"}),o(586481).C({environment:this.environment,store:l,properties:e.propertyUpdates,transaction:s}),N.aggregateActionStats(n,{transactionIds:[s.id]}),l}});return this.saveTransactionInfos.push({type:"create_page",pageId:a,collection:e.collection}),await s.load(),s.isDefined()?{value:{pageId:a,pageModel:s.getModel(),stats:n}}:{error:new(v().WY)({actionId:e.actionId,pointer:s.pointer})}},this.sendInAppNotification=async e=>{const{actionPointer:t,targets:o,message:n,pagePointer:i}=e;return this.executeServerSideEffect({effect:"send_in_app_notification",actionPointer:t,contextType:this.clientContext.type,args:{targets:o,message:n,pagePointer:i}})},this.sendGmailNotification=async e=>{var t;const{action:o,to:n,cc:i,bcc:r,replyTo:a,fromName:s,subject:l,body:c,contextValues:d}=e,u="button_block"===this.clientContext.type||"button_property"===this.clientContext.type?null===(t=this.clientContext.pageStore)||void 0===t?void 0:t.pointer:void 0;return this.executeServerSideEffect({effect:"send_gmail_notification",actionPointer:o.pointer,contextType:this.clientContext.type,args:{bcc:r,body:c,cc:i,fromName:s,pagePointer:u,replyTo:a,subject:l,to:n,contextValues:d}})},this.updateLastRunTimesForObservability=async e=>{const{automationModel:t,executeResult:n,failedActionId:i}=e,r=this.clientContext.parentRecordStore,a=o(302655).d.createChildStore(r,t.pointer);return this.createAndCommitForEffect({userAction:"ClientExecuteEffectMap.updateLastRunTimesForObservability",environment:this.environment,skipUpdatingEditedMetadata:!0,perform:e=>{const o=Date.now();if(re().zv({data:{last_executed_time:o},store:a,transaction:e}),h().Q.isFail(n)){const t=i||"unknown",r=b(n.error,t);re().zv({data:{last_failed_time:o,last_failed_reason:r},store:a,transaction:e})}else t.getLastFailedReason()&&re().zv({data:{last_failed_reason:null},store:a,transaction:e})}}),Promise.resolve({value:void 0})},this.sendHttpRequest=async e=>{const{action:t,pagePointer:o,eventId:n}=e;return this.executeServerSideEffect({effect:"send_http_request",actionPointer:t.pointer,contextType:this.clientContext.type,args:{pagePointer:o,eventId:n}})},this.executeServerSideEffect=async e=>{const t=await ie().callApi({eventName:"executeAutomationActionEffect",environment:this.environment,headers:{},data:e});return"failed"===t.type?{error:new(v().PD)({actionId:e.actionPointer.id,message:"Failure in execution of the executeAutomationActionEffect endpoint",cause:t.error})}:t.data},this.sleepForJitter=async e=>{await(0,ne().wR)(e)},this.environment=e.environment,this.clientContext=e.clientContext,this.automationModel=e.automationModel,this.undoCheckpointName=`execute-client-automation-${o(206267).JW()}`}getNumBlocksDuplicated(){return this.numBlocksDuplicated}createAndCommitForEffect(e){const t=ce().createAndCommit({...e,undoCheckpoint:this.undoCheckpointName,canUndo:!0});return this.transactionServerCommitResults.push(t.serverCommitResult),t}}async function pe(e){var t,o;const{clientContext:n,environment:s,onUndo:y}=e,v=await D().T.formulas.load(),x=await D().T.simpleFormulas.load();await n.automationStore.load();const S=n.automationStore.getModel();if(!S||!S.isButtonType()&&!S.isRecurrenceType())return;const b=S.spaceId,C=n.automationStore.getActionStores().map((e=>e.getModel())).filter(f().O9),K=S.getTriggerType(),W="button_block"===n.type?n.blockStore.id:"button_property"===n.type?null===(t=n.pageStore)||void 0===t?void 0:t.id:"recurrence"===n.type?void 0:(0,f().HB)(n),z=(0,p().AI)();(0,r().u)({environment:s,event:{eventName:"automation_triggered",eventProperties:{actions:C.map((e=>e.getType())),automation_id:S.id,block_id:W,context_type:n.type,space_id:b,subscription_tier:z,trigger:K}}});const U=new ue({automationModel:S,clientContext:n,environment:s}),H=(0,M().MC)({collectionFeatureGates:(0,E().i)(),experimentService:a().default,getRecordModel:n.parentRecordStore.getRecordModel,loadRecordModel:n.parentRecordStore.loadRecordModel,spaceIdCreator:s.idCreator.getSpaceIdCreatorSync(b)}),q=a().default.getConfigKey("automation_settings","client_formula_timeout_ms"),$=s.currentUser.id?{id:s.currentUser.id,table:_().oo}:void 0,J="recurrence"!==n.type?null===(o=n.pageStore)||void 0===o?void 0:o.getModel():void 0;let ee;!J||J.isType("personal_home_page")||J.isType("home_shortcuts")||(J.isType("page")||J.isType("collection_view_page"))&&(ee=J);const te=[];if("recurrence"===n.type&&"completeSprint"===n.recurrence.type){const{values:e}=function(e){const{nextSprintDateRange:t,completeSprintActionType:o}=e;return{values:[{kind:k().FormulaContextValueKind.ContextValue,id:I().GF,value:{type:"date",value:t}},{kind:k().FormulaContextValueKind.ContextValue,id:I().uM,value:{type:"text",value:(0,j().x9d)(o)}}]}}({completeSprintActionType:n.recurrence.completeSprintActionType,nextSprintDateRange:n.recurrence.nextSprintDateRange});te.push(...e)}const oe=N.create(S.pointer,"client"),ne={author:$,automationModel:S,actionModels:C,contextType:n.type,formulaVariableResolution:{executingUserPointer:$,executingUserTimeZone:(0,w().P)(),thisPageBlockModel:ee},values:te,executeEffectMap:U,executeContextualFormula:async(e,t)=>{if(!t)return{value:{type:"undefined"}};const o=Date.now()+q;return await v.executeFormulaAsync(t,{...e,depth:0,throwOnDownstreamParseFailures:!0,handleDataRequest:H,intl:n.intl,resultCache:new Map,regExpCache:new Map,userTimeZone:(0,w().P)(),visitedProperties:new Set,formulaTimeoutTimestampMs:o,experimentService:a().default,spaceId:b})},formulasModule:v,handleDataRequest:H,loadRecordModel:n.parentRecordStore.loadRecordModel,makeGetRecordModelFn:async e=>Promise.resolve(n.parentRecordStore.getRecordModel),userTimeZone:(0,w().P)(),intl:n.intl,depth:0,throwOnDownstreamParseFailures:!0,visitedProperties:new Set,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,eventTracker:(0,V().Q)(s),runtimeRecordPointerSet:new(P().d),runtimeStats:oe,spaceIdCreator:await s.idCreator.getSpaceIdCreator(b),simpleFormulasModule:x,useCrdtDefault:!0,experimentService:a().default,collectionFeatureGates:(0,E().i)(),spaceId:b,eventId:(0,B().Ay)(),getRelationEdgeList:(0,F().Y)({environment:s,spaceId:b})},ie=await A({context:ne});N.logNotionPerformance({automationStats:oe,environment:s});const re={automationContextType:n.type,automationId:S.id,automationRuntime:oe,spaceId:b,userId:null==$?void 0:$.id};if(h().Q.isFail(ie)){const{error:e}=ie;0,T().log({actor:$,data:re,error:e,from:"automationActions",level:"error",type:"AutomationExecutionError"}),(0,r().u)({environment:s,event:{eventName:"automation_execution_fail",eventProperties:{automation_id:S.id,block_id:W,context_type:n.type,error_type:e.type,execution_duration_ms:oe.executionDurationMs,subscription_tier:z,trigger:K}}});const t=function(e){if("query_collection_too_many_items"===e.type)return i().messages.errorQueryCollectionTooManyPages;if("record_pointer_in_trash"===e.type)return i().messages.errorRecordInTrash;return i().messages.genericErrorMessage}(e),o=c().A.formatMessage(t);d().D6({label:o})}else(0,r().u)({environment:s,event:{eventName:"automation_execution_success",eventProperties:{automation_id:S.id,block_id:W,context_type:n.type,execution_duration_ms:oe.executionDurationMs,subscription_tier:z,trigger:K}}}),T().log({actor:$,data:re,from:"automationActions",level:"info",type:"AutomationExecutionSuccess"}),me(C,ie)&&await async function(e){const{actionModels:t,environment:o,saveTransactionInfos:n,clientContext:i,undoCheckpointName:r,numBlocksDuplicated:a,onUndo:s}=e,c=function(e){const{saveTransactionInfos:t,parentRecordStore:o}=e,n={},i=new Set;for(const u of t)if("create_page"===u.type){if(i.has(u.pageId))continue;if(u.collection){var r,a;const e=X().m.createChildStore(o,u.collection).getDatabaseType(),t=(e&&Y[e])??"page",i=(null===(r=n[t])||void 0===r?void 0:r.numPagesEdited)??0,s=(null===(a=n[t])||void 0===a?void 0:a.numPagesCreated)??0;n[t]={numPagesCreated:s+1,numPagesEdited:i}}else{var s,l;const e="page",t=(null===(s=n[e])||void 0===s?void 0:s.numPagesCreated)??0,o=(null===(l=n[e])||void 0===l?void 0:l.numPagesEdited)??0;n[e]={numPagesCreated:t+1,numPagesEdited:o}}i.add(u.pageId)}else if("update_pages"===u.type){var c,d;const e=X().m.createChildStore(o,u.collection).getDatabaseType(),t=(e&&Y[e])??"page",i=(null===(c=n[t])||void 0===c?void 0:c.numPagesEdited)??0,r=(null===(d=n[t])||void 0===d?void 0:d.numPagesCreated)??0;n[t]={numPagesCreated:r,numPagesEdited:i+u.pageIds.length}}else"publish_site"===u.type?n.page={numPagesCreated:0,numPagesEdited:1}:(0,f().HB)(u);return n}({saveTransactionInfos:n,parentRecordStore:i.parentRecordStore}),p=G({typedAutomationExecutionSummary:c,numBlocksDuplicated:a,intl:i.intl}),y=await async function(e){const{saveTransactionInfos:t,clientContext:o}=e;let n;for(const a of t.slice().reverse()){if("create_page"===a.type){var i;n=Q().B.createChildStore(o.parentRecordStore,{table:Z().ev,id:a.pageId,spaceId:null===(i=a.collection)||void 0===i?void 0:i.spaceId});break}if("update_pages"===a.type){if(1===a.pageIds.length){var r;n=Q().B.createChildStore(o.parentRecordStore,{table:Z().ev,id:a.pageIds[0],spaceId:null===(r=a.collection)||void 0===r?void 0:r.spaceId})}else{const e=X().m.createChildStore(o.parentRecordStore,a.collection);await e.load();const t=e.getParentBlockStore();if(!t)continue;n=t}break}if("publish_site"===a.type)break;(0,f().HB)(a)}return n}({saveTransactionInfos:n,clientContext:i}),h=function(e){let t;for(const o of e){const e=(0,g().getActionRegistryItem)(o.type);if(!1===e.invertible)return!1;!0===e.invertible&&(t=!0)}return t}(t),v=!0===h&&R().xy(r)?()=>{R().JM({environment:o,namedRevisionId:r}),d().N2(),s&&s(r)}:void 0,x=y?e=>{(0,O().u)({environment:o,openInNew:(0,l().V)(e),store:y,visitType:L().ig.Link,pageVisitSource:m().y8.ButtonAutomation})}:void 0;(0,u().A)({onOpenClick:x,item:{label:p},performUndo:v})}({actionModels:C,clientContext:n,environment:s,numBlocksDuplicated:U.getNumBlocksDuplicated(),onUndo:y,saveTransactionInfos:U.saveTransactionInfos,undoCheckpointName:U.undoCheckpointName})}function me(e,t){return!t.value.stopExecution&&!e.every((e=>!(0,g().getActionRegistryItem)(e.type).hasSideEffects))}var ge=()=>o(653417),ye=o(296540),he=()=>o(993905),fe=()=>o(402014),ve=()=>o(484714),xe=()=>o(590526),Se=()=>o(401497),be=()=>o(611648),Ae=()=>o(107975),Ce=()=>o(755125),ke=()=>o(127833),je=()=>o(160432),Ie=()=>o(187174),Me=()=>o(100622),Te=()=>o(284371),we=()=>o(376254),Pe=()=>o(997583),_e=()=>o(440024),Be=()=>o(528093),Re=()=>o(546461),Ve=()=>o(911724),Ee=()=>o(276936),Fe=()=>o(559419),De=()=>o(656134),Le=()=>o(840094),Oe=()=>o(633904),Ke=()=>o(284489),Ne=()=>o(774256),We=()=>o(383036),ze=()=>o(807449),Ue=()=>o(695115),He=()=>o(26697),Ye=()=>o(619207),Ge=()=>o(383594),qe=()=>o(187820),$e=()=>o(486666),Qe=o(474848);const Xe=(0,z().YK)({icon:{defaultMessage:"Icon",id:"buttonBlock.button.iconHeading"},addIconButtonAriaLabel:{defaultMessage:"Add icon",id:"buttonBlock.button.addIconButtonAriaLabel"}});function Ze(e){const{disabled:t,currentIcon:o,handleIconChange:n,store:i}=e,r=(0,ve().v3)(),a=(0,z().tz)(),s=(0,ye.useCallback)((e=>{Ge().W(r,{originRect:e.currentTarget.getBoundingClientRect(),originGap:4,popupWidth:$e().jv,popupHeight:$e().GF,isSmallWidth:!1,title:a.formatMessage(Xe.icon),currentTab:"icon",tabs:[{type:"icon",onChange:e=>{n(e),Ge().I()}},{type:"emoji",onChange:(e,t)=>{n(e),Ge().I()}}],onDelete:o?()=>{n(void 0),Ge().I()}:void 0})}),[r,n,a,o]),l=(0,Se().IS)((()=>({iconButton:{background:"transparent",boxShadow:Me().Tj.shadowXS,width:28,height:28},icon:{width:16,height:16}})),[]),c=e=>(0,Qe.jsx)(Ue().A,{ariaLabel:a.formatMessage(Xe.addIconButtonAriaLabel),style:l.iconButton,iconStyle:l.icon,hasBackground:!0,disabled:t,showShadow:!0,icon:e=>o?(0,Qe.jsx)(qe().B6,{disabled:!0,isEmptyPage:!1,size:24,icon:{icon:o,pointer:i.pointer},style:e}):(0,Qe.jsx)(ze().I,{icon:Ye().emojiFaceFillIcon,fitToViewBox:"all",style:e}),...(0,We().A)(e??{},{onClick:s})});return o?c():(0,Qe.jsx)(He().m,{renderTooltip:()=>(0,Qe.jsx)(z().sA,{defaultMessage:"Add an icon",id:"buttonBlock.button.addIcon"}),delayThreshold:300,render:c})}var Je=()=>o(348670),et=()=>o(826352),tt=()=>o(160988),ot=(o(803949),()=>o(79926)),nt=()=>o(250910),it=()=>o(118307),rt=()=>o(81068),at=()=>o(617668),st=()=>o(863330),lt=()=>o(340498),ct=()=>o(813297),dt=()=>o(271205),ut=()=>o(170253),pt=()=>o(117862),mt=()=>o(366360),gt=()=>o(76190),yt=()=>o(283088),ht=()=>o(383574),ft=()=>o(439612),vt=()=>o(634292),xt=()=>o(122414);function St(e){return!e.pathIsDead()&&e.isDefined()}function bt(e){if(!(0,f().O9)(e))return[];return e.getTemplatePageStores().filter((e=>St(e)))}var At=()=>o(475679),Ct=()=>o(310109),kt=()=>o(784892),jt=()=>o(16006),It=()=>o(744951),Mt=()=>o(133518),Tt=()=>o(548526),wt=()=>o(194373);function Pt(e){const{actionStore:t,currentValue:o,onChange:n,disabled:i,errorMessage:a,errorIcon:s,skipVariables:l}=e,c=(0,ve().v3)(),d=(0,Re().K4)(),u=null==d?void 0:d.typecheckResult,p=(0,xe().uB)(void 0,it().A),[m,g]=(0,xe().K8)((()=>[t.id,t.getSpaceId()]),[t]),y="button_block"!==(0,Re().q8)().contextType,h=(0,Mt().F)({actionId:m}),v=(0,xe().K8)((()=>o&&"collection"===o.type?X().m.createChildStore(t,o.collection):void 0),[o,t]),x=(0,xe().K8)((()=>{if(m&&u&&o&&"variable"===o.type)return(0,Ct().getContextValueForActionById)(u,m,o.id)}),[o,u,m]),S=(0,xe().K8)((()=>"private_space"===(null==o?void 0:o.type)),[o]),b=(0,ye.useCallback)((e=>{"collection"!==e.type&&"variable"!==e.type&&"private_space"!==e.type||(n(e),p.reset(),(0,xt().CM)(((o,n,i)=>{const a=(0,xt().zc)({automationActionStore:t,formulaAnalyticsModule:n,formulasModule:o,simpleFormulasModule:i});(0,f().O9)(a)&&(0,r().u)({environment:c,event:{eventName:"automation_target_pick",eventProperties:{automation_action:a,automation_id:t.getParentId(),target_type:e.type}}})})))}),[n,p,t,c]),A=(0,ye.useCallback)((()=>p.reset()),[p]),C=(0,De().j)(),k=Boolean(v||x||S);return(0,Qe.jsx)(nt().A,{buttonPopupStore:p,popupType:C,alignmentToOrigin:"center",placementToOrigin:"bottom",originGap:0,disabled:i,renderOrigin:e=>(0,Qe.jsx)(Tt().x,{...e,disabled:i,isCompact:!0,isError:Boolean(a),hasActionRequired:!k,errorIcon:s,dropdownButtonType:"dropdown",children:v?(0,Qe.jsx)(jt().A,{store:v}):x?(0,Qe.jsx)(It().F,{format:kt().NY.Medium,isSingle:!0,value:x,style:{background:"transparent",color:"unset",margin:"-1.5px 0",padding:0}}):S?(0,Qe.jsx)(z().sA,{id:"automations.AutomationCollectionPicker.privateSpace.title",defaultMessage:"Private"}):(0,Qe.jsx)(z().sA,{id:"automations.dataSourcePicker.buttonPlaceholder",defaultMessage:"Select data source"})}),render:e=>(0,Qe.jsx)(wt()._,{formulaTypecheckContextValues:h,onChange:b,onClose:A,parentRecordStore:t,selectedTarget:o,skipPages:!0,skipVariables:l,skipPrivateSpace:y,spaceId:g})})}var _t=()=>o(890492),Bt=()=>o(663639),Rt=()=>o(736847),Vt=()=>o(806080),Et=()=>o(160632),Ft=()=>o(781697);function Dt(e){const{collectionStore:t,currentTemplateId:o,onChange:n,disabled:i,errorMessage:r}=e,a=(0,ve().Y0)(),s=(0,xe().K8)((()=>{if(!t)return;if(o){return Q().B.createChildStore(t,{id:o,spaceId:t.getSpaceId(),table:Z().ev})}const e=t.getDefaultTemplatePageStore();return e&&!e.pathIsDead()?e:void 0}),[t,o]),l=(0,De().j)(),c=(0,xe().K8)((()=>bt(t)),[t]),d=Boolean(o);return(0,Qe.jsx)(nt().A,{popupType:l,alignmentToOrigin:"center",placementToOrigin:"bottom",originGap:0,disabled:i,renderOrigin:e=>(0,Qe.jsx)(Tt().x,{...e,disabled:i,isCompact:!0,isError:Boolean(r),style:{minWidth:50},dropdownButtonType:"dropdown",children:s&&(d||St(s))?(0,Qe.jsx)(jt().A,{store:s}):(0,Qe.jsx)(z().sA,{id:"automations.templatePicker.buttonPlaceholder",defaultMessage:"Empty"})}),render:e=>{const o=(0,Ft().v)({device:a,width:280});return(0,Qe.jsx)(_t().A,{...o,children:t?(0,Qe.jsx)(Lt,{collectionStore:t,templatePageStores:c,parent:e,onChange:n}):void 0})}})}function Lt(e){const{collectionStore:t,templatePageStores:o,parent:n,onChange:i}=e,r=(0,xe().K8)((()=>t.getDefaultTemplatePageStore()),[t]),a=o.map((e=>{const o={key:e.id,render:o=>(0,ye.createElement)(Et().K,{...o,key:e.id,isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:e,isMobile:s().A.isMobile,locked:!0,isDefault:r===e,onCancelClick:Vt().lQ,draggable:!1,hideActionMenu:!0}),action:t=>{i(e.id),n.close()}};return o})),l={key:"empty",render:e=>(0,ye.createElement)(Et().K,{...e,key:"empty",isOverlay:!0,collectionStore:t,canConfigureCollection:!1,templateStore:void 0,isMobile:s().A.isMobile,locked:!0,onCancelClick:Vt().lQ,draggable:!1,hideActionMenu:!0}),action:e=>{i(void 0),n.close()}};return(0,Qe.jsx)(Bt().A,{type:Bt().O.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,Qe.jsx)(Rt().A,{...e,title:(0,Qe.jsx)(z().sA,{id:"automations.templatePicker.menuHeader",defaultMessage:"Select template"})}),items:y().oE([...a,r?void 0:l])}]})}var Ot=()=>o(923832),Kt=()=>o(699143),Nt=()=>o(166006),Wt=()=>o(858163);const zt=(0,z().YK)({titleLabel:{defaultMessage:"Title",id:"automations.privateSpace.titleLabel"}});function Ut(e){const{actionStore:t,disabled:o,onChange:n,spaceId:i,value:r}=e,a=(0,ve().v3)(),s=(0,Se().IS)((()=>({inputLabel:{color:Me().Tj.text.tertiary,fontSize:12,lineHeight:1.3,fontWeight:Te().Wy.medium,display:"flex",alignItems:"center"}})),[]),l=(0,Mt().F)({actionId:t.id}),{onTextStoreSelect:c,onTextStoreUnselect:d}=(0,Wt().W)(t),u=(0,ye.useCallback)((()=>{(0,Ce().clear)({environment:a})}),[a]);return(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:6,children:[(0,Qe.jsx)("label",{style:{...s.inputLabel},children:(0,Qe.jsx)(z().sA,{...zt.titleLabel})}),(0,f().O9)(r)?(0,Qe.jsx)(Nt().Y,{disabled:o,formulaTypecheckContextValues:l,onChange:n,onTextStoreSelect:c,onTextStoreUnselect:d,onTextEsc:u,parentRecordStore:t,spaceId:i,style:{width:"100%"},value:r}):void 0]})}function Ht(e){const{actionStore:t,disabled:o,errorMessage:n,onChange:i,value:r,errorIcon:a}=e,s=(0,xe().K8)((()=>{if("private_space"===(null==r?void 0:r.type))return"page";let e;if("collection"===(null==r?void 0:r.type)){const o=t.getRecordModel(r.collection);e=null==o?void 0:o.getDatabaseType()}return(0,vt().$O)(e)}),[t,r]);return(0,Qe.jsx)(z().sA,{defaultMessage:"Add {itemType} to{collectionPicker}",id:"automations.CreatePageActionV2.header.title",values:{collectionPicker:(0,Qe.jsx)(Pt,{actionStore:t,currentValue:r,disabled:o,errorMessage:n,errorIcon:a,onChange:i,skipVariables:!0}),itemType:s}})}function Yt(e){const{collectionStore:t,disabled:o,errorMessage:n,onChange:i,value:r}=e;return(0,Qe.jsx)(z().sA,{defaultMessage:"as{collectionTemplatePicker}",id:"automations.CreatePageActionV2.header.template",values:{collectionTemplatePicker:(0,Qe.jsx)(Dt,{collectionStore:t,currentTemplateId:r,disabled:o,errorMessage:n,onChange:i})}})}var Gt=()=>o(199378),qt=()=>o(183558),$t=()=>o(770586);function Qt(e,t){const o=e.getConfigStore().getKeyStore("values"),n=o.getValue(),i=null==n?void 0:n[t];return(0,f().O9)(i)?{valueConfig:i,valueStore:o}:{valueConfig:void 0,valueStore:void 0}}var Xt=()=>o(631524);function Zt(e){const{disabled:t,onClick:o}=e,n=(0,Se().IS)((()=>({button:{color:Me().Tj.text.secondary},children:{...Te().RC,flex:"1 1 auto"}})),[]);return(0,Qe.jsx)(Xt().p,{disabled:t,disabledFeedback:t,onClick:o,shouldShrink:!0,style:n.button,children:(0,Qe.jsx)("div",{style:n.children,children:(0,Qe.jsx)(z().sA,{defaultMessage:"Define another variable",id:"automations.DefineVariablesAction.addVariableButton.label"})})})}var Jt=()=>o(791089),eo=()=>o(805452),to=()=>o(938818),oo=()=>o(324254),no=()=>o(852507),io=()=>o(708685),ro=()=>o(145076),ao=()=>o(764781),so=()=>o(105819),lo=()=>o(585639),co=()=>o(236262),uo=()=>o(736767),po=()=>o(419357),mo=()=>o(765974);function go(){return(0,Qe.jsx)(ze().I,{icon:mo().exclamationMarkTriangleFillIcon,colorPalette:"red",colorVariant:"accentPrimary"})}function yo(){}function ho(e){const{analyzedFormulaOutput:t,onClearClick:o,onDeleteClick:n,onDuplicateClick:i,onEditFormulaClick:r,onEditTextClick:a,onVariableNameChange:s,onVariableNameSubmit:l,variableName:c}=e,{parseErrors:d,type:u,typeErrors:p,typeWarnings:m}=t??{},g=(0,z().tz)(),y=(0,ye.useMemo)((()=>(0,to().L)({intl:g,parseErrors:d??[],typeErrors:p??[],typeWarnings:m??[]})),[g,d,p,m]),h=(0,f().O9)(y),v=(0,Ft().e)({width:265}),x=(0,Se().IS)((()=>({formulaErrorCaptionMenuItem:{marginBlockStart:0,paddingBlockStart:0,paddingInline:4},formulaReturnTypeDesktopIcon:{marginBlockStart:4,marginInlineStart:12},formulaReturnTypeCaptionMenuItem:{marginBlock:0,paddingInline:4},formulaErrorCaption:{...h&&{color:Me().Tj.red.text.accentPrimary}},nameInputMenuItem:{marginBlock:6}})),[h]),S=(0,ye.useMemo)((()=>u?(0,io().getHumanReadableType)(u):ro().qY.unknown),[u]),b=(0,ve().v3)();(0,no().l)((()=>{(0,Ce().clear)({environment:b})}));const A=[];if((0,f().O9)(c)){const e=(0,f().O9)(s);A.push({items:[{action:()=>null,key:"variable-name-input-item",render:t=>(0,Qe.jsx)(po().Ay,{...t,disabled:!e,focus:!0,onChange:s??yo,onSubmit:l,placeholder:g.formatMessage(Gt().xC),style:x.nameInputMenuItem,value:c})}],key:"variable-name-input-section",render:e=>(0,Qe.jsx)(Rt().A,{...e,enableActionSheetTitle:!0})})}if((0,f().O9)(a)||(0,f().O9)(r)||(0,f().O9)(i)){const e=[];(0,f().O9)(a)&&e.push({action:a,key:"variable-name-manage-edit-text",render:e=>(0,Qe.jsx)(rt().A,{...e,icon:(0,Qe.jsx)(ze().I,{icon:so().pencilLineIcon}),title:(0,Qe.jsx)(z().sA,{defaultMessage:"Edit as text",id:"EditVariableMenu.editSimpleFormulaButtonMenuItem.label"})})}),(0,f().O9)(r)&&e.push({action:r,key:"variable-name-manage-edit-formula",render:e=>(0,Qe.jsx)(rt().A,{...e,icon:(0,Qe.jsx)(ze().I,{icon:lo().v}),title:(0,Qe.jsx)(z().sA,{defaultMessage:"Edit as formula",id:"EditVariableMenu.editFormulaButtonMenuItem.label"})})}),(0,f().O9)(i)&&e.push({action:i,key:"variable-name-manage-duplicate",render:e=>(0,Qe.jsx)(rt().A,{...e,icon:(0,Qe.jsx)(ze().I,{icon:ao().V}),title:(0,Qe.jsx)(z().sA,{defaultMessage:"Duplicate",id:"EditVariableMenu.duplicateFormulaButtonMenuItem.label"})})});const t=A.length>0;A.push({items:e,key:"variable-name-manage-actions",render:e=>(0,Qe.jsx)(Rt().A,{...e,enableActionSheetTitle:!0,topBorder:t})})}if((0,f().O9)(n)||(0,f().O9)(o)){const e=[];(0,f().O9)(n)&&e.push({action:n,key:"variable-name-destructive-delete",render:e=>(0,Qe.jsx)(rt().A,{...e,icon:(0,Qe.jsx)(ze().I,{icon:co().trashIcon}),title:(0,Qe.jsx)(z().sA,{defaultMessage:"Delete",id:"EditVariableMenu.deleteFormulaButtonMenuItem.label"})})}),(0,f().O9)(o)&&e.push({action:o,key:"variable-name-destructive-clear",render:e=>(0,Qe.jsx)(rt().A,{...e,icon:(0,Qe.jsx)(ze().I,{icon:co().trashIcon}),title:(0,Qe.jsx)(z().sA,{defaultMessage:"Clear variable",id:"EditVariableMenu.clearFormulaButtonMenuItem.label"})})});const t=A.length>0;A.push({items:e,key:"variable-name-destructive-actions",render:e=>(0,Qe.jsx)(Rt().A,{...e,enableActionSheetTitle:!0,topBorder:t})})}const C=A.length>0,k=[{action:()=>{},key:"variable-name-typecheck-return-type",render:e=>(0,Qe.jsx)(uo().A,{...e,caption:(0,Qe.jsx)("span",{style:x.formulaErrorCaption,children:(0,Qe.jsx)(z().sA,{defaultMessage:"Type: {formulaType}",id:"EditVariableMenu.formulaReturnType.label",values:{formulaType:(0,Qe.jsx)(z().sA,{...S})}})}),desktopIconStyle:x.formulaReturnTypeDesktopIcon,dontShrinkIcon:!0,icon:h?(0,Qe.jsx)(go,{}):null,shouldWrapCaption:!0,style:x.formulaReturnTypeCaptionMenuItem})}];return h&&k.push({action:()=>{},key:"variable-name-typecheck-error",render:e=>(0,Qe.jsx)(uo().A,{...e,caption:(0,Qe.jsx)(z().sA,{...null==y?void 0:y.messageDescriptor}),shouldWrapCaption:!0,style:x.formulaErrorCaptionMenuItem})}),A.push({items:k,key:"variable-name-typecheck",render:e=>(0,Qe.jsx)(Rt().A,{...e,enableActionSheetTitle:!0,topBorder:C})}),0===A.length?null:(0,Qe.jsx)(_t().A,{...v,children:(0,Qe.jsx)(Bt().A,{initialFocus:0,sections:A,type:Bt().O.Vertical})})}var fo=()=>o(239381);const vo={type:"unknown"};function xo(e){const{type:t}=e,o=(0,Se().IS)((()=>({icon:{fill:Me().Tj.icon.secondary,width:16,height:16}})),[]);return(0,fo().Ix)(t??vo)(o.icon)}function So(e){const{analyzedFormulaOutput:t,buttonPopupStore:o,children:n,disabled:i,errorMessage:r,onClearClick:a,onDeleteClick:s,onDuplicateClick:l,onEditFormulaClick:c,onEditTextClick:d,onVariableNameChange:u,variableName:p}=e,{parseErrors:m,typeErrors:g}=t,y=Boolean(r),h=Boolean(m&&m.length>0),f=Boolean(g&&g.length>0),v=y||h||f,x=(0,Se().IS)((()=>({button:{color:Me().Tj.text.secondary,padding:"0 6px",gap:2},chevronIcon:{flex:"0 0 auto"},children:{...Te().RC,color:v?Me().Tj.red.text.accentPrimary:Me().Tj.text.secondary,flex:"1 1 auto",...v&&{fontWeight:Te().Wy.medium}},iconWrap:{marginInlineEnd:2}})),[v]),S=(0,De().j)(),b=(0,xe().uB)(o,it().A),A=(0,ye.useCallback)((()=>r??null),[r]),C=(0,ye.useCallback)((()=>{b.reset()}),[b]);return(0,Qe.jsx)(nt().A,{alignmentToOrigin:"start",buttonPopupStore:b,disabled:i,originGap:0,placementToOrigin:"bottom",popupType:S,renderOrigin:e=>(0,Qe.jsx)(He().m,{delayThreshold:0,disableTooltip:!y,placement:"bottom",render:o=>(0,Qe.jsxs)(Xt().p,{...e,...o,disabled:i,disabledFeedback:i,shouldShrink:!0,style:x.button,children:[(0,Qe.jsx)("div",{style:x.iconWrap,children:v?(0,Qe.jsx)(go,{}):(0,Qe.jsx)(xo,{type:t.type})}),(0,Qe.jsx)("div",{style:x.children,children:n}),(0,Qe.jsx)("div",{style:x.chevronIcon,children:(0,Qe.jsx)(ze().I,{icon:oo().arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"secondary"})})]}),renderTooltip:A}),render:e=>(0,Qe.jsx)(ho,{analyzedFormulaOutput:t,onClearClick:a,onDeleteClick:s,onDuplicateClick:l,onEditFormulaClick:c,onEditTextClick:d,onVariableNameChange:u,onVariableNameSubmit:C,variableName:p})})}function bo(e){var t,o,n;const{actionStore:r,variableId:a}=e,s=(0,ve().v3)(),{automationStore:l,contextType:c}=(0,Re().q8)(),d=(0,Re().fi)(),{disabled:u,maybePersistedTransactionActions:p,suppressActionErrors:m}=(0,mt().b)(),g=(0,z().tz)(),{value:y}=(0,ot().fJ)(D().T.formulas),{value:h}=(0,ot().fJ)(ct().QV.automationTypecheck),v=(0,xe().uB)(void 0,it().A),x=ye.useRef(null),S=(0,xe().uB)(void 0,it().A),b=(0,gt().n)(l),A=(0,yt().j)(),C=(0,xe().K8)((()=>l.getActionStores()),[l]),[k,j]=(0,xe().K8)((()=>[r.id,r.getSpaceId()]),[r]),I=(0,Mt().F)({actionId:k}),M=(0,Mt().i)(),{onTextStoreSelect:T,onTextStoreUnselect:w}=(0,Wt().W)(r),P=(0,xe().K8)((()=>r.getConfig()),[r]),_=null==P||null===(t=P.values)||void 0===t?void 0:t[a],B="formula"===(null==_||null===(o=_.value)||void 0===o?void 0:o.type),R=(0,xe().K8)((()=>{if(y&&j)return(0,Jt().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:y.createFormulaDataRequestSyncHandler(r.getRecordModel),spaceId:j,valueTypes:I.slice(0),guaranteedPropertyIds:M,featureGates:(0,E().i)(),enableExistenceGuarantees:d},value:null==_?void 0:_.value})}),[j,r.getRecordModel,d,I,M,y,null==_?void 0:_.value]),V=(0,ye.useMemo)((()=>!m.includes(r.id)),[m,r]),{errorMessage:F}=(0,ge().useErrorComponentForAction)({actionId:r.id,errorKey:a,shouldShow:V}),L=(0,ye.useCallback)((e=>{const t=e.target.value;p.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,transaction:o,variableId:n,variableName:i}=e,{valueConfig:r,valueStore:a}=Qt(t,n);(0,f().O9)(r)&&(0,f().O9)(a)&&re().zv({data:{[n]:{...r,name:i}},store:a,transaction:o})}({automationActionStore:r,transaction:e,variableId:a,variableName:t})},userAction:"DefineVariablesAction.editVariableName"}),(0,xt().UB)(s,{automationStore:l,automationActionStore:r})}),[r,l,s,p,a]),O=(0,ye.useCallback)((()=>{p.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,automationActionStores:o,transaction:n,variableId:i}=e,{valueConfig:r,valueStore:a}=Qt(t,i);if(!(0,f().O9)(r)||!(0,f().O9)(a))return;const s=(0,qt().Ay)(),l=(0,$t().v)(o,r.name);re().zv({data:{[s]:{...r,name:l}},store:a,transaction:n}),ce().applyOperation({operation:{args:{id:s},command:"listAfter",path:["config","variableIds"],pointer:t.pointer},store:t,transaction:n})}({automationActionStore:r,automationActionStores:C,transaction:e,variableId:a})},userAction:"DefineVariables.duplicateVariable"}),v.reset(),(0,xt().UB)(s,{automationStore:l,automationActionStore:r})}),[r,C,l,v,s,p,a]),K=(0,ye.useCallback)((e=>{y&&h&&(p.createAndCommit({perform:t=>{!function(e){const{automationActionStore:t,transaction:o,variableId:n,variableValue:i}=e,{valueConfig:r,valueStore:a}=Qt(t,n);(0,f().O9)(r)&&(0,f().O9)(a)&&re().zv({data:{[n]:{...r,value:i}},store:a,transaction:o})}({automationActionStore:r,transaction:t,variableValue:e,variableId:a}),(0,i().clearInvalidVariables)({environment:s,automationStore:l,automationTypecheckModule:h,contextType:c,formulasModule:y,intl:g,isSubscribed:b,transaction:t,pageStore:A})},userAction:"DefineVariables.editVariableValue"}),(0,xt().UB)(s,{automationStore:l,automationActionStore:r}))}),[r,l,h,c,s,y,g,b,p,a,A]),N=(0,ye.useMemo)((()=>{if(null==P||!P.variableIds||1===P.variableIds.length)return function(){v.setState({open:!1}),K({type:"simple",value:void 0})}}),[null==P?void 0:P.variableIds,v,K]),W=(0,ye.useMemo)((()=>{if(!(0,f().O9)(N))return function(){p.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,transaction:o,variableId:n}=e,{valueStore:i}=Qt(t,n);(0,f().O9)(i)&&(re().zv({data:{[n]:null},store:i,transaction:o}),ce().applyOperation({operation:{args:{id:n},command:"listRemove",path:["config","variableIds"],pointer:t.pointer},store:t,transaction:o}))}({automationActionStore:r,transaction:e,variableId:a})},userAction:"DefineVariables.deleteVariable"}),v.reset(),(0,xt().UB)(s,{automationStore:l,automationActionStore:r})}}),[r,l,v,s,p,N,a]),U=(0,ye.useCallback)((async()=>{var e,t;if(B){if(!(await(0,eo().Cp)()))return}null===(e=x.current)||void 0===e||e.focus(),v.setState({open:!1});const o=(0,eo().D2)(null==_||null===(t=_.value)||void 0===t?void 0:t.value);K(o)}),[v,B,K,null==_||null===(n=_.value)||void 0===n?void 0:n.value]),H=(0,ye.useCallback)((()=>{var e;null===(e=x.current)||void 0===e||e.blur(),v.setState({open:!1}),S.setState({open:!0})}),[v,S]),Y=(0,Se().IS)((()=>({textInput:{width:"100%"}})),[]),G=(0,ye.useCallback)((()=>{(0,Ce().clear)({environment:s})}),[s]);if(!j||!_||!R)return null;const q=_.name||g.formatMessage(Gt().xC),{parseErrors:$=[],typeErrors:Q=[]}=R,X=$.length>0||Q.length>0;return(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:7,children:[(0,Qe.jsx)(Kt().Y1,{direction:"horizontal",width:"hug",children:(0,Qe.jsx)(So,{analyzedFormulaOutput:R,buttonPopupStore:v,errorMessage:F,onClearClick:N,onDeleteClick:W,onDuplicateClick:O,onEditFormulaClick:H,onEditTextClick:U,onVariableNameChange:L,variableName:_.name,children:(0,Qe.jsx)("span",{style:Te().RC,children:q})})}),(0,Qe.jsx)(Nt().Y,{disabled:u,formulaInputButtonPopupStore:S,formulaTypecheckContextValues:I,onChange:K,onTextStoreSelect:T,onTextStoreUnselect:w,onTextEsc:G,parentRecordStore:r,ref:x,spaceId:j,style:Y.textInput,value:_.value,shouldShowErrorStyles:X}),(0,Qe.jsx)(to().J,{analyzedFormulaOutput:R})]},a)}o(672577);var Ao=()=>o(23749),Co=()=>o(882722),ko=()=>o(301809),jo=()=>o(314994),Io=()=>o(217638),Mo=()=>o(518489),To=()=>o(692763);const wo=(0,z().YK)({aboveMenuItemLabel:{id:"automations.DuplicateBlocksAction.aboveButtonLabel",defaultMessage:"Above button"},aboveTitle:{id:"automations.DuplicateBlocksAction.aboveTitle",defaultMessage:"above button"},belowMenuItemLabel:{id:"automations.DuplicateBlocksAction.belowButtonLabel",defaultMessage:"Below button"},belowTitle:{id:"automations.DuplicateBlocksAction.belowTitle",defaultMessage:"below button"},title:{defaultMessage:"Insert blocks {insertionPicker}",id:"automations.DuplicateBlocksAction.title"},topOfPageMenuItemLabel:{id:"automations.DuplicateBlocksAction.topOfPageButtonLabel",defaultMessage:"At top of page"},topOfPageTitle:{id:"automations.DuplicateBlocksAction.topOfPageTitle",defaultMessage:"at top of page"},bottomOfPageMenuItemLabel:{id:"automations.DuplicateBlocksAction.bottomOfPageButtonLabel",defaultMessage:"At bottom of page"},bottomOfPageTitle:{id:"automations.DuplicateBlocksAction.bottomOfPageTitle",defaultMessage:"at bottom of page"}}),Po={before:{icon:(0,Qe.jsx)(ze().I,{icon:o(334003).F}),key:"before",menuItemLabel:wo.aboveMenuItemLabel,title:wo.aboveTitle},after:{icon:(0,Qe.jsx)(ze().I,{icon:o(457056).o}),key:"after",menuItemLabel:wo.belowMenuItemLabel,title:wo.belowTitle},topOfPage:{icon:(0,Qe.jsx)(ze().I,{icon:o(419178).Q}),key:"topOfPage",menuItemLabel:wo.topOfPageMenuItemLabel,title:wo.topOfPageTitle},bottomOfPage:{icon:(0,Qe.jsx)(ze().I,{icon:o(820579).arrowLineDownIcon}),key:"bottomOfPage",menuItemLabel:wo.bottomOfPageMenuItemLabel,title:wo.bottomOfPageTitle}},_o=Po.after;function Bo(e){const{currentOption:t,disabled:o,onChange:n}=e,i=(0,z().tz)(),r=(0,De().j)(),a=(0,xe().uB)(void 0,it().A),s=(0,ye.useCallback)((e=>{n&&t.key!==e&&n(e),a.setState({open:!1})}),[a,t,n]);return(0,Qe.jsx)(nt().A,{alignmentToOrigin:"center",buttonPopupStore:a,disabled:o,originGap:0,placementToOrigin:"bottom",popupType:r,render:()=>(0,Qe.jsx)(Ro,{currentOption:t,onChange:s}),renderOrigin:e=>(0,Qe.jsx)(Tt().x,{...e,disabled:o,isCompact:!0,dropdownButtonType:"dropdown",children:i.formatMessage(t.title)})})}function Ro(e){const{currentOption:t,onChange:o}=e,n=(0,z().tz)(),i=(0,Ft().e)({maxWidth:360}),r=Object.values(Po).map((e=>({key:e.key,render:o=>(0,Qe.jsx)(rt().A,{...o,isChecked:t.key===e.key,icon:e.icon,title:n.formatMessage(e.menuItemLabel)}),action:()=>o(e.key)})));return(0,Qe.jsx)(_t().A,{...i,children:(0,Qe.jsx)(Bt().A,{initialFocus:0,sections:[{key:0,render:e=>(0,Qe.jsx)(Rt().A,{enableActionSheetTitle:!0,...e}),items:r}],type:Bt().O.Vertical})})}function Vo(e){const{actionStore:t,disabled:o,contentParentPointer:n,buttonPlacement:r}=e,a=(0,ve().v3)(),s=(0,Se().eP)(),l=(0,Se().IS)((()=>({listWrap:{background:Me().Tj.background.primary,borderRadius:5,boxShadow:Me().Tj.inputBoxShadow,fontSize:14,minHeight:64,paddingBlock:3,paddingInline:10,cursor:"text",..."dark"===s?{backgroundColor:Me().Tj.palette.gray[50]}:{}},emptyPlaceholder:{caretColor:Me().Tj.text.secondary,color:Me().Tj.text.tertiary,fontSize:14,padding:"5px 0",display:"inline-block"}})),[s]),c=(0,xe().K8)((()=>Q().B.createChildStore(t,n)),[t,n]),d=(0,xe().K8)((()=>c.getContentStore()),[c]),u=(0,xe().K8)((()=>(d.getValue()??[]).every((e=>Q().B.createChildStore(d,{table:Z().ev,id:e}).isType("page")))),[d]),p=(0,ye.useCallback)((()=>{(d.getValue()??[]).length>0&&!u||ce().createAndCommit({userAction:"DuplicateBlocksAction.handleListClick",environment:a,canUndo:!0,perform:e=>{const t=i().insertEmptyTextInDuplicateBlockAction({environment:a,contentStore:d,transaction:e});(0,Mo().h)({environment:a,store:t}),(0,ko().e)({store:t.getBlockTitleStore()})}})}),[d,u,a]);if(!d)return(0,Qe.jsx)(Ao().A,{name:"DuplicateBlocksActionEditor",children:null});const m="inline"===(null==r?void 0:r.type);return(0,Qe.jsx)(Ao().A,{name:"DuplicateBlocksActionEditor",children:(0,Qe.jsx)(To().Ay,{store:c,analyticsName:"duplicate_blocks_action",isListContainer:!0,children:(0,Qe.jsx)(he().s,{allowSelectionWithin:!0,children:(0,Qe.jsx)("div",{style:l.listWrap,onClick:p,className:Co().CCX,children:(0,Qe.jsx)(jo().c,{displayName:"DuplicateBlocksActionContent",disabled:o,children:(0,Qe.jsx)(Io().A,{disabled:o,store:d,emptyPlaceholder:(0,Qe.jsx)("div",{style:l.emptyPlaceholder,children:m?(0,Qe.jsx)(z().sA,{id:"automations.DuplicateBlocksAction.emptyPlaceholder",defaultMessage:"Click to edit or drop blocks here"}):(0,Qe.jsx)(z().sA,{id:"automations.DuplicateBlocksAction.emptyCannotDropPlaceholder",defaultMessage:"Click to edit blocks here"})}),disableCommentMenu:!0,disableHoverMenu:!1,disableDrag:!1})})})})})})}var Eo=()=>o(80979),Fo=()=>o(912720),Do=()=>o(616175);const Lo=(0,z().YK)({confirmationMessageLabel:{defaultMessage:"Confirmation message",id:"automations.BaseModalAction.confirmationMessageLabel"},continueButtonTextLabel:{defaultMessage:"Continue button text",id:"automations.BaseModalAction.continueButtonTextLabel"},cancelButtonTextLabel:{defaultMessage:"Cancel button text",id:"automations.BaseModalAction.cancelButtonTextLabel"}});var Oo=()=>o(422540),Ko=()=>o(718338);function No(e){const{actionStore:t,disabled:o,errorMessage:n,includeThisPage:i,onChange:a,target:s,urlBehavior:l}=e,c=(0,ve().v3)(),d=(0,Re().K4)(),u=null==d?void 0:d.typecheckResult,p=(0,xe().uB)(void 0,it().A),[m,g]=(0,xe().K8)((()=>[t.id,t.getSpaceId()]),[t]),y=(0,Mt().F)({actionId:m}),h=(0,xe().K8)((()=>{if(s)if("variable"===s.type){if(!u)return;const e=(0,Ct().getContextValueForActionById)(u,m,s.id);if(e&&e.kind===k().FormulaContextValueKind.ContextValue)return{type:"variable",contextValue:e}}else{if("page"===s.type||"url"===s.type)return s;(0,f().HB)(s)}}),[s,u,m]),v=(0,De().j)(),x=(0,ye.useCallback)((e=>{"page"!==e.type&&"variable"!==e.type&&"url"!==e.type||(a(e),p.reset(),(0,xt().CM)(((o,n,i)=>{const a=(0,xt().zc)({automationActionStore:t,formulaAnalyticsModule:n,formulasModule:o,simpleFormulasModule:i});(0,f().O9)(a)&&(0,r().u)({environment:c,event:{eventName:"automation_target_pick",eventProperties:{automation_action:a,automation_id:t.getParentId(),target_type:e.type}}})})))}),[a,p,t,c]),S=(0,ye.useCallback)((()=>p.reset()),[p]);let b;return h?"page"===h.type?b=(0,Qe.jsx)(jt().A,{store:Q().B.createChildStore(t,h.page),style:{paddingBlock:1}}):"variable"===h.type?b=(0,Qe.jsx)(It().F,{value:h.contextValue,format:kt().NY.Medium,isSingle:!0,style:{background:"transparent",color:"unset",margin:"-1.5px 0",padding:0}}):"url"===h.type?b=(0,Qe.jsx)("div",{children:h.url}):(0,f().HB)(h):b="allow"===l?(0,Qe.jsx)(z().sA,{id:"automations.AutomationPagePicker.pagesDropdown.labelWithUrl",defaultMessage:"Select page, form, or URL"}):(0,Qe.jsx)(z().sA,{id:"automations.AutomationPagePicker.pagesDropdown.label",defaultMessage:"Select page"}),(0,Qe.jsx)(nt().A,{buttonPopupStore:p,popupType:v,alignmentToOrigin:"center",placementToOrigin:"bottom",originGap:0,disabled:o,renderOrigin:e=>(0,Qe.jsx)(Tt().x,{...e,disabled:o,isCompact:!0,isError:Boolean(n),hasActionRequired:!Boolean(s),tooltipMessage:n,dropdownButtonType:"dropdown",children:b}),render:e=>(0,Qe.jsx)(wt()._,{formulaTypecheckContextValues:y,includeThisPage:i,onChange:x,onClose:S,parentRecordStore:t,selectedTarget:s,skipCollections:!0,skipPrivateSpace:!0,spaceId:g,urlBehavior:l})})}function Wo(e){const{actionStore:t,disabled:o,errorMessage:n,onChange:i,value:r,urlBehavior:a}=e,s=(0,Se().IS)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]);return(0,Qe.jsxs)("div",{style:s.title,children:[(0,Qe.jsx)(z().sA,{defaultMessage:"<span>Open </span>{pagePicker}",id:"automations.OpenPageAction.action.title",values:{pagePicker:(0,Qe.jsx)("div",{style:s.picker,children:(0,Qe.jsx)(No,{urlBehavior:a,actionStore:t,disabled:o,errorMessage:n,onChange:i,target:r})}),span:e=>(0,Qe.jsx)("span",{style:s.span,children:e})}}),""]})}function zo(e){const{actionStore:t,disabled:o,onChange:n}=e,i=(0,Se().IS)((()=>({picker:{display:"inline-flex",minWidth:50},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]),r=(0,xe().K8)((()=>t.getOpenPageIn()),[t]);return(0,Qe.jsx)("div",{style:i.title,children:(0,Qe.jsx)(z().sA,{defaultMessage:"<span>in </span>{peekModePicker}",id:"automations.OpenPageAction.peekMode.title",values:{peekModePicker:(0,Qe.jsx)("div",{style:i.picker,children:(0,Qe.jsx)(Uo,{disabled:o,onChange:n,value:r})}),span:e=>(0,Qe.jsx)("span",{style:i.span,children:e})}})})}function Uo(e){const{disabled:t,onChange:o,value:n}=e,i=(0,xe().uB)(void 0,it().A),r=(0,xe().K8)((()=>(0,Ko().c)({currentViewType:void 0}).find((e=>e.key===n))),[n]),a=(0,ye.useCallback)((()=>i.reset()),[i]),s=(0,ye.useCallback)((e=>{e!==(null==r?void 0:r.key)&&o(e),a()}),[a,null==r?void 0:r.key,o]),l=(0,De().j)();return r?(0,Qe.jsx)(nt().A,{alignmentToOrigin:"center",buttonPopupStore:i,disabled:t,originGap:0,placementToOrigin:"bottom",popupType:l,renderOrigin:e=>(0,Qe.jsx)(Tt().x,{...e,disabled:t,isCompact:!0,dropdownButtonType:"dropdown",children:r.title}),render:e=>(0,Qe.jsx)(Ho,{onChange:s,value:n})}):null}function Ho(e){const{onChange:t,value:o}=e,n=(0,Se().IS)((()=>({menuItem:{paddingBlock:8}})),[]),i=(0,Ft().e)({maxWidth:360,width:280}),r=(0,xe().K8)((()=>(0,Ko().c)({currentViewType:void 0}).map(((e,i)=>({action:()=>t(e.key),key:i,render:t=>(0,Qe.jsx)(rt().A,{...t,body:e.body,caption:e.caption,isChecked:o===e.key,disabled:!1,icon:e.icon,style:n.menuItem,title:e.title})})))),[t,n.menuItem,o]),a=[{key:0,render:e=>(0,Qe.jsx)(Rt().A,{enableActionSheetTitle:!0,...e}),items:r}];return(0,Qe.jsx)(_t().A,{...i,children:(0,Qe.jsx)(Bt().A,{initialFocus:0,sections:a,type:Bt().O.Vertical})})}var Yo=()=>o(135168),Go=()=>o(546926),qo=()=>o(287188),$o=()=>o(302501),Qo=()=>o(811979),Xo=()=>o(574036),Zo=()=>o(439616),Jo=()=>o(585293);function en(e){const{actionStore:t,disabled:o,errorMessage:n,onTargetChange:i,value:r}=e;return(0,Qe.jsx)(z().sA,{defaultMessage:"Publish{pagePicker}",id:"automations.PublishSiteAction.header.title",values:{pagePicker:(0,Qe.jsx)(No,{actionStore:t,disabled:o,errorMessage:n,includeThisPage:!0,onChange:i,target:r})}})}function tn(e){const{store:t}=e,o=(0,Se().IS)((()=>({outerContainer:{paddingTop:15,display:"flex",flexDirection:"column",gap:6},siteSettingsContainer:{borderRadius:10,border:`1px solid ${Me().Tj.border.secondaryTranslucent}`,padding:2},sectionMenuItem:{padding:"6px 2px"},button:{marginInlineStart:0,marginInlineEnd:0,width:"100%",paddingTop:2,paddingBottom:2,background:"transparent"},itemInnerContainer:{marginInlineStart:0,paddingInlineStart:8,minWidth:"auto",background:"transparent"}})),[]),n={type:"public_permission",role:"reader",expiration_timestamp:void 0},i=[{key:"linkExpiration",render:e=>(0,Qe.jsx)(Zo().A,{...e,disabled:!1,permissionItem:n,onChange:e=>{},hideIcon:!0,spaceStore:(0,Yo().f)(t)}),action:()=>{}},{key:"enableQna",render:e=>(0,Qe.jsx)(Xo().A,{...e,buttonStyle:o.button,textWrapperStyle:o.itemInnerContainer,title:(0,Qe.jsx)(z().sA,{defaultMessage:"Enable QnA",id:"automations.PublishSiteAction.action.siteSettingsEnableQna.title"}),on:!0,onClick:()=>{}}),action:()=>{}},{key:"enableSeo",render:e=>(0,Qe.jsx)(Xo().A,{...e,buttonStyle:o.button,textWrapperStyle:o.itemInnerContainer,title:(0,Qe.jsx)(z().sA,{defaultMessage:"Search engine indexing",id:"automations.PublishSiteAction.action.siteSettingsEnableSEO.title"}),on:!1,onClick:()=>{}}),action:()=>{}}],r=(0,y().oE)([{key:0,render:e=>(0,Qe.jsx)(Rt().A,{style:o.sectionMenuItem,...e}),items:i}]);return(0,Qe.jsxs)("div",{style:o.outerContainer,children:[(0,Qe.jsx)("label",{children:(0,Qe.jsx)(z().sA,{defaultMessage:"Settings",id:"automations.PublishSiteAction.action.siteSettingsTitle"})}),(0,Qe.jsx)(Bt().A,{type:Bt().O.Vertical,sections:r,initialFocus:void 0,resetFocusOnMouseOut:!0,style:o.siteSettingsContainer})]})}function on(){const e=(0,Se().IS)((()=>({outerContainer:{paddingTop:15,display:"flex",flexDirection:"column",gap:6},siteSettingsContainer:{borderRadius:10,border:`1px solid ${Me().Tj.border.secondaryTranslucent}`,padding:2},sectionMenuItem:{padding:"6px 2px"}})),[]),t=[{key:"theme",render:t=>(0,Qe.jsx)(nn,{...t,style:e.sectionMenuItem}),action:()=>{}},{key:"header",render:t=>(0,Qe.jsx)(sn,{...t,style:e.sectionMenuItem}),action:()=>{}},{key:"googleAnalytics",render:t=>(0,Qe.jsx)(cn,{...t,style:e.sectionMenuItem}),action:()=>{}}],o=(0,y().oE)([{key:0,render:t=>(0,Qe.jsx)(Rt().A,{style:e.sectionMenuItem,...t}),items:t}]);return(0,Qe.jsxs)("div",{style:e.outerContainer,children:[(0,Qe.jsx)("label",{children:(0,Qe.jsx)(z().sA,{defaultMessage:"Site customization",id:"automations.PublishSiteAction.action.siteCustomizationTitle"})}),(0,Qe.jsx)(Bt().A,{type:Bt().O.Vertical,sections:o,initialFocus:void 0,resetFocusOnMouseOut:!0,style:e.siteSettingsContainer})]})}const nn=ye.forwardRef(((e,t)=>{const o=(0,ye.useCallback)((e=>{}),[]),n="system";return(0,Qe.jsx)(Qo().A,{...e,popupType:s().A.isMobile?nt().z.SlideUp:nt().z.Popup,renderOrigin:t=>(0,Qe.jsx)(Jo().a,{...(0,We().A)(e,t),title:(0,Qe.jsx)(z().sA,{defaultMessage:"Theme",id:"automations.PublishSiteAction.action.siteCustomization.themeTitle"}),right:(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)(rn,{value:n}),(0,Qe.jsx)(ze().I,{icon:oo().arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"})]})}),alignmentToOrigin:"end",placementToOrigin:"bottom",render:e=>(0,Qe.jsx)(an,{value:n,onChange:o,onClose:()=>{e.close()}})})}));function rn(e){const{value:t}=e,o=(0,Se().IS)((()=>({container:{color:Me().Tj.text.secondary}})),[]);return t?"system"===t?(0,Qe.jsx)($o().A,{style:o.container,children:(0,Qe.jsx)(z().sA,{defaultMessage:"System",id:"automations.PublishSiteAction.action.siteCustomization.themeOptions.system"})}):"light"===t?(0,Qe.jsx)($o().A,{style:o.container,children:(0,Qe.jsx)(z().sA,{defaultMessage:"Light",id:"automations.PublishSiteAction.action.siteCustomization.themeOptions.light"})}):"dark"===t?(0,Qe.jsx)($o().A,{style:o.container,children:(0,Qe.jsx)(z().sA,{defaultMessage:"Dark",id:"automations.PublishSiteAction.action.siteCustomization.themeOptions.dark"})}):void(0,f().HB)(t):null}function an(e){const{value:t,onChange:o,onClose:n}=e,i=(0,ye.useCallback)((e=>{void 0!==e&&e!==t&&o(e),n()}),[t,o,n]),r=["system","light","dark"].map((e=>({key:e,render:t=>(0,Qe.jsx)(rt().A,{...t,title:(0,Qe.jsx)(rn,{value:e})}),action:()=>{i(e)}}))),a=[{key:0,render:e=>(0,Qe.jsx)(Rt().A,{...e}),items:r}];return(0,Qe.jsx)(_t().A,{menuType:s().A.isMobile?Go().gu.ActionSheet:Go().gu.Popup,width:240,children:(0,Qe.jsx)(Bt().A,{type:Bt().O.Vertical,initialFocus:r.findIndex((e=>e.key===t)),sections:a})})}nn.displayName="ThemeCustomizationItem";const sn=ye.forwardRef(((e,t)=>{const o=(0,ye.useCallback)((e=>{}),[]),n={};return(0,Qe.jsx)(Qo().A,{...e,popupType:s().A.isMobile?nt().z.SlideUp:nt().z.Popup,renderOrigin:t=>(0,Qe.jsx)(Jo().a,{...(0,We().A)(e,t),title:(0,Qe.jsx)(z().sA,{defaultMessage:"Header",id:"automations.PublishSiteAction.action.siteCustomization.headerTitle"}),right:(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)(z().sA,{defaultMessage:"Default",id:"automations.PublishSiteAction.action.siteCustomization.headerDefaultValue"}),(0,Qe.jsx)(ze().I,{icon:oo().arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"})]})}),alignmentToOrigin:"end",placementToOrigin:"bottom",render:e=>(0,Qe.jsx)(ln,{value:n,onChange:o,onClose:()=>{e.close()}})})}));function ln(e){const{value:t}=e,o=[{key:"breadcrumbs",render:e=>(0,Qe.jsx)(Jo().a,{...e,title:(0,Qe.jsx)(z().sA,{defaultMessage:"Breadcrumbs",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionBreadcrumb"}),right:(0,Qe.jsx)(qo().A,{...e,on:!(null!=t&&t.hideBreadcrumbs)})}),action:()=>{}},{key:"likeButton",render:e=>(0,Qe.jsx)(Jo().a,{...e,title:(0,Qe.jsx)(z().sA,{defaultMessage:"Like",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionLike"}),right:(0,Qe.jsx)(qo().A,{...e,on:!(null!=t&&t.hideLikeButton)})}),action:()=>{}},{key:"search",render:e=>(0,Qe.jsx)(Jo().a,{...e,title:(0,Qe.jsx)(z().sA,{defaultMessage:"Search",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionSearch"}),right:(0,Qe.jsx)(qo().A,{...e,on:!(null!=t&&t.hideSearch)})}),action:()=>{}},...(0,xe().K8)((()=>"on"===a().default.getEligibleGroup({experimentId:"public_site_topbar_share_button",defaultGroup:"control"})&&"on"===a().default.getEligibleGroup({experimentId:"public_site_topbar_mobile_share_button",defaultGroup:"control"})),[])?[{key:"share",render:e=>(0,Qe.jsx)(Jo().a,{...e,disabled:!0,title:(0,Qe.jsx)(z().sA,{defaultMessage:"Share",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionShare"}),right:(0,Qe.jsx)(qo().A,{...e,disabled:!0,on:!(null!=t&&t.hideShare)})}),action:()=>{}}]:[],{key:"watermark",render:e=>(0,Qe.jsx)(Jo().a,{...e,disabled:!0,title:(0,Qe.jsx)(z().sA,{defaultMessage:"Watermark",id:"automations.PublishSiteAction.action.siteCustomization.headerOptionWatermark"}),right:(0,Qe.jsx)(qo().A,{...e,disabled:!0,on:!(null!=t&&t.hideWatermark)})}),action:()=>{}}],n=[{key:0,render:e=>(0,Qe.jsx)(Rt().A,{...e}),items:o}];return(0,Qe.jsx)(_t().A,{menuType:s().A.isMobile?Go().gu.ActionSheet:Go().gu.Popup,width:240,children:(0,Qe.jsx)(Bt().A,{type:Bt().O.Vertical,initialFocus:o.findIndex((e=>e.key===t)),sections:n})})}sn.displayName="HeaderCustomizationItem";const cn=ye.forwardRef(((e,t)=>{const o=(0,ye.useRef)(null);return(0,Qe.jsx)(Jo().a,{...e,title:(0,Qe.jsx)(z().sA,{defaultMessage:"Google Analytics",id:"automations.PublishSiteAction.action.siteCustomization.googleAnalyticsTitle"}),right:(0,Qe.jsx)(dn,{ref:o,value:undefined}),onClick:()=>{var e;return null===(e=o.current)||void 0===e?void 0:e.focus()}})}));cn.displayName="GoogleAnalyticsCustomizationSetting";const dn=ye.forwardRef(((e,t)=>{const{value:n}=e,[i,r]=(0,ye.useState)(!1),a=!1,s=(0,Se().IS)((()=>({inputContainer:{background:Me().Tj.background.primary,borderRadius:4,boxShadow:i?"0px 0px 0px 1px #2383E2 inset, 0px 0px 0px 2px rgba(35, 131, 226, 0.35)":`${Me().Tj.border.secondaryTranslucent} 0px 0px 0px 1px inset`,height:28,padding:8,fontWeight:Te().Wy.regular,fontSize:14,lineHeight:1.3,color:Me().Tj.text.secondary},input:{marginInlineStart:-6,paddingInlineStart:0,color:Me().Tj.text.primary},wrapper:{paddingTop:4,paddingBottom:4}})),[a,i]);return(0,Qe.jsx)("div",{style:s.wrapper,children:(0,Qe.jsx)(o(31511).A,{ref:t,type:"text",style:s.inputContainer,inputStyle:s.input,value:n,onChange:e=>{},format:"transparent",onFocus:()=>r(!0),onBlur:()=>r(!1),left:"G-",disabled:a})})}));dn.displayName="GoogleAnalyticsInput";o(430670);var un=()=>o(365917),pn=()=>o(849255),mn=()=>o(718827),gn=()=>o(493552),yn=()=>o(79118),hn=()=>o(617871),fn=()=>o(90907),vn=()=>o(457823),xn=()=>o(115512),Sn=()=>o(5269);function bn(e){const t=(0,ve().v3)();(0,xe().K8)((()=>{(0,j().Fbh)(e).forEach((e=>{new(pn().L)(t,{table:_().oo,id:e},{userId:e}).isDefined()}))}),[t,e])}var An=()=>o(475403),Cn=()=>o(304359),kn=()=>o(227124),jn=()=>o(245720),In=()=>o(449279),Mn=(o(908872),()=>o(59226)),Tn=()=>o(352321),wn=()=>o(452004),Pn=()=>o(898244),_n=()=>o(842599),Bn=()=>o(126912),Rn=()=>o(778078),Vn=()=>o(453697),En=()=>o(821481),Fn=()=>o(106628),Dn=()=>o(361330),Ln=()=>o(576241),On=()=>o(674300),Kn=()=>o(489255),Nn=()=>o(848401);function Wn({handleRemoveToken:e,token:t,format:o,style:n,addQuotes:i,renderAvatar:r,isDisabled:a}){if(!(0,_n().DT)(t))return null;const s=i?`${t}`:t;return(0,Qe.jsx)(Nn().Ay,{title:s,format:o??kt().NY.Small,renderAvatar:r||(e=>(0,Qe.jsx)(ze().I,{icon:Kn().inviteMemberFillIcon,size:e,style:{padding:2,marginInlineEnd:6}})),showRemoveButton:Boolean(e)&&!a,onClickRemove:o=>{null==o||o.stopPropagation(),e&&e(t)},style:{background:Me().Tj.palette.gray[75],...n},shouldShrink:!0,isSingle:!1})}var zn=()=>o(436876);const Un=["gmail.com","yahoo.com","outlook.com"],Hn=["com","net","org"];var Yn=()=>o(320865),Gn=()=>o(262509),qn=()=>o(238259),$n=()=>o(975969);function Qn({email:e,disabled:t,menuArgs:o}){const n=(0,$n().U)();return(0,Qe.jsx)(rt().A,{...o,title:(0,Qe.jsx)(Wn,{token:e,format:kt().NY.Inline,addQuotes:!0,style:{background:void 0,padding:void 0}}),disabled:t,style:t?n.disabledMenuItem:void 0,isTokenTitle:!0})}function Xn({token:e,disabled:t,menuArgs:o,type:n}){const i=(0,$n().U)();return(0,Qe.jsx)(rt().A,{...o,title:(0,Qe.jsx)(zn().A,{token:e,type:n,format:kt().NY.Inline,style:{color:Me().Tj.darkTextColor,background:void 0,padding:void 0}}),disabled:t,style:{...t?i.disabledMenuItem:void 0},isTokenTitle:!0})}var Zn=()=>o(764880),Jn=()=>o(448693);function ei({annotation:e,disabled:t,getRecordModel:o,menuArgs:n}){const i=(0,$n().U)(),r=(0,xe().K8)((()=>{if((0,Jt().isAnnotationSimpleValueToken)(e)&&(0,j().rie)(e)){const t=(0,j().NcG)(e);return t?(0,Zn().xC)({pointer:{table:_().oo,id:t},getRecordModel:o,getRecordValue:void 0}):void 0}}),[e,o]);return null!=r&&r.asActor&&r.table===_().oo?(0,Qe.jsx)(rt().A,{...n,title:(0,Qe.jsx)(ti,{actor:r}),disabled:t,style:t?i.disabledMenuItem:void 0,isTokenTitle:!0}):null}function ti({actor:e}){const t=(0,Se().IS)((()=>({root:{margin:"4px 0"},actor:{marginTop:0,marginInlineEnd:10,marginBottom:0,marginInlineStart:0},email:{color:Me().Tj.text.secondary,marginTop:0,marginInlineEnd:0,marginBottom:0,marginInlineStart:26}})),[]),o=(0,xe().K8)((()=>e.getName()),[e]),n=(0,xe().K8)((()=>e.getEmail()),[e]);return(0,Qe.jsxs)("div",{style:t.root,children:[(0,Qe.jsx)(Jn().Ay,{actor:e,format:kt().NY.Medium,shouldShrink:!0,isSingle:!1,style:t.actor,hasPersonHoverCard:!1},e.id),o?(0,Qe.jsx)(Nn().Ay,{title:n,format:kt().NY.ExtraSmall,isSingle:!1,style:t.email}):void 0]})}function oi(e){const{action:t,currentSimpleFormulaValueTokens:o,formulaTypecheckContextValues:n,formulaValueContext:i,getRecordModel:r,isDisabled:a,limit:l,menuProps:c,onChange:d,onClose:u,onFormulaButtonClick:p,showFormulaValueItems:m=!1,value:g,pageProperties:h,parentRecordStore:f,showInputErrorStyles:v}=e,{errorMessage:x,isLoading:S,menuListStore:b,noResultsMessage:A,searchInput:C,userItems:I,valueItems:M,pagePropertyItems:T,emailItems:w}=function(e){var t,o,n;const{action:i,formulaTypecheckContextValues:r,formulaValueContext:a,isDisabled:s=!1,limit:l,onChange:c,onClose:d,onFormulaButtonClick:u,unlimitedCurrentSimpleFormulaValueTokens:p,value:m,pageProperties:g,parentRecordStore:h,showInputErrorStyles:f}=e,v=(0,ve().v3)(),x=(0,z().tz)(),{collectionStore:S,property:b}="collection"===a.type?a:{collectionStore:void 0,property:void 0},A=h.getRecordModel,C=(0,eo().pg)(a),I=C(p,"first"),M=(0,ye.useMemo)((()=>r.filter((e=>(0,fo().o5)(e.type,{type:"person"})))),[r]),T=(0,Se().IS)((()=>({personToken:{background:Me().Tj.palette.gray[75],borderRadius:"6px",margin:void 0},formulaValueToken:{background:Me().Tj.background.elevated},searchInput:{maxHeight:6*parseInt(Tn().sA,10),width:"100%",margin:0,...f&&{border:`1px solid ${Me().Tj.red.text.accentPrimary}`,boxShadow:"none"}},clearButton:{height:20},clearButtonIcon:{height:lt().Ev.default,width:lt().Ev.default},actionButtonGroup:{alignSelf:"end",cursor:"unset",justifyContent:"end"}})),[f]),[w,P]=(0,ye.useState)(""),_=(0,ye.useRef)(null),B=(0,ye.useRef)(""),R=(0,xe().uB)(void 0,wn().$),V=(0,xe().K8)((()=>(null==S?void 0:S.getSchema())??{}),[S]),E=(0,xe().K8)((()=>{if(V&&b){const e=V[b];if(e&&(0,Pn().sO)(e))return 1===e.limit}return!1}),[V,b]),[F]=(0,Ie().Yb)((async()=>{const e=w?(0,Rn().Ay)(w,M,(e=>e.kind===k().FormulaContextValueKind.ContextValue?e.name:"")):M,t=w?(0,Rn().Ay)(w,g,(e=>(0,j().GCe)(e).name??"")):g,o=(0,Jt().fromSimpleFormulaArrayValue)(null==m?void 0:m.value).reduce(((e,t)=>(t&&(0,Jt().isAnnotationSimpleValueToken)(t)&&(0,j().rie)(t)&&e.push(t[1]),e)),[]),n=await Fn().T.searchActions.load(),i=await n.searchSpaceUsers({environment:v,query:w,membersOnly:!1,limit:20+o.length});let r=0,a=i[r];const s=[];for(;a&&s.length<20;)o.includes(a.id)||s.push(a.id),r+=1,a=i[r];return{valueResults:e,userResults:s,pagePropertyResults:t}}),[v,w,M,null==m?void 0:m.value,g],{debounce:Dn().tu}),D=(0,ye.useCallback)((()=>{var e;P(""),null===(e=_.current)||void 0===e||e.focus(),R.setState({...R.state,focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[R]),L=(0,ye.useCallback)(((e,t)=>{c(e||m,t||i)}),[i,c,m]),O=(0,ye.useCallback)((e=>{const t=C(e,"last");L({type:"simple",value:(0,Jt().toSimpleFormulaArrayValue)(t)}),D()}),[C,L,D]),K=(0,ye.useCallback)((()=>{O(I.slice(0,I.length-1))}),[I,O]),N=(0,ye.useCallback)((e=>{null==O||O((0,Jt().simpleFormulaValueWithoutToken)(I,e))}),[I,O]),W=Boolean(l&&I.length>=l),U=y().oE(I.map(((e,t)=>{if("boolean"==typeof e)return null;if("string"==typeof e)return(0,Qe.jsx)(Wn,{handleRemoveToken:N,token:e,isDisabled:s,renderAvatar:t=>(0,Vn().A)({avatar:{email:e},style:{marginInlineEnd:4}}),style:T.personToken},t);if((0,j().rie)(e))return(0,Qe.jsx)(Ln().A,{parentRecordStore:h,handleRemoveToken:N,token:e,isDisabled:s,style:T.personToken,preventOnClickPropagation:!0},t);if((0,j().s1Y)(e))return(0,Qe.jsx)(On().A,{formulaTypecheckContextValues:r,handleRemoveToken:N,isDisabled:s,style:T.formulaValueToken,token:e,preventOnClickPropagation:!0},t);if((0,j().iz3)(e)){var o;const n=(0,j().GCe)(e);return(0,Qe.jsx)(zn().A,{type:null===(o=V[n.property])||void 0===o?void 0:o.type,isDisabled:s,handleRemoveToken:N,token:e},t)}return null}))),H=new Set(y().oE(I.map((e=>(0,Jt().isAnnotationSimpleValueToken)(e)&&(0,j().s1Y)(e)&&(0,j().iVq)(e).id)))),Y=new Set(y().oE(I.map((e=>(0,Jt().isAnnotationSimpleValueToken)(e)&&(0,j().rie)(e)&&(0,j().NcG)(e))))),G=y().oE(((null===(t=F.value)||void 0===t?void 0:t.valueResults)||[]).map((e=>{const t=e.kind===k().FormulaContextValueKind.ContextValue&&e.id||"";if(!t||!H.has(t))return{action:"append",currentSimpleFormulaValueTokens:I,isDisabled:s||W,id:t,getRecordModel:A,setCurrentTokens:O,value:e}}))),q=y().oE(((null===(o=F.value)||void 0===o?void 0:o.userResults)||[]).map((e=>{const t=Y.has(e);if(t)return;const o=(0,j().P4h)(e);return{action:()=>{t?N(o):O([...I,o]),E&&ee().default.afterNextFlush((()=>{d()}))},annotation:o,getRecordModel:A,id:e,isDisabled:s||W,userId:e,isSelected:t}}))),$=new Set(I.filter((e=>(0,Jt().isAnnotationSimpleValueToken)(e)&&(0,j().iz3)(e))).map((e=>(0,j().GCe)(e).property))),Q=y().oE(null===(n=F.value)||void 0===n?void 0:n.pagePropertyResults.map((e=>{var t;const o=(0,j().GCe)(e);if(!$.has(o.property))return{id:o.property,type:null===(t=V[o.property])||void 0===t?void 0:t.type,isDisabled:s||W,action:()=>{O([...I,e])},propertyAnnotation:e}}))),X=(0,ye.useCallback)((e=>{(0,_n().DT)(e)&&O([...I,e])}),[I,O]),Z=(0,ye.useCallback)((()=>{X(B.current)}),[X]);(0,ye.useEffect)((()=>{B.current=w}),[w]),(0,ye.useEffect)((()=>{const e=_.current;return e&&e.addEventListener("blur",Z),()=>{e&&e.removeEventListener("blur",Z)}}),[Z]);const J=(0,_n().DT)(w)?[w]:[];if(0===J.length){const[e,t]=w.split("@");if(t){const[o,n]=t.split(".");(!n||n.length<=1)&&J.push(...Hn.map((t=>`${e}@${o}.${t}`)).filter(_n().DT))}else J.push(...Un.map((t=>`${e}@${t}`)).filter(_n().DT))}const te=J.map((e=>({action:()=>X(e),isDisabled:s||W,email:e}))),oe=[...G,...q,...Q,...te],ne=(0,Mn().X)("gmail_action_formula_recipients");return{errorMessage:F.error&&x.formatMessage(En().D.somethingWentWrong),header:x.formatMessage(En().D.genericMenuHeader),isLoading:!F.value&&!F.error,menuListStore:R,noResultsMessage:0===oe.length&&F.value&&x.formatMessage(En().D.noResults),searchInput:e=>(0,Qe.jsx)(Tn().Ay,{ref:_,style:T.searchInput,right:(0,Qe.jsxs)(Kt().Y1,{direction:"horizontal",style:T.actionButtonGroup,children:[ne&&u?(0,Qe.jsx)(Cn().F,{disabled:s,onClick:e=>{e.stopPropagation(),u(e)},value:m}):void 0,(0,Qe.jsx)(Ue().A,{ariaLabel:x.formatMessage({id:"automations.emailRecipients.clear",defaultMessage:"Clear"}),disabled:s,disabledFeedback:s,onClick:e=>{e.stopPropagation(),O([])},style:T.clearButton,icon:Bn().xMarkCircleFillSmallIcon,colorVariant:"tertiary",iconStyle:T.clearButtonIcon})]}),disabled:s||W,format:Tn().le.FilterValue,onChange:e=>P(e.target.value),onRemoveLastToken:K,placeholder:"",onClick:e,tokens:U,value:w}),userItems:q,valueItems:G,pagePropertyItems:Q,emailItems:te}}({action:t,formulaTypecheckContextValues:n,formulaValueContext:i,isDisabled:a,limit:l,onChange:d,onClose:u,onFormulaButtonClick:p,unlimitedCurrentSimpleFormulaValueTokens:o,value:g,pageProperties:h,parentRecordStore:f,showInputErrorStyles:v})||{},P=(0,ye.useMemo)((()=>M&&m?M.map((e=>{const{annotation:t,itemAction:o}=(0,qn().E)({action:e.action,currentSimpleFormulaValueTokens:e.currentSimpleFormulaValueTokens,setCurrentTokens:e.setCurrentTokens,value:e.value});return{key:e.id,render:o=>(0,Qe.jsx)(Gn().A,{annotation:t,disabled:e.isDisabled,formulaTypecheckContextValues:n,menuArgs:o,style:{background:void 0,color:Me().Tj.darkTextColor,padding:void 0},parentRecordStore:f}),action:o}})):[]),[M,m,n,f]),_=(0,ye.useMemo)((()=>I?I.map((e=>({key:e.userId,render:t=>(0,Qe.jsx)(ei,{annotation:e.annotation,disabled:e.isDisabled,menuArgs:t,getRecordModel:r||e.getRecordModel}),action:e.action}))):[]),[r,I]),B=[...P,...(0,ye.useMemo)((()=>T?T.map((e=>({key:e.id,render:t=>(0,Qe.jsx)(Xn,{disabled:e.isDisabled,menuArgs:t,type:e.type,token:e.propertyAnnotation}),action:e.action}))):[]),[T])],R=[];B.length>0&&R.push({key:"properties",render:e=>(0,Qe.jsx)(Rt().A,{...e,title:"Property",topBorder:!1}),items:B}),_.length>0&&R.push({key:"users",render:e=>(0,Qe.jsx)(Rt().A,{...e,title:"Person",topBorder:B.length>0}),items:_});const V=(0,ye.useMemo)((()=>w?w.map((e=>({key:e.email,action:e.action,render:t=>(0,Qe.jsx)(Qn,{email:e.email,disabled:e.isDisabled,menuArgs:t})}))):[]),[w]);let E;V.length>0&&R.push({key:"emails",render:e=>(0,Qe.jsx)(Rt().A,{...e,title:"Email",topBorder:B.length>0||_.length>0}),items:V}),E=s().A.isMobile?{menuType:Go().gu.Modal,right:(0,Qe.jsx)(z().sA,{...jn().W.done}),minWidth:"100%"}:{menuType:Go().gu.Popup,maxHeight:"50vh",minWidth:"100%",disableHeaderBorder:!0};const F={width:"260px"},D=(0,Qe.jsxs)(Qe.Fragment,{children:[x?(0,Qe.jsx)(Rt().A,{style:F,children:(0,Qe.jsx)(In().u,{title:x})}):void 0,A?(0,Qe.jsx)(Rt().A,{style:F,children:(0,Qe.jsx)(In().u,{title:A})}):void 0,S?(0,Qe.jsx)(Rt().A,{style:F,children:(0,Qe.jsx)(Yn().A,{})}):void 0,R.length>0?(0,Qe.jsx)(Bt().A,{type:Bt().O.Vertical,initialFocus:0,sections:R,store:b,style:F}):void 0]});return{searchInput:C,innerComponents:D,emailRecipientsMenu:(0,Qe.jsx)(_t().A,{...E,...c,children:D})}}function ni(e){const{currentValue:t,onChange:o,parentRecordStore:n,spaceId:i,formulaTypecheckContextValues:r,disabled:a}=e;return"formula"===(null==t?void 0:t.type)?(0,Qe.jsx)(ai,{parentRecordStore:n,spaceId:i,value:t,formulaTypecheckContextValues:r,isDisabled:a,onChange:o}):(0,Qe.jsx)(ii,{...e})}function ii(e){const{currentValue:t,collectionStore:o,onChange:n,formulaTypecheckContextValues:i,limit:r,pageProperties:a,disabled:s,parentRecordStore:l,errorMessage:c}=e,d=o?{type:"collection",collectionStore:o,property:"person"}:{type:"empty"},u={menuType:Go().gu.Popup},p=(0,xe().K8)((()=>(0,Jt().fromSimpleFormulaArrayValue)(null==t?void 0:t.value)),[t]),{searchInput:m,emailRecipientsMenu:g}=oi({currentSimpleFormulaValueTokens:p,formulaTypecheckContextValues:i,formulaValueContext:d,limit:r,menuProps:u,onChange:n,onClose:window.parent.close,onFormulaButtonClick:e=>{e.stopPropagation(),n({type:"formula",value:null==t?void 0:t.value})},showFormulaValueItems:!0,showGenericHeader:!0,value:t,pageProperties:a,isDisabled:s,parentRecordStore:l,showInputErrorStyles:(0,f().O9)(c)});return(0,Qe.jsx)(nt().A,{renderOrigin:({onClick:e})=>null==m?void 0:m(e),popupType:nt().z.Popup,render:()=>g})}const ri=[{type:"person"},{type:"text"},{type:"array",of:{type:"person"}},{type:"array",of:{type:"text"}}];function ai(e){const{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:n,value:i,onChange:r,isDisabled:a}=e,s=(0,Se().IS)((()=>({containerWrap:{width:"100%"},formulaText:{whiteSpace:"pre-wrap",cursor:"pointer"},scroller:{flexGrow:1,width:"100%"},textWrap:{cursor:"text",display:"flex",flexWrap:"wrap",justifyContent:"end",width:"100%"},wrap:{background:Me().Tj.inputBackground,boxShadow:Me().Tj.inputBoxShadow,boxSizing:"border-box",cursor:"text",padding:"4px 8px"},actionButtonGroup:{alignSelf:"end",cursor:"unset",justifyContent:"end"}})),[]),l=async e=>{e.stopPropagation();if(await(0,eo().Cp)()){const e=(0,eo().D2)(null==i?void 0:i.value);null==r||r(e)}},c=(0,xe().uB)(void 0,it().A),d=(0,ye.useCallback)((()=>c.setState({open:!1})),[c]);return(0,Qe.jsx)(nt().A,{buttonPopupStore:c,renderOrigin:e=>(0,Qe.jsx)("div",{...e,style:s.containerWrap,children:(0,Qe.jsx)(Kt().Y1,{align:"center",className:Co().CCX,direction:"vertical",gap:4,style:s.wrap,children:(0,Qe.jsxs)("div",{style:s.textWrap,children:[(0,Qe.jsx)(we().H,{style:s.scroller,type:be().A.Y,children:(0,Qe.jsx)("div",{style:s.formulaText,children:(0,Qe.jsx)(An().$,{formulaTypecheckContextValues:t,parentRecordStore:o,spaceId:n,value:i})})}),(0,Qe.jsx)("div",{children:(0,Qe.jsx)(Kt().Y1,{direction:"horizontal",gap:2,style:s.actionButtonGroup,children:(0,Qe.jsx)(Cn().F,{disabled:a,onClick:l,value:i})})})]})})}),popupType:nt().z.Popup,render:()=>(0,Qe.jsx)(kn().A,{allowedReturnTypes:ri,disabled:a,formulaTypecheckContextValues:t??[],onChange:r,onClose:d,parentRecordStore:o,value:i,spaceId:n})})}var si=()=>o(300474),li=()=>o(424400),ci=()=>o(148307),di=()=>o(218275),ui=()=>o(158661),pi=()=>o(457583),mi=()=>o(47373),gi=()=>o(63515);const yi=(0,z().YK)({gmailAccountMenuPickerHeader:{defaultMessage:"Select Account",id:"automations.gmailAccountPicker.menuHeader"},gmailAccountMenuPickerHeaderInvalidAccount:{defaultMessage:"Invalid Account",id:"automations.gmailAccountPicker.menuHeaderInvalidAccount"},gmailAccountMenuPickerHeaderInvalidAccountTooltip:{defaultMessage:"Connect a valid account or delete this step",id:"automations.gmailAccountPicker.menuHeaderInvalidAccountTooltip"},addGmailAccountLabel:{id:"automations.gmailAccountPicker.setupAnotherGmailAccount.label",defaultMessage:"Add Gmail Account"},manageAccountInfoCaption:{id:"automations.gmailAccountPicker.manageAccountInfo.caption",defaultMessage:"Manage connected accounts in the My Connections tab of Settings"},connectGmailAccountMobileLabel:{id:"automations.gmailAccountPicker.connectGmailAccountMobile.label",defaultMessage:"Connect Gmail Account"},connectGmailAccountMobileCaption:{id:"automations.gmailAccountPicker.connectGmailAccountMobile.caption",defaultMessage:"Open desktop or web app to connect"},connectGmailAccountLabel:{id:"automations.gmailAccountPicker.connectGmailAccount.label",defaultMessage:"Connect Gmail Account"},connectGmailAccountCaption:{id:"automations.gmailAccountPicker.connectGmailAccount.caption",defaultMessage:"Allow Notion to send email on your behalf"}});function hi(e){const{currentGmailAuthentication:t,gmailAuthentications:o,disabled:n,errorMessage:i,onAccountChange:a}=e,l=(0,ve().v3)(),c=(0,si().r)(),d="collection_view_settings",u=(0,xe().K8)((()=>un().A.integrations.state.find((e=>e.id===hn().eg))),[]),p=Boolean(i),m=(0,xe().uB)(void 0,it().A),g=(0,ye.useCallback)((e=>{a(e),(0,r().u)({environment:l,event:{eventName:"gmail_action_account_click",eventProperties:{}}}),m.reset()}),[a,m,l]),y=(0,De().j)(),h=(0,Ft().e)(),f=(0,Se().IS)((()=>({infoItem:{color:Me().Tj.text.secondary,cursor:"default"},connectAccount:{paddingInlineEnd:"32px"},manageAccountCaption:{color:Me().Tj.text.tertiary},errorText:{color:Me().Tj.red.text.accentPrimary}})),[]);if(!u)return null;const v=[{items:o.map(((e,o)=>({action:()=>null,key:e.id,render:()=>{const o=(null==t?void 0:t.id)===e.id;return(0,Qe.jsx)(rt().A,{focused:(null==t?void 0:t.id)===e.id,onClick:async()=>{if(c)if(o&&p){const e=await fi(l,u,c,d);"success"===e.status?g(e.externalAuthentication.id):m.reset()}else g(e.id)},title:e.account_name,left:(0,Qe.jsx)(Vn().A,{avatar:{email:e.account_name}}),isChecked:!p&&o,right:p&&o?(0,Qe.jsx)(ze().I,{icon:ui().exclamationMarkTriangleFillSmallIcon,size:"sm"}):void 0,style:{...o&&p&&f.errorText},bodyStyle:{minWidth:"280px"}},e.id)}}))),key:"gmailAccounts",render:e=>(0,Qe.jsx)(Rt().A,{...e,enableActionSheetTitle:!0})}];v.push({key:"add-another-gmail-account-section",items:[{key:"add-another-gmail-account-item",action:async()=>{if(!c)return;const e=await fi(l,u,c,d);"success"===e.status&&(a(e.externalAuthentication.id),m.reset())},render:e=>(0,Qe.jsx)(rt().A,{...e,left:(0,Qe.jsx)(ze().I,{icon:at().plusIcon}),right:(0,Qe.jsx)(ze().I,{icon:di().arrowUpRightSquareSmallIcon,size:"sm",colorVariant:"tertiary"}),title:(0,Qe.jsx)(z().sA,{...yi.addGmailAccountLabel})})}],render:e=>(0,Qe.jsx)(Rt().A,{...e,topBorder:!0})}),v.push({key:"manage-account-info-section",items:[{key:"manage-account-info-item",action:()=>null,render:e=>(0,Qe.jsx)(rt().A,{...e,style:f.infoItem,focused:!1,caption:(0,Qe.jsx)(li().CU,{caption:(0,Qe.jsx)(z().sA,{...yi.manageAccountInfoCaption}),shouldWrapCaption:!0,captionStyle:f.manageAccountCaption})})}],render:e=>(0,Qe.jsx)(Rt().A,{...e,topBorder:!0})});const x={key:"connect-gmail-account-mobile-item",action:()=>null,render:e=>(0,Qe.jsx)(rt().A,{...e,icon:(0,Qe.jsx)("img",{src:ci().A.images.externalIntegrations.gmailIconPng,style:{width:18,height:"auto"}}),focused:!1,disabled:!0,buttonStyle:f.connectAccount,title:(0,Qe.jsx)(z().sA,{...yi.connectGmailAccountMobileLabel}),caption:(0,Qe.jsx)(li().CU,{caption:(0,Qe.jsx)(z().sA,{...yi.connectGmailAccountMobileCaption}),shouldWrapCaption:!0})})},S={key:"connect-gmail-account-item",action:async()=>{if(m.reset(),!c)return;const e=await fi(l,u,c,d);"success"===e.status&&a(e.externalAuthentication.id)},render:e=>(0,Qe.jsx)(rt().A,{...e,icon:(0,Qe.jsx)("img",{src:ci().A.images.externalIntegrations.gmailIconPng,style:{width:18,height:"auto"}}),focused:!1,buttonStyle:f.connectAccount,title:(0,Qe.jsx)(z().sA,{...yi.connectGmailAccountLabel}),caption:(0,Qe.jsx)(li().CU,{caption:(0,Qe.jsx)(z().sA,{...yi.connectGmailAccountCaption}),shouldWrapCaption:!0})})},b=[{key:"connectGmailAccount",items:[s().A.isMobile?x:S],render:e=>(0,Qe.jsx)(Rt().A,{...e,enableActionSheetTitle:!0})}];return(0,Qe.jsx)(nt().A,{buttonPopupStore:m,popupType:y,alignmentToOrigin:"end",placementToOrigin:"bottom",originGap:0,disabled:n,renderOrigin:e=>(0,Qe.jsx)(Tt().x,{...e,disabled:n,isCompact:!0,isError:p,hasActionRequired:!Boolean(t),dropdownButtonType:"dropdown",children:t?(0,Qe.jsx)(He().m,{renderTooltip:()=>i,disableTooltip:!p,render:e=>(0,Qe.jsx)("span",{...e,children:null==t?void 0:t.account_name})}):(0,Qe.jsx)(He().m,{renderTooltip:()=>(0,Qe.jsx)(z().sA,{...yi.gmailAccountMenuPickerHeaderInvalidAccountTooltip}),disableTooltip:!p,render:e=>(0,Qe.jsx)("span",{...e,children:(0,Qe.jsx)(z().sA,{...p?yi.gmailAccountMenuPickerHeaderInvalidAccount:yi.gmailAccountMenuPickerHeader})})})}),render:e=>(0,Qe.jsx)(_t().A,{...h,children:(0,Qe.jsx)(Bt().A,{type:Bt().O.Vertical,sections:0===o.length?b:v,initialFocus:0})})})}async function fi(e,t,o,n){const i=await pi().Jq({environment:e,integration:t,spaceId:o,from:n,preventRedirectToLastVisitedPage:(0,mi().dC)()});return h().Q.isFail(i)?{status:"failure"}:i.value.externalAuthentication?{externalAuthentication:i.value.externalAuthentication,status:"success"}:(await gi().refreshExternalIntegrationStore({environment:e}),{status:"re-auth"})}const vi=(0,z().YK)({toLabel:{defaultMessage:"To",id:"automations.SendGmailNotificationAction.toLabel"},ccLabel:{defaultMessage:"CC",id:"automations.SendGmailNotificationAction.ccLabel"},bccLabel:{defaultMessage:"BCC",id:"automations.SendGmailNotificationAction.bccLabel"},replyToLabel:{defaultMessage:"Send replies to",id:"automations.SendGmailNotificationAction.replyToLabel"},fromNameLabel:{defaultMessage:"Send with display name",id:"automations.SendGmailNotificationAction.fromNameLabel"},subjectLabel:{defaultMessage:"Subject",id:"automations.SendGmailNotificationAction.subjectLabel"},bodyLabel:{defaultMessage:"Message",id:"automations.SendGmailNotificationAction.bodyLabel"},gmailAccountPickerHidden:{defaultMessage:"Hidden",id:"automations.SendGmailNotificationAction.gmailAccountPickerHidden"}}),xi=["subject","body","fromName"],Si={cc:!1,bcc:!1,replyTo:!1,displayName:!1},bi={displayName:!1,replyTo:!1},Ai={cc:vi.ccLabel.defaultMessage,bcc:vi.bccLabel.defaultMessage,replyTo:vi.replyToLabel.defaultMessage,displayName:vi.fromNameLabel.defaultMessage};function Ci(e){var t,o,n,i,r,a,s,l,c,d,u,p,m,h,v;const x=(0,z().tz)(),{actionStore:S,currentGmailAuthentication:b,gmailAuthentications:A}=e,{automationStore:C,contextType:I}=(0,Re().q8)(),M=(0,Re().fi)(),{disabled:T,maybePersistedTransactionActions:w,suppressActionErrors:P}=(0,mt().b)(),B=(0,Sn().y)(C,I),R=Boolean(T),V=(0,g().getActionRegistryItem)("send_gmail_notification"),F=(0,xe().K8)((()=>S.getSpaceId()),[S]),L=(0,xe().K8)((()=>{var e,t,o,n;return{to:null==S||null===(e=S.getConfig())||void 0===e?void 0:e.to,cc:null==S||null===(t=S.getConfig())||void 0===t?void 0:t.cc,bcc:null==S||null===(o=S.getConfig())||void 0===o?void 0:o.bcc,reply_to:null==S||null===(n=S.getConfig())||void 0===n?void 0:n.reply_to}}),[S]),[O,K]=(0,ye.useState)(Si),[N,W]=(0,ye.useState)(bi),U=(0,ve().v3)();bn(Object.values(L).flatMap((e=>{var t;return(null==e||null===(t=e.value)||void 0===t?void 0:t.value)||[]})));const{actionId:H,currentFromName:Y,currentSubject:G,currentBody:q,externalBotId:$}=(0,xe().K8)((()=>{var e,t,o;return{currentFromName:null===(e=S.getConfig())||void 0===e?void 0:e.from_name,currentSubject:null===(t=S.getConfig())||void 0===t?void 0:t.email_subject,currentBody:null===(o=S.getConfig())||void 0===o?void 0:o.email_body,actionId:S.id,externalBotId:S.getConfigStore().getKeyStore("external_bot_id").getValue()}}),[S]);(0,no().l)((()=>{K((e=>{var t,o,n;return{...e,cc:Boolean(null==L||null===(t=L.cc)||void 0===t||null===(t=t.value)||void 0===t?void 0:t.value),bcc:Boolean(null==L||null===(o=L.bcc)||void 0===o||null===(o=o.value)||void 0===o?void 0:o.value),replyTo:Boolean(null==L||null===(n=L.reply_to)||void 0===n||null===(n=n.value)||void 0===n?void 0:n.value),displayName:Boolean(null==Y?void 0:Y.value)}}))}));const Q=(0,Mt().F)({actionId:H}),{value:X}=(0,ot().fJ)(D().T.formulas),Z=function(e,t){return(0,xe().K8)((()=>t&&e?y().oE(Object.entries(e.getSchema()).map((([e,t])=>{const o=new Set(["person","email"]),n=null==t?void 0:t.type;if(!n)return;return o.has(n)||"rollup"===n&&t.target_property_type&&o.has(t.target_property_type)?(0,j().ESw)({contextValueId:(0,yn().KI)(),name:t.name,property:e,valueSnapshot:"current"}):void 0}))):[]),[e,t])}(B,(0,ye.useMemo)((()=>{if(X)return Q.filter((e=>(null==e?void 0:e.kind)===k().FormulaContextValueKind.ContextValue)).find((e=>(null==e?void 0:e.id)===(0,yn().KI)()))}),[Q,X])),J=(0,xe().uB)(void 0,it().A),ee=(0,ye.useCallback)((()=>J.reset()),[J]),te=(0,ye.useMemo)((()=>(0,Qe.jsx)(At().z,{actionStore:S,closeMenu:ee})),[S,ee]),oe=(0,ye.useMemo)((()=>!P.includes(S.id)),[P,S]),ne=function(e){const{actionId:t,shouldShowError:o}=e,n={};return n.external_bot_id=(0,ge().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"external_bot_id"}),n.to=(0,ge().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"to"}),n.cc=(0,ge().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"cc"}),n.bcc=(0,ge().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"bcc"}),n.reply_to=(0,ge().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"reply_to"}),n.email_body=(0,ge().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"email_body"}),n.email_subject=(0,ge().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"email_subject"}),n}({actionId:S.id,shouldShowError:oe}),ie=(0,ge().useRequiresSubscriptionUpgradeError)({actionId:S.id,shouldShow:oe}),ae=Boolean(ie),se=(0,ye.useMemo)((()=>Object.values(ne).filter((e=>(0,f().O9)(e.errorMessage)))[0]),[ne]),le=(0,ye.useCallback)((e=>{const t=un().A.externalAuthentications.state.find((t=>t.integration_id===hn().eg&&t.id===e)),o=$!==(null==t?void 0:t.id);t&&o&&w.createAndCommit({perform:e=>{re().zv({data:{external_bot_id:t.id},store:S.getConfigStore(),transaction:e})},userAction:"SendGmailNotificationAction.setExternalBotId"})}),[S,$,w]);(0,xe().K8)((()=>{$||1===A.length&&le(A[0].id)}),[A,le,$]);const ce=(0,ye.useCallback)((e=>t=>{if(!t)return;if("formula"===t.type)return void w.createAndCommit({perform:o=>{re().zv({data:{[e]:{type:"formula",value:t}},store:S.getConfigStore(),transaction:o})},userAction:"SendGmailNotificationAction.setRecipient.formula"});const o=(0,j().RQ)(t.value).filter((e=>{const t=(0,j().Fbh)([e]);if(0===t.length)return!0;return!new(pn().L)(U,{table:_().oo,id:t[0]},{userId:t[0]}).getIsDeleted()}));w.createAndCommit({perform:t=>{re().zv({data:{[e]:{type:"formula",value:{type:"simple",value:o}}},store:S.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setRecipient.simple"}),(0,xt().UB)(U,{automationStore:C,automationActionStore:S})}),[S,w,U,C]),de=(0,ye.useCallback)((e=>{w.createAndCommit({perform:t=>{re().zv({data:{from_name:e},store:S.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setFromName"}),(0,xt().UB)(U,{automationStore:C,automationActionStore:S})}),[S,w,U,C]),ue=(0,ye.useCallback)((e=>{w.createAndCommit({perform:t=>{re().zv({data:{email_subject:e},store:S.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setSubject"}),(0,xt().UB)(U,{automationStore:C,automationActionStore:S})}),[S,w,U,C]),pe=(0,ye.useCallback)((e=>{w.createAndCommit({perform:t=>{re().zv({data:{email_body:e},store:S.getConfigStore(),transaction:t})},userAction:"SendGmailNotificationAction.setBody"}),(0,xt().UB)(U,{automationStore:C,automationActionStore:S})}),[S,w,U,C]),{onTextStoreSelect:me,onTextStoreUnselect:he}=(0,Wt().W)(S),fe=(0,xe().K8)((()=>{if(!X||!F)return{};const{createFormulaDataRequestSyncHandler:e}=X,t={subject:G,body:q,fromName:Y};return Object.fromEntries(xi.map((o=>{const n=t[o];return n?[o,(0,Jt().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:e(S.getRecordModel),spaceId:F,valueTypes:Q.slice(0),featureGates:(0,E().i)(),enableExistenceGuarantees:M},value:n})]:[o,""]})))}),[S.getRecordModel,G,q,Y,M,Q,X,F]),be=(0,ye.useCallback)(((e,t)=>{e.stopPropagation(),e.preventDefault(),K((e=>({...e,[t]:!0}))),"displayName"===t&&W((e=>({...e,displayName:!1})))}),[]),Ae=(0,ye.useCallback)((e=>{W((t=>({...t,[e]:!t[e]})))}),[]),ke=(0,ye.useCallback)((e=>{var t,o,n;return!("displayName"!==e||null==Y||!Y.value)||(!("cc"!==e||null==L||null===(t=L.cc)||void 0===t||null===(t=t.value)||void 0===t||!t.value)||(!("bcc"!==e||null==L||null===(o=L.bcc)||void 0===o||null===(o=o.value)||void 0===o||!o.value)||!("replyTo"!==e||null==L||null===(n=L.reply_to)||void 0===n||null===(n=n.value)||void 0===n||!n.value)))}),[Y,L]),je=(0,ye.useCallback)((async(e,t)=>{e.stopPropagation(),e.preventDefault();if(ke(t)){if(!(await(0,vn().bx)({fieldName:`"${Ai[t]}"`})))return}"displayName"===t&&de(void 0),"cc"!==t&&"bcc"!==t||ce(t)({type:"simple",value:void 0}),"replyTo"===t&&ce("reply_to")({type:"simple",value:void 0}),K((e=>({...e,[t]:!1})))}),[de,ke,ce]),Ie=(0,ye.useCallback)((()=>{(0,Ce().clear)({environment:U})}),[U]),we=(0,Se().IS)((()=>{var e;const t={color:Me().Tj.text.secondary,fontSize:xn().vQ,lineHeight:xn().G6,fontWeight:Te().Wy.regular};return{inputLabel:{...t},toInputLabel:{...t,...(0,f().O9)(null===(e=ne.to)||void 0===e?void 0:e.errorMessage)&&{color:Me().Tj.red.text.accentPrimary,fontWeight:Te().Wy.medium}},toggleableInputLabel:{...t,cursor:"pointer",padding:2,transform:"translateX(-2px)",display:"flex",width:"fit-content"},toggleableInputLabelHovered:{...t,cursor:"pointer",backgroundColor:Me().Tj.buttonHoveredBackground,transform:"translateX(-2px)",display:"flex",width:"fit-content",borderRadius:"4px",padding:2},messageInput:{width:"100%"},replyToInputContainer:{display:"flex",justifyContent:"space-between"},replyToInputField:{width:"100%",fontSize:xn().vQ},ccBccToggle:{padding:"3px 12px",color:Me().Tj.text.tertiary,borderRadius:"6px",marginInlineStart:8,alignSelf:"flex-start"},toggleFieldGridContainer:{display:"grid",gridTemplateRows:"auto auto",gridTemplateColumns:"1fr auto",alignItems:"center",columnGap:8,rowGap:6},toggleFieldGridLabel:{gridRow:"1",gridColumn:"1"},toggleFieldGridInput:{gridRow:"2",gridColumn:"1"},toggleFieldGridTrashIconButton:{gridRow:"2",gridColumn:"2",alignSelf:"flex-start",height:32,width:32},toggleFieldTrashIconButtonForTextInput:{gridRow:"1",gridColumn:"2",alignSelf:"flex-start",marginTop:26,height:32,width:32},trashIcon:{width:lt().Ev.default,height:lt().Ev.default}}}),[ne]);function Pe(e,t){return e||t?!e&&t?we.toggleableInputLabelHovered:we.inputLabel:we.toggleableInputLabel}if(!F)return null;const _e={collectionStore:B,limit:Ii,disabled:R,formulaTypecheckContextValues:Q,spaceId:F,pageProperties:Z};return(0,Qe.jsxs)(Ot().OT,{actionMenu:te,buttonPopupStore:J,disabled:R,actionId:S.id,canCollapse:!ae,hideDragHandle:ae,children:[(0,Qe.jsx)(Ot().h3,{actionId:S.id,actionRegistryItem:V,disabled:R,errorMessage:ie||(null==se?void 0:se.errorMessage),styles:{headerWrap:{paddingInlineEnd:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,Qe.jsx)(ki,{currentGmailAuthentication:b,gmailAuthentications:A,disabled:R,isError:ae,onGmailAccountChange:le,accountPickerErrorMessage:null===(t=ne.external_bot_id)||void 0===t?void 0:t.errorMessage})}),b?(0,Qe.jsx)(Ot().qt,{children:(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:16,children:[(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:6,children:[(0,Qe.jsx)("label",{style:we.toInputLabel,children:(0,Qe.jsx)(z().sA,{...vi.toLabel})}),(0,Qe.jsxs)("div",{className:"to-input-and-ccBcc-container",style:we.replyToInputContainer,children:[(0,Qe.jsx)(ji,{..._e,recipients:null==L||null===(o=L.to)||void 0===o?void 0:o.value,onChange:ce("to"),errorMessage:null===(n=ne.to)||void 0===n?void 0:n.errorMessage,style:we.replyToInputField}),O.cc&&O.bcc?void 0:(0,Qe.jsx)(mn().Ay,{onClick:e=>{O.cc||be(e,"cc"),O.bcc||be(e,"bcc")},style:we.ccBccToggle,children:O.cc||O.bcc?(0,Qe.jsx)(z().sA,{id:"automations.SendGmailNotificationAction.ccOrBccToggleLabel",defaultMessage:"{showCCLabel, select, true {CC} other {BCC}}",values:{showCCLabel:!O.cc&&O.bcc}}):(0,Qe.jsx)(z().sA,{id:"automations.SendGmailNotificationAction.ccAndBccToggleLabel",defaultMessage:"CC/BCC"})})]}),(0,f().O9)(null===(i=ne.to)||void 0===i?void 0:i.errorMessage)?(0,Qe.jsx)(gn().D,{colorPalette:"red",colorVariant:"accentPrimary",styleKey:"captionRegular",children:(0,Qe.jsx)(z().sA,{...null===(r=ne.to)||void 0===r?void 0:r.errorMessageDescriptor})}):void 0]}),O.cc?(0,Qe.jsx)(Kt().Y1,{direction:"vertical",gap:16,children:(0,Qe.jsxs)("div",{style:we.toggleFieldGridContainer,children:[(0,Qe.jsxs)("label",{style:we.inputLabel,children:[(0,Qe.jsx)(z().sA,{...vi.ccLabel}),(0,Qe.jsx)(Do().z,{})]}),(0,Qe.jsx)(ji,{..._e,recipients:null==L||null===(a=L.cc)||void 0===a?void 0:a.value,onChange:ce("cc"),errorMessage:null===(s=ne.cc)||void 0===s?void 0:s.errorMessage,style:we.toggleFieldGridInput}),(0,Qe.jsx)(Ue().A,{icon:co().trashIcon,ariaLabel:x.formatMessage({id:"automations.SendGmailNotificationAction.removeField",defaultMessage:"Remove Field"}),onClick:e=>je(e,"cc"),style:we.toggleFieldGridTrashIconButton,iconStyle:we.trashIcon})]})}):void 0,O.bcc?(0,Qe.jsx)(Kt().Y1,{direction:"vertical",gap:16,children:(0,Qe.jsxs)("div",{style:we.toggleFieldGridContainer,children:[(0,Qe.jsxs)("label",{style:{...we.inputLabel},children:[(0,Qe.jsx)(z().sA,{...vi.bccLabel}),(0,Qe.jsx)(Do().z,{})]}),(0,Qe.jsx)(ji,{..._e,recipients:null==L||null===(l=L.bcc)||void 0===l?void 0:l.value,onChange:ce("bcc"),errorMessage:null===(c=ne.bcc)||void 0===c?void 0:c.errorMessage,style:we.toggleFieldGridInput}),(0,Qe.jsx)(Ue().A,{icon:co().trashIcon,ariaLabel:x.formatMessage({id:"automations.SendGmailNotificationAction.removeField",defaultMessage:"Remove Field"}),onClick:e=>je(e,"bcc"),style:we.toggleFieldGridTrashIconButton,iconStyle:we.trashIcon})]})}):void 0,(0,Qe.jsx)(Do().M,{disabled:R,disableMobileActionBar:!1,disableNewLines:!0,disableStyleAnnotations:!0,formulaTypecheckContextValues:Q,onChange:ue,onTextStoreSelect:me,onTextStoreUnselect:he,onTextEsc:Ie,parentRecordStore:S,spaceId:F,style:we.messageInput,value:G,analyzedFormulaOutput:fe.subject,labelMessageDescriptor:vi.subjectLabel,errorMessageDescriptor:null===(d=ne.email_subject)||void 0===d?void 0:d.errorMessageDescriptor,shouldShowErrorStyles:(0,f().O9)(null===(u=ne.email_subject)||void 0===u?void 0:u.errorMessage)}),(0,Qe.jsx)(Do().M,{disabled:R,disableMobileActionBar:!1,formulaTypecheckContextValues:Q,onChange:pe,onTextStoreSelect:me,onTextStoreUnselect:he,onTextEsc:Ie,parentRecordStore:S,rows:4,spaceId:F,style:we.messageInput,value:q,analyzedFormulaOutput:fe.body,labelMessageDescriptor:vi.bodyLabel,errorMessageDescriptor:null===(p=ne.email_body)||void 0===p?void 0:p.errorMessageDescriptor,shouldShowErrorStyles:(0,f().O9)(null===(m=ne.email_body)||void 0===m?void 0:m.errorMessage)}),O.displayName?void 0:(0,Qe.jsx)("label",{children:(0,Qe.jsxs)("span",{onClick:e=>be(e,"displayName"),onMouseEnter:()=>Ae("displayName"),onMouseLeave:()=>Ae("displayName"),style:Pe(O.displayName,N.displayName),children:[(0,Qe.jsx)(z().sA,{...vi.fromNameLabel}),"..."]})}),O.displayName?(0,Qe.jsxs)("div",{style:{...we.toggleFieldGridContainer,rowGap:0},children:[(0,Qe.jsx)("div",{style:we.toggleFieldGridLabel,children:(0,Qe.jsx)(Do().M,{disabled:R,disableMobileActionBar:!1,formulaTypecheckContextValues:Q,disableNewLines:!0,disableStyleAnnotations:!0,onChange:de,onTextStoreSelect:me,onTextStoreUnselect:he,onTextEsc:Ie,parentRecordStore:S,rows:1,spaceId:F,value:Y,analyzedFormulaOutput:fe.fromName,labelMessageDescriptor:vi.fromNameLabel,isOptional:!0})}),(0,Qe.jsx)(Ue().A,{icon:co().trashIcon,ariaLabel:x.formatMessage({id:"automations.SendGmailNotificationAction.removeField",defaultMessage:"Remove Field"}),onClick:e=>je(e,"displayName"),style:we.toggleFieldTrashIconButtonForTextInput,iconStyle:we.trashIcon})]}):void 0,(0,Qe.jsxs)("div",{style:we.toggleFieldGridContainer,children:[(0,Qe.jsx)("label",{style:we.toggleFieldGridLabel,children:(0,Qe.jsxs)("span",{onClick:e=>be(e,"replyTo"),onMouseEnter:()=>Ae("replyTo"),onMouseLeave:()=>Ae("replyTo"),style:Pe(O.replyTo,N.replyTo),children:[(0,Qe.jsx)(z().sA,{...vi.replyToLabel}),O.replyTo?void 0:"...",O.replyTo?(0,Qe.jsx)(Do().z,{}):void 0]})}),O.replyTo?(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)(ji,{..._e,recipients:null==L||null===(h=L.reply_to)||void 0===h?void 0:h.value,onChange:ce("reply_to"),errorMessage:null===(v=ne.reply_to)||void 0===v?void 0:v.errorMessage,limit:1,style:we.toggleFieldGridInput}),(0,Qe.jsx)(Ue().A,{icon:co().trashIcon,ariaLabel:x.formatMessage({id:"automations.SendGmailNotificationAction.removeField",defaultMessage:"Remove Field"}),onClick:e=>je(e,"replyTo"),style:we.toggleFieldGridTrashIconButton,iconStyle:we.trashIcon})]}):void 0]})]})}):void 0]})}function ki(e){const{currentGmailAuthentication:t,gmailAuthentications:o,disabled:n,isError:i,onGmailAccountChange:r,accountPickerErrorMessage:a}=e,s=(0,Se().IS)((()=>({title:{display:"inline-flex",minWidth:50,flexWrap:"wrap",gap:6}})),[]),l=function(){const e=xn().Kw;return(0,Se().IS)((()=>({container:{alignItems:"center",display:"inline-flex",gap:2,minWidth:50,width:"100%"},lockIcon:{alignSelf:"center",height:"auto",width:e}})),[e])}();return i?(0,Qe.jsx)("div",{style:s.title,children:(0,Qe.jsx)(z().sA,{defaultMessage:"Send mail",id:"automations.SendGmailNotificationAction.header.titleError"})}):(0,Qe.jsx)("div",{style:s.title,children:(0,Qe.jsx)(z().sA,{defaultMessage:"Send mail from{gmailAccountPicker}",id:"automations.SendGmailNotificationAction.header.title",values:{gmailAccountPicker:n?(0,Qe.jsxs)("div",{style:l.container,children:[(0,Qe.jsx)(ze().I,{icon:fn().lockIcon}),(0,Qe.jsx)("span",{style:Te().RC,children:(0,Qe.jsx)(z().sA,{...vi.gmailAccountPickerHidden})})]}):(0,Qe.jsx)(hi,{currentGmailAuthentication:t,gmailAuthentications:o,disabled:n,onAccountChange:r,errorMessage:a})}})})}function ji(e){const{recipients:t,style:o,collectionStore:n,...i}=e,{automationStore:r}=(0,Re().q8)();return(0,Qe.jsx)("div",{style:o,children:(0,Qe.jsx)(ni,{currentValue:t,collectionStore:n,parentRecordStore:r,...i})})}const Ii=20;var Mi=()=>o(437607),Ti=()=>o(658160);const wi=(0,z().YK)({defaultMenuHeader:{defaultMessage:"Select people",id:"automationPersonPicker.defaultMenuHeaderMessage"},personValuePickerPlaceholder:{defaultMessage:"Select up to {maxSelected} people...",id:"automations.personPicker.buttonPlaceholder"}});function Pi(e){const{currentValue:t,collectionStore:o,disabled:n,onChange:i,formulaTypecheckContextValues:r,menuHeader:a,limit:s,errorMessage:l,parentRecordStore:c,spaceId:d,style:u}=e,p={type:"person_array"},m=(0,z().tz)(),g=o?{type:"collection",collectionStore:o,property:"person"}:{type:"empty"},y={menuType:Go().gu.Popup,header:(0,Qe.jsx)(Rt().A,{title:a?m.formatMessage(a):m.formatMessage(wi.defaultMenuHeader)})};return(0,Qe.jsx)(Ti().U,{allowedReturnTypes:Oo().Yy.person,formulaTypecheckContextValues:r,disabled:n,simpleFormulaContext:g,onChange:i,type:p,value:t,menuProps:y,placeholder:s?m.formatMessage(wi.personValuePickerPlaceholder,{maxSelected:s}):void 0,limit:s,errorMessage:l,parentRecordStore:c,spaceId:d,style:u})}var _i=()=>o(464004);const Bi=(0,z().YK)({property:{id:"automationAction.sendInAppNotification.targetType.property",defaultMessage:"Person property"},formula:{id:"automationAction.sendInAppNotification.targetType.formula",defaultMessage:"Specific people"},default:{id:"automations.targetPicker.targetTypePlaceholder",defaultMessage:"Select recipients"}});function Ri(e){const{disabled:t,errorMessage:o,selectedTargetType:n,onSelectedTargetTypeChange:i}=e,r=(0,xe().uB)(void 0,it().A),a=(0,De().j)(),s=(0,ye.useCallback)((e=>{e!==n&&(i(e),r.reset())}),[i,r,n]);return(0,Qe.jsx)(nt().A,{buttonPopupStore:r,popupType:a,alignmentToOrigin:"end",placementToOrigin:"bottom",originGap:0,disabled:t,renderOrigin:e=>(0,Qe.jsx)(Tt().x,{...e,disabled:t,isCompact:!0,isError:Boolean(o),hasActionRequired:!Boolean(n),dropdownButtonType:"dropdown",children:n?(0,Qe.jsx)(z().sA,{...Bi[n]}):(0,Qe.jsx)(z().sA,{...Bi.default})}),render:e=>(0,Qe.jsx)(Vi,{handleChange:s,selectedTargetType:n})})}function Vi(e){const{handleChange:t}=e,o=(0,Ft().e)(),n=[(0,ye.useMemo)((()=>({action:()=>null,key:"selectUsers",render:e=>(0,Qe.jsx)(rt().A,{...e,onClick:()=>t("formula"),title:(0,Qe.jsx)(z().sA,{...Bi.formula})})})),[t]),(0,ye.useMemo)((()=>({action:()=>null,key:"selectPersonProperty",render:e=>(0,Qe.jsx)(rt().A,{...e,onClick:()=>t("property"),title:(0,Qe.jsx)(z().sA,{...Bi.property})})})),[t])].filter(f().O9);if(0===n.length)return null;const i={items:n,key:"targetType",render:e=>(0,Qe.jsx)(Rt().A,{topBorder:!0,...e,enableActionSheetTitle:!0})};return(0,Qe.jsx)(_t().A,{...o,children:(0,Qe.jsx)(Bt().A,{type:Bt().O.Vertical,sections:[i],initialFocus:0})})}const Ei=(0,z().YK)({notificationMessageLabel:{defaultMessage:"Message",id:"automations.BaseModalAction.notificationMessageLabel"},personPropertyTargetTypeLabel:{defaultMessage:"Property",id:"automations.SendInAppNotificationAction.personPropertyTargetTypeLabel"},usersTargetTypeLabel:{defaultMessage:"People",id:"automations.SendInAppNotificationAction.usersTargetTypeLabel"},propertyPickerPlaceholder:{defaultMessage:"Select a property",id:"automations.SendInAppNotificationAction.propertyPickerPlaceholder"},personValuePickerMenuHeader:{defaultMessage:"Send notification to",id:"automations.personPicker.menuHeader"}});function Fi(e){const{noCollection:t,targetsErrorMessage:o,selectedTargetType:n,disabled:i,onTargetTypeChange:r}=e;return t?(0,Qe.jsx)(z().sA,{defaultMessage:"Send notification to specific people",id:"automations.SendInAppNotificationAction.header.titleButtonBlock",values:{placeholder:"specific people"}}):(0,Qe.jsx)(z().sA,{defaultMessage:"Send notification to{targetTypePicker}",id:"automations.SendInAppNotificationAction.header.title",values:{targetTypePicker:(0,Qe.jsx)(Ri,{onSelectedTargetTypeChange:r,disabled:i,errorMessage:o,selectedTargetType:n})}})}function Di(e){const{isError:t,selectedTargetType:o}=e,n=(0,Se().IS)((()=>({inputLabel:{color:t?Me().Tj.red.text.accentPrimary:Me().Tj.text.secondary,fontSize:xn().vQ,lineHeight:xn().G6,fontWeight:Te().Wy.regular}})),[t]),i=(0,ye.useMemo)((()=>{switch(o){case"property":return Ei.personPropertyTargetTypeLabel;case"formula":return Ei.usersTargetTypeLabel;default:(0,f().HB)(o)}}),[o]);return(0,Qe.jsx)("label",{style:n.inputLabel,children:(0,Qe.jsx)(z().sA,{...i})})}const Li=20;function Oi(e){const{collectionStore:t,currentProperties:o,currentTargetValue:n,disabled:i,errorMessage:r,formulaTypecheckContextValues:a,onTargetValueChange:s,parentRecordStore:l,spaceId:c}=e,d=n.type;switch(d){case"formula":return(0,Qe.jsx)(Pi,{collectionStore:t,currentValue:n.value,disabled:Boolean(i),onChange:e=>s({type:"formula",value:e}),parentRecordStore:l,formulaTypecheckContextValues:a,menuHeader:Ei.personValuePickerMenuHeader,limit:Li,errorMessage:r,spaceId:c,style:{width:"100%"}});case"property":return t?(0,Qe.jsx)(_i().l,{availablePropertyIds:o,currentValue:n.propertyId,collectionStore:t,onChange:e=>s({type:"property",propertyId:e}),disabled:Boolean(i),alreadyHaveProperties:Boolean(n.propertyId),placeholderMessage:Ei.propertyPickerPlaceholder,errorMessage:r}):null;default:(0,f().HB)(d)}}function Ki(e,t,o){if("formula"===t.type||!(0,f().O9)(t.value))return{type:"simple",value:void 0};const n=t.value.filter((t=>{if(!(0,j().qXl)(t))return!1;const n=(0,j().uPN)(t),i=(0,j().snh)(n);if(i){const t=(0,j().NcG)(i);return!new(pn().L)(e,{id:t,table:_().oo},{userId:t}).getIsDeleted()}const r=(0,j().SEY)(n);if(r){const e=(0,j().FHi)(r);if(!e)return!1;const t=(0,Mi().S4)({spacePermissionGroupId:e.groupId,spaceId:e.spaceId}),n=o.getRecordModel(t);return null==n?void 0:n.isAlive()}return(0,j().tVx)(n)}));return{type:"simple",value:(0,Jt().toSimpleFormulaArrayValue)((0,Jt().filterTextValueToSimpleFormulaValueTokens)(n))}}o(737550);var Ni=()=>o(249046),Wi=()=>o(841369),zi=()=>o(950566),Ui=()=>o(265060),Hi=()=>o(46494);const Yi=(0,z().YK)({oldVersionMessage:{id:"automations.sendWebhook.apiVersion.oldVersion",defaultMessage:"This action is using an old API version ({version})."},upgradeButton:{id:"automations.sendWebhook.apiVersion.upgrade",defaultMessage:"Upgrade to latest version"},versionHistory:{id:"automations.sendWebhook.apiVersion.versionHistory",defaultMessage:"View changelog"}});function Gi({currentVersion:e,onUpgrade:t,disabled:o}){const n=!e||e!==zi().h9,i=(0,Se().IS)((()=>({container:{backgroundColor:Me().Tj.yellow.background.secondary,padding:"8px 12px"},iconContainer:{height:20,width:20,display:"flex",alignItems:"center",justifyContent:"center"},content:{color:Me().Tj.yellow.text.secondary,display:"flex",flexDirection:"column",gap:8,width:"100%"},messageRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:8},actionsRow:{display:"flex",flexDirection:"row",alignItems:"center",gap:8},upgradeButton:{backgroundColor:"transparent",border:`1px solid ${Me().Tj.yellow.border.accentPrimary}`,borderRadius:4,color:Me().Tj.yellow.text.accentPrimary,fontWeight:500,cursor:o?"not-allowed":"pointer",padding:"4px 8px",opacity:o?.5:1},changelogLink:{color:Me().Tj.yellow.text.accentPrimary,textDecoration:"underline",cursor:"pointer"}})),[o]);if(!n)return null;const r=e??zi().NX[0];return(0,Qe.jsx)("div",{style:i.container,children:(0,Qe.jsxs)(Kt().Y1,{gap:8,direction:"horizontal",children:[(0,Qe.jsx)("div",{style:i.iconContainer,children:(0,Qe.jsx)(Ui().Q,{iconGroup:Hi().Z,variantName:"small",colorPalette:"yellow",colorVariant:"secondary"})}),(0,Qe.jsxs)("div",{style:i.content,children:[(0,Qe.jsx)("div",{style:i.messageRow,children:(0,Qe.jsx)(gn().D,{styleKey:"bodyMedium",children:(0,Qe.jsx)(z().sA,{...Yi.oldVersionMessage,values:{version:r}})})}),(0,Qe.jsxs)("div",{style:i.actionsRow,children:[(0,Qe.jsx)("a",{href:"https://developers.notion.com/page/changelog",target:"_blank",rel:"noopener noreferrer",style:i.changelogLink,children:(0,Qe.jsx)(gn().D,{styleKey:"bodyMedium",children:(0,Qe.jsx)(z().sA,{...Yi.versionHistory})})}),(0,Qe.jsx)("button",{onClick:t,disabled:o,style:i.upgradeButton,children:(0,Qe.jsx)(gn().D,{styleKey:"bodyMedium",children:(0,Qe.jsx)(z().sA,{...Yi.upgradeButton})})})]})]})]})})}var qi=()=>o(795727);const $i=(0,z().YK)({addCustomHeader:{defaultMessage:"Add custom header",id:"automations.BaseModalAction.addCustomHeader"},customHeaderKeyLabel:{defaultMessage:"Key",id:"automations.BaseModalAction.customHeaderKeyLabel"},customHeaderValueLabel:{defaultMessage:"Value",id:"automations.BaseModalAction.customHeaderValueLabel"},removeCustomHeaderAriaLabel:{defaultMessage:"Remove custom header",id:"automations.BaseModalAction.removeCustomHeaderAriaLabel"}});function Qi(e){const{actionStore:t}=e,o=(0,z().tz)(),n=mr(),{suppressActionErrors:i}=(0,mt().b)(),{typecheckResult:r}=(0,Re().q8)(),[a,s]=(0,ye.useState)(new Set),[l,c]=(0,ye.useState)((()=>new(qi().A))),d=(0,xe().K8)((()=>{if(!h().Q.isSuccess(r))return new(qi().A);const e=i.includes(t.id),o=r.value.actionValidationFailures[t.id]||[],n=new(qi().A);return o.forEach((t=>{if("empty_custom_header_field"===t.type){const[o,i,r]=t.key;n.set({id:i,field:r},!e&&!a.has(i)||(l.get({id:i,field:r})||!1))}})),n}),[r,i,t.id,l,a]),{maybePersistedTransactionActions:u}=(0,mt().b)(),p=(0,Se().IS)((()=>({customHeadersContainer:{display:"flex",flexDirection:"column",gap:12,marginTop:12},customHeaderInputsContainer:{display:"grid",gridTemplateRows:"auto auto",gridTemplateColumns:"1fr 1fr auto",alignItems:"center",columnGap:8,rowGap:4},customHeaderKeyLabel:{...n.inputLabel,gridRow:1,gridColumn:1},customHeaderValueLabel:{...n.inputLabel,gridRow:1,gridColumn:2},customHeaderKeyInput:{...n.input,gridRow:2,gridColumn:1},customHeaderValueInput:{...n.input,gridRow:2,gridColumn:2},customHeaderRemoveButton:{gridRow:2,gridColumn:3,width:32,height:32},customHeaderRemoveButtonIcon:{width:lt().Ev.default,height:lt().Ev.default},addCustomHeaderButton:{marginInlineStart:-8,marginTop:8}})),[n]),m=(0,xe().K8)((()=>t.getConfigStore().getKeyStore("customHeaders")),[t]),g=(0,xe().K8)((()=>(m.getValue()||[]).map((e=>({...e,id:e.id||(0,qt().Ay)()})))),[m]),y=(0,ye.useCallback)(((e,t)=>()=>{const o=new(qi().A)({from:l.entries()});o.set({id:e,field:t},!0),c(o)}),[l]),f=(0,ye.useCallback)(((e,t)=>o=>{const n=(m.getValue()||[]).map((n=>n.id===e?{...n,[t]:o}:n));u.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:e=>{re().KY({store:m,transaction:e,value:n})}})}),[m,u]),v=(0,ye.useCallback)((()=>{u.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:e=>{const t={id:(0,qt().Ay)(),key:"",value:""};re().KY({store:m,transaction:e,value:[...g,t]}),s((e=>{const o=new Set(e);return o.add(t.id),o}))}})}),[g,m,u]),x=(0,ye.useCallback)((e=>()=>{const t=g.filter((t=>t.id!==e));u.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:e=>{re().KY({store:m,transaction:e,value:t})}})}),[g,m,u]),S=g.length>0&&(0,Qe.jsx)("div",{style:p.customHeadersContainer,children:g.map((e=>(0,Qe.jsxs)("div",{style:p.customHeaderInputsContainer,children:[(0,Qe.jsx)("label",{style:p.customHeaderKeyLabel,children:(0,Qe.jsx)(z().sA,{...$i.customHeaderKeyLabel})}),(0,Qe.jsx)("label",{style:p.customHeaderValueLabel,children:(0,Qe.jsx)(z().sA,{...$i.customHeaderValueLabel})}),(0,Qe.jsx)("div",{}),(0,Qe.jsx)(Je().t,{style:p.customHeaderKeyInput,value:e.key,onChange:f(e.id,"key"),errorOutline:d.get({id:e.id,field:"key"}),onBlur:y(e.id,"key"),autoFocus:!e.key,maxlength:Wi().Sx}),(0,Qe.jsx)(Je().t,{style:p.customHeaderValueInput,value:e.value,onChange:f(e.id,"value"),errorOutline:d.get({id:e.id,field:"value"}),onBlur:y(e.id,"value"),maxlength:Wi().Sx}),(0,Qe.jsx)(Ue().A,{icon:co().trashIcon,ariaLabel:o.formatMessage($i.removeCustomHeaderAriaLabel),style:p.customHeaderRemoveButton,iconStyle:p.customHeaderRemoveButtonIcon,onClick:x(e.id)})]},e.id)))});return(0,Qe.jsxs)(Qe.Fragment,{children:[S,g.length<Wi().qu?(0,Qe.jsx)(Ni().Ye,{children:(0,Qe.jsx)(Xt().p,{colorPalette:"gray",onClick:v,style:p.addCustomHeaderButton,children:(0,Qe.jsx)(z().sA,{...$i.addCustomHeader})})}):void 0]})}var Xi=()=>o(552712),Zi=()=>o(721479),Ji=()=>o(148024),er=()=>o(232930);function tr(e){const t=(0,ve().v3)(),o=(0,z().tz)();return(0,Qe.jsx)(He().m,{renderTooltip:()=>(0,Qe.jsx)(z().sA,{defaultMessage:"Learn more",id:"webhookAction.helpButton.tooltip"}),render:e=>(0,Qe.jsx)(Xi().N,{...e,href:(0,er().x)("guides.webhookAction"),onClick:()=>Ji().FH(t,{from:"webhookAction"}),external:!0,children:(0,Qe.jsx)(Ue().A,{...e,ariaLabel:o.formatMessage({id:"webhookAction.helpButton.ariaLabel",defaultMessage:"Learn about webhook actions"}),icon:Zi().questionMarkCircleSmallIcon,iconStyle:{width:lt().Ev.sm,height:lt().Ev.sm}})})})}tr.displayName="SendWebhookActionHelpLink";var or=()=>o(713998),nr=()=>o(852424),ir=()=>o(488887);const rr=new Set(["title","text","relation","checkbox","number","person","file","url","email","phone_number","created_time","created_by","last_edited_time","last_edited_by","last_visited_time","formula","rollup","select","multi_select","date","status","auto_increment_id","location","verification","place"]);const ar=(0,z().YK)({selectAllPropertiesDescription:{defaultMessage:"New properties will not be included automatically",id:"automations.BaseModalAction.selectAllPropertiesDescription"},selectAllProperties:{defaultMessage:"Select all existing properties",id:"automations.BaseModalAction.selectAllProperties"},propertyPickerLabel:{defaultMessage:"Content",id:"automations.BaseModalAction.propertyPickerLabel"},propertyDisabledMissingPermissionTooltip:{defaultMessage:"This property references a database you dont have access to",id:"automations.SendWebhookActionPropertyPicker.propertyDisabledMissingPermissionTooltip"},propertyDisabledUnsupportedTypeTooltip:{defaultMessage:"This property type is not supported",id:"automations.SendWebhookActionPropertyPicker.propertyDisabledUnsupportedTypeTooltip"}});function sr(){return(0,Se().IS)((()=>({buttonMenuItemContent:{height:34,gap:6},buttonMenuItem:{borderRadius:4}})),[])}function lr({collectionStore:e,value:t,onChange:o}){const n=sr(),i=mr(),r=(0,xe().K8)((()=>e.getSchema()),[e]),s=(0,ye.useMemo)((()=>new Set("some"===t.type?t.some||[]:Object.keys(r))),[r,t]),l=function(e){const{value:t}=(0,ot().fJ)(D().T.formulas),{value:o}=(0,ot().fJ)(D().T.formulaPermissions),n=(0,ve().v3)(),i=(0,xe().K8)((()=>{if(!t)return;const o=(0,E().i)();return{allowedReturnTypes:[{type:"unknown"}],handleDataRequest:(0,M().MC)({collectionFeatureGates:o,experimentService:a().default,getRecordModel:e.getRecordModel,loadRecordModel:e.loadRecordModel,spaceIdCreator:n.idCreator.getSpaceIdCreatorSync(e.getSpaceId())}),restrictUnaccessibleProperties:"cross_space_and_read_permissions",spaceId:e.getSpaceId(),valueTypes:[],featureGates:o}}),[t,e,n]),[r]=(0,Ie().Yb)((async()=>{if(!t||!i||!o)return;const n=e.getSchema(),r=Object.keys(n),a=await(0,ne().lX)(r,3,(async t=>{const r=(0,or()._g)({schema:n,property:t});if(r)return rr.has(r.type)?await o.hasAccessToProperty({collectionPointer:e.pointer,collectionSchema:n,context:i,propertyId:t,hasAccessFn:o.hasAccessDefaultFn})?void 0:"missing_permission":"unsupported_property_type"})),s=new Map;return a.forEach(((e,t)=>{s.set(r[t],e)})),s.size>0?s:void 0}),[e,i,t,o]);return r}(e),c=(0,ye.useMemo)((()=>l.value||new Map),[l]),d=(0,ye.useMemo)((()=>new Set(Array.from(c.entries()).filter((([e,t])=>void 0===t)).map((([e])=>e)))),[c]),u=(0,ye.useMemo)((()=>"some"===t.type&&(0,ir()._)(s,d)),[t.type,s,d]),p=(0,ye.useRef)(null),m=(0,ye.useCallback)((e=>{s.has(e)?s.delete(e):s.add(e),o({type:"some",some:Array.from(s)})}),[s,o]),g=(0,Se().IS)((()=>({sectionMenuItem:{padding:8},propertyPickerContainer:{display:"flex",flexDirection:"column",border:`1px solid ${Me().Tj.border.secondaryTranslucent}`,borderRadius:8,maxHeight:212,overflowY:"auto",marginBottom:2},selectAllPropertiesButtonTitle:{display:"flex",alignItems:"center",gap:4},selectAllPropertiesCheckboxContainer:{height:34,width:30,display:"flex",alignItems:"center",justifyContent:"center",paddingInlineStart:4},selectAllPropertiesCheckbox:{cursor:"pointer"}})),[]),h=(0,ye.useCallback)((()=>{o(u?{type:"some",some:[]}:{type:"some",some:Array.from(d.values())})}),[u,o,d]);(0,ye.useEffect)((()=>{p.current&&(p.current.indeterminate=s.size>0&&!u)}),[u,s,t.type]);const f=Object.keys(r),v=(0,ye.useMemo)((()=>f.sort(((e,t)=>{const o=(0,or()._g)({schema:r,property:e}),n=(0,or()._g)({schema:r,property:t});if("title"===(null==o?void 0:o.type))return-1;if("title"===(null==n?void 0:n.type))return 1;const i=(null==o?void 0:o.name)||"",a=(null==n?void 0:n.name)||"";return i.localeCompare(a)}))),[f,r]);if(!c)return null;const x=(0,y().oE)(v.map((e=>{const t=(0,or()._g)({schema:r,property:e});if(!t)return null;return{key:e,render:o=>(0,Qe.jsx)(cr,{...o,propertySchema:t,selected:s.has(e),noAccessReason:c.get(e),buttonStyle:n.buttonMenuItem,style:n.buttonMenuItemContent}),action:()=>{m(e)}}}))),S=(0,y().oE)([{key:0,render:e=>(0,Qe.jsx)(Rt().A,{...e,style:g.sectionMenuItem}),items:[{key:0,render:e=>(0,Qe.jsx)(rt().A,{...e,style:n.buttonMenuItemContent,buttonStyle:n.buttonMenuItem,title:(0,Qe.jsxs)("div",{style:g.selectAllPropertiesButtonTitle,children:[(0,Qe.jsx)(z().sA,{...ar.selectAllProperties}),(0,Qe.jsx)(dr,{})]}),leftStyle:g.selectAllPropertiesCheckboxContainer,left:(0,Qe.jsx)("input",{type:"checkbox",readOnly:!0,checked:u,ref:p,style:g.selectAllPropertiesCheckbox})}),action:h}]},{key:1,render:e=>(0,Qe.jsx)(Rt().A,{topBorder:!0,style:g.sectionMenuItem,...e}),items:x}]);return(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)("label",{style:i.inputLabel,children:(0,Qe.jsx)(z().sA,{...ar.propertyPickerLabel})}),(0,Qe.jsx)("div",{style:g.propertyPickerContainer,children:(0,Qe.jsx)(Bt().A,{type:Bt().O.Vertical,sections:S,initialFocus:void 0,resetFocusOnMouseOut:!0})})]})}function cr(e){const{propertySchema:t,noAccessReason:o}=e,n=(0,Se().DP)(),{name:i,type:r,icon:a}=t,l=sr(),c=(0,Se().IS)((()=>({buttonMenuItemTitle:{color:o?Me().Tj.text.tertiary:Me().Tj.text.secondary},propertyIcon:{fill:o?Me().Tj.icon.tertiary:Me().Tj.icon.secondary,height:lt().Ev.sm,width:lt().Ev.sm,display:"flex",alignItems:"center",justifyContent:"center"},checkBoxInput:{cursor:o?void 0:"pointer"},checkboxContainer:{height:34,width:30,display:"flex",alignItems:"center",justifyContent:"center",paddingInlineStart:4}})),[o]),d=(0,Qe.jsx)(rt().A,{title:i,disabled:Boolean(o),style:l.buttonMenuItemContent,titleStyle:c.buttonMenuItemTitle,icon:(0,Qe.jsx)(nr().zB,{icon:a,type:r,size:s().A.isMobile?18:16,theme:n,style:c.propertyIcon}),left:(0,Qe.jsx)("div",{style:c.checkboxContainer,children:(0,Qe.jsx)("input",{type:"checkbox",readOnly:!0,checked:e.selected,disabled:Boolean(o),style:c.checkBoxInput})}),...e});return o?(0,Qe.jsx)(ur,{noAccessReason:o,children:d}):d}function dr(){return(0,Qe.jsx)(He().m,{renderTooltip:()=>(0,Qe.jsx)(z().sA,{...ar.selectAllPropertiesDescription}),render:e=>(0,Qe.jsx)("div",{...e,children:(0,Qe.jsx)(ze().I,{icon:Zi().questionMarkCircleSmallIcon,size:"sm",colorVariant:"secondary"})}),placement:"top"})}function ur(e){const{children:t,noAccessReason:o}=e;return(0,Qe.jsx)(He().m,{renderTooltip:()=>"missing_permission"===o?(0,Qe.jsx)(z().sA,{...ar.propertyDisabledMissingPermissionTooltip}):"unsupported_property_type"===o?(0,Qe.jsx)(z().sA,{...ar.propertyDisabledUnsupportedTypeTooltip}):void(0,f().HB)(o),originGap:0,render:e=>(0,Qe.jsx)("div",{...e,children:t}),placement:"left"})}const pr=(0,z().YK)({urlInputLabel:{defaultMessage:"URL",id:"automations.BaseModalAction.urlInputLabel"}});function mr(){return(0,Se().IS)((()=>({inputLabel:{color:Me().Tj.text.secondary,fontSize:xn().vQ},input:{backgroundColor:Me().Tj.background.primary,paddingTop:6,paddingBottom:6},helpText:{color:Me().Tj.text.secondary,fontSize:xn().Kw}})),[])}const gr=(0,z().YK)({actionTitle:{id:"automations.WorkerAction.title",defaultMessage:"Run worker automation"},selectWorker:{id:"automations.WorkerAction.selectWorker",defaultMessage:"Select worker"},selectAutomation:{id:"automations.WorkerAction.selectAutomation",defaultMessage:"Select automation"},workerLabel:{id:"automations.WorkerAction.workerLabel",defaultMessage:"Worker"},automationLabel:{id:"automations.WorkerAction.automationLabel",defaultMessage:"Automation"}});function yr(e){const{disabled:t,onChange:o,selectedWorker:n,workers:i}=e,r=(0,xe().uB)(void 0,it().A),a=(0,De().j)();return(0,Qe.jsx)(nt().A,{alignmentToOrigin:"center",buttonPopupStore:r,disabled:t,originGap:0,placementToOrigin:"bottom",popupType:a,renderOrigin:e=>(0,Qe.jsx)(Tt().x,{...e,disabled:t,isCompact:!0,dropdownButtonType:"dropdown",children:(null==n?void 0:n.name)??(0,Qe.jsx)(z().sA,{...gr.selectWorker})}),render:()=>(0,Qe.jsx)(hr,{onChange:o,buttonPopupStore:r,selectedWorker:n,workers:i})})}function hr(e){const{onChange:t,buttonPopupStore:o,selectedWorker:n,workers:i}=e,r=(0,Ft().e)({width:250}),a=i.map((e=>({key:e.id,render:t=>(0,Qe.jsx)(rt().A,{...t,isChecked:(null==n?void 0:n.id)===e.id,title:e.name}),action:()=>{t(e.id),o.reset()}})));return(0,Qe.jsx)(_t().A,{...r,children:(0,Qe.jsx)(Bt().A,{type:Bt().O.Vertical,sections:[{key:0,render:e=>(0,Qe.jsx)(Rt().A,{...e}),items:a}],initialFocus:0})})}function fr(e){const{disabled:t,onChange:o,selectedAutomation:n,automations:i}=e,r=(0,xe().uB)(void 0,it().A),a=(0,De().j)();return(0,Qe.jsx)(nt().A,{alignmentToOrigin:"center",buttonPopupStore:r,disabled:t,originGap:0,placementToOrigin:"bottom",popupType:a,renderOrigin:e=>(0,Qe.jsx)(Tt().x,{...e,disabled:t,isCompact:!0,dropdownButtonType:"dropdown",children:(null==n?void 0:n.capabilityTitle)??(0,Qe.jsx)(z().sA,{...gr.selectAutomation})}),render:()=>(0,Qe.jsx)(vr,{onChange:o,buttonPopupStore:r,selectedAutomation:n,automations:i})})}function vr(e){const{onChange:t,buttonPopupStore:o,selectedAutomation:n,automations:i}=e,r=(0,Ft().e)({width:300}),a=i.map((e=>({key:e.capabilityKey,render:t=>(0,Qe.jsx)(rt().A,{...t,isChecked:(null==n?void 0:n.capabilityKey)===e.capabilityKey,title:e.capabilityTitle}),action:()=>{t(e.capabilityKey),o.reset()}})));return(0,Qe.jsx)(_t().A,{...r,children:(0,Qe.jsx)(Bt().A,{type:Bt().O.Vertical,sections:[{key:0,render:e=>(0,Qe.jsx)(Rt().A,{...e}),items:a}],initialFocus:0})})}const xr={create_page:function(e){var t;const{actionStore:n}=e,i=(0,ve().v3)(),{automationStore:r}=(0,Re().q8)(),{disabled:a,maybePersistedTransactionActions:s,suppressActionErrors:l}=(0,mt().b)(),c=(0,g().getActionRegistryItem)("create_page"),[d,u]=(0,xe().K8)((()=>{const e=n.getConfig();return[null==e?void 0:e.properties,null==e?void 0:e.values]}),[n]),[p,m]=(0,xe().K8)((()=>{const e=n.getConfig();if(null!=e&&e.target)if("collection"===e.target.type){const t=X().m.createChildStore(n,e.target.collection);if(null!=t&&t.isDefined())return[t,e.target]}else if("private_space"===e.target.type)return[void 0,e.target];const t=n.getCollectionStore();return null!=t&&t.isDefined()?[t,{collection:t.getSpaceShardedPointer(),type:"collection"}]:[void 0,void 0]}),[n]),y=(0,xe().K8)((()=>bt(p).length>0),[p]),h=(0,xe().K8)((()=>{var e;return null===(e=n.getConfig())||void 0===e?void 0:e.template_page_id}),[n]),v=(0,ye.useMemo)((()=>({values:u??{},properties:d??[]})),[u,d]),x=(0,xe().uB)(void 0,it().A),S=(0,ye.useCallback)((()=>x.reset()),[x]),b=(0,ye.useMemo)((()=>(0,Qe.jsx)(At().z,{actionStore:n,closeMenu:S})),[n,S]),A=(0,xe().K8)((()=>(0,f().O9)(n.getConfigStore().getKeyStore("collection").getValue())),[n]),C=(0,ye.useCallback)((e=>{s.createAndCommit({perform:t=>{re().zv({data:{target:{type:"private_space"},collection:null,properties:["title"],template_page_id:null,values:{title:{value:e??{type:"simple",value:(0,j().x9d)("")},action:"replace"}}},store:n.getConfigStore(),transaction:t})},userAction:"CreatePageAction.setTarget"})}),[s,n]),k=(0,ye.useCallback)((e=>{"collection"===e.type?s.createAndCommit({perform:t=>{re().zv({data:{target:e,collection:e.collection,properties:["title"],template_page_id:null,values:null},store:n.getConfigStore(),transaction:t})},userAction:"CreatePageAction.setTarget"}):"private_space"===e.type&&C(),(0,xt().UB)(i,{automationStore:r,automationActionStore:n})}),[s,i,r,n,C]),I=(0,ye.useCallback)((e=>{const{properties:t,values:o}=v;let a=!1;if(e&&t&&1===t.length&&t.includes("title")){var l;const e=null==o?void 0:o.title;e&&null!==(l=e.value)&&void 0!==l&&l.value||(a=!0)}s.createAndCommit({perform:t=>{re().zv({store:n.getConfigStore(),data:{template_page_id:e??null,...a&&{properties:[]}},transaction:t})},userAction:"CreatePageAction.onTemplateChange"}),(0,xt().UB)(i,{automationStore:r,automationActionStore:n})}),[v,s,i,r,n]),M=(0,ye.useMemo)((()=>!l.includes(n.id)),[l,n]),{errorMessage:T,errorIcon:w}=(0,ge().useErrorComponentForAction)({actionId:n.id,errorKeys:["collection","config",n.id],shouldShow:M}),{errorMessage:P}=(0,ge().useErrorComponentForAction)({actionId:n.id,errorKey:"template",shouldShow:M}),_=Boolean(a),B=(0,ye.useCallback)((e=>{C(e)}),[C]),R=(0,xe().K8)((()=>n.getSpaceId()),[n]);return(0,Qe.jsxs)(Ot().OT,{actionId:n.id,actionMenu:b,buttonPopupStore:x,canCollapse:A,disabled:_,children:[(0,Qe.jsxs)(Ot().h3,{actionId:n.id,actionRegistryItem:c,disabled:_,errorMessage:T||P,styles:{headerWrap:{paddingInlineEnd:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:[(0,Qe.jsx)(Ht,{actionStore:n,disabled:_,errorMessage:T,errorIcon:w,onChange:k,value:m}),(0,f().O9)(p)&&(y||(0,f().O9)(h))?(0,Qe.jsx)(Yt,{collectionStore:p,disabled:_,errorMessage:P,onChange:I,value:h}):void 0]}),p&&"collection"===(null==m?void 0:m.type)?(0,Qe.jsx)(Ot().qt,{disabled:_,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,Qe.jsx)(o(95199).Ud,{actionStore:n,collectionStore:p,disabled:_,showSetPropertyActions:!1})}):void 0,"private_space"===(null==m?void 0:m.type)&&R?(0,Qe.jsx)(Ot().qt,{disabled:_,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,Qe.jsx)(Ut,{actionStore:n,disabled:_,onChange:B,spaceId:R,value:null===(t=v.values)||void 0===t||null===(t=t.title)||void 0===t?void 0:t.value})}):void 0]})},update_pages:o(686169).w,query_collection:function(){return null},open_page:function(e){const{actionStore:t}=e,{disabled:o,maybePersistedTransactionActions:n,suppressActionErrors:i}=(0,mt().b)(),r=(0,xe().uB)(void 0,it().A),a=(0,g().getActionRegistryItem)("open_page"),s=(0,xe().K8)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]),{contextType:l}=(0,Re().q8)(),c=(0,xe().K8)((()=>{if(!(0,Oo().Fx)(l))return;const e=t.getIndex();return(0,Oo().cQ)(e)?"allow":"disallow_with_message"}),[t,l]),d=(0,xe().K8)((()=>s&&"url"!==s.type),[s]),u=(0,ye.useMemo)((()=>({headerWrap:{paddingInlineEnd:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}})),[]),p=(0,ye.useCallback)((e=>{n.createAndCommit({perform:o=>{re().zv({store:t.getConfigStore(),data:{target:e},transaction:o})},userAction:"OpenPageAction.setTarget"})}),[n,t]),m=(0,ye.useCallback)((e=>{n.createAndCommit({perform:o=>{re().zv({store:t.getConfigStore(),data:{open_in:e},transaction:o})},userAction:"OpenPageAction.setPeekMode"})}),[n,t]),y=(0,ye.useCallback)((()=>r.reset()),[r]),h=(0,ye.useMemo)((()=>!i.includes(t.id)),[i,t]),{errorMessage:f}=(0,ge().useErrorComponentForAction)({actionId:t.id,shouldShow:h}),v=(0,ye.useMemo)((()=>(0,Qe.jsx)(At().z,{actionStore:t,closeMenu:y})),[t,y]),x=Boolean(o);return(0,Qe.jsx)(Ot().OT,{actionMenu:v,buttonPopupStore:r,actionId:t.id,canCollapse:!1,children:(0,Qe.jsxs)(Ot().h3,{actionId:t.id,actionRegistryItem:a,disabled:x,styles:u,children:[(0,Qe.jsx)(Wo,{actionStore:t,disabled:x,errorMessage:f,onChange:p,value:s,urlBehavior:c}),d?(0,Qe.jsx)(zo,{actionStore:t,disabled:x,onChange:m}):null]})})},duplicate_blocks:function(e){const{actionStore:t}=e,{disabled:o,editorPlacement:n}=(0,mt().b)(),i=(0,ve().v3)(),r=(0,Se().IS)((()=>({title:{display:"inline-flex",flexWrap:"wrap",gap:6,whiteSpace:"pre-wrap"}})),[]),a=(0,xe().K8)((()=>t.getBlockPointers()[0]),[t],{useDeepEqual:!0}),s=(0,xe().K8)((()=>function(e){const t=Object.values(Po).find((t=>t.key===e));return t??_o}(t.getInsertionPoint())),[t]),l=(0,ye.useCallback)((e=>function(e,t,o){ce().createAndCommit({userAction:"DuplicateBlocksAction.setInsertionPoint",environment:e,canUndo:!0,perform:e=>{re().zv({store:t.getConfigStore(),data:{insertion_point:o},transaction:e})}})}(i,t,e)),[t,i]),c=(0,xe().uB)(void 0,it().A),d=(0,ye.useCallback)((()=>c.reset()),[c]),u=(0,ye.useMemo)((()=>(0,Qe.jsx)(At().z,{actionStore:t,closeMenu:d})),[t,d]),p=(0,g().getActionRegistryItem)("duplicate_blocks"),m=Boolean(o);return(0,Qe.jsxs)(Ot().OT,{actionMenu:u,buttonPopupStore:c,disabled:m,actionId:t.id,canCollapse:!0,children:[(0,Qe.jsx)(Ot().h3,{actionId:t.id,actionRegistryItem:p,disabled:m,children:(0,Qe.jsx)("div",{style:r.title,children:(0,Qe.jsx)(z().sA,{...wo.title,values:{insertionPicker:(0,Qe.jsx)(Bo,{currentOption:s,disabled:m,onChange:l})}})})}),(0,Qe.jsx)(Ot().qt,{disabled:m,children:a?(0,Qe.jsx)(Vo,{actionStore:t,buttonPlacement:n,contentParentPointer:a,disabled:m}):null})]})},modal_confirmation:function(e){const{actionStore:t}=e,o=(0,ve().v3)(),{automationStore:n}=(0,Re().q8)(),i=(0,Re().fi)(),r=(0,z().tz)(),{disabled:a,maybePersistedTransactionActions:l}=(0,mt().b)(),c=Boolean(a),d=(0,g().getActionRegistryItem)("modal_confirmation"),[u,p]=(0,xe().K8)((()=>[t.id,t.getSpaceId()]),[t]),m=(0,Mt().F)({actionId:u}),y=(0,Se().IS)((()=>({input:{backgroundColor:Me().Tj.background.primary,paddingTop:6,paddingBottom:6},inputLabel:{color:Me().Tj.text.tertiary,fontSize:s().A.isMobile?14:12,lineHeight:1.3,fontWeight:Te().Wy.medium,display:"flex",alignItems:"center"}})),[]),h=(0,xe().uB)(void 0,it().A),f=(0,ye.useCallback)((()=>h.reset()),[h]),v=(0,ye.useMemo)((()=>(0,Qe.jsx)(At().z,{actionStore:t,closeMenu:f})),[t,f]),x=(0,xe().K8)((()=>t.getConfigStore().getKeyStore("text")),[t]),S=(0,xe().K8)((()=>x.getValue()),[x]),b=(0,xe().K8)((()=>{if(p)return(0,Jt().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:(0,Eo().createFormulaDataRequestSyncHandler)(t.getRecordModel),spaceId:p,valueTypes:m.slice(0),featureGates:(0,E().i)(),enableExistenceGuarantees:i},value:S})}),[p,t.getRecordModel,i,m,S]),A=(0,xe().K8)((()=>t.getConfigStore().getKeyStore("continue_button").getKeyStore("text")),[t]),C=(0,xe().K8)((()=>t.getConfigStore().getKeyStore("cancel_button").getKeyStore("text")),[t]),k=(0,ye.useCallback)((e=>{l.createAndCommit({userAction:"BaseModalAction.handleTextChange",perform:t=>{re().KY({store:x,value:e,transaction:t})}}),(0,xt().UB)(o,{automationStore:n,automationActionStore:t})}),[t,n,o,l,x]),j=(0,ye.useCallback)((()=>{(0,xt().UB)(o,{automationStore:n,automationActionStore:t})}),[t,n,o]),{onTextStoreSelect:I,onTextStoreUnselect:M}=(0,Wt().W)(t);return p&&b?(0,Qe.jsxs)(Ot().OT,{actionMenu:v,buttonPopupStore:h,disabled:c,actionId:t.id,canCollapse:!0,children:[(0,Qe.jsx)(Ot().h3,{actionId:t.id,actionRegistryItem:d,disabled:c,styles:{headerWrap:{paddingInlineEnd:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:(0,Qe.jsx)(z().sA,{...d.display.name})}),(0,Qe.jsx)(Ot().qt,{disabled:c,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:16,children:[(0,Qe.jsx)(Do().M,{disabled:c,disableMobileActionBar:!0,formulaTypecheckContextValues:m,onChange:k,onTextStoreSelect:I,onTextStoreUnselect:M,parentRecordStore:t,placeholder:r.formatMessage(Lo.confirmationMessageLabel),rows:4,spaceId:p,value:S,analyzedFormulaOutput:b,labelMessageDescriptor:Lo.confirmationMessageLabel}),(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:6,children:[(0,Qe.jsx)("label",{style:y.inputLabel,children:(0,Qe.jsx)(z().sA,{...Lo.continueButtonTextLabel})}),(0,Qe.jsx)(Je().W,{disabled:c,maxlength:Fo().Vx,onChange:j,style:y.input,store:A})]}),(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:6,children:[(0,Qe.jsx)("label",{style:y.inputLabel,children:(0,Qe.jsx)(z().sA,{...Lo.cancelButtonTextLabel})}),(0,Qe.jsx)(Je().W,{disabled:c,maxlength:Fo().Vx,onChange:j,style:y.input,store:C})]})]})})]}):null},slack_notification:o(500071).y9,send_in_app_notification:function(e){var t;const{actionStore:o}=e,{automationStore:n,contextType:i}=(0,Re().q8)(),r=(0,Re().fi)(),{disabled:a,maybePersistedTransactionActions:s,suppressActionErrors:l}=(0,mt().b)(),c=(0,Sn().y)(n,i),d=!(0,f().O9)(c),u=Boolean(a),p=(0,g().getActionRegistryItem)("send_in_app_notification"),m=(0,xe().K8)((()=>o.getSpaceId()),[o]),y=(0,xe().K8)((()=>null==c?void 0:c.getSpaceShardedPointer()),[c]),h=(0,xe().K8)((()=>{if(!c)return[];return(0,Oo().Ge)({collectionFormat:c.getFormat(),collectionSchema:c.getSchema(),spaceId:c.getSpaceId(),restrictCrossSpace:!0})}),[c]),v=(0,xe().K8)((()=>{var e;return null==o||null===(e=o.getConfig())||void 0===e?void 0:e.target}),[o]),x=(0,Mt().F)({actionId:o.id}),S=(0,ve().v3)();bn("formula"===(null==v?void 0:v.type)?null==v||null===(t=v.value)||void 0===t?void 0:t.value:void 0);const b=(0,xe().K8)((()=>{var e;return null===(e=o.getConfig())||void 0===e?void 0:e.notification_message}),[o]),A=(0,xe().K8)((()=>{if(m)return(0,Jt().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:(0,Eo().createFormulaDataRequestSyncHandler)(o.getRecordModel),spaceId:m,valueTypes:x.slice(0),featureGates:(0,E().i)(),enableExistenceGuarantees:r},value:b})}),[o.getRecordModel,b,r,x,m]),C=(0,xe().uB)(void 0,it().A),k=(0,ye.useCallback)((()=>C.reset()),[C]),j=(0,ye.useMemo)((()=>(0,Qe.jsx)(At().z,{actionStore:o,closeMenu:k})),[o,k]),I=(0,ye.useMemo)((()=>!l.includes(o.id)),[l,o]),{errorMessages:M,errorMessageDescriptors:T}=function(e){const{actionId:t,shouldShowError:o}=e,n={},i={};n.target=(0,ge().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"target"}).errorMessage;const r=(0,ge().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"notification_message"});return n.notification_message=r.errorMessage,i.notification_message=r.errorMessageDescriptor,n.collectionPointer=(0,ge().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"collectionPointer"}).errorMessage,n.propertyId=(0,ge().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"propertyId"}).errorMessage,n.formulaValue=(0,ge().useErrorComponentForAction)({actionId:t,shouldShow:o,errorKey:"formulaValue"}).errorMessage,{errorMessages:n,errorMessageDescriptors:i}}({actionId:o.id,shouldShowError:I}),w=(0,xe().K8)((()=>(0,f().O9)(o.getConfigStore().getKeyStore("target").getValue())),[o]),P=(0,ye.useCallback)((e=>{s.createAndCommit({perform:t=>{re().zv({data:{target:{type:e}},store:o.getConfigStore(),transaction:t})},userAction:"SendInAppNotificationAction.setTargetType"})}),[o,s]);(0,ye.useEffect)((()=>{!v&&d&&P("formula")}),[v,d,P]);const _=(0,ye.useCallback)((e=>{const t=e.value;if(!t)return;let i;"formula"===t.type?i={type:"formula",value:t}:"simple"===t.type?i={type:"formula",value:Ki(S,t,o)}:(0,f().HB)(t.type),s.createAndCommit({perform:e=>{re().zv({data:{target:{type:"formula",value:i.value}},store:o.getConfigStore(),transaction:e})},userAction:"SendInAppNotificationAction.setTarget"}),(0,xt().UB)(S,{automationStore:n,automationActionStore:o})}),[n,o,S,s]),B=(0,ye.useCallback)((e=>{s.createAndCommit({perform:t=>{re().zv({data:{target:{...e,collectionPointer:y}},store:o.getConfigStore(),transaction:t})},userAction:"SendInAppNotificationAction.setTarget"}),(0,xt().UB)(S,{automationStore:n,automationActionStore:o})}),[o,n,y,S,s]),R=(0,ye.useCallback)((e=>{switch(e.type){case"formula":return _(e);case"property":return B(e);default:(0,f().HB)(e)}}),[_,B]),V=(0,ye.useCallback)((e=>{s.createAndCommit({perform:t=>{re().zv({data:{notification_message:e},store:o.getConfigStore(),transaction:t})},userAction:"SendInAppNotificationAction.setNotificationMessage"}),(0,xt().UB)(S,{automationStore:n,automationActionStore:o})}),[o,n,S,s]),{onTextStoreSelect:F,onTextStoreUnselect:D}=(0,Wt().W)(o),L=(0,ye.useCallback)((()=>{(0,Ce().clear)({environment:S})}),[S]);return m&&A?(0,Qe.jsxs)(Ot().OT,{actionMenu:j,buttonPopupStore:C,disabled:u,actionId:o.id,canCollapse:w,children:[(0,Qe.jsx)(Ot().h3,{actionId:o.id,actionRegistryItem:p,disabled:a,styles:{headerWrap:{paddingInlineEnd:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,Qe.jsx)(Fi,{noCollection:d,targetsErrorMessage:M.target,selectedTargetType:null==v?void 0:v.type,onTargetTypeChange:P,disabled:Boolean(a)})}),v?(0,Qe.jsx)(Ot().qt,{children:(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:16,children:[(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:6,children:[(0,Qe.jsx)(Di,{selectedTargetType:v.type,isError:Boolean("property"===v.type?M.propertyId:M.formulaValue)}),(0,Qe.jsx)("div",{children:(0,Qe.jsx)(Oi,{collectionStore:c,disabled:Boolean(a),formulaTypecheckContextValues:x,currentTargetValue:v,currentProperties:h,onTargetValueChange:R,errorMessage:"property"===v.type?M.propertyId:M.formulaValue,parentRecordStore:o,spaceId:m})})]}),(0,Qe.jsx)(Do().M,{analyzedFormulaOutput:A,labelMessageDescriptor:Ei.notificationMessageLabel,disabled:u,disableMobileActionBar:!0,errorMessageDescriptor:T.notification_message,formulaTypecheckContextValues:x,onChange:V,onTextStoreSelect:F,onTextStoreUnselect:D,onTextEsc:L,parentRecordStore:o,rows:3,spaceId:m,value:b})]})}):void 0]}):null},send_gmail_notification:function(e){const{actionStore:t}=e,o=function(e){return(0,xe().K8)((()=>{const t=e.getConfigStore().getKeyStore("external_bot_id").getValue();if(!t)return;return un().A.externalAuthentications.state.find((e=>e.integration_id===hn().eg&&t===e.id))}),[e])}(t),n=(0,xe().K8)((()=>un().A.externalAuthentications.state.filter((e=>e.integration_id===hn().eg))),[]);return(0,Qe.jsx)(Ci,{actionStore:t,gmailAuthentications:n,currentGmailAuthentication:o,allGmailAuthentications:n})},define_variables:function(e){const{actionStore:t}=e,o=(0,ve().v3)(),n=(0,z().tz)(),{automationStore:i}=(0,Re().q8)(),{disabled:r,maybePersistedTransactionActions:a}=(0,mt().b)(),s=Boolean(r),l=(0,g().getActionRegistryItem)("define_variables"),c=(0,xe().K8)((()=>i.getActionStores()),[i]),d=(0,xe().K8)((()=>{const e=t.getConfigStore().getValue();return{values:(null==e?void 0:e.values)??{},variableIds:(null==e?void 0:e.variableIds)??[]}}),[t]),u=(0,xe().uB)(void 0,it().A),p=(0,ye.useCallback)((()=>u.reset()),[u]),m=(0,ye.useMemo)((()=>(0,Qe.jsx)(At().z,{actionStore:t,closeMenu:p})),[t,p]),y=(0,ye.useCallback)((()=>{a.createAndCommit({perform:e=>{!function(e){const{automationActionStore:t,automationActionStores:o,intl:n,transaction:i}=e,r=(0,qt().Ay)(),a={name:(0,$t().v)(o,n.formatMessage(Gt().xC)),value:{type:"simple",value:[[""]]}};re().zv({data:{[r]:a},store:t.getConfigStore().getKeyStore("values"),transaction:i}),ce().applyOperation({operation:{args:{id:r},command:"listAfter",path:["config","variableIds"],pointer:t.pointer},store:t,transaction:i})}({automationActionStore:t,automationActionStores:c,intl:n,transaction:e})},userAction:"DefineVariablesAction.addVariable"}),(0,xt().UB)(o,{automationStore:i,automationActionStore:t})}),[t,c,i,o,n,a]),h=(0,Se().IS)((()=>({headerWrap:{paddingInlineEnd:32},titleWrap:{whiteSpace:"pre-wrap"},footer:{display:"flex",overflow:"hidden"}})),[]);return(0,Qe.jsxs)(Ot().OT,{actionMenu:m,buttonPopupStore:u,disabled:s,actionId:t.id,canCollapse:!0,children:[(0,Qe.jsx)(Ot().h3,{actionId:t.id,actionRegistryItem:l,disabled:s,styles:{headerWrap:h.headerWrap,titleWrap:h.titleWrap},children:(0,Qe.jsx)(z().sA,{...l.display.name})}),(0,Qe.jsx)(Ot().qt,{disabled:s,children:(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:16,children:[d.variableIds.length>0?(0,Qe.jsx)(Kt().Y1,{direction:"vertical",gap:14,children:d.variableIds.map((e=>d.values[e]?(0,Qe.jsx)(bo,{actionStore:t,variableId:e},e):null))}):void 0,(0,Qe.jsx)("footer",{style:h.footer,children:(0,Qe.jsx)(Zt,{disabled:s,onClick:y})})]})})]})},http_request:function(e){const{actionStore:t}=e,{disabled:n,maybePersistedTransactionActions:i,suppressActionErrors:r}=(0,mt().b)(),{automationStore:a,contextType:s,typecheckResult:l}=(0,Re().q8)(),c=(0,Sn().y)(a,s),d=Boolean(n),u=(0,g().getActionRegistryItem)("http_request"),p=mr(),m=(0,xe().uB)(void 0,it().A),y=(0,ye.useCallback)((()=>m.reset()),[m]),f=(0,ye.useMemo)((()=>(0,Qe.jsx)(At().z,{actionStore:t,closeMenu:y})),[t,y]),v=(0,xe().K8)((()=>t.getConfigStore().getKeyStore("url")),[t]),x=(0,xe().K8)((()=>t.getConfigStore().getKeyStore("selectedProperties")),[t]),S=(0,xe().K8)((()=>x.getValue()||{type:"some",some:[]}),[x]),b=(0,ye.useCallback)((e=>{i.createAndCommit({userAction:"AutomationPlainTextInput.setValue",perform:t=>{re().KY({store:x,transaction:t,value:e})}})}),[x,i]),A=(0,xe().K8)((()=>t.getConfigStore().getKeyStore("apiVersion")),[t]),C=(0,xe().K8)((()=>A.getValue()),[A]),k=(0,ye.useCallback)((()=>{i.createAndCommit({userAction:"SendWebhookAction.upgradeApiVersion",perform:e=>{re().KY({store:A,transaction:e,value:zi().h9})}})}),[A,i]),j=(0,Se().IS)((()=>({divider:{marginBottom:8,marginTop:8},errorMessage:{color:Me().Tj.red.text.tertiary}})),[]),[I,M]=(0,ye.useState)(!1),T=(0,ye.useMemo)((()=>!r.includes(t.id)||I),[r,t.id,I]),w=(0,xe().K8)((()=>{if(!h().Q.isSuccess(l)||!T)return!1;return(l.value.actionValidationFailures[t.id]||[]).some((e=>"invalid_url"===e.type))}),[l,t,T]),P=(0,ge().useRequiresSubscriptionUpgradeError)({actionId:t.id,shouldShow:T}),_=Boolean(P),B=(0,ye.useCallback)((()=>{M(!0)}),[]);return(0,Qe.jsxs)(Ot().OT,{actionMenu:f,buttonPopupStore:m,disabled:d,actionId:t.id,canCollapse:!_,hideDragHandle:_,banner:(0,Qe.jsx)(Gi,{currentVersion:C,onUpgrade:k,disabled:d}),children:[(0,Qe.jsx)(Ot().h3,{actionId:t.id,actionRegistryItem:u,disabled:d,errorMessage:P,styles:{headerWrap:{paddingInlineEnd:32},titleWrap:{display:"inline-flex",flexWrap:"wrap",gap:"6px 0"}},children:(0,Qe.jsx)(z().sA,{...u.display.name})}),(0,Qe.jsxs)(Ot().qt,{disabled:d,styles:{bodyWrap:{display:"grid",gap:4,gridTemplateColumns:"1fr",minWidth:0}},children:[(0,Qe.jsx)("label",{style:p.inputLabel,children:(0,Qe.jsxs)(Ni().Ye,{alignItems:"center",gap:4,children:[(0,Qe.jsx)(z().sA,{...pr.urlInputLabel}),(0,Qe.jsx)(tr,{})]})}),(0,Qe.jsx)(Je().W,{disabled:d,style:p.input,store:v,errorOutline:w,onBlur:B,maxlength:Wi().i8}),w?(0,Qe.jsx)("div",{style:j.errorMessage,children:(0,Qe.jsx)(z().sA,{id:"SendWebhookAction.invalidUrl",defaultMessage:"Invalid URL"})}):void 0,(0,Qe.jsx)(Qi,{actionStore:t}),c?(0,Qe.jsxs)(Qe.Fragment,{children:[(0,Qe.jsx)(o(388926).A,{size:1,style:j.divider,colorVariant:"secondary"}),(0,Qe.jsx)(lr,{collectionStore:c,value:S,onChange:b})]}):void 0]})]})},publish_site:function(e){const{actionStore:t}=e,{disabled:o,maybePersistedTransactionActions:n,suppressActionErrors:i}=(0,mt().b)(),r=(0,xe().K8)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.target}),[t]),a=Boolean(o),s=(0,g().getActionRegistryItem)("publish_site"),l=(0,xe().uB)(void 0,it().A),c=(0,ye.useCallback)((e=>{"url"!==e.type&&n.createAndCommit({perform:o=>{re().zv({store:t.getConfigStore(),data:{target:e},transaction:o})},userAction:"PublishSiteAction.setTarget"})}),[n,t]),d=(0,ye.useCallback)((()=>l.reset()),[l]),u=(0,ye.useMemo)((()=>!i.includes(t.id)),[i,t]),{errorMessage:p}=(0,ge().useErrorComponentForAction)({actionId:t.id,shouldShow:u}),m=(0,ye.useMemo)((()=>(0,Qe.jsx)(At().z,{actionStore:t,closeMenu:d})),[t,d]);return(0,Qe.jsxs)(Ot().OT,{actionMenu:m,buttonPopupStore:l,disabled:a,actionId:t.id,canCollapse:!0,children:[(0,Qe.jsx)(Ot().h3,{actionId:t.id,actionRegistryItem:s,disabled:a,styles:{headerWrap:{paddingInlineEnd:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,Qe.jsx)(en,{actionStore:t,disabled:a,errorMessage:p,onTargetChange:c,value:r})}),(0,Qe.jsxs)(Ot().qt,{disabled:a,styles:{sectionBodyWrap:{display:"grid",gap:4,gridTemplateColumns:"1fr",minWidth:0}},children:[(0,Qe.jsx)(tn,{store:t}),(0,Qe.jsx)(on,{})]})]})},worker:function(e){const{actionStore:t}=e,{disabled:o,maybePersistedTransactionActions:n}=(0,mt().b)(),i=(0,g().getActionRegistryItem)("worker"),{capabilities:r,loading:a}=function(){const e=(0,ve().v3)(),[t,o]=(0,ye.useState)([]),[n,i]=(0,ye.useState)(!1),r=(0,xe().K8)((()=>{const{sidebarSpaceStore:e}=J().default.state;return null==e?void 0:e.id}),[]);return(0,ye.useEffect)((()=>{if(!r)return void o([]);let t=!1;return i(!0),(async()=>{try{const[n,i]=await Promise.all([e.api.callApi({environment:e,eventName:"getWorkers",data:{spaceId:r}}),e.api.callApi({environment:e,eventName:"listCapabilities",data:{spaceId:r,capabilityKind:"automation"}})]);if(t)return;if("success"===n.type&&"success"===i.type){const e=new Map(n.data.workers.map((e=>[e.workerId,e.name]))),t=i.data.capabilities.filter((e=>"automation"===e._tag)).map((t=>{var o,n;return{workerId:t.workerId,workerName:e.get(t.workerId)??t.workerId,capabilityKey:t.key,capabilityTitle:(null===(o=t.config)||void 0===o?void 0:o.title)??t.key,capabilityDescription:(null===(n=t.config)||void 0===n?void 0:n.description)??""}}));o(t)}}catch(n){}finally{t||i(!1)}})(),()=>{t=!0}}),[e,r]),{capabilities:t,loading:n}}(),s=(0,xe().K8)((()=>t.getConfig()),[t]),l=ye.useMemo((()=>{const e=new Map;for(const t of r)e.set(t.workerId,t.workerName);return Array.from(e.entries()).map((([e,t])=>({id:e,name:t})))}),[r]),c=ye.useMemo((()=>null!=s&&s.workerId?r.filter((e=>e.workerId===s.workerId)):[]),[r,null==s?void 0:s.workerId]),d=ye.useMemo((()=>l.find((e=>e.id===(null==s?void 0:s.workerId)))),[l,null==s?void 0:s.workerId]),u=ye.useMemo((()=>c.find((e=>e.capabilityKey===(null==s?void 0:s.capabilityKey)))),[c,null==s?void 0:s.capabilityKey]),p=(0,ye.useCallback)((e=>{n.createAndCommit({userAction:"WorkerAction.changeWorker",perform:o=>{re().zv({data:{workerId:e,capabilityKey:void 0},store:t.getConfigStore(),transaction:o})}})}),[t,n]),m=(0,ye.useCallback)((e=>{null!=s&&s.workerId&&n.createAndCommit({userAction:"WorkerAction.changeAutomation",perform:o=>{re().zv({data:{workerId:s.workerId,capabilityKey:e},store:t.getConfigStore(),transaction:o})}})}),[t,null==s?void 0:s.workerId,n]),y=o||a;return(0,Qe.jsxs)(Ot().OT,{actionId:t.id,canCollapse:!1,disabled:y,children:[(0,Qe.jsx)(Ot().h3,{actionId:t.id,actionRegistryItem:i,disabled:y,children:(0,Qe.jsx)(z().sA,{...gr.actionTitle})}),(0,Qe.jsx)(Ot().qt,{disabled:y,styles:{bodyWrap:{display:"grid",gap:16,gridTemplateColumns:"1fr",minWidth:0}},children:(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:16,children:[(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:6,children:[(0,Qe.jsx)("label",{style:{fontSize:14,lineHeight:"20px",fontWeight:500},children:(0,Qe.jsx)(z().sA,{...gr.workerLabel})}),(0,Qe.jsx)(yr,{disabled:y,onChange:p,selectedWorker:d,workers:l})]}),d?(0,Qe.jsxs)(Kt().Y1,{direction:"vertical",gap:6,children:[(0,Qe.jsx)("label",{style:{fontSize:14,lineHeight:"20px",fontWeight:500},children:(0,Qe.jsx)(z().sA,{...gr.automationLabel})}),(0,Qe.jsx)(fr,{disabled:y,onChange:m,selectedAutomation:u,automations:c})]}):void 0]})})]})}};var Sr=()=>o(142755);function br(e){const{children:t}=e,o=(0,Se().IS)((()=>({wrap:{color:Me().Tj.text.tertiary,fontSize:s().A.isMobile?14:12,lineHeight:1.3,fontWeight:Te().Wy.medium}})),[]);return(0,Qe.jsx)("div",{style:o.wrap,children:t})}const Ar=(0,z().YK)({newActionLabel:{defaultMessage:"New action",id:"AutomationActionSelectButton.actionSection.newAction"},addActionLabel:{defaultMessage:"Add action",id:"AutomationActionSelectButton.actionSection.addAction"},addActionAriaLabel:{id:"collectionSettings.editAutomationView.addAction.iconButton",defaultMessage:"Add action"},builderModalActionTitle:{defaultMessage:"Do",id:"builderModal.editAutomationView.actionSection.title"}});function Cr({isEditable:e}){const{automationStore:t}=(0,Re().q8)(),{disabled:o}=(0,mt().b)(),n=(0,ht().V)(),{contextType:i}=(0,Re().q8)(),r="button_block"===i||"button_property"===i,a=(0,xe().K8)((()=>t.getActionStores().map((e=>e.isDefined()&&e.hasConcern("display")?e:null)).filter(f().Pe)),[t]),s=a.length>0,l=(0,Se().IS)((()=>({section:{display:"flex",flexDirection:"column",gap:4,width:"100%",...r&&{marginTop:20}},header:{alignItems:"center",display:"flex",flexDirection:"row",height:24},list:{display:"flex",flexDirection:"column"}})),[r]),c=e&&n.length>0||!s;return(0,Qe.jsxs)("section",{style:l.section,children:[(0,Qe.jsx)("header",{style:l.header,children:(0,Qe.jsx)(br,{children:(0,Qe.jsx)(z().sA,{...Ar.builderModalActionTitle})})}),(0,Qe.jsxs)("div",{style:l.list,children:[e?(0,Qe.jsx)(jr,{actionStores:a}):(0,Qe.jsx)(kr,{actionStores:a}),c?(0,Qe.jsx)("footer",{children:(0,Qe.jsx)(Tr,{disabled:o,hasAnyActions:s,variant:"button"})}):void 0]})]})}function kr({actionStores:e}){const t=(0,tt().vV)();return(0,Qe.jsx)("div",{style:t.wrap,children:(0,Qe.jsx)("div",{style:t.list,children:e.map(((e,t)=>(0,Qe.jsx)("div",{className:tt().xB,children:(0,Qe.jsx)(pt().Y.Provider,{value:{stepNumber:t+1},children:(0,Qe.jsx)(Ir,{actionStore:e})})},e.id)))})})}function jr({actionStores:e}){const t=(0,ve().v3)(),{automationStore:o,contextType:n}=(0,Re().q8)(),{disabled:r,onActionDragStart:a,onActionDragEnd:s,maybePersistedTransactionActions:l}=(0,mt().b)(),c=(0,z().tz)(),{value:d}=(0,ot().fJ)(D().T.formulas),{value:u}=(0,ot().fJ)(ct().QV.automationTypecheck),p=(0,gt().n)(o),m=(0,yt().j)(),{automationActionMap:g,actionStoreIds:y}=(0,xe().K8)((()=>{const e=[],t=new Map;return o.getActionStores().forEach((o=>{o.isDefined()&&o.hasConcern("display")&&(e.push(o.id),t.set(o.id,o))})),{automationActionMap:t,actionStoreIds:e}}),[o]),h=(0,xe().uB)(void 0,ut().A),v=(0,ye.useCallback)((e=>{const t=e.state;if(t.willDrag){const e=g.get(t.draggingKey);(0,f().O9)(e)&&(0,f().O9)(a)&&a(e)}else t.willDrag||t.isDragging||null==s||s()}),[g,s,a]);(0,ye.useEffect)((()=>(h.addListener(v),()=>h.removeListener(v))),[g,h,v]);const x=(0,ye.useCallback)(((e,r)=>{d&&u&&l.createAndCommit({userAction:"AutomationButtonAction.moveAction",perform:a=>{i().reorderAutomationActions({environment:t,automationStore:o,automationTypecheckModule:u,contextType:n,formulasModule:d,intl:c,newActionIds:e,transaction:a,from:"drag_and_drop",movedActionId:r.key,isSubscribed:p,pageStore:m})}})}),[m,o,n,u,d,c,l,t,p]),S=(0,ye.useMemo)((()=>!r&&e.length>1),[r,e]),b=(0,ye.useCallback)(((e,t)=>{const o=g.get(e);return(0,f().O9)(o)?(0,Qe.jsx)(pt().Y.Provider,{value:{stepNumber:t+1},children:(0,Qe.jsx)(Ir,{actionStore:o})},o.id):null}),[g]);return e.length>0?(0,Qe.jsx)(Mr,{draggableListStore:h,hasDragging:S,keys:y,onDrop:x,renderKey:b}):null}function Ir(e){const{actionStore:t}=e,o=(0,xe().K8)((()=>t.getType()),[t]);if(!o)return null;const n=xr[o];return(0,Qe.jsx)(n,{actionStore:t})}function Mr(e){const{draggableListStore:t,hasDragging:o,keys:n,onDrop:i,renderKey:r}=e,a=(0,tt().vV)();return(0,Qe.jsx)("div",{style:a.wrap,children:(0,Qe.jsx)(dt().Ay,{childClassName:tt().xB,direction:"vertical",disabled:!o||s().A.isMobile,keys:n,onDrop:i,renderKey:r,store:t,style:a.list})})}function Tr(e){const{disabled:t,hasAnyActions:o,variant:n}=e,i=(0,De().j)(),r=(0,z().tz)(),a=(0,ye.useMemo)((()=>({availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"})),[]),s=(0,xe().uB)(void 0,it().A),l=(0,ye.useCallback)((()=>s.reset()),[s]),c=(0,Se().IS)((()=>({buttonWrap:{boxShadow:"initial",background:"transparent"},button:{color:Me().Tj.text.secondary,fill:Me().Tj.icon.secondary,margin:0,width:"100%"}})),[]),d=Boolean(t);return(0,Qe.jsx)(nt().A,{alignmentToOrigin:"start",buttonPopupStore:s,disabled:d,placementToOrigin:"bottom",popupType:i,render:()=>(0,Qe.jsx)(ft().A,{initialState:a,onClose:l}),renderOrigin:e=>"icon"===n?(0,Qe.jsx)(Ue().A,{...e,ariaLabel:r.formatMessage(Ar.addActionAriaLabel),disabled:d,disabledFeedback:d,icon:st().plusSmallIcon,iconStyle:{width:lt().Ev.sm,height:lt().Ev.sm}}):"button"===n?(0,Qe.jsx)(Sr().F,{...e,ariaLabel:r.formatMessage(Ar.addActionAriaLabel),disabled:d,icon:(0,Qe.jsx)(ze().I,{icon:st().plusSmallIcon,size:"sm"}),title:(0,Qe.jsx)(z().sA,{...o?Ar.addActionLabel:Ar.newActionLabel})}):(0,Qe.jsx)(rt().A,{...e,buttonStyle:c.button,disabled:d,disabledFeedback:d,focused:!1,icon:(0,Qe.jsx)(ze().I,{icon:at().plusIcon}),style:c.buttonWrap,title:o?(0,Qe.jsx)(z().sA,{id:"automations.addActionButton.nonEmpty.label",defaultMessage:"Add another step"}):(0,Qe.jsx)(z().sA,{id:"automations.addActionButton.empty.label",defaultMessage:"Add a step"})})})}function wr(e){const{areActionsEditable:t,areTriggersEditable:o,footer:n}=e,i=(0,Se().IS)((()=>({verticalRule:{background:Me().Tj.border.primary,borderRadius:2,height:56,marginBottom:5,marginInlineStart:0,marginTop:16,width:2},container:{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center",padding:s().A.isMobile?"0 16px":void 0}})),[]);return(0,Qe.jsxs)("div",{style:i.container,children:[(0,Qe.jsx)(tt().Kn,{isEditable:o}),(0,Qe.jsx)("div",{style:i.verticalRule}),(0,Qe.jsx)(Cr,{isEditable:t}),n]})}const Pr=(0,z().YK)({editButtonAriaLabel:{defaultMessage:"Edit button",id:"buttonBlock.button.editButtonAriaLabel"},buttonPlaceholder:{defaultMessage:"New button",id:"buttonBlock.button.placeholder"},buttonInsufficientPermissions:{defaultMessage:"You dont have permission to run this button",id:"buttonBlock.button.insufficientPermissions"},clickToEdit:{defaultMessage:"Click to edit button",id:"buttonBlock.button.clickToEdit"},done:{defaultMessage:"Done",id:"buttonBlock.button.done"},noEditError:{defaultMessage:"You dont have full access to edit this button",id:"buttonBlock.button.noEditError"},modalAriaLabel:{defaultMessage:"Edit button",id:"buttonBlock.button.modalAriaLabel"}});function _r(e){var t,o,n,i;const{buttonBlockStore:r,onDismiss:a}=e,s=(0,z().tz)(),l=(0,xe().K8)((()=>r.state.editing?r.state:void 0),[r]),c=(0,Se().IS)((()=>{var e;const t={borderRadius:6,border:`1px solid ${Me().Tj.border.secondaryTranslucent}`,maxWidth:600};return{popup:{width:400},editor:{background:Me().Tj.background.primary,..."inline"===(null==l||null===(e=l.placement)||void 0===e?void 0:e.type)?{...t,marginTop:6}:{}},modal:{...t,width:600}}}),[null==l||null===(t=l.placement)||void 0===t?void 0:t.type]),d=(0,De().j)({tabletBehavior:"slideUp"});return l&&l.placement?"popup"===(null===(o=l.placement)||void 0===o?void 0:o.type)?(0,Qe.jsx)(ke().zD,{open:!0,popupType:d,render:()=>(0,Qe.jsx)(Br,{...e,style:c.editor}),originRect:l.placement.originRect,style:c.popup,originGap:4,onDismiss:()=>{r.stopEditing(),null==a||a()}}):"inline"===(null===(n=l.placement)||void 0===n?void 0:n.type)?(0,Qe.jsx)(Br,{...e,style:c.editor}):"modal"===(null===(i=l.placement)||void 0===i?void 0:i.type)?(0,Qe.jsx)(Ae().a,{open:!0,onDismiss:()=>{r.stopEditing(),null==a||a()},render:()=>(0,Qe.jsx)(Br,{...e,style:c.modal}),ariaLabel:s.formatMessage(Pr.modalAriaLabel)}):void(0,f().HB)(l.placement):null}function Br(e){const{disabled:t,store:o,buttonBlockStore:n}=e,i=(0,ve().v3)(),[a,s]=(0,Pe().z)(),l=(0,Se().IS)((()=>({scroller:{maxHeight:"75vh"},container:{fontFamily:Te().Tf.sans},footerButton:{height:32,width:"100%"},upgradeMessageWrap:{margin:8},footerButtonWrap:{width:"100%",display:"flex",flexDirection:"column",paddingTop:24}})),[]),c=(0,xe().K8)((()=>o.getAutomationStore()),[o]),d=(0,xe().K8)((()=>null==c?void 0:c.getSpaceId()),[c]),u=(0,xe().K8)((()=>{var e;return null===(e=J().default.state.currentUserStore)||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.id}),[]),{maybePersistedAutomationStore:p,maybePersistedTransactionActions:m}=(0,Oe().t)({automationId:null==c?void 0:c.id,spaceId:d,defaultValue:void 0,persist:!0}),g=(0,Le().OW)({store:o,automationStore:p}),y=(0,xe().K8)((()=>{var e;return o.canEdit()&&"sufficient"===(null==g||null===(e=g.state)||void 0===e?void 0:e.editPermissionStatus)}),[o,g]),h=(0,xe().K8)((()=>n.state.editing?n.state.placement:void 0),[n]),f=(0,ye.useCallback)((e=>{(0,fe().SQ)(e,fe().y$.Click,(()=>{(0,Ce().clear)({environment:i}),(0,_e().I)({environment:i})}))}),[i]),v=(0,ye.useCallback)((()=>{var t;n.stopEditing(),null===(t=e.onDismiss)||void 0===t||t.call(e),(0,r().u)({environment:i,event:{eventName:"click_configure_button_done",eventProperties:{block_id:o.id,automation_id:null==p?void 0:p.id}}})}),[n,i,o,p,e]),x=(0,xe().K8)((()=>n.state.suppressErrorsForActionIds),[n]),S=(0,ye.useCallback)((e=>n.suppressErrorsForAction(e.id)),[n]),b=(0,Fe().c)(),A=(0,xe().K8)((()=>{var e;return null==g||null===(e=g.state)||void 0===e?void 0:e.typecheckResult}),[g]),[{value:C}]=(0,Ie().Yb)((async()=>!!A&&await(0,Ee().h)({environment:i,typecheckResult:A,automationStore:p})),[A,i,p]),k=C||!1,j=(0,Be()._)({name:"premium_automations",spaceId:d,userId:u}),I=(0,Ke().k)({from:"button_block_automation_header_message",upsell:null==j?void 0:j.upsell}),M=t||!y;return p?(0,Qe.jsx)("div",{ref:a,style:{...l.container,...e.style},onClick:f,children:(0,Qe.jsx)(Re().u,{automationStore:p,contextType:"button_block",children:(0,Qe.jsxs)(Ve().v,{value:{disabled:M,editorPlacement:h,editorWidth:s,maybePersistedTransactionActions:m,onActionAdded:S,suppressActionErrors:x,hideDragHandle:k,...b},defaultCollapseActions:k,children:[(0,Qe.jsx)(Rr,{blockStore:o,disabled:M}),(0,Qe.jsxs)(we().H,{style:l.scroller,type:be().A.Y,children:[k?(0,Qe.jsx)("div",{style:l.upgradeMessageWrap,children:(0,Qe.jsx)(et().j,{onUpsellClick:I})}):void 0,y?void 0:(0,Qe.jsx)("div",{style:l.upgradeMessageWrap,children:(0,Qe.jsx)(Ne().z,{children:(0,Qe.jsx)(z().sA,{...Pr.noEditError})})}),(0,Qe.jsx)("section",{style:{paddingBlock:8,paddingInline:8},children:(0,Qe.jsx)(wr,{areActionsEditable:!k,areTriggersEditable:!1,footer:(0,Qe.jsx)("div",{style:l.footerButtonWrap,children:(0,Qe.jsx)(je().A,{colorPalette:"blue",onClick:v,style:l.footerButton,children:(0,Qe.jsx)(z().sA,{...Pr.done})})})})})]})]})})}):null}function Rr(e){const t=(0,z().tz)(),{blockStore:o,disabled:n}=e,{automationStore:i}=(0,Re().q8)(),r=(0,ve().v3)(),a=(0,Se().IS)((()=>({wrap:{display:"flex",flexDirection:"column",padding:12,gap:6},inputs:{display:"flex",alignItems:"center",gap:6,borderBottom:`1px solid ${Me().Tj.border.secondary}`,paddingBottom:12},nameInputWrap:{flexGrow:"1"},nameInput:{background:"transparent",boxShadow:"none",padding:4}})),[]),s=(0,xe().K8)((()=>i.getNameStore()),[i]),l=(0,xe().K8)((()=>i.getIconStore()),[i]),c=(0,xe().K8)((()=>(null==s?void 0:s.getValue())??""),[s]),d=(0,xe().K8)((()=>null==l?void 0:l.getValue()),[l]),u=(0,ye.useCallback)(((e,t)=>{ce().createAndCommit({userAction:"ButtonBlock.updateProperty",environment:r,canUndo:!0,perform:o=>{re().zv({store:i.getPropertiesStore(),transaction:o,data:{[e]:t??null}})}})}),[i,r]),p=(0,ye.useCallback)((e=>u("icon",e)),[u]),m=(0,ye.useCallback)((e=>u("name",e)),[u]);return(0,Qe.jsx)(he().s,{allowSelectionWithin:!0,style:a.wrap,children:(0,Qe.jsxs)("div",{style:a.inputs,children:[(0,Qe.jsx)(Ze,{disabled:n,currentIcon:d,handleIconChange:p,store:o}),(0,Qe.jsx)(Je().t,{onChange:m,value:c,disabled:n,placeholder:t.formatMessage(Pr.buttonPlaceholder),wrapStyle:a.nameInputWrap,style:a.nameInput,format:"extra-large",autoFocus:!c})]})})}var Vr=()=>o(755877),Er=()=>o(578510),Fr=()=>o(591779),Dr=(o(16280),()=>o(792485)),Lr=()=>o(774628),Or=()=>o(45178);function Kr(e){var t;const{url:o,parentStore:n,onMouseEnter:i,onMouseLeave:r}=e,a=(0,ve().v3)(),s=(0,Dr().S)(),[l]=(0,Ie().Yb)((async()=>{var e,t;const n=await ie().callApi({eventName:"getDataForLinkMention",environment:a,data:{url:o,spaceId:(null==s||null===(e=s.spaceStore)||void 0===e?void 0:e.getSpaceId())??(null===(t=J().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getSpaceId()),source:"button_hover"}});if("success"===n.type){if("error"in n.data)throw new Error(`Error in iframely response: ${n.data.status} ${n.data.error}`);return n.data}throw n.error}),[a,o,null==s?void 0:s.spaceStore]);let c;return c=null!==(t=l.value)&&void 0!==t&&t.iframe?(0,Qe.jsx)(Lr().p,{hoverData:l.value,iframe_url:l.value.iframe,height:l.value.height,padding:l.value.padding,padding_top:l.value.padding_top,store:n,href:o,showEditButton:!1}):(0,Qe.jsx)(Or().R,{hoverData:l.value,href:o,showEditButton:!1,store:n,loading:"pending"===l.status}),(0,Qe.jsx)("div",{onMouseEnter:i,onMouseLeave:r,children:c})}function Nr(e){const{renderOrigin:t}=e;return s().A.isMobile?(0,Qe.jsx)(Qe.Fragment,{children:t()}):(0,Qe.jsx)(Wr,{...e})}function Wr(e){const{renderOrigin:t,urlToPreview:o,parentStore:n}=e,[i,r]=(0,ye.useState)(!1),a=(0,ye.useMemo)((()=>({onMouseEnter:()=>{r(!0)},onMouseLeave:()=>{r(!1)}})),[]),s=function(e){const{targetHovered:t}=e,[o,n]=(0,ye.useState)(!1),i=(0,Fr().lW)(t,400,Object.is),[r,a]=(0,ye.useState)(!1),s=r||!o&&i,l=(0,ye.useCallback)((()=>a(s)),[s]),c=(0,ye.useCallback)((()=>{a(!1)}),[]),d=(0,ye.useCallback)((()=>{c(),n(!0)}),[c]);return(0,ye.useEffect)((()=>{n(!1)}),[i]),(0,ye.useEffect)((()=>{const e=y().nF((()=>{d()}),200,{leading:!0});return(0,Vr().P)(window,"scroll",e,!0),()=>(0,Er().O)(window,"scroll",e,!0)}),[d]),{state:s,pinPopup:l,unpinPopup:c}}({targetHovered:i});return(0,Qe.jsx)(ke().zD,{disableMouseCapture:!0,preventCaptureEsc:!0,preventScaleTransition:!0,originGap:6,preventOpacityTransition:!0,open:s.state,popupType:ke().nl.Popup,alignmentToOrigin:"start",placementToOrigin:"bottom",render:()=>(0,Qe.jsx)(Kr,{url:o,parentStore:n,onMouseEnter:s.pinPopup,onMouseLeave:s.unpinPopup}),origin:t(a)})}},189814:(e,t,o)=>{o.d(t,{H:()=>i});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.69 3.37 12.61 9.25",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M2.32 3.375a.625.625 0 1 0 0 1.25h11.36a.625.625 0 0 0 0-1.25zm0 2.667a.625.625 0 1 0 0 1.25h11.36a.625.625 0 1 0 0-1.25zm0 2.666a.625.625 0 0 0 0 1.25h11.36a.625.625 0 0 0 0-1.25zm0 2.667a.625.625 0 1 0 0 1.25H8a.625.625 0 1 0 0-1.25z"})},i=(0,o(340498).wt)("textJustifyLeftSmall",n,"small")},194373:(e,t,o)=>{o.d(t,{_:()=>J});o(16280),o(944114),o(898992),o(354520),o(581454);var n=o(296540),i=()=>o(907258),r=()=>o(59226),a=()=>o(726637),s=()=>o(383036),l=()=>o(484714),c=()=>o(590526),d=()=>o(401497),u=()=>o(79926),p=()=>o(295633),m=()=>o(732810),g=()=>o(807449),y=()=>o(26697),h=()=>o(890492),f=()=>o(81068),v=()=>o(424400),x=()=>o(663639),S=()=>o(736847),b=()=>o(452004),A=()=>o(700500),C=()=>o(247331),k=()=>o(239381),j=()=>o(187174),I=()=>o(12193),M=()=>o(90907),T=()=>o(206267),w=()=>o(179034),P=()=>o(519831),_=()=>o(69708),B=()=>o(100622),R=()=>o(778078),V=()=>o(496603),E=()=>o(534177),F=()=>o(908201),D=()=>o(736767),L=()=>o(419357),O=()=>o(305390),K=()=>o(320865),N=()=>o(262509),W=()=>o(486674),z=()=>o(156988),U=()=>o(106628),H=()=>o(361330),Y=()=>o(546461),G=()=>o(781697),q=o(474848);const $=(0,_().YK)({searchInputPlaceholder:{defaultMessage:"Type to search",id:"automations.AutomationTargetPickerMenu.search.placeholder"},searchInputPlaceholderUrlsAllowed:{defaultMessage:"Type to search or paste a link",id:"automations.AutomationTargetPickerMenu.search.placeholderUrlsAllowed"}}),Q=5,X=20,Z=20;function J(e){const t=(0,G().e)({maxWidth:360,width:280}),o=(0,n.useMemo)((()=>T().JW()),[]);return(0,q.jsx)(h().A,{...t,children:(0,q.jsx)(oe,{...e,searchSessionId:o})})}const ee=Object.values(A().xd).filter((e=>e!==A().xd.form)),te=[A().xd.form];function oe(e){const{formulaTypecheckContextValues:t,includeThisPage:o,onChange:a,onClose:d,parentRecordStore:p,selectedTarget:h,skipCollections:A,skipPrivateSpace:T,skipPages:w,skipVariables:B,spaceId:L,urlBehavior:G}=e,$=(0,c().uB)(void 0,b().$),X=(0,Y().K4)(),J=(0,r().X)("automations_create_page_in_private_space"),oe=(0,c().K8)((()=>{if(B)return[];if((0,E().O9)(t)&&t.length>0){return Object.values(t).filter((e=>{if(!(0,k().o5)(e.type,{type:"block"}))return!1;if(!o&&"event"===(null==X?void 0:X.contextType)&&e.kind===C().FormulaContextValueKind.ContextValue){const t=(0,k().y5)(e.id);if("global"===t.source&&"button_page"===t.global)return!1}if("button_block"===(null==X?void 0:X.contextType)&&e.kind===C().FormulaContextValueKind.ContextValue){const t=(0,k().y5)(e.id);if("global"===t.source&&"button_page"===t.global&&"block"===e.type.type&&!e.type.collection)return!1}return!0}))}return[]}),[o,B,t,null==X?void 0:X.contextType],{useDeepEqual:!0}),[ce]=(0,n.useState)((()=>"url"===(null==h?void 0:h.type)?h.url:"")),[de,ue]=(0,n.useReducer)(re,{automationVariables:[],collectionQueryLimit:Q,pageQueryLimit:Q,formQueryLimit:Q,searchTerm:ce});(0,n.useEffect)((()=>{if(de.searchTerm){const e=(0,R().Ay)(de.searchTerm,oe,(e=>e.kind===C().FormulaContextValueKind.ContextValue?e.name:""));ue({type:"set_variables",variables:e})}else ue({type:"set_variables",variables:oe})}),[de.searchTerm,oe]);const pe=function(e){const{limit:t,searchTerm:o,skip:r}=e,a=(0,l().v3)(),s=(0,c().K8)((()=>(0,W().a)()),[]),d=(0,c().O$)(i().AppStoreSidebarSpaceStore),p=(0,F().Ks)(),m=(0,c().K8)((()=>null==p?void 0:p.collectionViewBlockStore()),[p]),[g,y]=(0,n.useReducer)(ae,{error:void 0,isLoading:Boolean(r),results:void 0,total:void 0}),h=(0,u().fJ)(U().T.searchActions),[f]=(0,j().Yb)((async()=>{if(r||!s||"resolved"!==h.status)return;const e=h.value,n=await e.searchCollectionsWithRecents({collectionViewBlockStore:m,environment:a,spaceStore:d,limit:t,parentStore:s,query:o,requireEditPermissions:!0,searchSessionId:void 0,peopleBlocksToInclude:"none"});return{results:n.results,total:n.total}}),[r,s,h.status,h.value,m,a,d,t,o],{debounce:H().tu});return(0,n.useEffect)((()=>{if("pending"===f.status||"idle"===f.status)y({type:"query_loadstart"});else if("resolved"===f.status){var e,t;y({results:null===(e=f.value)||void 0===e?void 0:e.results,total:null===(t=f.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===f.status?y({error:f.error,type:"query_error"}):(0,E().HB)(f)}),[f]),g}({limit:de.collectionQueryLimit,searchTerm:de.searchTerm,skip:A}),me=se({limit:de.pageQueryLimit,searchTerm:de.searchTerm,skip:w,spaceId:L,blockTypes:ee}),ge=se({limit:de.pageQueryLimit,searchTerm:de.searchTerm,skip:w,spaceId:L,blockTypes:te}),ye=(0,E().O9)(G)?(0,z().KX)(de.searchTerm):void 0,he=(0,n.useCallback)((e=>{h&&!V().n4(h,e)?a(e):h?d():a(e)}),[h,a,d]),fe=(0,n.useCallback)((e=>{const t=e.target.value;ue({searchTerm:t,type:"set_search_term"}),$.setState({focus:{section:0,indexLocal:0,indexGlobal:0,footerFocused:!1}})}),[$]),ve=(0,n.useCallback)((()=>{ue({queryLimit:de.collectionQueryLimit+Z,type:"set_collection_query_limit"})}),[de.collectionQueryLimit]),xe=(0,n.useCallback)((()=>{ue({queryLimit:de.pageQueryLimit+Z,type:"set_page_query_limit"})}),[de.pageQueryLimit]),Se=(0,n.useCallback)((()=>{ue({queryLimit:de.formQueryLimit+Z,type:"set_form_query_limit"})}),[de.formQueryLimit]),be="variable"===(null==h?void 0:h.type)?h.id:void 0,Ae="collection"===(null==h?void 0:h.type)?h.collection.id:void 0,Ce="page"===(null==h?void 0:h.type)?h.page.id:void 0,ke="private_space"===(null==h?void 0:h.type),je=[],Ie=function(e){const{automationVariables:t,onClick:o,selectedVariableId:n,parentRecordStore:i}=e,r=t.map((e=>{if(e.kind!==C().FormulaContextValueKind.ContextValue)throw new Error("Not implemented yet.");return{action:()=>o({id:e.id,type:"variable"}),key:e.id,render:t=>(0,q.jsx)(N().A,{contextValue:e,isChecked:e.id===n,menuArgs:t,parentRecordStore:i})}}));if(0===r.length)return;return{key:"variable_results",items:r,render:e=>(0,q.jsx)(S().A,{...e,title:(0,q.jsx)(_().sA,{defaultMessage:"From this automation",id:"automations.AutomationTargetPickerMenu.variablesSection.title"})})}}({automationVariables:de.automationVariables,onClick:he,selectedVariableId:be,parentRecordStore:p}),Me=function(e){const{onClick:t,isSelected:o,skip:n}=e;if(n)return;return{key:"private_space_results",items:[{action:()=>t({type:"private_space"}),key:"private_space",render:e=>(0,q.jsx)(f().A,{...e,icon:(0,q.jsx)(g().I,{colorVariant:"secondary",icon:M().lockIcon}),isChecked:o,title:(0,q.jsx)(_().sA,{id:"automations.AutomationTargetPickerMenu.privateSpace.title",defaultMessage:"Private"})})}],render:e=>(0,q.jsx)(S().A,{...e,title:(0,q.jsx)(_().sA,{defaultMessage:"Private",id:"automations.AutomationTargetPickerMenu.privateSpaceSection.title"})})}}({onClick:he,isSelected:ke,skip:T}),Te=function(e){const{collectionQueryResult:t,onCollectionMenuItemClick:o,onShowMoreItemClick:n,parentRecordStore:i,selectedCollectionId:r}=e;if(t.isLoading)return;let a=[];if(t.error)a.push({action:n,key:"show_more_collection_results",render:e=>(0,q.jsx)(D().A,{...e,caption:(0,q.jsx)(_().sA,{defaultMessage:"Sorry, something went wrong while searching for data sources.",id:"automations.AutomationTargetPickerMenu.errorDataSources.label"}),shouldWrapCaption:!0})});else{const e=t.results??[],s=e.length;a=e.map((e=>{const t=m().m.createChildStore(i,{table:P().Vl,id:e});return{action:()=>o({collection:t.getSpaceShardedPointer(),type:"collection"}),key:e,render:o=>(0,q.jsx)(O().A,{...o,isChecked:e===r,store:t})}}));const l=t.total??0,c=Math.max(0,l-s);c>0&&a.push({action:n,key:"show_more_collection_results",render:e=>(0,q.jsx)(ie,{...e,showMoreCount:c})})}if(0===a.length)return;return{key:"collection_results",items:a,render:e=>(0,q.jsx)(S().A,{...e,title:(0,q.jsx)(_().sA,{defaultMessage:"Data sources",id:"automations.AutomationTargetPickerMenu.dataSourcesSection.title"})})}}({collectionQueryResult:pe,onCollectionMenuItemClick:he,onShowMoreItemClick:ve,parentRecordStore:p,selectedCollectionId:Ae}),we=le({type:"page",onPageMenuItemClick:he,onShowMoreItemClick:xe,queryResult:me,parentRecordStore:p,selectedPageId:Ce}),Pe=le({type:"form",onPageMenuItemClick:he,onShowMoreItemClick:Se,queryResult:ge,parentRecordStore:p,selectedPageId:Ce}),_e=function(e){const{urlResult:t,urlBehavior:o,onMenuItemClick:n,isPagesSectionEmpty:i}=e;if(!t||!o)return;const r=t.type;switch(r){case"notion":if(!i)return;case"web":case"other":const e=[],a={title:t.url,icon:(0,q.jsx)(g().I,{icon:I().globeIcon})};return"allow"===o?e.push({action:()=>{n({type:"url",url:t.url})},key:"url",render:e=>(0,q.jsx)(f().A,{...e,...a})}):"disallow_with_message"===o?e.push({action:()=>{},key:"url",render:e=>(0,q.jsx)(y().m,{placement:"right",render:t=>(0,q.jsx)(f().A,{...(0,s().A)(t,e),disabled:!0,disabledFeedback:!0,...a}),renderTooltip:()=>(0,q.jsx)(_().sA,{defaultMessage:"Linking to a URL is only allowed if it is the first action in an automation.",id:"automations.AutomationTargetPickerMenu.urlSection.disabledMessage"})})}):(0,E().HB)(o),{key:"url_results",items:e,render:e=>(0,q.jsx)(S().A,{...e,title:(0,q.jsx)(_().sA,{defaultMessage:"Link",id:"automations.AutomationTargetPickerMenu.urlSection.sectionTitle"})})};default:(0,E().HB)(r)}}({urlResult:ye,urlBehavior:G,onMenuItemClick:he,isPagesSectionEmpty:void 0===we}),Be=_e&&ye&&("web"===ye.type||"other"===ye.type);Be&&je.push(_e),Ie&&je.push(Ie),Te&&je.push(Te),J&&Me&&je.push(Me),we&&je.push(we),Pe&&je.push(Pe),_e&&!Be&&je.push(_e);const Re=pe.isLoading||me.isLoading||ge.isLoading;let Ve;if(je.length>0)Ve=(0,q.jsx)(x().A,{initialFocus:0,sections:je,store:$,type:x().O.Vertical});else if(Re){const e=Q+2;Ve=(0,q.jsxs)(S().A,{children:[(0,q.jsx)(K().A,{}),[...Array(e)].map(((e,t)=>(0,q.jsx)(v().Ay,{},t)))]})}else Ve=(0,q.jsx)(D().A,{caption:(0,q.jsx)(_().sA,{defaultMessage:"No results",id:"automations.AutomationTargetPickerMenu.noResults.label"})});return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(ne,{onChange:fe,value:de.searchTerm,urlsAllowed:"allow"===G}),Ve]})}function ne(e){const{onChange:t,value:o,urlsAllowed:n}=e,i=(0,_().tz)(),r=(0,d().IS)((()=>({section:{paddingBlockStart:0,marginTop:12}})),[]);return(0,q.jsx)(S().A,{style:r.section,children:(0,q.jsx)(L().Ay,{focusInitial:!a().A.isMobile||void 0,onChange:t,placeholder:i.formatMessage(n?$.searchInputPlaceholderUrlsAllowed:$.searchInputPlaceholder),showClearButton:!0,value:o??""})})}const ie=(0,n.forwardRef)((function(e,t){const{showMoreCount:n}=e,i=(0,d().IS)((()=>({showMoreButton:{color:B().Tj.text.secondary,fill:B().Tj.icon.secondary}})),[]);return(0,q.jsx)(f().A,{...e,icon:(0,q.jsx)(g().I,{icon:o(589407).ellipsisIcon}),ref:t,style:i.showMoreButton,title:(0,q.jsx)(_().sA,{defaultMessage:"Show {showMore} more",id:"automations.AutomationTargetPickerMenu.showMore.label",values:{showMore:Math.min(n,Z)}})})}));function re(e,t){if("set_variables"===t.type)return{...e,automationVariables:t.variables.slice(0)};if("set_search_term"===t.type){const o=t.searchTerm?X:Q;return{...e,collectionQueryLimit:o,pageQueryLimit:o,searchTerm:t.searchTerm}}if("set_collection_query_limit"===t.type){if(e.collectionQueryLimit!==t.queryLimit)return{...e,collectionQueryLimit:t.queryLimit}}else if("set_page_query_limit"===t.type){if(e.pageQueryLimit!==t.queryLimit)return{...e,pageQueryLimit:t.queryLimit}}else if("set_form_query_limit"===t.type){if(e.formQueryLimit!==t.queryLimit)return{...e,formQueryLimit:t.queryLimit}}else(0,E().HB)(t);return e}function ae(e,t){if("query_loadstart"===t.type){if(!e.isLoading)return{...e,isLoading:!0}}else{if("query_finish"===t.type)return{...e,error:void 0,isLoading:!1,results:t.results,total:t.total};if("query_error"===t.type)return{...e,error:t.error,isLoading:!1,results:void 0,total:void 0};(0,E().HB)(t)}return e}function se(e){const{limit:t,searchTerm:o,skip:r,spaceId:a,blockTypes:s}=e,d=(0,l().v3)(),u=(0,c().O$)(i().AppStoreSidebarSpaceStore),[p,m]=(0,n.useReducer)(ae,{error:void 0,isLoading:Boolean(r),results:void 0,total:void 0}),[g]=(0,j().Yb)((async()=>{if(r||!a||!u)return;const e=await U().T.searchActions.load(),n=await e.searchPagesInSpace({boostRecentlyViewedPages:!0,environment:d,excludeTemplates:!0,limit:t,query:o,requireEditPermissions:!1,source:"automation_page_picker",spaceId:a,filterOverrides:{blockTypes:s},spaceStore:u,peopleBlocksToInclude:"none"});return{results:n.results.map((e=>e.id)),total:n.total}}),[s,d,t,o,r,a,u],{debounce:H().tu});return(0,n.useEffect)((()=>{if("pending"===g.status||"idle"===g.status)m({type:"query_loadstart"});else if("resolved"===g.status){var e,t;m({results:null===(e=g.value)||void 0===e?void 0:e.results,total:null===(t=g.value)||void 0===t?void 0:t.total,type:"query_finish"})}else"rejected"===g.status?m({error:g.error,type:"query_error"}):(0,E().HB)(g)}),[g]),p}function le(e){const{type:t,queryResult:o,onPageMenuItemClick:n,onShowMoreItemClick:i,selectedPageId:r,parentRecordStore:a}=e;if(o.isLoading)return;const s=[];if(o.error)s.push({action:i,key:"show_more_page_results",render:e=>(0,q.jsx)(D().A,{...e,caption:(0,q.jsx)(_().sA,{defaultMessage:"Sorry, something went wrong while searching for pages.",id:"automations.AutomationTargetPickerMenu.errorPages.label"}),shouldWrapCaption:!0})});else{const e=(o.results??[]).length;for(const i of o.results??[]){const e=p().B.createChildStore(a,{table:w().ev,id:i}),t={key:i,render:t=>(0,q.jsx)(O().A,{...t,isChecked:i===r,store:e}),action:()=>n({page:e.getSpaceShardedPointer(),type:"page"})};s.push(t)}const t=o.total??0,l=Math.max(0,t-e);l>0&&s.push({action:i,key:"show_more_page_results",render:e=>(0,q.jsx)(ie,{...e,showMoreCount:l})})}return 0!==s.length?{key:"page"===t?"page_results":"form_results",items:s,render:e=>(0,q.jsx)(S().A,{...e,title:"page"===t?(0,q.jsx)(_().sA,{defaultMessage:"Pages",id:"automations.AutomationTargetPickerMenu.pagesSection.title"}):(0,q.jsx)(_().sA,{defaultMessage:"Forms",id:"automations.AutomationTargetPickerMenu.formsSection.title"})})}:void 0}},274652:(e,t,o)=>{o.d(t,{o:()=>a});var n=o(296540),i=()=>o(100622),r=o(474848);const a=n.forwardRef((function({color:e="primary",...t},n){const a=(0,o(401497).IS)((()=>{const o="blue"===e?i().oZ.blue:"secondary"===e?i().Tj.text.secondary:i().Tj.text.primary;return{title:{color:o,fill:o},icon:{fill:"blue"===e?i().oZ.blue:void 0},buttonMenuItem:{...t.style,...t.disabled?{cursor:"not-allowed"}:{}}}}),[t.disabled,e,t.style]),s="blue"!==e?e:void 0;return(0,r.jsx)(o(81068).A,{ref:n,...t,title:(0,r.jsx)("div",{style:a.title,children:t.title}),icon:(0,r.jsx)(o(807449).I,{icon:o(617668).plusIcon,style:a.icon,colorVariant:s}),style:a.buttonMenuItem})}))},276936:(e,t,o)=>{o.d(t,{h:()=>a});o(898992),o(737550);var n=()=>o(973647),i=()=>o(534177),r=()=>o(527871);async function a(e){const{environment:t,typecheckResult:o,automationStore:a}=e,s=null==a?void 0:a.getTriggerType();if((0,i().O9)(s)){if(!(await(0,r().V)({triggerType:s,environment:t,automationStore:a,spaceId:null==a?void 0:a.pointer.spaceId})))return!0}return!n().Q.isFail(o)&&Object.values(o.value.actionValidationFailures).some((e=>null==e?void 0:e.some((e=>"requires_subscription_upgrade"===e.type))))}},281844:(e,t,o)=>{o.d(t,{v:()=>i});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"4.62 1.77 10.76 15.98",svg:(0,o(474848).jsx)("path",{d:"M12.043 2.444a.625.625 0 0 0-1.13-.41l-6.17 8.55a.625.625 0 0 0 .507.99h3.098l-.401 5.5a.625.625 0 0 0 1.13.412l6.18-8.54a.625.625 0 0 0-.507-.991h-3.099z"})},i=(0,o(340498).wt)("lightningFill",n,"fill")},284489:(e,t,o)=>{o.d(t,{k:()=>l});var n=o(296540),i=()=>o(484714),r=()=>o(792485),a=()=>o(876338),s=()=>o(991249);function l({from:e,onClose:t,upsell:o}){const l=(0,i().v3)(),c=(0,r().S)();return(0,n.useCallback)((()=>{t&&t(),o&&s().K(l,{from:e,upsell:o,spaceStore:(0,a().$)(c)})}),[t,o,l,e,c])}},288739:(e,t,o)=>{o.d(t,{M:()=>i});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"0.7 2.19 14.6 11.6",svg:(0,o(474848).jsx)("path",{d:"M3.142 2.332a.55.55 0 0 1 .695-.017l.081.077.227.264.008.01 8.772 10.235.057.082a.551.551 0 0 1-.819.701l-.08-.076-1.18-1.376A8.5 8.5 0 0 1 8 12.74c-3.027 0-5.685-1.569-7.026-3.911L.848 8.6a1.29 1.29 0 0 1 0-1.199l.126-.228c.705-1.233 1.776-2.251 3.073-2.94l-.965-1.125-.063-.091a.55.55 0 0 1 .123-.685m2.77 4.078a2.6 2.6 0 0 0-.537 1.588l.014.269a2.626 2.626 0 0 0 2.343 2.343l.268.014c.453 0 .878-.118 1.25-.32L8.023 8.872 8 8.874a.875.875 0 0 1-.861-1.032zM8 3.26c3.125 0 5.857 1.673 7.153 4.141l.064.144c.11.293.11.617 0 .91l-.065.145a7.5 7.5 0 0 1-2.255 2.577L10.58 8.475q.02-.103.031-.208l.014-.269A2.626 2.626 0 0 0 8 5.372l-.077.002-1.66-1.937A8.6 8.6 0 0 1 8 3.261"})},i=(0,o(340498).wt)("eyeSlashFillSmall",n,"fillSmall")},301948:(e,t,o)=>{o.d(t,{A:()=>a});o(296540);var n=()=>o(970236),i=()=>o(69708),r=o(474848);function a(e){return(0,r.jsx)(n().E,{color:"blue",style:e.style,content:(0,r.jsx)(i().sA,{id:"AlphaBadgeComponent.label",defaultMessage:"Alpha"})})}},307159:(e,t,o)=>{o.d(t,{A:()=>T,m:()=>M});var n=o(296540),i=()=>o(590526),r=()=>o(401497),a=()=>o(784892),s=()=>o(869190),l=()=>o(239381),c=()=>o(791089),d=()=>o(416504),u=()=>o(381553),p=()=>o(201980),m=()=>o(69708),g=()=>o(100622),y=()=>o(534177),h=()=>o(284371),f=()=>o(881690),v=()=>o(744951),x=()=>o(805452),S=()=>o(214973),b=()=>o(133518),A=()=>o(741310),C=()=>o(923832),k=()=>o(436876),j=()=>o(16707),I=o(474848);function M(e){const{actionId:t,actionMenu:o,buttonPopupStore:g,disabled:M,onClick:P,propertySchema:_,value:B,valueContext:R}=e,V=(0,m().tz)(),E=(0,r().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre"},propertyName:{...h().RC,fontWeight:h().Wy.medium}})),[]),F=(0,b().F)({actionId:t}),D=(0,i().K8)((()=>function(e){const{intl:t,propertySchema:o,styles:n,typecheckContextValues:i,value:r,valueContext:u}=e,g=(0,I.jsx)("span",{style:n.propertyName,children:o.name});if(void 0===(null==r?void 0:r.value))return(0,I.jsx)(m().sA,{...S().NW({propertyName:g})});let b;const A="formula"===r.type,C=(0,c().fromSimpleFormulaArrayValue)(null==r?void 0:r.value)[0];if(A)b=(0,I.jsx)(j().g,{returnType:{type:"date"}});else if(!(0,y().O9)(C)||"string"==typeof C||"boolean"==typeof C||(0,p().rie)(C)||(0,p().RaC)(C)||(0,p().jIt)(C))b=(0,I.jsx)(f().A,{format:a().NY.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,I.jsx)("span",{style:h().RC,children:(0,I.jsx)(m().sA,{...S().CV.unknownValue})})});else if((0,p().s1Y)(C)){const e=(0,p().iVq)(C).id,t=(0,l().IV)(i,e);b=t?(0,I.jsx)(v().F,{value:t,format:a().NY.Medium,isSingle:!1,shouldShrink:!0}):(0,I.jsx)(f().A,{format:a().NY.Medium,isRound:!0,isSingle:!0,shouldShrink:!0,showRemoveButton:!1,value:(0,I.jsx)("span",{style:h().RC,children:(0,I.jsx)(m().sA,{...S().CV.unknownValue})})})}else if((0,p().qsB)(C)){const e=(0,x().aS)(u),o=(0,p().K7D)(C);b=o?(0,s().zV)({value:o,date_format:e.dateFormat,time_format:e.timeFormat,userTimeZone:(0,d().P)(),allowRelativeDates:!0,intl:t,shortenDateAndRange:!0,displayInUserTimezone:!0,formatValuesFn:({endDate:e,endTime:t,startDate:o})=>(0,y().O9)(t)?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(w,{value:o}),"  ",(0,I.jsx)(w,{value:t})]}):(0,y().O9)(e)?(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(w,{value:o}),"  ",(0,I.jsx)(w,{value:e})]}):(0,I.jsx)(w,{value:o})}):null}else{if((0,p().iz3)(C))return(0,I.jsx)(k().A,{token:C});(0,y().HB)(C)}if(void 0!==b)return(0,I.jsx)(m().sA,{...S().Oo({propertyName:g,propertyValue:b})})}({intl:V,propertySchema:_,styles:E,typecheckContextValues:F,value:B,valueContext:R})),[V,_,E,F,B,R]),L=(0,i().K8)((()=>T({intl:V,propertySchema:_,typecheckContextValues:F,value:B,valueContext:R})),[V,_,F,B,R]),O=(0,n.useCallback)((e=>(0,I.jsx)(C().aX,{...e,actionId:t,actionMenu:o,buttonPopupStore:g,disabled:M,icon:u().Y,onClick:P,children:(0,I.jsx)("div",{style:E.content,children:D})})),[t,o,g,M,P,E.content,D]);return D&&L?(0,I.jsx)(A().P,{disable:M,renderOrigin:O,title:L}):null}function T(e){const{intl:t,propertySchema:o,typecheckContextValues:n,value:i,valueContext:r}=e,a=o.name;if(void 0===(null==i?void 0:i.value))return(0,I.jsx)(m().sA,{...S().NW({propertyName:a})});let u;const g="formula"===i.type,h=(0,c().fromSimpleFormulaArrayValue)(i.value)[0];if(g)u=(0,I.jsx)(j().L,{});else if(!(0,y().O9)(h)||"string"==typeof h||"boolean"==typeof h||(0,p().rie)(h)||(0,p().RaC)(h)||(0,p().jIt)(h)||(0,p().iz3)(h))u=(0,I.jsx)(m().sA,{...S().CV.unknownValue});else if((0,p().s1Y)(h)){const e=(0,p().iVq)(h).id,t=(0,l().IV)(n,e);u=t?(0,l().sM)(t):(0,I.jsx)(m().sA,{...S().CV.unknownValue})}else if((0,p().qsB)(h)){const e=(0,x().aS)(r),o=(0,p().K7D)(h);u=o?(0,s().ZF)({value:o,date_format:e.dateFormat,time_format:e.timeFormat,userTimeZone:(0,d().P)(),allowRelativeDates:!0,intl:t,shortenDateAndRange:!0,displayInUserTimezone:!0}):null}else(0,y().HB)(h);return void 0!==u?(0,I.jsx)(m().sA,{...S().Oo({propertyName:a,propertyValue:u})}):void 0}function w(e){const{value:t}=e,o=(0,r().IS)((()=>({token:{marginBlockEnd:4},tokenBackgroundColor:{backgroundColor:g().Tj.palette.gray[75]}})),[]);return(0,I.jsx)(f().A,{backgroundColor:o.tokenBackgroundColor.backgroundColor,format:a().NY.Medium,isRound:!0,isSingle:!0,showRemoveButton:!1,style:o.token,value:t})}},320865:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var n=o(474848);const i=function(){return(0,n.jsx)(o(424400).Ay,{title:(0,n.jsx)(o(98126).k,{size:"default"}),titleStyle:{display:"flex",justifyContent:"center",alignItems:"center",width:"100%"}})}},334684:(e,t,o)=>{o.d(t,{$:()=>s});var n=()=>o(898244),i=()=>o(713998),r=()=>o(534177);const a=["button","formula","auto_increment_id","file"];function s(e){const{propertyType:t,propertySchema:o,allowAIProperty:s}=e,l=(0,r().O9)(o)&&(0,n().$M)(o)&&(0,r().O9)((0,n().om)(o)),c=!s&&l,d=(0,r().O9)((0,i().Dz)(o));return a.includes(t)||c||d}},347114:(e,t,o)=>{o.d(t,{S:()=>m,j:()=>g});var n=o(296540),i=()=>o(590526),r=()=>o(401497),a=()=>o(202017),s=()=>o(69708),l=()=>o(284371),c=()=>o(741310),d=()=>o(923832),u=()=>o(575630),p=o(474848);const m=5;function g(e){const{action:t,actionId:o,actionMenu:g,buttonPopupStore:y,disabled:h,limit:f=m,onClick:v,propertySchema:x,value:S}=e,b=(0,s().tz)(),A=(0,r().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...l().RC,fontWeight:l().Wy.medium}})),[]),C=(0,i().K8)((()=>(0,u().mk)({intl:b,limit:f,propertySchema:x,styles:A,operator:t,value:S})),[b,f,x,A,t,S]),k=(0,i().K8)((()=>(0,u().cI)({intl:b,limit:f,propertySchema:x,operator:t,value:S})),[t,b,f,x,S]),j=(0,n.useCallback)((e=>(0,p.jsx)(d().aX,{...e,actionId:o,actionMenu:g,buttonPopupStore:y,disabled:h,icon:a().n,onClick:v,children:(0,p.jsx)("div",{style:A.content,children:C})})),[o,g,y,h,v,A.content,C]);return(0,p.jsx)(c().P,{renderOrigin:j,title:k})}},359186:(e,t,o)=>{o.d(t,{EJ:()=>M,Jx:()=>B,T7:()=>_,Vj:()=>P,Zd:()=>T,ef:()=>w,hF:()=>I});var n=o(296540),i=()=>o(484714),r=()=>o(590526),a=()=>o(401497),s=()=>o(70899),l=()=>o(703778),c=()=>o(32527),d=()=>o(606006),u=()=>o(100762),p=()=>o(189814),m=()=>o(161479),g=()=>o(69708),y=()=>o(284371),h=()=>o(712030),f=()=>o(29554),v=()=>o(546461),x=()=>o(214973),S=()=>o(133518),b=()=>o(741310),A=()=>o(923832),C=()=>o(16707),k=o(474848);function j(e){const{actionId:t,actionMenu:o,buttonPopupStore:s,disabled:l,icon:c,onClick:d,propertySchema:u,value:p}=e,{automationStore:j}=(0,v().q8)(),M=(0,i().v3)(),T=(0,a().DP)(),w=(0,a().IS)((()=>({propertyName:{...y().RC,fontWeight:y().Wy.medium,flexShrink:0}})),[]),P=(0,S().F)({actionId:t}),_=(0,r().K8)((()=>function(e){const{automationStore:t,environment:o,propertySchema:n,styles:i,theme:r,typecheckContextValues:a,value:s}=e,l=(0,k.jsx)("span",{style:i.propertyName,children:n.name}),c=void 0===(null==s?void 0:s.value);if(c)return(0,k.jsx)(g().sA,{...x().NW({propertyName:l})});let d;const u="formula"===s.type;if(u)d=(0,k.jsx)(C().g,{returnType:{type:"text"}});else{const e=(0,f().S5)({disabled:!0,disableDateStyleAnnotations:!0,disableHover:!0,disableLinks:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableSuggestionAnnotations:!0,emojiType:(0,h().FN)(o),environment:o,formulaValueTypes:a,katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:s.value??[],spaceId:(0,m().e)(t.pointer.spaceId)},theme:r});d=(0,k.jsxs)(k.Fragment,{children:['"',(0,k.jsx)("span",{style:y().RC,children:e}),'"']})}return(0,k.jsx)(g().sA,{...x().LK({propertyName:l,propertyValue:d})})}({automationStore:j,environment:M,propertySchema:u,styles:w,theme:T,typecheckContextValues:P,value:p})),[j,M,u,w,T,P,p]),B=(0,r().K8)((()=>I({automationStore:j,environment:M,propertySchema:u,theme:T,typecheckContextValues:P,value:p})),[j,M,u,T,P,p]),R=(0,n.useCallback)((e=>(0,k.jsx)(A().aX,{...e,actionId:t,actionMenu:o,buttonPopupStore:s,disabled:l,icon:c,onClick:d,children:_})),[t,o,s,l,c,d,_]);return _&&B?(0,k.jsx)(b().P,{renderOrigin:R,title:B}):null}function I(e){const{automationStore:t,environment:o,propertySchema:n,theme:i,typecheckContextValues:r,value:a}=e,s=n.name;if(void 0===(null==a?void 0:a.value))return(0,k.jsx)(g().sA,{...x().NW({propertyName:s})});let l;return l="formula"===a.type?(0,k.jsx)(C().L,{}):(0,f().S5)({disabled:!0,disableDateStyleAnnotations:!0,disableFormulaVariableStyles:!0,disableHover:!0,disableInsertedDeletedAnnotations:!0,disableLinks:!0,disableStyleAnnotations:!0,disableSuggestionAnnotations:!0,emojiType:(0,h().FN)(o),environment:o,formulaValueTypes:r,katex:o.KatexStore.getKatex(),parentStore:t,stopLinkPropagation:!0,textValue:{value:a.value??[],spaceId:(0,m().e)(t.pointer.spaceId)},theme:i}),(0,k.jsx)(g().sA,{...x().LK({propertyName:s,propertyValue:l})})}function M(e){return(0,k.jsx)(j,{...e,icon:u().z})}function T(e){return(0,k.jsx)(j,{...e,icon:p().H})}function w(e){return(0,k.jsx)(j,{...e,icon:s().U})}function P(e){return(0,k.jsx)(j,{...e,icon:l().linkSmallIcon})}function _(e){return(0,k.jsx)(j,{...e,icon:c().E})}function B(e){return(0,k.jsx)(j,{...e,icon:d().phoneSmallIcon})}},377093:(e,t,o)=>{o.d(t,{XO:()=>U,h3:()=>N,nZ:()=>z,pG:()=>W});o(944114),o(898992),o(823215),o(354520),o(803949),o(581454);var n=()=>o(314529),i=()=>o(564884),r=()=>o(907258),a=()=>o(365917),s=()=>o(675133),l=()=>o(295633),c=()=>o(732810),d=()=>o(433337),u=()=>o(716016),p=()=>o(898244),m=()=>o(617871),g=()=>o(165358),y=()=>o(388693),h=()=>o(792071),f=()=>o(179034),v=()=>o(332393),x=()=>o(96689),S=()=>o(854150),b=()=>o(496603),A=()=>o(534177),C=()=>o(935664),k=()=>o(753812),j=()=>o(896628),I=()=>o(799427),M=()=>o(567700),T=()=>o(928213),w=()=>o(339798),P=()=>o(254497),_=()=>o(312296),B=()=>o(999140),R=()=>o(191356),V=()=>o(601734),E=()=>o(395963),F=()=>o(838038),D=()=>o(244828),L=()=>o(155269);const O=(0,o(69708).YK)({aiCustomPromptDefaultPropertyName:{id:"collectionSettingsCreatePropertyActions.createProperty",defaultMessage:"Text"}});function K(e){const{environment:t,collectionContextStore:o,collectionUri:i,feature:r,transaction:a,addFeatureFrom:s,createFeatureStartTime:l}=e;if("dependencies"in r)for(const n of r.dependencies)"property"===n.type&&n.collectionUri===i&&(0,C().Z)({environment:t,collectionContextStore:o,from:"view_settings",property:n.uri,property_type:n.propertySchema.type,is_suggested_property:!0,property_id:n.uri,feature:{id:n.uri,from:s,type:r.uri}});if("dependencies"in r&&r.dependencies.map((e=>e.type)).every((e=>"property"===e))){const e=o.collectionViewStore(),t=o.getPropertyFormatKey(),n=o.normalizedFormatStore.state;if(t&&e){const o=n[t]||[],i=[...o];r.dependencies.forEach((e=>{const t=o.findIndex((t=>t.property===e.uri));-1===t?i.push({visible:!0,property:e.uri}):i[t]={...o[t],visible:!0}})),j().zA({stores:[e],update:{[t]:i},transaction:a})}}if(void 0!==r.propertyIdCollectionSettingToNavigateTo){const e={type:"property",property:r.propertyIdCollectionSettingToNavigateTo,selectNameInitial:!1,formatKey:o.getPropertyFormatKey()};w().a2({collectionSettingsStore:o.settingsStore,item:e})}a.postSubmitCallbacks.push((e=>{(0,n().DO_NOT_USE_trackLegacy)(t,"collection_create_suggested_property_latency",{collection_uri:r.collectionUri,feature_uri:r.uri,time:Date.now()-l,status:Boolean(e)?"fail":"success"})}))}async function N(e){var t;const{appTemplatesSetupActions:o,appTemplatesSprintBoardActions:n,appConfigs:i}=await V().Aw.load(),{environment:s,collectionContextStore:c,feature:p,addFeatureFrom:h,customPropertyName:b}=e,{sidebarSpaceViewStore:A}=r().default.state,C=c.collectionStore(),w=null==C?void 0:C.getParentBlockStore(),P={},_=e=>{(0,g().log)({level:"error",from:"collectionSettingsCreatePropertyActions",type:"handleCreateNewSuggestedProperty",data:{collectionId:null==C?void 0:C.id,miscDataToConvertToString:{featureUri:p.uri,addFeatureFrom:h,...P,...e}}})};if(!C||!w)return void _({hasCollectionStore:Boolean(C),hasCollectionViewBlockStore:Boolean(w)});if((0,M().u)(p))return async function(e){const{environment:t,collectionContextStore:o,feature:n,addFeatureFrom:i}=e,{untypedFeaturesSetupActions:r}=await V().Aw.load(),a=o.collectionStore(),s=null==a?void 0:a.getParentBlockStore();if(!a||!s)return;const l=Date.now();D().createAndCommit({environment:t,userAction:"collectionSettingsCreatePropertyActions.handleCreateNewUntypedFeature",canUndo:!0,perform:e=>{r.applyUntypedFeature({environment:t,collectionStore:a,collectionViewBlockStore:s,feature:n,transaction:e}),K({environment:t,collectionContextStore:o,collectionUri:d().iH,feature:n,transaction:e,addFeatureFrom:i,createFeatureStartTime:l})}})}({environment:s,collectionContextStore:c,feature:p,addFeatureFrom:h});const B=c.collectionViewStore(),E=null==w?void 0:w.getParentStore(),F=null==C||null===(t=C.getFormat())||void 0===t?void 0:t.app_config_uri,L=F&&(0,I().l)(i(),F);if(P.appConfigUri=L&&L.uri,!E||E.table!==x().NX&&E.table!==f().ev&&E.table!==S().yK||!L)return void _({hasAppParentStore:Boolean(E),appParentStoreTable:null==E?void 0:E.table,appConfigUri:L?L.uri:void 0});const O=C.getSchema(),N=w.getFormat().app_id;P.appId=N;const W=N?await k().callApi({eventName:"getCollectionViewBlocksByAppId",environment:s,data:{spaceId:w.getSpaceId(),appId:N}}):void 0,z="success"===(null==W?void 0:W.type)&&W.data.result.length?W.data.result.map((e=>l().B.createChildStore(E,{table:f().ev,id:e.blockId,spaceId:w.getSpaceId()}))):[w],U=p.integrationId;if(U){const e=a().A.getIntegrationsAsRecordMap().getValue({table:v().Li,id:U});if(!e||!(0,y().v_)(e))return void _({hasIntegration:Boolean(e)});await R().C4(s,C,e,Boolean(p.canOnlyAdminAuth))}U===m().ob&&O&&0===(0,u().yP)(O).length&&await T().c({environment:s,collectionStore:C});const H=Date.now();D().createAndCommit({environment:s,userAction:"collectionSettingsCreatePropertyActions.handleCreateNewSuggestedProperty",canUndo:!0,perform:e=>{var t;if(!A)return void _({hasCurrentSpaceViewStore:!1});const i=null===(t=C.getFormat())||void 0===t?void 0:t.app_config_uri;if(!i)return void _({hasCollectionUri:!1});const r=o.applyTypedFeatures({environment:s,spaceViewStore:A,appParentStore:E,appUri:L.uri,features:[{type:"simple",featureUri:p.uri}],transaction:e,createOrModify:"modify",appCollectionViewBlockStores:z,customPropertyName:b});n.createSprintPage({environment:s,spaceViewStore:A,appParentStore:E,transaction:e,blockStores:r,creationEntryPoint:{type:"sprint_relation"}}),"notion://tasks/sub_task_feature"===p.uri&&j().zA({stores:[C],update:{subitem_property:d().yx.SubTaskRelation},transaction:e}),"notion://tasks/task_dependencies_feature"===p.uri&&(j().zA({stores:[C],update:{collection_default_arrows_by:d().yx.BlockingRelation},transaction:e}),B&&j().zA({stores:[B],update:{timeline_arrows_by:{property:d().yx.BlockingRelation}},transaction:e})),K({environment:s,collectionContextStore:c,collectionUri:i,feature:p,transaction:e,addFeatureFrom:h,createFeatureStartTime:H}),e.isEmpty()&&_({isEmptyTransaction:!0})}})}function W({propertyType:e,collectionContextStore:t,propertyId:o}){const n=t.normalizedSchemaStore.state[o];if(n)switch(e){case"ai_custom_prompt":case"ai_summary":case"ai_extract":case"ai_translate":return w().a2({collectionSettingsStore:t.settingsStore,item:{type:"propertyAiAutofill",propertySchema:n,property:o}});case"ai_keywords":return w().a2({collectionSettingsStore:t.settingsStore,item:{type:"property",property:o,formatKey:t.getPropertyFormatKey()}});default:(0,A().HB)(e)}}function z(e){const{environment:t,collectionContextStore:n,propertyType:i,isSuggestedProperty:r,propertyName:a,propertyIcon:l,selectOptions:c,from:d,shouldOpenEditMenu:u=!0,newPropertyFormat:m}=e,g=n.collectionStore(),y=n.collectionViewStore(),h=n.getPropertyFormatKey(),f=n.normalizedFormatStore.state;if(!g)return;if("relation"===i)return void w().a2({collectionSettingsStore:n.settingsStore,item:{type:"selectRelationSource",property:void 0,initialPropertyName:a,formatKey:h,newPropertyFormat:m}});let v=a;"ai_custom_prompt"===i&&(v=s().A.formatMessage(O.aiCustomPromptDefaultPropertyName));const x=m&&h?{...f,[h]:m}:f,{performResult:S}=D().createAndCommit({userAction:"collectionSettingsCreatePropertyActions.handleCreateNewStandardProperty",environment:t,canUndo:!0,perform:e=>(0,L().createProperty)({environment:t,collectionStore:g,collectionViewArgs:y&&h?{collectionViewStore:y,format:x,formatKey:h}:void 0,propertyName:v,propertyIcon:l,propertyType:i,selectOptions:c,transaction:e})});u&&((0,p().hN)(i)?W({propertyType:i,propertyId:S,collectionContextStore:n}):w().n1({collectionSettingsStore:n.settingsStore,property:S,formatKey:h,selectNameInitial:!0}));const b="view_settings"===d?{feature:{id:S,from:"new_property",type:i}}:{};(0,C().Z)({environment:t,collectionContextStore:n,from:d,property_type:(0,p().v2)(i),property:(0,p().hN)(i)?i:void 0,is_suggested_property:r,property_id:S,...b}),r||n.userAddedPropertyStore.update((()=>!0)),S&&!(0,p().hN)(i)&&o.e(52315).then(o.bind(o,830213)).then((e=>{e.maybeTriggerDatabaseViewNudgeOnCreateProperty({environment:t,collectionContextStore:n,propertyId:S,propertyType:(0,p().v2)(i)})}))}async function U(e){const{environment:t,collectionContextStore:o,intl:n,connectedRelationProperty:r,from:a,untypedFeatureArgs:s,propertyGroupId:l,propertyLimit:c,skipDatabaseActions:d,propertyName:y}=e,f=o.collectionStore(),v=o.collectionViewStore(),x=o.getPropertyFormatKey();if(!f||!x)return;const S=r.integration.id;(0,m().XO)(S)||await R().C4(t,f,r.integration,Boolean(r.canOnlyAdminAuth));const k=f.getSchema();let j;S===m().ob&&k&&0===(0,u().yP)(k).length&&(j=await T().c({environment:t,collectionStore:f}));const I=f.getDeletedSchema(),M=(0,A().WP)(I).map((([e,t])=>{if(t&&p().UU(t)&&t.connectedRelation.integration_id===m().ob)return{propertyId:e,propertySchema:t}})).filter(A().O9);let B;if(!b().Im(M)){const e=M[0];B={propertyId:e.propertyId,update:await H({collectionStore:f,property:e})}}D().createAndCommit({environment:t,userAction:"collectionSettingsCreatePropertyActions.handleCreateNewConnectedRelationProperty",canUndo:!0,perform:e=>{const{shouldCreateNewProperty:u,restoredPropertyId:p}=function(e){const{environment:t,generatedPrefix:o,integrationId:n,propertyGroupId:i,collectionStore:r,collectionContextStore:a,collectionViewStore:s,formatKey:l,transaction:c,maybeRestoreDeletedProperty:d}=e;o&&(0,L().createProperty)({environment:t,collectionStore:r,collectionViewArgs:s?{collectionViewStore:s,format:s.getFormat(),formatKey:l}:void 0,propertyType:"auto_increment_id",transaction:c,propertyGroupId:i});if(null!=d&&d.propertyId){if(d.update){i&&(0,E().En)({collectionStore:r,groupId:i,propertyId:d.propertyId,transaction:c}),(0,_().F)({environment:t,collectionStore:r,update:d.update.updateSchema,transaction:c}),(0,P().E)({collectionStore:r,update:d.update.updateDeletedSchema,transaction:c});const e={type:"property",property:d.propertyId,formatKey:l};return w().a2({collectionSettingsStore:a.settingsStore,item:e}),{shouldCreateNewProperty:!1,restoredPropertyId:d.propertyId}}return(0,g().log)({level:"error",from:"collectionSettingsCreatePropertyActions",type:"handleCreateNewConnectedRelationProperty",data:{message:"Invalid property found in deleted_schema",collectionId:null==r?void 0:r.id,miscDataToConvertToString:{integration:n,maybeRestoreDeletedProperty:d}}}),(0,P().E)({collectionStore:r,update:{[d.propertyId]:null},transaction:c}),{shouldCreateNewProperty:!0}}return{shouldCreateNewProperty:!0}}({environment:t,generatedPrefix:j,transaction:e,propertyGroupId:l,collectionStore:f,collectionViewStore:v,collectionContextStore:o,integrationId:S,formatKey:x,maybeRestoreDeletedProperty:B});if(!u&&p)return p;const m=function(e){const{environment:t,transaction:o,collectionStore:n,collectionViewStore:i,collectionContextStore:r,intl:a,connectedRelationProperty:s,untypedFeatureArgs:l,propertyLimit:c,propertyName:d,formatKey:u}=e,p=s.integration.id,m=h().Bj6.fromIntegration(s.integration),g=R().qM({environment:t,pattern:s.pattern,integration:m,parentCollectionStore:n,transaction:o}),y=(0,L().createProperty)({environment:t,collectionStore:n,collectionViewArgs:i&&u?{collectionViewStore:i,format:i.getFormat(),formatKey:u}:void 0,propertyType:"relation",transaction:o,propertyId:null==l?void 0:l.propertyId});return F().cT({environment:t,collectionContextStore:r,collectionStore:n,property:y,propertyName:d&&d.length>0?d:s.name,propertyIcon:s.integration.info.icon,propertyLimit:c??"no_limit",targetCollectionStore:g,hasInverseRelation:!0,autoRelate:void 0,intl:a,connectedRelation:{integration_id:p},transaction:o}),y}({environment:t,transaction:e,collectionStore:f,collectionViewStore:v,collectionContextStore:o,intl:n,connectedRelationProperty:r,untypedFeatureArgs:s,propertyLimit:c,propertyName:y,formatKey:x});if((0,C().Z)({environment:t,collectionContextStore:o,from:"view_settings",property_id:m,property_type:"relation",integration_id:S,feature:{id:m,from:a,type:`notion://feature/connection_${S}`}}),!s)if(d){const e=f.getSchema(),n=null==e?void 0:e[m];w().a2({collectionSettingsStore:o.settingsStore,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationAddProperties",rootPropertyId:m,integrationId:S,rootPropertySchema:n,skipDatabaseActions:!0,eventSource:"first_time_setup"}}),(0,i().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{actionType:"add_properties_clicked",details:{source:"first_time_setup"},integrationId:S,collectionId:null==f?void 0:f.id}}})}else{const e={type:"property",property:m,formatKey:x};w().a2({collectionSettingsStore:o.settingsStore,item:e})}return m}})}async function H(e){const{property:{propertyId:t,propertySchema:o},collectionStore:n}=e,i=(0,p().Nv)(o);if((null==i?void 0:i.spaceId)!==n.getSpaceId())return;const r=c().m.createChildStore(n,i);if(await r.load(),null==r||!r.isDefined())return;if(r.getParentId()!==n.id)return;return(0,B().KA)({deletedSchema:n.getDeletedSchema(),property:t})}},381553:(e,t,o)=>{o.d(t,{Y:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 16 16",fittedViewBox:"2.37 2.37 11.25 11.25",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M7.053 6.407a.643.643 0 1 0 0 1.286.643.643 0 0 0 0-1.286m1.894 0a.643.643 0 1 0 0 1.286.643.643 0 0 0 0-1.286m1.893 0a.643.643 0 1 0 0 1.286.643.643 0 0 0 0-1.286M5.159 8.3a.643.643 0 1 0 0 1.287.643.643 0 0 0 0-1.286M7.053 8.3a.643.643 0 1 0 0 1.287.643.643 0 0 0 0-1.286M8.947 8.3a.643.643 0 1 0 0 1.287.643.643 0 0 0 0-1.286M10.84 8.3a.643.643 0 1 0 0 1.287.643.643 0 0 0 0-1.286m-5.681 1.894a.643.643 0 1 0 0 1.286.643.643 0 0 0 0-1.286m1.894 0a.643.643 0 1 0 0 1.286.643.643 0 0 0 0-1.286m1.894 0a.643.643 0 1 0 0 1.286.643.643 0 0 0 0-1.286"}),(0,n.jsx)("path",{d:"M4.25 2.375c-1.036 0-1.875.84-1.875 1.875v7.5c0 1.036.84 1.875 1.875 1.875h7.5c1.036 0 1.875-.84 1.875-1.875v-7.5c0-1.036-.84-1.875-1.875-1.875zm-.625 9.375V5.632h8.75v6.118c0 .345-.28.625-.625.625h-7.5a.625.625 0 0 1-.625-.625"})]})},r=(0,o(340498).wt)("viewCalendarSmall",i,"small")},383574:(e,t,o)=>{o.d(t,{V:()=>l});o(898992),o(354520);var n=()=>o(590526),i=()=>o(368609),r=()=>o(352271),a=()=>o(546461),s=()=>o(367742);function l(){const{automationStore:e,contextType:t}=(0,a().q8)(),o=(0,n().K8)((()=>(0,s().Z6)(e,t)),[e,t]);return(0,n().K8)((()=>{if(!o)return[];const{automation:e,automationActions:t}=o,n=e.getTriggerType(),a=(0,r().ad)({isGenericRecurrenceAllowed:!0})[n],s="default_bound"===a.max?r().x3:a.max;if(t.length>=s)return[];return function(e){const t=e=>e?1:-1;return e.slice().sort(((e,o)=>t(o.hasSideEffects)-t(e.hasSideEffects)))}((0,i().getActionRegistryItemsWithConcern)("display").filter((e=>e.isAvailableForContext({...o,isSubscribed:!0}))))}),[o])}},418375:(e,t,o)=>{o.d(t,{A:()=>n});const n=o(757695).Store.createValue({executionTarget:null},{name:"DuplicationDebuggingStore"})},436876:(e,t,o)=>{o.d(t,{A:()=>u});o(296540);var n=()=>o(784892),i=()=>o(955363),r=()=>o(537193),a=()=>o(888867),s=()=>o(201980),l=()=>o(100622),c=()=>o(848401),d=o(474848);function u({handleRemoveToken:e,token:t,type:o,format:u,style:p,isDisabled:m}){const g=(0,s().GCe)(t).name;if(!g)return null;let y;switch(o){case"person":y=a().s;break;case"email":y=r().b;break;default:y=i().arrowDiagonalUpRightIcon}return(0,d.jsx)(c().Ay,{title:g,renderAvatar:e=>y({width:e,height:e,padding:2,marginInlineEnd:6}),style:{background:l().Tj.palette.gray[75],padding:"2px 4px",margin:void 0,...p},showRemoveButton:Boolean(e)&&!m,onClickRemove:o=>{null==o||o.stopPropagation(),e&&e(t)},format:u??n().NY.Small,shouldShrink:!0,isSingle:!1})}},439612:(e,t,o)=>{o.d(t,{S:()=>qe,A:()=>$e});var n=o(296540),i=()=>o(590526),r=()=>o(534177),a=()=>o(286595),s=(o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(581454),o(908872),o.n(o(844751))),l=()=>o(564884),c=()=>o(300474),d=()=>o(907258),u=()=>o(726637),p=()=>o(484714),m=()=>o(401497),g=()=>o(79926),y=()=>o(675133),h=()=>o(26697),f=()=>o(890492),v=()=>o(81068),x=()=>o(663639),S=()=>o(736847),b=()=>o(890409),A=()=>o(340498),C=()=>o(199378),k=()=>o(84262),j=()=>o(69708),I=()=>o(100622),M=()=>o(496603),T=()=>o(813297),w=()=>o(594794),P=()=>o(479788);function _(){const e=(0,p().v3)();return(0,n.useMemo)((()=>(0,P().Q)(e)),[e])}var B=()=>o(789586),R=()=>o(528093),V=()=>o(324587),E=()=>o(546461),F=()=>o(5269),D=()=>o(366360),L=()=>o(781697),O=()=>o(383574),K=()=>o(284489),N=(o(430670),()=>o(422540)),W=()=>o(680288),z=()=>o(419357),U=o(474848);function H(e){const{automationStore:t,collectionStore:o,searchInput:n}=e,i=new Set(t.getActionStores().flatMap((e=>e.isType("update_pages")?e.getConfigStore().getKeyStore("properties").getValue()??[]:[]))),a=o.getFormat(),l=o.getSchema(),c=(0,N().m7)({collectionFormat:a,collectionSchema:l,filter:([e])=>!i.has(e),spaceId:o.getSpaceId(),restrictCrossSpace:!0}),d=new Map,u=c.map((e=>{const t=l[e];if(t){const o=`${t.name} ${W().dC[t.type]}`;return d.set(e,o),o}})).filter(r().O9),p=new Set(s().filter(n,u).map((({original:e})=>e)));return c.filter((e=>{const t=d.get(e);return t&&p.has(t)}))}function Y(e){const{onChange:t,value:o,placeholder:n,isInput:i}=e;return{items:[{action:()=>{},key:"search-input",render:e=>(0,U.jsx)(G,{...e,onChange:t,value:o,placeholder:n})}],key:"search",render:e=>(0,U.jsx)(S().A,{...e,isInput:i})}}const G=(0,n.forwardRef)((function(e,t){const{onChange:o,value:n,placeholder:i,...r}=e,a=(0,j().tz)();return(0,U.jsx)(z().Ay,{...r,focus:!u().A.isMobile,inputOuterStyle:{margin:0},onChange:o,placeholder:a.formatMessage(i),ref:t,value:n})}));var q=()=>o(714202);const $=(0,j().YK)({searchInputPlaceholder:{id:"UpdateThisPagePropertiesActionMenu.searchInputPlaceholder ",defaultMessage:"Search for a property"},editProperty:{id:"automationEventActionMenu.pagePropertiesEditedSection.title",defaultMessage:"Edit property"}});function Q(e){const{automationActionMenuStore:t,onClose:o}=e,{automationStore:r,contextType:a}=(0,E().q8)(),s=(0,F().y)(r,a),[l,c]=(0,n.useState)(""),d=(0,i().K8)((()=>s&&r?H({automationStore:r,collectionStore:s,searchInput:l}):[]),[r,s,l]),u=(0,i().K8)((()=>null==s?void 0:s.getSchema()),[s]),p=(0,n.useMemo)((()=>{const e=[];e.push(Y({onChange:e=>c(e.target.value),value:l,placeholder:$.searchInputPlaceholder}));const o=u&&X({automationActionMenuStore:t,propertyIds:d,normalizedBlockSchema:u,includeTitle:!1});return o&&e.push(o),e}),[t,d,u,l]),m=(0,q().r)({triggerActionMenuStore:t,customMenuProps:{leftOuterStyle:{flexGrow:0},rightOuterStyle:{flexGrow:0},titleOuterStyle:{minWidth:0}},onClose:o,title:(0,U.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:(0,U.jsx)(j().sA,{...$.editProperty})})});return(0,U.jsx)(f().A,{...m,children:(0,U.jsx)(x().A,{initialFocus:0,sections:p,type:x().O.Vertical})})}function X(e){const{automationActionMenuStore:t,hasTopBorder:o,normalizedBlockSchema:n,propertyIds:i,includeTitle:a}=e,s=i.map((e=>{const o=n[e];if(o)return function(e){const{automationActionMenuStore:t,propertyId:o,propertySchema:n}=e;return{action:()=>{t.pushSettingsItem({actionId:void 0,propertyId:o,type:"eventActionProperty"})},key:`update_this_page_property_${o}_action`,render:e=>(0,U.jsx)(Z,{...e,propertySchema:n})}}({automationActionMenuStore:t,propertyId:e,propertySchema:o})})).filter(r().O9);if(0!==s.length)return{key:"automation_update_this_page_section",items:s,render:e=>(0,U.jsx)(S().A,{...e,title:a?(0,U.jsx)(j().sA,{...$.editProperty}):void 0,topBorder:o})}}const Z=(0,n.forwardRef)((function(e,t){const{propertySchema:o,...n}=e;return(0,U.jsx)(v().A,{...n,icon:(0,U.jsx)(J,{propertySchema:o}),ref:t,showExtensionArrow:!0,title:o.name})}));function J(e){const{propertySchema:t}=e,n=(0,m().DP)(),i=(0,m().IS)((()=>({icon:{fill:I().Tj.icon.secondary,width:A().Ev.sm},iconWrap:{alignItems:"center",borderRadius:4,display:"flex",height:20,justifyContent:"center",width:20}})),[]);return(0,U.jsx)("div",{style:i.iconWrap,children:(0,U.jsx)(o(852424).zB,{icon:t.icon,size:A().Ev.sm,style:i.icon,theme:n,type:t.type})})}const ee=(0,j().YK)({searchInputPlaceholder:{id:"automationEventActionMenu.searchInputPlaceholder.label",defaultMessage:"Search actions"},updateThisPagePropertiesMenuItemCaption:{defaultMessage:"Edit property",id:"automationEventActionMenu.updateThisPagePropertiesMenuItem.caption"},availablePlus:{defaultMessage:"Available on Plus",id:"automationEventActionMenu.upsellFeatures.title"},disabledActionTooltipHeader:{defaultMessage:"Disabled in your workspace",id:"automationEventActionMenu.disabledActionTooltipHeader"},disabledActionTooltipBody:{defaultMessage:"Contact a workspace admin to modify this setting.",id:"automationEventActionMenu.disabledActionTooltipBody"}}),te=["automation_actions","update_this_page_actions"],oe=["update_this_page_actions","automation_actions"];function ne(e){const{automationActionMenuStore:t,hasSearch:o,hasUpdateThisPagePropertyActions:a,onClose:h}=e,A=(0,p().v3)(),P=(0,j().tz)(),B=_(),{value:N}=(0,g().fJ)(T().QV.automationActionRegistry),{automationStore:W,contextType:z}=(0,E().q8)(),{maybePersistedTransactionActions:G,onActionAdded:q}=(0,D().b)(),$=(0,F().y)(W,z),Q=(0,O().V)(),Z="event"===z,J=(0,n.useMemo)((()=>Z?oe:te),[Z]),ne=(0,i().K8)((()=>t.getInsertionPoint()),[t]),[re,ae]=n.useState(""),se=(0,i().K8)((()=>o?function(e){const{automationActionRegistryModule:t,availableActions:o,searchInput:n}=e;if(!t||0===o.length)return[];const i=new Map,r=o.map((e=>{const t=y().A.formatMessage(e.display.name);return i.set(e.type,t),t})),a=new Set(s().filter(n,r).map((({original:e})=>e)));return o.filter((e=>{const t=i.get(e.type);return t&&a.has(t)}))}({automationActionRegistryModule:N,availableActions:Q,searchInput:re}):Q),[Q,o,re,N]),le=(0,i().K8)((()=>W.getActionStores().map((e=>e.getType())).filter(r().O9)),[W]),de=(0,n.useCallback)((e=>{if(!W)return;const t=W.getSpaceId(),{performResult:o}=G.createAndCommit({userAction:"AutomationActionList.addAction",perform:o=>V().addAutomationAction({actionId:(0,w().Z1)({environment:A,table:C().SC,spaceId:t}),actionType:e,automationStore:W,environment:A,insertionPoint:ne,intl:P,transaction:o,builderType:"modal"})});o&&((0,b().c_)(B,{automation_id:W.id,automation_action_id:o.id,automation_action_type:e,builder_type:"modal"}),null==q||q(o)),h()}),[W,G,h,A,ne,P,B,q]),ue=(0,i().K8)((()=>a&&$&&W?H({automationStore:W,collectionStore:$,searchInput:re}):[]),[W,$,a,re]),pe=(0,i().K8)((()=>Boolean(a&&$&&W&&H({automationStore:W,collectionStore:$,searchInput:""}).length>0)),[W,$,a]),me=(0,i().K8)((()=>null==$?void 0:$.getSchema()),[$]),ge=(0,c().r)(),ye=(0,i().K8)((()=>{var e;return null===(e=d().default.state.currentUserStore)||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.id}),[]),he=(0,R()._)({name:"premium_automations",spaceId:ge,userId:ye}),fe=(0,K().k)({onClose:h,upsell:null==he?void 0:he.upsell,from:"database_automation_modal_action_item"}),ve=(0,k().e2)(he),xe=(0,m().IS)((()=>({unavailableHeader:{display:"inline-flex",minWidth:0,whiteSpace:"pre",cursor:"pointer",color:I().Tj.text.secondary}})),[]),Se=(0,i().K8)((()=>{const e=[],n="button_block"===z||"button_property"===z,i=!n&&!ve,a=n&&!ve;o&&!i&&e.push(Y({onChange:e=>ae(e.target.value),value:re,placeholder:ee.searchInputPlaceholder,isInput:!0}));const s=J.reduce(((e,o)=>{if("automation_actions"===o)if(i||a){const[o,n]=M().jB(se,(e=>"send_gmail_notification"!==e.type&&"http_request"!==e.type&&"slack_notification"!==e.type)),i=ie({key:"automation_actions_available_section",actionRegistryItems:o,hasTopBorder:e.length>0,onMenuItemClick:de,automationActionMenuStore:t,premiumAutomationsAvailability:he,shouldShowUpdateThisPageProperties:"button_property"===z}),a=ie({key:"automation_actions_unavailable_section",actionRegistryItems:n,hasTopBorder:(0,r().O9)(i),hideChevron:!0,onMenuItemClick:fe,onClick:fe,automationActionMenuStore:t,premiumAutomationsAvailability:he,shouldShowUpdateThisPageProperties:"event"===z,title:(0,U.jsx)("div",{style:xe.unavailableHeader,onClick:fe,children:(0,U.jsx)(j().sA,{...ee.availablePlus})})});i&&e.push(i),a&&e.push(a)}else{const o=ie({actionRegistryItems:se,hasTopBorder:e.length>0,onMenuItemClick:de,automationActionMenuStore:t,premiumAutomationsAvailability:he,shouldShowUpdateThisPageProperties:pe&&"button_block"!==z&&(!re||ce(re))});o&&e.push(o)}else if("update_this_page_actions"===o){const o=me&&(ve||!Z)&&re.length>0&&X({automationActionMenuStore:t,hasTopBorder:e.length>0,normalizedBlockSchema:me,propertyIds:ue,includeTitle:!0});o&&e.push(o)}else(0,r().HB)(o);return e}),[]);return 0===s.length?e.push({key:"no_results_section",items:[{key:"no_results_item",action:()=>{},render:e=>(0,U.jsx)(v().A,{...e,disabled:!0,disabledFeedback:!0,title:(0,U.jsx)(j().sA,{defaultMessage:"No results",id:"automations.automationEventActionMenu.noResultsItem"})})}],render:e=>(0,U.jsx)(S().A,{...e})}):e.push(...s),e}),[t,ve,ue,se,me,z,o,pe,Z,de,fe,re,J,xe.unavailableHeader,he]);(0,n.useEffect)((()=>{(0,l().u)({environment:A,event:{eventName:"automation_action_menu_opened",eventProperties:{automation_id:W.id,automation_context_type:z,existing_action_types:le,available_action_types:Q.map((e=>e.type))}}})}),[Q,z,le,W,A]);let be=(0,L().e)({width:266});return u().A.isMobile||(be={...be,maxHeight:"50vh"}),(0,U.jsx)(f().A,{...be,children:(0,U.jsx)(x().A,{initialFocus:0,sections:Se,type:x().O.Vertical})})}function ie(e){const{actionRegistryItems:t,hasTopBorder:o,onMenuItemClick:n,onClick:i,automationActionMenuStore:a,shouldShowUpdateThisPageProperties:s,key:l,title:c,hideChevron:d,premiumAutomationsAvailability:u}=e,p=M().oE([s?se({hideChevron:d,onClick:()=>{(0,r().O9)(i)?i():a.pushSettingsItem({type:"updateThisPageProperties"})}}):void 0,...t.map((e=>function(e){const{actionRegistryItem:t,onClick:o,premiumAutomationsAvailability:n}=e;return{action:()=>o(t.type),key:`${t.type}_action`,render:e=>(0,U.jsx)(re,{...e,premiumAutomationsAvailability:n,actionRegistryItem:t})}}({premiumAutomationsAvailability:u,actionRegistryItem:e,onClick:n})))]);if(0!==p.length)return{key:l||"automation_actions_section",items:p,render:e=>(0,U.jsx)(S().A,{...e,topBorder:o,title:c})}}const re=(0,n.forwardRef)((function(e,t){const{actionRegistryItem:a,premiumAutomationsAvailability:s,...l}=e,u=a.display,{automationStore:p,contextType:g}=(0,E().q8)(),y=(0,i().K8)((()=>(0,o(367742).Z6)(p,g)),[p,g]),f=(0,o(59226).X)("upgrade_system_db_properties_automations"),x=(0,c().r)(),S=(0,o(920198).L)(),b=(0,i().K8)((()=>{var e;return null===(e=d().default.state.currentUserStore)||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.id}),[]),A=(0,B().P)({name:"premium_automations",spaceId:x,userId:b}),C=(0,n.useMemo)((()=>{if(A)return!1;return"button_block"===g||"button_property"===g?"send_gmail_notification"===a.type||"http_request"===a.type||"slack_notification"===a.type:void 0}),[a.type,g,A]),k=(0,i().K8)((()=>!!((0,r().O9)(a)&&(0,r().O9)(y)&&(0,r().O9)(a.isDisabledForContext))&&a.isDisabledForContext(y)),[a,y]),M=(0,m().IS)((()=>({row:{display:"grid",gridTemplateColumns:"auto auto 1fr",justifyContent:"flex-start",...(C||k)&&{color:I().Tj.text.tertiary,cursor:"default"}},badge:{...(C||k)&&{color:I().Tj.text.tertiary,backgroundColor:I().Tj.palette.translucentGray[75]}},tooltipHeader:{width:200},tooltipBody:{color:I().Tj.text.secondary},titleStyle:{whiteSpace:"normal",wordBreak:"break-word"},upgradeButtonContainer:{justifySelf:"flex-end",marginInlineStart:"auto"}})),[k,C]),T=(0,n.useMemo)((()=>{switch(a.type){case"send_gmail_notification":return(0,U.jsx)(o(515918).A,{style:M.badge});case"define_variables":return(0,U.jsx)(o(147294).Ee,{newBadgeKey:"define_variables_automation_action",didUserEngage:!1,keyType:"date",style:M.badge});default:return}}),[a.type,M.badge]);return u?(0,U.jsx)(h().m,{textWrap:!0,placement:"right",alignment:"end",disableTooltip:!k,renderTooltip:()=>(0,U.jsxs)("div",{style:M.tooltipHeader,children:[(0,U.jsx)("div",{children:(0,U.jsx)(j().sA,{...ee.disabledActionTooltipHeader})}),(0,U.jsx)("div",{style:M.tooltipBody,children:(0,U.jsx)(j().sA,{...ee.disabledActionTooltipBody})})]}),render:e=>(0,U.jsx)(v().A,{...l,...e,disabled:k,icon:(0,U.jsx)(ae,{type:"actionRegistry",actionRegistryItem:a,disabled:k||C}),ref:t,right:f?(0,U.jsxs)(o(249046).Ye,{alignItems:"center",justifyContent:"space-between",children:[T,(0,U.jsx)("div",{style:M.upgradeButtonContainer,children:C&&"unavailable"===(null==s?void 0:s.type)?(0,U.jsx)(o(704658).UpgradeButton,{upsell:s.upsell,source:"database_automation_action_item",display:"icon",featureName:"premium_automations",spaceStore:S}):void 0})]}):T,rightStyle:{marginInlineStart:void 0},title:(0,U.jsx)(j().sA,{...u.name}),titleStyle:M.titleStyle,style:M.row})}):null}));function ae(e){const t="actionRegistry"===e.type&&"send_gmail_notification"===e.actionRegistryItem.type,o="actionRegistry"===e.type&&"slack_notification"===e.actionRegistryItem.type,n=(0,m().IS)((()=>({icon:{fill:e.disabled?I().Tj.text.tertiary:I().Tj.icon.secondary,height:"auto",width:A().Ev.default,opacity:(t||o)&&e.disabled?.4:1},iconWrap:{alignItems:"center",borderRadius:4,display:"flex",height:20,justifyContent:"center",width:20}})),[t,o,e.disabled]);return(0,U.jsx)("div",{style:n.iconWrap,children:"actionRegistry"===e.type?e.actionRegistryItem.display.icon(n.icon):"icon"===e.type?e.icon(n.icon):(0,r().HB)(e)})}function se(e){const{onClick:t,hideChevron:o}=e;return{action:()=>t(),key:"update_this_page_properties",render:e=>(0,U.jsx)(le,{...e,hideChevron:o})}}const le=(0,n.forwardRef)((function(e,t){const{hideChevron:n}=e,{contextType:r}=(0,E().q8)(),a=(0,c().r)(),s=(0,i().K8)((()=>{var e;return null===(e=d().default.state.currentUserStore)||void 0===e||null===(e=e.getModel())||void 0===e?void 0:e.id}),[]),l=(0,B().P)({name:"premium_automations",spaceId:a,userId:s}),u=(0,m().IS)((()=>({row:{...!l&&"event"===r&&{color:I().Tj.text.tertiary}}})),[r,l]);return(0,U.jsx)(v().A,{...e,icon:(0,U.jsx)(ae,{type:"icon",icon:o(735790).M}),ref:t,showExtensionArrow:!n,title:(0,U.jsx)(j().sA,{...ee.updateThisPagePropertiesMenuItemCaption}),style:u.row})}));function ce(e){const t=y().A.formatMessage(ee.updateThisPagePropertiesMenuItemCaption);return s().test(e,t)}o(18107),o(967357),o(672577);var de=()=>o(118884),ue=()=>o(352271),pe=()=>o(79118),me=()=>o(748580),ge=()=>o(898244),ye=()=>o(791089),he=()=>o(201980),fe=()=>o(284371),ve=()=>o(384944),xe=()=>o(39620),Se=()=>o(133518);const be=(0,j().YK)({menuHeaderTitle:{defaultMessage:"Set {propertyName} to",id:"automations.eventActionProperty.menuHeaderTitle"},menuHeaderEditTitle:{defaultMessage:"Edit {propertyName}",id:"automations.eventActionProperty.menuHeaderEditTitle"}});function Ae(e){var t;const{actionId:o,automationActionMenuStore:a,onClose:s,propertyId:l}=e,{automationStore:c,contextType:d}=(0,E().q8)(),u=(0,F().y)(c,d),{maybePersistedTransactionActions:m,onActionAdded:g}=(0,D().b)(),y=(0,j().tz)(),f=(0,p().v3)(),v=_(),x=(0,i().K8)((()=>a.getInsertionPoint()),[a]),S=(0,n.useMemo)((()=>u?{collectionStore:u,property:l,type:"collection"}:void 0),[u,l]),A=(0,i().K8)((()=>c.getSpaceId()),[c]),k=o??(0,w().Z1)({environment:f,table:C().SC,spaceId:A}),I=(0,i().K8)((()=>{const e=((null==c?void 0:c.getActionStores())??[]).find((e=>e.id===k));if(e&&e.isType("update_pages"))return e}),[c,k]),M=(0,i().K8)((()=>null==u?void 0:u.getSchema()[l]),[u,l]),T=(0,n.useMemo)((()=>{if(M&&(0,N().I3)(M))return N().Yy[M.type]}),[M]),P=(0,n.useMemo)((()=>!!M&&("multi_select"===M.type||(0,ge().sO)(M)&&1!==M.limit)),[M]),B=Boolean(M&&"button"!==M.type&&"rollup"!==M.type&&"formula"!==M.type&&"text"===(0,me().IS)(M.type)),R=Boolean(M&&"button"!==M.type&&"rollup"!==M.type&&"formula"!==M.type&&"number"===(0,me().IS)(M.type)),L=Boolean(M&&"date"===M.type),O=Boolean(M&&"status"===M.type),K=(0,i().K8)((()=>{if(u&&M)return(0,ye().setPropertyValueToSimpleFormulaReturnType)(u.getSpaceShardedPointer(),l,M)}),[u,M,l]),W=(0,i().K8)((()=>{if(I)return I.getConfigStore().getKeyStore("values").getKeyStore(l).getValue()}),[I,l]),[z,H]=(0,n.useState)(W),Y=(0,n.useRef)({action:(null==W?void 0:W.action)||ue().yP,value:null==W?void 0:W.value}),G=(0,n.useMemo)((()=>{var e;return(0,ye().fromSimpleFormulaArrayValue)(null==z||null===(e=z.value)||void 0===e?void 0:e.value)}),[null==z||null===(t=z.value)||void 0===t?void 0:t.value]),$=(0,Se().F)({actionId:null==I?void 0:I.id}),Q=(0,n.useCallback)((({action:e,value:t})=>{if(!c)return;const{performResult:o}=m.createAndCommit({perform:o=>{if(!I)return V().addAutomationAction({actionId:k,actionType:"update_pages",automationStore:c,config:{properties:[l],target:{id:(0,pe().KI)(),type:"variable"},values:{[l]:{action:e,value:t}}},environment:f,intl:y,insertionPoint:x,transaction:o,builderType:"modal"});ve().zv({data:{[l]:{action:e,value:t}},store:I.getConfigStore().getKeyStore("values"),transaction:o})},userAction:"UpdateThisPagePropertyActionMenu.saveChanges"});o&&((0,b().c_)(v,{automation_id:c.id,automation_action_id:o.id,automation_action_type:"update_pages"}),null==g||g(o))}),[I,c,f,v,k,x,y,m,g,l]),X=(0,n.useRef)(!1),Z=!O,J=(0,n.useCallback)((()=>{X.current=!0,(Z||(0,r().O9)(Y.current.value))&&Q(Y.current),s()}),[Q,s,Z]);(0,de().X)((()=>{const e=a.getState().stack.at(-1);!X.current&&(0,r().O9)(e)&&"eventActionProperty"===e.type&&J()}));const ee=(0,n.useCallback)(((e,t)=>{const o=t||ue().yP,n=Y.current.value;Y.current={value:e,action:o};if("formula"===(null==e?void 0:e.type))return void H({action:o,value:e});if("formula"===(null==n?void 0:n.type))H({action:o,value:e});else if(B||R||P||(0,r().O9)(t))H({action:o,value:e});else if(L){const t=(0,ye().fromSimpleFormulaArrayValue)(null==e?void 0:e.value)[0];if((0,r().O9)(t)&&(0,ye().isAnnotationSimpleValueToken)(t)&&(0,he().qsB)(t))return void H({action:o,value:e});J()}}),[L,B,R,P,J]),te="person"===(null==M?void 0:M.type)||"relation"===(null==M?void 0:M.type)||"multi_select"===(null==M?void 0:M.type),oe=te?be.menuHeaderEditTitle:be.menuHeaderTitle,ne=(0,q().r)({triggerActionMenuStore:a,customMenuProps:{leftOuterStyle:{flexGrow:0},rightOuterStyle:{flexGrow:0},titleOuterStyle:{minWidth:0}},onClose:s,onDone:J,title:(0,U.jsx)("div",{style:{display:"inline-flex",minWidth:0,whiteSpace:"pre"},children:y.formatMessage(oe,{propertyName:(0,U.jsx)(h().m,{placement:"bottom",render:e=>(0,U.jsx)("div",{...e,style:{...fe().RC},children:(null==M?void 0:M.name)??""}),renderTooltip:()=>(null==M?void 0:M.name)??""})})})});return M&&K&&S?(0,U.jsx)(xe().L,{allowedFormulaReturnTypes:T,formulaValueContext:S,currentSimpleFormulaValueTokens:G,formulaTypecheckContextValues:$,menuProps:ne,onChange:ee,onClose:J,parentRecordStore:c,showClearButton:!O,type:K,value:null==z?void 0:z.value,action:(0,ue().tz)(z),showReplaceAddRemoveToggle:te}):null}var Ce=()=>o(106702),ke=()=>o(365917),je=()=>o(770063),Ie=()=>o(631524),Me=()=>o(160432),Te=()=>o(148307),we=()=>o(617871),Pe=()=>o(402904),_e=()=>o(973647),Be=()=>o(457583),Re=()=>o(747938);function Ve(e){const{type:t,automationActionMenuStore:o,onClose:n}=e,r=Oe(),a=(0,c().r)(),s=(0,Ce().$)(),l="connectToSlackReconnect"===t?e.externalBotId:void 0,d=(0,i().K8)((()=>{if(void 0!==l&&s)return(0,je().v3)(s,{table:Pe().As,id:l,spaceId:a}).getValue()}),[l,s,a]);let u,p=Le({viewType:"connectToSlackDefault"});if("connectToSlackReconnect"===t){if(!d)return null;const{accountName:e,organizationName:t}=(0,Re().qO)(d);u=(0,Re().Dy)(d),p=Le({viewType:"connectToSlackReconnect",accountName:e,organizationName:t})}return(0,U.jsx)(q().A,{type:"custom",triggerActionMenuStore:o,onClose:n,children:(0,U.jsx)(S().A,{children:(0,U.jsxs)("div",{style:r.container,children:[(0,U.jsx)(Fe,{}),(0,U.jsxs)("div",{style:r.connectToSlackBody,children:[(0,U.jsx)("div",{style:r.connectToSlackTitleText,children:De(t)}),(0,U.jsx)("div",{style:r.connectToSlackDescriptionText,children:p})]}),(0,U.jsx)(Ee,{...e,slackWorkspaceId:u})]})})})}function Ee(e){const{automationActionMenuStore:t,slackWorkspaceId:o}=e,n=(0,p().v3)(),a=Oe(),s=(0,c().r)(),l=(0,i().K8)((()=>ke().A.integrations.state.find((e=>e.id===we().zG))),[]);return l&&s?(0,U.jsxs)("div",{style:a.buttonGroup,children:[(0,U.jsx)(Me().A,{colorPalette:"blue",style:a.connectToSlackButton,size:"lg",onClick:async()=>{const i=await Be().Jq({environment:n,integration:l,spaceId:s,from:"collection_view_settings",options:{slackWorkspaceId:o}});_e().Q.isFail(i)?t.replaceSettingsItem({actionStore:e.actionStore,type:"selectWorkspace"}):"connectToSlackReconnect"===e.type||("connectToSlackDefault"===e.type?i.value.externalAuthentication?t.replaceSettingsItem({type:"selectChannelNew",currentExternalAuthentication:i.value.externalAuthentication,actionStore:e.actionStore}):t.replaceSettingsItem({actionStore:e.actionStore,type:"selectWorkspace"}):(0,r().HB)(e))},children:(0,U.jsx)(j().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.connectButton.label",defaultMessage:"Connect"})}),(0,U.jsx)(Ie().p,{style:a.cancelButton,size:"lg",onClick:()=>{t.popSettingsItem()},children:(0,U.jsx)(j().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.cancelButton.label",defaultMessage:"Cancel"})})]}):null}function Fe(){const e=Oe();return(0,U.jsx)("div",{children:(0,U.jsx)("img",{src:Te().A.images.externalIntegrations.slackIconPng,style:e.slackIcon})})}function De(e){return"connectToSlackDefault"===e?(0,U.jsx)(j().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.title",defaultMessage:"Connect to Slack"}):"connectToSlackReconnect"===e?(0,U.jsx)(j().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.reconnect.title",defaultMessage:"Reconnect to Slack"}):void(0,r().HB)(e)}function Le(e){const{viewType:t}=e;return"connectToSlackDefault"===t?(0,U.jsx)(j().sA,{id:"notificationRuleSettingsSetupSlackView.connectToSlackView.description",defaultMessage:"Get notified in channels, see rich previews, and more."}):"connectToSlackReconnect"===t?(0,U.jsx)(j().sA,{id:"AutomationSlackConnectToSlackView.reconnect.description",defaultMessage:"Reconnect your Slack account ({accountName}) on {hasOrganizationName, select, true {{organizationName}} other {your Slack workspace}} to resume your notifications.",values:{accountName:e.accountName,hasOrganizationName:(0,r().O9)(e.organizationName),organizationName:e.organizationName}}):void(0,r().HB)(t)}function Oe(){return(0,m().IS)((()=>({container:{display:"flex",flexDirection:"column",margin:"10px 15px",justifyContent:"center",textAlign:"center"},connectToSlackBody:{margin:"0px 25px"},connectToSlackTitleText:{marginBottom:2,fontWeight:fe().Wy.semibold},connectToSlackDescriptionText:{fontSize:13,color:I().Tj.text.secondary},slackIcon:{width:23,height:"auto"},buttonGroup:{marginTop:10,marginInlineEnd:10,marginBottom:0,marginInlineStart:10},connectToSlackButton:{width:"100%"},cancelButton:{color:I().Tj.text.secondary,width:"100%",justifyContent:"center",fontWeight:fe().Wy.medium,fontSize:13,marginTop:8}})),[])}var Ke=()=>o(159958);function Ne(e){const{actionStore:t,automationActionMenuStore:o,onClose:i}=e,{maybePersistedTransactionActions:a}=(0,D().b)(),s=n.useCallback(((e,o)=>{t&&a.createAndCommit({perform:n=>{var i;ve().zv({data:{config:{external_bot_id:o,target:{id:e.id,name:"",type:e.type},custom_message:null===(i=t.getConfig())||void 0===i?void 0:i.custom_message}},store:t,transaction:n})},userAction:"SlackSelectChannelMenu.handleChannelSelect"}),i()}),[t,a,i]),l=(0,n.useCallback)((()=>{const e=o.getState().stack;e.length<2||("selectWorkspace"===e[e.length-2].type?o.popSettingsItem():o.replaceSettingsItem({actionStore:t,type:"selectWorkspace"}))}),[t,o]),c="selectChannelNew"===e.type?void 0:"selectChannelUpdate"===e.type?e.currentNotificationChannel:(0,r().HB)(e),d=(0,n.useMemo)((()=>c?[c]:void 0),[c]);return(0,U.jsx)(Ke().pj,{currentExternalAuthentication:e.currentExternalAuthentication,currentNotificationChannels:d,onClose:i,onNotificationChannelSelect:s,onNewSlackAccountAdded:l,renderMenu:e=>(0,U.jsx)(q().A,{type:"default",triggerActionMenuStore:o,headerTitle:(0,U.jsx)(j().sA,{id:"notificationRuleSettings.selectChannelView.title",defaultMessage:"Select Slack channel"}),sections:e,onClose:i})})}var We=()=>o(807449),ze=()=>o(158115),Ue=()=>o(344417);const He=(0,j().YK)({workspaceSearchPlaceholder:{id:"notificationRuleSettings.selectWorkspaceView.searchInput.placeholder",defaultMessage:"Search"}});function Ye(e){const t=(0,j().tz)(),{onWorkspaceSelect:o,renderMenu:r,workspaceFilter:a,onNewSlackAccountAdded:s}=e,l=(0,p().v3)(),d=(0,c().r)(),m=(0,i().K8)((()=>(0,Re().l$)(ke().A.completeSlackAuthentications.state,a)),[a]),g=(0,i().K8)((()=>ke().A.integrations.state.find((e=>e.id===we().zG))),[]),[y,h]=n.useState("");if(!g)return null;const f=Object.entries((0,Re().Os)(m,y)).map((([e,t],n)=>({key:e,items:t.map((({workspaceName:e,externalAuthentication:t})=>({key:t.id,action:()=>{o(t)},render:t=>(0,U.jsx)(v().A,{...t,title:e??(0,U.jsx)(j().sA,{id:"notificationRuleSettings.selectWorkspace.untitledWorkspace",defaultMessage:"Slack workspace"}),right:(0,U.jsx)(We().I,{icon:ze().arrowChevronSingleRightFillSmallIcon,size:"xs",colorVariant:"tertiary"})})}))),render:t=>(0,U.jsx)(S().A,{...t,title:e,topBorder:0!==n})})));return f.unshift({key:"search-input-section",items:[{key:"search-input-item",action:()=>{},render:e=>(0,U.jsx)("div",{children:(0,U.jsx)(z().Ay,{...e,inputLeft:(0,U.jsx)(z().Zf,{icon:Ue().magnifyingGlassSmallIcon}),showClearButton:!0,placeholder:t.formatMessage(He.workspaceSearchPlaceholder),focus:!u().A.isMobile||void 0,value:y,onChange:e=>{h(e.target.value)}})})}],render:e=>(0,U.jsx)(S().A,{...e})}),f.push({key:"add-another-slack-account-section",items:[{key:"add-another-slack-account-item",action:async()=>{if(!d)return;const e=await Be().Jq({environment:l,integration:g,spaceId:d,from:"collection_view_settings"});_e().Q.isFail(e)||e.value.externalAuthentication&&(o(e.value.externalAuthentication),null==s||s())},render:e=>(0,U.jsx)(v().A,{...e,icon:(0,U.jsx)("img",{src:Te().A.images.externalIntegrations.slackIconPng,style:{width:18,height:"auto"}}),title:(0,U.jsx)(j().sA,{id:"notificationRuleSettings.selectWorkspaceView.setupAnotherSlackAccount.label",defaultMessage:"Add another Slack account"})})}],render:e=>(0,U.jsx)(S().A,{...e,topBorder:!0})}),(0,U.jsx)(U.Fragment,{children:r(f)})}function Ge(e){const{automationActionMenuStore:t,onClose:o}=e,i=n.useCallback((o=>{t.pushSettingsItem({actionStore:e.actionStore,type:"selectChannelNew",currentExternalAuthentication:o})}),[t,e.actionStore]);return(0,U.jsx)(Ye,{onWorkspaceSelect:i,renderMenu:e=>(0,U.jsx)(q().A,{type:"default",triggerActionMenuStore:t,headerTitle:(0,U.jsx)(j().sA,{id:"notificationRuleSettings.selectSlackWorkspace.title",defaultMessage:"Select Slack workspace"}),sections:e,onClose:o})})}const qe=(0,n.createContext)({menuStore:void 0});function $e(e){const{initialState:t,insertionPoint:o,onClose:s}=e,l=(0,i().K8)((()=>{const e=new(a().e);return e.setState({insertionPoint:o,stack:[t]}),e}),[t,o]),c=(0,i().K8)((()=>l.getCurrentTab()),[l]),d=(0,n.useCallback)((()=>null==s?void 0:s()),[s]);if(!c)return null;let u;if("connectToSlackDefault"===c.type)u=(0,U.jsx)(Ve,{actionStore:c.actionStore,automationActionMenuStore:l,onClose:d,type:"connectToSlackDefault"});else if("connectToSlackReconnect"===c.type)u=(0,U.jsx)(Ve,{actionStore:c.actionStore,automationActionMenuStore:l,externalBotId:c.externalBotId,notificationActionConfigStore:c.notificationActionConfigStore,onClose:d,type:"connectToSlackReconnect"});else if("selectWorkspace"===c.type)u=(0,U.jsx)(qe.Provider,{value:{menuStore:l},children:(0,U.jsx)(Ge,{actionStore:c.actionStore,automationActionMenuStore:l,onClose:d})});else if("selectChannelNew"===c.type)u=(0,U.jsx)(Ne,{actionStore:c.actionStore,automationActionMenuStore:l,currentExternalAuthentication:c.currentExternalAuthentication,onClose:d,type:"selectChannelNew"});else if("selectChannelUpdate"===c.type)u=(0,U.jsx)(Ne,{actionStore:c.actionStore,automationActionMenuStore:l,currentExternalAuthentication:c.currentExternalAuthentication,currentNotificationChannel:c.currentNotificationChannel,onClose:d,type:"selectChannelUpdate"});else if("eventActions"===c.type)u=(0,U.jsx)(ne,{automationActionMenuStore:l,hasUpdateThisPagePropertyActions:c.hasUpdateThisPagePropertyActions,hasSearch:c.hasSearch,onClose:d});else if("eventActionProperty"===c.type){const{propertyId:e,actionId:t}=c;u=(0,U.jsx)(Ae,{actionId:t,automationActionMenuStore:l,onClose:d,propertyId:e})}else"updateThisPageProperties"===c.type?u=(0,U.jsx)(Q,{automationActionMenuStore:l,onClose:d}):(0,r().HB)(c);return(0,U.jsx)(qe.Provider,{value:{menuStore:l},children:u})}qe.displayName="AutomationActionMenuContext"},439616:(e,t,o)=>{o.d(t,{A:()=>L});o(944114),o(581454);var n=o(296540),i=()=>o(664594),r=()=>o(59226),a=()=>o(726637),s=()=>o(484714),l=()=>o(590526),c=()=>o(401497),d=()=>o(609679),u=()=>o(250910),p=()=>o(807449),m=()=>o(546926),g=()=>o(302501),y=()=>o(890492),h=()=>o(81068),f=()=>o(663639),v=()=>o(736847),x=()=>o(869190),S=()=>o(68263),b=()=>o(84262),A=()=>o(69708),C=()=>o(100622),k=()=>o(720665),j=()=>o(662971),I=()=>o(573710),M=()=>o(180252),T=()=>o(118849),w=()=>o(528093),P=()=>o(134217),_=()=>o(408543),B=()=>o(704658),R=o(474848);function V(e,t){const{permissionItem:n,hideIcon:i,onChange:r,buttonStyle:s}=e,{spaceStore:l,...c}=e;return(0,R.jsx)(o(811979).A,{...c,popupType:a().A.isMobile?u().z.SlideUp:u().z.Popup,renderOrigin:e=>(0,R.jsx)(o(585293).a,{...(0,o(383036).A)(c,e),ref:t,title:(0,R.jsx)(A().sA,{defaultMessage:"Link expires",id:"publishSiteSettings.linkExpiration.settingTitle"}),icon:!i&&(0,R.jsx)(p().I,{icon:o(274570).clockIcon,colorVariant:"secondary"}),right:(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(E,{permissionItem:n}),(0,R.jsx)(p().I,{icon:o(324254).arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"})]}),buttonStyle:s}),alignmentToOrigin:"end",placementToOrigin:"bottom",render:e=>(0,R.jsx)(F,{spaceStore:l,value:n.expiration_timestamp,onChange:r,onClose:()=>{e.close()}})})}function E(e){const{permissionItem:t}=e,o=(0,A().tz)(),n=(0,c().IS)((()=>({container:{color:C().Tj.text.secondary}})),[]);if(!t.expiration_timestamp||(0,S().OA)(t))return(0,R.jsx)(g().A,{style:n.container,children:(0,R.jsx)(A().sA,{defaultMessage:"Never",id:"publishSiteSettings.linkExpiration.never"})});const i=x().jE(t.expiration_timestamp,d().locale,o);return(0,R.jsx)(g().A,{style:n.container,children:i})}function F(e){const{value:t,onChange:o,onClose:u,spaceStore:p}=e,g=(0,s().v3)(),x=(0,r().X)("upgrade_system_sharing"),S=(0,l().K8)((()=>!P().qC()),[]),j=(0,l().K8)((()=>P().Si(g)),[g]),I=(0,n.useCallback)((e=>{void 0!==e&&e<=(new Date).getTime()||(o(e),u())}),[o,u]),M=(0,i().T)(),V=(0,w()._)({spaceId:null==p?void 0:p.id,userId:M,name:"link_expiration"}),{handleClick:E}=(0,_().C)({upsell:null==V?void 0:V.upsell,source:"public_permission_item_expiration",spaceStore:p}),F=(0,c().IS)((()=>({disabledContainer:{display:"flex",gap:6},disabledText:{color:C().Tj.text.tertiary}})),[]),L=function(){const e=Date.now(),t=e+k().pT,o=e+k().nD,n=e+7*k().nD;return[{key:"none",time:void 0,title:(0,R.jsx)(A().sA,{defaultMessage:"Never",id:"publishSiteSettings.linkExpiration.never"})},{key:"hour",time:t,title:(0,R.jsx)(A().sA,{defaultMessage:"In an hour",id:"publishSiteSettings.linkExpiration.oneHour"}),caption:new Intl.DateTimeFormat(d().locale,{hour:"numeric",minute:"numeric"}).format(t)},{key:"day",time:o,title:(0,R.jsx)(A().sA,{defaultMessage:"In a day",id:"publishSiteSettings.linkExpiration.oneDay"}),caption:new Intl.DateTimeFormat(d().locale,{day:"numeric",month:"long",hour:"numeric",minute:"numeric"}).format(o)},{key:"week",time:n,title:(0,R.jsx)(A().sA,{defaultMessage:"In a week",id:"publishSiteSettings.linkExpiration.oneWeek"}),caption:new Intl.DateTimeFormat(d().locale,{day:"numeric",month:"long",hour:"numeric",minute:"numeric"}).format(n)}]}().map((e=>({key:e.key,action:()=>{I(e.time)},render:t=>(0,R.jsx)(h().A,{...t,title:e.title,titleStyle:S?F.disabledText:{},caption:e.caption,captionStyle:S?F.disabledText:{},disabled:S})}))),O=[{key:"predefined-expiration",render:e=>(0,R.jsx)(v().A,{...e}),items:L},{key:"custom-expiration",render:e=>(0,R.jsx)(v().A,{...e,topBorder:!0}),items:[D(I,t,S,F.disabledText)]}];return j&&S&&!x&&O.push({key:"upgrade-for-expiration",render:e=>(0,R.jsx)(v().A,{...e,topBorder:!0}),items:[{key:"upsell",action:()=>E(),render:e=>(0,R.jsx)(h().A,{...e,focused:e.focused,title:(0,R.jsxs)("div",{style:F.disabledContainer,children:[(0,R.jsx)(A().sA,{defaultMessage:"Unlock link expiration",id:"publishSiteSettings.linkExpiration.upgrade"}),(0,R.jsx)(T().u,{spaceStore:p,subscriptionTier:j,analyticsName:"public_permission_item_expiration"})]})})}]}),(0,R.jsxs)(y().A,{menuType:a().A.isMobile?m().gu.ActionSheet:m().gu.Popup,width:271,children:[x&&S&&(0,b().wy)(null==V?void 0:V.upsell)?(0,R.jsx)("div",{style:{paddingTop:10,paddingInlineEnd:10,paddingBottom:4,paddingInlineStart:10},children:(0,R.jsx)(B().UpgradeButton,{source:"public_permission_item_expiration",display:"button",upsell:V.upsell,spaceStore:p})}):void 0,(0,R.jsx)(f().A,{type:f().O.Vertical,initialFocus:void 0,sections:O})]})}function D(e,t,o,n={}){return{key:"custom",action:()=>{window.parent.close()},render:(i,r)=>(0,R.jsx)(j().A,{...i,renderOrigin:e=>(0,R.jsx)(h().A,{...e,disabled:o,title:(0,R.jsx)(A().sA,{id:"publicPermissionItem.expiration.chooseDate",defaultMessage:"Choose date"}),titleStyle:o?n:{}}),onFocus:r.onFocus,disableDefaultClick:!0,renderExtension:(n,i)=>(0,R.jsx)("div",{style:{padding:"18px 14px 14px"},children:(0,R.jsx)(I().A,{...n,firstDayOfWeek:M().XX.state,value:t||Date.now(),onChange:t=>{e(t),i.close()},disabledDays:o||{before:new Date}})})})}}const L=n.forwardRef(V)},448801:(e,t,o)=>{o.d(t,{i:()=>i});o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698);var n=()=>o(371562);n();function i(e,t){const o=n().create({arrays:{detectMove:!1,includeValueOnMove:!0}}).diff(e,t);if(!o)return{beforeOps:{},removeOps:new Set};let i=[],r=[];for(const n in o)"_t"!==n&&("_"===n[0]?i.push(parseInt(n.slice(1),10)):1===o[n].length&&r.push({index:parseInt(n,10),value:o[n][0]}));const a={},s=new Set,l=[...e];i=i.sort(((e,t)=>e-t));for(let n=i.length-1;n>=0;n--){const e=i[n],t=l.splice(e,1)[0];s.add(t)}r=r.sort(((e,t)=>e.index-t.index));for(let n=0;n<r.length;n++){const e=r[n];a[e.value]=l[e.index],l.splice(e.index,0,e.value)}return{beforeOps:a,removeOps:s}}},457717:(e,t,o)=>{o.d(t,{F:()=>n});const n=new(o(118307).A)},458267:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().Store{getInitialState(){return{open:!1}}}const i=new n;(0,o(852832).exposeDebugValue)("AutomationModalStore",i);const r=i},463438:(e,t,o)=>{o.d(t,{Jy:()=>c,LZ:()=>d,vU:()=>l});o(581454);var n=o(296540),i=()=>o(100622),r=()=>o(546926),a=o(474848);function s({tabs:e,selectedIndex:t,onChange:s,separatorIndexes:d,right:u,style:p,rightStyle:m,tabStyle:g,tabTitleStyle:y,selectedTabTitleStyle:h,tabBorderStyle:f,selectedTabStyle:v,readOnly:x,hideTabBorder:S,idPrefix:b,hideTabIndexes:A}){const C=(0,n.useContext)(r().xu),{WindowSizeStore:k}=(0,o(484714).v3)(),{safePaddingLeft:j,safePaddingRight:I}=(0,o(590526).K8)((()=>({safePaddingLeft:k.getSafePaddingLeftCSS(16),safePaddingRight:k.getSafePaddingRightCSS(16)})),[k]),M=(0,o(401497).IS)((()=>{const e={paddingTop:6,paddingBottom:6,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:i().Tj.text.secondary,...g},t=`inset 0 -1px 0 ${i().Tj.border.secondaryTranslucent}`,n=C.menuType===r().gu.Popup,a={fontSize:16,paddingTop:2,paddingInlineStart:n?16:j,paddingInlineEnd:n?16:I,zIndex:2,height:44,background:i().Tj.popoverBackground};return{container:{overflowY:"visible",overflowX:"auto",display:"flex",width:"100%",position:"relative",boxShadow:S?void 0:t,...o(726637).A.isMobile?a:{fontSize:14,paddingInlineStart:8,paddingInlineEnd:8,zIndex:1},...p},separator:{display:"inline-flex",alignItems:"center",margin:"0 4px",paddingBottom:4,whiteSpace:"nowrap",minWidth:0,flexShrink:0,color:i().Tj.border.secondaryTranslucent},tab:e,selectedTab:{...e,position:"relative",color:i().Tj.text.primary,...v},border:{borderBottom:`2px solid ${i().Tj.text.primary}`,position:"absolute",bottom:0,insetInlineStart:8,insetInlineEnd:8,...f},rightContainer:{flexGrow:1,display:"flex",alignItems:"center",justifyContent:"flex-end",color:i().Tj.text.secondary,...m}}}),[C.menuType,m,j,I,v,p,f,g,S]);return(0,a.jsxs)("div",{className:"hide-scrollbar",style:M.container,role:"tablist",children:[e.map(((e,i)=>{if(null!=A&&A.includes(i))return null;const r=i===t;return(0,a.jsxs)(n.Fragment,{children:[(0,a.jsxs)("div",{style:r?M.selectedTab:M.tab,children:[(0,a.jsx)(o(631524).p,{role:"tab",style:{...y,...r?h:{}},onClick:()=>s(i),disabled:x,"aria-selected":r,id:l(b,i),"aria-controls":c(b,i),colorPalette:r?void 0:"gray",children:e}),r?(0,a.jsx)("div",{style:M.border}):void 0]},`tabButton-${i}`),d&&d.includes(i)?(0,a.jsx)("div",{style:M.separator,className:"notranslate",children:"|"},`${i}-separator`):void 0]},i)})),u?(0,a.jsx)("div",{style:M.rightContainer,children:u}):void 0]})}function l(e,t){if(e)return`${e}-tab-${t}`}function c(e,t){if(e)return`${e}-tabpanel-${t}`}const d=n.memo(s)},464004:(e,t,o)=>{o.d(t,{l:()=>x});var n=o(296540),i=()=>o(484714),r=()=>o(590526),a=()=>o(401497),s=()=>o(250910),l=()=>o(890492),c=()=>o(852424),d=()=>o(340498),u=()=>o(69708),p=()=>o(100622),m=()=>o(284371),g=()=>o(380468),y=()=>o(781697),h=()=>o(656134),f=()=>o(548526),v=o(474848);function x(e){const{alreadyHaveProperties:t,availablePropertyIds:o,collectionStore:x,currentValue:S,disabled:b,onChange:A,onRemove:C,placeholderMessage:k,errorMessage:j,hideErrorMessageTooltip:I}=e,M=(0,i().v3)(),T=(0,a().DP)(),{device:w}=M,P=(0,r().K8)((()=>x.getSchema()??{}),[x]),_=(0,r().K8)((()=>x.getFormat()??{}),[x]),B=(0,r().K8)((()=>S?x.getSchema()[S]:void 0),[S,x]),R=(0,r().K8)((()=>S?x.getDeletedSchema()[S]:void 0),[S,x]),V=(0,a().IS)((()=>{const e={fill:p().Tj.text.tertiary,marginInlineEnd:4};return{propertyIcon:e,deletedPropertyIcon:{...e,fill:p().Tj.red.text.accentPrimary},propertyTitle:{fontWeight:m().Wy.regular,...m().RC},deletedPropertyTitle:{color:p().Tj.red.text.accentPrimary,fontWeight:m().Wy.regular,...m().RC}}}),[]),E=(0,n.useCallback)((()=>o),[o]),F=(0,h().j)(),D=(0,n.useMemo)((()=>B?function(e){return(0,v.jsx)(c().zB,{icon:void 0,size:d().Ev.sm,style:{...e,...V.propertyIcon},theme:T,type:B.type})}:R?function(e){return(0,v.jsx)(c().zB,{icon:void 0,type:R.type,size:d().Ev.sm,theme:T,style:{...e,...V.deletedPropertyIcon}})}:void 0),[R,B,V.deletedPropertyIcon,V.propertyIcon,T]),L=Boolean(j),O=!Boolean(B)&&!Boolean(t),K=!Boolean(t);return(0,v.jsx)(s().A,{popupType:F,alignmentToOrigin:"center",placementToOrigin:"bottom",originGap:0,disabled:b,renderOrigin:e=>(0,v.jsx)(f().x,{...e,disabled:b,icon:D,isError:L,hasActionRequired:O,isSecondary:K,tooltipMessage:!I&&j,dropdownButtonType:"button",children:B?(0,v.jsx)("div",{style:V.propertyTitle,children:B.name}):R?(0,v.jsx)("div",{style:V.deletedPropertyTitle,children:R.name}):k?(0,v.jsx)(u().sA,{...k}):t?(0,v.jsx)(u().sA,{id:"automations.propertyPicker.buttonPlaceholderAlreadyHaveProperties",defaultMessage:"Edit property"}):(0,v.jsx)(u().sA,{id:"automations.propertyPicker.buttonPlaceholder",defaultMessage:"Edit a property"})}),render:e=>{const t=(0,y().v)({device:w,width:280,paddingTop:4});return(0,v.jsx)(l().A,{...t,children:(0,v.jsx)(g().A,{schema:P,format:_,showRemoveOption:Boolean(C),currentProperty:S,getProperties:E,onAccept:t=>{t&&t!==S?A(t):void 0===t&&(null==C||C(S)),e.close()}})})}})}},475679:(e,t,o)=>{o.d(t,{z:()=>O});o(898992),o(354520),o(737550);var n=o(296540),i=()=>o(484714),r=()=>o(590526),a=()=>o(401497),s=()=>o(79926),l=()=>o(807449),c=()=>o(552712),d=()=>o(890492),u=()=>o(81068),p=()=>o(663639),m=()=>o(736847),g=()=>o(655923),y=()=>o(112282),h=()=>o(457056),f=()=>o(334003),v=()=>o(764781),x=()=>o(105819),S=()=>o(406533),b=()=>o(236262),A=()=>o(69708),C=()=>o(100622),k=()=>o(534177),j=()=>o(813297),I=()=>o(135221),M=()=>o(862292),T=()=>o(324587),w=()=>o(546461),P=()=>o(366360),_=()=>o(76190),B=()=>o(781697),R=()=>o(283088),V=()=>o(383574),E=()=>o(686169),F=()=>o(439612),D=o(474848);const L=(0,A().YK)({learnAboutVariablesMenuItemLabel:{defaultMessage:"Learn about variables",id:"automations.actionContextMenu.learnAboutVariablesMenuItemLabel"},learnAboutWebhooksMenuItemLabel:{defaultMessage:"Learn about webhooks",id:"automations.actionContextMenu.learnAboutWebhooksMenuItemLabel"},addStepAboveMenuItemLabel:{defaultMessage:"Add action above",id:"automations.actionContextMenu.addStepAboveMenuItemLabel"},addStepBelowMenuItemLabel:{defaultMessage:"Add action below",id:"automations.actionContextMenu.addStepBelowMenuItemLabel"},deleteMenuItemLabel:{defaultMessage:"Delete",id:"automations.actionContextMenu.deleteMenuItemLabel"},duplicateMenuItemLabel:{defaultMessage:"Duplicate",id:"automations.actionContextMenu.duplicateMenuItemLabel"},duplicatingMenuItemLabel:{defaultMessage:"Duplicating",id:"automations.actionContextMenu.duplicatingMenuItemLabel"},editMenuItemLabel:{defaultMessage:"Edit",id:"automations.actionContextMenu.editMenuItemLabel"},moveDownMenuItemLabel:{defaultMessage:"Move down",id:"automations.actionContextMenu.moveDownMenuItemLabel"},moveUpMenuItemLabel:{defaultMessage:"Move up",id:"automations.actionContextMenu.moveUpMenuItemLabel"}});function O(e){const{actionStore:t,closeMenu:o}=e,{maybePersistedTransactionActions:a}=(0,P().b)(),{automationStore:l,contextType:c}=(0,w().q8)(),d=(0,A().tz)(),u=(0,i().v3)(),{value:p}=(0,s().fJ)(M().T.formulas),{value:m}=(0,s().fJ)(j().QV.automationTypecheck),[g,y]=(0,n.useState)(),h=(0,r().K8)((()=>l.getActionIds()),[l]),f=(0,r().K8)((()=>h.indexOf(t.id)),[t.id,h]),v=(0,r().K8)((()=>(0,E().J)(c,t)),[t,c]),x=(0,r().K8)((()=>{if(!v||!t.isType("update_pages"))return;const e=t.getConfigStore().getKeyStore("properties").getValue();return null==e?void 0:e[0]}),[t,v]),S=0===f,b=f===h.length-1,C=(0,n.useCallback)((()=>{y(void 0),null==o||o()}),[o]),k=(0,V().V)(),I=(0,r().K8)((()=>k.some((e=>e.type===t.getType()))),[t,k]),B=(0,_().n)(l),O=(0,R().j)(),N=(0,n.useMemo)((()=>{if(l&&I)return async()=>{const e=a.createAndCommit({perform:e=>T().duplicateAutomationAction({sourceActionStore:t,environment:u,includeParenting:!0,insertionPoint:{afterActionId:t.id},transaction:e}),userAction:"ActionContextMenu.duplicateAction"});await e.performResult.onComplete,C()}}),[t,l,u,C,a,I]),z=(0,n.useCallback)((()=>{if(p&&m)return a.createAndCommit({perform:e=>{T().removeAutomationAction({actionStore:t,automationStore:l,automationTypecheckModule:m,contextType:c,environment:u,formulasModule:p,intl:d,isSubscribed:B,transaction:e,pageStore:O})},userAction:"ActionContextMenu.removeAction"}),C(),Promise.resolve()}),[t,l,m,c,u,p,C,d,a,B,O]),U=(0,n.useMemo)((()=>{if(!S&&p&&m)return()=>{a.createAndCommit({perform:e=>{const o=W(h,f-1,f);T().reorderAutomationActions({environment:u,automationStore:l,automationTypecheckModule:m,contextType:c,formulasModule:p,intl:d,newActionIds:o,transaction:e,from:"action_menu",movedActionId:t.id,isSubscribed:B,pageStore:O})},userAction:"ActionContextMenu.moveAction"}),C()}}),[S,a,C,h,p,f,l,c,d,u,t,m,B,O]),H=(0,n.useMemo)((()=>{if(!b&&p&&m)return()=>{a.createAndCommit({perform:e=>{const o=W(h,f+1,f);T().reorderAutomationActions({environment:u,automationStore:l,automationTypecheckModule:m,contextType:c,formulasModule:p,intl:d,newActionIds:o,transaction:e,from:"action_menu",movedActionId:t.id,isSubscribed:B,pageStore:O})},userAction:"ActionContextMenu.moveAction"}),C()}}),[b,a,C,h,f,l,c,d,p,u,t,m,B,O]),Y=(0,n.useMemo)((()=>{if(v&&x)return function(){y({initialState:{actionId:t.id,propertyId:x,type:"eventActionProperty"},insertionPoint:void 0})}}),[t.id,v,x]),G=(0,n.useMemo)((()=>{if(0!==k.length)return()=>{y({initialState:{availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"},insertionPoint:{beforeActionId:t.id}})}}),[k.length,t.id]),q=(0,n.useMemo)((()=>{if(0!==k.length)return()=>{y({initialState:{availableActions:[],hasUpdateThisPagePropertyActions:!0,hasSearch:!0,type:"eventActions"},insertionPoint:{afterActionId:t.id}})}}),[k.length,t.id]),$=(0,r().K8)((()=>"define_variables"===t.getType()?{link:"https://www.notion.so/help/database-automations#database-automation-actions",label:L.learnAboutVariablesMenuItemLabel}:"http_request"===t.getType()?{link:"https://www.notion.so/help/webhook-actions",label:L.learnAboutWebhooksMenuItemLabel}:void 0),[t]);return(0,D.jsxs)(D.Fragment,{children:[g?void 0:(0,D.jsx)(K,{onAddStepAbove:G,onAddStepBelow:q,onDelete:z,onDuplicate:N,onEdit:Y,onMoveDown:H,onMoveUp:U,learnAbout:$}),g?(0,D.jsx)(F().A,{initialState:g.initialState,insertionPoint:g.insertionPoint,onClose:C}):void 0]})}function K(e){const{onAddStepAbove:t,onAddStepBelow:o,onDelete:i,onDuplicate:r,onEdit:s,onMoveDown:u,onMoveUp:j,learnAbout:I}=e,M=(0,B().e)();let T=!1;const w=function(e){const{hasSeparator:t,onEdit:o}=e,i=(0,n.useMemo)((()=>{if(o)return{action:o,key:"edit",render:e=>(0,D.jsx)(N,{...e,icon:(0,D.jsx)(l().I,{icon:x().pencilLineIcon}),children:(0,D.jsx)(A().sA,{...L.editMenuItemLabel})})}}),[o]),r=[i].filter(k().O9);if(0===r.length)return;return{items:r,key:"editActions",render:e=>(0,D.jsx)(m().A,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:T,onEdit:s});T||=Boolean(w);const P=function(e){const{hasSeparator:t,onMoveDown:o,onMoveUp:i}=e,r=(0,n.useMemo)((()=>{if(i)return{action:i,key:"moveUp",render:e=>(0,D.jsx)(N,{...e,icon:(0,D.jsx)(l().I,{icon:y().arrowStraightUpIcon}),children:(0,D.jsx)(A().sA,{...L.moveUpMenuItemLabel})})}}),[i]),a=(0,n.useMemo)((()=>{if(o)return{action:o,key:"moveDown",render:e=>(0,D.jsx)(N,{...e,icon:(0,D.jsx)(l().I,{icon:g().arrowStraightDownIcon}),children:(0,D.jsx)(A().sA,{...L.moveDownMenuItemLabel})})}}),[o]),s=[r,a].filter(k().O9);if(0===s.length)return;return{items:s,key:"moveSteps",render:e=>(0,D.jsx)(m().A,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:T,onMoveDown:u,onMoveUp:j});T||=Boolean(P);const _=function(e){const{hasSeparator:t,onAddStepAbove:o,onAddStepBelow:i}=e,r=(0,n.useMemo)((()=>{if(o)return{action:o,key:"addStepAbove",render:e=>(0,D.jsx)(N,{...e,icon:(0,D.jsx)(l().I,{icon:f().F}),children:(0,D.jsx)(A().sA,{...L.addStepAboveMenuItemLabel})})}}),[o]),a=(0,n.useMemo)((()=>{if(i)return{action:i,key:"addStepBelow",render:e=>(0,D.jsx)(N,{...e,icon:(0,D.jsx)(l().I,{icon:h().o}),children:(0,D.jsx)(A().sA,{...L.addStepBelowMenuItemLabel})})}}),[i]),s=[r,a].filter(k().O9);if(0===s.length)return;return{items:s,key:"addSteps",render:e=>(0,D.jsx)(m().A,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:T,onAddStepAbove:t,onAddStepBelow:o});T||=Boolean(_);const R=function(e){const{hasSeparator:t,onDuplicate:o,onDelete:i}=e,[r,a]=(0,n.useState)(!1),s=(0,n.useMemo)((()=>{if(o)return{action:async()=>{a(!0);try{await o()}finally{a(!1)}},key:"duplicate",render:e=>(0,D.jsx)(N,{...e,icon:(0,D.jsx)(l().I,{icon:v().V}),isLoading:r,children:r?(0,D.jsx)(A().sA,{...L.duplicatingMenuItemLabel}):(0,D.jsx)(A().sA,{...L.duplicateMenuItemLabel})})}}),[r,o]),c=(0,n.useMemo)((()=>{if(i)return{action:i,key:"delete",render:e=>(0,D.jsx)(N,{...e,icon:(0,D.jsx)(l().I,{icon:b().trashIcon}),isRedOnHover:!0,children:(0,D.jsx)(A().sA,{...L.deleteMenuItemLabel})})}}),[i]),d=[s,c].filter(k().O9);if(0===d.length)return;return{items:d,key:"otherActions",render:e=>(0,D.jsx)(m().A,{enableActionSheetTitle:!0,topBorder:t,...e})}}({hasSeparator:T,onDuplicate:r,onDelete:i});T||=Boolean(R);const V=function(e){const{hasSeparator:t,learnAbout:o}=e,n=(0,a().IS)((()=>({textWrapper:{color:C().Tj.text.secondary}})),[]);if(!o)return;return{items:[{action:()=>{},key:"learnAbout",render:e=>(0,D.jsx)(N,{...e,icon:(0,D.jsx)(l().I,{icon:S().questionMarkCircleIcon,size:"sm",colorVariant:"secondary"}),textWrapperStyle:n.textWrapper,children:(0,D.jsx)(c().N,{href:o.link,external:!0,children:(0,D.jsx)(A().sA,{...o.label})})})}],key:"learnSteps",render:e=>(0,D.jsx)(m().A,{topBorder:t,...e})}}({hasSeparator:T,learnAbout:I});return T||=Boolean(V),(0,D.jsx)(d().A,{...M,children:(0,D.jsx)(p().A,{type:p().O.Vertical,sections:[w,P,_,R,V].filter(k().O9),initialFocus:0})})}function N(e){const{children:t,icon:o,isLoading:n,...i}=e,r=n?(0,D.jsx)(I().A,{colorPalette:"purple"}):o;return(0,D.jsx)(u().A,{...i,disabled:n,disabledFeedback:n,icon:r,title:t})}function W(e,t,o){if(t<0||t>=e.length||o<0||o>=e.length)return e;const n=[...e];return n[t]=e[o],n[o]=e[t],n}},482871:(e,t,o)=>{o.d(t,{z:()=>d});o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(430670),o(581454);var n=()=>o(770063),i=()=>o(898244),r=()=>o(448801),a=()=>o(179034),s=()=>o(722101),l=(o(354520),()=>o(496603));function c(e){const{collectionContextStore:t,collectionViewStore:o,transaction:r}=e,c=o.getPageSortStore(),d=c.getValue(),u=t.groupsStore.getAllGroupStates(),p=function(e){const{pageSort:t,currentResults:o}=e;if(!t||t.length<=i().WF)return[];const n=t.filter((e=>!o.has(e)));return l().sb([...n.reverse(),...l().o8(t).reverse()]).slice(0,t.length-i().WF)}({pageSort:d,currentResults:new Set(u.flatMap((e=>e.resultsStore.state.map((e=>e.id)))))});for(const i of p)s().TF({parentStore:c,childToRemoveStore:(0,n().v3)(c,{table:a().ev,id:i}),transaction:r})}function d(e){const{resultIds:t,collectionViewStore:o,collectionContextStore:l,transaction:d}=e,u=o.getPageSortStore(),p=u.getValue()||[],{beforeOps:m}=(0,r().i)(p,t.slice(0,i().WF));for(const[i,r]of Object.entries(m))if(r){const e=(0,n().v3)(o,{table:a().ev,id:r});s().nc({parentStore:u,insertStore:(0,n().v3)(o,{table:a().ev,id:i}),beforeStore:e,transaction:d})}else{const e=t.findIndex((e=>e===i)),r=t[e-1],l=r?(0,n().v3)(o,{table:a().ev,id:r}):void 0;s().WH({parentStore:u,insertStore:(0,n().v3)(o,{table:a().ev,id:i}),afterStore:l,transaction:d})}c({collectionContextStore:l,collectionViewStore:o,transaction:d})}},489255:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>i,inviteMemberFillIcon:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"3.68 2.37 15.82 17.13",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10 2.375c-1.137 0-2.054.47-2.674 1.242-.608.757-.9 1.765-.9 2.824s.292 2.066.9 2.824c.62.772 1.537 1.241 2.674 1.241s2.055-.469 2.675-1.241c.608-.758.9-1.766.9-2.824 0-1.059-.292-2.067-.9-2.824-.62-.773-1.538-1.242-2.675-1.242m0 9.255c-2.7 0-5.101 1.315-6.12 3.305-.361.706-.199 1.421.23 1.923.412.48 1.06.767 1.74.767h5.845A4.6 4.6 0 0 1 11.4 16c0-1.508.726-2.846 1.846-3.685A7.9 7.9 0 0 0 10 11.629"}),(0,n.jsx)("path",{d:"M16 19.5a3.5 3.5 0 1 1 0-7 3.5 3.5 0 0 1 0 7m2.594-3.469a.625.625 0 0 0-.625-.625h-1.375v-1.375a.625.625 0 0 0-1.25 0v1.375h-1.375a.625.625 0 0 0 0 1.25h1.375v1.375a.625.625 0 1 0 1.25 0v-1.375h1.375c.345 0 .625-.28.625-.625"})]})},r=(0,o(340498).wt)("inviteMemberFill",i,"fill")},491848:(e,t,o)=>{o.d(t,{w:()=>i});o(898992),o(672577);var n=()=>o(209866);function i({collectionContextStore:e,transaction:t}){const o="collectionTypedView"===e.contextTypeFromStoreState,i=e.databaseTypeFromStoreState,r=e.collectionStoresStore.state,a=r.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly()))||r[0];!o&&a&&(0,n().e)({transaction:t,databaseType:i,collectionId:a.id,spaceId:a.getSpaceId()})}},495576:(e,t,o)=>{o.d(t,{d:()=>M});var n=o(296540),i=()=>o(968578),r=()=>o(484714),a=()=>o(590526),s=()=>o(69708),l=()=>o(896628),c=()=>o(401497),d=()=>o(534177),u=()=>o(738471),p=o(474848);function m({src:e,placeholderSrc:t,placeholderBehavior:o,imageStyle:i,containerStyle:r,onLoadComplete:a,testId:s}){const[l,m]=(0,n.useState)(!0);let g;switch(o){case"force-show-placeholder":g=!0;break;case"force-show-src":g=!1;break;case"show-placeholder-if-loading-src":g=!!t&&(l||void 0===e);break;default:(0,d().HB)(o)}const y=(0,c().IS)((()=>{const e={gridColumn:1,gridRow:1};return{container:{display:"grid",...r},srcWrapper:{...g&&{display:"none"},...e},placeholderWrapper:{pointerEvents:"none",...e}}}),[r,g]);(0,n.useEffect)((()=>{void 0!==e&&m(!0)}),[e]);const h=(0,n.useCallback)((e=>{m(!1),null==a||a()}),[a]);return(0,p.jsxs)("div",{style:y.container,children:[(0,p.jsx)(u().A,{src:e,onLoad:h,style:i,placeholderStyle:y.srcWrapper,placeholderLoadedStyle:y.srcWrapper,testId:s}),t?(0,p.jsx)(u().A,{src:t,style:i,placeholderStyle:y.placeholderWrapper,placeholderLoadedStyle:y.placeholderWrapper}):void 0]})}var g=()=>o(19771),y=()=>o(360083),h=()=>o(801678),f=()=>o(984007),v=()=>o(504023),x=()=>o(821507),S=()=>o(568365),b=()=>o(77246),A=()=>o(244828),C=()=>o(79926);const k=new(C().O2)("AnimatedCoverImageActionBar",(async()=>Promise.all([o.e(75134),o.e(35530),o.e(36556),o.e(55373),o.e(36192),o.e(27992),o.e(63452),o.e(66249),o.e(87249),o.e(79022),o.e(34877),o.e(59218),o.e(40454)]).then(o.bind(o,166913)))),j=(0,C()._h)(k,(e=>e.AnimatedCoverImageActionBar)),I=280;function M(e){const{store:t,disabled:o,paddingRight:c,paddingLeft:d,height:u,proxyWidth:C}=e,k=(0,s().tz)(),M=(0,r().v3)(),w=(0,r().Y0)(),P=(0,a().uB)(void 0,i().A),_=(0,a().K8)((()=>o||"suggest"===b().Uv.getMode(t)||(0,x().aD)(w)),[o,t,w]),B=(0,a().K8)((()=>t.getCover()),[t]),R=(0,a().O$)(S().M),V=(0,v().x)(t.id),[E,F]=(0,n.useState)(void 0);if(!B)return null;const D=R.loadingMode!==f().pF&&R.loadingMode!==f().Wc;return(0,p.jsx)(h().A,{mouseStore:P,onFlushTemporaryPosition:e=>function(e,t,o){const{imagePosition:n,reset:i}=e;A().createAndCommit({userAction:"PageCover.handleFlushTemporaryPosition",environment:o,canUndo:!0,perform:e=>{l().yY({store:t,coverPosition:n,transaction:e}),i()}})}(e,t,M),renderControl:({handleRepositionClick:e,handleSavePositionClick:o,handleCancelClick:n,isVisible:i,isRepositioning:r})=>_?null:(0,p.jsx)(j,{store:t,mouseStore:P,imageUrl:E,handleRepositionClick:e,handleSavePositionClick:o,handleCancelClick:n,visible:i||V,isRepositioning:r,paddingLeft:d,paddingRight:c}),source:"page",store:t,style:{display:"flex",flexDirection:"column",alignItems:"center",height:u,maxHeight:I,cursor:"default"},preventClickPropagation:!0,render:e=>(0,p.jsxs)(n.Fragment,{children:[(0,p.jsx)(y().A,{url:B.cover,isAuthenticated:!0,permissionRecord:B.pointer,width:C,onFinishedLoadingProxyUrl:F,render:(t,o)=>{const n={width:"100%",height:u,maxHeight:I,objectFit:"cover",opacity:D?.5:1,objectPosition:`center ${100*(1-(e.imagePosition||0))}%`,borderRadius:0},i={width:"100%",height:u,maxHeight:I};return(0,p.jsx)(m,{src:o,placeholderSrc:D?R.dataURL:void 0,placeholderBehavior:D?"force-show-placeholder":"show-placeholder-if-loading-src",containerStyle:i,imageStyle:n,onLoadComplete:T,testId:"pageCover"})}},B.pointer.id),D?(0,p.jsx)(g().X,{variant:"spinner",percentage:R.uploadProgress,text:void 0!==R.uploadProgress?void 0:R.progressText}):V?(0,p.jsx)(g().X,{variant:"dots",text:k.formatMessage({id:"CoverImageActionBar.generatingCover",defaultMessage:"Generating..."})}):void 0]})})}function T(){S().M.reset()}},500071:(e,t,o)=>{o.d(t,{D:()=>Y,y9:()=>z});o(898992),o(672577);var n=o(296540),i=()=>o(484714),r=()=>o(590526),a=()=>o(401497),s=()=>o(365917),l=()=>o(755125),c=()=>o(699143),d=()=>o(250910),u=()=>o(118307),p=()=>o(807449),m=()=>o(368609);const g=2e3;var y=()=>o(239381),h=()=>o(791089),f=()=>o(642557),v=()=>o(201980),x=()=>o(69708),S=()=>o(496603),b=()=>o(534177),A=()=>o(284371),C=()=>o(384944),k=()=>o(89053),j=()=>o(18387),I=()=>o(761309),M=()=>o(159958),T=()=>o(162969),w=()=>o(546461),P=()=>o(653417),_=()=>o(122414),B=()=>o(366360),R=()=>o(858163),V=()=>o(133518),E=()=>o(656134),F=()=>o(475679),D=()=>o(439612),L=()=>o(548526),O=()=>o(923832),K=()=>o(616175),N=o(474848);const W=(0,x().YK)({slackCustomMessageLabel:{defaultMessage:"Custom message",id:"automations.SlackNotificationAction.customMessageLabel"},invalidChannelLabel:{defaultMessage:"Invalid channel",id:"slackNotificationAction.slackTargetChannel.invalidChannel"},hiddenChannelLabel:{defaultMessage:"Hidden channel",id:"slackNotificationAction.slackTargetChannel.hiddenName"},noTargetChannelLabel:{id:"slackNotificationAction.targetPicker.noTarget",defaultMessage:"Select Slack channel"}});function z(e){const{actionStore:t}=e,o=oe(t),{automationStore:a}=(0,w().q8)(),s=(0,w().fi)(),{disabled:d,maybePersistedTransactionActions:p,suppressActionErrors:f}=(0,B().b)(),S=(0,m().getActionRegistryItem)("slack_notification"),A=Boolean(d),j=ee(a)?(0,N.jsx)(P().TooltipWithSubtitle,{content:(0,N.jsx)(x().sA,{...P().automationErrorMessages.slackNotificationAuthenticationError})}):null,I=(0,r().uB)(void 0,u().A),M=(0,n.useCallback)((()=>I.reset()),[I]),T=(0,n.useMemo)((()=>(0,N.jsx)(F().z,{actionStore:t,closeMenu:M})),[t,M]),E=(0,n.useMemo)((()=>!f.includes(t.id)),[f,t]),{errorMessage:D}=(0,P().useErrorComponentForAction)({actionId:t.id,errorKey:"external_bot_id",shouldShow:E}),{errorMessage:L}=(0,P().useErrorComponentForAction)({actionId:t.id,errorKey:"target",shouldShow:E}),z=(0,r().K8)((()=>t.getSpaceId()),[t]),H=(0,r().K8)((()=>{var e;return null===(e=t.getConfig())||void 0===e?void 0:e.custom_message}),[t]),Y=(0,V().F)({actionId:t.id}),G=(0,r().K8)((()=>{if(z)return(0,h().analyzeSimpleFormulaOrFormulaSync)({context:{handleDataRequest:(0,y().zg)(t.getRecordModel),spaceId:z,valueTypes:Y.slice(0),featureGates:(0,k().i)(),enableExistenceGuarantees:s},value:H})}),[t.getRecordModel,H,s,Y,z]),{onTextStoreSelect:q,onTextStoreUnselect:$}=(0,R().W)(t),Q=(0,i().v3)(),X=(0,n.useCallback)((()=>{(0,l().clear)({environment:Q})}),[Q]),Z=(0,n.useCallback)((e=>{const o=null==e?void 0:e.value;(!(0,b().O9)(o)||(0,v().AhH)(o)<=g)&&(p.createAndCommit({perform:o=>{C().zv({data:{custom_message:e},store:t.getConfigStore(),transaction:o})},userAction:"SlackNotificationAction.setCustomMessage"}),(0,_().UB)(Q,{automationStore:a,automationActionStore:t}))}),[t,a,Q,p]);return z&&G?(0,N.jsxs)(O().OT,{actionMenu:T,buttonPopupStore:I,disabled:A,actionId:t.id,canCollapse:!1,children:[(0,N.jsx)(O().h3,{actionId:t.id,actionRegistryItem:S,disabled:A,styles:{headerWrap:{paddingInlineEnd:32},titleWrap:{display:"flex",flexWrap:"wrap",gap:4}},children:(0,N.jsx)(U,{actionStore:t,automationStore:a,disabled:A,errorMessage:j??D??L})}),(0,b().O9)(o)?(0,N.jsx)(O().qt,{children:(0,N.jsx)(c().Y1,{direction:"vertical",gap:16,children:(0,N.jsx)(K().M,{analyzedFormulaOutput:G,labelMessageDescriptor:W.slackCustomMessageLabel,disabled:A,disableMobileActionBar:!0,disableStyleAnnotations:!1,disableFormulas:!1,disableMentions:!1,isOptional:!0,formulaTypecheckContextValues:Y,parentRecordStore:t,rows:5,spaceId:z,value:H,onChange:Z,onTextStoreSelect:q,onTextStoreUnselect:$,onTextEsc:X})})}):void 0]}):null}function U(e){const{actionStore:t,automationStore:o,disabled:n,errorMessage:i}=e;return(0,N.jsx)(x().sA,{defaultMessage:"Notify{slackTargetPicker}",id:"automations.slackNotificationAction.action.title",values:{slackTargetPicker:(0,N.jsx)(H,{actionStore:t,automationStore:o,disabled:n,errorMessage:i})}})}function H(e){const{actionStore:t,automationStore:o,disabled:i,errorMessage:a}=e,l=(0,r().K8)((()=>{const e=t.getConfigStore(),o=e.getKeyStore("external_bot_id").getValue();if((0,S().Im)(o))return!1;const n=e.getKeyStore("target").getValue();return!(0,S().Im)(null==n?void 0:n.id)}),[t]),c=(0,r().uB)(void 0,u().A),p=(0,n.useCallback)((()=>c.reset()),[c]),m=function(e){const{actionStore:t,automationStore:o}=e,[n,i]=(0,r().K8)((()=>{const e=t.getConfigStore();return[e.getKeyStore("target").getValue(),e.getKeyStore("external_bot_id").getValue()]}),[t]),a=ee(o),{currentExternalAuthentication:l}=J(t),c=(0,r().K8)((()=>s().A.completeSlackAuthentications.state.length??0),[]);if((0,b().O9)(n)&&(0,b().O9)(i))return a?{actionStore:t,externalBotId:i,notificationActionConfigStore:t,type:"connectToSlackReconnect"}:(0,b().O9)(l)?{actionStore:t,currentExternalAuthentication:l,currentNotificationChannel:n,type:"selectChannelUpdate"}:{actionStore:t,type:"connectToSlackDefault"};return 0===c?{actionStore:t,type:"connectToSlackDefault"}:c>1?{actionStore:t,type:"selectWorkspace"}:{actionStore:t,type:"selectChannelNew"}}({actionStore:t,automationStore:o}),g=(0,E().j)();return(0,N.jsx)(d().A,{alignmentToOrigin:"end",buttonPopupStore:c,disabled:i,originGap:0,placementToOrigin:"bottom",popupType:g,renderOrigin:e=>(0,N.jsx)(L().x,{...e,disabled:i,isCompact:!0,isError:Boolean(a),hasActionRequired:!l,dropdownButtonType:"dropdown",children:l?(0,N.jsx)(Y,{actionStore:t}):(0,N.jsx)(x().sA,{...W.noTargetChannelLabel})}),render:()=>(0,N.jsx)(D().A,{initialState:m,onClose:p})})}function Y(e){const{actionStore:t}=e,o=(0,i().v3)(),n=(0,r().K8)((()=>{const e=(0,j().Z)();return!(0,b().O9)(e)||Boolean((0,I().qb)(o,e,e.getSpaceStore()))}),[o]),a=oe(t),{authenticationState:s}=J(t);return"invalid_channel"===s?(0,N.jsx)(Z,{}):n||!(0,b().O9)(a)?(0,N.jsx)(X,{}):"me"===a.type?(0,N.jsx)($,{channelName:a.name}):"private"===a.type?(0,N.jsx)(q,{channelName:a.name}):"public"===a.type?(0,N.jsx)(G,{channelName:a.name}):"im"===a.type?(0,N.jsx)(Q,{channelName:a.name}):void(0,b().HB)(a.type)}function G(e){return(0,N.jsx)("span",{style:A().RC,children:`#${e.channelName}`})}function q(e){const{channelName:t}=e,o=te();return(0,N.jsxs)("div",{style:o.container,children:[(0,N.jsx)(p().I,{icon:f().lockSmallIcon,size:"xxs"}),(0,N.jsx)("span",{style:A().RC,children:t})]})}function $(e){const{channelName:t}=e;return(0,N.jsx)("span",{style:A().RC,children:`@${t}`})}function Q(e){const{channelName:t}=e;return(0,N.jsx)("span",{style:A().RC,children:`@${t}`})}function X(){const e=te();return(0,N.jsxs)("div",{style:e.container,children:[(0,N.jsx)(p().I,{icon:f().lockSmallIcon,size:"xxs"}),(0,N.jsx)("span",{style:A().RC,children:(0,N.jsx)(x().sA,{...W.hiddenChannelLabel})})]})}function Z(){const e=te();return(0,N.jsx)("div",{style:e.container,children:(0,N.jsx)("span",{style:A().RC,children:(0,N.jsx)(x().sA,{...W.invalidChannelLabel})})})}function J(e){return(0,r().K8)((()=>{const t=e.getConfigStore().getKeyStore("external_bot_id").getValue();if(!t)return{authenticationState:"invalid_channel",currentExternalAuthentication:void 0};const o=s().A.completeSlackAuthentications.state.find((e=>t===e.id));return(0,b().O9)(o)?{authenticationState:"selected_channel",currentExternalAuthentication:o}:{authenticationState:"hidden_channel",currentExternalAuthentication:void 0}}),[e])}function ee(e){return(0,r().K8)((()=>"disabled_auth"===e.getStatus()),[e])}function te(){return(0,a().IS)((()=>({container:{alignItems:"center",display:"inline-flex",gap:2,minWidth:50,width:"100%"}})),[])}function oe(e){const t=(0,i().v3)(),o=(0,r().K8)((()=>{var t;return null===(t=e.getConfig())||void 0===t||null===(t=t.target)||void 0===t?void 0:t.id}),[e]),{currentExternalAuthentication:a}=J(e);return n.useEffect((()=>{a&&(0,M().Hn)({environment:t,spaceId:a.space_id,externalAuthConfig:{type:"external",botId:a.id}})}),[t,a]),(0,r().K8)((()=>{if(a&&o){const e=T().c.getStateForBot({type:"external",botId:a.id}).channels[o];if(e)return e}}),[o,a])}},514608:(e,t,o)=>{o.r(t),o.d(t,{eyeFillSmallIcon:()=>r,iconDefinition:()=>i});o(296540);var n=o(474848);const i={viewBox:"0 0 16 16",fittedViewBox:"0.7 3.26 14.6 9.48",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M8 7.122a.875.875 0 1 1 0 1.75.875.875 0 0 1 0-1.75"}),(0,n.jsx)("path",{d:"M8 3.26c3.125 0 5.857 1.673 7.152 4.141l.065.144c.11.293.11.617 0 .91l-.065.145c-1.295 2.468-4.027 4.14-7.152 4.14-3.027 0-5.685-1.57-7.026-3.912L.848 8.6a1.29 1.29 0 0 1 0-1.199l.126-.228C2.314 4.83 4.972 3.26 8 3.26m0 2.112a2.626 2.626 0 0 0-2.625 2.626l.014.269A2.626 2.626 0 0 0 7.73 10.61l.269.014a2.626 2.626 0 0 0 2.611-2.357l.014-.269A2.626 2.626 0 0 0 8 5.372"})]})},r=(0,o(340498).wt)("eyeFillSmall",i,"fillSmall")},515918:(e,t,o)=>{o.d(t,{A:()=>s});o(296540);var n=()=>o(401497),i=()=>o(970236),r=()=>o(69708),a=o(474848);function s(e){const{style:t}=e,o=(0,n().IS)((()=>({badge:{letterSpacing:0,whiteSpace:"nowrap",width:"fit-content",...t}})),[t]);return(0,a.jsx)(i().E,{color:"blue",style:o.badge,content:(0,a.jsx)(r().sA,{id:"newBadgeComponent.label",defaultMessage:"New"})})}},539297:(e,t,o)=>{function n(e){return"gallery"===e||"board"===e}o.d(t,{x:()=>n})},556122:(e,t,o)=>{o.d(t,{QJ:()=>m,TI:()=>c});o(944114),o(581454);var n=()=>o(726637),i=()=>o(763824);let r=0;const a="clipboard",s={debug:Boolean(n().A.isDevelopingInAirplaneMode),responseText:a,showErrorCode:!1,delayBetweenChunks:20,chunkSize:5,numLoremIpsums:3},l="Lorem ipsum dolor sit amet, consectetur adipiscing elit. Donec porta auctor sem vel efficitur. Vivamus efficitur eros sed erat efficitur efficitur. Vivamus et augue vel est efficitur efficitur.";function c(){return s}function d(e){return{async*[Symbol.asyncIterator](){for(const t of e)await(0,i().wR)(s.delayBetweenChunks),yield t}}}function u(e,t){const o=Math.ceil(e.length/t),n=new Array(o);for(let i=0,r=0;i<o;++i,r+=t)n[i]=e.substr(r,t);return n}function p(e){return e.map((e=>({type:"success",p:"padding",completion:e,inferenceId:"mock"})))}async function m({environment:e,data:t}){console.log("Retrieving fake completion for data",t);const{context:o}=t,i=o.selectedText,c=[];let{responseText:m}=s;if(m===a&&(m=await async function(){try{return await navigator.clipboard.readText()}catch(e){return}}()??"Unable to retrieve clipboard text."),void 0===m&&(c.push({type:"success",p:"padding",completion:"\n",inferenceId:"mock"},{type:"success",p:"padding",completion:"this is ",inferenceId:"mock"},{type:"success",p:"padding",completion:"fake ",inferenceId:"mock"},{type:"success",p:"padding",completion:`streaming response ${r++}.`,inferenceId:"mock"}),n().A.isDevelopingInAirplaneMode&&c.push({type:"success",p:"padding",completion:"\n\nTo see a real AI response, run the server with `--airplaneMode=false`.",inferenceId:"mock"}),"string"==typeof i)){c.push({type:"success",p:"padding",completion:"\n\nHere is the text you selected:\n\n",inferenceId:"mock"});for(const e of u(i,s.chunkSize))c.push({type:"success",completion:e,p:"padding",inferenceId:"mock"})}if(s.showErrorCode)c.push({type:"error",message:"alas",errorCode:s.showErrorCode,isRetryable:!1});else if(void 0===m)for(let n=0;n<s.numLoremIpsums;n++)c.push(...p([`\n\n${n+1}. `,...u(l,0===s.delayBetweenChunks?l.length:s.chunkSize)]));else if(m.length>0){const e=u(m,s.chunkSize);c.push(...p(e))}return Promise.resolve({type:"success",data:d(c),status:200,headers:{}})}(0,o(852832).exposeDebugValue)("completionDebugSettings",s)},559419:(e,t,o)=>{o.d(t,{c:()=>i});var n=o(296540);function i(){const[e,t]=(0,n.useState)(void 0),o=(0,n.useCallback)((e=>t(e.id)),[]),i=(0,n.useCallback)((()=>t(void 0)),[]);return(0,n.useMemo)((()=>({currentDraggingActionId:e,onActionDragStart:o,onActionDragEnd:i})),[e,i,o])}},563692:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,xMarkFillSmallIcon:()=>i});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"3.03 3.03 9.94 9.94",svg:(0,o(474848).jsx)("path",{d:"M12.73 4.33a.75.75 0 1 0-1.06-1.06L8 6.94 4.33 3.27a.75.75 0 1 0-1.06 1.06L6.94 8l-3.67 3.67a.75.75 0 1 0 1.06 1.06L8 9.06l3.67 3.67a.75.75 0 0 0 1.06-1.06L9.06 8z"})},i=(0,o(340498).wt)("xMarkFillSmall",n,"fillSmall")},568365:(e,t,o)=>{o.d(t,{M:()=>n});const n=new(o(984007).Ay)},575630:(e,t,o)=>{o.d(t,{w$:()=>C,mk:()=>j,cI:()=>I});o(898992),o(354520),o(581454);var n=o(296540),i=()=>o(590526),r=()=>o(401497),a=()=>o(791089),s=o(474848);const l={viewBox:"0 0 16 16",fittedViewBox:"1.87 1.87 12.25 12.25",svg:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("path",{d:"M6.211 6.225c-.5 0-.813.543-.56.976l1.788 3.067a.65.65 0 0 0 1.122 0l1.789-3.067a.649.649 0 0 0-.561-.976z"}),(0,s.jsx)("path",{d:"M8 1.875a6.125 6.125 0 1 0 0 12.25 6.125 6.125 0 0 0 0-12.25M3.125 8a4.875 4.875 0 1 1 9.75 0 4.875 4.875 0 0 1-9.75 0"})]})},c=(0,o(340498).wt)("arrowTriangleDownCircleSmall",l,"small");var d=()=>o(69708),u=()=>o(806080),p=()=>o(534177),m=()=>o(284371),g=()=>o(496645),y=()=>o(399762),h=()=>o(881690),f=()=>o(496401),v=()=>o(214973),x=()=>o(741310),S=()=>o(923832),b=()=>o(529135),A=()=>o(16707);function C(e){const{actionId:t,actionMenu:o,buttonPopupStore:a,disabled:l,onClick:u,propertySchema:p,value:g}=e,y=(0,d().tz)(),h=(0,r().IS)((()=>({content:{alignItems:"baseline",display:"flex",flexWrap:"wrap",whiteSpace:"pre",lineHeight:1.6},propertyName:{...m().RC,fontWeight:m().Wy.medium}})),[]),f=(0,i().K8)((()=>j({intl:y,propertySchema:p,styles:h,value:g})),[y,p,h,g]),v=(0,i().K8)((()=>I({intl:y,propertySchema:p,value:g})),[y,p,g]),b=(0,n.useCallback)((e=>(0,s.jsx)(S().aX,{...e,actionId:t,actionMenu:o,buttonPopupStore:a,disabled:l,icon:c,onClick:u,children:(0,s.jsx)("div",{style:h.content,children:f})})),[t,o,a,l,u,h.content,f]);return(0,s.jsx)(x().P,{renderOrigin:b,title:v})}function k(e,t){if(!e)return[];let o=(0,a().fromSimpleFormulaArrayValue)(e).filter((e=>(0,u().Kg)(e)));return"select"===t.type&&(o=o.slice(0,1)),o}function j(e){const{intl:t,limit:o,operator:n,propertySchema:i,styles:r,tokenFormat:a,value:l}=e,c=(0,g().Ug)(a),u=(0,s.jsx)("span",{style:r.propertyName,children:i.name});if("formula"===(null==l?void 0:l.type))return(0,s.jsx)(d().sA,{...v()._M({propertyName:u,propertyValue:(0,s.jsx)(A().g,{returnType:{type:"text"}})})});const m=v().kN({limit:o,propertySchema:i,optionValues:k(null==l?void 0:l.value,i)}).map((e=>"deleted"===e.type?(0,s.jsx)(b().A,{tokenFormat:c},`missing_option_value_${e.value}`):"option"===e.type?(0,s.jsx)(y().O,{color:e.value.color,format:c,isSingle:!0,showRemoveButton:!1,value:e.value.value},e.value.id):"truncation"===e.type?(0,s.jsx)(h().A,{format:c,isRound:!0,isSingle:!0,showRemoveButton:!1,value:e.value},"More tokens"):void(0,p().HB)(e)));return"replace"===n||"append"===n||"remove"===n||"toggle"===n?(0,s.jsx)(d().sA,{...v().f4({...v().f_({elements:m,intl:t}),operator:n,propertyName:u})}):0===m.length?(0,s.jsx)(d().sA,{...v().NW({propertyName:u})}):(0,s.jsx)(d().sA,{...v()._M({propertyName:u,propertyValue:m[0]})})}function I(e){const{intl:t,limit:o,propertySchema:n,value:i,operator:r}=e,a=n.name;if("formula"===(null==i?void 0:i.type))return(0,s.jsx)(d().sA,{...v()._M({propertyName:a,propertyValue:(0,s.jsx)(A().L,{})})});const l=v().kN({limit:o,propertySchema:n,optionValues:k(null==i?void 0:i.value,n)}).map((e=>"deleted"===e.type?v().iy(t):"option"===e.type?e.value.value:"truncation"===e.type?e.value:void(0,p().HB)(e)));return"replace"===r||"append"===r||"remove"===r||"toggle"===r?(0,s.jsx)(d().sA,{...v().f4({propertyName:a,propertyValue:(0,f().d)(t.formatList(l,{style:"long",type:"conjunction"})),operator:r})}):0===l.length?(0,s.jsx)(d().sA,{...v().NW({propertyName:a})}):(0,s.jsx)(d().sA,{...v()._M({propertyName:a,propertyValue:l[0]})})}},585293:(e,t,o)=>{o.d(t,{a:()=>a});var n=o(296540),i=()=>o(100622),r=o(474848);const a=n.forwardRef(((e,t)=>{const n=(0,o(59226).X)("polish_publish_menu")&&!o(726637).A.isMobile,a=(0,o(401497).IS)((()=>({buttonStyle:{paddingInlineStart:n?2:8,paddingInlineEnd:n?2:8,paddingTop:2,paddingBottom:2,width:"100%",marginInlineStart:0,background:"transparent",...e.buttonStyle},menuItemStyle:{gap:6,background:"transparent",...e.style},innerContainer:{marginInlineStart:0,paddingInlineStart:0,minWidth:0,color:e.disabled?i().Tj.text.secondary:void 0,background:"transparent"},desktopIconStyle:{margin:0},rightStyle:{display:"flex",alignItems:"center",gap:6,color:i().Tj.text.secondary,margin:0,...e.rightStyle}})),[n,e.buttonStyle,e.style,e.disabled,e.rightStyle]);return(0,r.jsx)(o(81068).A,{role:"button",...e,ref:t,style:a.menuItemStyle,buttonStyle:a.buttonStyle,textWrapperStyle:a.innerContainer,desktopIconStyle:a.desktopIconStyle,rightStyle:a.rightStyle})}));a.displayName="SiteSettingButtonMenuItem"},589407:(e,t,o)=>{o.r(t),o.d(t,{ellipsisIcon:()=>i,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.62 8.62 14.76 2.76",svg:(0,o(474848).jsx)("path",{d:"M4 11.375a1.375 1.375 0 1 0 0-2.75 1.375 1.375 0 0 0 0 2.75m6 0a1.375 1.375 0 1 0 0-2.75 1.375 1.375 0 0 0 0 2.75m6 0a1.375 1.375 0 1 0 0-2.75 1.375 1.375 0 0 0 0 2.75"})},i=(0,o(340498).wt)("ellipsis",n,"default")},591197:(e,t,o)=>{o.d(t,{VY:()=>s,ZJ:()=>r,u3:()=>a});var n=()=>o(140934);class i extends(()=>o(757695))().Store{getInitialState(){return{popupRenderedInPage:!1,popupRenderedInPeekView:!1}}}const r=new i,a=new(n().ComputedStore)((()=>!1!==r.state.popupRenderedInPage),{debugName:"AssistantWriterRenderedInPageStore"}),s=new(n().ComputedStore)((()=>!1!==r.state.popupRenderedInPeekView),{debugName:"AssistantWriterRenderedInPeekViewStore"})},594952:(e,t,o)=>{o.d(t,{I:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 20 20",fittedViewBox:"2.29 1.61 15.91 15.92",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M5.486 14.341a.669.669 0 1 0-.946.946.669.669 0 0 0 .946-.946"}),(0,n.jsx)("path",{d:"M11.964 2.093a1.625 1.625 0 0 0-2.471.205L6.976 5.821l-.04-.04a.625.625 0 0 0-.884 0l-1.07 1.07a2.625 2.625 0 0 0 0 3.713l.563.563-1.35.964c-.355.253-.782.557-1.13.92-.363.38-.683.867-.754 1.495-.09.793.17 1.621.78 2.231s1.437.87 2.23.78c.628-.072 1.115-.392 1.495-.755.364-.348.668-.775.92-1.13l.015-.021.95-1.329.562.563a2.625 2.625 0 0 0 3.712 0l1.07-1.07a.625.625 0 0 0 0-.884l-.054-.054 3.524-2.517a1.625 1.625 0 0 0 .204-2.471zm-1.454.932a.375.375 0 0 1 .57-.048l3.001 3.001a4.3 4.3 0 0 1-1.216 2.443l-.069.068c-.112.113.004.3.155.25l.69-.23a3.2 3.2 0 0 0 1.525-1.079l.16-.206 1.51 1.509a.375.375 0 0 1-.048.57l-3.558 2.541-5.262-5.261zM6.494 7.107l6.226 6.226-.629.628a1.375 1.375 0 0 1-1.944 0l-1.085-1.084a.625.625 0 0 0-.95.078l-1.379 1.93c-.27.38-.51.715-.781.974-.263.25-.509.385-.772.415a1.47 1.47 0 0 1-1.206-.42c-.33-.33-.47-.776-.42-1.207.029-.263.164-.51.415-.771.258-.27.594-.512.972-.782l1.931-1.379a.625.625 0 0 0 .079-.95L5.866 9.68a1.375 1.375 0 0 1 0-1.944z"})]})},r=(0,o(340498).wt)("paintBrush",i,"default")},606006:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,phoneSmallIcon:()=>i});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.94 2.09 12.07 11.91",svg:(0,o(474848).jsx)("path",{d:"M5.472 2.52a1.197 1.197 0 0 0-1.68-.141l-.696.583a3.23 3.23 0 0 0-1.128 2.894 9.376 9.376 0 0 0 8.336 8.114l.128.013a3.28 3.28 0 0 0 2.867-1.177l.447-.542a1.16 1.16 0 0 0-.143-1.618l-2.37-2.014a1.345 1.345 0 0 0-1.822.074l-.888.888-1.996-1.996.888-.888c.496-.496.527-1.29.073-1.823zM3.9 3.92l.656-.55 1.981 2.327a.095.095 0 0 1-.005.13l-1.33 1.33a.625.625 0 0 0 0 .883l2.88 2.88a.625.625 0 0 0 .884 0l1.33-1.33a.095.095 0 0 1 .129-.005l2.3 1.954-.39.473a2.03 2.03 0 0 1-1.774.728l-.128-.014a8.13 8.13 0 0 1-7.225-7.032c-.087-.67.174-1.34.692-1.774"})},i=(0,o(340498).wt)("phoneSmall",n,"small")},616175:(e,t,o)=>{o.d(t,{M:()=>h,z:()=>f});o(296540);var n=()=>o(590526),i=()=>o(401497),r=()=>o(699143),a=()=>o(807449),s=()=>o(493552),l=()=>o(158661),c=()=>o(69708),d=()=>o(100622),u=()=>o(284371),p=()=>o(166006),m=()=>o(115512),g=()=>o(938818),y=o(474848);function h(e){var t,o;const{analyzedFormulaOutput:h,labelMessageDescriptor:v,isOptional:x,errorMessageDescriptor:S}=e,b=(0,c().tz)(),A=(0,n().K8)((()=>(0,g().L)({intl:b,parseErrors:null==h?void 0:h.parseErrors,typeErrors:null==h?void 0:h.typeErrors,typeWarnings:null==h?void 0:h.typeWarnings})),[h,b]),C=((null==h||null===(t=h.parseErrors)||void 0===t?void 0:t.length)||0)>0||((null==h||null===(o=h.typeErrors)||void 0===o?void 0:o.length)||0)>0,k=(0,i().IS)((()=>({inputLabel:{display:"flex",alignItems:"center",color:d().Tj.text.secondary,gap:4,fontSize:m().vQ,lineHeight:m().G6,fontWeight:u().Wy.regular},messageInput:{width:"100%"},inputLabelInner:{flex:"1 1 auto",...(S||C)&&{color:d().Tj.red.text.accentPrimary,fontWeight:u().Wy.medium}}})),[S,C]);return(0,y.jsxs)(r().Y1,{direction:"vertical",gap:6,children:[(0,y.jsxs)("label",{style:k.inputLabel,children:[C?(0,y.jsx)(a().I,{icon:l().exclamationMarkTriangleFillSmallIcon,size:"sm",colorPalette:"red",colorVariant:"accentPrimary"}):void 0,(0,y.jsxs)("div",{style:k.inputLabelInner,children:[(0,y.jsx)(c().sA,{...v}),x?(0,y.jsx)(f,{}):void 0]})]}),(0,y.jsxs)(r().Y1,{direction:"vertical",gap:6,children:[(0,y.jsx)(p().Y,{...e,style:k.messageInput,shouldShowErrorStyles:C||e.shouldShowErrorStyles}),A?(0,y.jsx)(g().J,{analyzedFormulaOutput:h}):void 0,!A&&S?(0,y.jsx)(s().D,{colorPalette:"red",colorVariant:"accentPrimary",styleKey:"captionRegular",children:(0,y.jsx)(c().sA,{...S})}):void 0]})]})}function f(){const e=(0,i().IS)((()=>({optionalLabel:{color:d().Tj.text.tertiary,marginInlineStart:4}})),[]);return(0,y.jsx)("span",{style:e.optionalLabel,children:(0,y.jsx)(c().sA,{defaultMessage:"{openParenthesis}Optional{closeParenthesis}",id:"automations.SimpleFormulaTextInputWithError.optionalLabel",values:{openParenthesis:"(",closeParenthesis:")"}})})}},619207:(e,t,o)=>{o.r(t),o.d(t,{emojiFaceFillIcon:()=>i,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.26 15.25",svg:(0,o(474848).jsx)("path",{d:"M2.375 10a7.625 7.625 0 1 1 15.25 0 7.625 7.625 0 0 1-15.25 0m5.67 1.706a.625.625 0 0 0-1.036.698A3.6 3.6 0 0 0 10.005 14c1.245 0 2.35-.637 2.996-1.596a.625.625 0 0 0-1.036-.698 2.37 2.37 0 0 1-1.96 1.044 2.36 2.36 0 0 1-1.96-1.044m-.68-2.041c.49 0 .88-.46.88-1.02s-.39-1.02-.88-1.02-.88.46-.88 1.02.39 1.02.88 1.02m6.15-1.02c0-.56-.39-1.02-.88-1.02s-.88.46-.88 1.02.39 1.02.88 1.02.88-.46.88-1.02"})},i=(0,o(340498).wt)("emojiFaceFill",n,"fill")},629782:(e,t,o)=>{o.d(t,{D:()=>c});o(898992),o(803949);var n=o(296540),i=()=>o(664594),r=()=>o(869244),a=()=>o(328876),s=()=>o(388821),l=()=>o(244828);function c({unpersistedInMemoryRecordCache:e}){const t=(0,i().T)(),o=(0,n.useCallback)((({perform:o})=>{const n=new(r().Z)({deadlockTimeoutMs:l().DEADLOCK_WARNING_TIMEOUT_MS}),i=o(n),c=s().RecordMap.create();n.stores.forEach((e=>{const t=e.getRecordModel(e.pointer);t&&c.addModel(t)})),(0,a().applyOperationsToRecordMap)({operations:n.operations,recordMap:c,updateOnly:!1});for(const r of c){const{model:o,pointer:n}=r;e.setModelAndRole({pointer:n,userId:t},o,"editor")}return e.emitAll(),{performResult:i,serverCommitResult:Promise.resolve(void 0),transactionId:n.id}}),[e,t]);return(0,n.useMemo)((()=>({createAndCommit:o})),[o])}},633904:(e,t,o)=>{o.d(t,{l:()=>x,t:()=>S});o(16280);var n=o(296540),i=()=>o(907258),r=()=>o(484714),a=()=>o(590526),s=()=>o(302655),l=()=>o(869244),c=()=>o(912720),d=()=>o(534177),u=(o(898992),o(737550),()=>o(929345)),p=()=>o(199378),m=()=>o(496603);function g(e,t){var o,n;const i=null==e?void 0:e.getModel(),r=null==t?void 0:t.getModel();if(!t||!r)return!0;if(i&&(null===(o=i.getProperties())||void 0===o?void 0:o.name)!==(null===(n=r.getProperties())||void 0===n?void 0:n.name))return!0;return!(!i||i.getStatus()===r.getStatus())||(!!function(e,t){const o=null==e?void 0:e.getModel(),n=t.getModel();if(!n)return!0;if((0,d().O9)(o)){if(o.isEventType()&&n.isEventType()){const e=o.getEventConfiguration(),t=n.getEventConfiguration();return!(0,m().n4)(e,t)}if(o.isRecurrenceType()&&n.isRecurrenceType()){const e=o.getRecurrence(),t=n.getRecurrence();return!(0,m().n4)(e,t)}return!o.isButtonType()||!n.isButtonType()}if(n.isEventType()){const e=n.getEventConfiguration();return!1!==e.pagesAdded||"none"!==e.pagePropertiesEdited.type}if(n.isRecurrenceType())return!0;if(n.isButtonType())return!1;(0,d().HB)(n)}(e,t)||!!function(e,t){const o=t.getSpaceId();if(!o)return!1;if((0,d().O9)(e)){const n=e.getActionIds(),i=t.getActionIds();return n.length!==i.length||!(0,m().n4)(n,i)||n.some((n=>{const i={id:n,spaceId:o,table:p().SC},r=u().b.createChildStore(e,i).getModel(),a=u().b.createChildStore(t,i).getModel();return!(0,d().O9)(r)||!(0,d().O9)(a)||!(0,m().n4)(r.getConfig(),a.getConfig())}))}return t.getActionIds().length>0}(e,t))}var y=()=>o(486674),h=()=>o(246125),f=()=>o(244828),v=()=>o(629782);function x(e){const t=new(l().Z)({deadlockTimeoutMs:f().DEADLOCK_WARNING_TIMEOUT_MS});return{performResult:e.perform(t),serverCommitResult:Promise.resolve(void 0),transactionId:t.id}}function S(e){const{automationId:t,spaceId:o,defaultValue:l,persist:u}=e,p=(0,r().v3)(),m=(0,a().K8)((()=>{var e;return null===(e=i().default.state.currentUserStore)||void 0===e?void 0:e.userId}),[]),x=(0,n.useMemo)((()=>{if(t&&o)return{id:t,table:c().yB,spaceId:o}}),[t,o]),S=(0,h().l)("useUnpersistedAutomationStore",{cacheFallback:p.defaultRecordCache.inMemoryRecordCache,isTemporaryData:!0}),b=(0,n.useMemo)((()=>{if(!x||u)return;const e=S.getEntry({pointer:x,userId:m});if(!(0,d().O9)(e)&&m){if(!l)throw new Error("create is true but no defaultValue provided");S.setRecord({pointer:x,userId:m},{role:"editor",value:l})}return new(s().d)(p,x,{inMemoryRecordCache:S})}),[l,p,u,x,S,m]),A=(0,a().K8)((()=>{const e=(0,y().a)();if(x&&e)return s().d.createChildStore(e,x)}),[x]),C=u?A:b,k=(0,a().K8)((()=>!u&&g(A,b)),[u,A,b]),{createAndCommit:j}=(0,v().D)({unpersistedInMemoryRecordCache:S}),I=(0,n.useCallback)((e=>u?f().createAndCommit({...e,canUndo:!0,environment:p}):j(e)),[j,p,u]);return{maybePersistedTransactionActions:{createAndCommit:I},maybePersistedAutomationStore:C,hasUnpersistedChanges:k}}},656476:(e,t,o)=>{o.d(t,{rD:()=>v,zH:()=>f});var n=o(296540),i=()=>o(401497),r=()=>o(807449),a=()=>o(791089),s=()=>o(652620),l=()=>o(980357),c=()=>o(69708),d=()=>o(284371),u=()=>o(340743),p=()=>o(214973),m=()=>o(741310),g=()=>o(923832),y=()=>o(16707),h=o(474848);function f(e){const{actionId:t,actionMenu:o,buttonPopupStore:f,disabled:x,onClick:S,propertySchema:b,value:A}=e,C=(0,i().IS)((()=>({content:{alignItems:"center",display:"flex"},propertyName:{...d().RC,fontWeight:d().Wy.medium}})),[]),k=function(e){const{propertySchema:t,styles:o,value:n}=e,i=(0,h.jsx)("span",{style:o.propertyName,children:t.name});let d;const m="formula"===(null==n?void 0:n.type);if(m)d=(0,h.jsx)(y().g,{returnType:{type:"checkbox"}});else{const e=(0,a().fromSimpleFormulaArrayValue)(null==n?void 0:n.value)[0],t=!0===e?(0,h.jsx)(r().I,{icon:s().h,size:"xs"}):(0,h.jsx)(r().I,{icon:l().u,size:"xs"});d=(0,h.jsx)(u().G,{icon:t,shouldTruncateChildren:!0,children:!0===e?(0,h.jsx)(c().sA,{...p().CV.actionCheckboxPropertyChecked}):(0,h.jsx)(c().sA,{...p().CV.actionCheckboxPropertyUnchecked})})}return(0,h.jsx)(c().sA,{...p().Xr({propertyName:i,propertyValue:d})})}({propertySchema:b,styles:C,value:A}),j=v({propertySchema:b,value:A}),I=(0,n.useCallback)((e=>(0,h.jsx)(g().aX,{...e,actionId:t,actionMenu:o,buttonPopupStore:f,disabled:x,icon:s().h,onClick:S,children:(0,h.jsx)("div",{style:C.content,children:k})})),[t,o,f,x,S,C.content,k]);return(0,h.jsx)(m().P,{renderOrigin:I,title:j})}function v(e){const{propertySchema:t,value:o}=e;let n;if("formula"===(null==o?void 0:o.type))n=(0,h.jsx)(y().L,{});else{n=!0===(0,a().fromSimpleFormulaArrayValue)(null==o?void 0:o.value)[0]?(0,h.jsx)(c().sA,{...p().CV.actionCheckboxPropertyChecked}):(0,h.jsx)(c().sA,{...p().CV.actionCheckboxPropertyUnchecked})}return(0,h.jsx)(c().sA,{...p().Xr({propertyName:t.name,propertyValue:n})})}},658160:(e,t,o)=>{o.d(t,{U:()=>C});o(296540);var n=()=>o(726637),i=()=>o(590526),r=()=>o(401497),a=()=>o(127833),s=()=>o(250910),l=()=>o(118307),c=()=>o(791089),d=()=>o(100622),u=()=>o(284371),p=()=>o(548526),m=()=>o(227124),g=()=>o(39620),y=(o(581454),()=>o(69708)),h=()=>o(534177),f=()=>o(475403),v=()=>o(805452),x=()=>o(821481),S=o(474848);function b(e){const{context:t,currentSimpleFormulaValueTokens:o,disabled:n,formulaTypecheckContextValues:i,parentRecordStore:a,placeholder:s,spaceId:l,type:c,value:d}=e,u=(0,r().IS)((()=>({tokenWrap:{display:"flex",alignItems:"center",flexGrow:1,overflow:"hidden",marginTop:6}})),[]),p=(0,v().pg)(t);if("formula"===(null==d?void 0:d.type)&&d.value)return(0,S.jsx)(f().$,{formulaTypecheckContextValues:i??[],parentRecordStore:a,spaceId:l,value:d});if("text"===c.type||"number"===c.type)return null;if("date"===c.type||"select"===c.type||"checkbox"===c.type){const e=o[0];return void 0===e?(0,S.jsx)(A,{placeholder:s}):(0,S.jsx)("div",{style:u.tokenWrap,children:(0,S.jsx)(g().g,{token:e,parentRecordStore:a,disabled:n,currentSimpleFormulaValueTokens:o,context:t})})}return"person_array"===c.type||"block_array"===c.type||"select_array"===c.type?0===o.length?(0,S.jsx)(A,{placeholder:s}):(0,S.jsx)("div",{style:u.tokenWrap,children:p(o,"first").map(((e,i)=>(0,S.jsx)(g().g,{token:e,parentRecordStore:a,disabled:n,currentSimpleFormulaValueTokens:o,context:t},i)))}):void(0,h().HB)(c)}function A(e){const{placeholder:t}=e,o=(0,r().IS)((()=>({placeholderText:{color:d().Tj.text.tertiary}})),[]);return(0,S.jsx)("div",{style:o.placeholderText,children:t?(0,S.jsx)(y().sA,{defaultMessage:"{placeholder}",values:{placeholder:t},id:"formulas.SimpleFormulaValuePicker.people.customPlaceholder"}):(0,S.jsx)(y().sA,{...x().D.personSelect})})}function C(e){const{allowedReturnTypes:t,disabled:o,disableEmojiCommands:y,disableFormattingAndMentions:h,disableMobileActionBar:f,errorMessage:v,formulaTypecheckContextValues:x,limit:A,menuProps:C,onChange:k,parentRecordStore:j,placeholder:I,showClearButton:M,showInputMenuItem:T,simpleFormulaContext:w,spaceId:P,style:_,type:B,value:R}=e,V=!R||"simple"===R.type,E=(0,i().K8)((()=>(0,c().fromSimpleFormulaArrayValue)(null==R?void 0:R.value)),[R]),F=(0,r().IS)((()=>({button:{boxShadow:d().Tj.inputBoxShadow,flexGrow:1,flexShrink:1,fontSize:"inherit",fontWeight:u().Wy.regular,..._}})),[_]),D=(0,i().uB)(void 0,l().A);return(0,S.jsx)(s().A,{alignmentToOrigin:"end",buttonPopupStore:D,disabled:o,originGap:0,placementToOrigin:"bottom",popupType:n().A.isMobile?a().nl.SlideUp:a().nl.Popup,renderOrigin:e=>(0,S.jsx)(p().x,{...e,disabled:o,hasActionRequired:!Boolean(E.length>0),isError:Boolean(v),style:F.button,tooltipMessage:v,dropdownButtonType:"button",children:(0,S.jsx)(b,{currentSimpleFormulaValueTokens:E,context:w,disabled:!0,formulaTypecheckContextValues:x,parentRecordStore:j,placeholder:I,spaceId:P,type:B,value:R})}),render:e=>V?(0,S.jsx)(g().L,{currentSimpleFormulaValueTokens:E,disableEmojiCommands:y,disableFormattingAndMentions:h,disableMobileActionBar:f,formulaTypecheckContextValues:x,formulaValueContext:w,limit:A,menuProps:C,onChange:k,onClose:e.close,parentRecordStore:j,showClearButton:M,showInputMenuItem:T,type:B,value:R}):(0,S.jsx)(m().A,{allowedReturnTypes:t,disabled:o,formulaTypecheckContextValues:x,onChange:k,onClose:e.close,parentRecordStore:j,restrictUnaccessibleProperties:"cross_space_and_read_permissions",spaceId:P,value:R})})}},662971:(e,t,o)=>{o.d(t,{A:()=>m});var n=o(296540),i=()=>o(30537);const r=function(){const[e,t]=n.useState({x:0,y:0});return n.useEffect((()=>{const e=e=>{t({x:e.clientX,y:e.clientY})};return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[]),e};var a=o(474848);function s({x:e,mouseX:t}){return t>e?void 0:-Math.max(e-t,10)+"px"}function l({x:e,width:t,mouseX:o}){return o>e?-Math.max(o-(e+t),10)+"px":void 0}function c({x:e,width:t,mouseX:o}){return o>e?`${Math.max(o-(e+t),10)}px`:`${Math.max(e-o,10)}px`}function d({x:e,y:t,height:o,mouseX:n,mouseY:i}){return n>e?`polygon(0% 0%, 0% 100%, 100% ${100*(i-t)/o}%)`:`polygon(100% 0%, 0% ${100*(i-t)/o}%, 100% 100%)`}function u(e){const{x:t=0,y:o=0,height:i=0,width:u=0}=e.el.getBoundingClientRect()||{},{x:p,y:m}=r(),g={x:t,y:o,height:i,width:u,mouseX:p,mouseY:m},y=(0,n.useRef)(null),h=n.useCallback((e=>{if(y.current){y.current.style.pointerEvents="none";const t=document.elementFromPoint(e.clientX,e.clientY);if(y.current.style.pointerEvents="auto",t){const o=new MouseEvent(e.nativeEvent.type,e.nativeEvent);t.dispatchEvent(o)}}}),[]),f={insetInlineEnd:l(g),insetInlineStart:s(g),height:i,width:c(g),clipPath:d(g)};return(0,a.jsx)("div",{ref:y,onClick:h,style:{cursor:"pointer",position:"absolute",pointerEvents:"auto",top:0,...f}})}function p({onClick:e,renderOrigin:t,renderExtension:r,allowOptionalExtensionMenu:s,...l},c){const{disabled:d,disableDefaultClick:p,onFocus:m,focused:g,openOnFocus:y,placementToOrigin:h,alignmentToOrigin:f,disableCloseOnEnter:v,bottomSheetInitialState:x,popupTypeOverride:S}=l,b=(0,o(484714).WS)(),A=(0,o(546926).Tf)(),[C,k]=(0,n.useState)(!1),j=(0,n.useRef)(null),I=(0,n.useRef)(null),M=(0,n.useRef)(null),T=(0,n.useRef)(null),w=(0,n.useCallback)((()=>{M.current&&window.clearTimeout(M.current),T.current&&window.clearTimeout(T.current),M.current=null,T.current=null}),[]),P=(0,n.useCallback)((()=>{w(),d||k(!0)}),[d,w]),_=(0,n.useCallback)((()=>{w(),k(!1)}),[w]),B=(0,n.useCallback)((e=>{w(),C||(e&&e.preventDefault&&e.preventDefault(),M.current=window.setTimeout(P,120))}),[C,w,P]),R=(0,n.useCallback)((()=>{w(),C&&(T.current=window.setTimeout(_,100))}),[C,_,w]),V=(0,n.useCallback)((t=>{m(),P(),s&&(null==e||e(t),_())}),[m,P,s,e,_]),E=(0,n.useCallback)((()=>{B()}),[B]),F=(0,n.useCallback)((()=>{m(),B()}),[m,B]),D=(0,n.useCallback)((e=>{if(o(726637).A.isMobile)return;const t=j.current;C&&t&&!t.contains(e.target)&&_()}),[C,_]),L=(0,n.useCallback)((e=>{13===e.keyCode&&C&&!v&&_()}),[C,_,v]);(0,n.useEffect)((()=>{if(!Boolean(p))return window.addEventListener("click",D),()=>{window.removeEventListener("click",D)}}),[p,D]),(0,n.useEffect)((()=>(window.addEventListener("keydown",L),()=>{window.removeEventListener("keydown",L)})),[L]);const O=(0,n.useRef)(g);(0,n.useEffect)((()=>{y&&!O.current&&g?B():!g&&O.current&&R(),O.current=g}),[g,y,B,R]);const K=(0,o(401497).IS)((()=>({mobilePopupStyle:{borderRadius:12,backgroundColor:o(100622).Tj.background.secondary}})),[]),N={...(0,o(383036).A)({onMouseEnter:E,onClick:V},l),showExtensionArrow:!0};let W=i().n.Popup;return S?W=S:b&&(W=A?i().n.BottomSheet:i().n.SlideUp),(0,a.jsx)(o(782482).N,{debugName:"ExtensionMenuItem",capture:g,onEnter:C?void 0:B,onRight:B,onLeft:C?R:void 0,onEsc:C?R:void 0,children:(0,a.jsx)(o(127833).zD,{popupType:W,bottomSheetInitialState:x,open:C,origin:t(N,c),placementToOrigin:h??"right",alignmentToOrigin:f??"center",originGap:0,disableMouseCapture:!0,preventBlockRenderQueueOnEnter:!0,preventScaleTransition:!b,preventCaptureEsc:!0,ref:j,render:()=>(0,a.jsxs)(a.Fragment,{children:[!b&&I.current?(0,a.jsx)(u,{el:I.current}):null,(0,a.jsx)("div",{ref:I,style:{height:"100%"},children:r({onMouseEnter:F},{close:R})})]}),style:{overflow:"visible",...b&&K.mobilePopupStyle},trapFocus:!0,onDismiss:_})})}const m=n.forwardRef(p)},668143:(e,t,o)=>{o.d(t,{A:()=>S});o(944114),o(296540);var n=()=>o(692031),i=()=>o(212497),r=()=>o(484714),a=()=>o(546926),s=()=>o(890492),l=()=>o(663639),c=()=>o(736847),d=()=>o(700500),u=()=>o(775842),p=()=>o(742852),m=()=>o(201980),g=()=>o(69708),y=()=>o(443120),h=()=>o(384944),f=()=>o(575143),v=()=>o(244828),x=o(474848);function S(e){const{store:t,parentBlockStore:o,onAccept:S,token:b,href:A,hoverData:C}=e,k=(0,r().v3)(),j=[];return j.push({key:0,render:e=>(0,x.jsx)(c().A,{...e,style:{paddingTop:0,paddingBottom:0}}),items:[{key:"copy link",render:e=>(0,x.jsx)(f().A,{...e,title:(0,x.jsx)(g().sA,{id:"linkMention.copyLink",defaultMessage:"Copy link"}),svg:p().linkIcon}),action:async()=>{if(!t)return;if(!b)return;const[e,o]=await Promise.all([(0,n().r)(),(0,i().jd)()]),r=e.copiedLinkToClipboard;o({environment:k,stringValue:A,copiedMessage:r})}}]}),j.push({key:1,render:e=>(0,x.jsx)(c().A,{...e,style:{paddingTop:0,paddingBottom:0}}),items:[{key:"convert to bookmark",render:e=>(0,x.jsx)(f().A,{...e,title:(0,x.jsx)(g().sA,{id:"linkMention.convertToBookmark",defaultMessage:"Turn into preview"}),svg:u().a}),action:()=>{t&&b&&v().createAndCommit({userAction:"LinkMentionMenu.convertToBookmark",environment:k,canUndo:!0,perform:e=>{if(C){const n=h().Wv({environment:k,type:d().xd.bookmark,inMemoryRecordCache:t.inMemoryRecordCache,properties:{title:C&&C.title?m().x9d(C.title):m().x9d(A),link:m().x9d(A),description:C&&C.description?m().x9d(C.description):void 0},format:{bookmark_cover:C.thumbnail_url,bookmark_icon:C.favicon_url?C.favicon_url:C.icon_url},transaction:e,spaceId:t.pointer.spaceId});y().ed({environment:k,parentBlockStore:o,blockStore:n,token:b,transaction:e})}else{const n=h().Wv({environment:k,type:d().xd.bookmark,inMemoryRecordCache:t.inMemoryRecordCache,properties:{title:m().x9d(A),link:m().x9d(A)},transaction:e,spaceId:t.pointer.spaceId});y().ed({environment:k,parentBlockStore:o,blockStore:n,token:b,transaction:e})}}})}}]}),(0,x.jsx)(s().A,{menuType:a().gu.Popup,children:(0,x.jsx)(l().A,{type:l().O.Vertical,initialFocus:void 0,onAccept:S,sections:j,style:{paddingTop:3,paddingBottom:3}})})}},686169:(e,t,o)=>{o.d(t,{w:()=>Te,J:()=>we});var n=o(296540),i=()=>o(590526),r=()=>o(239381),a=()=>o(546461),s=(o(16280),o(898992),o(354520),()=>o(564884)),l=()=>o(484714),c=()=>o(401497),d=()=>o(732810),u=()=>o(250910),p=()=>o(118307),m=()=>o(368609),g=()=>o(310109),y=()=>o(214388),h=()=>o(43864),f=()=>o(784892),v=()=>o(69708),x=()=>o(534177),S=()=>o(284371),b=()=>o(384944),A=()=>o(634292),C=()=>o(637759),k=()=>o(908201),j=()=>o(16006),I=()=>o(744951),M=()=>o(244828),T=()=>o(653417),w=()=>o(122414),P=()=>o(366360),_=()=>o(133518),B=()=>o(656134),R=()=>o(475679),V=()=>o(95199),E=()=>o(548526),F=()=>o(194373),D=()=>o(923832),L=()=>o(890492),O=()=>o(736847),K=()=>o(184979),N=()=>o(497222),W=()=>o(44935),z=()=>o(781697),U=o(474848);function H(e){const{filter:t,onChange:o,onClose:r,collectionStore:a}=e,s=(0,k().Ks)(),l=(0,i().K8)((()=>a.getSchema()),[a]),c=(0,z().e)({minWidth:300,tabletBehavior:"actionSheet"}),d=(0,n.useCallback)(((e,t)=>o(t)),[o]),u=(0,n.useCallback)((()=>{o(void 0),r()}),[o,r]);return(0,U.jsxs)(L().A,{...c,children:[(0,U.jsx)(W().i,{children:(0,U.jsx)(K().tY,{collectionViewId:"Automation.FilterMenu",collectionContextStore:s,collectionViewType:"table",combinatorFilter:t||y().AY,index:0,level:0,onChange:d,parentStore:a,schema:l})}),(0,U.jsx)(O().A,{topBorder:!0,children:(0,U.jsx)(N().A,{title:(0,U.jsx)(v().sA,{defaultMessage:"Delete filter",id:"automations.AutomationCombinatorFilterPopup.deleteFilter.label"}),onClick:u})})]})}const Y=(0,v().YK)({multipleTargetsFilter:{defaultMessage:"<span>Edit </span>{filterPicker}",id:"automations.UpdatePagesAction.multipleTargetsFilter"},multipleTargetsPicker:{defaultMessage:"<span>in </span>{targetPicker}",id:"automations.UpdatePagesAction.multipleTargetsPicker"},singleTarget:{defaultMessage:"<span>Edit </span>{targetPicker}",id:"automations.UpdatePagesAction.singleTarget"}});function G(e){const{actionStore:t}=e,o=(0,l().v3)(),{automationStore:r,typecheckResult:s}=(0,a().q8)(),{disabled:c,suppressActionErrors:d}=(0,P().b)(),u=(0,i().K8)((()=>t.getTargetStore()),[t]),y=(0,i().K8)((()=>r.isTriggerType("button")),[r]),f=(0,k().Ks)(),S=(0,i().K8)((()=>Z(t,(0,g().getAllContextValues)(s))),[t,s]),A=(0,i().K8)((()=>{var e;const o=t.getCollectionTargetStore(),n=null==o||null===(e=o.getKeyStore("filter"))||void 0===e?void 0:e.getValue();if(n)return(0,h().SK)(n,(null==S?void 0:S.getSchema())||{})}),[t,S]),j=(0,i().K8)((()=>{const e=t.getVariableTargetStore();if(e)return e.getValue();const o=t.getCollectionTargetStore();if(o){const e=o.getKeyStore("collection").getValue();if(e)return{collection:e,type:"collection"}}}),[t]),I=(0,i().K8)((()=>{if(!j||"variable"!==j.type)return!1;const e=(0,g().getContextValueForActionById)(s,t.id,j.id),o=null==e?void 0:e.type;return!!o&&("block"===o.type||"array"===o.type&&"block"===o.of.type)}),[t.id,j,s]),_=(0,i().uB)(void 0,p().A),B=(0,n.useCallback)((()=>_.reset()),[_]),E=(0,n.useMemo)((()=>(0,U.jsx)(R().z,{actionStore:t,closeMenu:B})),[t,B]),F=(0,n.useMemo)((()=>!d.includes(t.id)),[d,t]),L=(0,i().K8)((()=>{if(S)return F&&!(0,C().bI)({actionStore:t,collectionStore:S,typecheckResult:s})?(0,U.jsx)(v().sA,{...T().automationErrorMessages.actionIncompleteErrorMessage}):void 0}),[t,S,F,s]),{errorMessage:O,errorIcon:K}=(0,T().useErrorComponentForAction)({actionId:t.id,shouldShow:F,errorKeys:["target","collection","block"]}),{errorMessage:N,errorIcon:W}=(0,T().useErrorComponentForAction)({actionId:t.id,errorKey:"filter",shouldShow:F}),z=(0,i().K8)((()=>(0,x().O9)(t.getConfigStore().getKeyStore("target").getValue())),[t]),H=(0,n.useCallback)((e=>{M().createAndCommit({userAction:"UpdatePagesAction.filterChange",environment:o,canUndo:!0,perform:t=>{b().zv({data:{filter:e},store:u,transaction:t})}}),(0,w().UB)(o,{automationStore:r,automationActionStore:t})}),[t,r,o,u]),Y=(0,n.useCallback)((e=>{let n;if("collection"===e.type)n="UpdatePageAction.updateCollection";else if("variable"===e.type)n="UpdatePageAction.updateVariable";else{if("page"===e.type||"property"===e.type||"formula"===e.type||"url"===e.type||"private_space"===e.type)throw new Error("Not implemented yet.");(0,x().HB)(e)}M().createAndCommit({userAction:n,environment:o,canUndo:!0,perform:o=>{b().zv({data:{properties:null,target:e,values:null},store:t.getConfigStore(),transaction:o})}}),(0,w().UB)(o,{automationStore:r,automationActionStore:t})}),[o,r,t]),G=Boolean(c),Q=(0,m().getActionRegistryItem)("update_pages");return(0,U.jsx)(k().RI,{value:y?void 0:f,children:(0,U.jsxs)(D().OT,{actionMenu:E,buttonPopupStore:_,disabled:G,actionId:t.id,canCollapse:z,children:[(0,U.jsx)(D().h3,{actionId:t.id,actionRegistryItem:Q,disabled:G,styles:{headerWrap:{paddingInlineEnd:32},titleWrap:{display:"grid",gridTemplateColumns:"auto 1fr"}},errorMessage:O||N||L,children:I||!S?(0,U.jsx)(q,{actionStore:t,disabled:G,errorMessage:O,errorIcon:K,onTargetChange:Y,value:j}):(0,U.jsx)($,{actionStore:t,collectionStore:S,disabled:G,errorMessage:O,errorIcon:K,filterErrorIcon:W,filterErrorMessage:N,filter:A,onFilterChange:H,onTargetChange:Y,value:j})}),S?(0,U.jsx)(D().qt,{disabled:G,styles:{bodyWrap:{display:"grid",gap:8,gridTemplateColumns:"1fr",minWidth:0}},children:(0,U.jsx)(V().Ud,{actionStore:t,collectionStore:S,disabled:G,showSetPropertyActions:!0})}):void 0]})})}function q(e){const{actionStore:t,disabled:o,errorMessage:n,onTargetChange:i,value:r,errorIcon:a}=e,s=(0,c().IS)((()=>({b:{fontWeight:S().Wy.medium},span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]);return(0,U.jsx)("div",{style:s.title,children:(0,U.jsx)(v().sA,{...Y.singleTarget,values:{b:e=>(0,U.jsx)("b",{style:s.b,children:e}),targetPicker:(0,U.jsx)(X,{actionStore:t,disabled:o,errorMessage:n,errorIcon:a,onChange:i,value:r}),span:e=>(0,U.jsx)("span",{style:s.span,children:e})}})})}function $(e){const{actionStore:t,collectionStore:o,disabled:n,errorMessage:i,errorIcon:r,filterErrorMessage:a,filterErrorIcon:s,filter:l,onFilterChange:d,onTargetChange:u,value:p}=e,m=(0,c().IS)((()=>({span:{flex:0,display:"flex",alignItems:"center"},title:{display:"inline-flex",minWidth:50,gap:6}})),[]);return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsxs)("div",{style:m.title,children:[(0,U.jsx)(v().sA,{...Y.multipleTargetsFilter,values:{filterPicker:(0,U.jsx)(Q,{collectionStore:o,disabled:n,errorMessage:a,errorIcon:s,filter:l,onChange:d}),span:e=>(0,U.jsx)("span",{style:m.span,children:e})}}),""]}),(0,U.jsx)("div",{style:m.title,children:(0,U.jsx)(v().sA,{...Y.multipleTargetsPicker,values:{targetPicker:(0,U.jsx)(X,{actionStore:t,disabled:n,errorMessage:i,errorIcon:r,onChange:u,value:p}),span:e=>(0,U.jsx)("span",{style:m.span,children:e})}})})]})}function Q(e){var t;const{collectionStore:o,disabled:r,errorMessage:a,filter:s,onChange:l,errorIcon:c}=e,d=(0,i().uB)(void 0,p().A),m=(0,B().j)({tabletBehavior:"slideUp"}),g=(0,n.useCallback)((()=>d.reset()),[d]),h=(0,i().K8)((()=>{const e=o.getModel(),t=null==e?void 0:e.getDatabaseType();return(0,A().oj)(t)}),[o]),f=(null==s||null===(t=s.filters)||void 0===t?void 0:t.length)||0;return(0,U.jsx)(u().A,{alignmentToOrigin:"center",disabled:r,originGap:0,placementToOrigin:"bottom",popupType:m,renderOrigin:e=>(0,U.jsx)(E().x,{...e,disabled:r,isCompact:!0,errorIcon:c,onClick:t=>{e.onClick(t),0===f&&l(y().Lx)},dropdownButtonType:"dropdown",isError:Boolean(a),tooltipMessage:a,children:f>0?(0,U.jsx)(v().sA,{defaultMessage:"{itemType} that match {ruleCount, plural, one {{ruleCount} filter} other {{ruleCount} filters}}",id:"automations.UpdatePagesAction.FilterPicker.withRules",values:{itemType:h,ruleCount:f}}):(0,U.jsx)(v().sA,{defaultMessage:"all {itemType}",id:"automations.UpdatePagesAction.FilterPicker.noRules",values:{itemType:h}})}),render:()=>(0,U.jsx)(H,{collectionStore:o,disabled:r,filter:s,onChange:l,onClose:g})})}function X(e){const{actionStore:t,disabled:o,errorMessage:r,onChange:c,value:m,errorIcon:y}=e,h=(0,l().v3)(),{automationStore:S,typecheckResult:b}=(0,a().q8)(),A=(0,_().F)({actionId:t.id}),C=(0,i().K8)((()=>{if("collection"===(null==m?void 0:m.type))return d().m.createChildStore(t,m.collection)}),[t,m]),k=(0,i().K8)((()=>{if(b&&m&&"variable"===m.type)return(0,g().getContextValueForActionById)(b,t.id,m.id)}),[b,m,t.id]),M=(0,i().uB)(void 0,p().A),T=(0,B().j)(),P=(0,n.useCallback)((()=>M.reset()),[M]),R=(0,n.useCallback)((e=>{c(e),P(),(0,w().CM)(((o,n,i)=>{const r=(0,w().zc)({automationActionStore:t,formulasModule:o,formulaAnalyticsModule:n,simpleFormulasModule:i});(0,x().O9)(r)&&(0,s().u)({environment:h,event:{eventName:"automation_target_pick",eventProperties:{automation_action:r,automation_id:t.getParentId(),target_type:e.type}}})}))}),[c,P,t,h]);return(0,U.jsx)(u().A,{buttonPopupStore:M,popupType:T,alignmentToOrigin:"center",placementToOrigin:"bottom",originGap:0,disabled:o,renderOrigin:e=>(0,U.jsx)(E().x,{...e,disabled:o,isCompact:!0,isError:Boolean(r),errorIcon:y,hasActionRequired:!Boolean(m||k),dropdownButtonType:"dropdown",children:(0,x().O9)(C)?(0,U.jsx)(j().A,{store:C,style:{paddingBlock:1}}):k?(0,U.jsx)(I().F,{format:f().NY.Medium,isSingle:!0,value:k,style:{background:"transparent",color:"unset",margin:"-1.5px 0",padding:0}}):(0,U.jsx)(v().sA,{id:"automations.UpdatePagesAction.dataSourcesDropdown.label",defaultMessage:"Select data source"})}),render:e=>(0,U.jsx)(F()._,{formulaTypecheckContextValues:A,onChange:R,onClose:P,parentRecordStore:S,selectedTarget:m,skipPages:!0,skipPrivateSpace:!0})})}function Z(e,t){const o=e.getTargetStore().getValue();if(o){if("collection"===o.type)return d().m.createChildStore(e,o.collection);if("variable"===o.type){if(!t)return;const n=(0,r().IV)(t,o.id);if(n)return(0,C().A8)(n,e)}else"page"===o.type||(0,x().HB)(o)}}var J=()=>o(422540),ee=()=>o(352271),te=()=>o(898244),oe=()=>o(80979),ne=()=>o(791089),ie=()=>o(519831),re=()=>o(89053),ae=()=>o(439612),se=()=>o(656476),le=()=>o(100622),ce=()=>o(541172),de=()=>o(217028);function ue(e){const{actionId:t,actionMenu:o,buttonPopupStore:n,disabled:i,onClick:r,propertySchema:a}=e,s=(0,c().IS)((()=>({icon:{fill:le().Tj.red.text.accentPrimary},propertyType:{color:le().Tj.palette.red[700]}})),[]),l=function(e){const{propertySchema:t,styles:o}=e,n=t.name;return(0,U.jsx)(v().sA,{defaultMessage:"{propertyName} is a cross-workspace relation",id:"updateThisPageCrossSpaceRelationAction.crossSpaceRelation.title",values:{propertyName:(0,U.jsx)("span",{style:o.propertyType,children:n})}})}({propertySchema:a,styles:s}),d=function(e){const{propertySchema:t}=e,o=t.name;return(0,U.jsx)(v().sA,{defaultMessage:"{propertyName} is a cross-workspace relation. Cross-workspace features are restricted in automations and will not work.",id:"updateThisPageCrossSpaceRelationAction.crossSpaceRelation.text",values:{propertyName:o}})}({propertySchema:a});return(0,U.jsx)(de().z$,{actionId:t,actionMenu:o,buttonPopupStore:n,disabled:i,onClick:r,propertyType:a.type,styles:s,tooltip:d,children:l})}function pe(e){const{actionId:t,renderOrigin:o}=e,r=(0,B().j)(),a=(0,i().uB)(void 0,p().A),s=(0,n.useCallback)((()=>a.reset()),[a]);return(0,U.jsx)(u().A,{buttonPopupStore:a,popupType:r,render:()=>(0,U.jsx)(ce().qM,{actionId:t,closeMenu:s}),renderOrigin:o})}var me=()=>o(307159),ge=()=>o(984714),ye=()=>o(347114),he=(o(581454),()=>o(888867)),fe=()=>o(397785),ve=()=>o(741310);function xe(e){const{action:t,actionId:o,actionMenu:i,buttonPopupStore:r,disabled:s,onClick:l,propertySchema:c,value:d}=e,{automationStore:u,typecheckResult:p}=(0,a().q8)(),m=(0,n.useMemo)((()=>(0,g().getAllContextValues)(p)),[p]),{title:y,tooltipTitle:h,styles:f}=(0,fe().oG)({automationStore:u,getRecordModel:u.getRecordModel,contextValues:m,messageType:"action",operator:t,propertySchema:c,value:d}),v=(0,n.useCallback)((e=>(0,U.jsx)(D().aX,{...e,actionId:o,actionMenu:i,buttonPopupStore:r,disabled:s,icon:he().s,onClick:l,children:(0,U.jsx)("div",{style:f.content,children:y})})),[o,i,r,s,l,f.content,y]);return(0,U.jsx)(ve().P,{renderOrigin:v,title:h})}var Se=()=>o(8741),be=()=>o(457050);function Ae(e){const{action:t,actionId:o,actionMenu:i,buttonPopupStore:r,collectionStore:a,disabled:s,onClick:l,propertySchema:c,value:d}=e,u=(0,_().F)({actionId:o}),{tooltipTitle:p,title:m}=(0,be().xL)({automationContextValues:u,collectionStore:a,messageType:"action",operator:t,propertySchema:c,value:d}),g=(0,n.useCallback)((e=>(0,U.jsx)(D().aX,{...e,actionId:o,actionMenu:i,buttonPopupStore:r,disabled:s,icon:Se().arrowDiagonalUpRightSmallIcon,onClick:l,children:m})),[o,i,r,s,l,m]);return(0,U.jsx)(ve().P,{renderOrigin:g,title:p})}var Ce=()=>o(575630),ke=()=>o(776800),je=()=>o(359186);function Ie(e){var t;const{actionStore:o}=e,r=(0,a().fi)(),{disabled:s}=(0,P().b)(),[l,c]=(0,i().K8)((()=>[o.id,o.getConfig()]),[o]),d=(0,_().F)({actionId:l}),u=(0,i().K8)((()=>Z(o,d)),[o,d]),m=(0,i().K8)((()=>null==u?void 0:u.getSchema()),[u]),g=(0,i().K8)((()=>null==u?void 0:u.getDeletedSchema()),[u]),y=(0,i().uB)(void 0,p().A),h=(0,n.useCallback)((()=>y.reset()),[y]),f=(0,n.useMemo)((()=>(0,U.jsx)(R().z,{actionStore:o,closeMenu:h})),[o,h]),v=((null==c?void 0:c.properties)??[])[0],x=null==m?void 0:m[v],S=null==g?void 0:g[v],b=null==c||null===(t=c.values)||void 0===t?void 0:t[v],A=Boolean(s),C=(0,i().K8)((()=>{if(!x||!u||!(0,J().I3)(x))return;const e=u.getSpaceId();if(!e)return;return(0,ne().setPropertyValueToSimpleFormulaReturnType)({table:ie().Vl,id:u.id,spaceId:e},v,x)?(0,ne().analyzeSimpleFormulaOrFormulaSync)({context:{allowedReturnTypes:J().Yy[x.type],handleDataRequest:(0,oe().createFormulaDataRequestSyncHandler)(o.getRecordModel),spaceId:e,valueTypes:d.slice(0),featureGates:(0,re().i)(),enableExistenceGuarantees:r},value:null==b?void 0:b.value}):void 0}),[o.getRecordModel,u,r,d,v,x,null==b?void 0:b.value]),k={actionId:o.id,actionMenu:f,buttonPopupStore:y,disabled:A,value:null==b?void 0:b.value,analyzedFormulaOutput:C};return!x&&S?(0,U.jsx)(ge().sF,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(ge().vu,{...e,...k,propertySchema:S})}):x||S?x&&u?(0,J().I3)(x)?"person"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(xe,{...e,...k,propertySchema:x,action:(0,ee().tz)(b)})}):"status"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(ke().II,{...e,...k,propertySchema:x})}):"select"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(Ce().w$,{...e,...k,propertySchema:x})}):"multi_select"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(ye().j,{...e,...k,propertySchema:x,action:(0,ee().tz)(b)})}):"date"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(me().m,{...e,...k,propertySchema:x,valueContext:{collectionStore:u,property:v,type:"collection"}})}):"relation"===x.type&&(0,te().o2)(u.pointer.spaceId,x)?(0,U.jsx)(pe,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(ue,{...e,...k,propertySchema:x})}):"relation"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(Ae,{...e,...k,collectionStore:u,propertySchema:x,action:(0,ee().tz)(b)})}):"checkbox"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(se().zH,{...e,...k,propertySchema:x})}):"title"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(je().EJ,{...e,...k,propertySchema:x})}):"text"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(je().Zd,{...e,...k,propertySchema:x})}):"email"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(je().ef,{...e,...k,propertySchema:x})}):"url"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(je().Vj,{...e,...k,propertySchema:x})}):"number"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(je().T7,{...e,...k,propertySchema:x})}):"phone_number"===x.type?(0,U.jsx)(Me,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(je().Jx,{...e,...k,propertySchema:x})}):null:(0,U.jsx)(de().gI,{actionId:o.id,propertyId:v,renderOrigin:e=>(0,U.jsx)(de().RY,{...e,...k,propertySchema:x})}):null:(0,U.jsx)(ge().sF,{actionId:o.id,renderOrigin:e=>(0,U.jsx)(ge().qR,{...e,...k})})}function Me(e){const{actionId:t,propertyId:o,renderOrigin:r}=e,a=(0,B().j)(),s=(0,i().uB)(void 0,p().A),l=(0,n.useCallback)((()=>s.reset()),[s]),c=(0,n.useMemo)((()=>({actionId:t,propertyId:o,type:"eventActionProperty"})),[t,o]);return(0,U.jsx)(u().A,{buttonPopupStore:s,popupType:a,render:()=>(0,U.jsx)(ae().A,{initialState:c,onClose:l}),renderOrigin:r})}function Te(e){const{actionStore:t}=e,o=(0,a().K4)(),n=null==o?void 0:o.contextType;return(0,i().K8)((()=>we(n,t)),[t,n])?(0,U.jsx)(Ie,{...e}):(0,U.jsx)(G,{...e})}function we(e,t){var o;if(!t.isType("update_pages"))return!1;const n=t.getConfig(),i="variable"===(null==n||null===(o=n.target)||void 0===o?void 0:o.type)?(0,r().y5)(n.target.id):void 0;return"event"===e&&i&&"global"===i.source&&"button_page"===i.global}},703778:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>i,linkSmallIcon:()=>r});o(296540);var n=o(474848);const i={viewBox:"0 0 16 16",fittedViewBox:"1.87 1.87 12.19 12.19",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M12.848 2.8a3.145 3.145 0 0 0-4.448 0L6.918 4.283a.625.625 0 0 0 .884.883l1.482-1.482c.74-.74 1.94-.74 2.68 0l.294.294c.74.74.74 1.94 0 2.68l-1.482 1.483a.625.625 0 1 0 .884.884l1.482-1.482a3.145 3.145 0 0 0 0-4.449z"}),(0,n.jsx)("path",{d:"M10.472 5.47a.625.625 0 0 0-.884 0L5.229 9.83a.625.625 0 1 0 .884.883l4.359-4.359a.625.625 0 0 0 0-.883"}),(0,n.jsx)("path",{d:"M5.167 6.918a.625.625 0 0 0-.884 0L2.8 8.4a3.146 3.146 0 0 0 0 4.448l.294.294a3.145 3.145 0 0 0 4.449 0l1.482-1.482a.625.625 0 0 0-.884-.884L6.66 12.258c-.74.74-1.94.74-2.68 0l-.295-.294c-.74-.74-.74-1.94 0-2.68L5.167 7.8a.625.625 0 0 0 0-.883"})]})},r=(0,o(340498).wt)("linkSmall",i,"small")},731892:(e,t,o)=>{o.d(t,{UO:()=>h,MK:()=>f,CU:()=>y});o(296540);var n=()=>o(128933),i=()=>o(784489),r=()=>o(590526),a=()=>o(388926),s=()=>o(98126),l=()=>o(700500),c=()=>o(69708),d=()=>o(534177),u=o(474848);const p=(0,c().YK)({pageDuplicatingMessage:{id:"duplicateProgressSnackbar.pageDuplicating",defaultMessage:"Page is duplicating"},contentDuplicatingMessage:{id:"duplicateProgressSnackbar.contentDuplicating",defaultMessage:"Content is duplicating"}});function m(e){const{sourceBlocks:t,stage:o}=e,n=(0,r().K8)((()=>!(t.length<1)&&t[0].isType(l().Gz)),[t]);let i;return"initial"===o?i=n?p.pageDuplicatingMessage:p.contentDuplicatingMessage:(0,d().HB)(o),(0,u.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,u.jsx)(s().k,{size:"sm",onDarkBackground:!0}),(0,u.jsx)("span",{children:(0,u.jsx)(c().sA,{...i})}),(0,u.jsx)("div",{style:{height:24},children:(0,u.jsx)(a().A,{type:"vertical",colorVariant:"inversePrimary",colorPalette:"gray",size:24})})]})}var g=()=>o(977529);function y(e){const{sourceBlocks:t}=e,o=new(g().DI)({sourceBlocks:t,showInitialMessage:v,onClear:x});return o.start(),o.id}function h(e){const t=(0,g().lq)(e);null==t||t.clear()}function f(e){const t=(0,g().lq)(e);null==t||t.complete()}function v(e){const t=(0,u.jsx)(m,{sourceBlocks:e,stage:"initial"});(0,i().f)({item:{label:t,durationMs:"keep"},onDismiss:()=>{(0,g().Yv)()}})}function x(){n().N2()}},766854:(e,t,o)=>{o.d(t,{H:()=>A,Q:()=>b});o(898992),o(672577);var n=()=>o(230711),i=()=>o(907258),r=()=>o(135168),a=()=>o(242422),s=()=>o(929219),l=()=>o(711339),c=()=>o(295633),d=()=>o(700500),u=()=>o(179034),p=()=>o(201980),m=()=>o(384944),g=()=>o(649813),y=()=>o(390650),h=()=>o(381678),f=()=>o(622811),v=()=>o(491848),x=()=>o(482871);function S(e,t,o){const i=(0,h()._)(e),r=null==i?void 0:i.id;if(!r||!o)return;if(!a().default.checkGate({gateName:"full_access_for_created_collection_pages"}))return;if(t.canAdmin())return;const s=t.getSpaceStore();return s&&(0,n().dp)(s,r).isMember()?[{role:"editor",type:"user_permission",user_id:r}]:void 0}function b(e){const{collectionContextStore:t,transaction:o}=e;return(0,v().w)({collectionContextStore:t,transaction:o}),A(e)}function A(e){var t,o,n;const{environment:h,collectionContextStore:v,groupsPointer:b,insertAtIndex:A,shouldCoerce:C,templateStore:k,transaction:j,from:I,tracker:M,inMemoryRecordCache:T,isKeyboard:w,title:P}=e,_=l().default.DO_NOT_USE_markLegacy("collections.add_item_lag");l().default.DO_NOT_USE_measureAfterNextFlushLegacy(_,{environment:h,getData:()=>({...y().kz(v),from:I.createBlock})});const B="collectionTypedView"===v.contextTypeFromStoreState,R=v.databaseTypeFromStoreState,V=v.collectionStoresStore.state,E=V.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly()))||V[0],F=null===(t=(0,r().f)(E))||void 0===t?void 0:t.id,D=i().default.state.currentUserSettingsStore,L=B&&R&&F&&D&&[...D.getAllPreferredCollections(F),...D.getPreferredCollectionsOfType(F,R)]||[];let O;const K=b[0];if("group_header"===I.createBlock&&"location"===K.value.type){const e=K.value.value;if(e){O=V.find((t=>t.id===e.id&&(t.canEdit()||t.canEditCollection()||t.canEditContentOnly())))}}else O=function(e,t){for(const o of e){const e=t.find((e=>e.id===o&&(e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));if(e)return e}}(L,V);const N=O??E,W=null==N?void 0:N.getSpaceId(),z=v.collectionViewStore(),U=v.getViewType(),H=m().Wv({environment:h,type:d().xd.page,inMemoryRecordCache:T,transaction:j,spaceId:W,tracker:M,permissions:S(h,N,W),properties:{title:(0,p().x9d)(P)}});if(!N||!z||!U)return{coercionSucceeded:!0,newStore:H};const Y=null===(o=v.groupsStore.getGroupState(b))||void 0===o?void 0:o.groupUiParentStore;if(!Y)return{coercionSucceeded:!0,newStore:H};const G=c().B.createChildStore(Y,{table:u().ev,id:H.id});k&&s().A.state.online&&g().TB({title:"template",environment:h,store:H,templateStore:k,isKeyboard:w??!1,isCreateIn:!1,transaction:j,from:I.initCollection??"collection_group_actions"});const q=(0,f().j)({environment:h,store:H,collectionStore:N,collectionContextStore:v,groupsPointer:b,shouldCoerce:C,transaction:j}),$=(null===(n=v.groupsStore.getGroupState(b))||void 0===n||null===(n=n.reducerResultStore.state)||void 0===n?void 0:n.blockIds)||[],Q=void 0!==A?A:$.length,X=v.permissionScopesStore.state;if((a().default.checkGate({gateName:"can_create_pages_in_collection_permission"})?X.canCreatePagesInCollection:X.canEditContent)||B){const e=[...$.slice(0,Q),G.id,...$.slice(Q)];(0,x().z)({resultIds:e,collectionViewStore:z,collectionContextStore:v,transaction:j})}return{coercionSucceeded:q,newStore:G}}},774256:(e,t,o)=>{o.d(t,{z:()=>u});o(296540);var n=()=>o(726637),i=()=>o(401497),r=()=>o(396896),a=()=>o(807449),s=()=>o(493552),l=()=>o(642557),c=()=>o(100622),d=o(474848);function u(e){const{children:t,icon:o}=e,u=(0,i().IS)((()=>({iconWrap:{background:c().Tj.gray.background.secondaryTranslucent,borderRadius:4,padding:2}})),[]);return(0,d.jsxs)(r().fI,{gap:8,alignItems:"center",padding:n().A.isMobile?"0px 12px 12px":"0px 0px 8px 0px",children:[(0,d.jsx)("div",{style:u.iconWrap,children:o?(0,d.jsx)(a().I,{...o}):(0,d.jsx)(a().I,{icon:l().lockSmallIcon,size:"sm",colorVariant:"secondary"})}),(0,d.jsx)(s().D,{styleKey:"captionRegular",colorVariant:"secondary",children:t})]})}},774628:(e,t,o)=>{o.d(t,{p:()=>S});var n=o(296540),i=()=>o(587682),r=()=>o(275144),a=()=>o(401497),s=()=>o(295633),l=()=>o(718827),c=()=>o(250910),d=()=>o(807449),u=()=>o(695115),p=()=>o(589407),m=()=>o(105819),g=()=>o(69708),y=()=>o(100622),h=()=>o(347100),f=()=>o(839010),v=()=>o(668143),x=o(474848);function S(e){const{height:t,padding:o,padding_top:S,iframe_url:b,hoverData:A,store:C,token:k,href:j,onDismiss:I}=e,M=(0,g().YK)({editLink:{defaultMessage:"Edit link",id:"hoverPreviewOverlay.editLink"}}),T=(0,g().tz)(),w=(0,n.useRef)(null),P=(0,a().IS)((()=>({content:{width:340,height:"100%",aspectRatio:"auto",position:"relative"},container:{width:340,maxHeight:420,flexDirection:"column",alignItems:"flex-start"},buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:4,fill:y().Tj.icon.tertiary,background:h().xA}})),[]),_=C&&C.recordStoreUIParentStore&&C.recordStoreUIParentStore instanceof s().B?C.recordStoreUIParentStore:C instanceof s().B?C:void 0;return(0,x.jsxs)("div",{style:P.container,children:[e.showEditButton?(0,x.jsx)(u().A,{onClick:e.handleEditClick,icon:m().pencilLineIcon,colorVariant:"primary",ariaLabel:T.formatMessage(M.editLink),hasBackground:!0,style:{position:"absolute",top:8,insetInlineEnd:8,zIndex:1}}):void 0,k&&_&&A?(0,x.jsx)("div",{style:{position:"absolute",top:8,insetInlineEnd:8,zIndex:2},children:(0,x.jsx)(c().A,{popupType:c().z.Popup,placementToOrigin:"right",alignmentToOrigin:"start",originGap:4,onClose:()=>{let e=!1;const t=w.current;t&&(e=(0,i().ux)(t.getBoundingClientRect(),r().$C.x,r().$C.y)),e||null==I||I()},renderOrigin:e=>(0,x.jsx)(l().Ay,{style:P.buttonStyle,...e,children:(0,x.jsx)(d().I,{icon:p().ellipsisIcon,colorVariant:"inversePrimary"})}),render:e=>(0,x.jsx)(v().A,{parentBlockStore:_,store:C,token:k,href:j,hoverData:A,onAccept:()=>e.close()})})}):void 0,(0,x.jsx)(f().A,{source:b,style:P.content,preserveScale:!!(t&&t<1||o),background:!1,height:t&&t>0?t:void 0,aspectRatio:o?o/100:.75,paddingTop:S||void 0})]})}},776800:(e,t,o)=>{o.d(t,{II:()=>f,qC:()=>v});var n=o(296540),i=()=>o(590526),r=()=>o(401497),a=()=>o(791089),s=o(474848);const l={viewBox:"0 0 16 16",fittedViewBox:"1.87 1.87 12.26 12.25",svg:(0,s.jsx)("path",{d:"M8.625 2.5a.625.625 0 1 0-1.25 0v1.964a.625.625 0 1 0 1.25 0zm3.705 2.053a.625.625 0 0 0-.883-.884l-1.389 1.389a.625.625 0 0 0 .884.884zM14.125 8c0 .345-.28.625-.625.625h-1.964a.625.625 0 1 1 0-1.25H13.5c.345 0 .625.28.625.625m-2.678 4.331a.625.625 0 1 0 .884-.884l-1.39-1.389a.625.625 0 0 0-.883.884zM8 14.125a.625.625 0 0 1-.625-.625v-1.964a.625.625 0 1 1 1.25 0V13.5c0 .345-.28.625-.625.625m-4.33-2.678a.625.625 0 0 0 .883.884l1.389-1.389a.625.625 0 0 0-.884-.884zM1.875 8c0-.345.28-.625.625-.625h1.964a.625.625 0 1 1 0 1.25H2.5A.625.625 0 0 1 1.875 8m2.678-4.331a.625.625 0 1 0-.884.884l1.39 1.389a.625.625 0 1 0 .883-.884z"})},c=(0,o(340498).wt)("burstSmall",l,"small");var d=()=>o(69708),u=()=>o(284371),p=()=>o(214973),m=()=>o(741310),g=()=>o(923832),y=()=>o(27511),h=()=>o(16707);function f(e){const{actionId:t,actionMenu:o,buttonPopupStore:l,disabled:f,onClick:x,propertySchema:S,value:b}=e,A=(0,d().tz)(),C=(0,r().IS)((()=>({content:{alignItems:"baseline"},propertyName:{...u().RC,fontWeight:u().Wy.medium}})),[]),k=(0,i().K8)((()=>function(e){const{intl:t,propertySchema:o,styles:n,value:i}=e;if(!i)return;const r=(0,s.jsx)("span",{style:n.propertyName,children:o.name});if("formula"===i.type)return(0,s.jsx)(d().sA,{...(0,p().qx)({propertyName:r,propertyValue:(0,s.jsx)(h().g,{returnType:{type:"text"}})})});const l=(0,a().fromSimpleFormulaArrayValue)(null==i?void 0:i.value)[0];let c;c="string"==typeof l?(0,y().a)({intl:t,groupValues:[],optionValues:[l],propertySchema:o}):(0,s.jsx)(d().sA,{...p().CV.unknownValue});return(0,s.jsx)(d().sA,{...(0,p().qx)({propertyName:r,propertyValue:c})})}({intl:A,propertySchema:S,styles:C,value:b})),[A,S,C,b]),j=(0,i().K8)((()=>v({intl:A,propertySchema:S,value:b})),[A,S,b]),I=(0,n.useCallback)((e=>(0,s.jsx)(g().aX,{...e,actionId:t,actionMenu:o,buttonPopupStore:l,disabled:f,icon:c,onClick:x,children:(0,s.jsx)("div",{style:C.content,children:k})})),[t,o,l,f,x,C.content,k]);return k&&j?(0,s.jsx)(m().P,{renderOrigin:I,title:j}):null}function v(e){const{intl:t,propertySchema:o,value:n}=e;if(!n)return;const i=o.name;if("formula"===n.type)return(0,s.jsx)(d().sA,{...(0,p().qx)({propertyName:i,propertyValue:(0,s.jsx)(h().L,{})})});const r=(0,a().fromSimpleFormulaArrayValue)(null==n?void 0:n.value)[0];let l;return l="string"==typeof r?(0,y().a)({intl:t,isText:!0,groupValues:[],optionValues:[r],propertySchema:o}):(0,s.jsx)(d().sA,{...p().CV.unknownValue}),(0,s.jsx)(d().sA,{...(0,p().qx)({propertyName:i,propertyValue:l})})}},780863:(e,t,o)=>{o.d(t,{p:()=>l});var n=o(296540),i=()=>o(40845),r=()=>o(496603),a=()=>o(440024);const s={isRepositioning:!1};function l(e){const{currentPosition:t,imageUrl:o,onSavePosition:l,onPositionChange:c,rootRef:d,environment:u}=e,[p,m]=(0,n.useState)(s),{isRepositioning:g}=p,y=(0,n.useCallback)((()=>{m(s)}),[]),h=(0,n.useMemo)((()=>void 0!==p.temporaryPosition?p.temporaryPosition:t),[p.temporaryPosition,t]);(0,n.useEffect)((()=>{c&&c(h)}),[h,c]);const f=(0,n.useCallback)((e=>{(0,a().I)({environment:u});const t=new Image;t.onload=()=>{m((e=>({...e,isRepositioning:!0,image:t})))};const n=e||o;n&&(t.src=n)}),[u,o]),v=(0,n.useCallback)((()=>{l(h),y()}),[l,h,y]),x=(0,n.useCallback)((()=>{y()}),[y]);(0,n.useEffect)((()=>{const e=e=>{const t=d.current;t&&e.target instanceof Node&&!t.contains(e.target)&&g&&v()};return g&&window.addEventListener("mousedown",e),()=>{window.removeEventListener("mousedown",e)}}),[g,v,d]);const S=(0,n.useCallback)((e=>{const{image:t}=p;if(!t||!g)return;const o=d.current;if(o&&o instanceof Element){const e=o.getBoundingClientRect().width/t.width*t.height;m((t=>({...t,startDragImageScreenHeight:e,startDragRenderedPosition:h})))}}),[p,g,h,d]),b=(0,n.useCallback)((e=>{if(!g)return;const{startDragImageScreenHeight:t,startDragRenderedPosition:o}=p,n=e.diffY/(t||0)+(o||0);m((e=>({...e,temporaryPosition:(0,r().LI)((0,i().A)(n,0,1),4)})))}),[g,p]),A=(0,n.useCallback)((()=>{m((e=>({...e,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})))}),[]),C=(0,n.useMemo)((()=>g?"ns-resize":"default"),[g]);return{isRepositioning:g,currentImagePosition:h,handleDragStart:S,handleDragMove:b,handleDragEnd:A,handleStartReposition:f,handleSavePosition:v,handleCancelReposition:x,repositioningCursor:C}}},781697:(e,t,o)=>{o.d(t,{e:()=>s,v:()=>a});var n=()=>o(484714),i=()=>o(590526),r=()=>o(546926);function a(e){return e.device.isPhone||"actionSheet"===e.tabletBehavior&&e.device.isTablet?{menuType:r().gu.ActionSheet}:{menuType:r().gu.Popup,maxHeight:e.maxHeight,maxWidth:e.maxWidth,paddingTop:e.paddingTop,paddingBottom:e.paddingBottom,width:e.width,minWidth:e.minWidth}}function s(e){const t=(0,n().Y0)();return(0,i().K8)((()=>a({device:t,maxHeight:null==e?void 0:e.maxHeight,maxWidth:null==e?void 0:e.maxWidth,paddingTop:null==e?void 0:e.paddingTop,paddingBottom:null==e?void 0:e.paddingBottom,width:null==e?void 0:e.width,minWidth:null==e?void 0:e.minWidth,tabletBehavior:null==e?void 0:e.tabletBehavior})),[t,null==e?void 0:e.maxHeight,null==e?void 0:e.maxWidth,null==e?void 0:e.paddingTop,null==e?void 0:e.paddingBottom,null==e?void 0:e.width,null==e?void 0:e.minWidth,null==e?void 0:e.tabletBehavior])}},784489:(e,t,o)=>{o.d(t,{f:()=>s});o(296540);var n=()=>o(69708),i=()=>o(203913),r=()=>o(128933),a=o(474848);function s(e){const{item:t,onDismiss:o}=e;r().D6({...t,right:(0,a.jsx)(i().Ag,{onClick:o??r().N2,children:(0,a.jsx)(n().sA,{id:"snackbar.dismiss.title",defaultMessage:"Dismiss"})})})}},801678:(e,t,o)=>{o.d(t,{A:()=>y});var n=o(296540),i=()=>o(756117),r=()=>o(590526),a=()=>o(609679),s=()=>o(69708),l=()=>o(100622),c=()=>o(496603),d=()=>o(806080),u=()=>o(284371),p=()=>o(720665),m=()=>o(46986),g=o(474848);const y=function(e){const t=(0,n.useRef)(null),i=(0,o(484714).v3)(),{renderControl:a,onFlushTemporaryPosition:s,style:l,source:u,store:y}=e,f=(0,r().K8)((()=>0===o(206051).default.state.stores.length),[]),[v,x]=(0,n.useState)(!1),S=(0,r().uB)(e.mouseStore,o(968578).A),b=(0,r().K8)((()=>S.state.mouseEntered),[S]),A=(0,r().K8)((()=>function(e,t){if("gallery"===e||"board"===e){const e=t.getFormat().card_cover_position;if((0,d().Et)(e))return e}const o=.5;var n;if((0,m().V)())return(null===(n=t.getCover())||void 0===n?void 0:n.cover_position)??o;if(t.isCollectionView()){const e=t.getCollectionStoreIfSingleSource();if(e){const t=e.getFormat().collection_cover_position;return(0,p().pN)(t)?o:t}}const i=t.getFormat(),r=i.page_cover_position;if((0,d().Et)(r))return r;return o}(u,y)),[u,y]),{isRepositioning:C,currentImagePosition:k,handleDragStart:j,handleDragMove:I,handleDragEnd:M,handleStartReposition:T,handleSavePosition:w,handleCancelReposition:P,repositioningCursor:_}=(0,o(780863).p)({currentPosition:A,onSavePosition:e=>{s({imagePosition:e,reset:()=>{S.reset()}})},rootRef:t,environment:i}),B=(0,o(401497).IS)((()=>({dragContainer:{width:"100%",cursor:_},container:{position:"relative",width:"100%",zIndex:1}})),[_]);C&&!f&&P();const R=(0,n.useMemo)((()=>(0,c().nF)((e=>{S.setState({...S.state,mouseEntered:!0})}),100)),[S]),V=(0,n.useMemo)((()=>(0,c().sg)((e=>{S.setState({...S.state,mouseEntered:!1})}),100)),[S]),E=(0,n.useCallback)(((e,t)=>{T(t)}),[T]),F=(0,n.useCallback)((e=>{w()}),[w]),D=(0,n.useCallback)((e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,o(819121).p)(t)&&x(!0)}),[]),L=(0,n.useCallback)((()=>{x(!0)}),[]),O=(0,r().K8)((()=>a({handleRepositionClick:E,handleSavePositionClick:F,handleCancelClick:P,isVisible:b||v||C,isRepositioning:C})),[E,F,P,v,C,b,a]),K=(0,o(870956).A)(Boolean(e.preventClickPropagation));return(0,g.jsxs)("div",{ref:t,onFocus:D,onBlur:L,onMouseEnter:R,onMouseMove:R,onMouseLeave:V,...K,...(0,o(451306).ow)(B.container,l),children:[(0,g.jsx)(o(222321).A,{onDraggableDragStart:j,onDraggableDragMove:I,onDraggableDragEnd:M,onDraggableDragCancel:M,disabled:!C,render:t=>(0,g.jsx)("div",{style:B.dragContainer,...t,children:e.render({imagePosition:k,isRepositioning:C})})}),(0,g.jsx)(h,{small:e.small,isRepositioning:C}),O]})};function h({small:e,isRepositioning:t}){if(e)return null;const o={background:l().IF.blackWithAlpha(.4),borderRadius:4,color:l().oZ.white,fontSize:12,fontFamily:u().vc(a().locale).sans,width:180,insetInlineStart:"calc(50% - 90px)",padding:"0.3em 1.5em 0.3em",pointerEvents:"none",position:"absolute",top:"calc(50% - 10px)",textAlign:"center"};return(0,g.jsx)(i().A,{visible:t,initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},style:o,children:(0,g.jsx)(s().sA,{defaultMessage:"Drag image to reposition",id:"withImageRepositioning.dragImage.text"})})}},820579:(e,t,o)=>{o.r(t),o.d(t,{arrowLineDownIcon:()=>i,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.52 2.39 12.95 15.21",svg:(0,o(474848).jsx)("path",{d:"M10 2.4c.345 0 .625.28.625.625v9.966l3.333-3.333a.625.625 0 1 1 .884.884l-4.4 4.4a.625.625 0 0 1-.884 0l-4.4-4.4a.625.625 0 0 1 .884-.884l3.333 3.333V3.025c0-.345.28-.625.625-.625M4.15 16.35a.625.625 0 1 0 0 1.25h11.7a.625.625 0 0 0 0-1.25z"})},i=(0,o(340498).wt)("arrowLineDown",n,"default")},826352:(e,t,o)=>{o.d(t,{j:()=>h});o(296540);var n=()=>o(401497),i=()=>o(699143),r=()=>o(807449),a=()=>o(416783),s=()=>o(631524),l=()=>o(132855),c=()=>o(69708),d=()=>o(100622),u=()=>o(284371),p=()=>o(232930),m=()=>o(546461),g=o(474848);const y=(0,c().YK)({automationRequiresSubscription:{defaultMessage:"Plus plan is required to access this feature. <learnmore>Learn more.</learnmore>",id:"AutomationHeaderView.automationRequiresSubscription"},automationRequiresSubscriptionButton:{defaultMessage:"To edit or run this automation, upgrade your plan or remove any connected action steps. <learnmore>Learn more</learnmore>",id:"AutomationHeaderView.automationRequiresSubscriptionButton"},automationRequiresSubscriptionTitle:{defaultMessage:"Upgrade to use connected actions",id:"AutomationHeaderView.automationRequiresSubscriptionTitle"},automationRequiresSubscriptionUpgradeButton:{defaultMessage:"Upgrade",id:"AutomationHeaderView.automationRequiresSubscriptionUpgradeButton"}});function h(e){const{onUpsellClick:t}=e,{contextType:o}=(0,m().q8)(),h="button_block"===o||"button_property"===o,f=h?y.automationRequiresSubscriptionButton:y.automationRequiresSubscription,v=(0,n().IS)((()=>({wrap:{fontSize:14,background:d().Tj.background.secondary,border:`1px solid ${d().Tj.background.secondary}`,borderRadius:6,padding:12,marginBottom:12},button:{fontWeight:u().Wy.medium,borderRadius:6,border:`1px solid ${d().Tj.border.primary}`,alignSelf:"flex-start"},titleContainer:{display:"flex"},title:{color:d().Tj.text.primary,fontWeight:u().Wy.medium,margin:0},textContainer:{display:"flex"},text:{color:d().Tj.text.secondary,margin:0},upgradeIcon:{marginInlineStart:0,marginInlineEnd:2,marginTop:2,marginBottom:2,color:d().Tj.blue.text.accentPrimary}})),[]);return(0,g.jsxs)(i().Y1,{direction:"vertical",gap:4,style:v.wrap,children:[h?(0,g.jsxs)("span",{style:v.titleContainer,children:[(0,g.jsx)(r().I,{icon:l().arrowInCircleUpFillIcon,size:18,style:v.upgradeIcon}),(0,g.jsx)("p",{style:v.title,children:(0,g.jsx)(c().sA,{...y.automationRequiresSubscriptionTitle})})]}):void 0,(0,g.jsxs)("span",{style:v.textContainer,children:[h?void 0:(0,g.jsx)(r().I,{icon:l().arrowInCircleUpFillIcon,size:18,style:v.upgradeIcon}),(0,g.jsx)("p",{style:v.text,children:(0,g.jsx)(c().sA,{...f,values:{learnmore:e=>(0,g.jsx)(a().V,{href:(0,p().x)("pricing"),external:!0,onClick:e=>e.stopPropagation(),children:e})}})})]}),(0,g.jsx)(s().p,{onClick:t,style:v.button,children:(0,g.jsx)(c().sA,{...y.automationRequiresSubscriptionUpgradeButton})})]})}},828973:(e,t,o)=>{o.d(t,{A:()=>f});o(898992),o(672577),o(581454);var n=o(296540),i=()=>o(726637),r=()=>o(383036),a=()=>o(590526),s=()=>o(401497),l=()=>o(127833),c=()=>o(546926),d=()=>o(81068),u=()=>o(663639),p=()=>o(736847),m=()=>o(100622),g=()=>o(496603),y=()=>o(284371),h=o(474848);const f=function({icon:e,iconStyle:t,title:f,selectedKey:v,onChange:x,onClick:S,popupStyle:b,menuItemOptionsStyle:A,menuStyle:C,disabled:k,collectionContextStore:j,openButtonPopup:I,hideCheck:M,children:T,disableParentClose:w,inputPlaceholder:P,renderSelectedKey:_,variant:B,...R}){const V="options"in R?R.options:g().Bq(R.sections),E=V.find((e=>g().n4(e.key,v))),F=(0,a().uB)(void 0,o(118307).A),D=(0,a().O$)(F).open;(0,n.useEffect)((()=>{j&&I&&(F.setState({...F.state,open:I}),j.settingsStore.setState({...j.settingsStore.state,openButtonPopup:void 0})),E||o(165358).log({level:"error",from:"CollectionSettingsPickListMenuItem",type:"InvalidSelectedItem",error:(0,o(229833).convertErrorToLog)("Selected key is invalid.")})}));const L=(0,s().eP)(),O=(0,s().IS)((()=>({fullWidthButton:{backgroundColor:m().Tj.background.secondary,border:`1px solid ${m().Tj.gray.border.secondaryTranslucent}`,alignItems:"center",color:m().Tj.text.primary,fontWeight:y().Wy.regular},fullWidthButtonHover:{backgroundColor:(0,o(606712).R)({color:m().Tj.background.secondary,mode:L})},popupWrapper:{margin:"12px 16px"},heading:{fontSize:o(115512).Kw,fontWeight:y().Wy.medium,color:m().Tj.text.secondary,marginBottom:12}})),[L]),K=(0,h.jsx)(o(250910).A,{popupType:i().A.isMobile?l().nl.BottomSheet:l().nl.Popup,alignmentToOrigin:"end",placementToOrigin:"bottom",style:b,originGap:0,buttonPopupStore:F,disabled:k,onClick:S,renderOrigin:n=>{const i=function(e){const{renderSelectedKey:t,selectedKey:o,selectedOption:n}=e;return t?t(o):"input"===(null==n?void 0:n.type)?n.inputValue:"button"===(null==n?void 0:n.type)?n.title:void 0}({renderSelectedKey:_,selectedKey:v,selectedOption:E});return"fullWidth"===B?(0,h.jsx)(d().A,{icon:null==e?void 0:e({}),focused:!1,disabled:k,title:i,buttonStyle:{width:"100%",justifyContent:"space-between",...O.fullWidthButton},hoveredStyle:O.fullWidthButtonHover,right:k?void 0:(0,h.jsx)(o(807449).I,{icon:o(324254).arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"}),...(0,r().A)(n,R)}):(0,h.jsx)(o(497222).A,{title:f,showChevron:!0,right:i,rotateChevron:D,disabled:k,icon:e,iconStyle:t,...(0,r().A)(n,R)})},render:e=>{let t;t=i().A.isMobile?{menuType:c().gu.ActionSheet}:{menuType:c().gu.Popup,width:250,...C};const n=(t,n)=>{if(t.hideOption)return null;let i;return i="input"===t.type?{key:n,render:n=>(0,h.jsx)(o(419357).Ay,{...n,style:{width:"100%",paddingTop:4,paddingBottom:4},value:t.inputValue??"",onChange:e=>{var o;null===(o=t.onChange)||void 0===o||o.call(t,e.target.value)},onSubmit:o=>{var n;null===(n=t.onSubmit)||void 0===n||n.call(t,t.key,e,t.inputValue),e.close()},placeholder:P,isChecked:!M&&g().n4(t.key,v)}),action:()=>{}}:{key:n,render:e=>(0,h.jsx)(d().A,{...e,disabled:!1,title:t.title,icon:t.icon,caption:t.caption,captionStyle:t.captionStyle,inline:t.captionInline,spacerStyle:t.inlineSpacerStyle,body:t.body,style:A,isChecked:!M&&g().n4(t.key,v)}),action:()=>{x(t.key,e),w||e.close()}},i},r="sections"in R?R.sections.map(((e,t)=>({key:t,render:e=>(0,h.jsx)(p().A,{enableActionSheetTitle:!0,topBorder:t>0,...e}),items:g().oE(e.map(n))}))):[{key:0,render:e=>(0,h.jsx)(p().A,{enableActionSheetTitle:!0,...e}),items:g().oE(V.map(n))}];return(0,h.jsxs)(o(890492).A,{...t,children:[(0,h.jsx)(u().A,{type:u().O.Vertical,sections:r,initialFocus:0,resetFocusOnMouseOut:!0}),T||null]})}});return"fullWidth"===B?(0,h.jsxs)("div",{style:O.popupWrapper,children:[(0,h.jsx)("div",{style:O.heading,children:f}),K]}):K}},839754:(e,t,o)=>{o.d(t,{Bi:()=>j,My:()=>k,ZM:()=>M,_M:()=>I,navigateToWorkflowTemplateOnboardingModal:()=>T});o(16280),o(944114),o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(898992),o(354520),o(672577),o(581454);var n=()=>o(907258),i=()=>o(295633),r=()=>o(584262),a=()=>o(663077),s=()=>o(179034),l=()=>o(201980),c=()=>o(896628),d=()=>o(384944),u=()=>o(730969),p=()=>o(840153),m=()=>o(339798),g=()=>o(180762),y=()=>o(799832),h=()=>o(111379),f=()=>o(535960),v=()=>o(31173),x=()=>o(295304),S=()=>o(244828),b=()=>o(373444),A=()=>o(165592),C=()=>o(204067);function k({transaction:e,collectionStore:t,propertyTemplates:o}){var n;const i=(null===(n=t.getParentBlockStore())||void 0===n?void 0:n.getCollectionViewStores().filter((e=>"table"===e.getType())))??[];if(0===i.length)return;const r=[];for(const l of o){const e=(0,C().S1)({collectionStore:t,templateId:l.templateId,instancePointerType:"property"});e&&r.push({property:e.id,visible:!(0,a().Sz)(l),...l.tablePropertyFormat})}if(0!==r.length)for(const a of i){var s;const t=(null===(s=a.getPropertyFormatsStore("table_properties"))||void 0===s?void 0:s.getValue())??[],o=new Set(t.map((e=>e.property))),n=r.filter((e=>!o.has(e.property)));0!==n.length&&c().zA({stores:[a],update:{table_properties:[...t,...n]},transaction:e})}}function j({transaction:e,collectionStore:t,propertyTemplates:o}){const n=[];for(const s of o){const e=(0,C().S1)({collectionStore:t,templateId:s.templateId,instancePointerType:"property"});e&&n.push({property:e.id,visible:!0})}const i=t.getFormat().collection_page_properties??[],r=new Set(i.map((e=>e.property))),a=n.filter((e=>!r.has(e.property)));a.length&&c().zA({stores:[t],update:{collection_page_properties:[...i,...a]},transaction:e})}function I({environment:e,newPageStore:t,result:o}){"accepted_template"!==o.type&&"accepted_empty_collection"!==o.type||S().createAndCommit({environment:e,canUndo:!1,perform:n=>{const r=t.getTitleValue();if(d().zv({store:t,transaction:n,data:{alive:!1}}),"accepted_empty_collection"===o.type&&!(0,l().w9s)(r)){const a=i().B.createChildStore(t,{table:"block",id:o.blockId}).getTitleStore();a&&x().yr({environment:e,transaction:n,tokens:r,index:0,store:a})}const a=t.getParentStore();if((null==a?void 0:a.table)===s().ev){const e=a.getContentIds();d().zv({store:a,transaction:n,data:{content:e.filter((e=>e!==t.id))}})}},userAction:"clean_up_empty_new_page"})}function M({environment:e,userAction:t,result:o,existingCollectionViewBlockStore:n,existingCollectionStore:i}){if("canceled"!==o.type){if("accepted_empty_collection"===o.type&&i){const n=i.getKeyStore("name"),r=(0,l().x9d)(o.newCollectionTitle);n&&S().createAndCommit({userAction:t,environment:e,canUndo:!0,perform:t=>x().R9({environment:e,store:n,transaction:t,value:r})})}if(n){var r;const e=null===(r=(0,y().U)(n))||void 0===r?void 0:r.settingsStore;e&&m().os({collectionSettingsStore:e})}if("accepted_template"===o.type&&null!=n&&n.isCollectionView()&&(null==n||!n.hasSingleSourceAndNoLinkedCollections())){const t=(0,y().U)(n),i=n.getCollectionViewStores().find((e=>{var t;return(null===(t=e.getCollectionStore())||void 0===t?void 0:t.id)===o.collectionId}));if(!t||!i)return;(0,g().t)({environment:e,collectionContextStore:t,collectionViewId:i.id,isFullScreen:t.isFullScreenStore.state,isRootChild:t.isRootChildStore.state,isInPeekRenderer:t.isInPeekRendererStore.state})}}}async function T({environment:e,collectionViewBlockStore:t}){const o=t.id;if(!t.isDefined()){const n=await(0,v().$)({environment:e,blockId:o});if(!n)return;e=await p().T({environment:e,newCurrentUserId:n}),t=new(i().B)(e,{table:s().ev,id:o}),await t.load()}const a=t.getSpaceId();if(!a)throw new Error("Space ID not found for collection block");const l=(0,h().k)(a);if(!l)throw new Error(`Space view not found for space ID: ${a}`);const{sidebarSpaceStore:c}=n().default.state;(null==c?void 0:c.id)!==a&&await(0,u().y)({environment:e,spaceViewStore:l});const d=t.getFormat();if("workflow_template_placeholder"===(null==d?void 0:d.collection_view_sub_type)&&null!=d&&d.placeholder_workflow_template_id&&t.isCollectionView()){const{getCollectionTemplateFromId:o}=await A().t.load(),n=o(d.placeholder_workflow_template_id);if(!n)throw new Error(`Collection template "${d.placeholder_workflow_template_id}" not found`);const{onNavigateToPlaceholderWorkflowTemplateBlock:i}=await b().O.load();i({environment:e,collectionTemplate:n,collectionViewBlockStore:t})}else(0,f().u)({environment:e,store:t,pageVisitSource:r().y8.WorkflowTemplatesDeeplink})}},858163:(e,t,o)=>{o.d(t,{W:()=>s});var n=o(296540),i=()=>o(973647),r=()=>o(546461),a=()=>o(37824);function s(e){const t=(0,r().K4)();return{onTextStoreSelect:(0,n.useMemo)((()=>{if(t&&i().Q.isSuccess(t.typecheckResult)){const{automationStore:o,contextType:n,typecheckResult:i}=t;return function(){a().A.focus({automationStore:o,contextType:n,typecheckResult:i.value,automationActionStore:e})}}}),[e,t]),onTextStoreUnselect:(0,n.useMemo)((()=>{if(t&&i().Q.isSuccess(t.typecheckResult)){const{automationStore:o,contextType:n,typecheckResult:i}=t;return function(){a().A.blur({automationStore:o,contextType:n,typecheckResult:i.value,automationActionStore:e})}}}),[e,t])}}},864040:(e,t,o)=>{o.d(t,{A:()=>s});o(581454),o(296540);var n=()=>o(584262),i=()=>o(211716),r=()=>o(535960),a=o(474848);const s=function(e,t,s){return[{key:"results",render:e=>(0,a.jsx)(o(736847).A,{...e}),items:t.map(((t,l)=>({key:t.id,render:e=>(0,a.jsx)(o(305390).A,{...e,isSubpage:0!==l,store:t,hidePath:!0}),action:({event:a})=>{const l=(0,o(381175).V)(a);if(t instanceof o(295633).B)s&&s({pageId:t.id,collectionId:void 0}),(0,r().u)({environment:e,store:t,openInNew:l,visitType:i().ig.Link,pageVisitSource:n().y8.Breadcrumb});else if(t instanceof o(732810).m){const a=t.getParentCollectionViewBlockStore();if(!a)return;s&&s({pageId:a.id,collectionId:t.id});const c=(0,o(297175).V5)(a,t);(0,r().u)({environment:e,store:a,collectionViewId:null==c?void 0:c.id,openInNew:l,visitType:i().ig.Link,pageVisitSource:n().y8.Breadcrumb})}else if(t instanceof o(350013).N){const n=(0,o(496703).L)({workflowId:t.id,params:{workflowViewType:"chat"}});(0,o(246766).navigate)({environment:e,url:n,openInNew:l})}}})))}]}},866515:(e,t,o)=>{o.d(t,{n:()=>i});var n=o(296540);function i(e,t,o){const i=(0,n.useRef)(e),r=(0,n.useRef)(null);(0,n.useEffect)((()=>{i.current=e}),[e]),(0,n.useEffect)((()=>{const e=async()=>{r.current&&(clearTimeout(r.current),r.current=null),o&&(await i.current(),r.current=setTimeout(e,t))};return o&&e(),()=>{r.current&&(clearTimeout(r.current),r.current=null)}}),[o,t])}},911724:(e,t,o)=>{o.d(t,{A:()=>u,v:()=>d});o(898992),o(354520);var n=o(296540),i=()=>o(564884),r=()=>o(484714),a=()=>o(590526),s=()=>o(546461),l=o(474848);const c=(0,n.createContext)({collectionStore:void 0,currentDraggingActionId:void 0,disabled:!0,maybePersistedTransactionActions:{createAndCommit:o(633904).l},editorPlacement:{type:"inline"},editorWidth:300,suppressActionErrors:[],collapsedActionIds:[],hideDragHandle:!1,cantSaveDueToError:!1,toggleActionIdCollapsed:()=>{}});function d(e){const t=(0,r().v3)(),{automationStore:o}=(0,s().q8)(),d=(0,a().K8)((()=>o.getActionIds()),[o]),[u,p]=(0,n.useReducer)(((e,n)=>{const r=e.includes(n);return(0,i().u)({environment:t,event:{eventName:"automation_action_collapse_toggle",eventProperties:{collapsed:!r,automation_action_id:n,automation_id:o.id}}}),r?e.filter((e=>e!==n)):[...e,n]}),e.defaultCollapseActions?d:[]);return(0,l.jsx)(c.Provider,{value:{...e.value,collapsedActionIds:u,toggleActionIdCollapsed:p},children:e.children})}c.displayName="AutomationEditorContext";const u=c},922952:(e,t,o)=>{o.d(t,{u:()=>a});var n=()=>o(295633),i=()=>o(302996),r=()=>o(723085);function a(e){return e instanceof r().h||e instanceof i().SpaceStore||e instanceof n().B}},935432:(e,t,o)=>{o.d(t,{A:()=>a});var n=()=>o(416845),i=()=>o(357264),r=()=>o(788579);function a(e,t){if((0,n().pA8)(t)){const o=(0,r().$)(t.clientData);if(o)return"messageValues"in t.clientData?e.formatMessage(o,t.clientData.messageValues):e.formatMessage(o)}return e.formatMessage(i().k.generic_error)}},938818:(e,t,o)=>{o.d(t,{J:()=>c,L:()=>d});o(18107),o(967357);var n=o(296540),i=()=>o(493552),r=()=>o(563015),a=()=>o(69708),s=()=>o(534177),l=o(474848);function c(e){const{analyzedFormulaOutput:t}=e,{parseErrors:o,typeErrors:r,typeWarnings:c}=t,u=(0,a().tz)(),p=(0,n.useMemo)((()=>d({intl:u,parseErrors:o??[],typeErrors:r??[],typeWarnings:c??[]})),[u,o,r,c]);if(!(0,s().O9)(p))return null;const m=p.isWarning;return(0,l.jsx)(i().D,{colorPalette:m?"yellow":"red",colorVariant:m?"secondary":"accentPrimary",styleKey:"captionRegular",children:(0,l.jsx)(a().sA,{...p.messageDescriptor})})}function d({intl:e,parseErrors:t,typeErrors:o,typeWarnings:n}){const i=null==t?void 0:t.at(0);if((0,s().O9)(i))return{messageDescriptor:(0,r().ml)(i),isWarning:!1};const a=null==o?void 0:o.at(0);if((0,s().O9)(a))return{messageDescriptor:(0,r().rA)(e,a),isWarning:!1};const l=null==n?void 0:n.at(0);return(0,s().O9)(l)?{messageDescriptor:(0,r().rA)(e,l),isWarning:!0}:void 0}},942715:(e,t,o)=>{o.d(t,{A:()=>y});o(581454);var n=o(296540),i=()=>o(726637),r=()=>o(590526),a=()=>o(250910),s=()=>o(546926),l=()=>o(114912),c=()=>o(890492),d=()=>o(663639);class u extends(()=>o(757695))().Store{getInitialState(){return{}}}const p=u;var m=o(474848);function g({isMenuItem:e,style:t,labelStyle:i,alignmentToOrigin:a,renderMenuSections:s,label:l,selectedTitle:c,focused:d,disabled:u,innerButtonStyle:g,buttonPopupStore:y},v){const x=(0,r().uB)(void 0,p),S=(0,r().uB)(y,o(118307).A),b=(0,o(401497).IS)((()=>({wrapper:{alignItems:"center",display:"flex",height:32,...t},label:{color:o(100622).Tj.text.tertiary,fontSize:14,marginInlineEnd:"auto",...i}})),[i,t]);return(0,n.useImperativeHandle)(v,(()=>({closeMenu:()=>{S.setState({...S.state,open:!1})}})),[S]),e?(0,m.jsx)(f,{alignmentToOrigin:a,isMenuItem:e,renderMenuSections:s,buttonPopupStore:S,selectButtonStore:x,renderOrigin:o=>(0,m.jsx)(h,{events:o,style:t,isMenuItem:e,label:l,selectedTitle:c,focused:d,disabled:u})}):(0,m.jsxs)("div",{style:b.wrapper,children:[l?(0,m.jsx)("div",{style:b.label,children:l}):void 0,(0,m.jsx)(f,{alignmentToOrigin:a,isMenuItem:e,renderMenuSections:s,buttonPopupStore:S,selectButtonStore:x,renderOrigin:e=>(0,m.jsx)(o(631524).p,{disabled:u,disabledFeedback:!0,style:{marginInlineEnd:-6,...g},iconTrailing:{icon:o(324254).arrowChevronSingleDownSmallIcon,size:"xs",colorVariant:u?"disabled":"secondary"},...e,children:c})})]})}const y=n.forwardRef(g);function h({events:e,style:t,isMenuItem:o,label:n,selectedTitle:i,focused:r,disabled:a}){if(o){const o=n?{title:n,right:i}:{title:i};return(0,m.jsx)(l()._,{...e,focused:Boolean(r),disabled:a,style:t,...o})}return null}function f({renderOrigin:e,alignmentToOrigin:t,isMenuItem:o,renderMenuSections:n,buttonPopupStore:l,selectButtonStore:u}){const p=(0,r().K8)((()=>u.state.selectedKey),[u]);return(0,m.jsx)(a().A,{popupType:i().A.isMobile?a().z.SlideUp:a().z.Popup,buttonPopupStore:l,alignmentToOrigin:void 0!==t?t:"end",renderOrigin:e,placementToOrigin:o?"right":"bottom",originGap:o?void 0:4,render:e=>{const{focusedIndex:t,menuSections:o}=function(e){const{parent:t,renderMenuSections:o,selectButtonStore:n,selectedKey:i}=e;let r,a=0;const s=o(t).map((e=>({...e,items:e.items.map((e=>(i&&e.key===i&&(r=a),a++,{...e,action:t=>{e.action(t),function(e,t){t.setState({selectedKey:e})}(e.key,n)}})))})));return{menuSections:s,focusedIndex:r}}({parent:e,renderMenuSections:n,selectButtonStore:u,selectedKey:p});return(0,m.jsx)(c().A,{menuType:i().A.isMobile?s().gu.ActionSheet:s().gu.Popup,children:(0,m.jsx)(d().A,{type:d().O.Vertical,initialFocus:t,sections:o})})}})}},951105:(e,t,o)=>{o.d(t,{k:()=>i});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"2.18 1.73 11.64 12.54",svg:(0,o(474848).jsx)("path",{d:"M7.435 1.735c-.875 0-1.585.71-1.585 1.585v.735H3.765c-.875 0-1.585.71-1.585 1.585v7.04c0 .875.71 1.585 1.585 1.585h4.8c.876 0 1.585-.71 1.585-1.585v-.735h2.085c.876 0 1.585-.71 1.585-1.585V5.638c0-.42-.167-.824-.464-1.121l-2.318-2.318a1.6 1.6 0 0 0-1.12-.464zM7.1 3.32c0-.185.15-.335.335-.335H9.58V4.44c0 .848.687 1.535 1.535 1.535h1.455v4.385c0 .185-.15.335-.335.335H10.15V7.958c0-.42-.167-.824-.464-1.121L7.368 4.519a1.6 1.6 0 0 0-.268-.215zm3.63 1.12v-.781l1.166 1.166h-.78a.385.385 0 0 1-.386-.385m-7.3 1.2c0-.185.15-.335.335-.335H5.91V6.76c0 .848.687 1.535 1.535 1.535H8.9v4.385c0 .185-.15.335-.335.335h-4.8a.335.335 0 0 1-.335-.335zm3.63 1.12v-.781l1.166 1.166h-.78a.385.385 0 0 1-.386-.385"})},i=(0,o(340498).wt)("docOnDocSmall",n,"small")},971404:(e,t,o)=>{o.d(t,{V:()=>r,X:()=>a});var n=()=>o(597777);const i={"de-DE":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"da-DK":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"fi-FI":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"nb-NO":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"nl-NL":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"sv-SE":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"en-US":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"es-ES":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"es-LA":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"fr-FR":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"pt-BR":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"ko-KR":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"YYYY[] MMMM"},"zh-CN":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"YYYY[]MMM"},"zh-TW":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"YYYY[]MMM"},"ja-JP":{time:{"12h":"A h:mm","24h":"H:mm",hidden:n().jk},month:"YYYY[]MMM"},"vi-VN":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"th-TH":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"id-ID":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"en-GB":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"he-IL":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},"ar-SA":{time:{"12h":"LT","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"},pseudo:{time:{"12h":"A h:mm","24h":"H:mm",hidden:n().jk},month:"MMMM YYYY"}},r=["de-DE","fr-FR","he-IL"];function a(e){return i[e]}},977529:(e,t,o)=>{o.d(t,{DI:()=>l,Yv:()=>s,lq:()=>r});const n=2*o(615234).TD,i=new Map;function r(e){return i.get(e)}function a(){return i.values().next().value}function s(){const e=Array.from(i.values());for(const t of e)t.clear()}class l{constructor(e){this.id=void 0,this.sourceBlocks=void 0,this.currentTimeout=null,this.stage=void 0,this.showInitialMessage=void 0,this.onClear=void 0,this.id=(0,o(498212).Ay)(),this.sourceBlocks=e.sourceBlocks,this.stage="started",this.showInitialMessage=e.showInitialMessage,this.onClear=e.onClear,i.set(this.id,this)}isOldestActive(){return a()===this}start(){this.currentTimeout=setTimeout((()=>{this.stage="initial_message",this.isOldestActive()&&this.showInitialMessage(this.sourceBlocks)}),n)}showSnackbarForCurrentStage(){"started"===this.stage||("initial_message"===this.stage?this.showInitialMessage(this.sourceBlocks):(0,o(534177).HB)(this.stage))}clear(){this.currentTimeout&&(clearTimeout(this.currentTimeout),this.currentTimeout=null),i.delete(this.id),this.onClear(),function(){const e=a();e&&e.showSnackbarForCurrentStage()}()}complete(){this.isOldestActive()&&this.stage,this.clear()}}},984007:(e,t,o)=>{o.d(t,{Ay:()=>l,Gi:()=>r,Wc:()=>n,pF:()=>a,vS:()=>i});const n="loadingLocalImage",i="uploading",r="downloading",a="loaded";class s extends(()=>o(757695))().Store{getInitialState(){return{loadingMode:a}}}const l=s}}]);