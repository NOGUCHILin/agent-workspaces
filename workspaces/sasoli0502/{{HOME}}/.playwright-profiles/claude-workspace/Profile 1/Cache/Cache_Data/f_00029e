"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[49418,92926],{5580:(e,t,n)=>{n.d(t,{n:()=>i});var a=()=>n(907258),r=()=>n(590526),o=()=>n(209199);function i(){return(0,r().K8)((()=>{var e;const t=(null===(e=a().default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)??o().q;return(0,o().o_)(t)}),[])}},8274:(e,t,n)=>{n.d(t,{a:()=>_});var a=n(296540),r=()=>n(920198),o=()=>n(907258),i=()=>n(726637),s=()=>n(312788),l=()=>n(484714),d=()=>n(590526),c=()=>n(401497),u=()=>n(463086),g=()=>n(350013),p=()=>n(807449),h=()=>n(631524),m=()=>n(493552),f=()=>n(687249),v=()=>n(68169),y=()=>n(799288),b=()=>n(626466),x=()=>n(481975),S=()=>n(234459),w=()=>n(743246),C=()=>n(69708),M=()=>n(100622),I=()=>n(36951),k=()=>n(318670),j=()=>n(741862),T=n(474848);const A=(0,C().YK)({untitledThread:{id:"agentCallerThreadHeader.untitledThread",defaultMessage:"Untitled chat"},instructionsFrom:{id:"agentCallerThreadHeader.instructionsFrom",defaultMessage:"Instructions from {agentName}"},personalAgentName:{id:"agentCallerThreadHeader.personalAgentName",defaultMessage:"Personal Agent"},agentFallbackName:{id:"agentCallerThreadHeader.agentFallbackName",defaultMessage:"Agent"}});function _(e){const{threadStore:t,callerMessageStep:n}=e,_=(0,l().v3)(),B=(0,C().tz)(),P=(0,r().L)(),{navigate:D}=(0,a.useContext)(s().E),R=(0,a.useMemo)((()=>{if(n.parentThreadUrl)try{const e=(0,f().Mg)(n.parentThreadUrl,{baseUrl:i().A.domainBaseUrl,publicDomainName:i().A.publicDomainName});if("thread"!==e.type)return;return e.threadId}catch{return}}),[n.parentThreadUrl]),E=(0,a.useMemo)((()=>{if(P&&R)return u().E.createChildStore(P,{table:S().To,id:R,spaceId:P.id})}),[R,P]);(0,a.useEffect)((()=>{E&&!E.isReady()&&E.load()}),[E]);const F=(0,d().K8)((()=>{var e;return null==E||null===(e=E.getData())||void 0===e?void 0:e.title}),[E]),W=(0,d().K8)((()=>{const{sidebarSpaceStore:e}=o().default.state;if(e&&n.parentAgentId&&!(0,y().ut)(n.parentAgentId))return g().N.createChildStore(e,{table:w().C0,id:n.parentAgentId,spaceId:e.id})}),[n.parentAgentId]),L=(0,d().K8)((()=>n.parentAgentId===v().Lj?B.formatMessage(A.personalAgentName):(null==W?void 0:W.getName())??B.formatMessage(A.agentFallbackName)),[n.parentAgentId,B,W]),K=(0,k().gg)({threadStore:t,step:n}),N=(0,a.useCallback)((()=>{if(!E)return;const e=(0,j().C3)(_.RouterStore.state.route,E.id);e?D({environment:_,url:e,redirect:!1}):(0,I().VK)({environment:_,oldThreadStore:t,newThreadStore:E,isAgent:!0})}),[E,_,D,t]),[V,z]=(0,a.useState)(!1),H=(0,a.useCallback)((()=>{z((e=>!e))}),[]),O=(0,c().IS)((()=>({container:{display:"flex",flexDirection:"column",paddingTop:12,paddingInlineEnd:12,paddingBottom:12,paddingInlineStart:12,marginBottom:16},pill:{alignSelf:"flex-start",display:"flex",gap:6,alignItems:"center",paddingInline:10,paddingBlock:6,borderRadius:999,background:M().Tj.background.secondary},pillHover:{background:M().Tj.state.hover},pillPressed:{background:M().Tj.state.pressed},verticalDivider:{width:1,height:12,backgroundColor:M().Tj.border.secondary,marginInlineStart:14},title:{minWidth:0,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},messageHeader:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8,width:"100%",paddingInline:4,paddingBlock:4},messageCard:{padding:10,borderRadius:12,border:`1px solid ${M().Tj.border.secondary}`},messageChevron:{transition:"transform 150ms ease"},messageChevronExpanded:{transform:"rotate(180deg)"},instructionsContainer:{marginTop:8,paddingInlineEnd:12,paddingInlineStart:12,borderRadius:10,overflow:"hidden",transition:"max-height 150ms ease"}})),[]);return R&&E?(0,T.jsxs)("div",{style:O.container,children:[(0,T.jsxs)(h().p,{style:O.pill,hoveredStyle:O.pillHover,pressedStyle:O.pillPressed,onClick:N,children:[(0,T.jsx)(p().I,{icon:x().s,colorVariant:"secondary"}),(0,T.jsx)(m().D,{styleKey:"bodyRegular",style:O.title,children:(null==F?void 0:F.trim())||B.formatMessage(A.untitledThread)})]}),(0,T.jsx)("div",{style:O.verticalDivider}),(0,T.jsxs)("div",{style:O.messageCard,children:[(0,T.jsxs)(h().p,{style:O.messageHeader,onClick:H,"aria-expanded":V,children:[(0,T.jsx)(m().D,{styleKey:"captionMedium",colorVariant:"secondary",children:B.formatMessage(A.instructionsFrom,{agentName:L})}),(0,T.jsx)(p().I,{icon:b().arrowChevronSingleDownFillIcon,colorVariant:"secondary",style:{...O.messageChevron,...V?O.messageChevronExpanded:void 0}})]}),(0,T.jsx)("div",{style:{...O.instructionsContainer,maxHeight:V?1e3:0},children:(0,T.jsx)(m().D,{styleKey:"bodyRegular",children:K})})]})]}):null}},14205:(e,t,n)=>{n.r(t),n.d(t,{AgentChatActions:()=>He});var a=n(296540),r=()=>n(59226),o=()=>n(312788),i=()=>n(484714),s=()=>n(590526),l=()=>n(401497),d=()=>n(695115),c=()=>n(26697),u=()=>n(649844),g=()=>n(105870),p=()=>n(859384),h=()=>n(617668),m=()=>n(508700),f=()=>n(868840),v=()=>n(530199),y=()=>n(496703),b=()=>n(69708),x=()=>n(100622),S=()=>n(498212),w=()=>n(939768),C=()=>n(35392),M=()=>n(38554),I=()=>n(712505),k=()=>n(157188),j=()=>n(546926),T=()=>n(890492),A=()=>n(663639),_=()=>n(24126),B=()=>n(496603),P=()=>n(463916),D=(n(16280),n(944114),n(898992),n(354520),n(672577),n(803949),n(581454),n(737550),()=>n(920198)),R=()=>n(366326),E=()=>n(248140),F=()=>n(350013),W=()=>n(81068),L=()=>n(736847),K=()=>n(81986),N=()=>n(743246),V=()=>n(574036),z=()=>n(760342);function H(e){var t,n;if(e)return(0,z().kw)({publishedModules:null===(t=e.getPublishedArtifactStore())||void 0===t||null===(t=t.getData())||void 0===t?void 0:t.modules,draftModules:null===(n=e.getDraftData())||void 0===n?void 0:n.modules})}var O=()=>n(160992),q=()=>n(907258),U=()=>n(112968),G=()=>n(244828),Y=()=>n(140992);async function $(e){const{environment:t,clientStore:n,threadStore:a,moduleId:r,toolName:o,parameters:i}=e;if(null==a||!a.isDefined())throw new Error("Thread must exist to invoke MCP operations");if(a.getCurrentInferenceId()){const{serverCommitResult:e}=G().createAndCommit({userAction:"mcpInspectorActions.invokeFromInspector",environment:t,canUndo:!1,perform:e=>{Y().GS({threadStore:a,transaction:e,clientStore:n})}});await e}await Y().WE({environment:t,clientStore:n,threadStore:a,initialAgentActions:[{type:"injectToolCall",toolName:o,parameters:i,moduleId:r}]})}function X(e){const{clientStore:t,threadStore:n}=e,r=(0,i().v3)(),o=(0,s().O$)(q().AppStoreSidebarSpaceStore),l=(0,a.useCallback)((async e=>{if(!t||!n)throw new Error("ClientStore and ThreadStore required");if(!o)throw new Error("No space store");await async function(e){return $({...e,toolName:e.toolName,parameters:e.parameters,moduleId:e.moduleId})}({environment:r,clientStore:t,threadStore:n,spaceId:o.id,moduleId:e.moduleId,toolName:e.toolName,parameters:e.parameters})}),[t,n,r,o]),d=(0,a.useCallback)((async e=>{if(!t||!n)throw new Error("ClientStore and ThreadStore required");if(!o)throw new Error("No space store");await async function(e){const t=(0,U().BH)(e.serverUrl),n=(0,U().CG)(t,"read-resource");return $({...e,toolName:n,parameters:{uri:e.resourceUri},moduleId:e.moduleId})}({environment:r,clientStore:t,threadStore:n,spaceId:o.id,moduleId:e.moduleId,serverUrl:e.serverUrl,resourceUri:e.resourceUri})}),[t,n,r,o]);return{handleInvokeTool:l,handleInvokeResource:d}}n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);var Z=()=>n(394888),J=()=>n(699143),Q=()=>n(718827),ee=()=>n(970236),te=()=>n(98126),ne=()=>n(406094),ae=()=>n(160432),re=()=>n(493552),oe=()=>n(395797),ie=()=>n(571376),se=()=>n(821979),le=n(474848);const de=(0,b().YK)({statusConnected:{id:"mcpInspectorModal.statusConnected",defaultMessage:"Connected"},statusNeedsReauth:{id:"mcpInspectorModal.statusNeedsReauth",defaultMessage:"Needs re-auth"},statusNeedsAuth:{id:"mcpInspectorModal.statusNeedsAuth",defaultMessage:"Needs auth"},statusDisabled:{id:"mcpInspectorModal.statusDisabled",defaultMessage:"Disabled"}});function ce(e){const{module:t,isEnabled:n}=e,a=(0,se().y)(t),r=(0,b().tz)(),o=function(e){const{statusColor:t,isEnabled:n}=e;return(0,l().IS)((()=>{let e;return e=n?"green"===t?x().Tj.green.background.accentPrimary:"yellow"===t?x().Tj.yellow.background.accentPrimary:x().Tj.gray.background.tertiary:x().Tj.gray.background.tertiary,{dot:{width:8,height:8,borderRadius:"50%",flexShrink:0,backgroundColor:e}}}),[t,n])}({statusColor:a.color,isEnabled:n});let i;return i=n?"connected"===a.status?de.statusConnected:"needs_reauth"===a.status?de.statusNeedsReauth:de.statusNeedsAuth:de.statusDisabled,(0,le.jsx)(c().m,{placement:"top",renderTooltip:()=>r.formatMessage(i),render:e=>(0,le.jsx)("div",{style:o.dot,...e})})}const ue=(0,b().YK)({title:{id:"mcpInspectorModal.title",defaultMessage:"MCP Inspector"},toolsTab:{id:"mcpInspectorModal.toolsTab",defaultMessage:"Tools"},resourcesTab:{id:"mcpInspectorModal.resourcesTab",defaultMessage:"Resources"},noTools:{id:"mcpInspectorModal.noTools",defaultMessage:"No tools available"},noResources:{id:"mcpInspectorModal.noResources",defaultMessage:"No resources available"},parameters:{id:"mcpInspectorModal.parameters",defaultMessage:"Parameters"},invoke:{id:"mcpInspectorModal.invoke",defaultMessage:"Invoke"},close:{id:"mcpInspectorModal.close",defaultMessage:"Close"}});function ge(e){const{isOpen:t,onClose:n,modules:r,threadStore:o,onInvokeTool:i,onInvokeResource:d}=e,[c,u]=(0,a.useState)("tools"),[g,p]=(0,a.useState)(0),[h,m]=(0,a.useState)(0),[f,v]=(0,a.useState)("{}"),[y,S]=(0,a.useState)(!1),[w,C]=(0,a.useState)(),M=(0,l().IS)((()=>({container:{width:960,maxWidth:"90vw",maxHeight:"90vh",display:"flex",flexDirection:"column"},header:{padding:24,borderBottom:`1px solid ${x().Tj.border.secondary}`},tabRow:{display:"flex",gap:8,paddingInline:24,paddingTop:16,borderBottom:`1px solid ${x().Tj.border.secondary}`},tab:{paddingBlock:8,paddingInline:12,borderBottom:"2px solid transparent",cursor:"pointer"},activeTab:{borderBottomColor:x().Tj.blue.icon.accentPrimary},body:{flex:1,display:"flex",minHeight:0,overflow:"hidden"},sidebar:{width:240,borderInlineEnd:`1px solid ${x().Tj.border.secondary}`,overflowY:"auto",padding:12},content:{flex:1,overflowY:"auto",padding:24,display:"flex",flexDirection:"column",gap:16},codeBlockWrapper:{maxHeight:300,overflowY:"auto"},toolItem:{padding:8,borderRadius:6,cursor:"pointer"},toolItemActive:{backgroundColor:x().Tj.background.secondaryTranslucent},footer:{padding:20,borderTop:`1px solid ${x().Tj.border.secondary}`,display:"flex",justifyContent:"space-between"},emptyState:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}})),[]),I=(0,s().K8)((()=>(null==o?void 0:o.getTranscript())??[]),[o]);(0,a.useEffect)((()=>{if(!y||!w||!o)return;I.some((e=>{if("agent-tool-result"===e.type){return(e.toolName===w||e.toolName===`mcp-${w.replace(/^mcp-/,"")}`)&&(0,oe().nP)(e)}return!1}))&&(S(!1),C(void 0),n())}),[I,y,w,o,n]);const k=(0,a.useCallback)((e=>{if(!e.inputSchema||"object"!=typeof e.inputSchema)return"{}";const t=e.inputSchema;if(!("properties"in t)||"object"!=typeof t.properties||!t.properties)return"{}";const n={},a="required"in t&&Array.isArray(t.required)?t.required:[];for(const[r,o]of Object.entries(t.properties))if(a.includes(r)&&o&&"object"==typeof o&&!Array.isArray(o)){const e=o,t="type"in e&&"string"==typeof e.type?e.type:void 0;let a="";"string"===t?a="":"number"===t?a="0":"boolean"===t&&(a="false"),n[r]=a}return JSON.stringify(n,null,2)}),[]),j=(0,s().K8)((()=>{const e=[];for(const n of r){var t;if("mcpServer"===n.type&&null!==(t=n.state)&&void 0!==t&&t.tools){const t=n.state.enabledToolNames,a=new Set(t);for(const r of n.state.tools)e.push({tool:r,moduleId:n.id,moduleName:n.name,moduleValue:n,isEnabled:void 0===t||a.has(r.name)})}}return e}),[r]),T=(0,s().K8)((()=>{const e=[];for(const n of r){var t;if("mcpServer"===n.type&&null!==(t=n.state)&&void 0!==t&&t.resources){const t=n.state.enabledResourceUris,a=new Set(t);for(const r of n.state.resources)e.push({resource:r,moduleId:n.id,moduleName:n.name,moduleValue:n,isEnabled:void 0===t||a.has(r.uri)})}}return e}),[r]),A=j[g],_=T[h];a.useEffect((()=>{A&&v(k(A.tool))}),[A,k]);const B=(0,a.useCallback)((async()=>{if(!y){S(!0);try{if("tools"===c&&A){var e;const t=JSON.parse(f),n=(0,U().BH)(null===(e=A.moduleValue.state)||void 0===e?void 0:e.serverUrl),a=(0,U().CG)(n,A.tool.name);C(a),await i({moduleId:A.moduleId,toolName:a,parameters:t})}else if("resources"===c&&_){var t,n;const e=(0,U().BH)(null===(t=_.moduleValue.state)||void 0===t?void 0:t.serverUrl),a=(0,U().CG)(e,"read-resource");C(a),await d({moduleId:_.moduleId,serverUrl:null===(n=_.moduleValue.state)||void 0===n?void 0:n.serverUrl,resourceUri:_.resource.uri})}}catch(a){throw S(!1),C(void 0),a}}}),[y,c,A,_,f,i,d]);return(0,le.jsx)(Z().s,{isOpen:t,onDismiss:n,areaConstraint:{width:{type:"fixed",length:960},height:{type:"unlimited"}},render:()=>(0,le.jsxs)("div",{style:M.container,children:[(0,le.jsx)("div",{style:M.header,children:(0,le.jsx)(re().D,{styleKey:"titleMedium",children:(0,le.jsx)(b().sA,{...ue.title})})}),(0,le.jsxs)("div",{style:M.tabRow,children:[(0,le.jsx)(Q().Ay,{style:{...M.tab,..."tools"===c?M.activeTab:{}},onClick:()=>u("tools"),children:(0,le.jsx)(re().D,{styleKey:"bodyMedium",children:(0,le.jsx)(b().sA,{...ue.toolsTab})})}),(0,le.jsx)(Q().Ay,{style:{...M.tab,..."resources"===c?M.activeTab:{}},onClick:()=>u("resources"),children:(0,le.jsx)(re().D,{styleKey:"bodyMedium",children:(0,le.jsx)(b().sA,{...ue.resourcesTab})})})]}),(0,le.jsxs)("div",{style:M.body,children:[(0,le.jsx)("div",{style:M.sidebar,children:"tools"===c?0===j.length?(0,le.jsx)("div",{style:M.emptyState,children:(0,le.jsx)(re().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,le.jsx)(b().sA,{...ue.noTools})})}):j.map(((e,t)=>(0,le.jsx)(Q().Ay,{style:{...M.toolItem,...t===g?M.toolItemActive:{},...e.isEnabled?{}:{opacity:.6}},onClick:()=>p(t),children:(0,le.jsxs)(J().Y1,{direction:"horizontal",gap:8,align:"center-left",children:[(0,le.jsx)(ce,{module:e.moduleValue,isEnabled:e.isEnabled}),(0,le.jsxs)(J().Y1,{direction:"vertical",gap:0,width:"fill",children:[(0,le.jsxs)(J().Y1,{direction:"horizontal",gap:4,align:"center-left",children:[(0,le.jsx)(re().D,{styleKey:"bodySmMedium",colorVariant:e.isEnabled?void 0:"tertiary",children:e.tool.title}),e.isEnabled?void 0:(0,le.jsx)(ee().E,{color:"gray",content:"Disabled"})]}),(0,le.jsx)(re().D,{styleKey:"captionRegular",colorVariant:"secondary",children:e.moduleName})]})]})},`${e.moduleId}-${e.tool.name}`))):0===T.length?(0,le.jsx)("div",{style:M.emptyState,children:(0,le.jsx)(re().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,le.jsx)(b().sA,{...ue.noResources})})}):T.map(((e,t)=>(0,le.jsx)(Q().Ay,{style:{...M.toolItem,...t===h?M.toolItemActive:{},...e.isEnabled?{}:{opacity:.6}},onClick:()=>m(t),children:(0,le.jsxs)(J().Y1,{direction:"horizontal",gap:8,align:"center-left",children:[(0,le.jsx)(ce,{module:e.moduleValue,isEnabled:e.isEnabled}),(0,le.jsxs)(J().Y1,{direction:"vertical",gap:0,width:"fill",children:[(0,le.jsxs)(J().Y1,{direction:"horizontal",gap:4,align:"center-left",children:[(0,le.jsx)(re().D,{styleKey:"bodySmMedium",colorVariant:e.isEnabled?void 0:"tertiary",children:e.resource.title||e.resource.name||e.resource.uri}),e.isEnabled?void 0:(0,le.jsx)(ee().E,{color:"gray",content:"Disabled"})]}),(0,le.jsx)(re().D,{styleKey:"captionRegular",colorVariant:"secondary",children:e.moduleName})]})]})},`${e.moduleId}-${e.resource.uri}`)))}),(0,le.jsx)("div",{style:M.content,children:"tools"===c?A?(0,le.jsxs)(le.Fragment,{children:[(0,le.jsxs)(J().Y1,{direction:"vertical",gap:8,children:[(0,le.jsxs)(J().Y1,{direction:"horizontal",gap:8,align:"center-left",children:[(0,le.jsx)(re().D,{styleKey:"titleMedium",children:A.tool.title}),A.isEnabled?void 0:(0,le.jsx)(ee().E,{color:"gray",content:"Disabled"})]}),A.tool.description?(0,le.jsx)(re().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:A.tool.description}):void 0,A.isEnabled?void 0:(0,le.jsx)(re().D,{styleKey:"captionRegular",colorVariant:"tertiary",children:"This tool is disabled. You can still invoke it for debugging, but it won't be available to the agent."})]}),A.tool.inputSchema?(0,le.jsxs)(J().Y1,{direction:"vertical",gap:8,children:[(0,le.jsx)(re().D,{styleKey:"bodySmMedium",children:"Input schema"}),(0,le.jsx)("div",{style:M.codeBlockWrapper,children:(0,le.jsx)(ie().X,{value:JSON.stringify(A.tool.inputSchema,null,2),disabled:!0,language:"json"})})]}):void 0,(0,le.jsxs)(J().Y1,{direction:"vertical",gap:8,children:[(0,le.jsx)(re().D,{styleKey:"bodySmMedium",children:(0,le.jsx)(b().sA,{...ue.parameters})}),(0,le.jsx)("div",{style:M.codeBlockWrapper,children:(0,le.jsx)(ie().X,{value:f,onChange:v,language:"json"})})]})]}):null:_?(0,le.jsxs)(J().Y1,{direction:"vertical",gap:8,children:[(0,le.jsxs)(J().Y1,{direction:"horizontal",gap:8,align:"center-left",children:[(0,le.jsx)(re().D,{styleKey:"titleMedium",children:_.resource.title||_.resource.name||_.resource.uri}),_.isEnabled?void 0:(0,le.jsx)(ee().E,{color:"gray",content:"Disabled"})]}),_.resource.description?(0,le.jsx)(re().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:_.resource.description}):void 0,_.isEnabled?void 0:(0,le.jsx)(re().D,{styleKey:"captionRegular",colorVariant:"tertiary",children:"This resource is disabled. You can still read it for debugging, but it won't be available to the agent."}),(0,le.jsxs)(J().Y1,{direction:"vertical",gap:4,children:[(0,le.jsxs)(re().D,{styleKey:"captionRegular",colorVariant:"secondary",children:["URI: ",_.resource.uri]}),_.resource.mimeType?(0,le.jsxs)(re().D,{styleKey:"captionRegular",colorVariant:"secondary",children:["MIME Type: ",_.resource.mimeType]}):void 0]})]}):null})]}),(0,le.jsxs)("div",{style:M.footer,children:[(0,le.jsx)(ne().A,{onClick:n,children:(0,le.jsx)(b().sA,{...ue.close})}),(0,le.jsx)(ae().A,{onClick:B,disabled:y||"tools"===c&&0===j.length||"resources"===c&&0===T.length,children:y?(0,le.jsxs)(J().Y1,{direction:"horizontal",gap:8,align:"center",children:[(0,le.jsx)(te().k,{size:"default",onDarkBackground:!0}),(0,le.jsx)(b().sA,{...ue.invoke})]}):(0,le.jsx)(b().sA,{...ue.invoke})})]})]})})}var pe=()=>n(119081),he=()=>n(807449),me=()=>n(265060),fe=()=>n(631524),ve=()=>n(424400),ye=()=>n(165358),be=()=>n(589222),xe=()=>n(236262),Se=()=>n(728272),we=()=>n(978234),Ce=()=>n(563452),Me=()=>n(229833),Ie=()=>n(812182),ke=()=>n(381678),je=()=>n(229508),Te=()=>n(814207),Ae=()=>n(449851),_e=()=>n(945109),Be=()=>n(791256),Pe=()=>n(552559);const De=(0,b().YK)({noIntegrations:{id:"AgentChatSettingsMenu.AgentChatModulesSection.NoIntegrationsTitle",defaultMessage:"No integrations"},unknownModule:{id:"AgentChatSettingsMenu.AgentChatModulesSection.UnknownModuleTitle",defaultMessage:"Unknown module"},deleteIntegration:{id:"AgentChatSettingsMenu.AgentChatModulesSection.DeleteButtonTitle",defaultMessage:"Delete {moduleName} integration"},startChatFirst:{id:"AgentChatSettingsMenu.IntegrationsSection.StartChatFirst",defaultMessage:"Start a conversation first"},startChatFirstMessage:{id:"AgentChatSettingsMenu.IntegrationsSection.StartChatFirstMessage",defaultMessage:"Send a message to the AI before enabling integrations"},addMcpIntegration:{id:"AgentChatSettingsMenu.AgentChatModulesSection.AddModuleButtonTitle",defaultMessage:"Add MCP integration"},helpText:{id:"AgentChatSettingsMenu.IntegrationsSection.HelpText",defaultMessage:"Start a chat to toggle integrations"},doneButton:{id:"AgentChatSettingsMenu.AgentChatModulesSection.DoneButtonTitle",defaultMessage:"Done"},editButton:{id:"AgentChatSettingsMenu.AgentChatModulesSection.EditButtonTitle",defaultMessage:"Edit"}}),Re={action:()=>{},key:"agent_integration_no_integrations",render:e=>(0,le.jsx)(ve().Ay,{...e,title:(0,le.jsx)(b().sA,{...De.noIntegrations})})};const Ee=(0,b().YK)({experimentsTitle:{id:"AgentChatSettingsMenu.AgentFeatureGatesSection.Title",defaultMessage:"Experiments"},wildWestTitle:{id:"AgentChatSettingsMenu.AgentFeatureGatesSection.WildWestTitle",defaultMessage:"Wild west"},toolInspector:{id:"AgentChatSettingsMenu.inspectorMenuItem",defaultMessage:"Tool inspector"}}),Fe=K().QT.filter((e=>"default"===e.group)),We=K().QT.filter((e=>"advanced"===e.group));function Le(e,t){const n=(0,a.useContext)(R().p);if(!n)throw new Error("useFeatureGate must be used within a FeatureGateContextProvider");const o=function(e,t){const n=(0,b().tz)(),o=(0,i().v3)(),l=(0,s().K8)((()=>(0,ke()._)(o)),[o]),c=(0,D().L)(),u=(0,je().a)(),[g,p]=(0,a.useState)(!1),[h,m]=(0,a.useState)(!1),f=(0,s().K8)((()=>!(0,Be().OT)(t)),[t]),{isCustomAgent:v,workflowIntegrations:y}=(0,s().K8)((()=>{const e=null==t?void 0:t.getTranscript(),n=null==e?void 0:e.find((e=>"config"===e.type)),a="config"===(null==n?void 0:n.type)&&"workflow"===n.value.type?n.value.workflowId:void 0;return a&&c&&l?{isCustomAgent:!0,workflowIntegrations:(H(F().N.createChildStore(c,{table:N().C0,id:a,spaceId:c.id}))??[]).filter((e=>"mcpServer"===e.type)).map((e=>({defaultEnabled:!0,workflowModuleStore:pe().P.createChildStore(l,{table:we().yM,id:e.id,spaceId:c.id})})))}:{isCustomAgent:!1,workflowIntegrations:[]}}),[t,c,l]),x=v?y:e,{activeIntegrationPointers:S,inactiveIntegrationPointers:w}=(0,s().K8)((()=>{const e=null==t?void 0:t.getTranscript();return e?(0,Ce().It)(e):{activeIntegrationPointers:[],inactiveIntegrationPointers:[]}}),[t]),C=(0,a.useMemo)((()=>new(Se().d)(S)),[S]),M=(0,a.useMemo)((()=>new(Se().d)(w)),[w]),I=(0,a.useCallback)((e=>()=>{u&&t&&l&&c&&e.isDefined()&&((0,_e().Tn)({environment:o,spaceStore:c,spaceViewStore:u,threadStore:t,userStore:l,workflowModuleStore:e}),x.length<=1&&p(!1))}),[x.length,l,o,c,u,t]),k=(0,a.useCallback)((e=>n=>{if(!(u&&t&&l&&c&&e.isDefined()))return;const a=v?!M.has(e.pointer):C.has(e.pointer);try{if(a)(0,_e().lT)({environment:o,spaceStore:c,threadStore:t,userStore:l,workflowModuleModels:[e.getModel()]});else{const n=e.getModel();(0,_e().TF)({environment:o,spaceStore:c,threadStore:t,userStore:l,workflowModuleModels:[n]})}}catch(r){ye().log({from:"AgentChatExperimentalSettings",type:"toggleIntegrationError",level:"error",error:(0,Me().convertErrorToLog)(r),data:{miscDataToConvertToString:{workflowModuleId:e.pointer.id}}})}}),[l,M,C,o,v,c,u,t]),j=(0,a.useCallback)((()=>{m(!0)}),[]),T=(0,s().K8)((()=>(0,B().oE)(x.map((e=>{const{workflowModuleStore:t}=e;if(!t.isDefined())return;const a=t.getDataStore().getKeyValue("name")??(0,le.jsx)(b().sA,{...De.unknownModule}),r=t.toModuleValue(),o=r?(0,Te().c)(r):Ae().d.getDefaultIcon(t.getModuleType()),i=v?!M.has(t.pointer):C.has(t.pointer);return{action:()=>{},key:`agent_integration_${e.workflowModuleStore.pointer.id}`,render:e=>g?(0,le.jsx)(ve().Ay,{...e,icon:(0,le.jsx)(he().I,{icon:o}),right:(0,le.jsx)(d().A,{ariaLabel:n.formatMessage(De.deleteIntegration,{moduleName:a}),icon:xe().trashIcon,hasBackground:!0,onClick:I(t)}),title:a}):(0,le.jsx)(V().A,{...e,disabled:f,icon:(0,le.jsx)(he().I,{icon:o}),on:i,onClick:e=>{f?Ie().HK({title:n.formatMessage(De.startChatFirst),message:n.formatMessage(De.startChatFirstMessage),variant:"default",presentationType:"transient"}):k(t)(e)},title:a})}})))),[M,x,C,I,k,n,v,g,f]),A=(0,s().K8)((()=>(0,B().oE)(x.map((e=>{const{workflowModuleStore:t}=e;if(!t.isDefined())return;if("mcpServer"!==t.getModuleType())return;const n=t.getData(),a=n&&"serverUrl"in n?n.serverUrl:void 0;return{name:null==n?void 0:n.name,serverUrl:a}})))),[x]),_=(0,r().X)("workflows_mcp_server_module_available")&&!v?{action:j,key:"agent_change_module_add",render:e=>(0,le.jsx)(W().A,{...e,icon:(0,le.jsx)(me().Q,{colorPalette:"gray",colorVariant:"accentPrimary",iconGroup:be().h,variantName:"small"}),title:(0,le.jsx)(b().sA,{...De.addMcpIntegration})})}:void 0,P=(0,a.useCallback)((()=>{p((e=>!e))}),[]),R=T.length>0;if(!(0,r().X)("agent_integrations"))return;const E=f?{action:()=>{},key:"agent_integration_help_text",render:e=>(0,le.jsx)(ve().Ay,{...e,disabled:!0,title:(0,le.jsx)(re().D,{styleKey:"captionRegular",color:"secondary",children:(0,le.jsx)(b().sA,{...De.helpText})})})}:void 0;return{items:(0,B().oE)([...R?[...T,_]:[Re,_],E]),key:"agent_integrations",render:e=>(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(L().A,{...e,title:"Integrations",right:R&&!v?(0,le.jsx)(fe().p,{colorPalette:"blue",size:"xs",onClick:P,children:g?(0,le.jsx)(b().sA,{...De.doneButton}):(0,le.jsx)(b().sA,{...De.editButton})}):null}),h&&l&&u?(0,le.jsx)(Pe().Z,{isOpen:h,onClose:()=>m(!1),spaceViewStore:u,currentUserPointer:l.pointer,existingModuleId:void 0,existingAgentModules:A}):void 0]})}}((0,O().K)(),e),l=(0,a.useCallback)(((e,t)=>{if(e.featureGates.forEach((e=>{E().A.updateLocalOverrideGate(e,!t)})),!t)if("agent_automations"===e.id){const e=K().QT.find((e=>"custom_agents"===e.id));e&&e.featureGates.forEach((e=>{E().A.updateLocalOverrideGate(e,!0)}))}else if("experimental_integrations"===e.id){const e=K().QT.find((e=>"agent_integrations"===e.id));e&&e.featureGates.forEach((e=>{E().A.updateLocalOverrideGate(e,!0)}))}}),[]),c=(0,s().K8)((()=>Fe.map(((e,t)=>{const a=(0,K().MI)(e,(e=>n.withoutExposureLogging(e,!1)));return{action:()=>{},key:`agent_feature_gate_${t}`,render:t=>(0,le.jsx)(V().A,{...t,on:a,onClick:()=>l(e,a),title:e.label})}}))),[n,l]),[u,g]=(0,a.useState)(!1),p=(0,D().L)(),h=(0,s().K8)((()=>{const t=null==e?void 0:e.getTranscript(),n=null==t?void 0:t.find((e=>"config"===e.type)),a="config"===(null==n?void 0:n.type)&&"workflow"===n.value.type?n.value.workflowId:void 0;if(!a||!p)return[];return(H(F().N.createChildStore(p,{table:N().C0,id:a,spaceId:p.id}))??[]).filter((e=>"mcpServer"===e.type))}),[e,p]),m=(0,s().K8)((()=>{const e=We.map(((e,t)=>{const a=(0,K().MI)(e,(e=>n.withoutExposureLogging(e,!1)));return{action:()=>{},key:`agent_feature_gate_${t}`,render:t=>(0,le.jsx)(V().A,{...t,on:a,onClick:()=>l(e,a),title:e.label})}})),t=n.withoutExposureLogging("workflows_debug_tools",!1),a=h.length>0&&h.some((e=>{var t,n;return((null===(t=e.state)||void 0===t||null===(t=t.tools)||void 0===t?void 0:t.length)??0)>0||((null===(n=e.state)||void 0===n||null===(n=n.resources)||void 0===n?void 0:n.length)??0)>0}));return t&&a&&e.push({action:()=>g(!0),key:"mcp_inspector",render:e=>(0,le.jsx)(W().A,{...e,title:(0,le.jsx)(b().sA,{...Ee.toolInspector})})}),e}),[n,l,h]),{handleInvokeTool:f,handleInvokeResource:v}=X({clientStore:t,threadStore:e});return[{items:c,key:"agent_feature_gates_default",render:e=>(0,le.jsx)(L().A,{...e,title:(0,le.jsx)(b().sA,{...Ee.experimentsTitle})})},o,{items:m,key:"agent_feature_gates_advanced",render:e=>(0,le.jsx)(L().A,{...e,loading:!1,title:(0,le.jsx)(b().sA,{...Ee.wildWestTitle})})},(0,le.jsx)(ge,{isOpen:u,onClose:()=>g(!1),modules:h,threadStore:e,onInvokeTool:f,onInvokeResource:v})]}const Ke=(0,b().YK)({experimentalSettingsTooltip:{id:"agentChatView.experimentalSettingsTooltip",defaultMessage:"Experimental settings"},experimentalSettingsAriaLabel:{id:"agentChatView.experimentalSettings",defaultMessage:"Experimental settings"}});function Ne(e){const{aiChatFeatureController:t,threadStore:n,clientStore:r}=e,o=(0,P().useIconButtonStyles)({shape:t.headerButtonShape,aiChatFeatureController:t}),[i,s,u,g]=((0,l().IS)((()=>({container:{minWidth:240}})),[]),Le(n,r)),p=((0,a.useCallback)((()=>{const e=(0,B().oE)([i,s,u]);return(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(T().A,{menuType:j().gu.Popup,children:(0,le.jsx)(A().A,{initialFocus:void 0,sections:e,type:A().O.Vertical})}),g]})}),[i,s,u,g]),(0,b().tz)());(0,a.useCallback)((e=>(0,le.jsx)(c().m,{renderTooltip:()=>(0,le.jsx)(b().sA,{...Ke.experimentalSettingsTooltip}),render:t=>(0,le.jsx)(d().A,{...e,...t,icon:_().c,style:o.iconButton,iconStyle:o.iconButtonIcon,ariaLabel:p.formatMessage(Ke.experimentalSettingsAriaLabel)})})),[p,o.iconButton,o.iconButtonIcon]);return null}var Ve=()=>n(459629);const ze=100;function He(e){const{threadStore:t,workflowStore:n,clientStore:l,aiChatFeatureController:d,onThreadChange:c,showOnHover:u,features:g}=e,{showInviteButton:p,showNewChatButton:m,showNewChatButtonIcon:b}=g,x=(0,i().v3)(),{navigate:C}=(0,a.useContext)(o().E),j=(0,r().X)("custom_agent_flippy_layout"),T=(0,M().U)(),[A,_]=(0,a.useState)(!1),B=(0,a.useRef)(void 0),P=(0,s().K8)((()=>x.RouterStore.state.route),[x]),D=(0,s().K8)((()=>{if("agent"===P.name){const e=P.workflowViewType;return"activity"===e||"settings"===e}return"chat"===P.name&&Boolean(P.peekViewBlockId&&P.peekMode)}),[P]),R="sidebar"===d.agentChatFormFactor&&T,E=j&&Boolean(n)&&!R&&!D,F=(0,s().K8)((()=>(null==n?void 0:n.canAdmin())??!1),[n]),W=(0,a.useCallback)((e=>{if(!n)return;const a=(0,I().getUrlParamFromPeekMode)(f().A);if("agent"===P.name){const t=(0,y().L)({workflowId:P.workflowId,params:{workflowViewType:e,workflowViewId:P.workflowViewId,workflowPrompt:P.workflowPrompt,chatThreadId:P.chatThreadId,agentChatThreadId:P.agentChatThreadId},peekViewBlockId:P.workflowId,peekModeParam:a});return C({environment:x,url:t,redirect:!1}),void _(!1)}if("chat"===P.name){const t={wfv:e,[v().ZI]:(0,S().Xw)(n.id)};a&&(t[v().fT]=a),P.threadId&&(t.t=(0,S().Xw)(P.threadId));const r=(0,w().Gm)({url:"/chat",query:t});return C({environment:x,url:r}),void _(!1)}const r=(0,y().L)({workflowId:n.id,params:{workflowViewType:e,agentChatThreadId:null==t?void 0:t.id},peekViewBlockId:n.id,peekModeParam:a});C({environment:x,url:r}),_(!1)}),[n,P,x,t,C]),L=(0,a.useCallback)((()=>{d.supportsChatActionsOnHover&&(void 0!==B.current&&(clearTimeout(B.current),B.current=void 0),_(!0))}),[d.supportsChatActionsOnHover]),K=(0,a.useCallback)((()=>{d.supportsChatActionsOnHover&&(B.current=window.setTimeout((()=>{_(!1),B.current=void 0}),ze))}),[d.supportsChatActionsOnHover]),N=!u||A;return(0,le.jsxs)("div",{onMouseEnter:L,onMouseLeave:K,style:{display:"flex",alignItems:"center",gap:2,position:"relative",minHeight:u?28:void 0},children:[u&&!A?(0,le.jsx)("div",{style:{position:"absolute",top:0,insetInlineEnd:0,bottom:0,width:80}}):null,N?(0,le.jsxs)(le.Fragment,{children:[(0,le.jsx)(k().g,{aiChatFeatureController:d,clientStore:l}),(0,le.jsx)(Ne,{aiChatFeatureController:d,threadStore:t,clientStore:l}),(0,le.jsx)(k().M,{aiChatFeatureController:d,threadStore:t})]}):null,E?(0,le.jsx)(qe,{hasAdminPermission:F,onNavigate:W}):null,p?(0,le.jsx)(Ve().y,{aiChatFeatureController:d,threadStore:t}):null,m?(0,le.jsx)(Oe,{aiChatFeatureController:d,onNewChat:()=>c({newThreadStore:void 0}),icon:b?h().plusIcon:void 0}):null]})}function Oe(e){const{aiChatFeatureController:t,onNewChat:n,icon:a}=e,r=(0,b().tz)(),o=(0,M().U)(),i=(0,P().useIconButtonStyles)({shape:t.headerButtonShape,aiChatFeatureController:t}),s=(0,l().IS)((()=>({shortcutContainer:{display:"flex",alignItems:"center",gap:8},shortcut:{color:x().Tj.text.inverseSecondary}})),[]),g=o?u().Y:p().M;return(0,le.jsx)(c().m,{renderTooltip:()=>(0,le.jsxs)("div",{style:s.shortcutContainer,children:[(0,le.jsx)(b().sA,{id:"aiChatView.newChatTooltip",defaultMessage:"New AI chat"}),(0,le.jsx)(C().A,{style:s.shortcut,name:"createAIChatThread"})]}),render:e=>(0,le.jsx)(d().A,{...e,icon:a??g,iconStyle:i.iconButtonIcon,style:i.iconButton,ariaLabel:r.formatMessage({id:"aiInferenceTranscript.newChat",defaultMessage:"New AI chat"}),onClick:n})})}function qe(e){const{hasAdminPermission:t,onNavigate:n}=e,a=(0,b().tz)(),r=(0,l().IS)((()=>({buttonGroup:{display:"flex",alignItems:"center",gap:4,paddingInline:8},button:{width:28,height:28},icon:{width:16,height:16,fill:x().Tj.icon.primary},separator:{width:1,height:16,backgroundColor:x().Tj.border.secondary,marginInline:4}})),[]);return(0,le.jsxs)(le.Fragment,{children:[(0,le.jsxs)("div",{style:r.buttonGroup,children:[t?(0,le.jsx)(c().m,{renderTooltip:()=>(0,le.jsx)(b().sA,{defaultMessage:"Activity",id:"agentTopbar.flippy.activity.tooltip"}),render:e=>(0,le.jsx)(d().A,{...e,icon:g().j,style:r.button,iconStyle:r.icon,onClick:()=>n("activity"),ariaLabel:a.formatMessage({defaultMessage:"Activity",id:"agentTopbar.flippy.activity.ariaLabel"})})}):void 0,(0,le.jsx)(c().m,{renderTooltip:()=>(0,le.jsx)(b().sA,{defaultMessage:"Settings",id:"agentTopbar.flippy.settings.tooltip"}),render:e=>(0,le.jsx)(d().A,{...e,icon:m().T,style:r.button,iconStyle:r.icon,onClick:()=>n("settings"),ariaLabel:a.formatMessage({defaultMessage:"Settings",id:"agentTopbar.flippy.settings.ariaLabel"})})})]}),(0,le.jsx)("div",{style:r.separator})]})}},22634:(e,t,n)=>{n.d(t,{O:()=>o});n(296540);var a=n(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"4.42 3.97 12.16 12.06",directional:!0,svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"m5.492 4.158 5.4 5.4a.625.625 0 0 1 0 .884l-5.4 5.4a.625.625 0 1 1-.884-.884L9.566 10 4.608 5.042a.625.625 0 1 1 .884-.884"}),(0,a.jsx)("path",{d:"m16.392 10.442-5.4 5.4a.625.625 0 0 1-.884-.884L15.066 10l-4.958-4.958a.625.625 0 0 1 .884-.884l5.4 5.4a.625.625 0 0 1 0 .884"})]})},o=(0,n(340498).wt)("arrowChevronDoubleForward",r,"default")},31790:(e,t,n)=>{n.d(t,{X:()=>r});var a=()=>n(314529);function r(e,t){(0,a().DO_NOT_USE_trackLegacy)(e,"page_error_button_click",t)}},49418:(e,t,n)=>{n.d(t,{A:()=>P,c:()=>L});var a=n(296540),r=()=>n(664594),o=()=>n(717137),i=()=>n(314709),s=()=>n(484714),l=()=>n(590526),d=()=>n(757695),c=()=>n(483226),u=()=>n(31511),g=()=>n(546926),p=()=>n(406094),h=()=>n(160432),m=()=>n(890492),f=()=>n(69708),v=()=>n(100622),y=()=>n(534177),b=()=>n(284371),x=()=>n(31790),S=()=>n(701763),w=()=>n(140612),C=()=>n(753812),M=()=>n(251126),I=n(474848);const k={marginBottom:10},j={...k,width:"100%",height:"100%",padding:10,alignItems:"top",borderRadius:0},T=(0,f().YK)({requestAccessMessagePlaceholder:{defaultMessage:"Message (optional)",id:"requestAccessForm.messageInput.placeholder"},rateLimitError:{defaultMessage:"You have recently requested access to this page.",id:"requestAccessForm.errorMessage.rateLimit"},currentUserNotFound:{defaultMessage:"Current user not found.",id:"requestAccessForm.errorMessage.currentUserNotFound"}});function A(){return(0,I.jsx)(f().sA,{defaultMessage:"Cancel",id:"requestAccessForm.cancelButton.label"})}const _=d().Store.createClass(0,{name:"RequestAttemptStore"}),B=d().Store.createClass(void 0,{name:"MessageStore"});const P=function(e){const t=(0,s().v3)(),r=(0,s().WS)(),o=(0,l().uB)(e.popupStore,n(118307).A),i=(0,l().uB)(void 0,B),d=(0,l().uB)(void 0,_),c=(0,a.useCallback)((()=>E(o)),[o]),u=(0,a.useCallback)((()=>(0,I.jsx)(W,{...e,requestAttemptStore:d,messageStore:i,buttonPopupStore:o})),[e,d,i,o]),g=(0,l().K8)((()=>d.state>0),[d]),m=(0,l().K8)((()=>o.state.open),[o]);if("current-actor-to-block"===e.type)return(0,I.jsx)(L,{type:"page",block:e.block,flowId:e.flowId,buttonType:e.buttonType});if("current-actor-to-collection"===e.type)return(0,I.jsx)(L,{type:"collection",collection:e.collection,flowId:e.flowId,buttonType:e.buttonType});const v="primary"===e.buttonType?h().A:"plain"===e.buttonType?n(631524).p:p().A,y=r?(0,I.jsx)(n(127833).zD,{popupType:n(30537).n.SlideUp,open:m,render:u}):(0,I.jsx)(n(107975).a,{open:m,onDismiss:c,render:u});return"current-actor-to-space-via-onboarding"===e.type?y:(0,I.jsxs)(I.Fragment,{children:[(0,I.jsx)(v,{size:"plain"===e.buttonType?"md":"lg",colorPalette:e.buttonType&&["primary","plain"].includes(e.buttonType)?"blue":void 0,disabled:g,onClick:()=>{var n,a;return function(e,t){const{environment:n,flowId:a,type:r,source:o,spaceId:i,pageId:s}=e;"trusted_domain_page"===o&&i&&w().w(n,{spaceId:i,pageId:s,joinSpaceMethod:"request_to_join"});"current-actor-to-block"===r?(0,x().X)(n,{button_name:"request-access",flow_id:a,request_access_type:"page"}):"current-actor-to-space-via-team"===r&&(0,x().X)(n,{button_name:"request-access",flow_id:a,request_access_type:"team"});t.setState({open:!0})}({environment:t,flowId:e.flowId,type:e.type,source:e.source,pageId:null===(n=e.block)||void 0===n?void 0:n.id,spaceId:null===(a=e.block)||void 0===a?void 0:a.spaceId},o)},style:"outline"===e.buttonType?{...e.buttonStyle,fontWeight:b().Wy.semibold}:e.buttonStyle,children:g?(0,I.jsx)(f().sA,{id:"fullPageError.requestAccessButton.requested",defaultMessage:"Requested access"}):(0,I.jsxs)(n(249046).Ye,{gap:4,alignItems:"center",justifyContent:"center",children:[e.icon,K(e.type)]})}),y]})};function D({result:e}){return e&&e.error?(0,I.jsx)("div",{style:{color:v().IF.redWithAlpha(1),textAlign:"center",width:"100%",marginBottom:16},children:e.error}):null}function R(e){e.update((e=>e+1))}function E(e){return e.setState({open:!1})}function F({error:e,result:t,ready:n,requestAttemptStore:r,messageStore:o,type:i}){const d=(0,f().tz)(),c=(0,s().WS)(),g=(0,a.useCallback)((()=>R(r)),[r]),p=(0,a.useCallback)((e=>function(e,t){t.setState(e.target.value)}(e,o)),[o]),m=(0,l().K8)((()=>Boolean(0===r.state||n&&t&&t.error)),[r,n,t]),v=(0,l().K8)((()=>o.state||""),[o]);return(0,I.jsxs)(I.Fragment,{children:[c?void 0:(0,I.jsx)("div",{style:{fontSize:16,fontWeight:b().Wy.semibold,marginBottom:16},children:K(i)}),(0,I.jsx)(u().A,{format:c?"transparent":void 0,textarea:!0,value:v,onChange:p,disabled:!m,placeholder:d.formatMessage(T.requestAccessMessagePlaceholder),style:{...c?{...j,padding:"16px"}:{...k,marginBottom:16,padding:"8px 12px",alignItems:"flex-start"}}}),c?void 0:(0,I.jsx)(h().A,{colorPalette:"blue",size:"lg",disabled:!m,onClick:g,style:k,children:(0,I.jsx)(f().sA,{defaultMessage:"Send request",id:"requestAccessForm.sendRequestButton.label"})}),(0,I.jsx)(D,{result:t})]})}function W(e){const{requestAttemptStore:t,messageStore:n,buttonPopupStore:d}=e,c=(0,s().v3)(),u=(0,s().WS)(),h=(0,f().tz)(),v=(0,a.useCallback)(((a,r,o)=>(0,I.jsx)(F,{requestAttemptStore:t,messageStore:n,error:a,result:r,ready:o,type:e.type})),[t,n,e.type]),b=(0,r().T)(),x=(0,a.useCallback)((t=>async function(e){const{messageStore:t,buttonPopupStore:n,type:a,teamId:r,requestAttempt:o,environment:s,currentUserId:l,intl:d,flowId:c}=e;if(0===o)return;const u=t.state,g=await async function(){if("current-actor-to-block"===a)return C().callApi({eventName:"requestAccess",environment:s,data:{type:"current-actor-to-block",block:e.block,message:u}});if("current-actor-to-collection"===a)return C().callApi({eventName:"requestAccess",environment:s,data:{type:"current-actor-to-collection",collection:e.collection,message:u}});if("current-actor-to-space-via-team"===a)return C().callApi({eventName:"requestAccess",environment:s,data:{type:"current-actor-to-space-via-team",teamId:r,message:u}});if("current-actor-to-space-via-block"===a){if(!l)return;return C().callApi({eventName:"requestAccess",environment:s,data:{type:"actor-to-space",spaceId:e.block.spaceId,message:u,forActorId:l,attributes:{add_permissions_on_approval:!1,origin_type:"trusted_domain_page"}}})}if("current-actor-to-space-via-onboarding"===a){if(!l)return;return C().callApi({eventName:"requestAccess",environment:s,data:{type:"actor-to-space",spaceId:e.spaceId,message:u,forActorId:l,attributes:{add_permissions_on_approval:!1,origin_type:"onboarding"}}})}}();return g?"success"!==g.type?"UserRateLimitResponse"===(null===(p=g.body)||void 0===p?void 0:p.name)?{error:d.formatMessage(T.rateLimitError)}:{error:(0,i().H)(d,g)}:("current-actor-to-block"===a?S().T_(s,{request_access_type:"page",flow_id:c,requestId:g.data.requestId}):"current-actor-to-space-via-team"===a?S().T_(s,{request_access_type:"team",flow_id:c}):"current-actor-to-space-via-block"===a?S().T_(s,{request_access_type:"space",flow_id:c,source:"trusted_domain_page"}):"current-actor-to-collection"===a?S().T_(s,{request_access_type:"collection",flow_id:c,requestId:g.data.requestId}):"current-actor-to-space-via-onboarding"===a?S().T_(s,{request_access_type:"space",flow_id:c,source:"onboarding"}):(0,y().HB)(a),n.reset(),{value:!0}):{error:d.formatMessage(T.currentUserNotFound)};var p}({...e,requestAttempt:t,environment:c,intl:h,currentUserId:b})),[c,h,e,b]),w=(0,a.useCallback)((()=>R(t)),[t]),k=(0,a.useCallback)((()=>E(d)),[d]),j=(0,l().O$)(t);return u?(0,I.jsx)(m().A,{menuType:g().gu.Modal,whiteBackground:!0,title:K(e.type),left:A(),onClickLeft:k,right:(0,I.jsx)(f().sA,{id:"requestAccessForm.mobileSend.label",defaultMessage:"Send"}),onClickRight:w,children:(0,I.jsx)(o().A,{debugName:"RequestAccessForm",capture:!0,children:(0,I.jsx)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"stretch",alignItems:"stretch",width:"100%",height:"100%"},children:(0,I.jsx)(M().A,{request:j,performRequest:x,render:v})})})}):(0,I.jsx)(o().A,{debugName:"RequestAccessForm",capture:!0,children:(0,I.jsxs)("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-evently",alignItems:"stretch",padding:"20px 28px 24px",width:"340px"},children:[(0,I.jsx)(M().A,{request:j,performRequest:x,render:v}),(0,I.jsx)(p().A,{size:"lg",onClick:k,children:A()})]})})}function L(e){const{type:t,flowId:n,buttonType:r,labelMessage:o}=e,i=(0,s().v3)(),d="outline"===r?p().A:h().A,[u,g]=(0,a.useState)(!1),[m,v]=(0,a.useState)(!1),b=e.customIsAccessRequestPending??u,x=e.customSetIsAccessRequestPending??g,w={attributes:{add_permissions_on_approval:!1,role:(0,l().K8)((()=>(0,c().dL)()),[])?"reader":"read_and_write"},message:void 0};let M;"page"===t?M={...w,type:"current-actor-to-block",block:{id:e.block.id,spaceId:e.block.spaceId}}:"collection"===t?M={...w,type:"current-actor-to-collection",collection:{id:e.collection.id,spaceId:e.collection.spaceId}}:(0,y().HB)(t);const k=(0,a.useCallback)((async()=>{var e;const a=await C().callApi({eventName:"requestAccess",environment:i,data:M});"success"===a.type&&a.data.request?(x(!0),S().T_(i,{request_access_type:t,previous_access_level:"none",requested_access_level:"read_and_write",flow_id:n,requestId:a.data.requestId})):"failed"===a.type&&"UserRateLimitResponse"===(null===(e=a.body)||void 0===e?void 0:e.name)&&v(!0)}),[i,M,x,t,n]);return(0,I.jsx)(d,{size:"lg",colorPalette:"outline"===r?void 0:"blue",disabled:b||m,disabledFeedback:b||m,onClick:k,style:e.buttonStyle,children:b?(0,I.jsx)(f().sA,{id:"fullPageError.requestAccessButton.edit.Requested",defaultMessage:"Requested access"}):m?(0,I.jsx)(f().sA,{id:"fullPageError.requestAccessButton.edit.TryAgain",defaultMessage:"Try again later"}):o?(0,I.jsx)(f().sA,{...o}):K("page"===t?"current-actor-to-block":"current-actor-to-collection")})}function K(e){return"current-actor-to-space-via-block"===e||"current-actor-to-space-via-onboarding"===e?(0,I.jsx)(f().sA,{defaultMessage:"Request membership",id:"requestAccessForm.requestAccessToSpaceButton.title"}):(0,I.jsx)(f().sA,{defaultMessage:"Request access",id:"requestAccessForm.requestAccessButton.title"})}},140612:(e,t,n)=>{n.d(t,{w:()=>r});var a=()=>n(564884);function r(e,t){const{spaceId:n,pageId:r,joinSpaceMethod:o}=t;(0,a().u)({environment:e,event:{eventName:"trusted_domain_banner_cta_clicked",eventProperties:{spaceId:n,pageId:r,joinSpaceMethod:o}}})}},156938:(e,t,n)=>{n.d(t,{F:()=>f});n(814603),n(147566),n(198721);var a=n(296540),r=()=>n(312788),o=()=>n(484714),i=()=>n(695115),s=()=>n(26697),l=()=>n(630230),d=()=>n(427704),c=()=>n(530199),u=()=>n(69708),g=()=>n(498212),p=()=>n(981475),h=n(474848);const m={id:"chatSidebar.moveToSidebar",defaultMessage:"Move chat to sidebar",description:"Move chat to sidebar and return to previous page"};function f(e){const{threadId:t,size:n,testId:f}=e,{handleClick:v,ariaLabel:y,icon:b}=function(e){const{navigate:t}=(0,a.useContext)(r().E),n=(0,o().v3)(),i=(0,u().tz)();return{handleClick:(0,a.useCallback)((()=>{let a=p().globalChatPanelRuntimeStore.state.fullPageChatSourceUrl??d().JZ.home;const r=new URL(a,window.location.origin);r.searchParams.delete(c().P5),e&&r.searchParams.set(c().P5,(0,g().Xw)(e)),a=r.toString(),p().globalChatPanelRuntimeStore.setState({...p().globalChatPanelRuntimeStore.state,fullPageChatSourceUrl:void 0}),t({environment:n,url:a})}),[n,t,e]),ariaLabel:i.formatMessage(m),icon:l().i}}(t);return(0,h.jsx)(s().m,{renderTooltip:()=>(0,h.jsx)(u().sA,{...m}),render:e=>(0,h.jsx)(i().A,{...e,icon:b,colorVariant:"primary",size:n,ariaLabel:y,onClick:v,testId:f??"move-to-sidebar-button",iconStyle:{transform:"scaleX(-1)"}})})}},157188:(e,t,n)=>{n.d(t,{g:()=>x,M:()=>S});var a=n(296540),r=()=>n(484714),o=()=>n(590526),i=()=>n(401497),s=()=>n(695115),l=()=>n(26697),d=()=>n(878456),c=()=>n(607567),u=n(474848);const g={viewBox:"0 0 20 20",fittedViewBox:"3.37 0.43 13.25 16.44",svg:(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("path",{d:"M10.417.62a.625.625 0 0 0-.884 0l-2.5 2.5a.625.625 0 1 0 .884.884l1.458-1.458V11a.625.625 0 1 0 1.25 0V2.596l1.408 1.408a.625.625 0 1 0 .884-.883z"}),(0,u.jsx)("path",{d:"M8.125 5.125H5.5A2.125 2.125 0 0 0 3.375 7.25v7.5c0 1.174.951 2.125 2.125 2.125h9a2.125 2.125 0 0 0 2.125-2.125v-7.5A2.125 2.125 0 0 0 14.5 5.125h-2.625V11a1.875 1.875 0 0 1-3.75 0z"})]})};(0,n(340498).wt)("squareAndArrowUpFill",g,"fill");var p=()=>n(69708),h=()=>n(100622),m=()=>n(140992),f=()=>n(703748),v=()=>n(244828),y=()=>n(46986),b=()=>n(463916);function x(e){const{clientStore:t,aiChatFeatureController:n}=e,d=(0,p().tz)(),g=(0,r().v3)(),m=(0,a.useCallback)((()=>{const e=!t.state.showDebug;!0===e&&(0,f().ensureChatSidebarSupportsDebugMode)(g),t.setState({...t.state,showDebug:e})}),[t,g]),v=(0,o().K8)((()=>(0,y().Ke)()),[]),b=(0,o().K8)((()=>t.state.showDebug),[t]),x=(0,i().IS)((()=>({icon:{fill:b?h().Tj.blue.icon.accentPrimary:h().Tj.icon.primary}})),[b]);return v&&n.supportsDebugButton?(0,u.jsx)(l().m,{renderTooltip:()=>(0,u.jsx)(p().sA,{id:"aiChatView.debugTooltip",defaultMessage:"Debug"}),render:e=>(0,u.jsx)(s().A,{...e,icon:c().Z,iconStyle:{width:20,height:20,...x.icon},colorPalette:b?"blue":void 0,ariaLabel:d.formatMessage({id:"aiInferenceTranscript.debug",defaultMessage:"Debug"}),onClick:m})}):null}function S(e){const{threadStore:t,aiChatFeatureController:n}=e,i=(0,r().v3)(),s=((0,p().tz)(),(0,o().K8)((()=>{var e;return(null==t||null===(e=t.getData())||void 0===e?void 0:e.shared_with_space)??!1}),[t]));(0,a.useCallback)((()=>{t&&v().createAndCommit({userAction:"AgentChatDebugButtons.toggleShareWithSpace",environment:i,canUndo:!0,perform:e=>{(0,m().g6)({threadStore:t,transaction:e})}})}),[t,i]),(0,o().K8)((()=>t&&!t.canEdit()),[t]),(0,o().K8)((()=>(0,d().q1)((null==t?void 0:t.getTranscript())??[])),[t]),(0,b().useIconButtonStyles)({shape:n.headerButtonShape,active:s,aiChatFeatureController:n});return null}},221267:(e,t,n)=>{n.d(t,{D:()=>S});n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(803949),n(581454),n(737550);var a=n(296540),r=()=>n(664594),o=()=>n(590526),i=()=>n(401497),s=()=>n(849255),l=()=>n(404905),d=()=>n(26697),c=()=>n(68263),u=()=>n(798880),g=()=>n(69708),p=()=>n(100622),h=()=>n(534177),m=()=>n(187820),f=()=>n(580648),v=()=>n(994006),y=()=>n(453697),b=(n(944114),()=>n(169626));var x=n(474848);function S(e){const{section:t,spaceStore:n,workflowStore:S}=e,w=(0,r().T)(),C=(0,o().K8)((()=>{if(!S.isDefined())return!1;const e=S.getPermissionItems();return 1===e.length&&"user_permission"===e[0].type&&w===e[0].user_id}),[S,w]),M=(0,o().K8)((()=>{if(!S.isDefined())return!1;return S.getPermissionItems().some((e=>"space_permission"===e.type&&(0,c().lg)(e.role)))}),[S]),I=(0,o().K8)((()=>{if(n)return n.getName()}),[n]),k=(0,o().K8)((()=>{if(n)return n.getIcon()}),[n]),j=(0,o().K8)((()=>{if(!n||!S.isDefined())return[];const e=S.getPermissionItems(),t=new Set;return e.forEach((e=>{"user_permission"===e.type&&e.user_id&&(0,c().lg)(e.role)&&t.add(e.user_id)})),Array.from(t).map((e=>s().L.createChildStore(n,{table:u().oo,id:e,spaceId:n.id})))}),[n,S]),T=(0,o().K8)((()=>function(e){if(!e.isDefined())return[];const t=new Set;for(const a of e.getPermissionItems())"group_permission"===a.type&&(0,c().lg)(a.role)&&t.add(a.group_id);const n=[];for(const a of t){const e=b().h.getGroupData(a);e&&n.push(e)}return n}(S)),[S]),A=(0,a.useMemo)((()=>{const e=j.map((e=>({type:"user",userStore:e}))),t=T.map((e=>({type:"group",group:e})));return e.concat(t)}),[j,T]),_=(0,a.useMemo)((()=>A.slice(0,3)),[A]),B=e=>{switch(e.type){case"user":return(0,x.jsx)("div",{style:D.avatarDropdownWrapper,children:(0,x.jsx)(v().A,{userStore:e.userStore,avatarSize:18,style:{flexGrow:1},hasPersonHoverCard:!1})},`${e.userStore.id}--tooltip`);case"group":return(0,x.jsx)("div",{style:D.avatarDropdownWrapper,children:(0,x.jsx)(f().o,{group:e.group.group,size:18})},`${e.group.group.getGroupId()}--tooltip`);default:return null}},P=e=>{switch(e.type){case"user":return(0,x.jsx)(y().A,{userStore:e.userStore,size:18},e.userStore.id);case"group":return(0,x.jsx)(f().o,{group:e.group.group,size:18},e.group.group.getGroupId());default:return null}},D=(0,i().IS)((()=>({container:{display:"flex",gap:6,flexDirection:"row",alignItems:"center",color:p().Tj.text.secondary,minHeight:20,paddingInline:12,minWidth:0,flexShrink:1,overflow:"hidden"},avatarsContainer:{marginInlineStart:8,display:"flex",flexDirection:"row-reverse"},avatarWrapper:{marginInlineStart:-8},avatarDropdownWrapper:{display:"flex",alignContent:"flex-end",minWidth:140,width:"100%",marginTop:4,marginBottom:4},label:{fontSize:12},workspaceIconContainer:{display:"flex",alignItems:"center",marginInlineEnd:2}})),[]);return C?null:M&&I?(0,x.jsxs)("div",{style:D.container,children:[k?(0,x.jsx)("div",{style:D.workspaceIconContainer,children:(0,x.jsx)(m().B6,{icon:k,size:18,disabled:!0,isEmptyPage:!1})}):void 0,(0,x.jsx)(l().j,{style:D.label,children:"chat"===t?(0,x.jsx)(g().sA,{id:"AgentPage.everyoneAtWorkspaceCanViewChats",defaultMessage:"Everyone at {workspace} can view chats",values:{workspace:I}}):"activity"===t?(0,x.jsx)(g().sA,{id:"AgentPage.everyoneAtWorkspaceCanViewActivity",defaultMessage:"Everyone at {workspace} can view activity",values:{workspace:I}}):(0,h().HB)(t)})]}):(0,x.jsxs)("div",{style:D.container,children:[(0,x.jsx)(d().m,{placement:"bottom",renderTooltip:()=>A.map(B),render:e=>(0,x.jsx)("div",{style:D.avatarsContainer,...e,children:_.map((e=>(0,x.jsx)("div",{style:D.avatarWrapper,children:P(e)},"user"===e.type?e.userStore.id:e.group.group.getGroupId())))})}),(0,x.jsx)(l().j,{style:D.label,children:"chat"===t?(0,x.jsx)(g().sA,{id:"AgentPage.editorsCanViewChats",defaultMessage:"Editors can view chats"}):"activity"===t?(0,x.jsx)(g().sA,{id:"AgentPage.editorsCanViewActivity",defaultMessage:"Editors can view activity"}):(0,h().HB)(t)})]})}},245281:(e,t,n)=>{n.d(t,{n:()=>u});n(898992),n(354520);var a=n(296540),r=()=>n(590526),o=()=>n(395797),i=()=>n(770160),s=()=>n(244828),l=()=>n(140992),d=()=>n(865454),c=()=>n(791256);function u(e){const{environment:t,clientStore:n}=e,u=(0,i().useThreadStoreFromCurrentRoute)(),g=e.threadStore??u,p=(0,l().Cx)({providedThreadStore:g}),h=(0,r().K8)((()=>{if(!p)return[];return(0,c().A3)({threadStore:g,clientStore:n}).steps.filter((e=>"agent-tool-result"===e.type)).filter((e=>!(0,o().nP)(e)&&e.threadOperations&&e.threadOperations.length>0&&"delete-pages"!==e.toolName&&"runScript"!==e.toolName&&!e.error))}),[g,n,p]);(0,a.useEffect)((()=>{const e=(0,d().getAgentPreviewWrapper)(t);0!==h.length?e.enter({environment:t,steps:h,transactionActions:s(),applyOperation:(n,a)=>{(0,l().Hp)({environment:t,operation:a,recordCache:e.getInMemoryRecordCache(),transaction:n})}}):e.exit(t)}),[t,h,g]),(0,a.useEffect)((()=>()=>{(0,d().getAgentPreviewWrapper)(t).exit(t)}),[t])}},259803:(e,t,n)=>{n.r(t),n.d(t,{AgentThreadHistoryMenu:()=>_});n(944114),n(898992),n(803949),n(581454);var a=n(296540),r=()=>n(59226),o=()=>n(484714),i=()=>n(590526),s=()=>n(401497),l=()=>n(463086),d=()=>n(807449),c=()=>n(98126),u=()=>n(546926),g=()=>n(663639),p=()=>n(736847),h=()=>n(340498),m=()=>n(234459),f=()=>n(69708),v=()=>n(596120);n(737550),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698);class y extends(()=>n(769985))().u{constructor(){super({getInitialState:()=>({completedThreads:new Set,userStartedThreads:new Set,threadInferenceIds:new Map,threadInferenceLeaseExpirations:new Map,currentThreadId:void 0}),effect:()=>(this.startMonitoring(),()=>{this.stopMonitoring()}),debugName:"ThreadGeneratingIndicatorStore"}),this.monitoringInterval=null,this.transcripts=void 0}startMonitoring(){this.monitoringInterval||(this.checkForCompletions(),this.monitoringInterval=setInterval((()=>{this.checkForCompletions()}),1e3))}stopMonitoring(){this.monitoringInterval&&(clearInterval(this.monitoringInterval),this.monitoringInterval=null)}checkForCompletions(){n(17022).e.withListenerIgnored((()=>{const e=(0,n(755531).S)();if(!e||!this.transcripts)return;const t=new Map,a=new Map,r=new Set(this.state.userStartedThreads);this.transcripts.forEach((n=>{const o=l().E.createChildStore(e,{table:m().To,id:n.id,spaceId:e.id}),i=o.getCurrentInferenceId(),s=o.getCurrentInferenceLeaseExpiration();t.set(n.id,i),a.set(n.id,s??void 0);const d=this.state.threadInferenceIds.get(n.id);void 0!==i&&void 0===d&&r.add(n.id),void 0!==d&&void 0===i&&this.markThreadCompleted(n.id)})),this.setState({...this.state,threadInferenceIds:t,threadInferenceLeaseExpirations:a,userStartedThreads:r})}))}setMonitoringData(e){this.transcripts=e,this.monitoringInterval&&this.checkForCompletions()}markThreadCompleted(e){if(this.state.userStartedThreads.has(e)&&e!==this.state.currentThreadId){const t=new Set(this.state.completedThreads);t.add(e),this.setState({...this.state,completedThreads:t})}}markThreadVisited(e){const t=new Set(this.state.completedThreads);t.delete(e),this.setState({...this.state,completedThreads:t})}setCurrentThreadId(e){const t=new Set(this.state.completedThreads);e&&t.delete(e),this.setState({...this.state,currentThreadId:e,completedThreads:t})}isThreadGenerating(e){if(void 0===this.state.threadInferenceIds.get(e))return!1;const t=this.state.threadInferenceLeaseExpirations.get(e);return void 0!==t&&Date.now()<t}hasThreadCompleted(e){return this.state.completedThreads.has(e)}getCompletedThreadIds(){return Array.from(this.state.completedThreads)}}const b=new y;(0,n(852832).exposeDebugValue)("threadGeneratingIndicatorStore",b);var x=()=>n(756117),S=()=>n(717895),w=n(474848);function C(){const e=(0,s().IS)((()=>({container:{display:"inline-flex",alignItems:"center"}})),[]);return(0,w.jsx)(x().A,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},config:{duration:300,timingFunction:"ease-out"},style:e.container,children:(0,w.jsx)(d().I,{icon:S().K,colorVariant:"accentPrimary",colorPalette:"blue"})})}var M=()=>n(94701),I=()=>n(781317);const k=14;function j(e){const{chatItem:t,isThreadGenerating:n,isCurrentThread:a,isNotCurrentThreadAndHasFinishedGenerating:o}=e,l=(0,s().IS)((()=>({scrollingSquiggle:{width:k,height:k*(16/24),opacity:"0.4",transform:"scale(1.5)"},dotIcon:{transform:"scale(2)"}})),[]),c=(0,r().X)("agent_conversation_list_generation_status");switch((0,i().K8)((()=>"thread"!==t.type?"none":a(t.id)?"isCurrentThread":c?n(t.id)?"threadGenerating":o(t.id)?"threadCompleted":"none":"none"),[t.id,t.type,n,a,o,c])){case"isCurrentThread":return(0,w.jsx)(d().I,{icon:M().checkmarkFillIcon,size:"xs"});case"threadGenerating":return(0,w.jsx)(I().ScrollingSquiggle,{style:l.scrollingSquiggle});case"threadCompleted":return(0,w.jsx)(d().I,{icon:S().K,colorVariant:"accentPrimary",colorPalette:"blue",size:"xs",style:l.dotIcon});default:return null}}const T=(0,f().YK)({new_chat_title:{id:"WorkflowEditorTranscript.historyDropdown.newChatTitle",defaultMessage:"New AI chat"},previousChats:{id:"AgentThreadHistoryMenu.previousChats",defaultMessage:"Previous chats"}});function A(e){const{buttonShape:t="roundrect",workflowId:y,onThreadChange:x,parentStore:S,threadStore:M,threadStoreState:I,types:k,aiChatFeatureController:A}=e,_=(0,f().tz)(),B=(0,o().v3)(),P=(0,o().Y0)(),D=(0,n(106702).$)(),R=(0,r().X)("agent_conversation_list_generation_status"),E=(0,i().K8)((()=>{var e;if("new"===I)return _.formatMessage(T.new_chat_title);const t=null==M||null===(e=M.getData())||void 0===e?void 0:e.title;return t||_.formatMessage(T.new_chat_title)}),[_,M,I]),F="pill"===t,W=(0,i().K8)((()=>(0,n(299545).Yu)(S)?S:(0,n(135168).f)(S)),[S]),{status:L,value:K,isLoadingMore:N,loadMore:V,hasMore:z}=(0,n(918052).s)({parentStore:S,threadStore:M,workflowId:y,enableInfiniteScroll:!0,pageSize:50,userId:null==D?void 0:D.id,types:k}),H=(0,i().K8)((()=>{if(null!=M&&M.id)return M.id}),[M]),O=function(e){const{transcripts:t,currentSessionId:n}=e;return(0,a.useEffect)((()=>{b.setMonitoringData(t)}),[t]),(0,a.useEffect)((()=>{b.setCurrentThreadId(n)}),[n]),{isThreadGenerating:(0,i().K8)((()=>e=>b.isThreadGenerating(e)),[]),isCurrentThread:(0,a.useCallback)((e=>n===e),[n]),hasThreadCompletedAndIsNotCurrent:(0,i().K8)((()=>e=>Boolean(n&&n!==e&&b.hasThreadCompleted(e))),[n]),areAnyThreadsCompletedAndNotCurrent:(0,i().K8)((()=>!!n&&b.getCompletedThreadIds().some((e=>e!==n))),[n])}}({transcripts:K,currentSessionId:H}),q=(0,s().IS)((()=>({chevronDownIcon:{width:Boolean(null==A?void 0:A.supportsTallChatHeader)?h().lD.sm:h().Ev.sm,height:Boolean(null==A?void 0:A.supportsTallChatHeader)?h().lD.sm:h().Ev.sm,marginInlineStart:O.areAnyThreadsCompletedAndNotCurrent?0:6,flexShrink:0},loadingStateContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",gap:8,padding:32},clockIcon:{opacity:.2},threadTitleButton:{flexShrink:1,...F?{borderRadius:50,paddingInline:8}:{paddingInline:6}},threadTitleInDropdown:{maxWidth:"250px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",flexShrink:1}})),[F,null==A?void 0:A.supportsTallChatHeader,O.areAnyThreadsCompletedAndNotCurrent]),U=(0,a.useCallback)((()=>(0,w.jsx)("div",{style:q.loadingStateContainer,children:(0,w.jsx)(c().A,{})})),[q.loadingStateContainer]),G=(0,a.useCallback)((()=>(0,w.jsx)("div",{style:q.loadingStateContainer,children:(0,w.jsx)(d().I,{icon:n(274570).clockIcon,size:24,style:q.clockIcon})})),[q.loadingStateContainer,q.clockIcon]),Y=(0,a.useCallback)((e=>{if("pending"===L)return[{key:"loading",render:e=>(0,w.jsx)(p().A,{...e,title:_.formatMessage(T.previousChats),shouldShowBottomDivider:!1,extraPadding:!0,topBorder:!1}),items:[{key:"loading-item",action:()=>{},render:()=>(0,w.jsx)(U,{})}]}];const t=[];if(K&&K.forEach((e=>{t.push({id:e.id,title:e.title||_.formatMessage(T.new_chat_title),createdTime:new Date(e.created_at).getTime(),updatedTime:e.updated_at?new Date(e.updated_at).getTime():void 0,type:"thread",threadType:e.type})})),t.sort(((e,t)=>(0,v().X)(e,t))),0===t.length)return[{key:"empty",render:e=>(0,w.jsx)(p().A,{...e,title:_.formatMessage(T.previousChats),extraPadding:!0,topBorder:!1}),items:[{key:"empty-item",action:()=>{},render:()=>(0,w.jsx)(G,{})}]}];const a=[];let r=!0;const o=t.reduce(((e,t)=>{const n=(0,v().m)({createdTime:t.createdTime,updatedTime:t.updatedTime}),a=new Date(n),r=new Date;r.setHours(0,0,0,0);const o=new Date(r);o.setDate(o.getDate()-1);const i=new Date(r);i.setDate(i.getDate()-7);const s=new Date(r);let l;return s.setDate(s.getDate()-30),l=a>=r?"today":a>=o?"yesterday":a>=i?"previous7days":a>=s?"previous30days":"older",e[l]||(e[l]=[]),e[l].push(t),e}),{});return[{key:"today",label:_.formatMessage({id:"aiInferenceTranscript.today",defaultMessage:"Today"})},{key:"yesterday",label:_.formatMessage({id:"aiInferenceTranscript.yesterday",defaultMessage:"Yesterday"})},{key:"previous7days",label:_.formatMessage({id:"aiInferenceTranscript.previous7days",defaultMessage:"Previous 7 days"})},{key:"previous30days",label:_.formatMessage({id:"aiInferenceTranscript.previous30days",defaultMessage:"Previous 30 days"})},{key:"older",label:_.formatMessage({id:"aiInferenceTranscript.older",defaultMessage:"Older"})}].forEach((({key:t,label:i})=>{const s=o[t];if(null==s||!s.length)return;const d=!r;r=!1,a.push({key:`history-${t}`,render:e=>(0,w.jsx)(p().A,{...e,title:i,topBorder:d,extraPadding:!0}),items:s.map((t=>({key:t.id,action:()=>{if(W&&"thread"===t.type){b.markThreadVisited(t.id),n(944584).trackAgentChatHistoryItemClicked({environment:B,threadId:t.id,from:"agent_chat"});const a=l().E.createChildStore(W,{table:m().To,id:t.id,spaceId:W.id});"workflow"===t.threadType||(0,n(720665).pN)(t.threadType)||P.isPhone?(x({newThreadStore:a}),e.close()):(0,n(36951).VK)({environment:B,oldThreadStore:void 0,newThreadStore:a})}},render:e=>{const a="string"==typeof t.title?t.title:_.formatMessage(T.new_chat_title);return(0,w.jsx)(n(81068).A,{...e,title:a,right:(0,w.jsx)(j,{chatItem:t,isThreadGenerating:O.isThreadGenerating,isCurrentThread:O.isCurrentThread,isNotCurrentThreadAndHasFinishedGenerating:O.hasThreadCompletedAndIsNotCurrent})})}})))})})),a}),[L,K,W,U,G,x,_,B,P.isPhone,O]),$=(0,a.useCallback)((()=>{V&&z&&!N&&V()}),[V,z,N]),X=(0,a.useCallback)((()=>{(0,n(440024).I)({environment:B})}),[B]);return E?(0,w.jsx)(n(250910).A,{popupType:(null==A?void 0:A.adaptiveMenuPopupType)??n(30537).n.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",bottomSheetDisableDrag:!1,renderOrigin:e=>(0,w.jsxs)(n(631524).p,{"aria-label":"history",...e,onClick:t=>{var n;X(),null===(n=e.onClick)||void 0===n||n.call(e,t)},size:"md",style:q.threadTitleButton,children:[(0,w.jsx)(n(493552).D,{styleKey:"bodyRegular",style:q.threadTitleInDropdown,children:E}),R&&O.areAnyThreadsCompletedAndNotCurrent?(0,w.jsx)(C,{}):void 0,(0,w.jsx)(d().I,{icon:n(324254).arrowChevronSingleDownSmallIcon,style:q.chevronDownIcon,size:"sm",colorVariant:"secondary"})]}),render:e=>(0,w.jsxs)(n(890492).A,{menuType:(null==A?void 0:A.adaptiveMenuType)??u().gu.Popup,hideMobileTopbar:!0,width:(null==A?void 0:A.adaptiveMenuType)===u().gu.Modal?void 0:300,children:[(0,w.jsx)(g().A,{type:g().O.Vertical,initialFocus:void 0,sections:Y(e)}),N?(0,w.jsx)("div",{style:q.loadingStateContainer,children:(0,w.jsx)(c().k,{size:"default"})}):void 0,(0,w.jsx)(n(696060).A,{onLoadMore:$,loading:Boolean(N),loadMoreOffsetThreshold:100})]})}):null}const _=(0,a.memo)(A,((e,t)=>e.workflowId===t.workflowId&&e.parentStore===t.parentStore&&e.threadStore===t.threadStore&&e.threadStoreState===t.threadStoreState&&e.buttonShape===t.buttonShape&&(0,n(821062).A)(e.types??[],t.types??[])))},260224:(e,t,n)=>{n.d(t,{g:()=>m});var a=n(296540),r=()=>n(590526),o=()=>n(401497),i=()=>n(758256),s=()=>n(69708),l=()=>n(751735),d=()=>n(496603),c=()=>n(383594),u=()=>n(326496),g=()=>n(687879),p=n(474848);const h=(0,s().YK)({agentCover:{defaultMessage:"Agent cover",id:"agentCover.title"},fileTypeCaption:{defaultMessage:"Images wider than 1500 pixels work best.",id:"agentCover.fileType.caption"},uploadFailed:{defaultMessage:"Upload failed",id:"agentCover.errorDialogMessage.uploadFailed"},embedTitle:{defaultMessage:"Link",id:"agentCover.embedType.title"},embedPlaceholder:{defaultMessage:"Paste an image link",id:"agentCover.embedType.placeholder"},embedCaption:{defaultMessage:"Works with any image from the web.",id:"agentCover.embedType.caption"},embedSubmit:{defaultMessage:"Submit",id:"agentCover.embedType.buttonText"},actionBarAriaLabel:{defaultMessage:"Agent cover action bar",id:"agentCover.actionBar.ariaLabel"},changeAriaLabel:{defaultMessage:"Change the agent cover image",id:"agentCover.changeCover.ariaLabel"},repositionAriaLabel:{defaultMessage:"Reposition the agent cover image",id:"agentCover.repositionAriaLabel"},savePositionAriaLabel:{defaultMessage:"Save the position of the agent cover image",id:"agentCover.savePositionAriaLabel"},cancelPositionAriaLabel:{defaultMessage:"Cancel the position change of the agent cover image",id:"agentCover.cancelPositionAriaLabel"}}),m=a.memo((function(e){const{workflowStore:t,disabled:m}=e,{workflowValue:f}=(0,n(912749).N)(t,!0),v=(0,n(484714).v3)(),y=(0,s().tz)(),b=(0,o().eP)(),x=(0,a.useRef)(null),[S,w]=(0,a.useState)(!1),{cover:C,icon:M,cover_position:I}=f,k=(0,r().K8)((()=>n(969141).A.state.isActive),[]),j=(0,r().K8)((()=>(0,n(613735).b)({icon:M,themeMode:b})),[M,b]),{isRepositioning:T,currentImagePosition:A,handleDragStart:_,handleDragMove:B,handleDragEnd:P,handleStartReposition:D,handleSavePosition:R,handleCancelReposition:E,repositioningCursor:F}=(0,n(780863).p)({currentPosition:I??.5,imageUrl:C,onSavePosition:e=>{t.table===i().U6||m||g().saveCoverPosition({workflowStore:t,coverPosition:e,environment:v})},rootRef:x,environment:v}),W=(0,a.useMemo)((()=>(0,d().nF)((()=>{w(!0)}),100)),[]),L=(0,a.useMemo)((()=>(0,d().sg)((()=>{w(!1)}),100)),[]),K=(0,a.useCallback)((e=>{t.table===i().U6||m||c().W(v,{originGap:8,originRect:e.currentTarget.getBoundingClientRect(),isSmallWidth:!1,popupWidth:540,maxHeight:485,title:y.formatMessage(h.agentCover),onDelete:()=>{c().I(),g().saveCover({workflowStore:t,cover:void 0,environment:v})},currentTab:"gallery",tabs:[{type:"gallery",onChange:({url:e})=>{g().saveCover({workflowStore:t,cover:e,environment:v})}},{type:"file",fileUpload:!1,imageUpload:!0,videoUpload:!1,caption:y.formatMessage(h.fileTypeCaption),onUpload:e=>{c().I(),n(222138).Zn({environment:v,files:[e[0]],bucket:"temporary",onBatchComplete:e=>{const n=e[0];n&&g().saveCover({workflowStore:t,cover:n,environment:v})},onBatchError:e=>{n(792057).f1(y.formatMessage(h.uploadFailed))}})}},{type:"embed",title:y.formatMessage(h.embedTitle),inputPlaceholder:y.formatMessage(h.embedPlaceholder),caption:y.formatMessage(h.embedCaption),buttonText:y.formatMessage(h.embedSubmit),onChange:e=>{g().saveCover({workflowStore:t,cover:e.originUrl,environment:v}),c().I()}},{type:"unsplash",onChange:({url:e})=>{g().saveCover({workflowStore:t,cover:e,environment:v})}}]})}),[t,v,y,m]),N=(0,a.useCallback)((()=>{t.table===i().U6||m||R()}),[t,m,R]),V=(0,o().IS)((()=>({cover:{height:"min(20vh, 280px)",width:"100%",position:"relative",cursor:F,userSelect:T?"none":"inherit",...C?{backgroundImage:`url(${C})`,backgroundSize:"cover",backgroundPosition:`center ${100*(1-A)}%`,backgroundRepeat:"no-repeat"}:{backgroundColor:(0,l().X4)(j||(0,n(536504).hI)("gray"),.1)}},actionBar:{position:"absolute",top:12,insetInlineEnd:12}})),[C,A,T,j,F]);return(0,p.jsxs)("div",{ref:x,style:V.cover,onMouseEnter:W,onMouseLeave:L,children:[(0,p.jsx)(n(222321).A,{onDraggableDragStart:_,onDraggableDragMove:B,onDraggableDragEnd:P,onDraggableDragCancel:P,disabled:!T,render:e=>(0,p.jsx)("div",{...e,style:{width:"100%",height:"100%"}})}),m?void 0:(0,p.jsx)(n(893497).L,{style:V.actionBar,visible:S||T||k,children:(0,p.jsx)(n(53436).E,{"aria-label":y.formatMessage(h.actionBarAriaLabel),children:T?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(u().e,{"aria-label":y.formatMessage(h.savePositionAriaLabel),onClick:N,children:(0,p.jsx)(s().sA,{defaultMessage:"Save position",id:"agentCover.savePosition.button"})}),(0,p.jsx)(u().e,{"aria-label":y.formatMessage(h.cancelPositionAriaLabel),onClick:E,children:(0,p.jsx)(s().sA,{defaultMessage:"Cancel",id:"agentCover.cancelPosition.button"})})]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(u().e,{"aria-label":y.formatMessage(h.changeAriaLabel),onClick:K,children:C?(0,p.jsx)(s().sA,{defaultMessage:"Change cover",id:"workflowAgentHeader.changeCover.button"}):(0,p.jsx)(s().sA,{defaultMessage:"Add cover",id:"workflowAgentHeader.addCover.button"})}),C?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(n(724015).b,{}),(0,p.jsx)(u().e,{"aria-label":y.formatMessage(h.repositionAriaLabel),onClick:()=>D(C),children:(0,p.jsx)(s().sA,{defaultMessage:"Reposition",id:"agentCover.reposition.button"})})]}):void 0]})})}),T?(0,p.jsx)("div",{style:{position:"absolute",top:"calc(50% - 10px)",insetInlineStart:"calc(50% - 90px)",width:180,padding:"0.3em 1.5em 0.3em",background:(0,l().X4)("#000",.4),borderRadius:4,color:"white",fontSize:12,textAlign:"center",pointerEvents:"none"},children:(0,p.jsx)(s().sA,{defaultMessage:"Drag image to reposition",id:"workflowAgentCover.dragImage.text"})}):void 0]})}))},263943:(e,t,n)=>{n.d(t,{iT:()=>h,iZ:()=>p,rs:()=>m,t1:()=>f});n(944114),n(581454);var a=n(296540),r=()=>n(59226),o=()=>n(248140),i=()=>n(420802),s=()=>n(546926),l=()=>n(890492),d=()=>n(81068),c=()=>n(663639),u=()=>n(736847),g=n(474848);const p={id:"slippery_slope_full_screen_sidebar",label:"Toggle sidebar to full width"},h={id:"slippery_slope_recents_with_chats",label:"Recents include chats"};function m(){const e=(0,r().X)(p.id),t=(0,r().X)(h.id);return a.useMemo((()=>[{...p,isEnabled:e},{...h,isEnabled:t}]),[e,t])}function f({featureFlagStates:e}){const t=(0,a.useCallback)((e=>{o().A.updateLocalOverrideGate(e.id,!e.isEnabled)}),[]);if(0===e.length)return null;const n=[];return n.push({key:"other",render:e=>(0,g.jsx)(u().A,{...e,title:"Other"}),items:e.map((e=>({key:e.id,render:(t,n)=>(0,g.jsx)(d().A,{...t,role:"menuitemcheckbox",title:e.label,right:(0,g.jsx)(i().S,{checked:e.isEnabled,size:16,disallowTabbing:!0,onClick:e=>{e.preventDefault(),e.stopPropagation(),t.onClick(e)}}),dontShrinkRight:!0}),action:()=>{t(e)}})))}),(0,g.jsx)(l().A,{menuType:s().gu.Popup,width:280,children:(0,g.jsx)(c().A,{type:c().O.Vertical,initialFocus:void 0,sections:n})})}},293821:(e,t,n)=>{n.d(t,{C:()=>a});const a=(0,n(340498).xh)("magnifyingGlass",{default:{loader:()=>n.e(42022).then(n.bind(n,207207))},small:{loader:()=>n.e(42022).then(n.bind(n,344417))},fill:{loader:()=>n.e(42022).then(n.bind(n,454803))},fillSmall:{loader:()=>n.e(42022).then(n.bind(n,555082))}},["magnifying","glass","search","zoom","explore"])},297875:(e,t,n)=>{n.r(t),n.d(t,{ChatSidebarModeButton:()=>F,ChatSidebarModeButtonPopupContents:()=>W,getChatSidebarModeOptions:()=>L});n(944114),n(581454);var a=n(296540),r=()=>n(920198),o=()=>n(59226),i=()=>n(726637),s=()=>n(484714),l=()=>n(590526),d=()=>n(127833),c=()=>n(250910),u=()=>n(807449),g=()=>n(695115),p=()=>n(546926),h=()=>n(26697),m=()=>n(890492),f=()=>n(81068),v=()=>n(663639),y=()=>n(736847),b=()=>n(419942),x=()=>n(69708),S=()=>n(496603),w=()=>n(36951),C=()=>n(463916),M=()=>n(703748),I=()=>n(770160),k=()=>n(675133),j=()=>n(258522),T=()=>n(177256),A=()=>n(534177);const _=(0,x().YK)({sidebar:{defaultMessage:"Sidebar",id:"chatSidebar.mode.sidebar"},popup:{defaultMessage:"Floating",id:"chatSidebar.mode.popup"},full:{defaultMessage:"Full",id:"chatSidebar.mode.full"}});function B(e){switch(e){case"sidebar":return k().A.formatMessage(_.sidebar);case"popup":return k().A.formatMessage(_.popup);case"full":return k().A.formatMessage(_.full);default:(0,A().HB)(e)}}function P(e){switch(e){case"sidebar":return T().A;case"popup":case"full":return j().q;default:(0,A().HB)(e)}}var D=()=>n(981475),R=n(474848);const E=(0,x().YK)({switchMode:{id:"chatSidebar.switchMode.button",defaultMessage:"Switch chat mode"},fullscreen:{id:"chatSidebar.fullscreen.button",defaultMessage:"Full screen"}});function F(e){const{aiChatFeatureController:t}=e,n=(0,x().tz)(),a=(0,l().K8)((()=>D().globalChatPanelRuntimeStore.state.chatPanelMode),[]),r=L(),o=(0,C().useIconButtonStyles)({shape:t.headerButtonShape,aiChatFeatureController:t});return t.supportsChatSidebarModes?(0,R.jsx)(c().A,{popupType:d().nl.Popup,alignmentToOrigin:"center",placementToOrigin:"bottom",style:{minWidth:190},originGap:0,renderOrigin:e=>(0,R.jsx)(h().m,{renderTooltip:()=>(0,R.jsx)(x().sA,{...E.switchMode}),render:t=>(0,R.jsx)(g().A,{...e,...t,icon:()=>(0,R.jsx)(u().I,{icon:P(a)}),style:o.iconButton,ariaLabel:n.formatMessage(E.switchMode),testId:"switch-chat-mode-button"})}),render:e=>(0,R.jsx)(W,{parent:e,options:r})}):null}function W(e){const{options:t,parent:n,onSelectMode:d}=e,c=(0,s().v3)(),g=(0,r().L)(),h=(0,l().K8)((()=>D().globalChatPanelRuntimeStore.state.chatPanelMode),[]);let C;C=i().A.isMobile?{menuType:p().gu.ActionSheet}:{menuType:p().gu.Popup,width:220};const k=(0,a.useCallback)((e=>{(0,M().setChatPanelMode)({environment:c,chatPanelMode:e,trackAnalytics:!0,saveUserPreference:!0}),n.close(),requestAnimationFrame((()=>{null==d||d(e)}))}),[n,d,c]),j=(0,x().tz)(),T=(0,o().X)("agent_popup_fs"),A=(0,l().K8)((()=>t.map(((e,t)=>{const n=e.key,a={key:t,render:t=>(0,R.jsx)(f().A,{...t,disabled:!1,title:e.title,icon:e.icon,isChecked:(0,S().n4)(e.key,h)}),action:()=>k(n)};return a}))),[t,h,k]),_=(0,l().K8)((()=>{const e=(0,I().getChatPanelState)(c),t=g&&e?(0,I().threadStoreGivenRouteData)({spaceStore:g,chatPanelState:e}):void 0;return{key:0,render:e=>(0,R.jsx)(f().A,{...e,disabled:!1,title:j.formatMessage(E.fullscreen),icon:(0,R.jsx)(u().I,{icon:b().o}),isChecked:!1}),action:()=>{(0,w().VK)({environment:c,oldThreadStore:t,newThreadStore:t}),n.close()}}}),[j,n,c,g]),B=(0,a.useMemo)((()=>{const e=[{key:"panel",render:e=>(0,R.jsx)(y().A,{enableActionSheetTitle:!0,...e}),items:A}];return T&&e.push({key:"fullscreen",render:e=>(0,R.jsx)(y().A,{topBorder:!0,...e}),items:[_]}),e}),[T,A,_]);return(0,R.jsx)(m().A,{...C,children:(0,R.jsx)(v().A,{type:v().O.Vertical,sections:B,initialFocus:0})})}function L(){return["sidebar","popup"].map((e=>({key:e,type:"button",title:B(e),icon:(0,R.jsx)(u().I,{icon:P(e)})})))}},301948:(e,t,n)=>{n.d(t,{A:()=>i});n(296540);var a=()=>n(970236),r=()=>n(69708),o=n(474848);function i(e){return(0,o.jsx)(a().E,{color:"blue",style:e.style,content:(0,o.jsx)(r().sA,{id:"AlphaBadgeComponent.label",defaultMessage:"Alpha"})})}},323756:(e,t,n)=>{n.d(t,{E:()=>d});var a=n(296540),r=()=>n(933922),o=()=>n(484714),i=()=>n(755125),s=()=>n(31511),l=n(474848);function d(e){const{placeholder:t,value:n,onChange:d,onKeyDown:c,onFocus:u,onBlur:g,inputStyle:p,disabled:h,debugName:m,autosizeMinHeight:f,inputClassName:v}=e,y=(0,o().v3)(),[b,x]=(0,a.useState)(!1),S=(0,a.useCallback)((()=>{x(!0),(0,i().clear)({environment:y}),null==u||u()}),[y,u]),w=(0,a.useCallback)((()=>{x(!1),null==g||g()}),[g]),C=(0,a.useCallback)((e=>{"Enter"!==e.key?null==c||c(e):e.preventDefault()}),[c]);return(0,l.jsx)(r().A,{capture:b,debugName:m,render:e=>(0,l.jsx)(s().A,{...e,inputClassName:v,placeholder:t,value:n,onChange:d,onKeyDown:C,onFocus:S,onBlur:w,style:p,format:"transparent",disabled:h,spellCheck:!1,textarea:!0,autosize:!0,autosizeMinHeight:f})})}},342407:(e,t,n)=>{n.d(t,{t:()=>h});n(296540);var a=()=>n(401497),r=()=>n(807449),o=()=>n(695115),i=()=>n(406094),s=()=>n(493552),l=()=>n(107023),d=()=>n(70899),c=()=>n(609616),u=()=>n(69708),g=()=>n(100622),p=n(474848);function h(){const e=(0,u().tz)(),t=(0,a().IS)((()=>({container:{paddingBottom:12,opacity:.8,pointerEvents:"none",width:"100%"},box:{borderRadius:16,backgroundColor:g().Tj.gray.background.primary,boxShadow:g().Tj.shadow.outline.sm,paddingTop:4,paddingInline:8,paddingBottom:8,display:"flex",flexDirection:"column",gap:8},topRow:{display:"flex",alignItems:"center",gap:4},addContextButtonWrapper:{backgroundColor:g().Tj.white,borderRadius:50,display:"inline-flex"},addContextButton:{borderRadius:50,fontSize:12,fontWeight:400,height:28,padding:"2px 8px 2px 3px",display:"flex",alignItems:"center",gap:4},iconArea:{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20,flexShrink:0},centerArea:{display:"flex",alignItems:"center",justifyContent:"center",flexGrow:1,textAlign:"center",padding:"12px 0"},bottomRow:{display:"flex",alignItems:"center",justifyContent:"space-between"},attachButton:{width:28,height:28,borderRadius:"50%"},sendButton:{width:28,height:28,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:30,backgroundColor:g().Tj.icon.secondary},sendIcon:{fill:g().Tj.text.inversePrimary}})),[]);return(0,p.jsx)("div",{style:t.container,children:(0,p.jsxs)("div",{style:t.box,children:[(0,p.jsx)("div",{style:t.topRow,children:(0,p.jsx)("div",{style:t.addContextButtonWrapper,children:(0,p.jsxs)(i().A,{style:t.addContextButton,disabled:!0,children:[(0,p.jsx)("div",{style:t.iconArea,children:(0,p.jsx)(r().I,{icon:d().U,size:"sm",colorVariant:"secondary"})}),(0,p.jsx)(s().D,{styleKey:"captionRegular",colorVariant:"secondary",children:(0,p.jsx)(u().sA,{defaultMessage:"Add context",id:"workflows.disabledAgentChatState.addContext"})})]})})}),(0,p.jsx)("div",{style:t.centerArea,children:(0,p.jsx)(s().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,p.jsx)(u().sA,{defaultMessage:"This agent has been disabled. Chat is not available",id:"workflows.disabledAgentChatState.disabledMessage"})})}),(0,p.jsxs)("div",{style:t.bottomRow,children:[(0,p.jsx)(o().A,{icon:c().o,colorPalette:"gray",colorVariant:"tertiary",disabled:!0,size:"md",style:t.attachButton,ariaLabel:e.formatMessage({id:"workflows.disabledAgentChatState.attachButton",defaultMessage:"Attach file"})}),(0,p.jsx)("div",{style:t.sendButton,children:(0,p.jsx)(r().I,{icon:l().arrowStraightUpFillSmallIcon,size:"sm",style:t.sendIcon})})]})]})})}},391435:(e,t,n)=>{n.d(t,{Z:()=>j});n(944114),n(898992),n(354520),n(581454);var a=n(296540),r=()=>n(564884),o=()=>n(59226),i=()=>n(726637),s=()=>n(484714),l=()=>n(401497),d=()=>n(265060),c=()=>n(546926),u=()=>n(890492),g=()=>n(81068),p=()=>n(449279),h=()=>n(663639),m=()=>n(736847),f=()=>n(293821),v=()=>n(644161),y=()=>n(185078),b=()=>n(69708),x=()=>n(100622),S=()=>n(778078),w=()=>n(419357),C=()=>n(662971),M=n(474848);const I=1,k=(0,b().YK)({sourceLanguage:{id:"translation.languageMenuList.sourceLanguage",defaultMessage:"From"},selectLanguage:{id:"translation.languageMenuList.selectLanguage",defaultMessage:"To"},detectedLanguage:{id:"translation.languageMenuList.detectedLanguage",defaultMessage:"Detected language"},preferredLanguage:{id:"translation.languageMenuList.preferredLanguage",defaultMessage:"Preferred language"},languageSearchPlaceholder:{id:"translation.languageMenuList.languageSearchPlaceholder",defaultMessage:"Search languages"}});function j(e){const{onSelectTargetLanguage:t,onSelectSourceLanguage:n,editorModeConfigTranslateState:o,sourceLanguage:i,detectedPageLanguage:d,preferredLanguage:c,subMenuPlacement:u,subMenuAlignment:p,pageId:f}=e,y=(0,s().v3)(),S=(0,b().tz)(),w="loading"===o.status,j=T(w),B=(0,l().IS)((()=>({menuItemSectionBottomBorder:{boxShadow:`${x().Tj.border.secondaryTranslucent} 0px 1px 0px`},...j})),[j]);(0,a.useEffect)((()=>{if("pre_activation"===o.status){const e=setTimeout((()=>{(0,r().u)({environment:y,event:{eventName:"translate_page_interaction",eventProperties:{type:"action_menu_rendered",page_id:f}}})}),750);return()=>clearTimeout(e)}}),[o.status,f,y]);const P=o.targetLanguage,D=_({disabled:w,filter:e=>i!==e,currentSelectedLanguage:o.targetLanguage,onSelectLanguage:e=>{t({targetLanguage:e})}});return(0,M.jsx)(h().A,{initialFocus:I,type:h().O.Vertical,disableInitialScroll:!0,sections:[{key:"sourceLanguage",render:e=>(0,M.jsx)(m().A,{...e,title:S.formatMessage(k.sourceLanguage),desktopTitleStyle:{marginInlineStart:2,marginInlineEnd:2},style:B.menuItemSectionBottomBorder}),items:[{key:i,render:(e,{onFocus:t})=>(0,M.jsx)(C().A,{...e,onFocus:t,disableDefaultClick:!0,placementToOrigin:u,alignmentToOrigin:p,renderOrigin:(e,t)=>(0,M.jsx)(g().A,{...e,disabled:w,buttonStyle:B.button,ref:t,title:S.formatMessage((0,v().Bj)(i)),caption:i===d?S.formatMessage(k.detectedLanguage):i===c?S.formatMessage(k.preferredLanguage):void 0}),renderExtension:e=>(0,M.jsx)(A,{disabled:w,extensionPopupButtonEvents:e,currentTargetLanguage:P,sourceLanguage:i,onSelectSourceLanguage:n})}),action:()=>{}}]},{key:"selectLanguage",render:e=>(0,M.jsx)(m().A,{...e,title:S.formatMessage(k.selectLanguage),desktopTitleStyle:{marginInlineStart:2,marginInlineEnd:2}}),items:D}]})}function T(e){return(0,l().IS)((()=>({button:{color:e?x().Tj.text.tertiary:x().Tj.text.primary}})),[e])}function A(e){const{extensionPopupButtonEvents:t,currentTargetLanguage:n,disabled:a,sourceLanguage:r,onSelectSourceLanguage:o}=e,s=_({disabled:a,filter:e=>e!==n,currentSelectedLanguage:r,onSelectLanguage:e=>{o({sourceLanguage:e})}}),l=i().A.isMobile?{menuType:c().gu.ActionSheet,...t}:{menuType:c().gu.Popup,width:200,height:380,...t};return(0,M.jsx)(u().A,{...l,onClick:e=>{e.preventDefault()},children:(0,M.jsx)(h().A,{initialFocus:void 0,type:h().O.Vertical,sections:[{key:"originalLanguage",render:e=>(0,M.jsx)(m().A,{...e}),items:s}]})})}function _(e){const{disabled:t,filter:n,currentSelectedLanguage:r,onSelectLanguage:i}=e,s=(0,b().tz)(),[l,c]=(0,a.useState)(""),u=T(t),h=(0,a.useMemo)((()=>({key:"language-search-input",render:e=>(0,M.jsx)(w().Ay,{...e,disabled:t,placeholder:s.formatMessage(k.languageSearchPlaceholder),value:l,onChange:e=>c(e.target.value),focus:!0,inputLeft:(0,M.jsx)(d().Q,{iconGroup:f().C,colorPalette:"gray",colorVariant:"accentPrimary",variantName:"default"})}),action:()=>{}})),[l,t,s]),m=(0,a.useMemo)((()=>({key:"no-results",render:()=>(0,M.jsx)(p().u,{title:(0,M.jsx)(b().sA,{defaultMessage:"No results found",id:"TranslationLanguageMenuList.noResults"})}),action:()=>{}})),[]),x=(0,o().X)("editor_basic_rtl"),C=(0,a.useMemo)((()=>(0,y().J6)({includeRtlLanguages:x})),[x]),I=(0,a.useMemo)((()=>{const e=[];for(const t of C)if(n(t)){const n=s.formatMessage((0,v().Bj)(t));e.push({languageCode:t,languageName:n})}return e.sort(((e,t)=>e.languageName.localeCompare(t.languageName)))}),[n,s,C]),j=(0,a.useMemo)((()=>(0,S().Ay)(l,I,(({languageName:e})=>e.toLowerCase()))),[l,I]),A=(0,a.useMemo)((()=>j.map((({languageCode:e,languageName:n})=>({key:e,render:a=>(0,M.jsx)(g().A,{...a,buttonStyle:u.button,disabled:t,title:n,isChecked:r===e}),action:()=>{t||i(e)}})))),[j,t,r,i,u.button]);return 0===A.length?[h,m]:[h,...A]}},443191:(e,t,n)=>{n.d(t,{J:()=>r});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.39 15.26 15.21",svg:(0,n(474848).jsx)("path",{d:"m10.775 2.583 2.475 2.475a.625.625 0 0 1 0 .884l-2.475 2.475a.625.625 0 1 1-.884-.884l1.408-1.408H4.8c-.649 0-1.175.526-1.175 1.175v5.975a.625.625 0 1 1-1.25 0V7.3A2.425 2.425 0 0 1 4.8 4.875h6.499L9.891 3.467a.625.625 0 0 1 .884-.884M17 6.1c.345 0 .625.28.625.625V12.7a2.425 2.425 0 0 1-2.425 2.425H8.7l1.408 1.408a.625.625 0 1 1-.884.884L6.75 14.942a.625.625 0 0 1 0-.884l2.475-2.475a.625.625 0 1 1 .884.884l-1.408 1.408H15.2c.649 0 1.175-.526 1.175-1.175V6.725c0-.345.28-.625.625-.625"})},r=(0,n(340498).wt)("arrowSquareLeftRight",a,"default")},449242:(e,t,n)=>{n.d(t,{QF:()=>l,R6:()=>s,jp:()=>o,of:()=>i});var a=()=>n(242422),r=()=>n(534177);function o(e){var t;if(!e)return!1;const n=e.getDataStore().getValue();return!!n&&("paused"===n.status&&"disabledByAdmin"===(null===(t=n.paused_reason)||void 0===t?void 0:t.reason))}function i(e,t){switch(e){case"runLimit":return t.formatMessage({id:"workflow.pausedReason.runLimit",defaultMessage:"Run limit reached for this agent"});case"spendLimit":return t.formatMessage({id:"workflow.pausedReason.spendLimit",defaultMessage:"Spending limit reached for this agent"});case"failureLimit":return t.formatMessage({id:"workflow.pausedReason.failureLimit",defaultMessage:"Too many failures for this agent"});case"workspaceSpendLimit":return t.formatMessage({id:"workflow.pausedReason.workspaceSpendLimit",defaultMessage:"Workspace custom agent usage limit reached"});case"disabledByAdmin":return t.formatMessage({id:"workflow.pausedReason.disabledByAdmin",defaultMessage:"Disabled by workspace owner"});case"disabledByNotion":return t.formatMessage({id:"workflow.pausedReason.disabledByNotion",defaultMessage:"Temporarily disabled."});case"internalError":return t.formatMessage({id:"workflow.pausedReason.internalError",defaultMessage:"Internal error"});case"needsReview":return t.formatMessage({id:"workflow.pausedReason.needsReview",defaultMessage:"Needs review"});default:(0,r().HB)(e)}}function s(e,t){switch(e){case"runLimit":return t.formatMessage({id:"workflow.pausedReason.runLimit.short",defaultMessage:"Run limit"});case"spendLimit":return t.formatMessage({id:"workflow.pausedReason.spendLimit.short",defaultMessage:"Spend limit"});case"failureLimit":return t.formatMessage({id:"workflow.pausedReason.failureLimit.short",defaultMessage:"Failures"});case"workspaceSpendLimit":return t.formatMessage({id:"workflow.pausedReason.workspaceSpendLimit.short",defaultMessage:"Workspace limit"});case"disabledByAdmin":return t.formatMessage({id:"workflow.pausedReason.disabledByAdmin.short",defaultMessage:"Disabled"});case"disabledByNotion":return t.formatMessage({id:"workflow.pausedReason.disabledByNotion.short",defaultMessage:"Disabled"});case"internalError":return t.formatMessage({id:"workflow.pausedReason.internalError.short",defaultMessage:"Error"});case"needsReview":return t.formatMessage({id:"workflow.pausedReason.needsReview.short",defaultMessage:"Needs review"});default:(0,r().HB)(e)}}function l(e){const{runStatus:t,runPausedReason:n}=e;return"paused"===t&&(!!a().default.checkGate({gateName:"workflows_confirm_tool_use_reenqueue"})&&("runLimit"===n||"spendLimit"===n))}},459629:(e,t,n)=>{n.d(t,{y:()=>w});var a=n(296540),r=()=>n(590526),o=()=>n(57685),i=()=>n(401497),s=()=>n(250910),l=()=>n(695115),d=()=>n(631524),c=()=>n(26697),u=()=>n(97835),g=()=>n(779181),p=()=>n(69708),h=()=>n(100622),m=()=>n(463916),f=()=>n(596582),v=()=>n(79926);const y=new(v().O2)("ThreadInviteMenu",(async()=>await n.e(8601).then(n.bind(n,626732)))),b=(0,v()._h)(y,(e=>e.ThreadInviteMenu));var x=n(474848);function S(e){const{threadStore:t,aiChatFeatureController:n,variant:a}=e,r=(0,p().tz)(),o=(0,m().useIconButtonStyles)({shape:n.headerButtonShape,aiChatFeatureController:n}),v=(0,i().eP)(),y=(0,i().IS)((()=>({tooltip:{display:"flex",alignItems:"center",gap:8},iconButtonIcon:"icon_rounded"!==a?o.iconButtonIcon:{},iconButton:{..."icon_rounded"!==a?o.iconButton:{background:"dark"===v?h().Tj.gray.background.elevated:h().Tj.background.primary,borderRadius:9999,boxShadow:h().Tj.shadow.outline.sm}}})),[a,o.iconButtonIcon,o.iconButton,v]);return"hidden"===a?null:(0,x.jsx)(c().m,{renderTooltip:()=>(0,x.jsx)("div",{style:y.tooltip,children:(0,x.jsx)(p().sA,{id:"threadPermissions.headerTooltip",defaultMessage:"Invite people or groups to this conversation"})}),render:e=>(0,x.jsx)(s().A,{popupType:s().z.Popup,alignmentToOrigin:"end",renderOrigin:({onClick:t})=>"icon_rounded"===a?(0,x.jsx)(l().A,{...e,icon:{icon:g().inviteMemberSmallIcon,size:"sm"},ariaLabel:r.formatMessage(f().D.header),onClick:t,size:"md",style:y.iconButton,colorVariant:"secondary"}):"icon"===a?(0,x.jsx)(l().A,{...e,icon:u().inviteMemberIcon,ariaLabel:r.formatMessage(f().D.header),onClick:t,iconStyle:y.iconButtonIcon,style:y.iconButton,colorVariant:"secondary"}):(0,x.jsx)(d().p,{...e,onClick:t,ariaLabel:r.formatMessage(f().D.header),size:"md",children:(0,x.jsx)(p().sA,{...f().D.header})}),render:e=>(0,x.jsx)(b,{threadStore:t,onRequestClose:e.close})})})}function w(e){const{aiChatFeatureController:t,threadStore:n,variant:i}=e,s=(0,r().K8)((()=>(0,o().T)(n)),[n]);return(0,a.useMemo)((()=>!!n&&("hidden"!==t.threadInviteButtonVariant&&!(!t.supportsThreadInvites&&!s))),[n,s,t.threadInviteButtonVariant,t.supportsThreadInvites])&&n?(0,x.jsx)(S,{threadStore:n,aiChatFeatureController:t,variant:i??t.threadInviteButtonVariant}):null}},463916:(e,t,n)=>{n.r(t),n.d(t,{AgentChatView:()=>aa,getNewUserInitiatedStep:()=>ha,useIconButtonStyles:()=>ga});n(16280),n(410838),n(944114),n(517642),n(658004),n(733853),n(845876),n(432475),n(515024),n(731698),n(898992),n(823215),n(354520),n(581454),n(737550);var a=()=>n(203066),r=n(296540),o=()=>n(920198),i=()=>n(907258),s=()=>n(884780),l=()=>n(450104),d=()=>n(59226),c=()=>n(560533),u=()=>n(312788),g=()=>n(484714),p=()=>n(590526),h=()=>n(401497),m=()=>n(75435),f=()=>n(988083),v=()=>n(350013),y=()=>n(699143),b=()=>n(874832),x=()=>n(807449),S=()=>n(695115),w=()=>n(98126),C=()=>n(631524),M=()=>n(493552),I=()=>n(26697),k=()=>n(736423),j=()=>n(22634),T=()=>n(626466),A=()=>n(481975),_=()=>n(630230),B=()=>n(89956),P=()=>n(340498),D=n(474848);const R={viewBox:"0 0 16 16",fittedViewBox:"1.32 2.19 13.36 12.32",svg:(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("path",{d:"M8 5c.345 0 .625.28.625.625V7.25h1.625a.625.625 0 1 1 0 1.25H8.625v1.625a.625.625 0 1 1-1.25 0V8.5H5.75a.625.625 0 1 1 0-1.25h1.625V5.625C7.375 5.28 7.655 5 8 5"}),(0,D.jsx)("path",{d:"M8.357 2.202c3.661.148 6.318 2.557 6.318 5.683l-.008.3c-.164 2.978-2.767 5.24-6.31 5.382L8 13.574a8.3 8.3 0 0 1-1.962-.23c-1.09.812-2.412 1.287-3.9 1.133a.625.625 0 0 1-.406-1.033 4.44 4.44 0 0 0 .987-1.996 5.26 5.26 0 0 1-1.388-3.29l-.007-.273c0-3.227 2.832-5.69 6.676-5.69zM8 3.445c-3.335 0-5.426 2.072-5.426 4.44l.005.208c.053 1.033.497 1.975 1.251 2.709a.63.63 0 0 1 .18.547 6 6 0 0 1-.602 1.84c.763-.138 1.466-.494 2.095-1.01l.062-.044a.63.63 0 0 1 .506-.072A7 7 0 0 0 8 12.324l.309-.006c3.154-.123 5.116-2.14 5.116-4.433 0-2.294-1.962-4.31-5.116-4.434z"})]})},E=(0,P().wt)("chatBubblePlusSmall",R,"small");var F=()=>n(709550),W=()=>n(599813),L=()=>n(277153),K=()=>n(427704),N=()=>n(96689),V=()=>n(743246),z=()=>n(201980),H=()=>n(711059),O=()=>n(760342),q=()=>n(496703),U=()=>n(905470),G=()=>n(69708),Y=()=>n(100622),$=()=>n(534177),X=()=>n(944584),Z=()=>n(910302),J=()=>n(384944),Q=()=>n(108184),ee=()=>n(703748),te=()=>n(965454),ne=()=>n(297875),ae=()=>n(981475),re=()=>n(838319),oe=()=>n(254312),ie=()=>n(410930),se=()=>n(35392),le=()=>n(866805),de=()=>n(680514),ce=()=>n(200562),ue=()=>n(926586),ge=()=>n(38554),pe=()=>n(469874),he=()=>n(268716),me=()=>n(440024),fe=()=>n(869562),ve=()=>n(609550),ye=()=>n(156938),be=()=>n(644914),xe=()=>n(77246),Se=()=>n(712505),we=()=>n(244828),Ce=()=>n(545390),Me=()=>n(188679),Ie=()=>n(483795),ke=()=>n(756790),je=()=>n(340644),Te=()=>n(748355),Ae=()=>n(434990),_e=()=>n(759418);function Be(){const e=(0,p().K8)((()=>(0,ke().p)().intent),[]),t=(0,p().K8)((()=>Te().$.getSpaceJoinOrCreate()??"create"),[]),n=(0,p().K8)((()=>Ae()._.getShouldRenderTextPrompt()),[]),a=(0,p().K8)((()=>je().Y.getShouldRenderTextPrompt()),[]),r=(0,p().K8)((()=>function(e,t,n){if("create"===t&&!n)switch(e){case"personal":default:return(0,z().x9d)("Create a simple daily planner for today with three priority tasks in a new page.");case"team":return(0,z().x9d)("Build a project management hub in a new page.");case"school":return(0,z().x9d)("Build a weekly study schedule template for 4 classes in a new page.")}return(0,z().x9d)("Summarize this workspace to help me get started.")}(e,t,a)),[e,t,a]),o=(0,Ie().AI)({initialValue:r}),{shouldRenderTextPrompt:i}=(0,_e().V)();if((0,Me().u)()&&(i||n||a))return o}var Pe=()=>n(687879),De=()=>n(342407),Re=()=>n(260224),Ee=()=>n(622936),Fe=()=>n(934257),We=()=>n(449242),Le=()=>n(844317),Ke=()=>n(46986),Ne=()=>n(704338),Ve=()=>n(140992),ze=()=>n(36951),He=()=>n(827368),Oe=()=>n(240096),qe=()=>n(600434),Ue=()=>n(638939),Ge=()=>n(791256),Ye=()=>n(555102),$e=()=>n(57685),Xe=()=>n(975445),Ze=()=>n(160992),Je=()=>n(144222),Qe=()=>n(580035),et=()=>n(245281),tt=()=>n(166442),nt=()=>n(118503),at=()=>n(221267),rt=()=>n(485673),ot=()=>n(324009),it=()=>n(391379),st=()=>n(8274),lt=()=>n(14205),dt=()=>n(219348),ct=()=>n(761894),ut=()=>n(601751),gt=()=>n(379178),pt=()=>n(554283);function ht(e){const{aiChatFeatureController:t}=e,n=(0,g().v3)(),a=t.supportsUpdatingExistingPersonalizationSettings(),o=(0,r.useCallback)((e=>{e.stopPropagation(),a&&(0,dt().cP)({store:ut().r,from:"agent_chat_face",shouldSetSeenPersonalizationSettingsModal:!0,environment:n})}),[a,n]),[s,l]=(0,pt().B)(),d=(0,h().IS)((()=>({faceContainer:{width:24,height:24,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",marginInlineStart:2,marginInlineEnd:4,transition:"transform 0.25s cubic-bezier(0.34, 1.56, 0.64, 1)"},hoveredFaceContainer:{transform:"scale(1.1)"}})),[]),c=(0,p().O$)(i().AppStoreSidebarSpaceViewStore),u=(0,dt().DV)(c),m=(0,p().K8)((()=>{var e;if(!c)return;const t=null===(e=c.getSettings())||void 0===e?void 0:e.agent_personalization_settings;return(null==t?void 0:t.name)??void 0}),[c]),f=(0,r.useMemo)((()=>{const e=(0,gt().N)(u,m);return e||(0,D.jsx)(G().sA,{id:"AgentChatHeader.personalize",defaultMessage:"Personalize"})}),[u,m]);return(0,D.jsx)("div",{ref:s,style:{...d.faceContainer,...l?d.hoveredFaceContainer:{}},onClick:o,onKeyDown:e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),o(e))},role:"button",tabIndex:0,children:(0,D.jsx)(I().m,{placement:"left",renderTooltip:()=>f,render:e=>(0,D.jsx)(ct().x,{variant:"xsmall_plus",accessory:u,...e})})})}var mt=()=>n(380801),ft=()=>n(756117),vt=()=>n(278589),yt=()=>n(381678),bt=()=>n(155382),xt=()=>n(265060),St=()=>n(124092),wt=()=>n(687681);const Ct=(0,G().YK)({customizeTooltip:{id:"agentEmptyState.customizeTooltip",defaultMessage:"Personalize"}});function Mt(e){const{aiChatFeatureController:t,selectedAccessory:n,isHoveringContainer:a}=e,[o,i]=(0,r.useState)(!1),s="single_line"===t.agentEmptyStateFormat,l="compact"===t.agentEmptyStateFormat,d="full_page"===t.agentChatFormFactor,c=s?32:l?40:d?64:50,u=s?"medium":l?"medium_large":"full_page"===t.agentChatFormFactor?"large_plus":"large",g=(0,h().IS)((()=>({faceWrapper:{position:"relative",display:"inline-block"},welcomeMessageFace:{width:c,height:c,borderRadius:"50%",backgroundColor:Y().Tj.background.elevated,boxShadow:Y().Tj.shadowSM,paddingInline:0,userSelect:"none",WebkitUserSelect:"none",WebkitTouchCallout:"none",pointerEvents:"auto",WebkitUserDrag:"none",touchAction:"manipulation"},customizeButton:{position:"absolute",bottom:4,insetInlineStart:"100%",marginInlineStart:-10,width:"auto",maxWidth:o?200:26,overflow:"hidden",height:26,borderRadius:13,backgroundColor:Y().Tj.background.elevated,boxShadow:Y().Tj.shadowMDPrimaryOutline,display:"flex",alignItems:"center",justifyContent:"start",opacity:a?1:0,transition:"all 200ms cubic-bezier(0.5, 1, 0.89, 1)",pointerEvents:a?"auto":"none",cursor:"pointer",paddingInlineStart:6,paddingInlineEnd:10,...s&&{maxWidth:20,width:20,height:20,bottom:2,marginInlineStart:-8,borderRadius:10,paddingInlineStart:4,paddingInlineEnd:4}},customizeIcon:{width:s?12:14,height:s?12:14,color:Y().Tj.text.secondary},customizeText:{transition:"opacity 200ms ease-in-out",marginInlineStart:6,fontSize:12,color:Y().Tj.text.secondary,whiteSpace:"nowrap"}})),[a,o,s,c]),p=t.supportsUpdatingExistingPersonalizationSettings(),m=(0,r.useCallback)((()=>{p&&dt().cP({store:ut().r,from:t.aiChatType,shouldSetSeenPersonalizationSettingsModal:!1})}),[p,t.aiChatType]),f=(0,r.useCallback)((e=>{e.preventDefault()}),[]),v=(0,r.useCallback)((e=>{e.stopPropagation()}),[]),y=(0,r.useCallback)((e=>{e.preventDefault(),e.stopPropagation()}),[]);return(0,D.jsxs)("div",{style:g.faceWrapper,onMouseEnter:()=>i(!0),onMouseLeave:()=>i(!1),children:[(0,D.jsx)(St().p,{style:g.welcomeMessageFace,onClick:m,onContextMenu:f,onTouchStart:v,onTouchEnd:y,disabled:!p,"aria-label":"Open personalization settings",children:(0,D.jsx)(ct().x,{accessory:n,variant:u})}),p?(0,D.jsxs)("div",{style:g.customizeButton,onClick:m,role:"button",tabIndex:-1,"aria-label":"Personalize assistant","aria-hidden":!a,children:[(0,D.jsx)(xt().Q,{iconGroup:wt().u,variantName:"small",style:g.customizeIcon}),s?null:(0,D.jsx)("div",{style:g.customizeText,children:(0,D.jsx)(G().sA,{...Ct.customizeTooltip})})]}):void 0]})}var It=()=>n(852507),kt=()=>n(160432),jt=()=>n(637433),Tt=()=>n(924102),At=()=>n(183373),_t=()=>n(843572),Bt=()=>n(798988);const Pt=new Set(k().y.agent_new_user_onboarding.steps.map((e=>e.id)));function Dt(e){const{steps:t}=e,n=(0,g().v3)(),a=(0,G().tz)();(0,It().w)((()=>{(0,Tt().o)({environment:n,featureKey:"adoption_agent_new_user_onboarding_checklist"})}));const o=(0,h().IS)((()=>({wrapper:{position:"relative",width:"100%",marginTop:"empty_state"===e.variant?-48:0,paddingBottom:"in_chat"===e.variant?12:0,zIndex:0},closeButton:{position:"absolute",insetInlineEnd:12,top:"in_chat"===e.variant?16:12,borderRadius:"100%",width:22,height:22,display:"flex",alignItems:"center",justifyContent:"center"},doneButton:{width:"100%",marginTop:12}})),[e.variant]),s=r.useMemo((()=>(null==t?void 0:t.some((e=>e.completed)))??!1),[t]),l=r.useMemo((()=>(null==t?void 0:t.every((e=>e.completed)))??!1),[t]),d=(0,r.useCallback)((()=>{(0,re().AK)({environment:n,checklistId:"agent_new_user_onboarding",state:"collapsed"})}),[n]),c=(0,r.useCallback)((()=>{(0,re().Sn)({environment:n,checklistId:"agent_new_user_onboarding"})}),[n]),u=(0,p().K8)((()=>{var e;return null===(e=i().default.state.currentUserStore)||void 0===e?void 0:e.getDisplayName(a)}),[a]),m={"manage-projects":a.formatMessage({id:"agentOnboardingChecklist.step.manageProjects",defaultMessage:"Draft a space to manage projects"}),"action-items":a.formatMessage({id:"agentOnboardingChecklist.step.actionItems",defaultMessage:"Turn projects into action items"}),"meeting-notes":a.formatMessage({id:"agentOnboardingChecklist.step.meetingNotes",defaultMessage:"Capture meeting notes automatically"})},f=r.useMemo((()=>({"manage-projects":a.formatMessage({id:"agentOnboardingChecklist.prompt.manageProjects",defaultMessage:"Help me draft a space to manage projects. Create a simple projects hub page with an inline database with columns for project name, owner, status, and due date."}),"action-items":a.formatMessage({id:"agentOnboardingChecklist.prompt.actionItems",defaultMessage:"Add an inline tasks database with title, status, assignee, due date, and a relation to link each task to a project."}),"meeting-notes":a.formatMessage({id:"agentOnboardingChecklist.prompt.meetingNotes",defaultMessage:"In the same page, set up a space to take and track meeting notes that includes a new Meeting Notes block."})})),[a]),v=r.useMemo((()=>({"manage-projects":f["manage-projects"],"action-items":a.formatMessage({id:"agentOnboardingChecklist.prompt.actionItems.outOfContext",defaultMessage:"Add an inline tasks database with title, status, assignee, and due date."}),"meeting-notes":f["meeting-notes"]})),[f,a]),y=(0,p().K8)((()=>{var e;return(null===(e=i().AppStoreMainEditorCurrentBlockStore.state)||void 0===e?void 0:e.id)??void 0}),[]),b=(0,p().K8)((()=>Bt().o.getPageIdForManageProjectsStep()),[]),x=(0,r.useCallback)((t=>{if(!function(e){return!!Pt.has(e)}(t))return;const a="agent_new_user_onboarding";(0,At().ik)({environment:n,checklistId:a,stepId:t,type:"clickStep"}),(0,re().Cu)({environment:n,checklistId:a,stepId:t});let r=!1;"action-items"===t&&(!b||b&&y&&b!==y)&&(r=!0);const o=r?v[t]:f[t];e.onSubmitPrompt({prompt:o,checklistId:a,stepId:t})}),[n,f,v,y,b,e]),w=null==t?void 0:t.map((e=>({id:e.id,completed:e.completed,title:m[e.id]??e.id}))),C=s?a.formatMessage({id:"agentOnboardingChecklist.title.returning",defaultMessage:"Ready to keep going?"}):u?a.formatMessage({id:"agentOnboardingChecklist.title.withName",defaultMessage:"Welcome, {name}! "},{name:u}):a.formatMessage({id:"agentOnboardingChecklist.title",defaultMessage:"Welcome!"}),M=s?a.formatMessage({id:"agentOnboardingChecklist.description.returning",defaultMessage:"Here are a few things to try to continue your Notion journey."}):a.formatMessage({id:"agentOnboardingChecklist.description",defaultMessage:"Here are a few things to do to set up your Notion workspace."});return w?(0,D.jsxs)("div",{style:o.wrapper,children:[(0,D.jsx)(_t().b,{title:C,description:M,steps:w,onStepClick:x,topPadding:"in_chat"===e.variant?24:40,requireOrderedStepCompletion:!0,footer:l?(0,D.jsx)(kt().A,{colorPalette:"blue",style:o.doneButton,onClick:c,children:a.formatMessage({id:"agentOnboardingChecklist.doneButton",defaultMessage:"Done"})}):null}),(0,D.jsx)("div",{style:o.closeButton,children:(0,D.jsx)(S().A,{ariaLabel:a.formatMessage({id:"agentOnboardingChecklist.dismissButton",defaultMessage:"Dismiss Agent onboarding checklist"}),icon:jt().xMarkCircleFillIcon,size:"lg",colorVariant:"tertiary",onClick:d})})]}):null}const Rt=(0,G().YK)({welcomeMessage:{id:"agentChatView.welcomeMessageTitle",defaultMessage:"How can I help you today?"},safetyHatWelcomeMessage:{id:"agentChatView.safetyHatWelcomeMessage",defaultMessage:"Ready to work! Let me know what you need."},mustacheWelcomeMessage:{id:"agentChatView.mustacheWelcomeMessage",defaultMessage:"How may I be of service?"},headphoneWelcomeMessage:{id:"agentChatView.headphoneWelcomeMessage",defaultMessage:"How can I help you today?"},flowerWelcomeMessage:{id:"agentChatView.flowerWelcomeMessage",defaultMessage:"What can I brighten up for you today?"},pencilWelcomeMessage:{id:"agentChatView.pencilWelcomeMessage",defaultMessage:"What are we sketching out first?"},paprikaWelcomeMessage:{id:"agentChatView.paprikaWelcomeMessage",defaultMessage:"Spice it up  what do you need?"},duckWelcomeMessage:{id:"agentChatView.duckWelcomeMessage",defaultMessage:"Quack! Whats the plan?"},catWelcomeMessage:{id:"agentChatView.catWelcomeMessage",defaultMessage:"Meow whats your request?"},crownWelcomeMessage:{id:"agentChatView.crownWelcomeMessage",defaultMessage:"What royal service do you require?"},cowboyWelcomeMessage:{id:"agentChatView.cowboyWelcomeMessage",defaultMessage:"What can I wrangle up for ya?"},leafWelcomeMessage:{id:"agentChatView.leafWelcomeMessage",defaultMessage:"Whats our quest today?"},magicianWelcomeMessage:{id:"agentChatView.magicianWelcomeMessage",defaultMessage:"What magic shall we make happen?"},bowWelcomeMessage:{id:"agentChatView.bowWelcomeMessage",defaultMessage:"What can I tie up nicely for you?"},cherryWelcomeMessage:{id:"agentChatView.cherryWelcomeMessage",defaultMessage:"How can I help you today?"},propellerWelcomeMessage:{id:"agentChatView.propellerWelcomeMessage",defaultMessage:"Where are we off to first?"},firefighterWelcomeMessage:{id:"agentChatView.firefighterWelcomeMessage",defaultMessage:"On call and ready, how can I help?"},scarfWelcomeMessage:{id:"agentChatView.scarfWelcomeMessage",defaultMessage:"What can I do for you?"},seasonalOctober25WelcomeMessage:{id:"agentChatView.seasonalOctober25WelcomeMessage",defaultMessage:"What shall I conjure for you?"},seasonalDecember25WelcomeMessage:{id:"agentChatView.seasonalDecember25WelcomeMessage",defaultMessage:"Whats on your wishlist?"}});function Et(e){const{selectedAccessory:t,agentEmptyStateFormat:n,textSize:a="default"}=e,o="centered"===n,i="single_line"===n,s="compact"===n,l=(0,h().IS)((()=>({welcomeMessageTitle:{fontSize:17,lineHeight:1.3,fontWeight:600,paddingInline:8,...i&&{textAlign:"start",flexShrink:0},...o&&{textAlign:"center"}},welcomeMessageTitleLarge:{fontSize:30,lineHeight:1.2,fontWeight:600,paddingInline:8,...i&&{textAlign:"start",flexShrink:0},...o&&{textAlign:"center"}}})),[o,i]),d=(0,r.useMemo)((()=>{if(!t)return(0,D.jsx)(G().sA,{...Rt.welcomeMessage});switch(t){case"safety-hat":return(0,D.jsx)(G().sA,{...Rt.safetyHatWelcomeMessage});case"mustache":return(0,D.jsx)(G().sA,{...Rt.mustacheWelcomeMessage});case"headphone":return(0,D.jsx)(G().sA,{...Rt.headphoneWelcomeMessage});case"flower":return(0,D.jsx)(G().sA,{...Rt.flowerWelcomeMessage});case"pencil":return(0,D.jsx)(G().sA,{...Rt.pencilWelcomeMessage});case"paprika":return(0,D.jsx)(G().sA,{...Rt.paprikaWelcomeMessage});case"duck":return(0,D.jsx)(G().sA,{...Rt.duckWelcomeMessage});case"cat":return(0,D.jsx)(G().sA,{...Rt.catWelcomeMessage});case"crown":return(0,D.jsx)(G().sA,{...Rt.crownWelcomeMessage});case"cowboy":return(0,D.jsx)(G().sA,{...Rt.cowboyWelcomeMessage});case"leaf":return(0,D.jsx)(G().sA,{...Rt.leafWelcomeMessage});case"magician":return(0,D.jsx)(G().sA,{...Rt.magicianWelcomeMessage});case"bow":return(0,D.jsx)(G().sA,{...Rt.bowWelcomeMessage});case"cherry":return(0,D.jsx)(G().sA,{...Rt.cherryWelcomeMessage});case"propeller":return(0,D.jsx)(G().sA,{...Rt.propellerWelcomeMessage});case"firefighter":return(0,D.jsx)(G().sA,{...Rt.firefighterWelcomeMessage});case"scarf":return(0,D.jsx)(G().sA,{...Rt.scarfWelcomeMessage});case"seasonal-bat":case"seasonal-demon":case"seasonal-frankenstein":case"seasonal-pumpkin":return(0,D.jsx)(G().sA,{...Rt.seasonalOctober25WelcomeMessage});case"seasonal-santa-hat":return(0,D.jsx)(G().sA,{...Rt.seasonalDecember25WelcomeMessage});default:return(0,D.jsx)(G().sA,{...Rt.welcomeMessage})}}),[t]);return s?null:(0,D.jsx)("div",{style:"large"===a?l.welcomeMessageTitleLarge:l.welcomeMessageTitle,children:d})}function Ft(e){const t=(0,G().tz)(),n=(0,g().v3)(),{aiChatFeatureController:a,startedAgentChatThread:o,onWelcomeAnimationsComplete:s,onSubmitPrompt:l}=e,d="centered"===a.agentEmptyStateFormat,c="single_line"===a.agentEmptyStateFormat,u="default"===a.agentEmptyStateFormat,m="compact"===a.agentEmptyStateFormat,[f,v]=(0,r.useState)(!1),b=(0,p().O$)(i().AppStoreSidebarSpaceViewStore),x=(0,dt().DV)(b),S=(0,p().K8)((()=>{var e;const{sidebarSpaceViewStore:t}=i().default.state;return null==t||null===(e=t.getSettings())||void 0===e||null===(e=e.agent_personalization_settings)||void 0===e?void 0:e.name}),[]),w=(0,p().K8)((()=>{const e=(0,yt()._)(n);return null==e?void 0:e.getFullName(t)}),[n,t]),{steps:C,state:I}=(0,oe().q)("agent_new_user_onboarding"),{variant:k}=(0,_e().V)(),j=(0,Me().u)(),T=(j||"ai_float"===k)&&Boolean(w),A=(0,r.useMemo)((()=>{const e="full_page"===a.agentChatFormFactor?"large_plus":"large",t=(0,vt().N)(e),n=Math.round(1.5625*t);return Math.ceil((n-t)/2)}),[a.agentChatFormFactor]),{variant:_}=(0,Ce().n)(),B=(0,h().IS)((()=>({hoverContainer:{width:"100%",display:"flex",alignItems:"center",justifyContent:d||c?"center":"flex-start",paddingTop:16,paddingBottom:16,marginTop:-16,marginBottom:-16},welcomeMessageTitle:{paddingInline:8,...c&&{textAlign:"start",flexShrink:0,fontSize:20,lineHeight:1.2},...d&&{paddingInline:0,textAlign:"center"}},container:{display:"flex",flexDirection:"column",flex:1,justifyContent:"flex-end",alignItems:"stretch",maxWidth:a.chatInputWidth,width:"100%",pointerEvents:"auto",alignSelf:"center",...c&&{maxWidth:"auto",width:"100%",alignItems:"center",justifyContent:"center"},...d&&{alignItems:"center",paddingBottom:32},paddingTop:A,...j&&{paddingBottom:8}},inlineContainer:{display:"flex",alignItems:"center",justifyContent:"center",gap:20,width:"auto",flexShrink:0,padding:"8px"},hoverContainerForVideo:{paddingTop:16,paddingBottom:16,marginTop:-16,marginBottom:-16},containerForVideo:{maxWidth:a.chatInputWidth,width:"100%",pointerEvents:"auto",alignSelf:"center",paddingTop:A},videoAiFaceWrapper:{position:"relative",zIndex:1,width:"fit-content"},videoCallOutWrapper:{position:"relative",paddingInline:12,zIndex:0},hiddenAnimated:{opacity:0,transition:"opacity 800ms ease-in-out"},visibleAnimated:{opacity:1,transition:"opacity 800ms ease-in-out"}})),[a.chatInputWidth,d,c,A,j]),P=(0,r.useCallback)((()=>{v(!0)}),[]),R=(0,r.useCallback)((()=>{v(!1)}),[]),E=(0,r.useCallback)((e=>{const{key:t,fullWidthHoverContainer:n=!1}=e,r=(0,D.jsx)(Mt,{aiChatFeatureController:a,selectedAccessory:x,isHoveringContainer:f});return n?(0,D.jsx)("div",{style:B.hoverContainer,onMouseEnter:P,onMouseLeave:R,children:r},t):(0,D.jsx)("div",{children:r},t)}),[a,x,f,B.hoverContainer,P,R]),F="open"===I&&_&&"control"!==_&&"full_page"!==a.agentChatFormFactor,W=(0,r.useMemo)((()=>o||!u?F?[(0,D.jsx)("div",{style:B.hoverContainerForVideo,onMouseEnter:P,onMouseLeave:R,children:(0,D.jsx)(ft().A,{visible:!0,initial:{transform:"scale(0)"},animate:{transform:"scale(1)"},style:{marginInlineStart:12},config:{duration:1200,timingFunction:"cubic-bezier(0.34, 1.56, 0.64, 1)"},children:E({key:"face-inline",fullWidthHoverContainer:!1})})},"face-animated-container"),(0,D.jsx)(Dt,{from:"existing_user",variant:"empty_state",steps:C,onSubmitPrompt:l},"checklist")]:c?[(0,D.jsxs)("div",{style:B.inlineContainer,onMouseEnter:P,onMouseLeave:R,children:[E({key:"face-inline",fullWidthHoverContainer:!1}),(0,D.jsx)(Et,{selectedAccessory:x,personalizedName:S,agentEmptyStateFormat:a.agentEmptyStateFormat})]},"inline-container")]:[E({key:"face",fullWidthHoverContainer:!0}),(0,D.jsx)(Et,{selectedAccessory:x,personalizedName:S,agentEmptyStateFormat:a.agentEmptyStateFormat,textSize:u?"default":"large"},"welcome-message")]:F?[(0,D.jsx)("div",{style:B.hoverContainerForVideo,onMouseEnter:P,onMouseLeave:R,children:(0,D.jsx)(ft().A,{visible:!0,initial:{transform:"scale(0)"},animate:{transform:"scale(1)"},style:{marginInlineStart:12},config:{duration:1200,timingFunction:"cubic-bezier(0.34, 1.56, 0.64, 1)"},children:E({key:"face-inline",fullWidthHoverContainer:!1})})},"face-animated-container"),(0,D.jsx)(Dt,{from:"existing_user",variant:"empty_state",steps:C,onSubmitPrompt:l},"checklist")]:[(0,D.jsx)("div",{style:B.hoverContainer,onMouseEnter:P,onMouseLeave:R,children:(0,D.jsx)(ft().A,{visible:!0,initial:{transform:"scale(0)"},animate:{transform:"scale(1)"},style:{marginBottom:8},config:{duration:1200,timingFunction:"cubic-bezier(0.34, 1.56, 0.64, 1)"},children:E({key:"face-inner",fullWidthHoverContainer:!1})})},"face-animated-container"),(0,D.jsx)(M().D,{styleKey:"titleSmSemibold",style:B.welcomeMessageTitle,children:T?(0,D.jsx)(G().sA,{id:"agentChatView.welcomeMessageTitleAIToNewUserExperiment",defaultMessage:"Welcome {name}! ",values:{name:w}}):(0,D.jsx)(G().sA,{id:"agentChatView.welcomeMessageTitleFirstUse",defaultMessage:"Your improved Notion AI"})},"title"),(0,D.jsx)(M().D,{styleKey:"bodyRegular",style:B.welcomeMessageTitle,children:j?(0,D.jsx)(G().sA,{id:"agentChatView.welcomeMessageDescriptionFirstUseAIToNewUserExperiment",defaultMessage:"Im your Notion Agent and Im here to help you get set up!"}):(0,D.jsx)(G().sA,{id:"agentChatView.welcomeMessageDescriptionFirstUse",defaultMessage:"Here are a few things I can do, or ask me anything!"})},"description"),...j?[(0,D.jsx)(M().D,{styleKey:"bodyRegular",style:B.welcomeMessageTitle,children:(0,D.jsx)(G().sA,{id:"agentChatView.welcomeMessageSubDescriptionFirstUseAIToNewUserExperiment",defaultMessage:"Start by sending the prompt below to see what I can do."})},"description")]:[]]),[B.inlineContainer,B.welcomeMessageTitle,B.hoverContainer,B.hoverContainerForVideo,o,E,c,u,P,R,a.agentEmptyStateFormat,S,x,T,j,w,C,l,F]),L=o,K=(0,r.useCallback)((()=>{s&&requestAnimationFrame((()=>s()))}),[s]);(0,r.useEffect)((()=>{L&&s&&W.length>0&&requestAnimationFrame((()=>s()))}),[L,s,W.length]);const N=(0,bt().pg)({numItems:W.length,disableAnimation:L,onAllAnimationsComplete:L?void 0:K}),V=(0,r.useMemo)((()=>c?"0":m?"0px 16px 0px 20px":"16px 16px 0 16px"),[c,m]);return F?(0,D.jsx)("div",{style:B.containerForVideo,children:W.map(((e,t)=>{const n=0===t?B.videoAiFaceWrapper:B.videoCallOutWrapper;return(0,D.jsx)("div",{style:L?n:N.has(t)?{...B.visibleAnimated,...n}:{...B.hiddenAnimated,...n},children:e},`welcome-message-${t}`)}))}):(0,D.jsx)("div",{style:B.container,children:(0,D.jsx)(y().Y1,{direction:"vertical",gap:12,padding:V,children:W.map(((e,t)=>(0,D.jsx)(Wt,{visible:N.has(t),disableAnimation:L,children:e},`welcome-message-${t}`)))})})}function Wt({visible:e,children:t,disableAnimation:n}){const a=(0,bt().$5)(e);return(0,D.jsx)("div",{style:n?{}:{...a},children:t})}function Lt(e){const{progress:t,radius:n=6,onClick:a}=e,r=(0,h().IS)((()=>({badgeContainer:{display:"flex",alignItems:"center",gap:4,alignSelf:"center",paddingTop:2,paddingInlineEnd:4,paddingBottom:2,paddingInlineStart:6,background:Y().Tj.blue.background.secondaryTranslucent,color:Y().Tj.blue.text.accentPrimary,border:"none",borderRadius:4,fontSize:11,fontWeight:500,lineHeight:1.3},progressCircleContainer:{position:"relative",width:14,height:14,flexShrink:0}})),[]);return(0,D.jsxs)("button",{style:r.badgeContainer,onClick:a,children:[(0,D.jsx)("span",{children:(0,D.jsx)(G().sA,{id:"agentOnboardingChecklist.progressBadge.label",defaultMessage:"Finish setup"})}),(0,D.jsx)("div",{style:r.progressCircleContainer,children:(0,D.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 14 14",style:{transform:"rotate(-90deg)"},children:[(0,D.jsx)("circle",{cx:"7",cy:"7",r:n,fill:"none",stroke:"rgba(35, 131, 226, 0.2)",strokeWidth:"2"}),(0,D.jsx)("circle",{cx:"7",cy:"7",r:n,fill:"none",stroke:"rgb(35, 131, 226)",strokeWidth:"2",strokeDasharray:`${t*(2*Math.PI*n)} ${2*Math.PI*n}`,strokeLinecap:"round"})]})})]})}var Kt=()=>n(598388),Nt=()=>n(153321),Vt=()=>n(242422),zt=()=>n(726637),Ht=()=>n(463086),Ot=()=>n(718827),qt=()=>n(970236),Ut=()=>n(546926),Gt=()=>n(890492),Yt=()=>n(81068),$t=()=>n(663639),Xt=()=>n(736847),Zt=()=>n(105239),Jt=()=>n(925695),Qt=()=>n(995847),en=()=>n(402390),tn=()=>n(680977);function nn(e){const{environment:t,userSettingsStore:n,dismissed:a}=e;we().createAndCommit({environment:t,userAction:"userSettingsActions.setDismissAgentGetStartedBanner",canUndo:!0,cellTarget:"main",perform:e=>{(0,tn().m)({userSettingsStore:n,transaction:e,data:{dismissed_agent_get_started_banner:a}})}})}var an=()=>n(526905),rn=()=>n(557297),on=()=>n(799832),sn=()=>n(30154),ln=()=>n(383814),dn=()=>n(47373),cn=()=>n(477293),un=()=>n(929219),gn=()=>n(295633),pn=()=>n(30537),hn=()=>n(250910),mn=()=>n(118307),fn=()=>n(877235),vn=()=>n(5580),yn=()=>n(514799),bn=()=>n(383070),xn=()=>n(391435);const Sn=(0,G().YK)({translateThisPage:{id:"AgentSuggestedActions.translateThisPage",defaultMessage:"Translate this page"}});function wn({menuListItemProps:e,isLoading:t,variant:n="list"}){const a=(0,g().v3)(),o=(0,G().tz)(),i=(0,p().uB)(void 0,mn().A),s=(0,g().WS)(),l=(0,p().K8)((()=>{const e=(0,ln().G)(a);if(e&&e instanceof gn().B)return e}),[a]),d=(0,p().K8)((()=>bn().zD.isFullPageTranslateEnabled()),[]),{detectedLanguage:c}=(0,yn().H)({pageStore:l,enabled:Boolean(l)&&d}),u=(0,vn().n)(),[m,f]=(0,r.useState)(void 0),v=m??c??u,y=(0,p().K8)((()=>{if(!l)return{mode:"translate_unlocked",status:"pre_activation",sourceLanguage:v};const e=xe().Uv.getTranslateModeForBlock(l.id);return e||{mode:"translate_unlocked",status:"pre_activation",sourceLanguage:v}}),[l,v]),S=!(0,p().O$)(un().e),w=(0,r.useCallback)((e=>{const{sourceLanguage:t}=e;f(t)}),[]),C=(0,r.useCallback)((e=>{if(!l)return;const{targetLanguage:t}=e;Z().Z9({pageStore:l,environment:a}),Z().Ww({pageStore:l,targetLanguage:t,sourceLanguage:v,environment:a,triggeredFrom:"action_menu"}),i.reset()}),[l,v,a,i]),I=(0,p().K8)((()=>ae().globalChatPanelRuntimeStore.state.chatPanelMode),[]),k=(0,h().IS)((()=>({actionItemStyle:{width:"100%",minHeight:"unset",padding:"8px 8px"},actionItemButtonStyle:{marginBottom:"1px",marginTop:"1px",borderRadius:"popup"===I?"16px":"6px",display:"flex",justifyContent:"space-between",height:32},pillButton:{display:"flex",alignItems:"center",height:28,padding:"4px 10px",borderRadius:16,cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap",color:Y().Tj.text.secondary,backgroundColor:Y().Tj.gray.background.primaryTranslucent},hoveredPillButton:{backgroundColor:Y().Tj.gray.background.tertiary},pillShimmer:{height:16,width:140,borderRadius:16}})),[I]),j=s?Ut().gu.ActionSheet:Ut().gu.Popup,T=(0,r.useCallback)((()=>{const e=j===Ut().gu.ActionSheet?void 0:400;return(0,D.jsx)(Gt().A,{menuType:j,width:e,height:e,children:(0,D.jsx)(xn().Z,{onSelectTargetLanguage:C,onSelectSourceLanguage:w,editorModeConfigTranslateState:y,sourceLanguage:v,detectedPageLanguage:c,preferredLanguage:u,subMenuPlacement:"left",pageId:(null==l?void 0:l.id)??""})})}),[j,C,w,y,v,c,u,null==l?void 0:l.id]);return!l||S?null:"pill"===n?t?(0,D.jsx)(b().P,{style:k.pillShimmer}):(0,D.jsx)(hn().A,{buttonPopupStore:i,popupType:pn().n.Popup,placementToOrigin:"top",originGap:4,renderOrigin:e=>(0,D.jsx)(Ot().Ay,{...e,disabled:t,style:k.pillButton,hoveredStyle:k.hoveredPillButton,children:o.formatMessage(Sn.translateThisPage)}),render:T}):e?(0,D.jsx)(hn().A,{buttonPopupStore:i,popupType:pn().n.Popup,placementToOrigin:"top",originGap:4,renderOrigin:n=>(0,D.jsx)(Yt().A,{...e,...n,title:(0,D.jsx)(M().D,{styleKey:"bodyRegular",children:o.formatMessage(Sn.translateThisPage)}),left:t?null:(0,D.jsx)(x().I,{icon:fn().textTranslateIcon,colorVariant:"primary"}),leftStyle:{margin:0},disabled:t,buttonStyle:k.actionItemButtonStyle,style:k.actionItemStyle,dontShrinkTitle:!0,ignoreLocalHoverState:!1}),render:T}):null}var Cn=()=>n(222800);const Mn=(0,G().YK)({getStarted:{id:"agentSuggestedActions.getStarted",defaultMessage:"Get started"},dismissButton:{id:"agentSuggestedActions.dismissButton",defaultMessage:"Dismiss"},clearDailyBriefButton:{id:"agentSuggestedActions.clearDailyBriefButton",defaultMessage:"Clear todays brief"},dailyBriefPillGenerate:{id:"agentSuggestedActions.dailyBriefPillGenerate",defaultMessage:"Help start my day"},dailyBriefPillReview:{id:"agentSuggestedActions.dailyBriefPillReview",defaultMessage:"Review my daily brief"}}),In=[140,180,160,150],kn=4,jn=5,Tn=400;function An(e,t){var n;if(!t||!e)return{hasThreadForToday:!1};const a=t.getSettings(),r=null==a||null===(n=a.agent_personalization_settings)||void 0===n?void 0:n.daily_brief_prompt,o=null==r?void 0:r.latest_daily_brief_thread_id;if(!o)return{hasThreadForToday:!1};const i=Ht().E.createChildStore(e,{table:"thread",id:o,spaceId:e.id});if(!i.isDefined()||!i.getAlive())return{hasThreadForToday:!1};const s=i.getCreatedTime(),l=an().b9(Date.now()),d=an().b9(s)===l;return{hasThreadForToday:d,existingThreadId:d?o:void 0}}function _n({loadAttachmentData:e,handlePromptSubmit:t,readyToAnimate:n=!0,disableAnimation:a,variant:r="list",aiChatFeatureController:o,chatLoaded:i,inferenceInfo:s}){const l=(0,cn().r)("agent_suggested_actions"),d=(0,h().IS)((()=>({wrapper:{display:"flex",flexDirection:"column",alignItems:"center",maxWidth:"number"==typeof o.chatInputWidth?o.chatInputWidth:void 0,width:"100%",alignSelf:"center",margin:"0 auto",..."card"===r?{paddingTop:16}:o.suggestedActionsContainerPadding}})),[o.chatInputWidth,o.suggestedActionsContainerPadding,r]),c=(0,g().v3)();return(0,p().K8)((()=>"ai"===c.RouterStore.state.route.name),[c])&&!i?null:"prebuilt_prompts"===l?(0,D.jsx)("div",{style:d.wrapper,children:(0,D.jsx)(Bn,{loadAttachmentData:e,handlePromptSubmit:t,readyToAnimate:n,disableAnimation:a,variant:r,inferenceInfo:s})}):"control"===l?null:void(0,$().HB)(l)}function Bn({loadAttachmentData:e,handlePromptSubmit:t,readyToAnimate:n,disableAnimation:a,variant:o="list",inferenceInfo:s}){const l=(0,G().tz)(),c=(0,g().v3)(),u=(0,p().K8)((()=>(0,ln().G)(c)),[c]),h=(0,p().K8)((()=>{if(u&&!(u instanceof v().N))return(0,on().U)(u)}),[u]),m=(0,p().K8)((()=>{var e;if(!h)return{isLoading:!1,hasContent:!1};const t=h.isLoadedStore.state,n=h.isEmptyStore.state,a=(null===(e=h.collectionStore())||void 0===e?void 0:e.isPageTreeCollection())??!1,r=!(u instanceof v().N)&&((null==u?void 0:u.isCollectionView())??!1)&&!a;return{isLoading:!t&&r,hasContent:t&&!n}}),[h,u]),f=m.isLoading,y=m.hasContent,b=(0,p().K8)((()=>(0,en().H)(l)),[l]),x=(0,p().K8)((()=>{var e;const{sidebarSpaceViewStore:t}=i().default.state;return(null==t||null===(e=t.getSettings())||void 0===e||null===(e=e.agent_personalization_settings)||void 0===e?void 0:e.has_already_seen_personalization_settings_modal)??!1}),[]),S=(0,d().X)("agent_whats_new_education_action"),w=(0,dn().ke)(),{canCreate:C}=(0,Cn().V)(),M=(0,p().K8)((()=>w&&C&&Boolean(Vt().default.getConfig({configName:"custom_agent_sub_features"}).nosey_suggested_entry_point)),[w,C]),I=(0,r.useCallback)((()=>{dt().cP({store:ut().r,from:"agent_suggested_actions",shouldSetSeenPersonalizationSettingsModal:!0,environment:c})}),[c]),k=(0,p().K8)((()=>"ai"===c.RouterStore.state.route.name),[c]),j=(0,p().K8)((()=>{var e;return!(0,$().O9)(null===(e=i().default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.whats_new_in_agent_suggestion_last_interacted_at)&&S||k}),[S,k]),T=(0,p().K8)((()=>(0,Fe().MY)({store:u,hasCollectionContent:y,loadAttachmentData:e,handlePromptSubmit:({text:e,prebuiltPromptType:n})=>{"whats_new_in_agent"===n&&function(e){const{currentUserSettingsStore:t}=i().default.state;if(!t)return;const{environment:n}=e;we().createAndCommit({environment:n,userAction:"userSettingsActions.setWhatsNewInAgentSuggestionLastInteractedAt",canUndo:!1,cellTarget:"main",perform:e=>{(0,tn().m)({userSettingsStore:t,transaction:e,data:{whats_new_in_agent_suggestion_last_interacted_at:Date.now()}})}})}({environment:c}),t({type:"prebuilt-prompt",text:e,promptType:n,locale:b})},intl:l,canShowPersonalizationSettingsModal:!zt().A.isMobile&&!x,openFaceCustomizationModal:I,isAiLandingPage:k,enableWhatsNewEducationAction:j,enableCreateCustomAgentAction:M}).slice(0,k?jn:kn)),[u,y,e,l,x,I,k,j,M,t,b,c]);return(0,D.jsx)(Pn,{suggestedActionInfos:T,readyToAnimate:n,isLoading:f,disableAnimation:a,variant:o,inferenceInfo:s,handlePromptSubmit:t})}function Pn({suggestedActionInfos:e,readyToAnimate:t,isLoading:n,disableAnimation:a,variant:s="list",inferenceInfo:l,handlePromptSubmit:d}){const[c,u]=(0,r.useState)(!1),m=(0,G().tz)(),f=(0,g().v3)(),v=(0,p().O$)(i().AppStoreCurrentUserSettingsStore),y=(0,p().O$)(i().AppStoreSidebarSpaceViewStore),[b,x]=(0,r.useState)(4),w=(0,r.useRef)(null),C=(0,r.useRef)(void 0),I=(0,o().L)(),k=(0,p().K8)((()=>An(I,y).hasThreadForToday),[I,y]),j=(0,r.useCallback)((()=>{(async()=>{const{hasThreadForToday:e,existingThreadId:t}=An(I,y);if(e&&t&&I){const e=Ht().E.createChildStore(I,{table:"thread",id:t,spaceId:I.id});if(e.isDefined()){const{openChatPanel:n}=await rn().nO.chatSidebarActions.load(),a=e.getAlive(),r=(0,ln().G)(f);return void(a&&r&&n({environment:f,store:r,chatPanelState:{isOpen:!0,threadId:t},source:"daily_brief_reminder"}))}}ae().globalChatPanelRuntimeStore.setState({...ae().globalChatPanelRuntimeStore.state,isLoadingDependencies:!0});try{const e=await(0,sn().Yd)({environment:f});if(!e||!I)return;const t=[(0,z().Ey_)("Follow the prompt: "),(0,z().wmz)((0,z().ld4)(e,I.id))];d({type:"text-value",text:t},(async e=>{await(0,sn().sj)({environment:f,threadId:e.id})}),"daily_brief_reminder")}finally{ae().globalChatPanelRuntimeStore.setState({...ae().globalChatPanelRuntimeStore.state,isLoadingDependencies:!1})}})()}),[f,d,I,y]),T=(0,r.useCallback)((()=>{(async()=>{const{hasThreadForToday:e,existingThreadId:t}=An(I,y);e&&t&&I&&await(0,sn().RP)({environment:f})})()}),[f,I,y]),A=(0,p().K8)((()=>{if((0,le().OE)())return{type:"daily_brief",suggestedAction:m.formatMessage(k?Mn.dailyBriefPillReview:Mn.dailyBriefPillGenerate),icon:Jt().N,handleClick:j,isNew:!0,hasThreadForToday:k,onSecondaryButtonClick:k?T:void 0}}),[j,T,m,k]),_=(0,r.useMemo)((()=>{if(!A)return e;const t=e.slice(0,kn-1);return t.push(A),t}),[A,e]),B=a||t,P=(0,bt().pg)({numItems:B?_.length:0,animateIndexOffset:0,disableAnimation:a});(0,r.useEffect)((()=>{if("card"!==s||!w.current)return;const e=e=>e>690?4:e>340?2:1,t=new ResizeObserver((t=>{for(const n of t){const t=n.contentRect.width,a=e(t);x(a)}}));return t.observe(w.current),()=>{t.disconnect()}}),[s]);const R=(0,r.useCallback)((()=>{v&&nn({environment:f,userSettingsStore:v,dismissed:!0})}),[v,f]);(0,r.useEffect)((()=>()=>{C.current&&(R(),clearTimeout(C.current))}),[R]);const E=(0,r.useRef)(!1),F=(0,r.useMemo)((()=>_.filter(((e,t)=>P.has(t))).map((e=>e.type))),[_,P]);(0,r.useEffect)((()=>{F.length>0&&!E.current&&(X().trackAgentPrebuiltPromptShownToUser({environment:f,promptTypes:F,inferenceInfo:l}),E.current=!0)}),[F,l,f]);const W=[{key:"agent-suggested-actions",items:_.map(((e,t)=>({key:`suggested-action-${t}`,render:r=>(0,D.jsx)(Dn,{suggestedActionInfo:e,menuListItemProps:r,visible:P.has(t),isLoading:n,index:t,disableAnimation:a,variant:s}),action:()=>e.handleClick()}))),render:e=>(0,D.jsx)(Xt().A,{style:L.actionSectionItem,...e})}],L=(0,h().IS)((()=>({actionSection:{width:"100%",display:"flex",flexDirection:"column",alignItems:"flex-start"},actionSectionItem:{width:"100%",padding:"4px 0"},pillContainer:{display:"flex",flexDirection:"row",flexWrap:"wrap",width:"100%",rowGap:12,columnGap:8,justifyContent:"center"},cardContainer:{width:"100%",display:"grid",gridTemplateColumns:`repeat(${b}, 1fr)`,gap:16,justifyContent:"center",marginBottom:c?0:16,maxHeight:c?0:200,opacity:c?0:1,transform:c?"translateY(-20px)":"translateY(0)",transition:`margin-bottom ${Tn}ms ease-out, max-height ${Tn}ms ease-out, opacity ${Tn}ms ease-out, transform ${Tn}ms ease-out`,overflow:"hidden"},getStartedContainer:{gridColumn:"1 / -1",display:"flex",alignItems:"center",justifyContent:"space-between",paddingInlineStart:8,marginBottom:-8},dismissButton:{borderRadius:"50%",width:24,height:24,display:"flex",alignItems:"center",justifyContent:"center"}})),[b,c]),K=(0,r.useCallback)((()=>{u(!0),C.current&&clearTimeout(C.current),C.current=setTimeout((()=>{R(),C.current=void 0}),Tn)}),[R]),N=(0,p().K8)((()=>{if("card"!==s)return!1;if(!v)return!0;const e=v.getSettings();return!(null!=e&&e.dismissed_agent_get_started_banner)}),[v,s]);return"pill"===s||"card"===s?"card"!==s||N?(0,D.jsxs)("div",{ref:"card"===s?w:void 0,style:"card"===s?L.cardContainer:L.pillContainer,children:["card"===s?(0,D.jsxs)("div",{style:L.getStartedContainer,children:[(0,D.jsx)(M().D,{styleKey:"captionRegular",colorVariant:"secondary",children:(0,D.jsx)(G().sA,{...Mn.getStarted})}),(0,D.jsx)(S().A,{icon:Qt().xMarkSmallIcon,style:L.dismissButton,colorPalette:"gray",ariaLabel:m.formatMessage(Mn.dismissButton),onClick:K})]}):void 0,_.map(((e,t)=>(0,D.jsx)(Dn,{suggestedActionInfo:e,menuListItemProps:void 0,visible:P.has(t),isLoading:n,index:t,disableAnimation:a,variant:s},`suggested-action-${t}`)))]}):null:(0,D.jsx)(Gt().A,{menuType:Ut().gu.Popup,disableScroller:!0,height:"auto",maxHeight:220,width:"100%",children:(0,D.jsx)($t().A,{type:$t().O.Vertical,sections:W,initialFocus:void 0,disableInitialScroll:!0,resetFocusOnMouseOut:!0,captureKeyboardOnlyWhenFocused:!0,style:L.actionSection})})}function Dn({suggestedActionInfo:e,menuListItemProps:t,visible:n,isLoading:a,index:o,disableAnimation:i,variant:s="list"}){const l=(0,G().tz)(),[d,c]=(0,r.useState)(!1),[u,g]=(0,r.useState)(!1),[m,f]=(0,r.useState)(!1);(0,r.useEffect)((()=>{if(i)f(!0);else if(n&&e.isNew&&!a){const e=setTimeout((()=>{f(!0)}),300);return()=>clearTimeout(e)}}),[n,e.isNew,a,i]);const v=(0,p().K8)((()=>ae().globalChatPanelRuntimeStore.state.chatPanelMode),[]),w=(0,D.jsx)(qt().E,{color:"blue",content:(0,D.jsx)(M().D,{styleKey:"captionRegular",colorPalette:"blue",children:(0,D.jsx)(G().sA,{id:"AgentSuggestedActions.newBadge",defaultMessage:"New"})})}),C=(0,bt().$5)(n),k=(0,h().IS)((()=>({animatedItem:{...i?{}:C},actionItemStyle:{width:"100%",minHeight:"unset",padding:"8px 8px",...i?{}:C},actionItemButtonStyle:{marginBottom:"1px",marginTop:"1px",borderRadius:"popup"===v?"16px":"6px",display:"flex",justifyContent:"space-between",alignItems:"center",gap:8,maxWidth:"100%",overflow:"hidden",height:32},actionItemRightStyles:{marginInlineStart:0},shimmerItem:{width:"100%",height:16,padding:"8px 8px",borderRadius:"popup"===v?16:6},pillButton:{display:"flex",alignItems:"center",height:32,maxWidth:"100%",minWidth:0,padding:"4px 10px",borderRadius:16,cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap",overflow:"hidden",color:Y().Tj.text.primary,backgroundColor:Y().Tj.gray.background.primaryTranslucent,gap:6,...i?{}:C},pillIcon:{marginInlineEnd:6,flexShrink:0},pillText:{minWidth:0,flex:1},hoveredPillButton:{backgroundColor:Y().Tj.gray.background.tertiary},secondaryButtonContainer:{display:"flex",alignItems:"center",justifyContent:"center",marginInlineStart:4,flexShrink:0,opacity:d?1:0,transition:"opacity 0.1s ease-in-out"},pillSecondaryButton:{height:24,width:24,margin:0,padding:0},listSecondaryButton:{height:24,width:24,margin:0,padding:0},pillShimmerItem:{height:16,borderRadius:16},cardButton:{display:"flex",flexDirection:"column",alignItems:"flex-start",gap:10,padding:12,borderRadius:16,cursor:"pointer",transition:"all 0.2s ease",whiteSpace:"nowrap",color:Y().Tj.text.secondary,backgroundColor:Y().Tj.gray.background.primaryTranslucent,flexBasis:0,flexGrow:1,...i?{}:C},cardTopRow:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},cardText:{fontSize:12,fontWeight:400,lineHeight:1.2,width:"100%",wordWrap:"break-word",overflowWrap:"break-word",whiteSpace:"normal"},hoveredCardButton:{backgroundColor:Y().Tj.gray.background.tertiary},cardShimmerItem:{height:16,borderRadius:16},cardSecondaryButton:{height:24,width:24,margin:0,padding:0}})),[C,i,v,d]);if("translate"===e.type){const e="card"===s?"pill":s;return(0,D.jsx)("div",{style:k.animatedItem,children:(0,D.jsx)(wn,{menuListItemProps:t,isLoading:a,variant:e})})}const j="daily_brief"===e.type&&!0===e.hasThreadForToday&&void 0!==e.onSecondaryButtonClick,T=l.formatMessage(Mn.clearDailyBriefButton);return"pill"===s?(0,D.jsx)(Ot().Ay,{disabled:a,onClick:()=>e.handleClick(),onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),style:k.pillButton,hoveredStyle:k.hoveredPillButton,children:a?(0,D.jsx)(b().P,{style:{...k.pillShimmerItem,width:In[o]}},o):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(x().I,{style:k.pillIcon,icon:e.icon,colorVariant:"primary"}),(0,D.jsx)(M().D,{styleKey:"bodyRegular",textOverflow:"ellipsis",style:k.pillText,children:e.suggestedAction}),j?(0,D.jsx)("div",{style:k.secondaryButtonContainer,children:(0,D.jsx)(I().m,{renderTooltip:()=>T,placement:"top",alignment:"center",delayThreshold:400,render:t=>(0,D.jsx)(S().A,{...t,onMouseEnter:e=>{var n;g(!0),null===(n=t.onMouseEnter)||void 0===n||n.call(t,e)},onMouseLeave:e=>{var n;g(!1),null===(n=t.onMouseLeave)||void 0===n||n.call(t,e)},icon:{icon:Zt().N,size:"default"},style:k.pillSecondaryButton,ariaLabel:T,onClick:t=>{var n;t.stopPropagation(),null===(n=e.onSecondaryButtonClick)||void 0===n||n.call(e)}})})}):null]})}):"card"===s?(0,D.jsx)(Ot().Ay,{disabled:a,onClick:()=>e.handleClick(),onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),style:k.cardButton,hoveredStyle:k.hoveredCardButton,children:a?(0,D.jsx)(b().P,{style:{...k.cardShimmerItem,width:"100%"}},o):(0,D.jsxs)(D.Fragment,{children:[(0,D.jsxs)("div",{style:k.cardTopRow,children:[(0,D.jsx)(x().I,{icon:e.icon,colorVariant:"secondary"}),j?(0,D.jsx)("div",{style:k.secondaryButtonContainer,children:(0,D.jsx)(I().m,{renderTooltip:()=>T,placement:"bottom",alignment:"center",delayThreshold:400,render:t=>(0,D.jsx)(S().A,{...t,onMouseEnter:e=>{var n;g(!0),null===(n=t.onMouseEnter)||void 0===n||n.call(t,e)},onMouseLeave:e=>{var n;g(!1),null===(n=t.onMouseLeave)||void 0===n||n.call(t,e)},icon:{icon:Zt().N,size:"default"},style:k.cardSecondaryButton,ariaLabel:T,onClick:t=>{var n;t.stopPropagation(),null===(n=e.onSecondaryButtonClick)||void 0===n||n.call(e)}})})}):null]}),(0,D.jsx)("div",{style:k.cardText,children:e.suggestedAction})]})}):t?(0,D.jsx)("div",{onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1),children:(0,D.jsx)(Yt().A,{...t,disabled:a,onClick:()=>e.handleClick(),title:a?(0,D.jsx)(b().P,{style:{...k.shimmerItem,width:In[o]}},o):(0,D.jsxs)(y().Y1,{align:"center-left",gap:14,direction:"horizontal",children:[(0,D.jsx)(M().D,{styleKey:"bodyRegular",textOverflow:"ellipsis",children:e.suggestedAction}),e.isNew&&m?i?w:(0,D.jsx)(Nt().P.span,{initial:{opacity:0,scale:0},animate:{opacity:1,scale:1},transition:{delay:.12*o,duration:.3,type:"spring",damping:25},children:w}):null]}),focused:t.focused,left:a?null:(0,D.jsx)(x().I,{icon:e.icon,colorVariant:"primary"}),right:j?(0,D.jsx)("div",{style:k.secondaryButtonContainer,children:(0,D.jsx)(I().m,{renderTooltip:()=>T,placement:"top",alignment:"center",delayThreshold:400,render:t=>(0,D.jsx)(S().A,{...t,onMouseEnter:e=>{var n;g(!0),null===(n=t.onMouseEnter)||void 0===n||n.call(t,e)},onMouseLeave:e=>{var n;g(!1),null===(n=t.onMouseLeave)||void 0===n||n.call(t,e)},icon:{icon:Zt().N,size:"default"},style:k.listSecondaryButton,ariaLabel:T,onClick:t=>{var n;t.stopPropagation(),null===(n=e.onSecondaryButtonClick)||void 0===n||n.call(e)}})})}):void 0,leftStyle:{margin:0},buttonStyle:k.actionItemButtonStyle,style:k.actionItemStyle,rightStyle:k.actionItemRightStyles,ignoreLocalHoverState:!1})}):null}(0,n(466103).exposeDebugEnvironmentValue)("resetAgentGetStartedBanner",(e=>()=>{const{currentUserSettingsStore:t}=i().default.state;return t?(nn({environment:e,userSettingsStore:t,dismissed:!1}),"Agent get started banner dismissal state has been reset. Refresh the page to see it again."):"No user settings store found"}));var Rn=()=>n(259803),En=()=>n(336610),Fn=()=>n(324883),Wn=()=>n(284371),Ln=()=>n(911017);function Kn({threadStore:e,environment:t,variant:n,renamable:a=!1}){const o=(0,G().tz)(),[i,s]=(0,r.useState)(!1),[l,d]=(0,r.useState)(!1),c=(0,h().IS)((()=>({container:{flex:1,minWidth:0,overflow:"hidden",display:"flex",alignItems:"center"},titleButton:{display:"flex",alignItems:"center",minWidth:50,height:"auto",paddingBlock:6,cursor:"text",..."pill"===n?{borderRadius:50,paddingInline:8}:{paddingInline:6}},titleButtonHovered:{background:void 0},titleContent:{display:"flex",alignItems:"center",gap:6,flex:1,minWidth:0},editIcon:{flexShrink:0,opacity:l?1:0,transition:"opacity 150ms ease-out"},editingContainer:{display:"flex",alignItems:"center",flex:1,minWidth:0,background:void 0,paddingBlock:6,lineHeight:"20px",..."pill"===n?{borderRadius:50,paddingInline:8}:{paddingInline:6}},editingInput:{fontWeight:Wn().Wy.medium,lineHeight:"20px"}})),[n,l]),u=(0,p().K8)((()=>{var t;const n=null==e||null===(t=e.getData())||void 0===t?void 0:t.title;return n&&n.length?n:o.formatMessage({id:"chatSidebar.newChat",defaultMessage:"New chat"})}),[e,o]),g=(0,r.useCallback)((()=>{a&&s(!0)}),[a]),m=(0,r.useCallback)((()=>{s(!1),d(!1)}),[]);return(0,D.jsx)("div",{style:c.container,children:a?i?(0,D.jsx)(Ln().d,{threadStore:e,onBlur:m,style:c.editingContainer,inputStyle:c.editingInput,format:"transparent"},"editing"):(0,D.jsx)(St().p,{onClick:g,style:c.titleButton,hoveredStyle:c.titleButtonHovered,pressedStyle:c.titleButtonHovered,shouldShrink:!0,disallowTabbing:!0,onMouseEnter:()=>d(!0),onMouseLeave:()=>d(!1),children:(0,D.jsxs)("div",{style:c.titleContent,children:[(0,D.jsx)(Nn,{value:u}),(0,D.jsx)(x().I,{icon:Fn().s,size:"sm",colorVariant:"secondary",style:c.editIcon})]})}):(0,D.jsx)(Nn,{value:u})})}function Nn({value:e}){const t=(0,h().IS)((()=>({text:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontWeight:500,lineHeight:"20px"}})),[]);return(0,D.jsx)(En().D,{styleKey:"bodyRegular",style:t.text,children:e})}var Vn=()=>n(731881),zn=()=>n(292985),Hn=()=>n(592933),On=()=>n(552736);const qn=32,Un=qn,Gn=12,Yn=150;function $n(e){const{environment:t,isTablet:n,nextConfigType:a,runningInference:o,threadId:i,threadStarted:s,transcript:l}=e,c=(0,d().X)("ai_product_agent_chat_scroll_behavior_v2"),u=(0,r.useRef)(null),g=(0,r.useRef)(null),h=(0,r.useRef)(0),m=(0,r.useRef)(!1),v=(0,r.useRef)(void 0),y=(0,r.useRef)(void 0),b=(0,r.useRef)(void 0),x=(0,r.useRef)(void 0),S=(0,r.useRef)(void 0),w=(0,r.useRef)(!1),C=(0,r.useRef)(void 0),M=(0,r.useRef)(void 0),I=(0,r.useRef)(void 0),k=(0,r.useRef)(!0),[j,T]=(0,r.useState)(!1),[A,_]=(0,r.useState)(!0),[B,P]=(0,r.useState)(0),D=(0,r.useCallback)((()=>{(0,me().I)({environment:t})}),[t]),R=(0,r.useCallback)((e=>{k.current=e}),[]),E=!o&&(0,Hn().G1)(l),F=(0,r.useCallback)(((e="smooth")=>{const n=u.current;if(n)if(c){const a=g.current;if(!a)return;const r=n.getBoundingClientRect(),o=a.getBoundingClientRect().bottom-r.bottom,i=Math.max(0,n.scrollTop+o+Gn);(0,zn().V)({element:n,environment:t,options:{top:i,behavior:e}})}else{R(!0);const a=Math.max(0,n.scrollHeight-n.clientHeight);(0,zn().V)({element:n,environment:t,options:{top:a,behavior:e}})}}),[t,c,R]),{checkScrollPosition:W}=function({scrollableRef:e,enabled:t,scrollToBottom:n,dismissKeyboard:a}){const o=(0,r.useRef)(0),i=(0,r.useRef)(0),s=(0,r.useRef)(0),l=(0,r.useRef)(0),d=(0,r.useRef)(!1),c=(0,r.useCallback)((()=>{const n=e.current;if(!n)return;const r=n.scrollTop,c=performance.now(),u=c-s.current,g=r-o.current,p=g<0,h=u>10&&Math.abs(g)>0?Math.abs(g)/u:0;if(i.current=h,t&&p&&((0,On().W)(n)??0)>0){const e=Math.abs(g),t=h>1,n=e>20,o=r<=50;c-l.current>1e3&&(t&&o&&n||h>2&&e>50)&&(l.current=c,d.current=!0,a())}o.current=r,s.current=c}),[t,a,e]),u=(0,p().K8)((()=>f().A.state.phase),[]);return(0,r.useEffect)((()=>{if(t)if(u===f().i.shown){if(d.current)return void(d.current=!1);setTimeout((()=>{const t=e.current;if(!t)return;const a=t.scrollHeight-t.scrollTop-t.clientHeight;n(a>500?"instant":"smooth")}),400)}else u!==f().i.hidden&&u!==f().i.willHide||setTimeout((()=>{const t=e.current;if(t)if(t.scrollHeight-t.scrollTop-t.clientHeight<100)n("instant");else{const e=Math.max(0,t.scrollHeight-t.clientHeight);t.scrollTop>e&&n("instant")}}),200)}),[u,n,t,e]),(0,r.useEffect)((()=>{if(!t)return;const a=()=>{const t=e.current;t&&t.scrollTop<500&&setTimeout((()=>{n("instant")}),100)};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)}),[n,t,e]),(0,r.useEffect)((()=>{0===s.current&&(s.current=performance.now())}),[]),{checkScrollPosition:c}}({scrollableRef:u,enabled:Boolean(zt().A.isMobile)&&!n,scrollToBottom:F,dismissKeyboard:D}),L=(0,r.useCallback)((()=>{const e=u.current;if(!e)return;const t=e.scrollTop;if(c){const n=g.current,a=(()=>{if(!n)return!0;const t=e.getBoundingClientRect();return n.getBoundingClientRect().bottom-t.bottom<=50})(),r=0===t;h.current=t,T(r),_(a)}else{const n=t-h.current<0,r=e.scrollHeight-e.scrollTop-e.clientHeight<50,o=0===t;h.current=t,T(o),_(r);const i=k.current;n&&!r&&i&&R(!1),"search"!==a&&r&&!i&&R(!0)}W()}),[W,c,a,R]),K=(0,r.useCallback)((()=>{if(!c)return void P(0);const e=u.current;if(!e)return;const t=g.current;if(!t)return void P(0);const n=(()=>{const t=x.current,n=S.current;if(t&&t.isConnected&&(!n||t.getAttribute("data-agent-chat-user-step-id")===n))return t;if(n){const t=e.querySelector(`[data-agent-chat-user-step-id="${n}"]`);if(t instanceof HTMLElement)return x.current=t,t}const a=e.querySelectorAll("[data-agent-chat-user-step-id]"),r=a.item(a.length-1);return r&&(x.current=r,S.current=r.getAttribute("data-agent-chat-user-step-id")??void 0),r??void 0})();if(!n)return void P(0);const a=e.getBoundingClientRect(),r=n.getBoundingClientRect(),o=t.getBoundingClientRect(),i=e.scrollTop+(r.top-a.top),s=e.scrollTop+(o.bottom-a.top),l=Math.max(0,s-i),d=Math.max(0,e.clientHeight-Un-l),p=Math.round(d);P((e=>e===p?e:p))}),[c]);(0,r.useEffect)((()=>{if(!c)return;const e=u.current,t=g.current;if(!e||!t)return;const n=t.parentElement;if(!n)return;let a;const r=()=>{void 0===a&&(a=requestAnimationFrame((()=>{a=void 0,K()})))};r();const o=new ResizeObserver(r);return o.observe(e),o.observe(n),()=>{o.disconnect(),void 0!==a&&cancelAnimationFrame(a)}}),[c,i,K]),(0,r.useEffect)((()=>{const e=u.current;if(!e)return T(!0),_(!0),void(c||R(!0));if(!c){if("search"===a)return void R(!1);const t=setTimeout((()=>{e.scrollTop=E?0:e.scrollHeight,h.current=e.scrollTop,R(!0),requestAnimationFrame((()=>L()))}),100);return()=>clearTimeout(t)}return v.current=void 0,m.current?(m.current=!1,v.current=i,e.scrollTop=0,void requestAnimationFrame((()=>L()))):"search"===a?(e.scrollTop=0,void requestAnimationFrame((()=>L()))):void requestAnimationFrame((()=>{F("instant"),L()}))}),[L,c,a,F,R,E,i]),(0,r.useEffect)((()=>{if(!c)return;if(!i)return;if(m.current)return;if("search"===a)return;if(v.current===i)return;if(0===l.length)return;const e=u.current,t=g.current;e&&t&&requestAnimationFrame((()=>{const e=u.current,t=g.current;e&&t&&(F("instant"),v.current=i,L())}))}),[L,c,a,F,i,l.length]),(0,r.useEffect)((()=>{if(!c||!E)return;const e=u.current;e&&(e.scrollTop=0,requestAnimationFrame((()=>L())))}),[L,c,E]),(0,r.useEffect)((()=>{const e=u.current;if(!e)return;if(!c){e.addEventListener("scroll",L);const t=new MutationObserver((()=>{k.current&&(e.scrollTop=e.scrollHeight,h.current=e.scrollTop),setTimeout(L,100)}));return t.observe(e,{childList:!0,subtree:!0,characterData:!0}),setTimeout(L,100),()=>{e.removeEventListener("scroll",L),t.disconnect()}}const n=n=>{void 0!==I.current&&(cancelAnimationFrame(I.current),I.current=void 0);const a=Math.max(0,Math.min(n,e.scrollHeight-e.clientHeight));if(zt().A.isMobile||t.device.isSafari)return e.scrollTop=a,void requestAnimationFrame((()=>L()));const r=e.scrollTop,o=a-r;if(Math.abs(o)<1)return void requestAnimationFrame((()=>L()));const i=performance.now(),s=t=>{const n=Math.min(1,(t-i)/Yn),a=1-Math.pow(1-n,3);e.scrollTop=r+o*a,n<1?I.current=requestAnimationFrame(s):(I.current=void 0,requestAnimationFrame((()=>L())))};I.current=requestAnimationFrame(s)},a=e=>{if(!(e instanceof Element))return;if(e instanceof HTMLElement&&e.hasAttribute("data-agent-chat-user-step-id"))return e;const t=e.querySelector("[data-agent-chat-user-step-id]");return t instanceof HTMLElement?t:void 0};e.addEventListener("scroll",L),(()=>{const t=e.querySelectorAll("[data-agent-chat-user-step-id]"),n=t.item(t.length-1),a=(null==n?void 0:n.getAttribute("data-agent-chat-user-step-id"))??void 0;y.current=i,b.current=a,x.current=n??void 0,S.current=a})();const r=new MutationObserver((e=>{let t,r;for(const n of e)if("childList"===n.type)for(const e of Array.from(n.addedNodes)){const n=a(e),o=(null==n?void 0:n.getAttribute("data-agent-chat-user-step-id"))??void 0;n&&o&&(t=n,r=o)}t&&r&&(x.current=t,S.current=r,K(),C.current=t,M.current=r,w.current||(w.current=!0,requestAnimationFrame((()=>{w.current=!1;const e=u.current;if(!e)return;const t=C.current??void 0,a=M.current??void 0;if(C.current=void 0,M.current=void 0,!t||!a)return;if(y.current!==i)return y.current=i,void(b.current=a);const r=b.current;if(r===a)return;if(b.current=a,!r)return;const o=e.getBoundingClientRect(),s=t.getBoundingClientRect(),l=e.scrollTop+(s.top-(o.top+Un));n(l)})))),setTimeout(L,100)}));return r.observe(e,{childList:!0,subtree:!0}),setTimeout(L,100),()=>{e.removeEventListener("scroll",L),r.disconnect(),void 0!==I.current&&(cancelAnimationFrame(I.current),I.current=void 0)}}),[L,t.device.isSafari,c,i,K]),(0,r.useEffect)((()=>{c&&requestAnimationFrame((()=>L()))}),[L,c,o]);const N=(0,r.useCallback)((()=>{c?s||(m.current=!0):F("smooth")}),[c,F,s]),V=c?!A&&!o:!A,z=V?0:-1,H=(0,r.useCallback)((()=>{F("smooth")}),[F]);return{isScrollBehaviorV2Enabled:c,isScrolledToBottom:A,isScrolledToTop:j,onScrollToBottomButtonClick:H,onWillSubmit:N,scrollToBottom:F,scrollToBottomButtonTabIndex:z,shouldShowScrollToBottomButton:V,scrollableRef:u,bottomSpacerHeight:c?B:0,transcriptBottomRef:g}}var Xn=()=>n(869222),Zn=()=>n(459629),Jn=()=>n(533695),Qn=()=>n(323756),ea=()=>n(700226),ta=()=>n(912749);function na(e){const{workflowStore:t}=e,{workflowValue:n}=(0,ta().N)(t,!0),{icon:a,name:r}=n,o=ea().lv*ea().iU,i=(0,h().IS)((()=>({headerRow:{display:"flex",alignItems:"center",gap:12,marginTop:8,marginBottom:8},nameInput:{fontSize:ea().lv,fontWeight:Wn().Wy.bold,lineHeight:ea().iU}})),[]);return(0,D.jsxs)("div",{style:i.headerRow,children:[(0,D.jsx)(Ee().AgentIcon,{agentIcon:a,workflowStore:t,size:40}),(0,D.jsx)("div",{style:i.nameInput,children:(0,D.jsx)(Qn().E,{placeholder:"New agent",value:r,onChange:()=>{},disabled:!0,debugName:"AgentChatHeaderName",autosizeMinHeight:o})})]})}function aa(e){const{aiChatFeature:t,clientStore:n,onAutoSubmitHandlerReady:c,onEsc:u,onThreadChange:m,parentStore:b,threadStore:S,threadStoreState:C="ready",transcript:I,isFullPageOverride:k}=e,j=(0,qe().K7)(t),A=(0,g().v3)(),_=(0,d().X)("agent_integrations"),B=(0,d().X)("custom_agent_flippy_layout"),{isTablet:P}=(0,g().Y0)(),R=(0,ge().U)(),E="sidebar"===j.agentChatFormFactor&&R,[F,W]=(0,r.useState)(S),L=(0,o().L)(),{state:K,steps:H,completedAt:O}=(0,oe().q)("agent_new_user_onboarding"),q=(0,r.useCallback)((()=>{(0,re().AK)({environment:A,checklistId:"agent_new_user_onboarding",state:"open"})}),[A]),U=(0,p().K8)((()=>{const e=null==F?void 0:F.getParentStore();if(L&&e)return e&&e.table===V().C0?e.getCreatedById()?e:v().N.createChildStore(L,{table:V().C0,id:e.id,spaceId:L.id}):void 0}),[F,L]),[ne,se]=(0,r.useState)(void 0),ce=(0,p().K8)((()=>{var e;return(null===(e=i().default.state.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.started_agent_chat_thread)??!1}),[]),ue=(0,p().K8)((()=>(0,We().jp)(U)),[U]),he=(0,p().K8)((()=>(null==U?void 0:U.canAdmin())??!1),[U]);(0,r.useEffect)((()=>{const e=(0,de().dr)(null==S?void 0:S.id)??S;W(e),Zt(ce)}),[S,ce]);const fe=(0,p().K8)((()=>{const{device:e}=A,t=j.aiChatType;return(e.isMobileNative||e.isTablet)&&("agent"===t||"agent_full_page"===t)?(0,pe().y)(A,f().A.state.estimatedKeyboardWebViewOverlap,f().A.state.nativeBottomBarHeight):0}),[A,j.aiChatType]),ve=(0,p().K8)((()=>n.state.showDebug),[n]),ye=(0,r.useMemo)((()=>{if(B)for(const e of I)if("agent-message"===e.type&&e.parentThreadUrl)return e}),[B,I]),be=(0,r.useMemo)((()=>ye?I.filter((e=>e.id!==ye.id)):I),[ye,I]),Ie=(0,r.useRef)(null),[ke,je]=(0,r.useState)(!1),Te=(0,p().K8)((()=>(0,Ge().OT)(F)),[F]),Ae=(0,p().K8)((()=>(0,Ge().Ft)({threadStore:F,clientStore:n})),[F,n]),_e=(0,p().K8)((()=>!!F&&F.getTranscript().some((e=>"config"===e.type))),[F]),Ee=(0,p().K8)((()=>!F||F.inMemoryRecordCache!==A.defaultRecordCache.inMemoryRecordCache||!!F.isReady()&&F.getMessageStores().every((e=>e.isReady()))),[A.defaultRecordCache.inMemoryRecordCache,F]),Fe=(0,Me().u)(),{variant:ze}=(0,Ce().n)(),Qe=!Te&&"loading"!==C&&Ee,tt=(0,p().K8)((()=>{if(!U||!L)return;return(0,Le().getWorkflowAgentConfig)({environment:A,spaceId:L.id,isCustomAgent:!0,workflowId:U.id,useCustomAgentDraft:he})}),[A,he,L,U]),{nextConfig:lt,setNextConfig:dt}=(0,ot().I)({threadStore:F,spaceId:null==b?void 0:b.id,defaultConfig:_e?void 0:tt}),ct="workflow"===lt.type&&!0===lt.isCustomAgent,{isScrollBehaviorV2Enabled:ut,scrollableRef:gt,transcriptBottomRef:pt,bottomSpacerHeight:ht,isScrolledToTop:ft,scrollToBottom:vt,onWillSubmit:yt,onScrollToBottomButtonClick:bt,scrollToBottomButtonTabIndex:xt,shouldShowScrollToBottomButton:St}=$n({environment:A,isTablet:P,nextConfigType:lt.type,runningInference:Ae,threadId:null==F?void 0:F.id,threadStarted:Te,transcript:I}),wt=(0,h().eP)(),Ct=(0,h().IS)((()=>({twoColumnContainer:{minHeight:0,flex:1,pointerEvents:"auto"},chatColumn:{pointerEvents:"auto",flex:1,display:"flex",flexDirection:"column",minHeight:0,maxWidth:"100%",position:"relative"},chatContainer:{flex:1,position:"relative",scrollbarGutter:"stable",overflowY:"auto",...!(E&&Qe)?(0,Ue().o)({gradientMaskHeight:qn,isScrolledToTop:ft}):{}},contentContainer:{margin:"0 auto",width:"100%",maxWidth:j.chatInputWidth,paddingTop:16,paddingInlineEnd:E?24:16,paddingBottom:0,paddingInlineStart:E?24:16,marginInlineStart:"auto"},emptyContainer:{display:"flex",flexDirection:"column",height:"100%",paddingBottom:j.emptyContainerBottomPadding},emptySpacer:{flex:1},transcript:{display:"flex",flexDirection:"column",marginBottom:16,gap:8},inputWrapper:{flex:"0 0 auto",position:"relative",backgroundColor:j.hasAgentBackground&&!R?Y().Tj.background.primary:void 0,backgroundImage:j.hasAgentBackground&&!R?"linear-gradient(to right, rgba(0, 0, 0, 0.008), rgba(0, 0, 0, 0) 32px), linear-gradient(to right, rgba(0, 0, 0, 0.01), rgba(0, 0, 0, 0) 72px)":void 0,padding:j.chatInputContainerPadding},scrollToBottomButton:{position:"absolute",insetInlineStart:"50%",bottom:"100%",transform:"translate(-50%, -8px)",zIndex:2,padding:6,borderRadius:20,backgroundColor:"dark"===wt?"#fff":"#000",border:"none",cursor:"pointer",fontWeight:500,boxShadow:"dark"===wt?`0px 0px 0px 0.5px ${Y().Tj.border.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.12), 0px 4px 16px -2px rgba(0, 0, 0, 0.6)`:`0px 0px 0px 0.5px ${Y().Tj.border.primary}, 0px 1px 2px 0px rgba(0, 0, 0, 0.02), 0px 4px 16px -2px rgba(0, 0, 0, 0.1)`,transition:"opacity 150ms ease-out, transform 150ms ease-out",opacity:0,pointerEvents:"none"},scrollToBottomButtonVisible:{opacity:1,transform:"translate(-50%, -16px)",pointerEvents:"auto"},inputContainer:{display:"flex",flexDirection:"column",gap:8,margin:"0 auto",width:"100%",maxWidth:j.chatInputWidth,padding:j.chatInputPadding,marginInlineStart:"auto",flex:"0 0 auto",paddingBottom:fe},chevronDownIcon:{fill:"dark"===wt?"#000":Y().Tj.white,transform:"translateY(1px)"}})),[j.hasAgentBackground,j.chatInputContainerPadding,j.chatInputWidth,j.chatInputPadding,j.emptyContainerBottomPadding,fe,E,ft,R,Qe,wt]),Mt=B&&ct&&U,{shouldBlockChat:It,isLoading:kt,resources:jt}=(0,Xn().r)({environment:A,workflowStore:U,isCustomAgent:ct,spaceStore:L}),Tt=(0,r.useMemo)((()=>{if(ct||!I)return!1;if((0,$e().L)(I))return!0;const e=A.currentUser.id,t=new Set;for(const n of I)"user"===n.type&&n.userId&&t.add(n.userId);return!!e&&(t.size>0&&!t.has(e))}),[ct,I,A.currentUser.id]),At=(0,r.useCallback)((e=>{Ie.current=e}),[]),_t=(0,p().K8)((()=>{const e=ae().globalChatPanelRuntimeStore.state;if("open"===e.chatPanelVisibility)return e.chatPanelMode}),[]);(0,r.useEffect)((()=>{_t&&vt("instant")}),[_t,vt]);const Bt=(0,p().O$)(i().AppStoreMainEditorCurrentBlockStore),Pt=(0,p().O$)(Se().default.peekTargetStore),Rt=(0,it().q)({threadStore:F,clientAiChatStore:n,aiChatFeatureController:j,config:lt});(0,et().n)({environment:A,clientStore:n});const Et=(0,p().O$)(Ye().bX),Wt=(0,Ze().K)(),Lt=(0,te().AD)(),Nt=(0,Xe().N)({threadStore:S,spaceId:b.id}),Vt=(0,G().tz)(),zt=(0,p().K8)((()=>(0,xe().vE)([Bt,Pt].filter($().O9))),[Bt,Pt]),{handleChatSubmissionError:Ht}=(0,Je().yG)({}),Ot=(0,r.useCallback)((async e=>{const{prompt:t,config:a,contextStepSurfaceOverride:r,checklistId:o,checklistStepId:i}=e;let s;try{const e=function(e){const{prompt:t}=e,n=t.type;return"string"===n?{suggestedPrompt:{promptKey:"string_prompt",promptDescription:t.text}}:"text-value"===n?void 0!==t.text?{suggestedPrompt:{promptKey:"text_value_prompt",promptDescription:(0,z().q4_)(t.text)}}:void 0:"prebuilt-prompt"===n?{suggestedPrompt:{promptKey:t.promptType,promptDescription:t.text}}:void(0,$().HB)(n)}({prompt:t});if("prebuilt-prompt"===t.type&&j.supportsClearSelectionOnSubmit&&(0,me().I)({environment:A}),n.setState({...n.state,userSelectedConfig:!0}),!Et)throw new Error("No inference context");const{spaceStore:l,userStore:d,spaceViewStore:c}=Et;if(!b)throw new Error("No parent store");zt&&Z().DL({pageStore:zt,environment:A,triggeredFrom:"agent"}),(0,Q().maybeUpdateAiEligibility)(A,b.id);const u=ha({environment:A,spaceStore:l,userStore:d,prompt:t,intl:Vt});if(!u)return;const g=null==F?void 0:F.getTranscript().findLast((e=>"context"===e.type)),p=Lt.getOrCreateThreadId({environment:A,spaceId:l.id,maybeThreadStore:F}),h=[],f=n.getOrCreateClientAIChatThreadStore(p),v=f.getStagedMentionPointers(),y=(0,Ye().BX)({environment:A,spaceId:l.id,pointers:v});y&&h.push(y);const x=null==f?void 0:f.getAndClearStagedAssistantAttachmentSteps();if(x&&h.push(...x),!F||(0,Ge().av)(F)){const t=(0,Ge().hw)({config:a,hasAgentIntegrationsFeatureFlag:_})?await(0,Ge().oE)({agentChatIntegrations:Wt,environment:A,spaceStore:l,spaceViewStore:c}):void 0,g=(0,Ye().Xd)({environment:A,inferenceContext:Et,config:a,addSteps:[t,...h,u],surface:r??j.contextStepSurface,..."onboarding_checklist"===r?{checklistId:o,checklistStepId:i}:{}});if(F){const t=(0,Pe().addStepsToExistingThreadAndRun)({environment:A,clientStore:n,spaceStore:l,userStore:d,threadStore:F,addSteps:g,waitForServerCommit:!0,sendPartialTranscript:!0,temporaryAiThreadManager:Lt,analyticsArgs:e});m({newThreadStore:t})}else s=(0,Pe().addTranscriptToNewThreadAndRun)({environment:A,spaceStore:l,transcript:g}),m({newThreadStore:s});ne&&ne.length>0&&(f.updateMentionedStagedData(ra({inputMentionPointers:ne,stagedMentionPointers:v})),se([]))}else{(0,Ve().kh)({threadStore:F,config:a,environment:A});const t=[],s=(null==g?void 0:g.value.collectionViewBlockId)??(null==g?void 0:g.value.blockId),c=null==g?void 0:g.value.peekBlockId;"onboarding_checklist"!==r&&s===(null==Bt?void 0:Bt.id)&&c===(null==Pt?void 0:Pt.id)||t.push((0,Ye().WM)({environment:A,inferenceContext:Et,surface:r??j.contextStepSurface,config:a,..."onboarding_checklist"===r?{checklistId:o,checklistStepId:i}:{}})),x&&t.push(...x),y&&t.push(y),t.push(u),(0,Pe().addStepsToExistingThreadAndRun)({environment:A,clientStore:n,spaceStore:l,userStore:d,threadStore:F,addSteps:t,waitForServerCommit:!0,sendPartialTranscript:!0,temporaryAiThreadManager:Lt,analyticsArgs:e}),ne&&ne.length>0&&(f.updateMentionedStagedData(ra({inputMentionPointers:ne,stagedMentionPointers:v})),se([]))}return s}catch(l){Ht(l,"AgentChatView.handlePromptSubmit",{threadExists:Boolean(F),spaceId:null==b?void 0:b.id,configType:a.type})}}),[n,Et,b,zt,A,Lt,F,Vt,_,Wt,j.contextStepSurface,ne,m,null==Bt?void 0:Bt.id,null==Pt?void 0:Pt.id,Ht,j.supportsClearSelectionOnSubmit]),qt=(0,p().K8)((()=>(0,Ke().Ke)()),[]);(0,r.useEffect)((()=>{if(c){c((async e=>{Ie.current&&await Ie.current({prompt:(0,z().x9d)(e),config:lt})}))}}),[c,lt]);const Ut=(0,r.useCallback)((async(e,t,n,a)=>{const r=null==L?void 0:L.id,o="daily_brief_reminder"===n&&r?await(0,le().Jl)({environment:A,spaceId:r}):lt,i=await Ot({prompt:e,config:o,actionCardId:"text-value"===e.type?(0,z().q4_)(e.text??[]):e.text,prebuiltPromptType:"prebuilt-prompt"===e.type?e.promptType:void 0,contextStepSurfaceOverride:n,checklistId:null==a?void 0:a.checklistId,checklistStepId:null==a?void 0:a.checklistStepId});i&&await(null==t?void 0:t(i));try{const t="workflow"===lt.type?lt.model:void 0;X().trackPillsClicked({environment:A,prompt:e,model:t,aiModule:"ai_module"===j.contextStepSurface,inferenceInfo:Nt,blockStore:Bt})}catch(s){}}),[Ot,lt,A,j.contextStepSurface,Nt,Bt,null==L?void 0:L.id]),Gt=(0,r.useCallback)((e=>Ut({type:"string",text:e.prompt},void 0,"onboarding_checklist",{checklistId:e.checklistId,checklistStepId:e.stepId})),[Ut]),Yt=(0,r.useCallback)((async e=>{await Ut({type:"string",text:e})}),[Ut]),$t=(0,r.useCallback)((()=>{je(!0)}),[]),[Xt,Zt]=(0,r.useState)(ce);(0,r.useEffect)((()=>{const e=i().default.state.currentUserSettingsStore;e&&!ce&&Te&&(0,we().createAndCommit)({environment:A,userAction:"AgentChatView.setStartedAgentChatThread",canUndo:!1,perform:t=>{J().zv({store:e,data:{settings:{...e.getSettings(),started_agent_chat_thread:!0}},transaction:t})}})})),(0,r.useEffect)((()=>{const e=null==F?void 0:F.id;j.recordLastOpenState&&Te&&e&&!ct&&(0,ee().setChatLastOpenedState)(e)}),[Te,null==F?void 0:F.id,j.recordLastOpenState,ct]);const Jt=(0,r.useCallback)((()=>Zt(!0)),[]),Qt="loading"!==C,en=Be(),tn=ze&&"control"!==ze&&"open"===K&&void 0===O;return(0,D.jsx)(He().Wd,{isFullPage:k??("agent_full_page"===j.aiChatType||"full_page"===j.aiChatType||"ai_module"===j.aiChatType),children:(0,D.jsx)(a().N,{mode:"popLayout",children:(0,D.jsxs)(y().Y1,{direction:"vertical",width:"fill",height:"hug",style:{flex:1,minHeight:0,...j.chatViewMinWidth&&{minWidth:j.chatViewMinWidth}},children:[j.supportsChatHeader?(0,D.jsx)(oa,{aiChatFeatureController:j,threadStore:F,workflowStore:U,clientStore:n,onThreadChange:m,parentStore:b,threadStoreState:C,config:lt,hideThreadPicker:e.hideThreadPicker,hideActions:e.hideActions,hideAgentName:e.hideAgentName,shouldShowEmptyState:Qe,isOnboardingChecklistCollapsed:"collapsed"===K&&Boolean(ze&&"control"!==ze),numChecklistStepsCompleted:(null==H?void 0:H.filter((e=>e.completed)).length)??0,onExpandChecklist:q}):void 0,(0,D.jsxs)(y().Y1,{direction:"horizontal",style:Ct.twoColumnContainer,children:[j.supportsCollapsiblePanel&&qt?(0,D.jsx)(ie().z,{config:ve?{mode:"resizable",min:300,max:900,defaultSize:515,userOverride:void 0}:{mode:"closed"},anchorToSide:"left",children:(0,D.jsx)(nt().m,{clientStore:n,threadStore:F})}):null,(0,D.jsxs)("div",{style:Ct.chatColumn,children:[(0,D.jsx)("div",{style:Ct.chatContainer,ref:gt,children:(0,D.jsx)(s().K,{from:"AgentChatView",fallback:({error:e,errorId:t})=>(0,D.jsx)(l().LargeSurfaceRenderError,{error:e,errorId:t}),children:It?(0,D.jsx)("div",{style:Ct.contentContainer,children:(0,D.jsx)(Kt().i,{resources:jt,isLoading:kt})}):Qe?(0,D.jsxs)("div",{style:Ct.emptyContainer,children:[(0,D.jsx)("div",{style:Ct.emptySpacer}),(0,D.jsx)(Ft,{aiChatFeatureController:j,startedAgentChatThread:ce,onWelcomeAnimationsComplete:Jt,onSubmitPrompt:Gt}),!j.shouldShowSuggestedActions||"above"!==j.agentSuggestedActionsPlacementRelativeToChat||Fe||tn?null:(0,D.jsx)(_n,{loadAttachmentData:Rt,handlePromptSubmit:Ut,readyToAnimate:Xt,disableAnimation:ce,variant:j.agentSuggestedActionsDisplay,aiChatFeatureController:j,inferenceInfo:Nt})]}):Qt?(0,D.jsxs)(D.Fragment,{children:[Mt?(0,D.jsx)(Re().g,{workflowStore:U,disabled:!0}):null,(0,D.jsxs)("div",{style:Ct.contentContainer,children:[Mt?(0,D.jsx)(na,{workflowStore:U}):null,ye&&F?(0,D.jsx)(st().a,{threadStore:F,callerMessageStep:ye}):null,F?(0,D.jsx)("div",{style:Ct.transcript,children:(0,D.jsx)(M().D,{styleKey:"bodyRegular",children:(0,D.jsxs)(Oe().kW,{threadStore:e.threadStore,children:[(0,D.jsx)(Jn().Z,{transcript:be||[],spaceStore:b,threadStore:F,clientStore:n,configType:lt.type,isCustomAgent:ct,runningInference:Ae,showDebugOverride:ve,aiChatFeatureController:j,showAttribution:Tt,onFollowUpSelect:Yt}),ut?(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("div",{ref:pt}),ht>0?(0,D.jsx)("div",{style:{height:ht,flexShrink:0}}):null]}):null]})})}):void 0]})]}):(0,D.jsx)(y().Y1,{width:"fill",height:"fill",align:"center",children:(0,D.jsx)(w().k,{})})})}),It?null:(0,D.jsxs)("div",{style:Ct.inputWrapper,children:[ue?(0,D.jsx)("div",{style:Ct.inputContainer,children:(0,D.jsx)(De().t,{})}):void 0,ue?void 0:(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)("button",{onClick:bt,tabIndex:xt,style:{...Ct.scrollToBottomButton,...St&&Ct.scrollToBottomButtonVisible},children:(0,D.jsx)(x().I,{icon:T().arrowChevronSingleDownFillIcon,style:Ct.chevronDownIcon})}),E?void 0:(0,D.jsxs)("div",{style:Ct.inputContainer,children:[Fe?null:(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(mt().Xg,{isCustomAgent:ct}),(0,D.jsx)(Ne().q,{clientStore:n,threadStore:F,userStore:void 0})]}),Qe||!tn||Ae?null:(0,D.jsx)(Dt,{from:"existing_user",variant:"in_chat",steps:H,onSubmitPrompt:Gt}),U&&b&&b.table===N().NX&&!Fe&&!tn?(0,D.jsx)(at().D,{section:"chat",spaceStore:b,workflowStore:U}):null,(0,D.jsx)(rt().UnifiedChatInputProvider,{aiChatFeatureController:j,clientStore:n,threadStore:F,onEsc:u,onThreadChange:m,nextConfig:lt,setNextConfig:dt,onLoaded:$t,onWillSubmit:yt,onSubmitHandlerReady:At,mockTextStoreWithSetter:en,disabled:Ae}),ke||"ai_module"!==j.aiChatType?null:(0,D.jsx)(pa,{contentWidth:"number"==typeof j.chatInputWidth?j.chatInputWidth:600})]})]})]}),It||!j.shouldShowSuggestedActions||"below"!==j.agentSuggestedActionsPlacementRelativeToChat||Fe||tn?null:(0,D.jsx)(_n,{loadAttachmentData:Rt,handlePromptSubmit:Ut,readyToAnimate:Xt,disableAnimation:ce,variant:j.agentSuggestedActionsDisplay,aiChatFeatureController:j,chatLoaded:ke,inferenceInfo:Nt})]})]})]},(null==F?void 0:F.id)??"new-thread")})})}function ra({inputMentionPointers:e,stagedMentionPointers:t}){const n=e.map((e=>L().L3.toKey(e)));return t.filter((e=>!n.includes(L().L3.toKey(e))))}function oa(e){const{navigate:t}=(0,r.useContext)(u().E),n=(0,ge().U)(),{aiChatFeatureController:a,onThreadChange:o,clientStore:s,threadStore:l,workflowStore:f,parentStore:v,threadStoreState:b,config:x,shouldShowEmptyState:w,isOnboardingChecklistCollapsed:j,numChecklistStepsCompleted:T,onExpandChecklist:_}=e,B=(0,g().v3)(),P=(0,p().K8)((()=>{const{device:e,WindowSizeStore:t}=B,n="sidebar"===a.agentChatFormFactor;return(e.isMobileNative||e.isTablet)&&n?t.getSafePaddingTopPx(0):function(e){if(!e.isIOS)return!1;const t=(0,he().getMobileNativeDeviceInfo)();if(!t.mobileNativeSystemVersion)return!1;const n=t.mobileNativeSystemVersion.split(".").map((e=>parseInt(e,10))),a=[26,0];return(0,H().isGreaterThanOrEqualToVersion)(n,a)}(e)?t.getSafePaddingTopPx(8):0}),[B,a.agentChatFormFactor]),R=(0,r.useContext)(c().e),{isElectronWindows:E,isTablet:F}=(0,g().Y0)(),W=(0,r.useCallback)((()=>{if(!f)return;const e=(0,q().L)({workflowId:f.id,params:{workflowViewType:"chat"}});t({environment:B,url:e})}),[f,B,t]),L=(0,p().K8)((()=>{var e;return null==f||null===(e=f.getData())||void 0===e?void 0:e.icon}),[f]),N=(0,p().K8)((()=>{const e=(null==f?void 0:f.getDraftData())??(null==f?void 0:f.getData());return(0,U().uP)(e)}),[f]),V=(0,r.useCallback)((async({newThreadStore:e})=>{(0,Ve().Wq)({environment:B,clientStore:s}),e&&await e.load(),!f||e||N?o({newThreadStore:e}):W()}),[B,s,f,W,N,o]),z=(0,d().X)("agent_sidebar_only_agent_threads")||a.onlyShowAgentThreads,$=(0,p().O$)(m().b),X=(0,p().K8)((()=>!(0,be().KB)(B)),[B]),Z=!w&&!e.hideThreadPicker,J="pill"===a.headerButtonShape,Q=n&&R&&"sidebar"===a.agentChatFormFactor,te=(0,r.useCallback)((()=>{f?W():t({environment:B,url:K().JZ.ai})}),[f,W,B,t]),ae=(0,Qe().V)(l),re=(0,p().K8)((()=>{let e="Notion AI";if(f){const t=f.getData();null!=t&&t.name&&(e=t.name)}if("Notion AI"===e&&i().AppStoreSidebarSpaceViewStore.state){var t;const n=null===(t=i().AppStoreSidebarSpaceViewStore.state.getSettings())||void 0===t?void 0:t.agent_personalization_settings;null!=n&&n.name&&(e=n.name)}return e}),[f]),oe=(0,h().eP)(),ie=(0,h().IS)((()=>({headerContainer:{position:"relative"},agentName:{flexShrink:0,paddingInlineStart:6,paddingInlineEnd:6,minHeight:"unset"},separator:{color:Y().Tj.text.disabled,paddingInlineStart:2,paddingInlineEnd:2},floatingButton:{background:"dark"===oe?Y().Tj.gray.background.elevated:Y().Tj.background.primary,borderRadius:9999,boxShadow:Y().Tj.shadow.outline.sm}})),[oe]),se=(0,G().tz)(),le="sidebar"===a.agentChatFormFactor&&n,de=(0,r.useCallback)((()=>{var e;if(!l||!x)return;const n={id:l.id,configType:x.type,store:l,title:(null===(e=l.getData())||void 0===e?void 0:e.title)??"",description:"",createdTime:l.getCreatedTime()??Date.now(),updatedTime:l.getUpdatedTime()};(0,Ve().vy)({chatTranscriptInfo:n,environment:B,clientStore:tt().defaultClientAIChatStore}),(0,ee().clearChatLastOpenedState)(),"popup"===a.agentChatFormFactor||"sidebar"===a.agentChatFormFactor?(0,ee().createNewChatThread)(B):t({environment:B,url:K().JZ.ai})}),[l,x,B,t,a.agentChatFormFactor]),pe=(0,r.useCallback)((()=>{l&&(0,ze().VK)({environment:B,oldThreadStore:void 0,newThreadStore:l,openInNewTab:!0})}),[B,l]),me=le?(0,D.jsxs)(y().Y1,{direction:"horizontal",width:"fill",align:"center-left",gap:ae?6:12,style:{pointerEvents:"auto",minWidth:0,paddingInline:6},children:[(0,D.jsx)(I().m,{renderTooltip:()=>(0,D.jsx)(G().sA,{id:"chatSidebar.allChats",defaultMessage:"All chats"}),render:e=>(0,D.jsx)(S().A,{...e,icon:{icon:A().s,size:"sm"},colorVariant:"secondary",size:"md",style:ie.floatingButton,ariaLabel:se.formatMessage({id:"chatSidebar.allChats",defaultMessage:"All chats"}),onClick:R})}),(0,D.jsx)(Kn,{threadStore:l,environment:B,variant:a.headerButtonShape,renamable:ae})]}):(0,D.jsxs)(y().Y1,{direction:"horizontal",width:"hug",align:"center-left",style:{pointerEvents:"auto",minWidth:0},children:[!$&&X&&a.supportsNotionSidebarButton?(0,D.jsx)(ce().z,{}):null,Z?f&&!N?(0,D.jsx)(C().p,{onClick:W,style:{marginInlineStart:2,marginInlineEnd:4,display:"flex",alignItems:"center",justifyContent:"center",paddingInline:0},children:(0,D.jsx)(Ee().AgentIcon,{agentIcon:L,workflowStore:f,size:24})}):(0,D.jsx)(ht,{aiChatFeatureController:a}):void 0,e.hideAgentName?null:(0,D.jsx)(C().p,{onClick:te,style:ie.agentName,children:(0,D.jsx)(M().D,{styleKey:"bodyRegular",style:{fontSize:14,cursor:"pointer",textDecoration:"none"},children:re})}),e.hideThreadPicker?null:(0,D.jsxs)(D.Fragment,{children:[e.hideAgentName?null:(0,D.jsx)("span",{style:ie.separator,children:"/"}),(0,D.jsx)(Rn().AgentThreadHistoryMenu,{aiChatFeatureController:a,buttonShape:a.headerButtonShape,workflowId:x?(0,O().BI)(x):void 0,onThreadChange:V,parentStore:v,threadStore:l,threadStoreState:b,types:z?["workflow"]:void 0}),j?(0,D.jsx)(Lt,{progress:T/k().y.agent_new_user_onboarding.steps.length,onClick:_}):null]})]});return(0,D.jsx)(y().Y1,{direction:"vertical",width:"fill",style:{pointerEvents:"none",...ie.headerContainer},children:(0,D.jsx)(y().Y1,{direction:"vertical",padding:J?`${8+P}px 8px 8px 8px`:`${8+P}px ${le?16:12}px 8px ${le?16:12}px`,width:"fill",gap:4,children:(0,D.jsxs)(y().Y1,{direction:"horizontal",align:"center",gap:"auto",minGap:16,children:[me,e.hideActions?void 0:(0,D.jsxs)(y().Y1,{direction:"horizontal",width:le?"hug":"fill",align:"center-right",gap:2,style:{flexShrink:0,pointerEvents:"auto"},children:[(0,D.jsx)(lt().AgentChatActions,{threadStore:l,workflowStore:f,clientStore:s,aiChatFeatureController:a,onThreadChange:V,showOnHover:a.supportsChatActionsOnHover,features:{showInviteButton:!le,showNewChatButton:!le,showNewChatButtonIcon:!1}}),n&&"full_page"===a.agentChatFormFactor?(0,D.jsx)(ye().F,{threadId:null==l?void 0:l.id,size:"md",testId:"agent-chat-view-move-to-sidebar-button"}):null,!a.supportsChatSidebarModeButton||F||n?null:(0,D.jsx)(ne().ChatSidebarModeButton,{aiChatFeatureController:a}),Q&&!le?(0,D.jsx)(da,{aiChatFeatureController:a,threadStore:l}):null,le?(0,D.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,D.jsx)(Zn().y,{aiChatFeatureController:a,threadStore:l,variant:"icon_rounded"}),(0,D.jsx)(la,{onNewChat:()=>V({newThreadStore:void 0})}),(0,D.jsx)(sa,{threadStore:l})]}):null,a.supportsHeaderMenu&&l?(0,D.jsx)(Vn().R,{threadStore:l,onDelete:de,onOpenInNewTab:"popup"===a.agentChatFormFactor?pe:void 0,variant:"full_page"===a.agentChatFormFactor?"header":"header_compact"}):null,R&&!le?(0,D.jsx)(ia,{aiChatFeatureController:a,onClick:R}):null]}),E?(0,D.jsx)(ue().K,{}):void 0]})})})}function ia(e){const{aiChatFeatureController:t,onClick:n}=e,a="sidebar"===t.agentChatFormFactor,r=(0,ge().U)(),o=(0,G().tz)(),i=ga({shape:t.headerButtonShape,aiChatFeatureController:t}),s=(0,h().IS)((()=>({shortcutContainer:{display:"flex",alignItems:"center",gap:8},shortcut:{color:Y().Tj.text.inverseSecondary},minimizeIcon:{...i.iconButtonIcon}})),[i.iconButtonIcon]),l=r?W().xMarkIcon:a?j().O:F().o;return(0,D.jsx)(I().m,{renderTooltip:()=>(0,D.jsxs)("div",{style:s.shortcutContainer,children:[(0,D.jsx)(G().sA,{id:"chatSidebar.hideChat",defaultMessage:"Hide chat"}),(0,D.jsx)(se().A,{style:s.shortcut,name:"commandJ"})]}),render:e=>(0,D.jsx)(S().A,{...e,icon:l,iconStyle:a?i.iconButtonIcon:s.minimizeIcon,style:i.iconButton,ariaLabel:o.formatMessage({id:"chatSidebar.hideChat",defaultMessage:"Hide chat"}),onClick:n,testId:"agent-chat-view-minimize-button"})})}function sa(e){const{threadStore:t}=e,n=(0,g().v3)(),a=(0,G().tz)(),o=(0,h().eP)(),i=(0,h().IS)((()=>({floatingButton:{background:"dark"===o?Y().Tj.gray.background.elevated:Y().Tj.background.primary,borderRadius:9999,boxShadow:Y().Tj.shadow.outline.sm}})),[o]),s=(0,r.useCallback)((()=>{(0,ze().VK)({environment:n,oldThreadStore:t,newThreadStore:t})}),[n,t]),l={id:"chatSidebar.openInFullPage",defaultMessage:"Open in full page",description:"Open chat in full page instead of sidebar"};return(0,D.jsx)(I().m,{renderTooltip:()=>(0,D.jsx)(G().sA,{...l}),render:e=>(0,D.jsx)(S().A,{...e,icon:{icon:B().p,size:"sm",style:{transform:"scaleX(-1)"}},colorVariant:"secondary",size:"md",style:i.floatingButton,ariaLabel:a.formatMessage(l),onClick:s,testId:"agent-chat-view-open-in-full-page-button"})})}function la(e){const{onNewChat:t}=e,n=(0,G().tz)(),a=(0,h().eP)(),r=(0,h().IS)((()=>({floatingButton:{background:"dark"===a?Y().Tj.gray.background.elevated:Y().Tj.background.primary,borderRadius:9999,boxShadow:Y().Tj.shadow.outline.sm}})),[a]),o={id:"chatSidebar.newChat.floatingButton",defaultMessage:"New chat",description:"Start a new chat"};return(0,D.jsx)(I().m,{renderTooltip:()=>(0,D.jsx)(G().sA,{...o}),render:e=>(0,D.jsx)(S().A,{...e,icon:{icon:E,size:"sm"},colorVariant:"secondary",size:"md",style:r.floatingButton,ariaLabel:n.formatMessage(o),onClick:t,testId:"agent-chat-view-new-chat-floating-button"})})}function da(e){const{aiChatFeatureController:t,threadStore:n}=e,a=(0,g().v3)(),o=(0,G().tz)(),{isFullScreenSidebarEnabled:i,isFullWidth:s,toggleFullWidth:l}=(0,ve().q)(),d=ga({shape:t.headerButtonShape,aiChatFeatureController:t}),c=(0,h().IS)((()=>({icon:{...d.iconButtonIcon,transform:"scaleX(-1)"}})),[d.iconButtonIcon]),u=(0,r.useCallback)((()=>{i?l():((0,fe().setExpand)({environment:a,isExpanded:!1,from:"agent_chat_fullscreen_button",saveDetailsSidebarPreference:!0}),(0,ze().VK)({environment:a,oldThreadStore:n,newThreadStore:n}))}),[a,i,n,l]),p=i&&s?{id:"chatSidebar.exitFullscreen",defaultMessage:"Exit fullscreen",description:"Collapse chat sidebar to its previous width"}:{id:"chatSidebar.openFullscreen",defaultMessage:"Fullscreen",description:"Expand chat sidebar to full width"},m=i&&s?_().i:B().p;return(0,D.jsx)(I().m,{renderTooltip:()=>(0,D.jsx)(G().sA,{...p}),render:e=>(0,D.jsx)(S().A,{...e,icon:m,iconStyle:c.icon,style:d.iconButton,ariaLabel:o.formatMessage(p),onClick:u,testId:"agent-chat-view-fullscreen-button"})})}const ca=40,ua=28;function ga(e){const{active:t,shape:n,aiChatFeatureController:a}=e;return(0,h().IS)((()=>{const e=null!=a&&a.supportsTallChatHeader?ca:ua,r=null!=a&&a.supportsTallChatHeader?P().lD.default:P().Ev.default;return{iconButton:{width:e,height:e,..."pill"===n?{borderRadius:50}:{}},iconButtonIcon:{width:r,height:r,fill:t?Y().Tj.blue.icon.accentPrimary:Y().Tj.icon.primary}}}),[t,n,null==a?void 0:a.supportsTallChatHeader])}function pa({contentWidth:e}){const t=(0,h().eP)(),n=(0,h().IS)((()=>({mockAgentChatInputWrap:{width:e,maxWidth:"100%",height:120,boxShadow:`0px 0px 0px 0.5px ${Y().Tj.border.primary}, 0px 4px 12px -2px rgba(0, 0, 0, 0.08)`,backgroundColor:"dark"===t?Y().Tj.background.elevated:Y().Tj.background.primary,borderRadius:12,position:"relative"},placeholderShimmer:{position:"absolute",insetInlineStart:16,top:16,borderRadius:6,height:20,width:Math.min(400,e-32)},modeShimmer:{position:"absolute",insetInlineStart:16,bottom:16,borderRadius:6,width:Math.min(180,.4*(e-32)),height:24},sourcesShimmer:{position:"absolute",insetInlineEnd:16,bottom:16,borderRadius:6,width:Math.min(160,.35*(e-32)),height:24}})),[e,t]);return(0,D.jsxs)("div",{style:n.mockAgentChatInputWrap,children:[(0,D.jsx)(b().P,{style:n.placeholderShimmer}),(0,D.jsx)(b().P,{style:n.modeShimmer}),(0,D.jsx)(b().P,{style:n.sourcesShimmer})]})}function ha({environment:e,spaceStore:t,userStore:n,prompt:a,intl:r}){const{type:o}=a;if("string"===o||"text-value"===o){if(!a.text||0===a.text.length)return;return(0,Ye().Kf)({environment:e,spaceStore:t,userStore:n,value:"string"==typeof a.text?(0,z().x9d)(a.text):a.text})}if("prebuilt-prompt"===o){const o=(0,z().x9d)(r.formatMessage((0,Fe().CN)(a.promptType).message));return(0,Ye().Jv)({environment:e,spaceStore:t,userStore:n,promptType:a.promptType,locale:a.locale,value:o,args:a.args})}(0,$().HB)(o)}},514799:(e,t,n)=>{n.d(t,{H:()=>s});var a=()=>n(484714),r=()=>n(590526),o=()=>n(185078),i=()=>n(910302);function s(e){const{detectedLanguage:t,canSuggestInConfidence:n}=function(e){const{pageStore:t,enabled:n,forceUpdate:o=!1}=e,s=(0,a().v3)();return(0,r().K8)((()=>n&&t?i().bY({pageStore:t,environment:s,enabled:n,forceUpdate:o}):{detectedLanguage:void 0,canSuggestInConfidence:!1}),[t,s,n,o])}(e);return t&&!(0,o().cE)(t)?{detectedLanguage:void 0,canSuggestInConfidence:!1}:{detectedLanguage:t,canSuggestInConfidence:n}}},596582:(e,t,n)=>{n.d(t,{D:()=>r,I:()=>o});var a=()=>n(69708);const r=(0,a().YK)({header:{id:"threadPermissions.header",defaultMessage:"Invite"},headerTooltip:{id:"threadPermissions.headerTooltip",defaultMessage:"Invite people or groups to this conversation"},inviteSectionTitle:{id:"threadPermissions.invite.sectionTitle",defaultMessage:"Invite"},invitePlaceholder:{id:"threadPermissions.invite.placeholder",defaultMessage:"Invite people or groups"},loading:{id:"threadPermissions.loading",defaultMessage:"Loading permissions"},retry:{id:"threadPermissions.retry",defaultMessage:"Retry"},ownerLabel:{id:"threadPermissions.owner",defaultMessage:"Owner"},workspaceAudience:{id:"threadPermissions.workspaceAudience",defaultMessage:"Everyone in {workspace}"},botAudience:{id:"threadPermissions.botAudience",defaultMessage:"Agent access"},groupMembers:{id:"threadPermissions.groupMembers",defaultMessage:"{count, plural, one {# member} other {# members}}"},inviteButton:{id:"threadPermissions.inviteButton",defaultMessage:"Invite"},searching:{id:"threadPermissions.searching",defaultMessage:"Searching"},suggestionsHeader:{id:"threadPermissions.suggestions.header",defaultMessage:"Not invited to this conversation"},noInviteResults:{id:"threadPermissions.suggestions.empty",defaultMessage:"No matching people or groups."},existingMembersTitle:{id:"threadPermissions.permissionList.header",defaultMessage:"Members"},roleNone:{id:"threadPermissions.role.none",defaultMessage:"Remove"},makeOwner:{id:"threadPermissions.makeOwner",defaultMessage:"Make owner"},noSubjectSelected:{id:"threadPermissions.noSubject",defaultMessage:"Add at least one person or group"},editorRequired:{id:"threadPermissions.error.editorRequired",defaultMessage:"You need edit access to invite others to this conversation."},errGeneric:{id:"threadPermissions.error.generic",defaultMessage:"Something went wrong. Please try again."},noSpace:{id:"threadPermissions.noSpace",defaultMessage:"Workspace context unavailable."},noThread:{id:"threadPermissions.noThread",defaultMessage:"This conversation is still loading."},empty:{id:"threadPermissions.empty",defaultMessage:"No one else can access this conversation yet."},invitePermissionsWarning:{id:"threadPermissions.invite.permissionsWarning",defaultMessage:"You need edit access to invite others."},unknownGroup:{id:"threadPermissions.unknownGroup",defaultMessage:"Unknown group"},unknownUser:{id:"threadPermissions.unknownUser",defaultMessage:"Unknown user"},suggestionSelected:{id:"threadPermissions.suggestionSelected",defaultMessage:"Selected"}}),o=(0,a().YK)({reader:{id:"threadPermissions.role.reader",defaultMessage:"Can view"},readAndWrite:{id:"threadPermissions.role.readAndWrite",defaultMessage:"Can reply"},editor:{id:"threadPermissions.role.editor",defaultMessage:"Can manage"}})},598388:(e,t,n)=>{n.d(t,{i:()=>S});n(581454);var a=n(296540),r=()=>n(484714),o=()=>n(401497),i=()=>n(295633),s=()=>n(699143),l=()=>n(98126),d=()=>n(631524),c=()=>n(493552),u=()=>n(433847),g=()=>n(69708),p=()=>n(100622),h=()=>n(498212),m=()=>n(534177),f=()=>n(49418),v=()=>n(535960),y=()=>n(869222),b=n(474848);const x=(0,g().YK)({title:{id:"agent.chat.permissionGate.title",defaultMessage:"Request access to chat"},description:{id:"agent.chat.permissionGate.description",defaultMessage:"This agent uses pages you cant access yet."},untitledResource:{id:"agent.chat.permissionGate.untitled",defaultMessage:"Untitled page"},resourceTypePage:{id:"agent.chat.permissionGate.resource.page",defaultMessage:"Page"},resourceTypeDatabase:{id:"agent.chat.permissionGate.resource.database",defaultMessage:"Database"},resourceTypeIntegration:{id:"agent.chat.permissionGate.resource.integration",defaultMessage:"Integration"},statusGranted:{id:"agent.chat.permissionGate.status.granted",defaultMessage:"Granted"},statusNeedsUpgrade:{id:"agent.chat.permissionGate.status.needsUpgrade",defaultMessage:"Requires additional access"},statusNeedsUpgradeWithRole:{id:"agent.chat.permissionGate.status.needsUpgradeWithRole",defaultMessage:"Requires {role}"},statusRequestAccessUnavailable:{id:"agent.chat.permissionGate.status.requestAccessUnavailable",defaultMessage:"Contact an admin to manage this access."},requestEditAccess:{id:"agent.chat.permissionGate.requestEdit",defaultMessage:"Request edit access"}});function S(e){const{resources:t,isLoading:n}=e,S=(0,g().tz)(),w=(0,r().v3)(),C=(0,o().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:16,padding:24,borderRadius:12,border:`1px solid ${p().Tj.border.primary}`,backgroundColor:p().Tj.background.primary,width:"100%"},description:{color:p().Tj.text.secondary},resourceList:{display:"flex",flexDirection:"column",gap:12},resourceRow:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12,flexWrap:"wrap"},resourceInfo:{display:"flex",flexDirection:"column",gap:2,minWidth:0},resourceTypeText:{color:p().Tj.text.secondary},titleButton:{padding:0,margin:0,background:"none",border:"none",cursor:"pointer",textAlign:"start",display:"inline-flex",color:p().Tj.text.primary},statusContainer:{display:"flex",alignItems:"center",gap:8,minHeight:32},statusGranted:{color:p().Tj.text.accentPrimary},statusDetails:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:2,textAlign:"end"}})),[]),M=(0,a.useMemo)((()=>{const e=new Map;for(const n of t){const t=(0,y().h)(n);e.has(t)||e.set(t,(0,h().Ay)())}return e}),[t]);return n?(0,b.jsx)(s().Y1,{width:"fill",height:"fill",align:"center",children:(0,b.jsx)(l().k,{})}):(0,b.jsxs)("div",{style:C.container,children:[(0,b.jsx)(c().D,{styleKey:"bodyMedium",children:S.formatMessage(x.title)}),(0,b.jsx)(c().D,{styleKey:"bodyRegular",style:C.description,children:S.formatMessage(x.description)}),(0,b.jsx)("div",{style:C.resourceList,children:t.map((e=>{var t;const n=(0,y().h)(e),a=null!==(t=e.title)&&void 0!==t&&t.trim().length?e.title:S.formatMessage(x.untitledResource),r="collection"===e.resourceType?S.formatMessage(x.resourceTypeDatabase):"integrationConnection"===e.resourceType?S.formatMessage(x.resourceTypeIntegration):S.formatMessage(x.resourceTypePage),o=function(e){const{resource:t,shardPointer:n,flowId:a}=e;if(!n)return null;const r="needsUpgrade"===t.status?x.requestEditAccess:void 0;if("collection"===t.resourceType)return(0,b.jsx)(f().c,{type:"collection",collection:n,flowId:a,buttonType:"outline",labelMessage:r});if("page"===t.resourceType)return(0,b.jsx)(f().c,{type:"page",block:n,flowId:a,buttonType:"outline",labelMessage:r});return null}({resource:e,shardPointer:e.pointer.spaceId?{id:e.pointer.id,spaceId:e.pointer.spaceId}:void 0,flowId:M.get(n)??(0,h().Ay)()}),s=function(e){const{intl:t,resource:n,requestAccessControl:a,styles:r}=e,o=function(e){const{intl:t,role:n}=e;if(!n)return;try{const e=(0,u().an)(n,void 0);return t.formatMessage(e)}catch{return}}({intl:t,role:n.requiredRole});switch(n.status){case"granted":return(0,b.jsx)(c().D,{styleKey:"bodyMedium",style:r.statusGranted,children:t.formatMessage(x.statusGranted)});case"needsUpgrade":return(0,b.jsxs)("div",{style:r.statusDetails,children:[a??(0,b.jsx)(c().D,{styleKey:"bodyMedium",colorVariant:"primary",children:o?t.formatMessage(x.statusNeedsUpgradeWithRole,{role:o}):t.formatMessage(x.statusNeedsUpgrade)}),a?null:(0,b.jsx)(c().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:t.formatMessage(x.statusRequestAccessUnavailable)})]});case"requestAccess":return a??(0,b.jsx)(c().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:t.formatMessage(x.statusRequestAccessUnavailable)});default:(0,m().HB)(n.status)}}({intl:S,resource:e,requestAccessControl:o,styles:C}),l="page"===e.resourceType&&e.store instanceof i().B&&e.store?function(e){const{title:t,store:n,styles:a,environment:r}=e,o=()=>{(0,v().u)({environment:r,store:n,pageVisitSource:void 0})};return(0,b.jsx)(d().p,{style:a.titleButton,onClick:o,children:(0,b.jsx)(c().D,{styleKey:"bodyMedium",colorVariant:"primary",children:t})})}({title:a,store:e.store,styles:C,environment:w}):(0,b.jsx)(c().D,{styleKey:"bodyMedium",children:a});return(0,b.jsxs)("div",{style:C.resourceRow,children:[(0,b.jsxs)("div",{style:C.resourceInfo,children:[l,(0,b.jsx)(c().D,{styleKey:"captionRegular",style:C.resourceTypeText,children:r})]}),(0,b.jsx)("div",{style:C.statusContainer,children:s})]},n)}))})]})}},609550:(e,t,n)=>{n.d(t,{q:()=>g});var a=n(296540),r=()=>n(59226),o=()=>n(484714),i=()=>n(590526),s=()=>n(890909),l=()=>n(749687),d=()=>n(863642),c=()=>n(263943);const u=1;function g(){const e=(0,o().v3)(),t=(0,i().O$)(l().sidebarWidthStore),n=(0,i().K8)((()=>e.WindowSizeStore.state.width),[e]),g=(0,r().X)(c().iZ.id),p=(0,i().O$)(d().f),h=(0,a.useRef)(p??t);(0,a.useEffect)((()=>{void 0!==p&&(h.current=p)}),[p]);const m=(0,a.useMemo)((()=>!(!g||n<=0)&&t>=n-u),[g,t,n]);(0,a.useEffect)((()=>{g&&!m&&(h.current=t,d().f.setState(t))}),[g,m,t]);const f=(0,a.useCallback)((()=>{g&&(0,s().aU)({environment:e,sidebarWidth:t,windowWidth:n,fallbackWidth:h.current})}),[e,g,t,n]);return{isFullScreenSidebarEnabled:g,isFullWidth:m,toggleFullWidth:f}}},630230:(e,t,n)=>{n.d(t,{i:()=>r});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"3.23 3.23 13.54 13.54",svg:(0,n(474848).jsx)("path",{d:"M7.491 8.375 3.418 4.302a.625.625 0 0 1 .884-.884L8.375 7.49V4a.625.625 0 0 1 1.25 0v5c0 .345-.28.625-.625.625H4a.625.625 0 1 1 0-1.25zm4.137 4.137v3.491a.625.625 0 1 1-1.25 0v-5c0-.345.28-.625.625-.625h5a.625.625 0 1 1 0 1.25h-3.491l4.07 4.07a.625.625 0 0 1-.884.884z"})},r=(0,n(340498).wt)("arrowCollapse",a,"default")},638939:(e,t,n)=>{n.d(t,{o:()=>o});const a=16,r=32;function o(e={}){const{gradientMaskHeight:t=r,isScrolledToTop:n=!0,isScrolledToBottom:o=!1,excludeScrollbarFromFade:i=!1}=e,s=`linear-gradient(to bottom,\n\t\t${n?"black 0px":"transparent 0px"},\n\t\tblack ${t}px,\n\t\tblack calc(100% - ${t}px),\n\t\t${o?"black 100%":"transparent 100%"})`,l=i?`${s}, linear-gradient(black, black)`:s,d=i?`calc(100% - ${a}px) 100%, ${a}px 100%`:"100% 100%",c=i?"0 0, 100% 0":"0 0",u=i?"no-repeat, no-repeat":"no-repeat";return{maskImage:l,maskSize:d,maskPosition:c,maskRepeat:u,WebkitMaskImage:l,WebkitMaskSize:d,WebkitMaskPosition:c,WebkitMaskRepeat:u}}},649844:(e,t,n)=>{n.d(t,{Y:()=>o});n(296540);var a=n(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"1.81 2.89 16.38 15.08",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M16.938 9.853c0-2.97-2.539-5.54-6.545-5.697L10 4.148c-4.232 0-6.938 2.638-6.938 5.705 0 1.438.583 2.752 1.617 3.759a.63.63 0 0 1 .18.547 7.3 7.3 0 0 1-.89 2.528c1.108-.13 2.12-.614 3.01-1.344l.063-.044a.63.63 0 0 1 .505-.073 9 9 0 0 0 2.454.333l.392-.008c4.006-.158 6.545-2.727 6.545-5.698m1.25 0c0 3.803-3.234 6.766-7.747 6.947l-.44.01c-.88 0-1.712-.107-2.485-.3-1.349 1.022-2.985 1.62-4.826 1.428a.625.625 0 0 1-.406-1.033c.712-.818 1.096-1.737 1.284-2.642-1.116-1.197-1.756-2.734-1.756-4.41 0-3.926 3.447-6.955 8.189-6.955l.44.009c4.512.181 7.747 3.143 7.747 6.946"}),(0,a.jsx)("path",{d:"M10 6.375c.346 0 .626.28.626.625v2.375H13a.625.625 0 1 1 0 1.25h-2.375V13a.625.625 0 1 1-1.25 0v-2.375H7a.625.625 0 1 1 0-1.25h2.375V7c0-.346.28-.625.626-.625"})]})},o=(0,n(340498).wt)("chatBubblePlus",r,"default")},700226:(e,t,n)=>{n.d(t,{lv:()=>v,iU:()=>y,yc:()=>b});var a=n(296540),r=()=>n(484714),o=()=>n(590526),i=()=>n(401497),s=()=>n(758256),l=()=>n(69708),d=()=>n(100622),c=()=>n(687879),u=()=>n(383594),g=()=>n(486666),p=()=>n(622936),h=n(474848);function m(e){const{workflowStore:t,disabled:d=!1}=e,m=(0,r().v3)(),f=(0,l().tz)(),v=(0,o().K8)((()=>{var e,n;return t.table!==s().U6?null===(n=t.getDraftData())||void 0===n?void 0:n.icon:null===(e=t.getData())||void 0===e?void 0:e.icon}),[t]),y=(0,o().K8)((()=>t.table!==s().U6&&(t.canEdit()??!1)),[t]),b=(0,a.useCallback)((e=>{t.table!==s().U6&&c().saveIcon({workflowStore:t,icon:e,environment:m})}),[t,m]),x=(0,a.useCallback)((e=>{y&&u().W(m,{originRect:e.getBoundingClientRect(),originGap:4,popupWidth:g().jv,popupHeight:g().GF,isSmallWidth:!1,title:f.formatMessage({defaultMessage:"Agent icon",id:"agentPage.iconModalMenu.title"}),currentTab:"customAgent",tabs:[{type:"customAgent",title:f.formatMessage({defaultMessage:"Agent",id:"agentPage.iconModalMenu.agentTab.title"}),agentIcon:v,onChange:(e,t)=>{b(e),t&&t.keepVisible||u().I()}},{type:"emoji",onChange:(e,t)=>{b(e),t&&t.keepVisible||u().I()}},{type:"icon",onChange:(e,t)=>{b(e),t&&t.keepVisible||u().I()}},{type:"file",fileUpload:!1,imageUpload:!0,videoUpload:!1,title:f.formatMessage({defaultMessage:"Upload",id:"agentPage.iconModalMenu.uploadTab.title"}),caption:f.formatMessage({defaultMessage:"Recommended size is 280280 pixels",id:"agentPage.iconModalMenu.uploadTab.caption"}),onUpload:e=>{u().I(),n(222138).QM({environment:m,file:e[0],bucket:"public",reportRichUploadMetrics:!0,onStart:()=>{},onProgress:()=>{},onComplete:e=>{b(e)},onError:()=>{n(792057).f1(f.formatMessage({defaultMessage:"Upload failed. Please try again.",id:"agentPage.iconModalMenu.uploadError.message"}))}})}}],onDelete:()=>{b(void 0),u().I()}})}),[m,f,b,y,v]),S=(0,a.useCallback)((e=>{x(e.currentTarget)}),[x]),w=(0,a.useCallback)((e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),x(e.currentTarget))}),[x]),C=(0,i().IS)((()=>({iconContainer:{width:96,height:96,display:"flex",alignItems:"center",justifyContent:"center",fontSize:64,cursor:y?"pointer":"default",userSelect:"none",borderRadius:8,flexShrink:0,...y&&{transition:"background-color 0.15s ease"}}})),[y]);return y&&!d?(0,h.jsx)(n(718827).Ay,{style:C.iconContainer,onClick:S,onKeyDown:w,children:(0,h.jsx)(p().AgentIcon,{agentIcon:v,workflowStore:t,size:96,animated:!0})}):(0,h.jsx)("div",{style:C.iconContainer,children:(0,h.jsx)(p().AgentIcon,{agentIcon:v,workflowStore:t,size:96,animated:!0})})}var f=()=>n(323756);const v=32,y=1.25,b=a.memo((function(e){const{workflowStore:t,workflowValidationErrorStore:u}=e,{workflowValue:g}=(0,n(912749).N)(t,!0),p=(0,r().v3)(),b=!(0,o().K8)((()=>t.canEdit()),[t])||Boolean(e.disabled),x=(0,o().K8)((()=>u.hasError("name")),[u]),S=(0,o().K8)((()=>u.hasError("description")),[u]),{name:w,description:C}=g,[M,I]=(0,a.useState)((null==C?void 0:C.length)??!1),k=(0,a.useRef)(C),j=(0,a.useRef)(!1);(0,a.useEffect)((()=>{const e=k.current,t=!e||0===e.length,n=!C||0===C.length;!t||n||M||I(!0),k.current=C}),[C,M]);const[T,A]=(0,a.useState)(!1),[_,B]=(0,a.useState)(!1),P=v*y,D=(0,i().IS)((()=>({nameInput:{fontSize:v,fontWeight:n(284371).Wy.bold,color:d().Tj.text.primary,lineHeight:y},descriptionInput:{fontSize:16,color:d().Tj.text.secondary,wordWrap:"break-word",whiteSpace:"pre-wrap",lineHeight:1.5},headerContainer:{display:"flex",flexDirection:"column",gap:4,marginBlockEnd:12},buttonGroup:{marginInlineStart:-8,height:28,opacity:0,transition:"opacity 200ms ease"},buttonGroupVisible:{opacity:1}})),[]),R=(0,a.useCallback)((()=>{t.table!==s().U6&&(j.current||(j.current=!0,(0,n(22673).p4)({environment:p,workflowId:t.id,isDatabaseAgent:(0,n(905470).uP)(g)})))}),[p,t,g]),E=(0,a.useCallback)((e=>{if(t.table===s().U6)return;R();const n=e.target.value;x&&u.clearError("name"),c().saveName({workflowStore:t,name:n,environment:p})}),[t,p,x,u,R]),F=(0,a.useCallback)((e=>{if(t.table===s().U6)return;const n=e.target.value;S&&u.clearError("description"),c().saveDescription({workflowStore:t,description:n,environment:p,threadStore:void 0})}),[t,p,S,u]),W=(0,a.useCallback)((()=>{A(!0)}),[]),L=(0,a.useCallback)((()=>{A(!1)}),[]),K=(0,a.useCallback)((()=>{B(!0)}),[]),N=(0,a.useCallback)((()=>{B(!1)}),[]),V=(0,a.useCallback)((()=>{t.table!==s().U6&&(S&&u.clearError("description"),c().saveDescription({workflowStore:t,description:"",environment:p,threadStore:void 0}),I(!1))}),[t,p,S,u]),z=b?"":"Add a description";return(0,h.jsx)(n(699143).Y1,{direction:"vertical",width:"fill",children:(0,h.jsxs)("div",{style:D.headerContainer,onMouseEnter:W,onMouseLeave:L,children:[(0,h.jsx)(m,{workflowStore:t,disabled:b}),(0,h.jsx)("div",{style:{...D.buttonGroup,...T||_?D.buttonGroupVisible:{},display:"flex",gap:8},children:b?void 0:(0,h.jsx)(n(631524).p,{colorVariant:"tertiary",onClick:M?V:()=>I(!0),onFocus:K,onBlur:N,iconLeading:{icon:n(361173).infoCircleFillSmallIcon,size:"sm"},children:M?(0,h.jsx)(l().sA,{defaultMessage:"Remove description",id:"workflowAgentHeader.removeDescription.button"}):(0,h.jsx)(l().sA,{defaultMessage:"Add description",id:"workflowAgentHeader.addDescription.button"})})}),(0,h.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[(0,h.jsx)("div",{style:D.nameInput,children:(0,h.jsx)(f().E,{placeholder:"New agent",value:w,onChange:E,disabled:b,debugName:"AgentNameInput",autosizeMinHeight:P,inputClassName:n(882722).O2b})}),M?(0,h.jsx)("div",{style:D.descriptionInput,children:(0,h.jsx)(f().E,{placeholder:z,value:C,onChange:F,disabled:b,debugName:"AgentDescriptionInput",autosizeMinHeight:24})}):void 0]})]})})}))},704338:(e,t,n)=>{n.d(t,{q:()=>o});var a=()=>n(79926);const r=new(a().O2)("WorkflowSetupInstructions",(async()=>await Promise.all([n.e(75134),n.e(35530),n.e(9773),n.e(36556),n.e(55373),n.e(36192),n.e(40537),n.e(71562),n.e(96346),n.e(44711),n.e(53321),n.e(51220),n.e(16471),n.e(37353),n.e(37571),n.e(29151),n.e(40118),n.e(50397),n.e(62475),n.e(3151),n.e(98629),n.e(27992),n.e(63452),n.e(66249),n.e(92845),n.e(87249),n.e(79022),n.e(14578),n.e(87017),n.e(34877),n.e(46414),n.e(11676),n.e(61165),n.e(47668),n.e(94522),n.e(24587),n.e(44584),n.e(67494),n.e(10522),n.e(38293),n.e(40992),n.e(88455),n.e(63515),n.e(33893),n.e(55162),n.e(91793),n.e(71003),n.e(32370),n.e(26264),n.e(97989),n.e(36437),n.e(93963),n.e(44590),n.e(7914),n.e(55113),n.e(85071),n.e(25588),n.e(6769),n.e(23640),n.e(72252),n.e(93134),n.e(12452),n.e(18825),n.e(52871),n.e(29351),n.e(22370),n.e(93049),n.e(22582),n.e(18636),n.e(87289),n.e(16060),n.e(16529),n.e(34281),n.e(35279),n.e(69785),n.e(77754),n.e(29357),n.e(64242),n.e(39986),n.e(22585),n.e(47160),n.e(76677),n.e(68609),n.e(15553),n.e(77345),n.e(79340),n.e(37759),n.e(41423),n.e(21627),n.e(41714),n.e(77777),n.e(23493),n.e(97132)]).then(n.bind(n,797718)))),o=(0,a()._h)(r,(e=>e.WorkflowSetupInstructions))},717895:(e,t,n)=>{n.d(t,{K:()=>r});n(296540);const a={viewBox:"0 0 20 20",fittedViewBox:"7 7 6 6",svg:(0,n(474848).jsx)("path",{d:"M10 13a3 3 0 1 0 0-6 3 3 0 0 0 0 6"})},r=(0,n(340498).wt)("dotFill",a,"fill")},724015:(e,t,n)=>{n.d(t,{b:()=>i});n(296540);var a=()=>n(401497),r=()=>n(100622),o=n(474848);function i(){const e=(0,a().IS)((()=>({divider:{width:1,height:16,margin:"0px 4px",background:r().Tj.gray.background.secondary,borderRadius:2}})),[]);return(0,o.jsx)("div",{style:e.divider})}},740689:(e,t,n)=>{n.d(t,{o:()=>r});n(296540);const a={viewBox:"0 0 16 16",fittedViewBox:"1.77 1.79 12.45 12.42",svg:(0,n(474848).jsx)("path",{d:"M8.708 1.978a.625.625 0 0 0-.884.884l.914.913H3.84c-1.14 0-2.065.925-2.065 2.065v4.78a.625.625 0 0 0 1.25 0V5.84c0-.45.365-.815.815-.815h4.898l-.914.913a.625.625 0 0 0 .884.884l1.98-1.98a.625.625 0 0 0 0-.884zM13.6 4.755a.625.625 0 0 0-.625.625v4.78c0 .45-.365.815-.815.815H7.263l.913-.913a.625.625 0 0 0-.884-.884l-1.98 1.98a.625.625 0 0 0 0 .884l1.98 1.98a.625.625 0 1 0 .884-.884l-.913-.913h4.897c1.14 0 2.065-.924 2.065-2.065V5.38a.625.625 0 0 0-.625-.625"})},r=(0,n(340498).wt)("arrowSquareLeftRightSmall",a,"small")},779181:(e,t,n)=>{n.r(t),n.d(t,{iconDefinition:()=>r,inviteMemberSmallIcon:()=>o});n(296540);var a=n(474848);const r={viewBox:"0 0 16 16",fittedViewBox:"2.82 1.77 12.86 13.91",svg:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("path",{d:"M8 1.775c-.947 0-1.717.392-2.237 1.04-.508.633-.747 1.47-.747 2.337 0 .869.239 1.705.747 2.338.52.648 1.29 1.04 2.237 1.04s1.717-.392 2.237-1.04c.508-.633.748-1.47.748-2.338s-.24-1.704-.748-2.337c-.52-.648-1.29-1.04-2.237-1.04M6.738 3.597c.28-.348.69-.572 1.262-.572s.983.224 1.263.572c.291.364.472.904.472 1.555 0 .652-.18 1.192-.472 1.556-.28.348-.69.572-1.263.572s-.982-.224-1.262-.572c-.292-.364-.472-.904-.472-1.556 0-.651.18-1.191.472-1.555M8 9.178c-2.196 0-4.166 1.07-5.007 2.713a1.48 1.48 0 0 0 .2 1.676c.356.414.91.658 1.487.658h4.293a.075.075 0 0 0 .07-.105 3.8 3.8 0 0 1-.286-1.079.075.075 0 0 0-.075-.066H4.68a.72.72 0 0 1-.537-.22.3.3 0 0 1-.07-.14.26.26 0 0 1 .033-.154c.583-1.14 2.062-2.033 3.894-2.033.437 0 .855.051 1.245.144a.075.075 0 0 0 .081-.033 3.9 3.9 0 0 1 .78-.896.075.075 0 0 0-.024-.128A6.5 6.5 0 0 0 8 9.178"}),(0,a.jsx)("path",{d:"M12.6 9.525a3.06 3.06 0 0 0-2.474 1.248 3.06 3.06 0 0 0-.566 2.288 3.074 3.074 0 0 0 3.04 2.614 3.075 3.075 0 1 0 0-6.15m-.425 1.408a.425.425 0 0 1 .85 0V12.1c0 .041.034.075.075.075h1.167a.425.425 0 0 1 0 .85H13.1a.075.075 0 0 0-.075.075v1.166a.425.425 0 0 1-.85 0V13.1a.075.075 0 0 0-.075-.075h-1.166a.425.425 0 0 1 0-.85H12.1a.075.075 0 0 0 .075-.075z"})]})},o=(0,n(340498).wt)("inviteMemberSmall",r,"small")},843572:(e,t,n)=>{n.d(t,{b:()=>g});n(581454),n(296540);var a=()=>n(401497),r=()=>n(493552),o=()=>n(100622),i=()=>n(807449),s=()=>n(631524),l=()=>n(349679),d=()=>n(69708),c=n(474848);function u(e){const{completed:t,isFirstIncomplete:n,title:u,disabled:g,onClick:p}=e,h=(0,a().IS)((()=>({stepContainer:{display:"flex",alignItems:"center",gap:8,padding:"8px 0"},circle:{width:20,height:20,borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0,border:t?"none":`1.5px solid ${o().Tj.gray.border.primary}`,background:t?o().Tj.blue.background.accentPrimary:o().Tj.background.primary,transition:"all 0.2s ease"},innerCircle:{width:6,height:6,borderRadius:"50%",background:o().Tj.gray.background.tertiary},textContainer:{flex:1,display:"flex",alignItems:"center",gap:8,flexWrap:"wrap",rowGap:4},text:{color:t?o().Tj.text.tertiary:n?o().Tj.text.primary:o().Tj.text.secondary,textDecoration:t?"line-through":"none"},tryItLabel:{display:"flex",alignItems:"center",gap:4,color:o().Tj.blue.text.accentPrimary}})),[t,n]);return(0,c.jsxs)(s().p,{style:h.stepContainer,onClick:p,disabled:g||!p||t,children:[(0,c.jsx)("div",{style:h.circle,children:t?(0,c.jsx)(i().I,{icon:l().checkmarkSmallIcon,size:"sm",colorPalette:"gray",colorVariant:"inversePrimary"}):n?(0,c.jsx)("div",{style:h.innerCircle}):void 0}),(0,c.jsxs)("div",{style:h.textContainer,children:[(0,c.jsx)(r().D,{styleKey:"bodyRegular",style:h.text,children:u}),!t&&n?(0,c.jsx)("div",{style:h.tryItLabel,children:(0,c.jsx)(r().D,{styleKey:"bodyRegular",children:(0,c.jsx)(d().sA,{id:"checklist.step.tryIt",defaultMessage:"Try it "})})}):void 0]})]})}function g(e){const{steps:t,title:n,description:r,onStepClick:i,topPadding:s,footer:l,requireOrderedStepCompletion:d}=e,g=(0,a().IS)((()=>({container:{background:o().Tj.background.secondary,borderRadius:16,padding:16,paddingTop:s??(n?24:16)},stepsContainer:{display:"flex",flexDirection:"column",gap:4}})),[n,s]),h=t.findIndex((e=>!e.completed));return(0,c.jsxs)("div",{style:g.container,children:[(0,c.jsx)(p,{title:n,description:r}),(0,c.jsx)("div",{style:g.stepsContainer,children:t.map(((e,t)=>{const n=d&&t>h;return(0,c.jsx)(u,{completed:e.completed,isFirstIncomplete:t===h,title:e.title,disabled:n,onClick:i?()=>i(e.id):void 0},e.id)}))}),l]})}function p(e){const t=(0,a().IS)((()=>({textWrapper:{marginBottom:12,display:"flex",flexDirection:"column",gap:4}})),[]),{title:n,description:o}=e;return n||o?(0,c.jsxs)("div",{style:t.textWrapper,children:[n?(0,c.jsx)(r().D,{styleKey:"titleSmSemibold",children:n}):void 0,o?(0,c.jsx)(r().D,{styleKey:"bodySmRegular",children:o}):void 0]}):null}},863642:(e,t,n)=>{n.d(t,{d:()=>a,f:()=>r});const a=new(n(29923).R)({key:"slipperySlopeSidebarSelectedTab",namespace:n(553737).Bq,important:!0,trackingType:"preference"}),r=n(757695).Store.createValue(n(749687).SIDEBAR_MIN_WIDTH,{name:"sidebarPreviousNonFullWidthStore"})},864779:(e,t,n)=>{n.d(t,{Me:()=>s,Vv:()=>r,Z3:()=>o,wI:()=>i});var a=()=>n(906745);function r(e){if("week"===e.frequency&&e.weekdays&&1===e.weekdays.length)return{weekday:e.weekdays[0],duration:e.interval}}function o(e){const{currentSprintEndDate:t,sprintSchedule:n}=e;return l({startDate:c({dateToAdjust:a().DateTime.fromISO(t),weekday:n.weekday,wrapForEqualDays:!0}),duration:n.duration})}function i(e){const{userTimeZone:t,sprintSchedule:n}=e;return l({startDate:a().DateTime.local({zone:t}),duration:n.duration})}function s(e){const{currentSprintStartDate:t,sprintSchedule:n}=e,r=c({dateToAdjust:a().DateTime.fromISO(t),weekday:n.weekday,wrapForEqualDays:!1}),{end_date:o}=l({startDate:r,duration:n.duration});let i=a().DateTime.fromISO(o);const s=a().DateTime.now().startOf("day");for(;i.diff(s,"days").days<0;)i=i.plus({weeks:1});return{type:"daterange",start_date:i.plus({days:1}).minus({weeks:n.duration}).toISODate(),end_date:i.toISODate()}}function l(e){const{startDate:t,duration:n}=e,a=t.plus({weeks:n}).minus({days:1});return{type:"daterange",start_date:t.toISODate(),end_date:a.toISODate()}}const d={SU:0,MO:1,TU:2,WE:3,TH:4,FR:5,SA:6};function c(e){const{dateToAdjust:t,weekday:n,wrapForEqualDays:a}=e,r=function(e){const{currentWeekday:t,nextWeekday:n,wrapForEqualDays:a}=e,r="number"==typeof t?t:d[t],o="number"==typeof n?n:d[n];if(r===o)return a?7:0;let i=r,s=0;for(;i!==o;)i===d.SA?i=0:i+=1,s+=1;return s}({currentWeekday:t.weekday%7,nextWeekday:d[n],wrapForEqualDays:a});return t.plus({days:r})}},869222:(e,t,n)=>{n.d(t,{h:()=>m,r:()=>v});n(898992),n(581454),n(737550);var a=n(296540),r=()=>n(590526),o=()=>n(295633),i=()=>n(732810),s=()=>n(192),l=()=>n(273900),d=()=>n(68263),c=()=>n(179034),u=()=>n(519831),g=()=>n(183541),p=()=>n(201980);function h(e){const{spaceStore:t,resource:n}=e;if(n.pointer.table===c().ev){const e={table:c().ev,id:n.pointer.id,spaceId:n.pointer.spaceId??t.id};return o().B.createChildStore(t,e)}if(n.pointer.table===u().Vl){const e={table:u().Vl,id:n.pointer.id,spaceId:n.pointer.spaceId??t.id};return i().m.createChildStore(t,e)}if(n.pointer.table===g().tE){const e={table:g().tE,id:n.pointer.id,spaceId:n.pointer.spaceId??t.id};return s().s.createChildStore(t,e)}}function m(e){const t=e.pointer;return`${t.table}:${t.id}:${t.spaceId??""}`}function f(e){if(e instanceof o().B){const t=e.getTitleValue(),n=(0,p().q4_)(t);return n.length>0?n:void 0}if(e instanceof i().m){const t=e.getName();if(!t)return;const n=(0,p().q4_)(t);return n.length>0?n:void 0}if(e instanceof s().s){const t=e.getName();return t&&t.trim().length>0?t:void 0}}function v(e){const{environment:t,workflowStore:n,isCustomAgent:o,spaceStore:i}=e,{workflowId:s,workflowSpaceId:c,isStrictMode:u}=(0,r().K8)((()=>{var e;return n?{workflowId:n.id,workflowSpaceId:n.getSpaceId(),isStrictMode:"strictMode"===(null===(e=n.getData())||void 0===e?void 0:e.permissionMode)}:{workflowId:void 0,workflowSpaceId:void 0,isStrictMode:!1}}),[n]),g=Boolean(o&&s&&c&&u),[p,v]=(0,a.useState)({status:"idle"}),[y,b]=(0,a.useState)(0),x=(0,a.useCallback)((()=>{b((e=>e+1))}),[]);(0,a.useEffect)((()=>{if(!g||!s||!c)return void v((e=>"idle"===e.status?e:{status:"idle"}));let e=!1;return v({status:"loading"}),(async()=>{const n=await t.api.callCellCompatibleApi({environment:t,eventName:"getCustomAgentPermissionRequirements",data:{workflowId:s,spaceId:c},cellNavigation:{spaceId:c}});e||("success"===n.type&&n.data?v({status:"loaded",permissionMode:n.data.permissionMode,resources:n.data.requirements}):v({status:"error"}))})(),()=>{e=!0}}),[t,s,c,g,y]);const S=(0,a.useMemo)((()=>"loaded"===p.status?p.resources:[]),[p]),w=(0,a.useMemo)((()=>S.map((e=>({resource:e,key:m(e)})))),[S]),C=function(e){const{spaceStore:t,resources:n}=e,o=(0,a.useMemo)((()=>n.map((e=>({...e,store:t&&h({spaceStore:t,resource:e.resource})})))),[n,t]);(0,a.useEffect)((()=>{for(const{store:e}of o)e&&e.load()}),[o]);const i=(0,r().K8)((()=>o.map((({key:e,store:t})=>{if(!t)return{key:e,role:void 0,hasAccess:!1,title:void 0,store:void 0};const n=t.getRole();return{key:e,role:n,hasAccess:Boolean(n&&(0,d().Tt)(n)),title:f(t),store:t}}))),[o]);return(0,a.useMemo)((()=>{const e=new Map;for(const t of i)e.set(t.key,t);return e}),[i])}({spaceStore:i,resources:w}),M=(0,a.useMemo)((()=>w.map((({resource:e,key:t})=>{const n=C.get(t),a=(null==n?void 0:n.role)??e.requesterRole;let r;return r=(null==n?void 0:n.hasAccess)??Boolean(a&&(0,d().Tt)(a))?!e.requiredRole||a&&(0,l().q_)(a,e.requiredRole)?"granted":"needsUpgrade":"requestAccess",{...e,key:t,status:r,currentRole:a,title:(null==n?void 0:n.title)??e.title,store:null==n?void 0:n.store}}))),[C,w]),I=(0,a.useMemo)((()=>M.some((e=>"granted"!==e.status))),[M]),k=g&&"loading"===p.status;return{shouldBlockChat:g&&("loading"===p.status||"loaded"===p.status&&I),isLoading:k,resources:"loaded"===p.status?M:[],refresh:x}}},890909:(e,t,n)=>{n.d(t,{WR:()=>u,aU:()=>d,lY:()=>c});var a=()=>n(749687),r=()=>n(863642),o=()=>n(869562);const i=1;function s({environment:e,windowWidth:t}){return t>0?t:e.WindowSizeStore.state.width}function l({fallbackWidth:e,availableWindowWidth:t}){const n=e??a().SIDEBAR_MIN_WIDTH,r=Math.abs(n-t)<i?a().SIDEBAR_MIN_WIDTH:n,o=Math.max(r,a().SIDEBAR_MIN_WIDTH);return Math.min(o,t)}function d({environment:e,sidebarWidth:t,windowWidth:n,fallbackWidth:a}){const r=t>=n-1,i=s({environment:e,windowWidth:n});if(i<=0)return;if(!r)return void o().setWidth({width:i,environment:e});const d=l({fallbackWidth:a,availableWindowWidth:i});o().setWidth({width:d,environment:e})}function c({environment:e,windowWidth:t,sidebarWidth:n,fallbackWidth:a}){if(!(n>=t-1))return;const r=s({environment:e,windowWidth:t});if(r<=0)return;const i=l({fallbackWidth:a,availableWindowWidth:r});o().setWidth({width:i,environment:e})}function u(e){r().d.setState(e)}},911017:(e,t,n)=>{n.d(t,{d:()=>f});var a=n(296540),r=()=>n(564884),o=()=>n(933922),i=()=>n(484714),s=()=>n(401497),l=()=>n(31511),d=()=>n(69708),c=()=>n(981475),u=()=>n(94522),g=()=>n(945109),p=n(474848);const h=(0,d().YK)({placeholder:{id:"chatSidebar.renameThread.placeholder",defaultMessage:"Rename thread"}}),m=150;function f({threadStore:e,onBlur:t,style:n,inputStyle:f,format:v}){const y=(0,d().tz)(),b=(0,i().v3)(),x=(0,a.useRef)(null),S=(0,a.useRef)(""),[w,C]=(0,a.useState)(""),M=(0,a.useRef)(null);(0,a.useEffect)((()=>{if(e){var t;const n=(null===(t=e.getData())||void 0===t?void 0:t.title)??"";S.current=n,C(n)}}),[e]);const I=(0,s().IS)((()=>({container:{display:"flex",alignItems:"center",width:280,padding:6,...n},input:{fontSize:14,flex:1,minWidth:0,...f}})),[n,f]),k=(0,a.useCallback)((t=>{const n=t.target.value;if(!(n.length>m)&&(C(n),e)){null!==M.current&&(cancelAnimationFrame(M.current),M.current=null);const t=n.trim();if(0===t.length){var a;((null===(a=e.getData())||void 0===a?void 0:a.title)??"")!==S.current&&(0,g().i5)({environment:b,threadStore:e,title:S.current})}else M.current=requestAnimationFrame((()=>{M.current=null,(0,g().i5)({environment:b,threadStore:e,title:t})}))}}),[e,b]),j=(0,a.useCallback)((e=>{var t;"Enter"===e.key&&(e.preventDefault(),e.stopPropagation(),null===(t=x.current)||void 0===t||t.blur())}),[]),T=(0,a.useCallback)((()=>{if(!e)return void t();const n=w.trim(),a=0===n.length?S.current:n,o=0===n.length,i=a.length;if(a!==S.current){const t=(0,u().i4)(e),n=c().globalChatPanelRuntimeStore.state.chatPanelMode;(0,r().u)({environment:b,event:{eventName:"ai_chat_renamed",eventProperties:{ai_session_id:e.id,title_length:i,was_reverted:o,chat_mode:n,workflow_id:t}}})}t()}),[e,w,b,t]);return(0,p.jsx)(o().A,{capture:!0,allowEsc:!0,allowMenuList:!0,render:()=>(0,p.jsx)("div",{style:I.container,children:(0,p.jsx)(l().A,{ref:x,value:w,focus:!0,selectAll:!0,focusInitial:!0,placeholder:y.formatMessage(h.placeholder),onChange:k,format:v??"default",style:I.input,suppressFocusRing:!0,onKeyDown:j,onBlur:T,spellCheck:!0,maxlength:m})})})}},950914:(e,t,n)=>{n.d(t,{AL:()=>o,Q6:()=>s,vt:()=>i});n(898992),n(672577);var a=()=>n(433337),r=()=>n(254947);const o={autoCompleteSprints:!1,actionConfig:{complete_sprint_action:"complete_sprint_and_move_incomplete_tasks_to_next_sprint"},recurrenceConfig:{interval:2,weekdays:["MO"]}};function i(e){const{eventTracker:t,properties:n}=e;t.DO_NOT_USE_commonTrackEvent({eventName:"complete_sprint_action",properties:n})}function s(e,t){var n;return null===(n=t.groups)||void 0===n||null===(n=n.find((t=>t.id===a().nl||(null==t?void 0:t.name)===r().P0||(null==t?void 0:t.name)===e.formatMessage(r().oz.statusGroupNameComplete))))||void 0===n?void 0:n.name}},968845:(e,t,n)=>{n.r(t),n.d(t,{RenameThreadPopup:()=>s});n(296540);var a=()=>n(127833),r=()=>n(30537),o=()=>n(911017),i=n(474848);function s({threadStore:e,open:t,originRect:n,onDismiss:s}){return t&&n?(0,i.jsx)(a().zD,{popupType:r().n.Popup,open:t,originRect:n,onDismiss:s,placementToOrigin:"bottom",alignmentToOrigin:"end",originGap:0,trapFocus:!0,render:()=>(0,i.jsx)(o().d,{threadStore:e,onBlur:s})}):null}}}]);