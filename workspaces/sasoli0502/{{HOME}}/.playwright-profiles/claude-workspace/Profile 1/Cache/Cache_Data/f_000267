"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[943,17680,19693,46990,66425],{6697:(e,t,o)=>{o.d(t,{h:()=>i});var n=()=>o(79926);const r=new(n().O2)("DictationAvatar",(async()=>await Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(87017),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(94522),o.e(44584),o.e(38293),o.e(40992),o.e(88455),o.e(52871),o.e(47160),o.e(49021),o.e(53697),o.e(17680),o.e(6039),o.e(71136),o.e(86341),o.e(29316),o.e(3101)]).then(o.bind(o,310947)))),i=(0,n()._h)(r,(e=>e.DictationAvatar))},17680:(e,t,o)=>{o.d(t,{eQ:()=>U,hJ:()=>se,Ay:()=>q,Uo:()=>Z,XE:()=>le});o(944114),o(898992),o(823215),o(354520),o(672577),o(581454);var n=o(296540),r=()=>o(59226),i=()=>o(484714),l=()=>o(590526),a=()=>o(401497),s=()=>o(929219),c=()=>o(75435),d=()=>o(609679),u=()=>o(849255),p=()=>o(56268),g=()=>o(718827),m=()=>o(631524),S=()=>o(26697),h=()=>o(302501),y=()=>o(869190),v=()=>o(641007),f=()=>o(187174),b=()=>o(798880),x=()=>o(695608),w=()=>o(69708),C=()=>o(100622),k=()=>o(496603),I=()=>o(23420),T=()=>o(488923),j=()=>o(102172),A=()=>o(130119),M=()=>o(6697),P=()=>o(673657),_=()=>o(64790),R=()=>o(852273);const B=function(e){const t=(0,i().v3)(),r=(0,n.useRef)(),l=(0,o(336811).T)(),a=(0,n.useCallback)((async()=>{if(await o(129286).transactionQueue.awaitRecordTransaction(e.blockStore.pointer),!l.current)return;const n=(0,o(921997).Ws)(e.blockStore.id);r.current=R().Ay.addListener(n,void 0,k().nF((()=>o(466721).updatePageVisits(t,{blockStore:e.blockStore,pageVisitStore:e.pageVisitStore,incremental:!0,limit:e.limit})),1e3),void 0,t)}),[t,l,e.blockStore,e.limit,e.pageVisitStore]),s=(0,n.useCallback)((()=>{r.current&&(R().Ay.removeListener(r.current,t),r.current=void 0)}),[t]);return(0,n.useEffect)((()=>(a(),s)),[a,s]),null};var V=()=>o(869562),F=()=>o(737230),E=()=>o(994006),O=()=>o(453697),D=()=>o(79926);const z=new(D().O2)("AvatarHoverCard",(async()=>await Promise.all([o.e(86036),o.e(6608)]).then(o.bind(o,356221)))),L=(0,D()._h)(z,(e=>e.AvatarHoverCard)),K=new(D().O2)("LastViewedByHoverCard",(async()=>await o.e(1930).then(o.bind(o,652429)))),W=(0,D()._h)(K,(e=>e.LastViewedByHoverCard));var H=o(474848);const N=5,G=25,$=6,U=22;const q=function({pageVisitStore:e,presenceStore:t,rootStore:n,maxUsers:r}){return(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(o(912474).a,{rootStore:n}),(0,H.jsx)(se,{rootStore:n,pageVisitStore:e,presenceStore:t,maxUsers:r,isShowingInFeed:!1}),(0,H.jsx)(B,{blockStore:n,pageVisitStore:e,limit:1+Y(r)+G})]})};function X(e){return k().Ul(e,(e=>e.activityTimestampNearestMinuteMs))}function Y(e){return e??N}function Q(e,t){return u().L.createChildStore(t,{table:b().oo,id:e})}function Z(e){const{environment:t,isShowingTabBar:o,isShowingInFeed:n}=e;return{...(0,A().g)({noDrag:t.device.isElectron&&!o}),display:"flex",alignItems:"center",position:"relative",flexDirection:"row-reverse",marginInlineStart:8,paddingInlineEnd:$,transform:"translateZ(0)",...n&&{maxHeight:54,paddingBottom:12}}}function J(){return{color:C().Tj.text.inverseSecondary,fontSize:10,textTransform:"uppercase",letterSpacing:"0.015em"}}function ee({userData:e,isPresent:t,rootStore:o,isShowingInFeed:n}){const r=(0,i().v3)(),a=(0,w().tz)(),s=r.currentUser.id,c=(0,l().K8)((()=>Q(e.userId,o)),[e,o]),u=(0,l().K8)((()=>c.isDefined()),[c]),p=(0,l().K8)((()=>(0,x().c6)(a,c.getModel())),[a,c]),g=(0,l().K8)((()=>c.getEmail()),[c]);if(!u)return null;let m;return t?s!==c.id&&(m=e.blockId&&!n?(0,H.jsx)(w().sA,{defaultMessage:"Viewing now. Click to see where they are.",id:"topbar.presenceIndicator.viewingNowWithLocation.tooltip"}):(0,H.jsx)(w().sA,{defaultMessage:"Viewing now",id:"topbar.presenceIndicator.viewingNow.tooltip"})):s!==c.id&&e.activityTimestampNearestMinuteMs&&(m=(0,H.jsx)(w().sA,{defaultMessage:"Last viewed {timeFromNow}",id:"topbar.presenceIndicator.lastViewedTime.tooltip",values:{timeFromNow:(0,y().v9)(Math.min(e.activityTimestampNearestMinuteMs,Date.now()),d().locale)}})),(0,H.jsxs)("div",{children:[(0,H.jsx)("div",{className:"notranslate",children:p}),(0,H.jsx)("div",{style:{fontWeight:400},children:g}),m?(0,H.jsx)("div",{style:{color:C().Tj.text.inverseSecondary,minWidth:150,paddingTop:2,paddingBottom:2,lineHeight:1.3},children:m}):void 0]})}function te({userData:e,index:t,rootStore:o}){const n=(0,i().v3)(),r=(0,_().dp)(n,e),a=(0,l().K8)((()=>Q(e.userId,o)),[e,o]);if(!(0,l().K8)((()=>a.isDefined()),[a]))return null;let s;!r&&e.activityTimestampNearestMinuteMs&&(s=(0,y().v9)(e.activityTimestampNearestMinuteMs,d().locale));const c=(0,H.jsxs)("div",{style:{display:"flex",alignContent:"flex-end",minWidth:140,width:"100%",marginTop:4},children:[(0,H.jsx)(E().A,{userStore:a,avatarSize:18,style:{flexGrow:1},hasPersonHoverCard:!1}),(0,H.jsx)("div",{style:{marginInlineStart:"auto",paddingInlineStart:12,textAlign:"end",flexShrink:1,color:C().Tj.text.inverseSecondary},children:s})]});if(r&&e.blockId){const t=e.blockId;return(0,H.jsx)(g().Ay,{onClick:()=>(0,I().B)([t],!0,n),style:{display:"flex",alignItems:"center"},children:c})}return(0,H.jsx)("div",{style:{display:"flex",alignItems:"center"},children:c})}function oe({hiddenUsers:e,hiddenUsersCount:t,hasMore:o,rootStore:n,environment:i}){if(!(0,r().X)("use_topbar_person_hovercards"))return(0,H.jsx)(S().m,{allowHover:!0,originGap:7,renderTooltip:r=>(0,H.jsx)(ne,{hiddenUsers:e,hiddenUsersCount:t,hasMore:o,rootStore:n,events:r}),render:e=>(0,H.jsx)(re,{hiddenUsersCount:t,events:e,environment:i,rootStore:n})});const l=e.filter((e=>!(0,_().dp)(i,e))),a=e.filter((e=>(0,_().dp)(i,e))).length,s=t-a;return(0,H.jsx)(W,{trigger:(0,H.jsx)(re,{hiddenUsersCount:t,environment:i,rootStore:n}),viewers:l,totalCount:s,rootStore:n})}function ne({hiddenUsers:e,hiddenUsersCount:t,hasMore:o,rootStore:n,events:r}){const l=(0,i().v3)(),a=[],s=[];for(const i of e)(0,_().dp)(l,i)?a.push(i):s.push(i);const c=s.slice(0,G-a.length),d=t-(a.length+c.length);return(0,H.jsxs)("div",{...r,children:[a.length>0?(0,H.jsxs)("div",{style:{marginBottom:4},children:[(0,H.jsx)(h().A,{style:J(),children:(0,H.jsx)(w().sA,{defaultMessage:"Viewing now",id:"topbar.presenceIndicator.hiddenUsers.viewingNow.tooltip"})}),a.map(((e,t)=>(0,H.jsx)(te,{userData:e,index:t,rootStore:n},t)))]}):void 0,c.length>0?(0,H.jsxs)("div",{style:{marginBottom:4},children:[(0,H.jsx)(h().A,{style:{...J()},children:(0,H.jsx)(w().sA,{defaultMessage:"Last viewed by",id:"topbar.presenceIndicator.hiddenUsers.lastViewedBy.tooltip"})}),c.map(((e,t)=>(0,H.jsx)(te,{userData:e,index:t,rootStore:n},t)))]}):void 0,(0,H.jsx)(ie,{remainingHiddenUsersCount:d,hasMore:o})]})}function re({hiddenUsersCount:e,events:t,environment:o,rootStore:r}){const i=(0,a().IS)((()=>({origin:{paddingInline:8,marginInlineStart:4,marginInlineEnd:-$-4}})),[]),l=(0,n.useCallback)((()=>{V().handleSidebarButtonClick(o,r,F().tF.Updates,"more_menu"),F().Ay.setState({...F().Ay.state,updatesSubTab:F().VE.Analytics})}),[o,r]);return(0,H.jsx)(m().p,{style:i.origin,size:"sm",shape:"pill",colorPalette:"gray",onClick:l,...t,children:(0,H.jsx)(w().sA,{defaultMessage:"{hiddenUsersCount, plural, one {+{hiddenUsersCount}} other {+{hiddenUsersCount}}}",id:"topbar.presenceIndicator.hiddenUsers.otherCount.message",values:{hiddenUsersCount:e}})})}function ie({hasMore:e,remainingHiddenUsersCount:t}){const o=(0,a().IS)((()=>({message:{marginInlineStart:2,marginTop:2,color:C().Tj.text.inverseSecondary}})),[]);return t>0?(0,H.jsx)("div",{style:o.message,children:e?(0,H.jsx)(w().sA,{defaultMessage:"{remainingVisitorsCount}+ more…",id:"topbarPresence.presenceIndicator.hiddenUsers.evenMoreUsersNotViewing.tooltip",values:{remainingVisitorsCount:t}}):(0,H.jsx)(w().sA,{defaultMessage:"{remainingVisitorsCount} more…",id:"topbarPresence.presenceIndicator.hiddenUsers.moreUsersNotViewing.tooltip",values:{remainingVisitorsCount:t}})}):null}function le(e,t){const o=(0,a().DP)();return(0,a().IS)((()=>{const n={width:U,height:U,borderRadius:U},r=e(o);return{button:{transition:"all 0.2s ease",transform:"scale(1)"},buttonHovered:{transform:"scale(1.15)",background:"none"},buttonPressed:{transform:"scale(0.9)",background:"none"},uiUserAvatarStyles:{...n},avatarInnerOutline:{...n,outlineStyle:"solid",outlineColor:C().Tj.UIUserAvatarInnerOutline,outlineWidth:.5,outlineOffset:-.5},avatarBorder:t?{...n,outlineStyle:"solid",outlineColor:r,outlineWidth:1.5,outlineOffset:-.5}:{},avatarOuterOutline:{...n,outlineStyle:"solid",outlineColor:t?C().Tj.background.primary:C().Tj.UIUserAvatarIdleOutline,outlineWidth:.5,outlineOffset:t?1:0,backgroundColor:C().Tj.background.primary,marginInlineEnd:-6,position:"relative"},initialColor:{color:t?r:C().Tj.icon.secondary}}}),[e,t,o])}function ae(e){const{userData:t,rootStore:o,isShowingInFeed:a=!1}=e,s=(0,i().v3)(),{userId:c}=t,u=(0,_().dp)(s,t),p=(0,b().MF)(c),m=(0,r().X)("use_topbar_person_hovercards"),{userStore:h,showAvatar:f}=(0,l().K8)((()=>{const e=Q(c,o);return{userStore:e,showAvatar:(e.isDefined()||p)&&!e.getIsSuspended()}}),[c,o,p]),x=le((0,n.useCallback)((e=>(0,b().MF)(c)?C().Tj.icon.secondary:c===s.currentUser.id?C().Tj.border.accentPrimary:(0,C().Nq)(c,e)),[s.currentUser.id,c]),u);if(!f)return null;const k=(0,H.jsx)("div",{style:x.avatarOuterOutline,children:(0,H.jsx)("div",{style:x.avatarBorder,children:(0,H.jsx)(O().A,{iconStyle:x.avatarInnerOutline,userStore:p?v().px:h,style:x.uiUserAvatarStyles,isOffline:!u,size:U,avatarShouldShowShadow:!a,initialOverrideStyle:x.initialColor})})}),T=u&&t.blockId?(0,H.jsx)(g().Ay,{onClick:()=>(0,I().B)([t.blockId??""],!0,s),style:x.button,hoveredStyle:x.buttonHovered,pressedStyle:x.buttonPressed,children:k}):k;if(a||!s.currentUser.id)return T;if(m){const e=function({userData:e,isPresent:t,currentUserId:o,userId:n,isShowingInFeed:r}){if(o!==n)return t?e.blockId&&!r?(0,H.jsx)(w().sA,{defaultMessage:"Viewing now. Click to see where they are.",id:"topbar.presenceIndicator.viewingNowWithLocation.tooltip"}):(0,H.jsx)(w().sA,{defaultMessage:"Viewing now",id:"topbar.presenceIndicator.viewingNow.tooltip"}):e.activityTimestampNearestMinuteMs?(0,H.jsx)(w().sA,{defaultMessage:"Last viewed {timeFromNow}",id:"topbar.presenceIndicator.lastViewedTime.tooltip",values:{timeFromNow:(0,y().v9)(Math.min(e.activityTimestampNearestMinuteMs,Date.now()),d().locale)}}):void 0}({userData:t,isPresent:u,currentUserId:s.currentUser.id,userId:c,isShowingInFeed:a});return(0,H.jsx)(L,{trigger:T,userStore:h,header:e})}return(0,H.jsx)(S().m,{disableTooltip:a,textWrap:!0,renderTooltip:()=>(0,H.jsx)(ee,{rootStore:o,userData:t,isPresent:u,isShowingInFeed:a}),render:e=>(0,H.jsx)("div",{...e,children:T})})}function se(e){const{rootStore:t,pageVisitStore:o,presenceStore:n,maxUsers:r,isShowingInFeed:a}=e,d=(0,i().v3)(),u=d.currentUser.id,[{status:g,value:m}]=(0,f().Yb)((async()=>(0,T().$g)()),[]),S=(0,l().K8)((()=>{var e;if("resolved"===g)return null==m||null===(e=m.getPresencesForBlock(t.id))||void 0===e?void 0:e.find((e=>e.blockId===t.id))}),[m,g,t.id]),h=(0,l().K8)((()=>{const e=d.currentUser.id;if(!e)return;const i=a||(0,_().xm)(n)?(0,_().PZ)({pageVisitStore:o,presenceStore:n}):[];let l=(null==o?void 0:o.state.totalCount)??i.length;const s=[],c=[];for(const t of i)t.userId!==e?(0,_().dp)(d,t)?s.push(t):c.push(t):l--;!(0,p().r)({environment:d,store:t})&&t.isNavigableBlock()&&(0,j().BP)(t,d,d.device)&&"resolved"===g&&null!=S&&S.present&&s.push(S);const u=[...X(s).reverse(),...X(c).reverse()],m=Y(r)-1;return{visibleUsers:u.slice(0,m),hiddenUsers:u.slice(m),totalCount:l,hasMore:Boolean(null==o?void 0:o.state.hasMore)}}),[o,n,d,a,r,t,g,S],{useDeepEqual:!0}),{visibleUsers:y,hiddenUsers:v,hiddenUsersCount:x,hasMoreHiddenUsers:w,isEveryUserStoreReady:C}=(0,l().K8)((()=>{if(!u)return{};const{visibleUsers:e=[],hiddenUsers:o=[]}=h??{},n=[u,...e.map((e=>e.userId)),...o.map((e=>e.userId))].map((e=>Q(e,t)));return{visibleUsers:e,hiddenUsers:o,hiddenUsersCount:Number(null==h?void 0:h.totalCount)-e.length,hasMoreHiddenUsers:Boolean(null==h?void 0:h.hasMore),isEveryUserStoreReady:n.every((e=>e.isReady()||(0,b().MF)(e.id)))}}),[u,h,t]),k=(0,l().O$)(c().b),I=(0,P().n)(t),A=!(0,l().O$)(s().e);if(!u||!h||!C||A)return null;if(u!==t.userId)return null;if(0===y.length&&0===v.length)return I?(0,H.jsx)("div",{style:Z({environment:d,isShowingTabBar:k,isShowingInFeed:a}),children:(0,H.jsx)(M().h,{enableClickToScroll:!0,rootStore:t})}):null;{const e=[...y];return e.reverse(),(0,H.jsxs)("div",{style:Z({environment:d,isShowingTabBar:k,isShowingInFeed:a}),children:[x>0?(0,H.jsx)(oe,{rootStore:t,hiddenUsers:v,hiddenUsersCount:x,hasMore:w,environment:d}):void 0,e.map((e=>(0,H.jsx)(ae,{userData:e,rootStore:t},e.userId))),a?void 0:(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(ae,{rootStore:t,userData:{userId:u,present:!0}}),(0,H.jsx)(M().h,{enableClickToScroll:!0,rootStore:t})]})]})}}},19676:(e,t,o)=>{o.d(t,{i:()=>l,y:()=>a});var n=()=>o(340498),r=()=>o(100622),i=()=>o(284371);function l(e){const{isInHomeWidget:t,isInDashboardWidget:o,isFeedbackButton:l,isMobile:a,isInDashboardBuildMode:s}=e,c=(o||t)&&!a;return{button:{display:"flex",alignItems:"center",fontSize:14,padding:6,...l?{height:c?24:28,color:r().Tj.text.tertiary,fill:r().Tj.icon.tertiary}:c?{height:24,width:24}:{height:a?32:28,width:a?32:28},...l?{color:r().Tj.text.tertiary,fill:r().Tj.icon.tertiary}:{color:s?r().Tj.blue.text.secondary:r().Tj.text.secondary,fill:s?r().Tj.blue.icon.secondary:r().Tj.icon.secondary},fontWeight:i().Wy.regular,lineHeight:1,borderRadius:6},icon:{width:a?n().Ev.default:n().Ev.sm,height:a?n().Ev.default:n().Ev.sm,fill:s?r().Tj.blue.icon.secondary:r().Tj.icon.secondary}}}function a(){return{display:"flex",alignItems:"center",fontSize:14,height:28,padding:6,color:r().Tj.icon.secondary,fontWeight:i().Wy.regular,lineHeight:1,borderRadius:6}}},31902:(e,t,o)=>{o.d(t,{A:()=>i});o(296540);var n=()=>o(69708),r=o(474848);const i=function({collectionViewName:e,collectionViewType:t}){return(0,o(59226).X)("allow_empty_view_name")&&""===e?null:e?(0,r.jsx)(o(288722).A,{children:e}):"page"===t?(0,r.jsx)(n().sA,{id:"database.collectionView.untitledName.untitled",defaultMessage:"Untitled"}):(0,r.jsx)(n().sA,{...o(403905).X[t]})}},56394:(e,t,o)=>{o.d(t,{A:()=>u});o(296540);var n=()=>o(726637),r=()=>o(401497),i=()=>o(718827),l=()=>o(996755),a=()=>o(807449),s=()=>o(324254),c=()=>o(100622),d=o(474848);function u(e){const{icon:t,title:o,on:u,disabled:p,hasDiff:g,wrapStyle:m,innerStyle:S,hideChevron:h}=e,y=(0,r().eP)(),v=(0,r().IS)((()=>{const e=u||p?(0,l().q)({variant:"tint",themeMode:y,colorPalette:"blue",colorVariant:"accentPrimary"}):(0,l().q)({variant:"plain",themeMode:y,colorVariant:"secondary"});return{container:{borderRadius:14,marginInlineEnd:6,display:"inline-flex",...g&&{position:"relative"},...m},filterPill:{fontSize:14,display:"inline-flex",alignItems:"center",justifyContent:"center",gap:6,whiteSpace:"nowrap",borderRadius:32,height:n().A.isMobile?28:24,lineHeight:n().A.isMobile?"28px":"24px",padding:"0 8px",...e.resting,...S},hovered:{...e.hovered},pressed:{...e.pressed},diffDot:{position:"absolute",top:-2,insetInlineEnd:-2,background:c().Tj.orange.icon.accentPrimary,border:`1px solid ${c().Tj.background.primary}`,width:9,height:9,borderRadius:9}}}),[g,m,u,p,S,y]);return(0,d.jsxs)("div",{style:v.container,children:[(0,d.jsxs)(i().Ay,{disabled:p,disabledFeedback:!0,style:v.filterPill,hoveredStyle:v.hovered,pressedStyle:v.pressed,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:e.onClick,onDoubleClick:e.onDoubleClick,children:[t,o,h?void 0:(0,d.jsx)(a().I,{icon:s().arrowChevronSingleDownSmallIcon,size:"xs",fitToViewBox:"horizontal"})]}),g?(0,d.jsx)("div",{style:v.diffDot}):void 0]})}},64790:(e,t,o)=>{o.d(t,{$L:()=>u,EV:()=>a,PZ:()=>d,dp:()=>s,xm:()=>c});o(944114);var n=()=>o(798880),r=()=>o(100622),i=()=>o(496603),l=()=>o(720665);function a(e){if(null!=e&&e.blockId)return e.blockId}function s(e,t){const o=e.currentUser.id;return t.userId===o||t.present}function c(e){var t;return(null===(t=e.state.rootStore)||void 0===t?void 0:t.canEdit())??!1}function d(e){const{pageVisitStore:t,presenceStore:o}=e,{remotePresenceData:n}=o.state;let r=[];n&&i().uk(n,(e=>{null!=e&&e.userId&&r.push(e)}));const{pageId:a,lastViewTime:s,lastExitTime:c,totalCount:d,hasMore:u,...p}=t.state;return i().uk(p,(e=>{e.isDefined()&&r.push({userId:e.getUserId(),activityTimestampNearestMinuteMs:(0,l().WY)(e.getVisitedAt()),present:!1})})),r=i().hS(r,(e=>e.userId)),i().Ul(r,(({activityTimestampNearestMinuteMs:e})=>e?-e:0))}function u(e){const{userId:t,theme:o}=e;return(0,n().MF)(t)?r().Tj.icon.secondary:(0,r().Nq)(t,o)}},84923:(e,t,o)=>{o.r(t),o.d(t,{arrowStraightLeftFillSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"2 2.94 12 10.12",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M2.22 8.53a.75.75 0 0 1 0-1.06l4.32-4.32A.75.75 0 0 1 7.6 4.21L4.56 7.25h8.737c.388 0 .703.336.703.75s-.315.75-.703.75H4.56l3.04 3.04a.75.75 0 0 1-1.061 1.06z"})},r=(0,o(340498).wt)("arrowStraightLeftFillSmall",n,"fillSmall")},92253:(e,t,o)=>{o.d(t,{i:()=>s});o(18107),o(967357),o(898992),o(354520),o(581454);var n=()=>o(569797),r=()=>o(448801),i=()=>o(869558),l=()=>o(496603),a=()=>o(722101);function s(e){const{collectionViewBlockStore:t,newViewIds:o,transaction:s}=e,c=t.getCollectionViewStores(),{beforeOps:d}=(0,r().i)(c.map((e=>e.id)).slice(0,o.length),o);l().jJ(d,((e,r)=>{const l=n().p.createChildStore(t,{table:i().Gy,id:r,spaceId:t.getSpaceId()});if(e)a().nc({parentStore:t.getCollectionViewsStore(),insertStore:l,beforeStore:n().p.createChildStore(t,{table:i().Gy,id:e,spaceId:t.getSpaceId()}),transaction:s});else{const e=o.filter((e=>e!==r)).at(-1);a().WH({parentStore:t.getCollectionViewsStore(),insertStore:l,afterStore:e?n().p.createChildStore(t,{table:i().Gy,id:e,spaceId:t.getSpaceId()}):void 0,transaction:s})}}))}},112412:(e,t,o)=>{o.r(t),o.d(t,{filterSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.69 3.69 12.61 8.61",svg:(0,o(474848).jsx)("path",{d:"M2.4 3.7a.7.7 0 1 0 0 1.4h11.2a.7.7 0 1 0 0-1.4zm9.5 3.594H4.1a.7.7 0 1 0 0 1.4h7.8a.7.7 0 1 0 0-1.4M5.8 10.9a.7.7 0 1 0 0 1.4h4.4a.7.7 0 1 0 0-1.4z"})},r=(0,o(340498).wt)("filterSmall",n,"small")},130119:(e,t,o)=>{function n(e){return"drag"in e&&e.drag?{WebkitAppRegion:"drag"}:"noDrag"in e&&e.noDrag?{WebkitAppRegion:"no-drag"}:{}}o.d(t,{g:()=>n})},132389:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=o(474848);function r(e){const t={display:"inline-block",minWidth:e.size,minHeight:e.size};return"x"===e.axis?t.minHeight=1:"y"===e.axis&&(t.minWidth=1),(0,n.jsx)("div",{style:t})}},132855:(e,t,o)=>{o.r(t),o.d(t,{arrowInCircleUpFillIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.25 15.26",svg:(0,o(474848).jsx)("path",{d:"M10 17.625a7.625 7.625 0 1 0 0-15.25 7.625 7.625 0 0 0 0 15.25m3.042-8.07a.625.625 0 0 1-.884 0L10.625 8.02v5.466a.625.625 0 1 1-1.25 0V8.021L7.842 9.554a.625.625 0 1 1-.884-.883l2.6-2.6a.625.625 0 0 1 .884 0l2.6 2.6a.625.625 0 0 1 0 .883"})},r=(0,o(340498).wt)("arrowInCircleUpFill",n,"fill")},153057:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"3.66 2.37 8.68 11.26",svg:(0,o(474848).jsx)("path",{d:"M4.29 2.375a.625.625 0 0 0-.42 1.087L8.846 8l-4.978 4.538a.625.625 0 0 0 .421 1.087h7.42a.625.625 0 0 0 0-1.25H5.903l4.292-3.913a.625.625 0 0 0 0-.924L5.903 3.625h5.807a.625.625 0 0 0 0-1.25z"})},r=(0,o(340498).wt)("sumSmall",n,"small")},160438:(e,t,o)=>{o.r(t),o.d(t,{arrowStraightRightFillSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.99 2.94 12.01 10.12",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M13.78 7.47 9.46 3.15A.75.75 0 0 0 8.4 4.21l3.04 3.04H2.702C2.315 7.25 2 7.586 2 8s.315.75.703.75h8.736L8.4 11.79a.75.75 0 0 0 1.061 1.06l4.32-4.32a.75.75 0 0 0 0-1.06"})},r=(0,o(340498).wt)("arrowStraightRightFillSmall",n,"fillSmall")},166292:(e,t,o)=>{o.r(t),o.d(t,{checkStackIcon:()=>i,iconDefinition:()=>r});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.96 1.99 14.08 15.13",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M6.75 2.545a.55.55 0 0 1 .55-.55h5.4a.55.55 0 0 1 0 1.1H7.3a.55.55 0 0 1-.55-.55m-1.25 1.7a.55.55 0 1 0 0 1.1h9a.55.55 0 0 0 0-1.1zm7.036 5.847a.625.625 0 1 0-1.072-.643l-1.953 3.256-1.036-1.208a.625.625 0 1 0-.95.813l1.6 1.867a.625.625 0 0 0 1.011-.085z"}),(0,n.jsx)("path",{d:"M5.088 6.42a2.125 2.125 0 0 0-2.125 2.125v6.45c0 1.174.951 2.125 2.125 2.125h9.825a2.125 2.125 0 0 0 2.125-2.125v-6.45a2.125 2.125 0 0 0-2.125-2.125zm-.875 2.125c0-.483.392-.875.875-.875h9.825c.483 0 .875.392.875.875v6.45a.875.875 0 0 1-.875.875H5.088a.875.875 0 0 1-.875-.875z"})]})},i=(0,o(340498).wt)("checkStack",r,"default")},167170:(e,t,o)=>{o.d(t,{_:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.29 3.29 13.41 13.41",svg:(0,o(474848).jsx)("path",{d:"M3.3 4.825c0-.842.683-1.525 1.525-1.525h3.15c.842 0 1.525.683 1.525 1.525v10.35c0 .842-.683 1.525-1.525 1.525h-3.15A1.525 1.525 0 0 1 3.3 15.175zm1.525-.275a.275.275 0 0 0-.275.275v10.35c0 .152.123.275.275.275h3.15a.275.275 0 0 0 .275-.275V4.825a.275.275 0 0 0-.275-.275zm5.675.275v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525h-3.15c-.842 0-1.525.683-1.525 1.525m1.525-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275v-3.15c0-.152.123-.275.275-.275m0 5.95c-.842 0-1.525.683-1.525 1.525v3.15c0 .842.683 1.525 1.525 1.525h3.15c.842 0 1.525-.683 1.525-1.525v-3.15c0-.842-.683-1.525-1.525-1.525zm-.275 1.525c0-.152.123-.275.275-.275h3.15c.152 0 .275.123.275.275v3.15a.275.275 0 0 1-.275.275h-3.15a.275.275 0 0 1-.275-.275z"})},r=(0,o(340498).wt)("layout",n,"default")},170356:(e,t,o)=>{o.d(t,{NS:()=>p,Pq:()=>S,Z3:()=>u,sw:()=>g});o(296540);var n=()=>o(933922),r=()=>o(726637),i=()=>o(245720),l=()=>o(546926),a=()=>o(890492),s=()=>o(424400),c=()=>o(69708),d=o(474848);const u=8,p=8,g=32,m={height:g+u-2,paddingTop:u-2};function S({title:e,helpButton:t,onCancel:o,desktopMinWidth:s,desktopMaxWidth:u,desktopWidth:p,children:g}){return(0,d.jsx)(n().A,{capture:!0,allowEsc:!0,allowUndo:!0,render:n=>{let m;return m=r().A.isMobile?{menuType:l().gu.Modal,title:e,right:(0,d.jsx)(c().sA,{...i().W.done}),onClickRight:o,...n}:{menuType:l().gu.Popup,...s&&{minWidth:s},...u&&{maxWidth:u},...p&&{width:p},...n},(0,d.jsx)(a().A,{...m,header:e&&(0,d.jsx)(h,{title:e,helpButton:t}),children:g})}})}function h({title:e,helpButton:t}){return r().A.isMobile?null:(0,d.jsx)(s().Ay,{style:m,title:e,right:t})}},171559:(e,t,o)=>{o.d(t,{Fp:()=>s,ML:()=>a,Pe:()=>i});var n=()=>o(79926);const r=new(n().O2)("formEditorActionButtons",(()=>Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(16471),o.e(37353),o.e(37571),o.e(29151),o.e(40118),o.e(50397),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(87017),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(93963),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(12452),o.e(18825),o.e(52871),o.e(29351),o.e(22370),o.e(93049),o.e(22582),o.e(18636),o.e(87289),o.e(16060),o.e(16529),o.e(34281),o.e(35279),o.e(69785),o.e(77754),o.e(41751),o.e(5181),o.e(94995),o.e(40456),o.e(51859),o.e(69095)]).then(o.bind(o,22039)))),i=(0,n().jQ)(r,(e=>e.FormEditorActionButtons)),l=new(n().O2)("conditionalLogicTooltip",(()=>o.e(16130).then(o.bind(o,879022)))),a=(0,n()._h)(l,(e=>e.ConditionalLogicTooltip)),s=(0,n()._h)(l,(e=>e.ConditionalLogicUpsellTooltip))},175213:(e,t,o)=>{o.d(t,{G:()=>r});var n=()=>o(314529);function r(e,t){(0,n().DO_NOT_USE_trackLegacy)(e,"delete_property",t)}},187391:(e,t,o)=>{o.d(t,{N:()=>s});o(296540);var n=()=>o(81068),r=()=>o(761940),i=()=>o(69708),l=()=>o(395198),a=o(474848);function s(e){return(0,a.jsx)(n().A,{...e,title:(0,a.jsx)(i().sA,{...r().PQ.manageInCalendar}),icon:(0,a.jsx)(l().y,{colorVariant:"primary"})})}},198688:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=o(474848);const r=function(){const e=(0,o(401497).IS)((()=>({separator:{height:14,width:1,marginInlineStart:6,marginInlineEnd:6,background:o(100622).Tj.border.primaryTranslucent}})),[]);return(0,n.jsx)("div",{style:e.separator})}},200424:(e,t,o)=>{e.exports=o.p+"9ade71d75a1c0e93.png"},205557:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,lightBulbBrightSmallIcon:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"3.96 1.38 8.07 13.24",svg:(0,o(474848).jsx)("path",{d:"M8 1.385c-2.23 0-4.035 1.793-4.035 3.985 0 .782.193 1.525.56 2.147.09.161.181.312.281.473.454.725.86 1.386.86 2.08a.63.63 0 0 0 .624.625.63.63 0 0 0 .625-.625c.01-1.064-.553-1.972-1.041-2.75l-.27-.448a3 3 0 0 1-.389-1.512C5.215 3.853 6.46 2.625 8 2.625s2.785 1.228 2.785 2.735c0 .558-.137 1.084-.39 1.512l-.269.449-.01.016c-.475.773-1.03 1.675-1.03 2.723a.63.63 0 0 0 .55.62v.015h.074a.63.63 0 0 0 .625-.625c0-.684.406-1.355.859-2.08v-.002l.001-.001q.067-.117.139-.233t.141-.237c.367-.622.56-1.365.56-2.147 0-2.202-1.815-3.985-4.035-3.985m-1.6 10.19a.63.63 0 0 0-.625.625.63.63 0 0 0 .625.625h3.2a.63.63 0 0 0 .625-.625.63.63 0 0 0-.625-.625zm.8 1.8a.63.63 0 0 0-.625.625.63.63 0 0 0 .625.625h1.6A.63.63 0 0 0 9.425 14a.63.63 0 0 0-.625-.625z"})},r=(0,o(340498).wt)("lightBulbBrightSmall",n,"small")},216128:(e,t,o)=>{o.d(t,{R:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 16 16",fittedViewBox:"3.41 3.05 9.98 9.9",directional:!0,svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M4.482 3.238a.625.625 0 1 0-.884.884L7.476 8l-3.878 3.878a.625.625 0 0 0 .884.884l4.32-4.32a.625.625 0 0 0 0-.884z"}),(0,n.jsx)("path",{d:"M8.882 3.238a.625.625 0 0 0-.884.884L11.876 8l-3.878 3.878a.625.625 0 0 0 .884.884l4.32-4.32a.625.625 0 0 0 0-.884z"})]})},i=(0,o(340498).wt)("arrowChevronDoubleForwardSmall",r,"small")},229508:(e,t,o)=>{o.d(t,{a:()=>i});var n=()=>o(907258),r=()=>o(590526);function i(){return(0,r().O$)(n().AppStoreSidebarSpaceViewStore)}},233692:(e,t,o)=>{function n(e,t="Untitled Agent"){return{name:e.getName()||t,icon:e.getRawIcon()||""}}o.d(t,{m:()=>n})},240865:(e,t,o)=>{o.d(t,{V:()=>i});var n=()=>o(755531),r=()=>o(590526);function i(e){return(0,r().K8)((()=>{var t;return e?e.getMemberCountFromPublicSpaceData()??void 0:(null===(t=(0,n().S)())||void 0===t?void 0:t.getMemberCountFromPublicSpaceData())??void 0}),[e])}},244407:(e,t,o)=>{o.d(t,{q:()=>w});var n=o(296540),r=()=>o(590526),i=()=>o(401497),l=()=>o(807449),a=()=>o(26697),s=()=>o(62616),c=()=>o(340498),d=()=>o(69708),u=()=>o(100622),p=()=>o(206372),g=()=>o(908201),m=()=>o(562969),S=()=>o(187820),h=()=>o(205981),y=()=>o(635462),v=()=>o(680288),f=()=>o(999140),b=()=>o(745266),x=o(474848);function w(e){const{collectionViewStore:t,placement:o}=e,w=(0,g().ET)(),k=(0,d().tz)(),I=(0,r().K8)((()=>{const e=t.getParentBlockStore();return Boolean(null==e?void 0:e.hasSingleSourceAndNoLinkedCollections())}),[t]),T=(0,r().K8)((()=>w.isMultiSourceViewFromStoreState),[w]),j=(0,r().K8)((()=>{var e;const o=null===(e=t.getParentBlockStore())||void 0===e?void 0:e.id;return!!o&&((0,y().s)(o)&&w.isInHomeWidgetStore.state)}),[w.isInHomeWidgetStore,t]),A=(0,r().K8)((()=>{if(!I)return;const e=t.getName(),o=t.getType(),n=(0,f().OO)({collectionViewName:e,collectionViewType:o});if(!o)return{tooltipFirstLine:n,tooltipSecondLine:void 0};const r=t.getFormat().description;if(r)return{tooltipFirstLine:n,tooltipSecondLine:r};const i=t.getCollectionStore();if(i){var l,a;const e=(0,m().getCollectionNameOrDefault)({intl:k,collectionStore:i});if((null===(l=i.getParentBlockStore())||void 0===l?void 0:l.id)===(null===(a=t.getParentBlockStore())||void 0===a?void 0:a.id))return{tooltipFirstLine:n,tooltipSecondLine:(0,x.jsx)(d().sA,{defaultMessage:"{viewType, select, Table {Table view of {collection}} Board {Board view of {collection}} Timeline {Timeline view of {collection}} Calendar {Calendar view of {collection}} List {List view of {collection}} Gallery {Gallery view of {collection}} Form {Form} Chart {Chart view of {collection}} other {collection}}",id:"collectionTabBar.viewTab.tooltip",values:{viewType:v().to[o],collection:e}},"viewTab.tooltip.2")}}return{tooltipFirstLine:n,tooltipSecondLine:(0,x.jsx)(d().sA,{id:"collectionTabBar.viewTab.tooltip.default",defaultMessage:"{viewType} view",values:{viewType:v().to[o]}},"viewTab.tooltip.2")}}),[t,k,I],{useDeepEqual:!0}),M=(0,r().K8)((()=>{if(I)return;const e=t.getCollectionStore(),o=(0,m().getCollectionNameOrDefault)({intl:k,collectionStore:e}),n=t.getName(),r=t.getType()??"table",i=t.getFormat().collection_view_icon,a=t.getFormat().description,d=(0,f().OO)({collectionViewName:n,collectionViewType:r}),u=null==e?void 0:e.getIcon();return{dataSourceIcon:u?(0,x.jsx)(S().B6,{disabled:!0,bucket:"secure",store:e,icon:u,iconRecordCategory:"collection",isEmptyPage:!1,size:c().Ev.sm}):(0,x.jsx)(l().I,{icon:s().c,size:"sm"}),dataSourceName:o,viewType:r,viewIcon:i,viewTitle:d,viewDescription:a,collectionStore:e}}),[t,k,I],{useDeepEqual:!0}),P=(0,r().K8)((()=>{var e;const o=t.getCollectionStore(),n=t.getParentBlockStore();return o&&n&&(null===(e=o.getParentBlockStore())||void 0===e?void 0:e.id)!==n.id}),[t]),_=(0,i().IS)((()=>({tooltip:j?{marginBottom:-5,marginInlineStart:8}:I?{}:{padding:"8px 10px"},tooltipSecondLine:{color:u().Tj.text.inverseSecondary},collectionViewSection:{color:u().Tj.text.inverseSecondary,marginTop:6},row:{display:"flex",alignItems:"flex-start",gap:5},viewTextContainer:{display:"flex",flexDirection:"column"},homeOffset:{marginInlineStart:-8},iconContainer:{position:"relative",display:"inline-flex"}})),[j,I]),{render:R}=e,B=(0,n.useCallback)((e=>j?(0,x.jsx)("div",{style:_.homeOffset,children:R(e)}):R(e)),[j,R,_.homeOffset]),V=(0,n.useCallback)((e=>{if(j||T)return(0,x.jsx)(d().sA,{id:"collectionTabBar.myTasksWidget.tooltip",defaultMessage:"See all your tasks in one place"});if(A)return(0,x.jsxs)("div",{...e,style:p().Q$,children:[A.tooltipFirstLine,(0,x.jsx)("div",{style:_.tooltipSecondLine,children:A.tooltipSecondLine})]});if(M){const{dataSourceIcon:t,dataSourceName:o,viewType:n,viewIcon:r,viewTitle:i,viewDescription:l}=M;return(0,x.jsxs)("div",{...e,style:p().Q$,children:[(0,x.jsxs)("div",{style:_.row,children:[(0,x.jsxs)("div",{style:_.iconContainer,children:[t,P?(0,x.jsx)(h().H,{size:"xxs"}):void 0]}),(0,x.jsx)("div",{children:o})]}),(0,x.jsxs)("div",{style:{..._.row,..._.collectionViewSection},children:[(0,x.jsx)(C,{}),(0,x.jsx)(b().h,{color:"light",viewType:n,viewIcon:r,size:c().Ev.sm,shouldUseNoticon:!0}),(0,x.jsxs)("div",{style:_.viewTextContainer,children:[(0,x.jsx)("div",{children:i}),l?(0,x.jsx)("div",{children:l}):void 0]})]})]})}}),[j,T,A,M,P,_.tooltipSecondLine,_.row,_.collectionViewSection,_.viewTextContainer,_.iconContainer]);return(0,x.jsx)(a().m,{placement:o??(j?"top":"bottom"),originGap:j?0:void 0,alignment:"start",delayThreshold:500,style:_.tooltip,render:B,renderTooltip:V})}function C(){const e=(0,i().IS)((()=>{const e=c().Ev.sm;return{svg:{width:e,height:e,fill:"none",marginTop:2,marginInlineStart:4},rect:{width:e,height:e},path:{stroke:"white",strokeOpacity:"0.283",strokeWidth:"1.5",strokeLinecap:"round"}}}),[]);return(0,x.jsxs)("svg",{style:e.svg,children:[(0,x.jsx)("rect",{style:e.rect}),(0,x.jsx)("path",{d:"M2.5 1V5.5C2.5 7.70914 4.29086 9.5 6.5 9.5H11",style:e.path})]})}},245720:(e,t,o)=>{o.d(t,{W:()=>n});const n=(0,o(69708).YK)({done:{id:"modal.doneButton",defaultMessage:"Done"},cancel:{id:"modal.cancelButton",defaultMessage:"Cancel"},back:{id:"modal.backButton",defaultMessage:"Back"}})},271238:(e,t,o)=>{o.d(t,{vO:()=>i,i7:()=>u,$m:()=>a,xY:()=>S,bw:()=>s,IG:()=>p,fy:()=>g});var n=()=>o(79926);const r=new(n().O2)("AiSuggestionsLoadingIndicator",(async()=>await o.e(79565).then(o.bind(o,15386)))),i=(0,n()._h)(r,(e=>e.AiSuggestionsLoadingIndicator)),l=new(n().O2)("TableHeaderCellMenu",(()=>Promise.all([o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(62475),o.e(3151),o.e(98629),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(87017),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(33893),o.e(36437),o.e(6769),o.e(93049),o.e(39986),o.e(68609),o.e(37384),o.e(79340),o.e(72659),o.e(51240),o.e(81803),o.e(68643),o.e(95885),o.e(88522),o.e(92192),o.e(47779)]).then(o.bind(o,644162)))),a=(0,n()._h)(l,(e=>e.TableHeaderCellMenu)),s=new(n().O2)("AddColumnContainerAIPropertySuggestion",(()=>o.e(77974).then(o.bind(o,264593)))),c=((0,n()._h)(s,(e=>e.AddColumnContainerAIPropertySuggestion)),new(n().O2)("addColumnContainerWithAI",(()=>o.e(3625).then(o.bind(o,993870))))),d=((0,n()._h)(c,(e=>e.AddColumnContainerWithAI)),new(n().O2)("databasePropertySuggestionTooltip",(()=>o.e(48564).then(o.bind(o,462434))))),u=(0,n()._h)(d,(e=>e.DatabasePropertySuggestionTooltip)),p=new(n().O2)("aiPropertySuggestionsBundle",(()=>o.e(79565).then(o.bind(o,859185)))),g=new(n().O2)("suggestionHelpers",(()=>o.e(79565).then(o.bind(o,973411)))),m=new(n().O2)("TableSuggestionPreviewRow",(()=>o.e(79565).then(o.bind(o,824561)))),S=(0,n()._h)(m,(e=>e.TableSuggestionPreviewRow))},278589:(e,t,o)=>{o.d(t,{N:()=>i});var n=()=>o(534177),r=()=>o(17680);function i(e){return"avatar"===e?r().eQ:"xsmall"===e?18:"xsmall_plus"===e?24:"small"===e?28:"small_plus"===e?32:"medium"===e?36:"medium_plus"===e?44:"medium_large"===e?48:"large"===e?50:"large_plus"===e?64:"xlarge"===e?94:"plans"===e?20:"deep_dive"===e?16:"upsell_banner"===e?74:"personalization_modal"===e?96:(0,n().HB)(e)}},285176:(e,t,o)=>{o.d(t,{o:()=>c});o(296540);var n=()=>o(401497),r=()=>o(807449),i=()=>o(721479),l=()=>o(69708),a=()=>o(100622),s=o(474848);function c(e){const{href:t,style:o}=e,c=(0,n().IS)((()=>({default:{display:"flex",marginTop:7,marginBottom:7,alignItems:"center",cursor:"pointer",textDecoration:"none",pointerEvents:"auto",width:"fit-content",color:a().Tj.text.secondary,gap:4}})),[]);return(0,s.jsxs)("a",{href:t,target:"_blank",style:{...c.default,...o},children:[(0,s.jsx)(r().I,{icon:i().questionMarkCircleSmallIcon,size:"sm"}),(0,s.jsx)(l().sA,{id:"LearnMoreLink.learnMore",defaultMessage:"Learn more"})]})}},286993:(e,t,o)=>{o.d(t,{c:()=>c});o(581454),o(296540);var n=()=>o(590526),r=()=>o(991003),i=()=>o(496603),l=()=>o(908201),a=()=>o(387034),s=o(474848);function c(e){const{isFullScreen:t,hasGroups:o,hasPartialResults:c,hasSearchQuery:d,overrideNumShimmerRows:u}=e,p=(0,l().Ks)(),g=(0,n().K8)((()=>null==p?void 0:p.isInHomeWidgetStore.state),[p]);if(!(0,r().A)(!0,0,100))return null;let m=1;void 0!==u?m=u:o||c||d||(m=t?10:3);const S=m>1?["50%","30%","40%","40%","30%","30%","40%","40%","30%","30%"]:["35%"],h=i().Hn(m).map((e=>(0,s.jsx)(a().J,{isInHomeWidget:g,widthPercentage:e<S.length?S[e]:void 0},e)));return(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",marginInlineStart:g?8:3},children:h})}},299177:(e,t,o)=>{o.d(t,{A:()=>i});class n extends(()=>o(757695))().Store{getInitialState(){return{}}}const r=new n;o(852832).exposeDebugValue("SpaceWorkflowTemplateInstanceMapStore",r);const i=r},307736:(e,t,o)=>{o.d(t,{C:()=>r});var n=()=>o(852273);class r{constructor(e,t,o){this.listener=void 0,this.didEmit=void 0,this.lastValue=void 0,this.handleEmit=({value:e,passThroughData:t})=>{let o=!0;this.didEmit||(this.didEmit=!0,o=!1),this.lastValue===e?o=!1:this.lastValue=e,o&&this.onEmit(e,t)},this.environment=e,this.listenerEventKey=t,this.onEmit=o,this.didEmit=!1,this.lastValue=void 0}subscribe(){this.listener=n().Ay.addListener(this.listenerEventKey,void 0,this.handleEmit,void 0,this.environment)}unsubscribe(){this.listener&&n().Ay.removeListener(this.listener,this.environment)}}},344482:(e,t,o)=>{o.d(t,{A:()=>r});o(898992),o(672577);class n extends(()=>o(959180))().A{findTableHeaderCell(e,t){return this.find((o=>o.collectionContextStore===e&&o.property===t))}}const r=new n},350646:(e,t,o)=>{o.d(t,{k:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"1.27 3.53 17.42 12.94",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10.375 6.775c.345 0 .625.28.625.625v3.15a.625.625 0 1 1-1.25 0V7.4c0-.345.28-.625.625-.625m0 6.775a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5"}),(0,n.jsx)("path",{d:"M4.066 8.914a6.477 6.477 0 0 1 12.859 1.029 3.494 3.494 0 0 1-1.725 6.532H5.121a3.855 3.855 0 0 1-1.056-7.56m6.384-4.14a5.226 5.226 0 0 0-5.2 4.716l-.047.482-.48.075a2.605 2.605 0 0 0 .406 5.178H15.2a2.244 2.244 0 0 0 .853-4.32l-.41-.169.024-.443q.008-.146.008-.293a5.225 5.225 0 0 0-5.225-5.225"})]})},i=(0,o(340498).wt)("cloudExclamation",r,"default")},358898:(e,t,o)=>{o.d(t,{fz:()=>a,m7:()=>r,tr:()=>l,w6:()=>i});var n=()=>o(402014);const r=32,i=Object.freeze({display:"flex",width:r,height:"100%",alignItems:"center",justifyContent:"center"});function l(e){(0,n().SQ)(e,n().y$.EditorMouseDown,(()=>{}))}function a(e,t){return!e&&t}},387034:(e,t,o)=>{o.d(t,{J:()=>a});o(296540);var n=()=>o(401497),r=()=>o(874832),i=()=>o(100622),l=o(474848);function a(e){const{widthPercentage:t,isInHomeWidget:o}=e,a=(0,n().IS)((()=>({rowContainer:{display:"flex",height:30,alignItems:"center",gap:1,alignSelf:"stretch"},circleShimmer:{width:o?12:16,height:o?12:16,flexShrink:0,borderRadius:12,backgroundColor:i().Tj.background.tertiaryTranslucent},rowShimmer:{width:t||"35%",height:10,flexShrink:0,borderRadius:12,marginInlineStart:2,backgroundColor:i().Tj.background.tertiaryTranslucent},column:{display:"flex",height:34,padding:"7px 0px",alignItems:"center",gap:6,flex:"1 0 0"}})),[t,o]);return(0,l.jsx)("div",{style:a.rowContainer,children:(0,l.jsxs)("div",{style:a.column,children:[(0,l.jsx)(r().P,{style:a.circleShimmer}),(0,l.jsx)(r().P,{style:a.rowShimmer})]})})}},389657:(e,t,o)=>{o.d(t,{A:()=>E});var n=o(296540),r=()=>o(726637),i=()=>o(484714),l=()=>o(590526),a=()=>o(849255),s=()=>o(161588),c=()=>o(718827),d=()=>o(30537),u=()=>o(250910),p=()=>o(807449),g=()=>o(546926),m=()=>o(26697),S=()=>o(890492),h=()=>o(663639),y=()=>o(736847),v=()=>o(471095),f=()=>o(701751),b=o(474848);const x={viewBox:"0 0 20 20",fittedViewBox:"3.97 1.95 14.91 15.65",svg:(0,b.jsx)("path",{d:"M11.92 5.43a3.48 3.48 0 0 1 6.96 0v2.095a.625.625 0 1 1-1.25 0V5.43a2.23 2.23 0 1 0-4.46 0v1.92h.43a2.425 2.425 0 0 1 2.425 2.425v5.4A2.425 2.425 0 0 1 13.6 17.6H6.4a2.425 2.425 0 0 1-2.425-2.425v-5.4A2.425 2.425 0 0 1 6.4 7.35h5.52zm-1.357 7.373a1.35 1.35 0 1 0-1.126 0v1.247a.563.563 0 0 0 1.126 0z"})},w=(0,o(340498).wt)("lockOpenFill",x,"fill");var C=()=>o(105819),k=()=>o(798880),I=()=>o(695608),T=()=>o(69708),j=()=>o(100622),A=()=>o(314529);function M(e,t){(0,A().DO_NOT_USE_trackLegacy)(e,"edit_lock_toggle",t)}var P=()=>o(896628),_=()=>o(931729),R=()=>o(712505),B=()=>o(244828),V=()=>o(575143),F=()=>o(198688);const E=function({store:e,disableTooltip:t,hideText:o,isInlineCollection:n,buttonStyle:i}){return r().A.isMobile?(0,b.jsx)(N,{store:e,hideText:o}):(0,b.jsx)(H,{store:e,disableTooltip:t,hideText:o,isInlineCollection:n,buttonStyle:i})};function O(e,t){return{display:"flex",alignItems:"center",whiteSpace:"nowrap",gap:4,fontSize:r().A.isMobile?12:14,borderRadius:4,padding:"0 6px",marginInlineEnd:2,height:24,marginTop:r().A.isMobile?1:0,marginInlineStart:r().A.isMobile?0:-5,...e&&{marginInlineStart:r().A.isMobile?8:12,marginInlineEnd:0},...t}}function D(e,t,o){return{...O(t,o),color:j().Tj.text.tertiary,fill:j().Tj.icon.tertiary}}function z(e,t,o){return{...O(t,o),paddingInlineStart:5,border:`1px solid ${j().Tj.blue.border.accentPrimary}`,color:j().Tj.blue.text.accentPrimary,fill:j().Tj.blue.icon.accentPrimary}}function L({store:e}){const t=(0,l().K8)((()=>e.getFormat().block_locked_by),[e]),o=(0,T().tz)(),n=(0,l().K8)((()=>t&&(0,I().c6)(o,a().L.createChildStore(e,{table:k().oo,id:t}).getModel())),[t,o,e]);return t?(0,b.jsx)("div",{children:(0,b.jsx)(T().sA,{defaultMessage:"Locked by {lockedByPerson}{br}to prevent accidental editing.{br}<prompttext>Click to unlock</prompttext>",id:"pageLockIndicator.lockedTooltip",values:{lockedByPerson:(0,b.jsx)("b",{children:n}),br:(0,b.jsx)("br",{}),prompttext:e=>(0,b.jsx)("span",{style:{color:j().Tj.text.inverseSecondary},children:e})}})}):null}function K(e,t){s().$.relockBlock({userId:t.userId,blockId:t.id});const o=t.getType();if(o){const{collectionId:n,ownedCollectionCount:r,linkedCollectionCount:i}=(0,_().P)(t,{skipPages:!0});M(e,{from:"topbar",block_type:o,locked:!0,collection_id:n,owned_collection_count:r,linked_collection_count:i})}}function W({store:e,close:t}){const o=(0,i().v3)(),r=(0,n.useCallback)((()=>{!function(e,t){s().$.temporarilyUnlockBlock({userId:t.userId,blockId:t.id});const o=t.getType();if(o){const{collectionId:n,ownedCollectionCount:r,linkedCollectionCount:i}=(0,_().P)(t,{skipPages:!0});M(e,{from:"topbar",block_type:o,locked:!1,collection_id:n,owned_collection_count:r,linked_collection_count:i})}}(o,e),t()}),[o,e,t]),l=(0,n.useCallback)((()=>{!function(e,t){B().createAndCommit({userAction:"PageLockTopbarIndicator.handlePermanentUnlockClick",environment:e,canUndo:!0,perform:o=>{P()._l({environment:e,store:t,isLocked:!1,transaction:o})}});const o=t.getType();if(o){const{collectionId:n,ownedCollectionCount:r,linkedCollectionCount:i}=(0,_().P)(t,{skipPages:!0});M(e,{from:"topbar",block_type:o,locked:!1,collection_id:n,owned_collection_count:r,linked_collection_count:i})}}(o,e),t()}),[o,e,t]),a=[{key:"temp_unlock",render:e=>(0,b.jsx)(V().A,{...e,svg:C().pencilLineIcon,title:(0,b.jsx)(T().sA,{defaultMessage:"Unlock for me",id:"pageLockIndicator.temporaryUnlockOption.label"})}),action:()=>{r()}},{key:"perm_unlock",render:e=>(0,b.jsx)(V().A,{...e,svg:f().p,title:(0,b.jsx)(T().sA,{defaultMessage:"Unlock for everyone",id:"pageLockIndicator.permanentUnlockOption.label"})}),action:()=>{l()}}];return(0,b.jsx)(S().A,{menuType:g().gu.Popup,children:(0,b.jsx)(h().A,{type:h().O.Vertical,onAccept:t,sections:[{key:"unlock_options",render:e=>(0,b.jsx)(y().A,{...e}),items:a}],initialFocus:void 0})})}function H({store:e,disableTooltip:t,hideText:o,isInlineCollection:r,buttonStyle:a}){const g=(0,i().v3)(),S=(0,n.useCallback)((()=>K(g,e)),[g,e]),h=(0,l().K8)((()=>e.isLockedForAllUsers()),[e]),y=(0,l().K8)((()=>s().$.isTemporarilyUnlocked({userId:e.userId,blockId:e.id})),[e.id,e.userId]),f=(0,l().K8)((()=>R().default.state.open&&R().default.state.targetStore.id===e.id),[e.id]);return h?y?(0,b.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[f?(0,b.jsx)(F().A,{}):void 0,(0,b.jsxs)(c().Ay,{style:z(0,r,a),onClick:S,hoveredStyle:{background:j().Tj.outlineBlueButtonHoveredBackground},pressedStyle:{background:j().Tj.outlineBlueButtonPressedBackground},children:[(0,b.jsx)(p().I,{icon:w}),o?void 0:(0,b.jsx)("div",{style:{lineHeight:1},children:(0,b.jsx)(T().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.relockButton.label"})})]})]}):(0,b.jsx)(m().m,{renderTooltip:()=>(0,b.jsx)(L,{store:e}),disableTooltip:t,render:t=>(0,b.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[f?(0,b.jsx)(F().A,{}):void 0,(0,b.jsx)(u().A,{popupType:d().n.Popup,renderOrigin:({onClick:e})=>(0,b.jsxs)(c().Ay,{style:D(0,r,a),onClick:e,...t,children:[(0,b.jsx)(p().I,{icon:v().lockFillIcon}),o?void 0:(0,b.jsx)("div",{style:{lineHeight:1},children:(0,b.jsx)(T().sA,{defaultMessage:"Locked",id:"pageLockIndicator.lockedButton.label"})})]}),render:({close:t})=>(0,b.jsx)(W,{store:e,close:t})})]})}):null}function N({store:e,hideText:t}){const o=(0,i().v3)(),r=(0,n.useCallback)((()=>K(o,e)),[o,e]),a=(0,l().K8)((()=>e.isLockedForAllUsers()),[e]),g=(0,l().K8)((()=>s().$.isTemporarilyUnlocked({userId:e.userId,blockId:e.id})),[e.id,e.userId]),{WindowSizeStore:m}=o,S=(0,l().K8)((()=>m.getSafePaddingLeftCSS(10)),[m]),h=(0,l().K8)((()=>m.getSafePaddingRightCSS(14)),[m]);return a?g?(0,b.jsxs)(c().Ay,{onClick:r,style:{display:"flex",alignItems:"center",width:"100%",height:"100%",gap:6,paddingInlineStart:S,paddingInlineEnd:h,color:j().Tj.blue.text.accentPrimary,fill:j().Tj.blue.icon.accentPrimary},children:[(0,b.jsx)(p().I,{icon:w}),t?void 0:(0,b.jsx)("div",{children:(0,b.jsx)(T().sA,{defaultMessage:"Re-lock",id:"pageLockIndicator.mobileRelockButton.label"})})]}):(0,b.jsx)(u().A,{popupType:d().n.Popup,renderOrigin:({onClick:e})=>(0,b.jsxs)(c().Ay,{onClick:e,style:{display:"flex",alignItems:"center",gap:6,height:"100%",paddingInlineStart:S,paddingInlineEnd:h},children:[(0,b.jsx)(p().I,{icon:v().lockFillIcon}),t?void 0:(0,b.jsx)("div",{children:(0,b.jsx)(T().sA,{defaultMessage:"Locked",id:"pageLockIndicator.mobileLockedButton.label"})})]}),render:({close:t})=>(0,b.jsx)(W,{store:e,close:t})}):null}},424139:(e,t,o)=>{o.r(t),o.d(t,{emojiFaceIcon:()=>i,iconDefinition:()=>r});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.37 15.25 15.26",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M8.045 11.706a.625.625 0 0 0-1.036.698A3.6 3.6 0 0 0 10.005 14c1.245 0 2.35-.637 2.996-1.596a.625.625 0 0 0-1.036-.698 2.37 2.37 0 0 1-1.96 1.044 2.36 2.36 0 0 1-1.96-1.044m-.68-2.041c.49 0 .88-.46.88-1.02s-.39-1.02-.88-1.02-.88.46-.88 1.02.39 1.02.88 1.02m6.15-1.02c0 .56-.39 1.02-.88 1.02s-.88-.46-.88-1.02.39-1.02.88-1.02.88.46.88 1.02"}),(0,n.jsx)("path",{d:"M10 2.375a7.625 7.625 0 1 0 0 15.25 7.625 7.625 0 0 0 0-15.25M3.625 10a6.375 6.375 0 1 1 12.75 0 6.375 6.375 0 0 1-12.75 0"})]})},i=(0,o(340498).wt)("emojiFace",r,"default")},430102:(e,t,o)=>{o.d(t,{I:()=>g});var n=o(296540),r=()=>o(401497),i=()=>o(718827),l=()=>o(606712),a=()=>o(150161),s=()=>o(807449),c=()=>o(26697),d=()=>o(854705),u=()=>o(100622),p=o(474848);const g=n.memo(n.forwardRef((function(e,t){const{style:o,color:n,title:i,onClick:l,onDropdownClick:s,mainButtonTooltip:c,dropdownTooltip:d,dropdownAriaLabel:g,iconLeading:h,iconStyle:y,mainButtonStyle:v,isLoading:f,className:b,disabled:x,disableDropdown:w,size:C,variant:k="solid"}=e,I=(0,r().IS)((()=>{const e=(0,a().qq)({size:C,isButtonGapEnabled:!1});return{wrap:{position:"relative",display:"inline-flex",flexShrink:0,height:e.height,...o},border:{position:"absolute",pointerEvents:"none",border:"outline"===k?`1px solid ${u().Tj.outlineButtonBorder}`:void 0,borderRadius:e.borderRadius,top:0,insetInlineStart:0,insetInlineEnd:0,bottom:0}}}),[C,k,o]);return(0,p.jsxs)("div",{style:I.wrap,className:b,children:[(0,p.jsx)(m,{ref:t,color:n,disabled:x,disableDropdown:w,iconLeading:h,iconStyle:y,isLoading:f,mainButtonStyle:v,mainButtonTooltip:c,onClick:l,title:i,variant:k}),(0,p.jsx)(S,{ref:t,color:n,disabled:w,dropdownAriaLabel:g,dropdownTooltip:d,isLoading:f,onDropdownClick:s,variant:k}),(0,p.jsx)("div",{style:I.border})]})}))),m=n.memo(n.forwardRef((function(e,t){const{mainButtonTooltip:n,onClick:l,disabled:s,disableDropdown:d,isLoading:g,iconLeading:m,title:S,color:v,variant:f,mainButtonStyle:b,iconStyle:x,size:w}=e,C=(0,r().eP)(),k=(0,r().IS)((()=>{const e=(0,a().qq)({size:w,isButtonGapEnabled:!1}),t=y({color:v,variant:f,themeMode:C});return{mainButton:{display:"flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderStartStartRadius:e.borderRadius,borderEndStartRadius:e.borderRadius,borderStartEndRadius:d?e.borderRadius:void 0,borderEndEndRadius:d?e.borderRadius:void 0,paddingInlineStart:e.paddingInlineStart,paddingInlineEnd:e.paddingInlineEnd,fontSize:e.fontSize,fontWeight:o(284371).Wy.medium,...t.default,...b},icon:{width:12,marginInlineEnd:6,fill:h(v,f,{outline:t.default.color,solid:{blue:u().oZ.white,black:u().oZ.white,orange:u().Tj.palette.orange[400]}}),...x},buttonHoveredStyle:t.hovered,buttonPressedStyle:t.pressed}}),[v,d,x,b,w,f,C]);return n?(0,p.jsx)(c().m,{renderTooltip:()=>n,render:e=>(0,p.jsxs)(i().Ay,{ref:t,style:k.mainButton,onClick:l,disabled:s,disabledFeedback:!0,hoveredStyle:k.buttonHoveredStyle,pressedStyle:k.buttonPressedStyle,...e,children:[m?m(k.icon):null,S]})}):(0,p.jsxs)(i().Ay,{ref:t,style:k.mainButton,onClick:l,disabled:s||g,disabledFeedback:!0,hoveredStyle:k.buttonHoveredStyle,pressedStyle:k.buttonPressedStyle,children:[g?(0,p.jsx)(o(98126).A,{style:{marginInlineEnd:4}}):null,m?m(k.icon):null,S]})}))),S=n.memo(n.forwardRef((function(e,t){const{disableDropdown:l,disabled:g,dropdownAriaLabel:m,dropdownTooltip:S,onDropdownClick:v,isLoading:f,size:b,color:x,variant:w}=e,C=(0,r().eP)(),k=(0,r().IS)((()=>{const e=(0,a().qq)({size:b,isButtonGapEnabled:!1}),t=y({color:x,variant:w,themeMode:C});return{dropdownButton:{display:"flex",alignItems:"center",justifyContent:"center",width:o(726637).A.isMobile?28:24,alignSelf:"stretch",borderStartEndRadius:e.borderRadius,borderEndEndRadius:e.borderRadius,boxShadow:"outline"===w||"blue"===x||"black"===x?`inset 1px 0 0 ${u().Tj.border.primaryTranslucent}`:"orange"===x?`${u().Tj.palette.orange["dark"===C?200:100]} 1px 0 0 inset`:(0,o(534177).HB)(x),...t.default},dropdownButtonIcon:{marginTop:2,fill:h(x,w,{outline:t.default.color,solid:{blue:u().oZ.white,black:u().oZ.white,orange:u().Tj.palette.orange["dark"===C?500:400]}})},buttonHoveredStyle:t.hovered,buttonPressedStyle:t.pressed}}),[x,b,w,C]),I=(0,n.useCallback)((e=>(0,p.jsx)(i().Ay,{ref:t,style:k.dropdownButton,onClick:v,disabledFeedback:!0,hoveredStyle:k.buttonHoveredStyle,pressedStyle:k.buttonPressedStyle,ariaLabel:m,...e,children:(0,p.jsx)(s().I,{icon:d().arrowChevronSingleDownFillSmallIcon,size:"sm",style:k.dropdownButtonIcon})})),[m,v,t,k.buttonHoveredStyle,k.buttonPressedStyle,k.dropdownButton,k.dropdownButtonIcon]),T=(0,n.useCallback)((()=>S),[S]);return l||g?null:S?(0,p.jsx)(c().m,{renderTooltip:T,render:I}):(0,p.jsx)(i().Ay,{ref:t,style:k.dropdownButton,onClick:v,disabledFeedback:!0,hoveredStyle:k.buttonHoveredStyle,pressedStyle:k.buttonPressedStyle,disabled:f,ariaLabel:m,children:(0,p.jsx)(s().I,{icon:d().arrowChevronSingleDownFillSmallIcon,size:"sm",style:k.dropdownButtonIcon})})})));function h(e,t,o){return"object"!=typeof o[t]?o[t]:o[t][e]}function y(e){const{color:t,variant:o,themeMode:n}=e;return{default:{background:h(t,o,{outline:void 0,solid:{blue:u().Tj.blue.background.accentPrimary,black:u().Tj.background.accentPrimary,orange:u().Tj.orange.background.secondaryTranslucent}}),color:h(t,o,{outline:{blue:u().Tj.blue.text.accentPrimary,black:u().Tj.text.primary,orange:u().Tj.orange.text.accentPrimary},solid:{blue:u().Tj.blue.text.inversePrimary,black:u().Tj.text.inversePrimary,orange:u().Tj.orange.text.accentPrimary}})},hovered:{background:h(t,o,{outline:{blue:u().Tj.blue.background.secondaryTranslucent,black:u().Tj.gray.background.secondaryTranslucent,orange:u().Tj.orange.background.secondaryTranslucent},solid:{blue:(0,l().R)({color:u().Tj.blue.background.accentPrimary,mode:n}),black:(0,l().R)({color:u().Tj.background.accentPrimary,mode:"dark"}),orange:(0,l().R)({color:u().Tj.orange.background.secondaryTranslucent,mode:n})}})},pressed:{background:h(t,o,{outline:{blue:(0,l().y)({color:u().Tj.blue.background.secondaryTranslucent,mode:n}),black:(0,l().y)({color:u().Tj.gray.background.secondaryTranslucent,mode:n}),orange:(0,l().y)({color:u().Tj.orange.background.secondaryTranslucent,mode:n})},solid:{blue:(0,l().y)({color:u().Tj.blue.background.accentPrimary,mode:n}),black:(0,l().y)({color:u().Tj.background.accentPrimary,mode:"dark"}),orange:(0,l().y)({color:u().Tj.orange.background.secondaryTranslucent,mode:n})}})}}}},443191:(e,t,o)=>{o.d(t,{J:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 2.39 15.26 15.21",svg:(0,o(474848).jsx)("path",{d:"m10.775 2.583 2.475 2.475a.625.625 0 0 1 0 .884l-2.475 2.475a.625.625 0 1 1-.884-.884l1.408-1.408H4.8c-.649 0-1.175.526-1.175 1.175v5.975a.625.625 0 1 1-1.25 0V7.3A2.425 2.425 0 0 1 4.8 4.875h6.499L9.891 3.467a.625.625 0 0 1 .884-.884M17 6.1c.345 0 .625.28.625.625V12.7a2.425 2.425 0 0 1-2.425 2.425H8.7l1.408 1.408a.625.625 0 1 1-.884.884L6.75 14.942a.625.625 0 0 1 0-.884l2.475-2.475a.625.625 0 1 1 .884.884l-1.408 1.408H15.2c.649 0 1.175-.526 1.175-1.175V6.725c0-.345.28-.625.625-.625"})},r=(0,o(340498).wt)("arrowSquareLeftRight",n,"default")},457688:(e,t,o)=>{o.d(t,{A:()=>v,S:()=>h});var n=o(296540),r=()=>o(726637),i=()=>o(484714),l=()=>o(590526),a=()=>o(493552),s=()=>o(424400),c=()=>o(764880),d=()=>o(69708),u=o(474848);const p="bodyRegular",g="bodySemibold",m="bodySmRegular",S=n.forwardRef(((e,t)=>{const{actor:n,defaultUserTitle:i="name_only",useEmailAsTooltip:a,tooltip:d,tooltipPlacement:p,hoveredStyle:g,disabledFeedback:m,customUserTitleStyles:S,iconSizeOverride:v}=e,f=(0,l().K8)((()=>n.asActor&&n.isUser()?n.email:void 0),[n]),b=a&&f?f:d,x=v||(r().A.isMobile?s().nd:s().pg),w="name_and_email"===i||"name_and_email_unless_right"===i&&!Boolean(e.right)?(0,u.jsx)(y,{actor:null==n?void 0:n.asActor,customStyles:S}):(0,u.jsx)(h,{customStyles:S,actor:null==n?void 0:n.asActor});let C;return(0,c().H3)(n)?C=(0,u.jsx)(o(256863).A,{botValue:null==n?void 0:n.asActor,size:x}):(0,c().ps)(n)?C=(0,u.jsx)(o(453697).A,{userValue:null==n?void 0:n.asActor,size:x}):(0,o(534177).HB)(n),(0,u.jsx)(o(26697).m,{placement:p??"bottom",alignment:"start",textWrap:!0,render:n=>(0,u.jsx)(o(81068).A,{...(0,o(383036).A)(n,e),icon:C,title:w,disabledFeedback:m,className:"notranslate",ref:t,hoveredStyle:g}),disableTooltip:!b,renderTooltip:()=>b})}));function h(e){const{actor:t,customStyles:o}=e,n=(0,i().v3)(),s=(0,d().tz)(),c=t&&t.id===n.currentUser.id,g=(0,l().K8)((()=>t&&t.getDisplayName(s)),[t,s]),S=r().A.isMobile?m:p;return c?(0,u.jsx)(d().sA,{id:"UserMenuItem.fullName.authorLabel",defaultMessage:"<author>{fullName}</author> <you>(You)</you>",values:{author:e=>(0,u.jsx)(a().D,{as:"span",styleKey:S,style:o,children:e}),fullName:g,you:e=>(0,u.jsx)(a().D,{as:"span",colorVariant:"secondary",styleKey:S,style:o,children:e})}}):g?(0,u.jsx)(a().D,{textOverflow:"ellipsis",styleKey:S,style:o,children:g}):(0,u.jsx)(a().D,{styleKey:S,style:o,children:(0,u.jsx)(d().sA,{id:"UserMenuItem.fullName.unknownAuthorLabel",defaultMessage:"Unknown author"})})}function y(e){const{actor:t,customStyles:o}=e,n=(0,d().tz)(),i=(0,l().K8)((()=>t&&t.getDisplayName(n)),[t,n]),{email:s,showEmail:c}=(0,l().K8)((()=>{const e=t&&t.asActor&&t.isUser()?t.email:void 0;return{email:e,showEmail:i!==e}}),[t,i]),S=r().A.isMobile?"bodySmRegular":g,h=r().A.isMobile?m:p;return i?(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(a().D,{textOverflow:"ellipsis",as:"span",styleKey:S,style:o,children:i}),c?(0,u.jsx)(a().D,{textOverflow:"ellipsis",as:"span",styleKey:h,style:o,children:` ${s}`}):void 0]}):(0,u.jsx)(a().D,{styleKey:g,style:o,children:(0,u.jsx)(d().sA,{id:"UserMenuItem.fullName.unknownAuthorLabel",defaultMessage:"Unknown author"})})}S.displayName="UserMenuItem";const v=S},462402:(e,t,o)=>{o.d(t,{p:()=>l});var n=()=>o(907258),r=()=>o(47373),i=()=>o(288157);function l(e){var t;const{viewStore:o,viewIsInLibrary:l}=e,a=null===(t=o.getFormat())||void 0===t||null===(t=t.collection_view_source)||void 0===t?void 0:t.type;if(!l)return!1;if("teamspaceDirectory"===a&&!(0,i().a1)())return!0;if("libraryExternalPages"===a&&!(0,i().un)())return!0;const s=n().AppStoreSidebarSpaceViewStore.state;return!("myMeetings"!==a||s&&(0,r().pe)(s))}},466721:(e,t,o)=>{o.r(t),o.d(t,{STORE_MAX_LIMIT:()=>x,initializePageVisit:()=>w,updatePageVisits:()=>C});o(898992),o(354520),o(581454);var n=()=>o(907258),r=()=>o(770063),i=()=>o(273648),l=()=>o(90023),a=()=>o(179034),s=()=>o(874852),c=()=>o(559653),d=()=>o(161479),u=()=>o(743246),p=()=>o(496603),g=()=>o(534177),m=()=>o(211716),S=()=>o(299545),h=()=>o(761309),y=()=>o(41161),v=()=>o(129286),f=()=>o(753812);const b=32,x=100;async function w(e,t){await n().default.waitUntilRendered();const{fromPageRefresh:o,blockStore:i,pageVisitStore:p,timestamp:g,type:b}=t,x=e.currentUser.id;if(void 0===x||o)return;t.blockStore.id!==p.state.pageId&&p.setState({...p.getInitialState(),pageId:t.blockStore.id});const w=(0,r().v3)(i,{table:c().F9,id:(0,c().$5)({parent_id:i.id,user_id:x}),spaceId:(0,d().e)(i.pointer.spaceId)}),C=(0,r().v3)(i,{table:s().ou,id:(0,c().$5)({parent_id:i.id,user_id:x}),spaceId:(0,d().e)(i.pointer.spaceId)});if(await v().transactionQueue.awaitRecordTransaction({table:a().ev,id:i.id}),await(0,S().hS)(i),!i.canRead()||(0,h().qb)(e,i,i.getSpaceStore()))return;await w.load(),await C.load();const I=w.getKeyStore("visited_at").getValue(),T=C.getKeyStore("exited_at").getValue(),j=await async function(e,t,o,n,r){const{id:i}=e.currentUser,a=t.id,s=t.getSystemBlockTypeStore().getValue();if((0,l().kR)(s))return{type:"skipped"};const c=t.getParentTable()===u().C0;if(c)return{type:"skipped"};if(i&&"passive"!==r){var d;null==e||null===(d=e.mobileNative)||void 0===d||d.recordPageVisit(i,{blockId:a,spaceId:o,visitedAt:n}),y().A.recordVisit({id:a,systemBlockType:s,type:m().ig.Default,currentUserId:i})}const p=await f().callApi({eventName:"recordPageVisit",environment:e,data:{block:{id:a,spaceId:o},timestamp:n,type:r},headers:{recordId:a,spaceId:o}});return p}(e,i,(0,d().e)(i.pointer.spaceId),g,b);if("skipped"===j.type)return;if("failed"===j.type)return;const A=k({pageVisits:j.data.pageVisits,currentState:p.state,blockStore:i,totalCount:p.state.totalCount,hasMore:void 0});p.state.pageId===i.id&&p.setState({...A,lastViewTime:I,lastExitTime:T})}async function C(e,t){await n().default.waitUntilRendered();const o=e.currentUser.id;if(void 0===o)return;const{blockStore:r,pageVisitStore:i,incremental:l}=t,a=t.limit||b;let s;if(l){const{pageId:e,lastViewTime:t,lastExitTime:n,totalCount:r,hasMore:l,...a}=i.state,c=Object.entries(a).map((([e,t])=>{if(o===e)return;const n=t.getVisitedAt();return void 0!==n?n+1:void 0}));s=p().T9(c.filter(g().O9))}const c=await f().callApi({eventName:"getPageVisitors",environment:e,data:{block:{id:r.id,spaceId:(0,d().e)(r.pointer.spaceId)},sinceTimestamp:s,limit:a,includeTotalCount:t.includeTotalCount},headers:{recordId:r.id,spaceId:(0,d().e)(r.pointer.spaceId)}});if("failed"===c.type)return;const u=k({pageVisits:c.data.pageVisits,blockStore:r,currentState:i.state,totalCount:c.data.totalCount,hasMore:c.data.hasMore});let m;if(Object.keys(u).length<=x)m=u;else{const{pageId:e,lastViewTime:t,lastExitTime:o,totalCount:n,hasMore:r,...i}=u,l=(0,g().WP)(i).map((([e,t])=>[e,t.getVisitedAt()??0]));m={pageId:e,lastViewTime:void 0,lastExitTime:void 0,totalCount:n,hasMore:r};const a=p().Ul(l,(([,e])=>-e)).slice(0,x);for(const[s]of a)m[s]=u[s]}i.state.pageId===u.pageId&&i.setState(m)}function k(e){const{blockStore:t,pageVisits:o,currentState:n,totalCount:r,hasMore:l}=e,a={...n,pageId:t.id,totalCount:r,hasMore:l};for(const s of o){const{id:e,user_id:o}=s;o in a||(a[o]=i()._.createChildStore(t,{table:c().F9,id:e,spaceId:(0,d().e)(t.pointer.spaceId)}))}return a}},471095:(e,t,o)=>{o.r(t),o.d(t,{iconDefinition:()=>n,lockFillIcon:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.97 1.95 12.05 15.66",svg:(0,o(474848).jsx)("path",{d:"M6 5.95a4 4 0 1 1 8 0v1.433a2.426 2.426 0 0 1 2.025 2.392v5.4A2.425 2.425 0 0 1 13.6 17.6H6.4a2.425 2.425 0 0 1-2.425-2.425v-5.4c0-1.203.876-2.201 2.025-2.392zm6.75 1.4v-1.4a2.75 2.75 0 1 0-5.5 0v1.4zm-2.2 5.458a1.35 1.35 0 1 0-1.1 0v1.242a.55.55 0 0 0 1.1 0z"})},r=(0,o(340498).wt)("lockFill",n,"fill")},481975:(e,t,o)=>{o.d(t,{s:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"4.77 3.05 5.58 9.9",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M10.162 3.238a.625.625 0 0 0-.884 0l-4.32 4.32a.625.625 0 0 0 0 .884l4.32 4.32a.625.625 0 1 0 .884-.884L6.284 8l3.878-3.878a.625.625 0 0 0 0-.884"})},r=(0,o(340498).wt)("arrowChevronSingleLeftSmall",n,"small")},497222:(e,t,o)=>{o.d(t,{A:()=>m});o(296540);var n=()=>o(804773),r=()=>o(726637),i=()=>o(401497),l=()=>o(807449),a=()=>o(81068),s=()=>o(906380),c=()=>o(100622),d=()=>o(284371),u=()=>o(612900),p=()=>o(700251),g=o(474848);function m(e){const{icon:t,iconStyle:o,title:m,caption:S,right:h,rightStyle:y,isRedOnHover:v,isGray:f,isOrange:b,onClick:x,onMouseDown:w,onMouseEnter:C,onMouseLeave:k,disabled:I,showChevron:T,chevronStyle:j,rotateChevron:A,showDragHandle:M,focused:P,textWrapperStyle:_,shouldWrapCaption:R,desktopIconStyle:B,buttonStyle:V,desktopTitleStyle:F,source:E,menuListItemProps:O,isPulsing:D,shouldShowMobileBackground:z}=e,L=(0,p().y$)(),K=(0,i().IS)((()=>({style:{...f?{color:c().Tj.text.secondary,fill:c().Tj.icon.secondary}:b?{color:c().Tj.orange.icon.accentPrimary,fill:c().Tj.orange.icon.accentPrimary}:{color:c().Tj.text.primary,fill:c().Tj.icon.primary},opacity:I?.4:void 0,...V},leftIconStyle:{width:L,height:L,...o},rightStyle:{display:"flex",alignItems:"center",color:I?c().Tj.text.primary:c().Tj.text.tertiary,fill:I?c().Tj.icon.primary:c().Tj.icon.tertiary,flexShrink:0,marginInlineStart:r().A.isMobile?8:void 0,...y},rightChevronStyle:{marginInlineStart:"tableHeaderMenu"===E?0:6,transition:"transform 200ms ease-in-out",...A&&{transform:"rotate(90deg)"},...j}})),[f,b,I,o,j,y,V,L,A,E]),{itemRef:W,isTabbable:H,onKeyDown:N,onFocus:G}=(0,n().e)(),$=(0,g.jsx)(a().A,{ref:W,role:"menuitem",icon:null==t?void 0:t(K.leftIconStyle),focused:P||!1,disabled:I,title:m,caption:S,shouldWrapTitle:!0,shouldWrapCaption:R,desktopTitleStyle:{flexGrow:1,flexShrink:1,...F},onKeyDown:N,onFocus:G,disallowTabbing:!H,showDragHandle:M,buttonStyle:K.style,rightStyle:K.rightStyle,isRedOnHover:v,ignoreLocalHoverState:!!I||void 0,right:(0,g.jsxs)(g.Fragment,{children:[(0,g.jsx)("div",{style:{...d().RC,display:"flex"},children:h}),!I&&T?(0,g.jsx)(l().I,{icon:s().arrowChevronSingleRightSmallIcon,size:"sm",colorVariant:"tableHeaderMenu"===E?"secondary":"tertiary",style:K.rightChevronStyle}):null]}),onClick:x,onMouseDown:w,onMouseEnter:C,onMouseLeave:k,textWrapperStyle:_,desktopIconStyle:B,reducedPadding:e.reducedPadding,shouldShowMobileBackground:z,...O});return D?(0,g.jsx)(u().u,{borderRadius:6,shape:"square",children:$}):$}},500733:(e,t,o)=>{o.d(t,{I:()=>l});o(581454);var n=()=>o(496603),r=()=>o(654062),i=()=>o(244828);function l(e){const{collectionContextStore:t,environment:o,query:l,property:a,newAggregation:s}=e,c=t.collectionViewStore();if(!c)return;let d=l.aggregations?[...l.aggregations]:[];const u=(l.aggregations||[]).findIndex((e=>e.property===a));d=u<0?n().oE([...d,s]):n().oE(d.map(((e,t)=>u===t?s:e)));const p={...l,aggregations:d};!t.isClientModeEnabledStore.state&&s&&t.asyncAggregationStatusStore.setState({calculating:!0,aggregation:s,changingType:!0}),i().createAndCommit({userAction:"TableAggregationRow.handleTableAggregationChange",environment:o,canUndo:!0,perform:e=>{(0,r().F)({collectionViewStore:c,update:{query2:p},transaction:e})}})}},501500:(e,t,o)=>{o.d(t,{y:()=>r});class n extends(()=>o(757695))().Store{getInitialState(){return{}}requestOpenExternalSyncSettings(e,t){this.setState({pendingOpenSource:e,pendingOpenFrom:t})}clearPendingOpen(){this.setState({pendingOpenSource:void 0,pendingOpenFrom:void 0})}}const r=new n},505776:(e,t,o)=>{o.d(t,{A:()=>r});class n extends(()=>o(757695))().Store{constructor(...e){super(...e),this.updatePreviewState=e=>{this.update((t=>({...t,previewCanvasState:e(t.previewCanvasState)})))}}getInitialState(){return{chart:void 0,responsiveChartOptions:void 0,previewCanvasState:void 0,exportBackgroundColor:"gradient"}}}const r=n},513402:(e,t,o)=>{o.r(t),o.d(t,{arrowUpDownSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.67 2.48 12.66 11.03",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M11.349 2.672a.625.625 0 0 0-.884 0L7.666 5.471a.625.625 0 1 0 .884.883l1.732-1.73v8.262a.625.625 0 1 0 1.25 0V4.623l1.73 1.731a.625.625 0 0 0 .885-.883zM5.093 2.49a.625.625 0 0 0-.625.624v8.263l-1.73-1.731a.625.625 0 1 0-.885.883l2.798 2.799c.244.244.64.244.884 0l2.798-2.798a.625.625 0 0 0-.883-.884l-1.732 1.73V3.115a.625.625 0 0 0-.625-.625"})},r=(0,o(340498).wt)("arrowUpDownSmall",n,"small")},525271:(e,t,o)=>{o.d(t,{M:()=>a,W:()=>i});var n=()=>o(79926);const r=new(n().O2)("teamspaceDirectory",(()=>Promise.all([o.e(13023),o.e(79349),o.e(66012),o.e(49587)]).then(o.bind(o,89921)))),i=(0,n()._h)(r,(e=>e.TeamspaceDirectoryView)),l=new(n().O2)("TeamspaceDirectoryOpenInSidePeekButton",(async()=>await Promise.all([o.e(13023),o.e(79349),o.e(66012),o.e(49587)]).then(o.bind(o,54151)))),a=(0,n()._h)(l,(e=>e.TeamspaceDirectoryOpenInSidePeekButton))},532564:(e,t,o)=>{o.d(t,{V:()=>a,Z:()=>l});o(16280);var n=o(296540),r=o(474848);const i=n.createContext(void 0);function l(e){return(0,r.jsx)(i.Provider,{value:e.value,children:e.children})}function a(){const e=n.useContext(i);if(!e)throw new Error("useChartStore must be used within a ChartContextProvider");return e}i.displayName="ChartContext"},541235:(e,t,o)=>{o.d(t,{Ud:()=>l,YD:()=>i,c$:()=>n,q_:()=>r});const n={"sprints-onboarding":{steps:[{id:"current-sprint-view-tooltip"},{id:"sprint-task-tooltip"},{id:"complete-sprint-button-tooltip"}]},"enhanced-qna-onboarding":{steps:[{id:"find-in-tooltip"},{id:"mention-tooltip"}]},"jira-sync-onboarding":{steps:[{id:"all-projects-tooltip"},{id:"all-issues-tooltip"},{id:"database-views-and-filters-tooltip"},{id:"settings-to-setup-projects-and-issues"}]},"project-management-import-onboarding":{steps:[{id:"your-teamspace-tooltip"},{id:"all-projects-tooltip"},{id:"navigate-to-project-tasks-tooltip"},{id:"project-customization-tooltip"},{id:"related-tasks-database-views-tooltip"}]},"ai-comment-onboarding":{steps:[{id:"ai-comment-onboarding-tooltip"}]},database_onboarding:{steps:[{id:"database_onboarding_status_property_tooltip"},{id:"database_onboarding_add_property_tooltip"},{id:"database_onboarding_database_page_tooltip"},{id:"database_onboarding_board_view_tooltip"}]},"new-user-home-workspace-tour":{steps:[{id:"teamspaces"}]}},r="completed",i="dismissed";function l(e,t){return null==t?void 0:t[e]}},556148:(e,t,o)=>{o.d(t,{$u:()=>p,Dp:()=>s,Gd:()=>c,Hh:()=>h,Hl:()=>d,RT:()=>g,Xw:()=>S,Yg:()=>m,yA:()=>u});o(898992),o(672577),o(581454);var n=()=>o(882722),r=()=>o(3700),i=()=>o(999140),l=()=>o(836724),a=()=>o(236030);let s=function(e){return e[e.Left=0]="Left",e[e.Right=1]="Right",e[e.Up=2]="Up",e[e.Down=3]="Down",e}({});function c(e,t){const o=t.permissionScopesStore.state;return!e&&o.canEditContent}function d(e,t){let o=e;for(;null!==o;){if(o.classList.contains(t))return o;o=o.parentElement}}function u(e,t){const o=t?[t]:[];return(0,r().v2)(o[0],e)}function p(e){return(0,i().f5)({collectionContextStore:e})?a().Fh:0}function g(e){let t=e;for(;null!==t&&!t.classList.contains(n().WvK);)t=t.parentElement;if(null===t)return;return{col:parseInt(t.getAttribute("data-col-index")??"0"),row:parseInt(t.getAttribute("data-row-index")??"0")}}function m(e,t,o,n){return{col:o.findIndex((e=>e.property===t)),row:n.findIndex((t=>e===t))}}function S(e,t){if(!t)return;const o=l().T.findSelectablesFromStore(e).map((e=>e.getNode())).find((e=>t.contains(e)));return o?o.getBoundingClientRect():void 0}function h(e){const t=e.state;return!t.isOpen||0===t.additionalStores.length}},556402:(e,t,o)=>{o.d(t,{i:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"2.37 3.62 15.25 14",svg:(0,o(474848).jsx)("path",{d:"M2.375 5.75c0-1.174.951-2.125 2.125-2.125h11c1.174 0 2.125.951 2.125 2.125v7.5a2.125 2.125 0 0 1-2.125 2.125H12v1h1.5a.625.625 0 1 1 0 1.25h-7a.625.625 0 1 1 0-1.25H8v-1H4.5a2.125 2.125 0 0 1-2.125-2.125zM4.5 4.875a.875.875 0 0 0-.875.875v7.5c0 .483.392.875.875.875h11a.875.875 0 0 0 .875-.875v-7.5a.875.875 0 0 0-.875-.875z"})},r=(0,o(340498).wt)("display",n,"default")},560729:(e,t,o)=>{o.d(t,{A:()=>s});o(296540);var n=()=>o(726637),r=()=>o(127833),i=()=>o(30537),l=()=>o(107975),a=o(474848);function s(e){return n().A.isMobile?(0,a.jsx)(r().zD,{ariaLabel:e.ariaLabel,open:e.isOpen,popupType:i().n.SlideUp,origin:e.origin,onDismiss:e.onDismiss,render:e.render,style:e.style}):(0,a.jsx)(l().a,{ariaLabel:e.ariaLabel,open:e.isOpen,preventHideChildrenWhileOpening:!0,render:e.render,onDismiss:e.onDismiss,style:e.style,innerStyle:e.innerStyle,showCloseIcon:e.showCloseIcon})}},566910:(e,t,o)=>{o.d(t,{e:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"0.97 2.72 18.06 14.56",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M3.893 2.875a.626.626 0 0 1 .79-.02l.092.088.126.146.016.035.072.105 11.273 13.15a.624.624 0 0 1-1.036.678l-1.615-1.884c-1.12.408-2.339.633-3.611.633-3.757 0-7.049-1.946-8.707-4.843l-.155-.283a1.46 1.46 0 0 1 0-1.359l.155-.283c.89-1.554 2.249-2.835 3.898-3.688L3.826 3.757l-.072-.105a.626.626 0 0 1 .14-.777M6.031 6.33c-1.564.744-2.842 1.913-3.653 3.33l-.134.243a.21.21 0 0 0 0 .197l.134.243c1.426 2.49 4.292 4.214 7.622 4.214.958 0 1.877-.144 2.734-.406l-1.1-1.284a3.3 3.3 0 0 1-1.634.438l-.17-.004a3.307 3.307 0 0 1-3.132-3.133l-.004-.17c0-.777.269-1.492.718-2.056zm2.904 3.387q-.037.135-.038.281a1.104 1.104 0 0 0 1.218 1.097zM10 4.194c3.878 0 7.26 2.075 8.862 5.127l.074.164c.125.332.125.7 0 1.032l-.074.163a9.3 9.3 0 0 1-2.987 3.327l-.82-.955c1.15-.764 2.084-1.779 2.7-2.953l.02-.048a.2.2 0 0 0 0-.1l-.02-.049C16.382 7.282 13.438 5.445 10 5.445q-.705 0-1.378.1l-.94-1.098A10.7 10.7 0 0 1 10 4.194"}),(0,n.jsx)("path",{d:"M10.17 6.694a3.307 3.307 0 0 1 3.136 3.303l-.005.17a3.3 3.3 0 0 1-.116.702L9.624 6.713A3 3 0 0 1 10 6.691z"})]})},i=(0,o(340498).wt)("eyeSlash",r,"default")},569397:(e,t,o)=>{o.r(t),o.d(t,{arrowStraightRightSmallIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"2.12 3.05 11.76 9.9",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M9.372 3.238a.625.625 0 1 0-.884.884l3.253 3.253H2.75a.625.625 0 0 0 0 1.25h8.991l-3.253 3.253a.625.625 0 0 0 .884.884l4.32-4.32a.625.625 0 0 0 0-.884z"})},r=(0,o(340498).wt)("arrowStraightRightSmall",n,"small")},579372:(e,t,o)=>{o.d(t,{O:()=>i});var n=()=>o(79926);const r=new(n().O2)("databaseOnboardingTooltips",(()=>o.e(52191).then(o.bind(o,697166)))),i=(0,n()._h)(r,(e=>e.DatabaseOnboardingTourtip))},588047:(e,t,o)=>{o.d(t,{k:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"2.42 2.11 11.16 12.13",svg:(0,o(474848).jsx)("path",{d:"M8 2.115c-.854 0-1.569.554-1.824 1.315a3.96 3.96 0 0 0-2.138 3.518v.895c0 .655-.238 1.287-.669 1.78l-.616.704c-.75.858-.141 2.202 1 2.202H5.89a2.156 2.156 0 0 0 4.218 0h2.139c1.14 0 1.75-1.344.999-2.202l-.616-.704a2.7 2.7 0 0 1-.669-1.78v-.895A3.96 3.96 0 0 0 9.824 3.43 1.92 1.92 0 0 0 8 2.115m-.669 1.839A.68.68 0 0 1 8 3.365c.34 0 .623.253.669.589l.048.353.33.138a2.71 2.71 0 0 1 1.665 2.503v.895c0 .958.348 1.882.978 2.603l.616.704a.078.078 0 0 1-.058.129H3.752a.078.078 0 0 1-.058-.129l.616-.704c.63-.72.978-1.645.978-2.603v-.895c0-1.126.686-2.093 1.665-2.503l.33-.138zM8 13.084c-.394 0-.735-.226-.9-.555h1.8c-.165.33-.506.556-.9.556"})},r=(0,o(340498).wt)("bellSmall",n,"small")},591197:(e,t,o)=>{o.d(t,{VY:()=>a,ZJ:()=>i,u3:()=>l});var n=()=>o(140934);class r extends(()=>o(757695))().Store{getInitialState(){return{popupRenderedInPage:!1,popupRenderedInPeekView:!1}}}const i=new r,l=new(n().ComputedStore)((()=>!1!==i.state.popupRenderedInPage),{debugName:"AssistantWriterRenderedInPageStore"}),a=new(n().ComputedStore)((()=>!1!==i.state.popupRenderedInPeekView),{debugName:"AssistantWriterRenderedInPeekViewStore"})},611947:(e,t,o)=>{o.r(t),o.d(t,{checkIsTutorialDone:()=>S,dismissTutorial:()=>d,resetTutorials:()=>u,tutorialAdvanceToStep:()=>p,tutorialAdvanceToStepAfter:()=>g,tutorialGoToNextStep:()=>s,tutorialGoToPrevStep:()=>c,tutorialGoToStep:()=>m});var n=()=>o(907258),r=()=>o(541235),i=()=>o(680977),l=()=>o(244828),a=()=>o(646355);function s(e,t,o){var r;const{currentUserSettingsStore:l}=n().default.state;if(!l)return;const s=null===(r=l.getSettings())||void 0===r?void 0:r.tutorials;o?(0,i().m)({userSettingsStore:l,transaction:o,data:{tutorials:{...s,[t]:(0,a().i9)(l,t)}}}):h({userAction:"TutorialActions.nextStep",environment:e,perform:e=>{(0,i().m)({userSettingsStore:l,transaction:e,data:{tutorials:{...s,[t]:(0,a().i9)(l,t)}}})},userId:l.id})}function c(e,t){var o;const{currentUserSettingsStore:r}=n().default.state;if(!r)return;const l=null===(o=r.getSettings())||void 0===o?void 0:o.tutorials;h({userAction:"TutorialActions.prevStep",environment:e,perform:e=>{(0,i().m)({userSettingsStore:r,transaction:e,data:{tutorials:{...l,[t]:(0,a().KD)(r,t)}}})},userId:r.id})}function d(e,t){var o;const{currentUserSettingsStore:l}=n().default.state;if(!l)return;const a=null===(o=l.getSettings())||void 0===o?void 0:o.tutorials;(null==a?void 0:a[t])!==r().YD&&h({userAction:"TutorialActions.dismissTutorial",environment:e,perform:e=>{(0,i().m)({userSettingsStore:l,transaction:e,data:{tutorials:{...a,[t]:r().YD}}})},userId:l.id})}function u(e){const{currentUserSettingsStore:t}=n().default.state;t&&h({userAction:"TutorialActions.resetTutorialsDebug",environment:e,perform:e=>{(0,i().m)({userSettingsStore:t,transaction:e,data:{tutorials:{}}})},userId:t.id})}function p(e,t,o){var l;const{currentUserSettingsStore:s}=n().default.state;if(!s||(0,a().x$)(s,t))return;const c=(0,a().gt)(s,t);r().c$[t].steps.findIndex((e=>e.id===c))>=r().c$[t].steps.findIndex((e=>e.id===o))||(0,i().m)({userSettingsStore:s,transaction:e,data:{tutorials:{...null===(l=s.getSettings())||void 0===l?void 0:l.tutorials,[t]:o}}})}function g(e,t,o){if((0,a().ll)(o))return;const n=(0,a().tb)(t,o);n&&p(e,t,n)}function m(e,t,o,r){var l;const{currentUserSettingsStore:a}=n().default.state;if(!a)return;const s=null===(l=a.getSettings())||void 0===l?void 0:l.tutorials;r?(0,i().m)({userSettingsStore:a,transaction:r,data:{tutorials:{...s,[t]:o}}}):h({userAction:"TutorialActions.nextStep",environment:e,perform:e=>{(0,i().m)({userSettingsStore:a,transaction:e,data:{tutorials:{...s,[t]:o}}})},userId:a.id})}function S(e){const{currentUserSettingsStore:t}=n().default.state;return!!t&&(0,a().x$)(t,e)}function h(e){return l().createAndCommit({...e,canUndo:!1})}},612900:(e,t,o)=>{o.d(t,{u:()=>i});var n=()=>o(79926);const r=new(n().O2)("PulsingWrapper",(async()=>o.e(45248).then(o.bind(o,673962)))),i=(0,n().jQ)(r,(e=>e.PulsingWrapper),{renderLoading:(e,t)=>t.children})},615927:(e,t,o)=>{o.d(t,{Ay:()=>u,P6:()=>d,l1:()=>c});o(296540);var n=()=>o(401497),r=()=>o(718827),i=()=>o(406094),l=()=>o(100622),a=()=>o(284371),s=o(474848);const c=16;function d(e){const t=(0,n().IS)((()=>({button:{display:"inline",padding:"1px 2px",borderRadius:3,textDecoration:"underline"}})),[]);return(0,s.jsx)(r().Ay,{style:t.button,onClick:e.onClick,children:e.children})}const u=function(e){const{title:t,description:o,icon:r,style:d,titleStyle:u,buttonText:p,buttonOnClick:g,buttonIcon:m,secondaryButtonText:S,secondaryButtonOnClick:h}=e,y=(0,n().IS)((()=>({wrapper:{minHeight:250,height:1,display:"flex",alignItems:"center",flexDirection:"column",justifyContent:"center",gap:4,padding:c,...d},title:{fontSize:16,fontWeight:a().Wy.medium,color:l().Tj.text.tertiary,textAlign:"center",marginBottom:-2,...u},description:{margin:"0 auto",textAlign:"center",fontSize:14,color:l().Tj.text.tertiary},button:{marginTop:12,fontSize:14,fontWeight:a().Wy.medium,color:l().Tj.text.primary}})),[d,u]);return(0,s.jsxs)("div",{style:y.wrapper,children:[r,(0,s.jsx)("div",{style:y.title,children:t}),o?(0,s.jsx)("div",{style:y.description,children:o}):void 0,p?(0,s.jsx)(i().A,{size:"lg",onClick:g,style:y.button,iconLeading:m?{icon:m,size:"xs"}:void 0,children:p}):void 0,S?(0,s.jsx)(i().A,{size:"lg",onClick:h,style:y.button,children:S}):void 0]})}},621866:(e,t,o)=>{o.d(t,{i:()=>i});var n=()=>o(79926);const r={ConfigureViewsMainModuleAddViewButton:new(n().O2)("ConfigureViewsMainModuleAddViewButton",(async()=>await Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(96346),o.e(44711),o.e(53321),o.e(51220),o.e(62475),o.e(3151),o.e(98629),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(87017),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(47668),o.e(94522),o.e(24587),o.e(44584),o.e(67494),o.e(10522),o.e(38293),o.e(40992),o.e(88455),o.e(63515),o.e(33893),o.e(55162),o.e(91793),o.e(32370),o.e(26264),o.e(97989),o.e(36437),o.e(55113),o.e(25588),o.e(6769),o.e(23640),o.e(72252),o.e(93134),o.e(29351),o.e(93049),o.e(18636),o.e(64242),o.e(39986),o.e(76677),o.e(68609),o.e(37384),o.e(79340),o.e(72659),o.e(37759),o.e(41423),o.e(3261),o.e(23371),o.e(17729),o.e(94995),o.e(98339),o.e(51240),o.e(81803),o.e(68643),o.e(32625),o.e(95885),o.e(11424),o.e(40119),o.e(88522),o.e(69668),o.e(92924),o.e(92192),o.e(80326),o.e(53352),o.e(73069),o.e(88208)]).then(o.bind(o,965731))))},i=(0,n()._h)(r.ConfigureViewsMainModuleAddViewButton,(e=>e.ConfigureViewsMainModuleAddViewButton))},622936:(e,t,o)=>{o.r(t),o.d(t,{AgentIcon:()=>c,DefaultAgentIcon:()=>d});var n=o(296540),r=()=>o(59226),i=()=>o(783793),l=()=>o(187820),a=()=>o(963141),s=o(474848);function c(e){const{agentIcon:t,workflowStore:o,size:i,animated:c=!1}=e,d=(0,r().X)("animated_custom_agent_faces"),u=(0,n.useMemo)((()=>(0,a().D)({workflowStore:o,workflowIcon:t,size:i,animated:c&&d})),[t,o,i,c,d]);return(0,s.jsx)(l().B6,{icon:u,iconRecordCategory:"workflow",isEmptyPage:!1,size:i,disabled:!0})}function d(e){const t=(0,n.useCallback)((()=>e.size<22?"xsmall":e.size<28?"avatar":e.size<36?"small":e.size<42?"medium":e.size<48?"medium_plus":e.size<50?"medium_large":e.size<94?"large":"xlarge"),[e.size]);return(0,s.jsx)(i().x,{variant:t(),style:{cursor:"default"}})}},636107:(e,t,o)=>{o.d(t,{A:()=>fy,p:()=>vy});o(898992),o(581454),o(908872),o(737550);var n=()=>o(906745),r=o(296540),i=()=>o(314529),l=()=>o(564884),a=()=>o(907258),s=()=>o(135168),c=()=>o(933922),d=()=>o(59226),u=()=>o(242422),p=()=>o(993905),g=()=>o(726637),m=()=>o(259985),S=()=>o(755877),h=()=>o(17022),y=()=>o(402014),v=()=>o(616068),f=()=>o(578510),b=()=>o(908006),x=()=>o(484714),w=()=>o(852507),C=()=>o(118884),k=()=>o(590526),I=()=>o(401497),T=()=>o(79926),j=()=>o(929219),A=()=>o(391400),M=()=>o(755222),P=()=>o(757695),_=()=>o(365917),R=()=>o(795732),B=()=>o(711339),V=()=>o(118307),F=()=>o(887957),E=()=>o(41174),O=()=>o(107041),D=()=>o(921997),z=()=>o(558842),L=()=>o(201980),K=()=>o(100622),W=()=>o(496603),H=()=>o(534177),N=()=>o(436696),G=()=>o(934839),$=()=>o(661920),U=()=>o(865454),q=()=>o(708304),X=()=>o(589895),Y=()=>o(473336),Q=()=>o(339798),Z=()=>o(424599),J=()=>o(447453),ee=()=>o(527438),te=()=>o(450510),oe=()=>o(375764),ne=(o(672577),()=>o(999140)),re=()=>o(306499),ie=()=>o(760077);var le=()=>o(359454),ae=()=>o(295633),se=()=>o(677610),ce=()=>o(494305),de=()=>o(584262),ue=()=>o(799954),pe=()=>o(284371),ge=()=>o(187820),me=()=>o(16006),Se=()=>o(492414),he=()=>o(478726),ye=()=>o(747100),ve=()=>o(712505),fe=(o(354520),()=>o(756117)),be=()=>o(996332),xe=()=>o(245720),we=()=>o(127833),Ce=()=>o(250910),ke=()=>o(807449),Ie=()=>o(695115),Te=()=>o(546926),je=()=>o(890492),Ae=()=>o(81068),Me=()=>o(663639),Pe=()=>o(736847),_e=()=>o(955363),Re=()=>o(764781),Be=()=>o(126617),Ve=()=>o(424139),Fe=()=>o(566910),Ee=()=>o(167170),Oe=()=>o(742852),De=()=>o(105819),ze=()=>o(617668),Le=()=>o(69708),Ke=()=>o(430923),We=()=>o(896628),He=()=>o(384944),Ne=()=>o(572426),Ge=o(474848);const $e=function(e){const{store:t,titleStyle:o,actionButton:n,addViewButton:r}=e,i=(0,k().K8)((()=>t.getParentBlockStore()),[t]);return(0,Ge.jsx)("div",{children:(0,Ge.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,Ge.jsx)(Ne().c,{step:"demo_collection",store:i,children:(0,Ge.jsx)(me().A,{store:t,style:o})}),g().A.isMobile?null:r,n]})})};var Ue=()=>o(106412),qe=()=>o(955450),Xe=()=>o(400851),Ye=()=>o(440024),Qe=()=>o(405623),Ze=()=>o(654774),Je=()=>o(142096),et=()=>o(244828);const tt=(0,Le().YK)({actionsButtonAriaLabel:{defaultMessage:"Collection actions",id:"database.source.actionsButtonAriaLabel"},editDataSourceIconTitle:{defaultMessage:"Edit data source icon",id:"database.source.editDataSourceIcon.title"},editDatabaseIconTitle:{defaultMessage:"Edit database icon",id:"database.source.editDatabaseIcon.title"},editDataSourceLayoutTitle:{defaultMessage:"Edit data source layout",id:"database.source.editDataSourceLayout.title"},editDatabaseLayoutTitle:{defaultMessage:"Edit database layout",id:"database.source.editDatabaseLayout.title"}}),ot=Object.freeze({property:!0}),nt=r.memo((function(e){const{isHovered:t,collectionContextStore:o,addViewButton:n,showHoverActionsStore:r}=e,[i,l,a]=(0,k().K8)((()=>[o.collectionStore(),o.collectionViewBlockStore(),o.permissionScopesStore.state]),[o]),s=(0,k().K8)((()=>o.viewsModuleContextStore.isInLayoutBuilder()),[o]),c=(0,k().K8)((()=>{const e=o.collectionStore();if(!e)return!1;const t=e.getNameStore();return Boolean((0,Je().j)(t))}),[o]),d=(0,k().K8)((()=>{var e;return Boolean((null==i||null===(e=i.getParentBlockStore())||void 0===e?void 0:e.id)===(null==l?void 0:l.id))}),[i,l]),u=(0,k().K8)((()=>Boolean(null==i?void 0:i.isSyncedCollection())),[i]),p=(0,Ue().Zp)(),g=(d||c)&&a.canConfigureCollection&&!(null!=p&&p.disableEditingName)&&!u,m=(0,I().IS)((()=>({container:{display:"flex",alignItems:"center",minWidth:0,width:"max-content",maxWidth:"100%",marginInlineEnd:4},titleStyle:{fontWeight:pe().Wy.bold,fontSize:22,minWidth:0,maxWidth:"100%",width:"100%",...c?{whiteSpace:"nowrap",overflow:"auto",scrollbarWidth:"none",msOverflowStyle:"none"}:{display:"-webkit-box",lineClamp:1,WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"},marginInlineEnd:4}})),[c]);return i&&(null!=p&&p.disableContentPointerEvents||s)?(0,Ge.jsxs)("div",{style:m.container,children:[(0,Ge.jsx)(lt,{collectionContextStore:o,disabled:!0}),(0,Ge.jsx)($e,{store:i,titleStyle:m.titleStyle})]}):g?(0,Ge.jsx)(it,{isHovered:t,collectionContextStore:o,showHoverActionsStore:r,titleStyle:m.titleStyle,addViewButton:n}):(0,Ge.jsx)(rt,{isHovered:t,addViewButton:n,collectionContextStore:o,showHoverActionsStore:r,titleStyle:m.titleStyle})})),rt=r.memo((function(e){const{isHovered:t,collectionContextStore:o,showHoverActionsStore:n,titleStyle:i,addViewButton:l}=e,a=(0,x().v3)(),s=(0,Ue().Zp)(),{collectionStore:c,collectionViewBlockStore:d}=(0,k().K8)((()=>({collectionStore:o.collectionStore(),collectionViewBlockStore:o.collectionViewBlockStore()})),[o]),{isSystemCollection:u,href:p}=(0,k().K8)((()=>{const e=Boolean(null==c?void 0:c.isSystemCollection());return{isSystemCollection:e,href:e?void 0:(0,ne().t2)(o)}}),[o,c]),m=(0,I().IS)((()=>({container:{display:"flex",alignItems:"center",minWidth:0,width:"max-content",maxWidth:"100%",marginInlineEnd:4},containerInner:{paddingInlineStart:4,paddingInlineEnd:4,display:"flex",alignItems:"center",borderRadius:6},containerHovered:{background:"none"}})),[]),S=(0,r.useCallback)((()=>{(0,N().X)({environment:a,collectionContextStore:o,action:"click_collection_name_link_button"})}),[a,o]);return c&&d?(0,Ge.jsxs)(be().Q,{disabled:u||(null==s?void 0:s.disablePageLinks),style:m.container,innerStyle:m.containerInner,hoveredStyle:m.containerHovered,href:p,onClick:S,children:[(0,Ge.jsx)(lt,{collectionContextStore:o,disabled:!0}),(0,Ge.jsx)($e,{addViewButton:t?l:void 0,actionButton:t||g().A.isMobile?(0,Ge.jsx)(at,{showHoverActionsStore:n,collectionContextStore:o}):void 0,store:c,titleStyle:i})]}):null})),it=r.memo((function(e){const{isHovered:t,collectionContextStore:n,addViewButton:i,showHoverActionsStore:l,titleStyle:a}=e,s=(0,x().v3)(),c=(0,x().Y0)(),d=(0,Le().tz)(),u=(0,k().K8)((()=>n.collectionStore()),[n]),p=(0,k().K8)((()=>n.collectionViewBlockStore()),[n]),m=(0,k().K8)((()=>null==u?void 0:u.getNameStore()),[u]),S=(0,k().K8)((()=>(0,o(562969).getCollectionPlaceholderName)({collectionStore:u,intl:d})),[u,d]),h=(0,k().K8)((()=>!!m&&Boolean((0,Je().j)(m))),[m]),y=(0,k().K8)((()=>!Boolean(null==m?void 0:m.getValue())),[m]),v=(0,se().y)(),f=(0,I().IS)((()=>({container:{display:"flex",alignItems:"center",minWidth:0,width:"max-content",maxWidth:"100%",...v?{}:{marginInlineStart:4,marginInlineEnd:4}},titleIcons:{display:"flex",alignItems:"center",opacity:t||g().A.isMobile?1:0,flexShrink:0},text:{minWidth:0,flex:1,maxWidth:"100%",overflow:"hidden",...a,...c.isSafari&&!h&&y?{display:"block",...pe().RC}:{}},placeholder:{WebkitTextFillColor:K().Tj.pageTitlePlaceholderTextColor,cursor:"text"}})),[a,t,v,h,y,c.isSafari]),b=(0,r.useMemo)((()=>(0,Ge.jsxs)("div",{style:f.titleIcons,children:[g().A.isMobile?null:i,(0,Ge.jsx)(at,{showHoverActionsStore:l,collectionContextStore:n})]})),[i,n,l,f.titleIcons]),w=(0,r.useCallback)((()=>{(0,Ye().I)({environment:s})}),[s]),C=(0,r.useCallback)((()=>{const e=!Boolean(null==m?void 0:m.getValue());g().A.isMobile&&m&&e&&(0,Ze().x)({environment:s,store:m,canSelectAllBlocks:!1}),(0,N().X)({environment:s,collectionContextStore:n,action:"click_collection_name_input"})}),[m,s,n]);return u&&p&&m?(0,Ge.jsxs)("div",{style:f.container,children:[(0,Ge.jsx)(lt,{collectionContextStore:n,disabled:!1}),(0,Ge.jsx)(Qe().A,{store:m,style:f.text,disabled:!1,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableMobileActionBar:!1,disableComment:!0,placeholder:S,onEnter:w,onEsc:w,onClick:C,disableShiftEnter:!0,pasteBehavior:"inline",inPageFind:o(366437).Os.none,placeholderStyle:f.placeholder,disabledMentionTypes:ot},m.id),b]}):null})),lt=r.memo((function(e){const{disabled:t,collectionContextStore:n}=e,i=(0,x().v3)(),{collectionStore:l,collectionViewBlockStore:a}=(0,k().K8)((()=>({collectionStore:n.collectionStore(),collectionViewBlockStore:n.collectionViewBlockStore()})),[n]),s=(0,k().K8)((()=>null==l?void 0:l.getIcon()),[l]),c=(0,k().K8)((()=>{var e;return Boolean((null==l||null===(e=l.getParentBlockStore())||void 0===e?void 0:e.id)===(null==a?void 0:a.id))}),[l,a]),d=(0,k().K8)((()=>null==a?void 0:a.getType()),[a]),u=(0,I().IS)((()=>({iconStyle:{width:22,height:22,marginInlineEnd:4},container:{position:"relative",width:24,height:24,marginInlineEnd:4,display:"flex",alignItems:"center",justifyContent:"center"},arrowContainer:{width:20,marginInlineEnd:4}})),[]),p=(0,r.useCallback)((e=>{const t=l&&l.getIconStore();t&&et().createAndCommit({userAction:"CollectionViewBlockSource.handleRecordIconChange",environment:i,canUndo:!0,perform:o=>{He().KY({store:t,value:e,transaction:o})}})}),[l,i]);return l&&a?s||c?s?(0,Ge.jsxs)("div",{style:u.container,children:[t?(0,Ge.jsx)(ge().B6,{disabled:!0,bucket:"secure",store:l,icon:s,iconRecordCategory:"collection",isEmptyPage:!1,style:u.iconStyle,size:22}):(0,Ge.jsx)(ge().B6,{disabled:!1,bucket:"secure",store:l,icon:s,iconRecordCategory:"collection",isEmptyPage:!1,style:u.iconStyle,size:22,iconLoggingData:{recordTable:l.table,source:"inline_collection",block_type:d,collection_id:l.id},onChange:p}),c?void 0:(0,Ge.jsx)(o(205981).H,{size:"sm"})]}):null:(0,Ge.jsx)("div",{style:u.arrowContainer,children:(0,Ge.jsx)(ke().I,{icon:_e().arrowDiagonalUpRightIcon})}):null}));const at=r.memo((function(e){const{showHoverActionsStore:t,collectionContextStore:n}=e,i=(0,Le().tz)(),l=(0,k().O$)(t),a=function(e){const t=ut(e),o=ct(e),n=dt(e);return Object.values(t).some((e=>e))||Object.values(o).some((e=>e))||n}(n),s=(0,I().IS)((()=>({container:{display:"flex"},buttonPopup:{width:240}})),[]),c=(0,r.useCallback)((e=>(0,Ge.jsx)(Ie().A,{icon:g().A.isMobile?o(803960).arrowChevronSingleDownIcon:Be().ellipsisSmallIcon,ariaLabel:i.formatMessage(tt.actionsButtonAriaLabel),...e})),[i]),d=(0,r.useCallback)((e=>(0,Ge.jsx)(st,{parent:e,collectionContextStore:n})),[n]);return a?(0,Ge.jsx)(fe().A,{visible:l,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:s.container,children:(0,Ge.jsx)(Ce().A,{popupType:g().A.isMobile?we().nl.BottomSheet:we().nl.Popup,bottomSheetInitialState:"half",render:d,renderOrigin:c,style:s.buttonPopup,originGap:4})}):null})),st=r.memo((function(e){const{parent:t,collectionContextStore:n}=e,i=(0,Ge.jsx)(Le().sA,{defaultMessage:"Data source actions",id:"database.collectionNameActionsPopup.title"}),{collectionStore:l,collectionViewStore:a}=(0,k().K8)((()=>({collectionStore:n.collectionStore(),collectionViewStore:n.collectionViewStore()})),[n]),s=function({collectionContextStore:e,collectionViewStore:t}){const n=(0,x().v3)(),i=(0,Le().tz)(),l=ut(e);return(0,r.useMemo)((()=>{const r=[...l.addView?[{key:"add_view",render:t=>(0,Ge.jsx)(Ce().A,{popupType:Ce().z.BottomSheet,render:t=>(0,Ge.jsx)(Ke().zS,{collectionContextStore:e,onClose:t.close,hideAddDataSource:!1}),renderOrigin:e=>(0,Ge.jsx)(Ae().A,{...t,...e,title:(0,Ge.jsx)(Le().sA,{id:"database.source.addView.title",defaultMessage:"Add a new view"}),icon:(0,Ge.jsx)(ke().I,{icon:ze().plusIcon})})},"add-new-views"),action:()=>{}}]:[],...l.copyLinkAndDuplicateView?[{key:"copy_link_to_view",render:e=>(0,Ge.jsx)(Ae().A,{...e,icon:(0,Ge.jsx)(ke().I,{icon:Oe().linkIcon}),title:(0,Ge.jsx)(Le().sA,{id:"database.source.copyLinkToView.title",defaultMessage:"Copy link to view"})}),action:()=>{t&&((0,N().X)({environment:n,collectionContextStore:e,action:"view_action_menu_copy_link"}),Q().GH({environment:n,collectionContextStore:e,collectionViewStore:t}))}},{key:"duplicate_view",render:e=>(0,Ge.jsx)(Ae().A,{...e,icon:(0,Ge.jsx)(ke().I,{icon:Re().V}),title:(0,Ge.jsx)(Le().sA,{id:"database.source.duplicateView.title",defaultMessage:"Duplicate view"})}),action:()=>{t&&(0,o(873864).v)({environment:n,collectionContextStore:e,collectionViewStore:t,collectionSettingsStore:e.settingsStore,intl:i,from:"view_action_menu_duplicate"})}}]:[]];return r.filter((e=>null!==e))}),[t,e,n,i,l])}({collectionContextStore:n,collectionViewStore:a}),c=function({collectionContextStore:e,parent:t,collectionStore:n,collectionViewStore:i}){const l=(0,x().v3)(),a=(0,Le().tz)(),s=ct(e),c=(0,k().uB)(void 0,o(807072).A),d=(0,r.useRef)(null),u=(0,k().K8)((()=>e.collectionViewBlockStore()),[e]),p=(0,k().K8)((()=>{var t;return(null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.hasMultipleOwnedOrLinkedCollections())??!1}),[e]);return(0,r.useMemo)((()=>{const r=e=>{const t=null==n?void 0:n.getIconStore();t&&t.getValue()!==e&&(et().createAndCommit({userAction:"updateCollectionIcon",environment:l,canUndo:!0,perform:o=>{He().KY({store:t,value:e,transaction:o})}}),o(383594).I())},g=[...s.showViewDatabaseItem?[{key:"view",render:e=>(0,Ge.jsx)(Ae().A,{...e,title:(0,Ge.jsx)(Le().sA,{id:"database.source.viewDatabase.title",defaultMessage:"View database"}),icon:(0,Ge.jsx)(ke().I,{icon:_e().arrowDiagonalUpRightIcon})}),action:n=>{(0,o(239529).q)({environment:l,collectionContextStore:e,event:n.event,buttonPopupParent:t})}}]:[],...s.showEditNameItem?[{key:"edit_name",render:e=>(0,Ge.jsx)(Ae().A,{...e,title:p?(0,Ge.jsx)(Le().sA,{id:"database.source.editDataSourceTitle.title",defaultMessage:"Edit data source title"}):(0,Ge.jsx)(Le().sA,{id:"database.source.editTitle.title",defaultMessage:"Edit database title"}),icon:(0,Ge.jsx)(ke().I,{icon:De().pencilLineIcon})}),action:()=>{const o=null==n?void 0:n.getNameStore();o&&((0,Ze().x)({environment:l,store:o,canSelectAllBlocks:!1}),t.close(),(0,N().X)({environment:l,collectionContextStore:e,action:"click_source_edit_title"}))}},{key:"edit_icon",render:e=>(0,Ge.jsx)(Ae().A,{...e,ref:e=>{d.current=e},title:p?(0,Ge.jsx)(Le().sA,{...tt.editDataSourceIconTitle}):(0,Ge.jsx)(Le().sA,{...tt.editDatabaseIconTitle}),icon:(0,Ge.jsx)(ke().I,{icon:Ve().emojiFaceIcon})}),action:()=>{d.current&&n&&(0,ge().sg)({node:d.current,currentTab:"emoji",fileUploadParams:{bucket:"secure",store:n},environment:l,intl:a,disabled:!1,fileUploadStore:c,onChange:r})}}]:[],...s.showEditLayoutItem&&u?[{key:"edit_layout",render:e=>(0,Ge.jsx)(Ae().A,{...e,icon:(0,Ge.jsx)(ke().I,{icon:Ee()._}),title:p?(0,Ge.jsx)(Le().sA,{...tt.editDataSourceLayoutTitle}):(0,Ge.jsx)(Le().sA,{...tt.editDatabaseLayoutTitle})}),action:()=>{n&&((0,o(447934).nh)({environment:l,blockStore:u,collectionStore:n,collectionViewStore:i,from:"collection_view_action_menu"}),t.close())}}]:[],...s.showHideTitleItem?[{key:"hide_title",render:e=>(0,Ge.jsx)(Ae().A,{...e,icon:(0,Ge.jsx)(ke().I,{icon:Fe().e}),title:p?(0,Ge.jsx)(Le().sA,{id:"database.source.hideDataSourceTitles.title",defaultMessage:"Hide data source titles"}):(0,Ge.jsx)(Le().sA,{id:"database.source.hideTitle.title",defaultMessage:"Hide database title"})}),action:()=>{et().createAndCommit({userAction:"CollectionViewBlockSource.showTitleItem",environment:l,canUndo:!0,perform:t=>{if(!i)return;const o=e.collectionViewBlockStore();o&&We().zA({stores:[o],update:{hide_inline_collection_name:!0},transaction:t})}}),t.close(),(0,N().X)({environment:l,collectionContextStore:e,action:"click_source_hide_title"})}}]:[]];return g.filter((e=>null!==e))}),[i,l,e,t,n,a,c,d,p,s,u])}({collectionContextStore:n,parent:t,collectionStore:l,collectionViewStore:a}),d=function({collectionContextStore:e}){const t=dt(e),n=(0,o(637096).W)({collectionContextStore:e,entrypoint:"view_menu"});return(0,r.useMemo)((()=>t?{key:"calendar",render:e=>(0,Ge.jsx)(o(187391).N,{...e}),action:()=>{n()}}:void 0),[t,n])}({collectionContextStore:n}),u=function({viewActions:e,actionsMenuListItems:t,manageInCalendarButton:o}){return(0,r.useMemo)((()=>[e.length>0?{key:"view_actions",render:e=>(0,Ge.jsx)(Pe().A,{...e}),items:e}:null,t.length>0?{key:"actions",render:t=>(0,Ge.jsx)(Pe().A,{...t,topBorder:e.length>0}),items:t}:null,o?{key:"calendar",render:o=>(0,Ge.jsx)(Pe().A,{...o,topBorder:e.length>0||t.length>0}),items:[o]}:null].filter((e=>null!==e))),[e,t,o])}({viewActions:s,actionsMenuListItems:c,manageInCalendarButton:d});return l?(0,Ge.jsx)(je().A,{menuType:g().A.isMobile?Te().gu.Modal:Te().gu.Popup,title:i,right:(0,Ge.jsx)(Le().sA,{...xe().W.done}),onClickRight:t.close,children:(0,Ge.jsx)(Me().A,{type:Me().O.Vertical,onAccept:t.close,sections:u,initialFocus:void 0})}):null}));function ct(e){const t=(0,k().K8)((()=>e.collectionStore()),[e]),o=(0,x().v3)(),n=(0,k().K8)((()=>e.collectionViewBlockStore()),[e]),r=(0,k().K8)((()=>(null==t?void 0:t.isSyncedCollection())??!1),[t]),i=(0,k().K8)((()=>e.permissionScopesStore.state.canConfigureCollection),[e]),l=(0,k().O$)(e.canConfigureBlockStore),a=(0,Xe().X)({environment:o,blockStore:n,from:"viewsModule"});return{showViewDatabaseItem:(0,k().K8)((()=>{var o,n;const r=Boolean(null==t?void 0:t.isSystemCollection()),i=null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.id,l=null==t||null===(n=t.getParentBlockStore())||void 0===n?void 0:n.id,a=l&&i&&l===i;return!(e.isFullScreenStore.state&&a)&&!r}),[e,t]),showEditNameItem:i&&!r,showHideTitleItem:l,showEditLayoutItem:i&&a}}function dt(e){const t=(0,qe().K)({collectionContextStore:e}),o=(0,d().X)("notion_calendar_db_integration_non_time_views");return t&&o}function ut(e){const t=(0,k().K8)((()=>{var t;return 1===(null===(t=e.collectionViewBlockStore())||void 0===t?void 0:t.getCollectionViewStores().length)}),[e]);return{addView:g().A.isMobile,copyLinkAndDuplicateView:t}}const pt=r.memo((function(e){const{store:t,collectionContextStore:n,isFullScreen:i,canEdit:l,showHoverActionsStore:a,paddingLeft:s,addViewButton:c}=e,d=(0,x().v3)(),[u,p]=(0,r.useState)(!1),g=(0,k().K8)((()=>{var e;return"page"===(null===(e=n.collectionViewStore())||void 0===e?void 0:e.getType())}),[n]),m=(0,k().K8)((()=>{const e=ve().default.state;return(0,ye().RX)(t)||!(0,ye().cq)(t)&&e.open&&e.isClosing}),[t]),S=(0,k().K8)((()=>n.collectionStore()),[n]),h=(0,k().K8)((()=>n.collectionViewBlockStore()),[n]),y=(0,k().K8)((()=>Boolean(null==S?void 0:S.isSyncedCollection())),[S]),v=(0,k().K8)((()=>Math.min(he().x6,d.WindowSizeStore.state.width)),[d.WindowSizeStore]),f=(0,se().y)(),b=(0,I().IS)((()=>{const e=`${(i?s??0:0)+(f?ue().dE.paddingInlineStart:0)}px`;return{containerHoverArea:{flexGrow:1,minWidth:0},container:{display:"flex",alignItems:"center",justifyContent:"space-between",width:m?v:"100%",boxSizing:m?"content-box":void 0,paddingTop:4,paddingBottom:4,paddingInlineEnd:0,paddingInlineStart:e,...(i||m)&&(0,ce().z)(d)&&{position:"sticky",insetInlineStart:0}},nameContainer:{display:"flex",alignItems:"center",minWidth:0,flex:1,overflow:"hidden"},flex:{display:"flex"},button:{margin:0},syncedContainer:{paddingInlineStart:4}}}),[i,s,f,m,v,d]),w=(0,r.useCallback)((()=>{p(!0)}),[]),C=(0,r.useCallback)((()=>{p(!1)}),[]);return g?(0,Ge.jsx)(gt,{store:t,collectionContextStore:n,isFullScreen:i,paddingLeft:s}):S&&h?(0,Ge.jsxs)("div",{onMouseEnter:w,onMouseLeave:C,style:b.containerHoverArea,children:[(0,Ge.jsxs)("div",{style:b.container,children:[(0,Ge.jsx)("div",{style:b.nameContainer,children:(0,Ge.jsx)(nt,{collectionContextStore:n,showHoverActionsStore:a,addViewButton:c,isHovered:u})}),y?(0,Ge.jsx)("div",{style:b.flex,children:(0,Ge.jsx)(o(619126).A,{canEdit:l,store:h,buttonStyle:b.button})}):null]}),(0,Ge.jsx)("div",{style:b.syncedContainer,children:(0,Ge.jsx)(o(689383).A,{collectionStore:S,collectionContextStore:n})})]}):null})),gt=r.memo((function({store:e,collectionContextStore:t,isFullScreen:n,paddingLeft:r}){const i=(0,x().v3)(),l=(0,k().K8)((()=>{var o,n;let r=null===(o=t.collectionViewStore())||void 0===o?void 0:o.getFormat().page_pointer;var i;r||"viewsMain"!==(null===(n=t.viewsModuleContextStore)||void 0===n?void 0:n.getViewModuleType())||(r=null===(i=t.viewsModuleContextStore)||void 0===i||null===(i=i.currentPageStore())||void 0===i?void 0:i.pointer);if(!r)return;const l=t.collectionViewBlockStore();if(!l)return;const a=l&&l.id===r.id?l:ae().B.createChildStore(l,{table:r.table,id:r.id,spaceId:r.spaceId});return!(null!=a&&a.isPageBlock()||null!=a&&a.isCollectionView())||a&&a.id===e.id?void 0:a}),[t,e.id]),a=(0,k().K8)((()=>null==l?void 0:l.getBlockTitleStore()),[l]),s=(0,k().K8)((()=>{if(l)return(0,Se().Ay)({store:l,fullyQualified:!1,pageVisitSource:de().y8.CollectionViewTypePage})}),[l]),c=(0,se().y)(),d=(0,I().IS)((()=>({container:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",paddingTop:4,paddingBottom:4,paddingInlineStart:`${(n?r??0:0)+(c?ue().dE.paddingInlineStart:0)}px`,paddingInlineEnd:0,...n&&(0,ce().z)(i)&&{position:"sticky",insetInlineStart:0},...c?{}:{marginInlineStart:4,marginInlineEnd:4}},nameContainer:{display:"flex",alignItems:"center",minWidth:0,width:"max-content",maxWidth:"100%",marginInlineEnd:4},containerInner:{paddingInlineStart:4,paddingInlineEnd:4,display:"flex",alignItems:"center",borderRadius:6},icon:{marginInlineEnd:6},title:{fontSize:22,fontWeight:pe().Wy.bold,color:K().Tj.text.primary,minWidth:0,width:"100%",display:"-webkit-box",lineClamp:1,WebkitLineClamp:1,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis"}})),[n,i,r,c]),u=(0,k().K8)((()=>null==l?void 0:l.getIcon()),[l]);if(!l||!a)return null;return(0,Ge.jsx)("div",{style:d.container,children:(0,Ge.jsx)(o(552712).N,{href:s,style:d.nameContainer,children:(0,Ge.jsxs)("div",{style:d.containerInner,children:[(0,Ge.jsx)(ge().B6,{disabled:!0,bucket:"secure",store:l,icon:u,iconRecordCategory:"pageBlock",isEmptyPage:!1,style:d.icon,size:22}),(0,Ge.jsx)(me().A,{store:l,style:d.title})]})})})}));o(18107),o(967357),o(803949);var mt=()=>o(782482),St=()=>o(232615),ht=()=>o(179034),yt=()=>o(278634),vt=()=>o(388821),ft=()=>o(951177);const bt=new(o(29923).R)({key:"notion/async_clipboard_store",namespace:"AsyncClipboardStore",important:!0,trackingType:"necessary"});async function xt(e,{lastActionWasCut:t,valuePromise:o}){const n=(0,ft().hB)(e);bt.setState({eventId:n,waitingForCopy:!0,lastActionWasCut:void 0,value:void 0});const r=await o;if(!r)return void bt.setState({});const{recordMaps:i,...l}=r;bt.setState({eventId:n,waitingForCopy:!1,lastActionWasCut:t,value:{...l,recordMapsJson:kt(i)}})}function wt(e){const t=bt.getState(),o=(0,ft().hB)(e);if(!t||!o||t.eventId!==o)return Promise.resolve(void 0);const{waitingForCopy:n,value:r,lastActionWasCut:i}=t;return n?new Promise((e=>{bt.addListener(function(e,t){return function o(n){const r=n.getState();if(!r)return void n.removeListener(o);const{waitingForCopy:i,value:l,lastActionWasCut:a}=r;i||r.eventId!==e||(n.removeListener(o),t(l?{lastActionWasCut:a||!1,value:{...l,recordMaps:Ct(l.recordMapsJson)}}:void 0))}}(o,e))})):r?Promise.resolve({lastActionWasCut:i||!1,value:{...r,recordMaps:Ct(r.recordMapsJson)}}):Promise.resolve(void 0)}function Ct(e){return new Map(e.map((([e,t])=>[e,vt().RecordMap.create(t)])))}function kt(e){return[...e.entries()].map((([e,t])=>[e,t.toJson()]))}var It=()=>o(884107),Tt=()=>o(391214),jt=()=>o(675925),At=()=>o(499962),Mt=()=>o(920836),Pt=()=>o(3700),_t=()=>o(908201),Rt=()=>o(659602),Bt=()=>o(335722),Vt=()=>o(855801),Ft=()=>o(747674),Et=()=>o(206051);const Ot=r.memo((function(){const e=(0,x().v3)(),t=(0,_t().ET)(),{value:n}=(0,T().fJ)(Rt().g),{value:i}=(0,T().fJ)(Bt().S),l=(0,k().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.id}),[t]),a=(0,k().K8)((()=>{if(St().default.isEditingStore.state)return!1;const e=Et().default.state.stores.at(0),t=null==e?void 0:e.getModel();if(void 0===e||void 0===t)return!1;if(void 0===(0,Pt().oC)(e))return!1;const n=(0,o(236162).zN)({block:t,getRecordModel:e.getRecordModel});return void 0!==n&&n.id===l}),[l]),c=r.useCallback((async o=>{(await It().R.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:n});const r=Et().default.state.stores;xt(o,{lastActionWasCut:!1,valuePromise:Dt(e).then((o=>{const{result:n,status:i}=o;if("failed"===i)return;for(const r of n){var l;(0,yt().N)(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:r.id,block_type:r.getType(),isBulk:!0,collection_id:null===(l=t.collectionStore())||void 0===l?void 0:l.id})}const a=n.length>0;for(const c of r){var s;(0,yt().N)(e,{analyticsName:"Copy",from:"keyboard_shortcut",block_id:c.id,block_type:c.getType(),isBulk:a,collection_id:null===(s=t.collectionStore())||void 0===s?void 0:s.id})}return zt({environment:e,subitems:n})}))})}),[t,e,n]),d=r.useCallback((async o=>{(await It().R.clipboardActions.load()).copy({event:o,environment:e,markdownLinkifyIt:n});const r=t.collectionStore();if(null!=r&&r.isExternallyImportedAndSyncedCollection())return;const i=Et().default.state.stores,a=Dt(e),s=Dt(e).then((t=>{const{result:o,status:n}=t;if("failed"===n)return;for(const i of o)(0,yt().N)(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:i.id,block_type:i.getType(),isBulk:!0,collection_id:l});const r=o.length>0;for(const a of i)(0,yt().N)(e,{analyticsName:"Cut",from:"keyboard_shortcut",block_id:a.id,block_type:a.getType(),isBulk:r,collection_id:l});return zt({environment:e,subitems:o})}));await xt(o,{lastActionWasCut:!0,valuePromise:s});const c=Et().default.getState().stores,d=(await a).result;await Mt().vX({blocks:c,subitems:d,environment:e,canUndo:!0,skipConfirmation:!0})}),[t,l,e,n]),u=r.useCallback((async o=>{var r,a,c,d;const u=await It().R.clipboardActions.load(),p=await wt(o),g=await Vt().VI.loadLocalSubtree.load(),m=await Vt().VI.localDuplicate.load();bt.setState({...bt.getState(),lastActionWasCut:!1});const S=Et().default.getState().stores;if(!p){const r=t.collectionStore();et().createAndCommit({userAction:"CollectionViewKeyboardArea.defaultPaste",environment:e,canUndo:!0,perform:t=>{var l;(0,jt().o)(e,{action:"paste",block_type:null===(l=S[0])||void 0===l?void 0:l.getType(),from:"collection_view_keyboard_shortcut"},(l=>{u.paste({environment:e,event:o,spaceStore:(0,s().f)(r),disableEmbedMenu:!0,transaction:t,onPasteFiles:u.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:i}),l()}))}});const a=Et().default.state.stores[0];if(void 0===a)return;return void(0,yt().N)(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:a.id,block_type:a.getType(),isBulk:!1,collection_id:l})}const h=t.collectionViewBlockStore();if(!h)return;const y=t.collectionStore();if(!y)return;if(y.isExternallyImportedAndSyncedCollection())return;const{recordMaps:v,subitemFormat:f,childRelationSchema:x,parentRelationSchema:w}=p.value;if(!(v&&f&&x&&w))return;const C=[...v.entries()].map((([e])=>ae().B.createChildStore(y,{table:ht().ev,id:e})));await Promise.all(C.map((e=>e.load())));const k=!(p.lastActionWasCut&&function(e,t){const o=t.map((t=>ae().B.createChildStore(e,t.pointer)));if(o.find((e=>!e.isReady)))return!1;return!o.find((e=>e.getAlive()))}(y,C));let I=[],T=Pt().n9(t),j=null===(r=T)||void 0===r?void 0:r.parentRelationProperty,A=null===(a=T)||void 0===a?void 0:a.childRelationSchema,M=null===(c=T)||void 0===c?void 0:c.parentRelationSchema,P=null===(d=T)||void 0===d?void 0:d.subitemFormat;const _=t.permissionScopesStore.state.canConfigureCollection;for(const t of C)(0,yt().N)(e,{analyticsName:"Paste",from:"keyboard_shortcut",block_id:t.id,block_type:t.getType(),isBulk:p.value.isBulk,collection_id:l});if(et().createAndCommit({userAction:"CollectionViewKeyboardArea.pasteWithSubitems",environment:e,canUndo:!0,perform:r=>{if(!P&&_){Mt().VI({transaction:r,collectionContextStore:t,environment:e})&&(T=Pt().n9(t),T&&(j=T.parentRelationProperty,A=T.childRelationSchema,M=T.parentRelationSchema,P=T.subitemFormat))}var l;if(!(j&&A&&M&&P))return void(0,jt().o)(e,{action:"paste",block_type:null===(l=S[0])||void 0===l?void 0:l.getType(),from:"collection_view_keyboard_shortcut"},(t=>{u.paste({environment:e,spaceStore:(0,s().f)(y),event:o,disableEmbedMenu:!0,transaction:r,onPasteFiles:u.pasteFilesForBlocks,formulasModule:void 0,markdownLinkifyIt:n,tinyMceMicrosoftWordPasteFilter:i}),t()}));const a=k?Mt().B2({blocks:C,environment:e,transaction:r,recordMaps:v,migrateSubitemFormat:{from:f,to:P},collectionContextStore:t,originalSubitemSchemas:{subitemRelationSchema:x,parentRelationSchema:w},analyticsFrom:p.lastActionWasCut?"cut":"copy",loadLocalSubtreeModule:g,localDuplicateModule:m}):Mt().fA({blocks:C,transaction:r,from:f,to:P,environment:e,originAction:"paste"});!function(e){const{environment:t,selectedBlocks:o,blocksToInsert:n,subitemFormat:r,collectionContextStore:i,transaction:l}=e,a=i.collectionStore();if(!a)return;const s=o.at(-1),c=Pt().Px(n,r);if(0===c.length)return;if(s){const e=Pt().W5(i,s),o=function(e,t){if(e)return t;if(t.recordStoreUIParentStore instanceof ae().B&&t.recordStoreUIParentStore.isPageBlock())return t.recordStoreUIParentStore}(Boolean(null==e?void 0:e.isExpanded),s);c.forEach((e=>{Mt().VT({environment:t,blockStore:e,collectionStore:a,subitemFormat:r,transaction:l}),o&&At().j$({environment:t,sourceStore:e,destStore:o,propertyWithInverse:{property:r.inverse,inverse:r.property},transaction:l,position:{type:"after"}})}))}else c.forEach((e=>{Mt().VT({environment:t,blockStore:e,collectionStore:a,subitemFormat:r,transaction:l})}))}({environment:e,selectedBlocks:S,blocksToInsert:a,subitemFormat:P,collectionContextStore:t,transaction:r}),Tt().LE({environment:e,blocksToInsert:a,target:S,transaction:r,replaceEmptyTextBlock:!1,preventSetSelection:!0}),I=a}}),!(j&&A&&M&&P))return;const R=Pt().BK({blocks:I,parentRelationProperty:j,parentRelationSchema:M,collectionViewBlockStore:h});b().default.afterNextFlush((()=>{b().default.afterNextFlush((()=>{(0,Ft().t)({environment:e,stores:R})}))}))}),[t,l,e,n,i]);return(0,Ge.jsx)(mt().N,{debugName:`CollectionViewKeyboardArea-${l}`,capture:!0,priority:a?0:-1,onCopy:c,onCut:d,onPaste:u})}));function Dt(e){const t=Et().default.getState().stores;return Mt().zM({environment:e,blocks:t})}function zt({subitems:e,environment:t}){const n=Et().default.getState().stores,r=n.at(0);if(!r)return;const i=(0,Pt().oC)(r);if(!i)return;const l=[...n,...e],a=W().oE(l.map((e=>{const n=(0,o(59110).loadLocalSubtree)({environment:t,blockId:e.id,inMemoryRecordCache:e.inMemoryRecordCache,options:{allowCopyCollections:!0,requireFullSubtree:!1,skipTransclusionContainerChildren:!0,allowCopyExternalObjectInstances:!0}}).recordMap;return n&&[e.id,n]}))),s=new Map(a),{subitemFormat:c,childRelationSchema:d,parentRelationSchema:u}=i;return{recordMaps:s,subitemFormat:c,childRelationSchema:d,parentRelationSchema:u,isBulk:e.length>0}}var Lt=()=>o(390650);const Kt=new(T().O2)("lazyCreateHasSchemaChangedForQueryStore",(async()=>await o.e(42050).then(o.bind(o,366518))));var Wt=()=>o(835066),Ht=()=>o(501500),Nt=()=>o(157856),Gt=()=>o(279115),$t=()=>o(862292);async function Ut(e){const t=await $t().T.formulas.load();t.setFormulaParsingInstrumentation((()=>{class n extends t.FormulaParsingInstrumentation{constructor(...e){super(...e),this.pendingMetricsMap={},this.throttledFlushMetrics=W().nF((()=>{this.flushMetrics()}),15*o(615234).TD,{trailing:!0})}flushMetrics(){0!==Object.keys(this.pendingMetricsMap).length&&((0,l().u)({environment:e,event:{eventName:"collections_formula_parsing_cache_stats",eventProperties:(0,H().MU)((0,H().WP)(this.pendingMetricsMap).map((([e,t])=>[n.metricNameToEventProperty[e],t??0])))}}),this.pendingMetricsMap={})}incrMetricImpl(e){this.pendingMetricsMap[e]=(this.pendingMetricsMap[e]??0)+1,this.throttledFlushMetrics()}}return n.metricNameToEventProperty={"formulas.parsing.weak_map_cache.hit":"weak_map_cache_hit","formulas.parsing.weak_map_cache.miss":"weak_map_cache_miss"},new n}))}var qt=()=>o(635462),Xt=()=>o(29554),Yt=()=>o(807054),Qt=()=>o(891078),Zt=()=>o(117296),Jt=()=>o(665579),eo=()=>o(457419),to=()=>o(564607),oo=()=>o(692763),no=()=>o(644914),ro=()=>o(638001),io=()=>o(230062),lo=()=>o(977390),ao=()=>o(606932),so=()=>o(472090),co=()=>o(957763),uo=()=>o(845094),po=()=>o(307736),go=()=>o(825666);async function mo(e){const t=e.collectionViewBlockStore(),n=e.getCurrentUserId();if(!t||!n)return;const r=vt().RecordMap.create();(0,o(142748).Yn)(t.pointer,t.getRecordModel).forEach((e=>{r.setModel(e.pointer,e)}));const{supplementalRecordMap:i}=await(0,o(662711).Y1)({ancestorsRecordMap:r,actorPointers:new(o(728272).d)([{table:o(798880).oo,id:n}]),loadRecordModel:t.loadRecordModel});e.recordMapWithActorMembershipsStore.setState(i)}o(823215);var So=()=>o(624919),ho=()=>o(99895);const yo={formula:{initialResult:"collections_formula_initial_result_duration",mountToFirstResult:"collections_formula_mount_to_first_result"},relation:{initialResult:"collections_relation_initial_result_duration",mountToFirstResult:"collections_relation_mount_to_first_result"},rollup:{initialResult:"collections_rollup_initial_result_duration_v2",mountToFirstResult:"collections_rollup_mount_to_first_result_v2"}},vo=Symbol("DONE_WITH_INITIAL_RENDER");function fo(e){const{collectionContextStore:t}=e,o=function(e){const{collectionContextStore:t,mountedBeforeInitialPageRender:o}=e,n=(0,x().v3)(),i=(0,r.useRef)(new(ho().G)((()=>({done:!1,didTrackFirstResult:!1,pageIdToStatus:new Map}))));return{trackMount:(0,r.useCallback)((({pageId:e,propertyId:t})=>{const o=i.current;if(o===vo)return;const n=o.get(t);if(n.done)return;const r=performance.now();n.pageIdToStatus.has(e)||n.pageIdToStatus.set(e,{mountTime:r,gotFirstResult:!1}),(0,H().O9)(n.earliestMountTime)||(n.earliestMountTime=r)}),[]),trackResult:(0,r.useCallback)((({pageId:e,propertyId:r,propertyType:l,endTime:a,context:s})=>{const c=i.current;if(c===vo)return;const d=c.get(r);if(d.done)return;const{initialResult:u,mountToFirstResult:p}=yo[l],g=d.pageIdToStatus.get(e);if(!g)return void(0,So().NK)(`Property result duration performance entry for ${e}/${r} not found`);const m=W().Bj((()=>({...(0,Lt().kz)(t),is_navigation:!o,...s})));d.didTrackFirstResult||(d.didTrackFirstResult=!0,(0,H().O9)(d.earliestMountTime)?B().default.measure({metricName:p,startTime:d.earliestMountTime,endTime:a},{environment:n,shouldSendIfStatsigNotInitialized:!0,data:m()}):(0,So().NK)(`Missing earliestMountTime for property ${r}`)),g.gotFirstResult||(g.gotFirstResult=!0,B().default.measure({metricName:u,startTime:g.mountTime,endTime:a},{environment:n,shouldSendIfStatsigNotInitialized:!0,data:m()})),b().default.afterNextFlush((()=>{d.didTrackFirstResult&&[...d.pageIdToStatus.values()].every((e=>e.gotFirstResult))&&c.set(r,{done:!0}),[...c.values()].every((e=>e.done))&&(i.current=vo)}))}),[t,n,o])}}(e);return(0,w().w)((()=>{t.propertyResultDurationTracker||(t.propertyResultDurationTracker=o)})),null}var bo=()=>o(955104),xo=()=>o(604577);function wo(e){const{environment:t,timings:o,subMetricsTimes:n,dependencyLoadingMetrics:r,lazyRenderStartedAt:i}=e;return{render_started_at:n.cvbBlockRenderStart,mounted_at:n.cvbBlockRenderMount,items_started_at:n.itemsStart,items_visible:n.itemsVisible,query_request_count:o.queryCollectionRequests.length,query_request_times:o.queryCollectionRequests,collection_reducer_request_count:Object.keys(o.collectionReducerRequests).length,collection_reducer_request_times:Object.values(o.collectionReducerRequests),page_origin_time:(0,B().getPageOriginOrPrewarmedTabAppStartTime)(t),cvb_bundle_timing:Co(r),lazy_render_started_at:i,prefetch_stats:xo().X.getTraversalStats(),page_sub_metric_timings:ko()}}function Co(e){if(null!=e&&e.resolvedAt&&null!=e&&e.startedAt)return{started_at:e.startedAt,resolved_at:e.resolvedAt,duration_ms:e.resolvedAt-e.startedAt}}function ko(){var e,t,o,n,r,i,l,a,s,c;const d=A().A.state.subMetricsStore.state;return{app_start:null===(e=d.app_start_to_main_start)||void 0===e?void 0:e.startTime,main_start:null===(t=d.app_start_to_main_start)||void 0===t?void 0:t.endTime,prefetch_initiated:null===(o=d.main_start_to_prefetch_initiated)||void 0===o?void 0:o.endTime,app_env_end:null===(n=d.statsig_bootup_blocking)||void 0===n?void 0:n.startTime,statsig_bootup_blocking_end:null===(r=d.statsig_bootup_blocking)||void 0===r?void 0:r.endTime,render_start:null===(i=d.render_start_to_render_end)||void 0===i?void 0:i.startTime,render_end:null===(l=d.render_start_to_render_end)||void 0===l?void 0:l.endTime,await_page_chunk_start:null===(a=d.await_page_chunk_start_to_await_page_chunk_end)||void 0===a?void 0:a.startTime,await_page_chunk_end:null===(s=d.await_page_chunk_start_to_await_page_chunk_end)||void 0===s?void 0:s.endTime,browser_repaint_start:null===(c=d.await_page_chunk_end_to_browser_repaint_start)||void 0===c?void 0:c.endTime}}var Io=()=>o(736316);class To extends P().Store{getInitialState(){return{stage:"NOT_TRACKING"}}}function jo(e){const{collectionContextStore:t,collectionViewBlockRenderStartTime:o,didDelayOffscreenRenderRef:n,dependencyLoadingMetrics:i,mountedBeforeInitialPageRender:l,cvbLoadingStateOnInitialRender:a,lazyRenderStartedAtRef:s,trackPendingCollectionItemRender:c,skipTracking:d}=e,u=(0,x().v3)(),p=(0,k().uB)(void 0,To),g=(0,r.useRef)(0),m=(0,r.useRef)(o),S=(0,r.useRef)(),h=(0,r.useRef)(void 0),y=(0,r.useRef)(void 0),v=(0,r.useRef)(!0),f=(0,r.useRef)(!1),w=(0,r.useCallback)((()=>{"NOT_TRACKING"===p.state.stage&&(p.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"INITIAL"}),h.current=performance.now())}),[p]),C=(0,r.useCallback)((e=>{"NOT_TRACKING"===p.state.stage&&(p.setState({stage:"COUNTING_VISIBLE_ITEMS",source:"NAVIGATION"}),e&&(S.current=e))}),[p]),I=(0,r.useCallback)((()=>{if(null==c||c(),t.didItemsMountStore.setState(!0),n.current)return;const e=p.state.stage;if("COUNTING_VISIBLE_ITEMS"===e){if(g.current++,1===g.current){const e=performance.now();b().default.afterNextFlush((()=>{"COUNTING_VISIBLE_ITEMS"===p.state.stage&&p.setState({stage:"SHOULD_TRACK",endTime:e,source:p.state.source})}))}}else"NOT_TRACKING"===e&&v.current&&(v.current=!1,B().default.DO_NOT_USE_measureFromPageOriginLegacy({metricName:"missed_database_items_visible",endTime:performance.now()},{environment:u,data:Lt().ax({environment:u,collectionContextStore:t,visibleItemsCount:1,wasInitialRenderEmpty:f.current,isPrewarmedTab:(0,Yt().isPrewarmedTabInitialRender)(u),cvbLoadingStateOnInitialRender:a})}))}),[t,n,u,p,a,c]),T=(0,r.useCallback)((()=>{y.current||(y.current=performance.now())}),[]),j=(0,r.useCallback)((e=>{e.state&&"COUNTING_VISIBLE_ITEMS"===p.state.stage&&(f.current=!0,t.isEmptyStore.removeListener(j),I())}),[t.isEmptyStore,I,p]),M=(0,r.useCallback)((async e=>{if(!n.current&&"SHOULD_TRACK"===e.state.stage){const n=(0,Yt().isPrewarmedTabInitialRender)(u),c=n?A().A.state.prewarmedTabAppStartTimeOverride:void 0,d=Lt().ax({environment:u,collectionContextStore:t,visibleItemsCount:g.current||0,wasInitialRenderEmpty:f.current,isPrewarmedTab:n,cvbLoadingStateOnInitialRender:a}),p=u.RouterStore.state.route,v="page"===p.name&&p.blockId?X().Ob.lookupViewIds(p.blockId).length:0;if("INITIAL"===e.state.source){var o,r;const a=(0,Y().A)(null===(o=t.collectionViewStore())||void 0===o?void 0:o.id),p=null===(r=u.prefetcher.cache)||void 0===r?void 0:r.getPrefetchAnalytic(a),g={cvbBlockRenderStart:m.current,cvbBlockRenderMount:h.current,itemsStart:y.current,itemsVisible:e.state.endTime},S=function(e){const{subMetricsTimes:t}=e,{cvbBlockRenderStart:o,cvbBlockRenderMount:n,itemsStart:r,itemsVisible:i}=t,l={"collections.await_page_chunk_end_to_cvb_start":void 0,"collections.cvb_start_to_cvb_mount":void 0,"collections.cvb_mount_to_items_start":void 0,"collections.items_start_to_items_visible":void 0},{await_page_chunk_start_to_await_page_chunk_end:a}=A().A.state.subMetricsStore.state,s=({startTime:t,endTime:o})=>{if(e.isPrewarmedTab){if(o<=e.prewarmedTabNavigationStart)return 0;if(t<e.prewarmedTabNavigationStart&&o>e.prewarmedTabNavigationStart)return o-e.prewarmedTabNavigationStart}return o-t};return o&&a&&(l["collections.await_page_chunk_end_to_cvb_start"]=s({startTime:a.endTime,endTime:o}),(0,Io().f)({name:"collections.await_page_chunk_end_to_cvb_start",startTime:a.endTime,endTime:o})),o&&n&&(l["collections.cvb_start_to_cvb_mount"]=s({startTime:o,endTime:n}),(0,Io().f)({name:"collections.cvb_start_to_cvb_mount",startTime:o,endTime:n})),n&&r&&(l["collections.cvb_mount_to_items_start"]=s({startTime:n,endTime:r}),(0,Io().f)({name:"collections.cvb_mount_to_items_start",startTime:n,endTime:r})),r&&i&&(l["collections.items_start_to_items_visible"]=s({startTime:r,endTime:i}),(0,Io().f)({name:"collections.items_start_to_items_visible",startTime:r,endTime:i})),l}(n&&"number"==typeof c?{subMetricsTimes:g,isPrewarmedTab:!0,prewarmedTabNavigationStart:c}:{subMetricsTimes:g,isPrewarmedTab:!1}),f={...d,sub_metrics:S,initial_render_timings:wo({environment:u,timings:t.timingTracker.finishTracking(),subMetricsTimes:g,dependencyLoadingMetrics:i,lazyRenderStartedAt:null==s?void 0:s.current}),includes_page_origin_to_app_start:!0,is_swv2:await(0,Yt().isSWV2)(),is_browser_sw:await(0,Yt().isBrowserSW)()};l&&B().default.measureFromPageOrigin({metricName:"initial_database_items_visible",endTime:e.state.endTime},{environment:u,data:f,shouldSendIfStatsigNotInitialized:!0}),m.current&&(B().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_to_items_visible",startTime:m.current,endTime:e.state.endTime},{environment:u,data:f,shouldSendIfStatsigNotInitialized:!0}),"hit-match"===(null==p?void 0:p.type)&&void 0!==p.finished_at&&p.finished_at>m.current&&B().default.DO_NOT_USE_measureLegacy({metricName:"collections.initial_mount_waiting_for_api",startTime:m.current,endTime:p.finished_at},{environment:u,data:d}),(f.is_full_screen||1===v)&&bo().u4({name:"database_visit",args:{database_visit_id:f.database_visit_id}}))}else if("NAVIGATION"===e.state.source){if(S.current){const t={...d,wasm_sqlite_initialized:A().A.state.metricDataStore.state.wasm_sqlite_initialized,...ao().A.getDatabaseNavigationMetrics(S.current,i)};B().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_items_visible",startTime:S.current,endTime:e.state.endTime},{environment:u,data:t})}if(m.current){const o={cvbBlockRenderStart:m.current,cvbBlockRenderMount:h.current,itemsStart:y.current,itemsVisible:e.state.endTime},n=wo({environment:u,timings:t.timingTracker.finishTracking(),subMetricsTimes:o,dependencyLoadingMetrics:i,lazyRenderStartedAt:null==s?void 0:s.current});B().default.DO_NOT_USE_measureLegacy({metricName:"collections.navigation_mount_to_items_visible",startTime:m.current,endTime:e.state.endTime},{environment:u,data:{...d,initial_render_timings:n}}),(d.is_full_screen||1===v)&&bo().u4({name:"database_visit",args:{database_visit_id:d.database_visit_id}})}}else e.state.source;e.setState({stage:"COMPLETED"}),g.current=0}}),[t,n,u,l,a,s,i]);return(0,r.useEffect)((()=>{d&&p.setState({stage:"COMPLETED"})}),[d,p]),(0,r.useEffect)((()=>(d||p.addListener(M),()=>{p.removeListener(M)})),[M,p,d]),(0,r.useEffect)((()=>{if(!d)return t.isEmptyStore.addListener(j),()=>{t.isEmptyStore.removeListener(j)}}),[t.isEmptyStore,j,d]),{handleInitialDatabaseRender:w,handleNavigationDatabaseRender:C,handleItemMount:I,handleItemsRenderStart:T}}function Ao(e){const{collectionContextStore:t,collectionViewBlockRenderStartTime:o,didDelayOffscreenRenderRef:n,dependencyLoadingMetrics:r,mountedBeforeInitialPageRender:i,cvbLoadingStateOnInitialRender:l,lazyRenderStartedAtRef:a,trackPendingCollectionItemRender:s,skipTracking:c}=e,{handleInitialDatabaseRender:d,handleNavigationDatabaseRender:u,handleItemMount:p,handleItemsRenderStart:g}=jo({collectionContextStore:t,collectionViewBlockRenderStartTime:o,didDelayOffscreenRenderRef:n,dependencyLoadingMetrics:r,mountedBeforeInitialPageRender:i,cvbLoadingStateOnInitialRender:l,lazyRenderStartedAtRef:a,trackPendingCollectionItemRender:s,skipTracking:c});return t.databaseItemsVisibleTracker||(t.databaseItemsVisibleTracker={handleInitialDatabaseRender:d,handleNavigationDatabaseRender:u,handleItemMount:p,handleItemsRenderStart:g}),null}var Mo=()=>o(609837),Po=()=>o(671593),_o=()=>o(666144);async function Ro(e){const{environment:t,collectionContextStore:o,blockIdToMinimumVersion:n}=e;await async function(e,t){return await Promise.all((0,H().WP)(t).map((async([t,o])=>_o().sy({environment:e,inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache,pointer:{table:ht().ev,id:t},userId:e.currentUser.id,minimumVersion:o}))))}(t,n),o.resultSetStore.addLocalChange(Object.keys(n))}var Bo=()=>o(638681);const Vo=Bo().undefinable(Bo().object({required:{blockIdToVersion:Bo().record(Bo().string(),Bo().number())},optional:{hasMore:Bo().boolean()}}));class Fo{constructor(e,t){this.deferredCollectionEmit=void 0,this.queuedBlockIdsToRefetch=void 0,this.isServerRequestRequired=void 0,this.collectionContextStore=void 0,this.environment=void 0,this.handleCollectionSchemaChange=e=>{if(!this.collectionContextStore.isClientModeEnabledStore.state&&e.state){var t,o;const e=`${null===(t=this.collectionContextStore.collectionStore())||void 0===t?void 0:t.id}:${null===(o=this.collectionContextStore.collectionStore())||void 0===o||null===(o=o.getModel())||void 0===o?void 0:o.getVersion()}`;this.throttledRefetch({src:"change_schema",trigger:e})}},this.isServerQueryCollectionRequiredForCollectionEmit=(e,t)=>{const o=this.collectionContextStore.isClientModeEnabledStore.state;if(o&&t&&"collectionTypedView"===this.collectionContextStore.contextTypeFromStoreState)return!0;const n=Boolean(e&&(0,Po().Xj)(Vo,e)&&e.hasMore);if(o&&!n)return!1;const r=this.collectionContextStore.remoteRequestStore.state;if(!r)return!0;if(r.loader.propertyAggregations)return!0;return!!(0,H().WP)(r.loader.reducers||{}).some((([e,t])=>"results"!==t.type))||!(e&&(0,Po().Xj)(Vo,e)&&!e.hasMore)},this.throttledRefetch=(0,o(279900).A)((e=>this.refetchFromRemote({...e,queuedTimestamp:Date.now()}))),this.processCollectionRefetch=async e=>{const t=this.queuedBlockIdsToRefetch,o=this.isServerRequestRequired;if(this.reset(),o){var n;const o=null===(n=(0,H().uv)(t))||void 0===n?void 0:n[0],r=t[o];this.throttledRefetch({src:e,trigger:`${o}:${r}`})}t&&await Ro({environment:this.environment,collectionContextStore:this.collectionContextStore,blockIdToMinimumVersion:t})},this.refetchFromRemote=async e=>{const t=this.collectionContextStore.throttleMsStore.state;await Promise.all([(0,oe().M)(this.environment,this.collectionContextStore,e),(0,o(763824).wR)(t)])},this.deferredCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={},this.collectionContextStore=e,this.environment=t}reset(){this.deferredCollectionEmit=!1,this.isServerRequestRequired=!1,this.queuedBlockIdsToRefetch={}}addBlockIdToRefetch(e,t){this.queuedBlockIdsToRefetch[e]=Math.max(this.queuedBlockIdsToRefetch[e]??0,t)}async handleCollectionEmit(e){const{src:t,passThroughData:o,shouldDeferCollectionEmit:n,isCollectionTypeChange:r}=e;if((0,Po().Xj)(Vo,o)&&null!=o&&o.blockIdToVersion&&(0,H().WP)(o.blockIdToVersion).forEach((([e,t])=>this.addBlockIdToRefetch(e,t))),this.isServerRequestRequired=this.isServerRequestRequired||this.isServerQueryCollectionRequiredForCollectionEmit(o,r),!n)return await this.processCollectionRefetch(t);this.deferredCollectionEmit=!0}async maybeProcessDeferredCollectionEmit(e){if(this.deferredCollectionEmit)return await this.processCollectionRefetch(e)}subscribeToSchemaChanges(e){e.addListener(this.handleCollectionSchemaChange)}unsubscribeFromSchemaChanges(){var e;null===(e=this.collectionContextStore.hasSchemaChangedForQueryStore)||void 0===e||e.removeListener(this.handleCollectionSchemaChange)}}const Eo=r.memo((function(e){const{isFullScreen:t,leftRightPaddingStore:n,leftRightMarginStore:r,overrideViewType:i}=e,l=(0,_t().ET)(),a=(0,k().K8)((()=>(0,ne().f5)({collectionContextStore:l,overrideViewType:i})),[l,i]),s=(0,k().K8)((()=>{var e;if(!a)return 0;return(t?(null===(e=n.state)||void 0===e?void 0:e.paddingLeft)??0:0)+(r.state.marginLeft??0)-2}),[a,r,n,t]);return a?(0,Ge.jsx)(o(35584).or,{marginLeft:s}):null}));var Oo=()=>o(23749),Do=()=>o(45105),zo=()=>o(874832),Lo=()=>o(30537),Ko=()=>o(124092),Wo=()=>o(26697),Ho=()=>o(863330);const No=new(T().O2)("MinimizableCollectionViewBlockHeaderActions",(async()=>await o.e(94516).then(o.bind(o,150177)))),Go=(0,T()._h)(No,(e=>e.MinimizableCollectionViewBlockHeaderActions)),$o=new(T().O2)("DashboardHeaderActions",(async()=>await o.e(58419).then(o.bind(o,537798)))),Uo=(0,T()._h)($o,(e=>e.DashboardHeaderActions)),qo=new(T().O2)("MyTasksAddItemPopup",(async()=>await Promise.all([o.e(37384),o.e(72659),o.e(23371),o.e(57735)]).then(o.bind(o,433442)))),Xo=(0,T()._h)(qo,(e=>e.MyTasksAddItemPopup));var Yo=()=>o(132389),Qo=()=>o(162674),Zo=()=>o(610101),Jo=()=>o(468397);const en="noWritableDbs";function tn(e){const{collectionContextStore:t,onAddTaskClick:n,from:i}=e,l=(0,x().v3)(),a=(0,r.useRef)(null),s=(0,k().uB)(void 0,V().A),c=(0,d().X)("collection_custom_item_name"),p=(0,k().K8)((()=>"on"===u().default.getEligibleGroup({experimentId:"my_tasks_limit_experiment",defaultGroup:"control"})),[]),g=(0,k().O$)(t.isInHomeWidgetStore),m=(0,k().K8)((()=>t.collectionStoresStore.state.length>0),[t.collectionStoresStore]),S=(0,k().K8)((()=>{const e=t.collectionStoresStore.state;return Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())))}),[t.collectionStoresStore]),h=(0,k().K8)((()=>(0,ne().h6)({collectionContextStore:t,isCustomItemNameEnabled:c})),[t,c]),y=(0,k().K8)((()=>!t.isFullScreenStore.state),[t]),v=(0,r.useCallback)((e=>{Q().Ub({environment:l,handleAddItemClick:n,buttonRef:a,event:e})}),[l,n,a]),f=(0,I().IS)((()=>({container:{width:"100%",height:y?"calc(100% - 4px)":void 0,paddingTop:y?32:120,paddingBottom:32,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",fontSize:14,color:K().Tj.text.tertiary},icon:(0,Jt().Xx)()})),[y]),b=(0,r.useMemo)((()=>m?(0,Ge.jsx)(Wo().m,{disableTooltip:S,placement:"bottom",renderTooltip:()=>(0,Ge.jsx)(Le().sA,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"tasksEmptyState.addTask.tooltip.noWritableDbs",values:{br:(0,Ge.jsx)("br",{})}}),render:e=>p?(0,Ge.jsx)(Ce().A,{popupType:Lo().n.Popup,buttonPopupStore:s,placementToOrigin:"bottom",alignmentToOrigin:"center",render:()=>(0,Ge.jsx)(Xo,{collectionContextStore:t,onAddItem:n,buttonPopupStore:s}),renderOrigin:t=>(0,Ge.jsx)(Ko().p,{...t,...e,colorPalette:"blue",ref:a,disabled:!S,disabledFeedback:!S,onClick:e=>{var o;(0,Qo().bS)({environment:l,from:i}),null===(o=t.onClick)||void 0===o||o.call(t,e)},iconLeading:{icon:Ho().plusSmallIcon,size:"sm"},children:h})}):(0,Ge.jsx)(Ko().p,{...e,colorPalette:"blue",ref:a,disabled:!S,disabledFeedback:!S,onClick:e=>{(0,Qo().bS)({environment:l,from:i}),v(e)},iconLeading:{icon:Ho().plusSmallIcon,size:"sm"},children:h})}):p?(0,Ge.jsx)(Ko().p,{colorPalette:"blue",onClick:()=>{(0,Qo().bS)({environment:l,from:i}),(0,Jo().q)(l,t)},children:(0,Ge.jsx)(Le().sA,{defaultMessage:"Configure your task sources",id:"tasksEmptyState.configureTaskSources"})}):(0,Ge.jsx)(Ko().p,{colorPalette:"blue",onClick:()=>{(0,Qo().bS)({environment:l,from:i}),Zo().A.setState({isOpen:!0,from:i})},children:(0,Ge.jsx)(Le().sA,{defaultMessage:"Don’t see your tasks?",id:"tasksEmptyState.noDatabases.title"})})),[m,S,h,l,i,v,p,t,s,n]);return g&&!m?(0,Ge.jsx)(Zt().Ww,{feature:"tasks",onSetup:()=>{(0,Qo().bS)({environment:l,from:i}),p?(0,Jo().q)(l,t):Zo().A.setState({isOpen:!0,from:i})}}):(0,Ge.jsxs)("div",{style:f.container,children:[(0,Ge.jsx)(ke().I,{icon:o(166292).checkStackIcon,style:f.icon}),(0,Ge.jsx)(Yo().A,{size:16}),S?(0,Ge.jsx)(Le().sA,{defaultMessage:"No matching tasks.",id:"tasksEmptyState.noMatchingTasks.title"}):(0,Ge.jsx)(Le().sA,{defaultMessage:"See all tasks assigned to you here.",id:"tasksEmptyState.noTasks.title"}),(0,Ge.jsx)(Yo().A,{size:16}),b]})}var on=()=>o(485569);function nn({store:e,collectionViewStore:t,collectionContextStore:o}){let n,r=t.getFormat().page_pointer;const i=o.viewsModuleContextStore;if(!r&&"viewsMain"===(null==i?void 0:i.getViewModuleType())){const e=i.currentPageStore();e&&(r=e.pointer,n=e)}if(r)return n??=e.id===r.id?e:ae().B.createChildStore(e,{table:r.table,id:r.id,spaceId:r.spaceId}),n.isPageBlock()||n.isCollectionView()?n:void 0}var rn=()=>o(222299),ln=()=>o(551619);const an=new(T().O2)("views-main-builder-modules",(()=>Promise.all([o.e(35530),o.e(9773),o.e(36556),o.e(40537),o.e(44711),o.e(53321),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(14578),o.e(46414),o.e(37384),o.e(72659),o.e(94995),o.e(69668),o.e(60713),o.e(70605)]).then(o.bind(o,984318)))),sn=(0,T()._h)(an,(e=>e.ViewsMainBuilderModules));var cn=()=>o(778781),dn=()=>o(243991),un=()=>o(9768);const pn=r.memo((function(e){const{modules:t,store:n,collectionStore:r,context:i,disabled:l,templatePickerMenuListStore:a,pageLayoutRef:s,collectionContextStore:c,editorContentContainerRef:d}=e,u=(0,x().v3)(),p=(0,k().K8)((()=>r.getSchema()),[r]),g=(0,k().K8)((()=>(0,o(577814).A)({environment:u,store:n,pageViewBlockStore:void 0})),[u,n]),m=(0,Ge.jsx)(Ge.Fragment,{children:t.map((e=>(0,Ge.jsx)(gn,{module:e,store:n,context:i,disabled:l,collectionSchema:p,collectionStore:r,modules:t,templatePickerMenuListStore:a,pageLayoutRef:s,pageDiscussionsRenderState:g,editorContentContainerRef:d},e.id)))});return c?(0,Ge.jsx)(_t().RI,{value:c,children:m}):m}));function gn({module:e,store:t,context:n,disabled:i,collectionSchema:l,collectionStore:a,modules:s,templatePickerMenuListStore:c,pageLayoutRef:d,pageDiscussionsRenderState:u,editorContentContainerRef:p}){const g=(0,x().v3)(),m=(0,un().Br)({layoutModule:e,area:"views_main_tab_modules",collectionSchema:l,collectionStore:a,pageMainModules:s,showDetailsPanelToggleButtonBelowTitle:!1}),S=(0,un().Jh)({layoutModule:e,area:"views_main_tab_modules",collectionSchema:l,collectionStore:a,showDetailsPanelToggleButtonBelowTitle:!1,modules:s}),h=(0,k().K8)((()=>!(0,o(864994).g)({environment:g,layoutArea:"views_main_tab_modules",moduleType:e.type,pageViewBlockContext:n})),[g,e.type,n]);return(0,o(120997).p)(e,"views_main_tab_modules")?(0,cn().gx)(e)?(0,Ge.jsx)(o(483832).v,{context:n,disabled:i,propertyId:e.propertyId,store:t,pageModule:e,wrapper:S,stackPropertyLabelAndValue:h},`${e.id}-${t.id}`):(0,cn().i_)(e)?(0,Ge.jsx)(r.Fragment,{children:(0,Ge.jsx)(o(598067).h,{context:n,disabled:i,store:t,wrapper:S,layoutModule:e,customization:{neverShowPropertiesElsewhereInLayout:!0,stackPropertyLabelAndValue:h,disableContainerPadding:!0,disableLastRowBottomPadding:h},showDefaultTitle:!0})},`${e.id}-${t.id}`):"editor"===e.type?(0,Ge.jsx)(dn().p,{context:n,disabled:i,handlePlaceholderWrapClick:e=>rn().YB(e,t,g),pageBlockStore:t,pathToBlockId:e.pathToBlockId,templatePickerMenuListStore:c,pageViewBlockAccessor:()=>(null==d?void 0:d.current)??null,editorWrapper:n===R().R.DraftPostInInlineComposer||n===R().R.WorkflowInstructionsInInlineComposer?void 0:S,ref:p}):"relationsGroup"===e.type?(0,Ge.jsx)(o(996262).z,{pageStore:t,wrapper:S,disabled:i,context:n,showDefaultTitle:m}):"deleted_property"===e.type?null:"discussions"===e.type?(0,Ge.jsx)(o(257502).d,{store:t,wrapper:S,showDefaultTitle:m,discussionLocation:"page_discussion",pageDiscussionsRenderState:u}):void(0,H().HB)(e):null}var mn=()=>o(817942),Sn=()=>o(255824);const hn=r.memo((function(e){const{store:t,canEdit:n,templatePickerMenuListStore:i,collectionStore:l,collectionViewStore:a,isFullScreen:s,editorContentContainerRef:c}=e,d=(0,x().v3)(),u=(0,x().Y0)(),p=(0,r.useRef)(null),g=(0,k().K8)((()=>(0,eo().S)(t)),[t]),m=(0,Sn().a)(),S=(0,_t().ET)(),h=(0,o(933951).sS)({pageStore:t,collectionStore:l,pageViewBlockStore:void 0}),{layoutTabModules:y,viewsMainTabId:v}=(0,k().K8)((()=>{const e=null==h?void 0:h.views_main_tab_modules;if(!e)return{layoutTabModules:void 0,viewsMainTabId:void 0};const t=null==a?void 0:a.getFormat().page_layout_pointer;if(!t)return{layoutTabModules:void 0,viewsMainTabId:void 0};return{layoutTabModules:e[t.views_main_tab_id],viewsMainTabId:t.views_main_tab_id}}),[a,h]),f=(0,ln().n$)(),b=(0,k().K8)((()=>(0,ye().cq)(t)?R().R.PeekView:S.isFullScreenStore.state?R().R.CollectionPageViewFullScreen:R().R.CollectionPageView),[S,t]),w=(0,Qt().VE)(t),C=(0,k().K8)((()=>{const e=o(129522).K.findBlockFromStore(t);if(e)return"collectionContextStore"in e?e.collectionContextStore:void 0}),[t]),I=(0,k().K8)((()=>(0,o(741751).NS)(w,t,b,u)),[w,t,b,u]),T=!n||g||m,j=m&&v?(0,Ge.jsx)("div",{style:{paddingTop:12,paddingInlineEnd:4},children:(0,Ge.jsx)(sn,{viewsMainTabId:v,pageLayoutType:I})}):y&&l?(0,Ge.jsx)(mn().Mx,{ref:p,type:I,suppressMargin:!0,style:{paddingTop:12,paddingBottom:s?f:void 0},children:(0,Ge.jsx)(pn,{context:b,modules:y,store:t,disabled:T,collectionStore:l,templatePickerMenuListStore:i,pageLayoutRef:p,collectionContextStore:C,editorContentContainerRef:c})}):(0,Ge.jsx)(mn().Mx,{ref:p,type:I,style:{justifyContent:"center",paddingTop:12,paddingBottom:s?f:void 0},suppressMargin:!s,children:(0,Ge.jsx)(dn().p,{context:b,disabled:T,handlePlaceholderWrapClick:e=>rn().YB(e,t,d),pageBlockStore:t,templatePickerMenuListStore:i,pageViewBlockAccessor:()=>p.current,ref:c})});return(0,Ge.jsx)(Oo().A,{name:"PageView",children:j})})),yn=r.memo(r.forwardRef((function({store:e,collectionViewStore:t,style:n,isFullScreen:i,editorContentContainerRef:l,templatePickerMenuListStore:s,isViewsModule:c},d){const u=(0,_t().ET)(),p=(0,k().K8)((()=>u.collectionStore()),[u]),g=(0,k().K8)((()=>"collectionSystemView"===u.contextTypeFromStoreState),[u]),m=(0,k().K8)((()=>nn({store:e,collectionViewStore:t,collectionContextStore:u})),[e,t,u]),S=!(0,Qt().bx)(m,g);return(0,r.useEffect)((()=>{"rendered"!==a().default.state.renderPhase&&a().default.setPageRendered()}),[]),(0,r.useEffect)((()=>{u.onItemMount(m)}),[u,m]),c?m?(0,Ge.jsx)("div",{style:n,children:(0,Ge.jsx)(hn,{canEdit:!S,disabled:S,store:m,collectionViewStore:t,templatePickerMenuListStore:s,collectionStore:p,isFullScreen:i,editorContentContainerRef:l})}):null:(0,Ge.jsx)(o(314994).c,{disabled:!1,displayName:"CollectionPagePageContent",ref:d,style:n,children:(0,Ge.jsx)(Oo().A,{name:"CollectionPageView",children:m?(0,Ge.jsx)(hn,{canEdit:!S,disabled:S,store:m,collectionViewStore:t,templatePickerMenuListStore:s,collectionStore:p,isFullScreen:i,editorContentContainerRef:l}):null})})})));var vn=()=>o(611648),fn=()=>o(882722),bn=()=>o(969318),xn=()=>o(236030),wn=()=>o(378518),Cn=()=>o(376254),kn=()=>o(466088),In=()=>o(988291);function Tn(e){const{style:t,children:o}=e,n=(0,I().IS)((()=>({scroller:{height:"100%",maxHeight:"inherit",...t}})),[t]);return(0,Ge.jsx)(Cn().H,{type:vn().A.Y,style:n.scroller,children:o})}function jn({store:e,children:t,isFullScreen:n,currentViewType:i,isInPeek:l,isInHomeWidget:a,handleEditorClick:s,isRootOrDirectChild:c,leftRightPaddingStore:d,paddingBottom:u,viewSettingsPlacementStore:p,paddingLeft:g,format:m,isMyTasksEmpty:S,isHomeCustomDbEmpty:h,isInFrameWhenSidePeekOpen:y,handleHorizontalScrollerMount:v,handleEditorMouseDown:f,isUnlistedView:b,isPreviewing:w,isDashboardWidget:C}){const I=(0,_t().ET)(),T=(0,Ue().Zp)(),j=(0,x().v3)(),{isPhone:A}=(0,x().Y0)(),M=(0,In().X)(I),P=(0,k().K8)((()=>(null==I?void 0:I.isInLibraryBlock())??!1),[I]),_=(0,k().K8)((()=>(0,kn().w)(j)),[j]),R=(0,k().K8)((()=>function(e){const{environment:t,isFullScreen:o,isInPeek:n,isPreviewing:r,isUnlistedView:i,isSettingsView:l,collectionViewType:a,isLibraryBlock:s,isDashboardWidget:c}=e;return r&&r.enableHorizontalScroll?vn().A.X:r&&!r.enableHorizontalScroll||"page"===a||"feed"===a||c?vn().A.None:i?vn().A.All:n||l||s?vn().A.X:o&&(0,ce().z)(t)?vn().A.None:vn().A.X}({environment:j,isFullScreen:n,isPreviewing:!!w&&{enableHorizontalScroll:(null==T?void 0:T.enableHorizontalScroll)??!1},isInPeek:l,isUnlistedView:Boolean(b),isSettingsView:"collectionSettings"===I.contextTypeFromStoreState,collectionViewType:i,isLibraryBlock:P,isDashboardWidget:C})),[b,j,n,w,l,I,i,T,P,C]),B=(0,k().K8)((()=>!("collectionSystemView"===I.contextTypeFromStoreState)&&a&&function(e){switch(e){case"table":case"board":case"gallery":case"list":case"timeline":case"chart":case"page":case"form_editor":case"chat":case"dashboard":return!0;case"calendar":case"map":case"feed":case"custom":case"teamspace_directory":case"library_external_pages":return!1;default:return(0,H().HB)(e)}}(i)),[I,a,i]),V=(0,k().K8)((()=>te().B2({blockStore:e,isFullScreen:n,collectionContextStore:I})),[e,n,I]),F=(0,k().K8)((()=>{const t=d.state,o=I.settingsStore.state.open,r=I.isInHomeWidgetStore.state&&I.isEditableHomeCollectionStore.state;let l={};b&&(l=A?{height:_?xn().gK:xn().NH,width:void 0}:{height:xn().PN,width:void 0});const s=I.isDashboardWidget()?function(e){switch(e){case"gallery":return{paddingInlineStart:16,paddingInlineEnd:16,paddingBottom:16};case"board":return{paddingInlineStart:12,paddingInlineEnd:12,paddingTop:6};case"calendar":case"table":case"feed":return{paddingInlineStart:8,paddingInlineEnd:8};case"list":return{paddingInlineStart:8,paddingInlineEnd:8,paddingTop:8,paddingBottom:8};case"form_editor":case"map":case"custom":case"chat":case"teamspace_directory":case"chart":case"dashboard":case"page":case"timeline":case"library_external_pages":return;default:(0,H().HB)(e)}}(i):void 0;return{flexGrow:1,flexShrink:0,...(0,eo().S)(e)&&{cursor:"default"},..."timeline"===i&&I.collectionStore()&&!n&&!(0,wn().Od)({environment:j,format:m,isFullScreen:n,isRootChild:c})&&t&&{marginInlineStart:t.paddingLeft,marginInlineEnd:t.paddingRight,marginBottom:u},...o&&!n&&"sidebar"===p.state&&{minHeight:bn().iZ},...r?{paddingInlineEnd:8,paddingInlineStart:"list"===i?8:16}:{},...a&&!B?{maxHeight:"inherit"}:{},...S||h||!B?{height:"100%"}:{},...!y||"timeline"===i||a||b||M?{}:{position:"sticky",insetInlineStart:0,paddingInlineStart:g,width:(0,no().Uh)(j)},..."chart"===i&&y&&!a?{paddingInlineStart:g}:{},..."page"===i?{zIndex:86}:{},...V&&{marginInlineStart:-xn().Fh},...l,..."custom"===i&&{height:"100%"},...s}}),[d,I,c,e,i,n,j,m,u,p,a,B,S,h,y,g,V,b,A,_,M]),E=(0,Sn().a)(),O=(0,k().K8)((()=>E&&"page"===i?vn().A.All:l||a?vn().A.None:(0,o(539801).u)()),[l,a,E,i]),D=(0,r.useCallback)((e=>{s(e,i)}),[s,i]),z=(0,Ge.jsx)(Cn().H,{type:R,className:fn().ohG,preventType:O,onClick:D,style:F,ref:v,children:t});return B?(0,Ge.jsx)(Tn,{style:{..."list"===i?{paddingBottom:8}:"timeline"===i?{paddingBottom:0}:{paddingBottom:16},...a&&"feed"!==i?{paddingTop:12}:{}},children:z}):z}const An=new(T().O2)("ExternalPagesDirectoryView",(()=>o.e(51143).then(o.bind(o,149565)))),Mn=(0,T()._h)(An,(e=>e.ExternalPagesDirectoryView));var Pn=()=>o(543886),_n=()=>o(405170),Rn=()=>o(956675),Bn=()=>o(24374),Vn=()=>o(62371),Fn=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),()=>o(821062)),En=()=>o(568891),On=()=>o(406094),Dn=()=>o(493552),zn=()=>o(8741),Ln=()=>o(112412),Kn=()=>o(340498);const Wn={viewBox:"0 0 16 16",fittedViewBox:"2.56 2.22 10.88 11.55",svg:(0,Ge.jsx)("path",{d:"M3.14 2.225a.575.575 0 1 0 0 1.15h9.72a.575.575 0 1 0 0-1.15zm.36 2.027a.935.935 0 0 0-.935.935v1.44c0 .516.419.935.935.935h1.44a.935.935 0 0 0 .935-.935v-1.44a.935.935 0 0 0-.935-.935zm.215 2.16v-1.01h1.01v1.01zm3.565-2.16a.935.935 0 0 0-.935.935v1.44c0 .516.419.935.935.935h1.44a.935.935 0 0 0 .935-.935v-1.44a.935.935 0 0 0-.935-.935zm.215 2.16v-1.01h1.01v1.01zm3.565-2.16a.935.935 0 0 0-.935.935v1.44c0 .516.419.935.935.935h1.44a.935.935 0 0 0 .935-.935v-1.44a.935.935 0 0 0-.935-.935zm.215 2.16v-1.01h1.01v1.01zM3.14 8.438a.575.575 0 1 0 0 1.15h9.72a.575.575 0 1 0 0-1.15zm.36 2.027a.935.935 0 0 0-.935.935v1.44c0 .516.419.935.935.935h1.44a.935.935 0 0 0 .935-.935V11.4a.935.935 0 0 0-.935-.935zm.215 2.16v-1.01h1.01v1.01zm3.565-2.16a.935.935 0 0 0-.935.935v1.44c0 .516.419.935.935.935h1.44a.935.935 0 0 0 .935-.935V11.4a.935.935 0 0 0-.935-.935zm.215 2.16v-1.01h1.01v1.01zm3.565-2.16a.935.935 0 0 0-.935.935v1.44c0 .516.419.935.935.935h1.44a.935.935 0 0 0 .935-.935V11.4a.935.935 0 0 0-.935-.935zm.215 2.16v-1.01h1.01v1.01z"})},Hn=(0,Kn().wt)("squareGridBelowLinesSmall",Wn,"small");var Nn=()=>o(804666),Gn=()=>o(634292),$n=()=>o(37450),Un=()=>o(90654),qn=()=>o(560819),Xn=()=>o(766854),Yn=(o(944114),o(430670),()=>o(675133)),Qn=()=>o(433337),Zn=()=>o(564787),Jn=()=>o(9559),er=()=>o(898244),tr=()=>o(416504),or=()=>o(519831),nr=()=>o(708830),rr=()=>o(722101),ir=()=>o(44729),lr=()=>o(715142),ar=()=>o(89053),sr=()=>o(842076),cr=()=>o(611947),dr=()=>o(622811),ur=()=>o(267639),pr=()=>o(174254),gr=()=>o(476297),mr=()=>o(636081),Sr=()=>o(180252),hr=()=>o(537551);function yr(e){var t;const{store:o,groupsPointer:n,environment:r,collectionContextStore:i,transaction:l}=e;if(!o.isDefined())return;const a=i.normalizedSchemaStore.state,s=i.relativeVariableStore.state,c=null===(t=i.viewsModuleContextStore.currentPageStore())||void 0===t?void 0:t.id,d=new Map,p=new Map,g=new Map;for(const S of n){var m;const e=mr().jV({block:o.getModel(),schema:a,propertyMapping:void 0,userFilterContext:{userId:r.currentUser.id,userTimeZone:(0,tr().P)(),userStartOfWeek:Sr().XX.state},group:S,groupBy:i.getGroupByAndGroupFormats().groupBy,getRecordModel:o.getRecordModel,intl:Yn().A.getIntl(),relativeVariableResult:s,currentPageInRelatedCollection:c,resultCache:d,regExpCache:p,formatDateCache:g,experimentService:u().default,spaceIdCreator:r.idCreator.getSpaceIdCreatorSync(o.getModel().space_id),getRelationEdgeList:(0,sr().Y)({environment:r,spaceId:o.getModel().space_id}),sourceCollectionId:null===(m=i.collectionStore())||void 0===m?void 0:m.id});(0,hr().l)({environment:r,blockStore:o,properties:e,transaction:l})}}var vr=()=>o(482871),fr=()=>o(802634);function br(e){const{groupsPointer:t,collectionContextStore:o,blocks:n,formulasModule:r,environment:i}=e,l=[];return t.forEach((e=>{var t,a;const s=null==o||null===(t=o.collectionStore())||void 0===t?void 0:t.getSchema()[e.property],c=null==o||null===(a=o.collectionStore())||void 0===a?void 0:a.getSchema(),d=new Map,p=new Map,g=new Map,m=n.flatMap((t=>{const o=t.getModel();if(s&&c&&o)return(0,Jn().W)({property:e.property,schema:c,block:o,getRecordModel:t.getRecordModel,collectionRequestContext:{userId:void 0,userTimeZone:(0,tr().P)(),depth:0,intl:Yn().A.getIntl(),visitedProperties:new Set,resultCache:d,regExpCache:p,formatDateCache:g,experimentService:u().default,collectionFeatureGates:(0,ar().i)(),getRelationEdgeList:(0,sr().Y)({environment:i,spaceId:t.getSpaceId()})},exportedFilePaths:!1,formulasModule:r,spaceIdCreator:i.idCreator.getSpaceIdCreatorSync(t.getSpaceId())})})).filter((e=>!W().b0(e)));l.push(...m)})),W().Mp(l,W().n4)}function xr(e){var t,o,n,r;const{environment:i,collectionStore:l,targetStore:s,droppedDirection:c,droppedStores:d,transaction:u,duplicate:p,collectionContextStore:g,groupsPointer:m,subitemPath:S,formulasModule:h,duplicateActions:y}=e;if(null!=l&&l.pathIsDead())return;if(d.some((e=>(0,lr().pQ)(e.id))))return;if(d.some((e=>{const t=e.getDiscussionStores();for(const o of t)if(o.isSuggestionDiscussion())return!0})))return;if(e.collapsedGroup&&function(e){var t;const{environment:o,droppedStores:n,duplicate:r,collectionContextStore:i,groupsPointer:l,transaction:a,duplicateActions:s}=e,c=i.collectionStore(),d=i.collectionViewStore(),u=null===(t=n[0])||void 0===t?void 0:t.getAssociatedCollectionStore(),p=u&&u.id===(null==c?void 0:c.id),g=i.hasSingleCollection()&&r,m=(0,ur().T)({environment:o,droppedStores:n,duplicate:g,transaction:a,collectionStore:c,duplicateActions:s});for(const S of m){const e=c??S.getAssociatedCollectionStore();e&&(0,dr().j)({environment:o,store:S,collectionStore:e,collectionContextStore:i,groupsPointer:l,shouldCoerce:!0,transaction:a})}d&&(0,vr().z)({resultIds:m.map((e=>e.id)),collectionViewStore:d,collectionContextStore:i,transaction:a}),a.postSubmitCallbacks.push((async e=>{!e&&c&&(p||await Mt().Bz({droppedStores:n,createdStores:m,collectionStore:c,environment:o,collectionContextStore:i,groupsPointer:l,shouldDuplicate:r}))}))}({environment:i,collectionContextStore:g,groupsPointer:m,droppedStores:d,duplicate:p,transaction:u,duplicateActions:y}),!s)return;const v=g.collectionViewStore();if(!v)return;const f=null===(t=d[0])||void 0===t?void 0:t.getAssociatedCollectionStore(),b=f&&f.id===(null==l?void 0:l.id),x=null===(o=g.groupsStore.getGroupState(m))||void 0===o?void 0:o.groupUiParentStore;if(!x)return;const w=br({groupsPointer:m,collectionContextStore:g,blocks:d,formulasModule:h,environment:i}),C=(null===(n=g.groupsStore.getGroupState(m))||void 0===n?void 0:n.resultsStore.state)||[],k=d.every((e=>e.isExternalObjectInstancePageBlockStore()))&&!(null!=l&&l.isSyncedCollection()&&(null===(r=d[0])||void 0===r?void 0:r.getParentId())===(null==l?void 0:l.id)),I=g.hasSingleCollection()&&(k||p);if(c===En().bH.Onto){(0,Ye().I)({environment:i});const e=s.getContentStore(),t=(0,ur().T)({environment:i,droppedStores:d,duplicate:I,transaction:u,collectionStore:l,duplicateActions:y});for(const o of t)rr().BC({parentStore:e,appendStore:o,transaction:u});return[]}let T=!1,j=[];if(!I&&l){const e=function(e){const{environment:t,droppedStores:o,collectionStore:n,transaction:r}=e;if(!o.length)return;const i=(0,fr().K)({environment:t,stores:o,spaceId:n.getSpaceId(),transaction:r});for(const l of i){if(l.getParentTable()===or().Vl||l.getAssociatedCollectionStore())return;if(!ir().X$({childStore:l,parentStore:n,transaction:r}))return}return i}({environment:i,droppedStores:d,collectionStore:l,transaction:u});T=void 0!==e,j=e??[]}const A=(0,Pt().kY)([...(null==S?void 0:S.map((e=>e.value.store.pointer)))??[]]),M=g.subitemExpandedStore.state.get(A),P=S&&S.length>1||(null==M?void 0:M.isExpanded)&&c===En().bH.Below,_=g.groupsStore.getAllGroupStates();d.forEach((e=>{const t=_.find((t=>t.resultsStore.state.includes(e)));t&&!P&&yr({environment:i,store:e,collectionContextStore:g,groupsPointer:t.groupsPointer,transaction:u})}));const R=(0,ur().T)({environment:i,droppedStores:d,duplicate:I,transaction:u,collectionStore:l,duplicateActions:y});T||(j=(0,fr().K)({environment:i,stores:R,spaceId:s.getSpaceId(),transaction:u})),u.postSubmitCallbacks.push((async e=>{!e&&l&&(b||await Mt().Bz({droppedStores:d,createdStores:R,collectionStore:l,environment:i,collectionContextStore:g,groupsPointer:m,alreadyMovedToCollection:T,shouldDuplicate:I}))}));for(const a of j){const e=l??a.getAssociatedCollectionStore();e&&(0,dr().j)({environment:i,store:a,collectionStore:e,collectionContextStore:g,groupsPointer:Boolean(P)?[]:m,shouldCoerce:!0,transaction:u,alreadyMovedToCollection:T})}l&&function(e){var t,o,n;const{environment:r,isInsertingAsSubitem:i,shouldDuplicate:l,collectionContextStore:a,collectionStore:s,droppedStores:c,wrappedStores:d,targetSubitemExpandedState:u,subitemPath:p,targetStore:g,transaction:m}=e,S=a.currentSubitemFormatStoreForCollectionStore.state,h=null==S?void 0:S.inverse,y=h&&a.normalizedSchemaStore.state[h],v=null==S?void 0:S.property,f=v&&a.normalizedSchemaStore.state[v],b=null===(t=a.collectionViewStore())||void 0===t?void 0:t.getType(),x=null===(o=a.collectionViewStore())||void 0===o?void 0:o.getFormat();if(null!==(n=a.collectionViewStore())&&void 0!==n&&null!==(n=n.getCollectionStore())&&void 0!==n&&n.isExternallyImportedAndSyncedCollection())return;const w=(null==x?void 0:x.subitem_display_mode)??"show",C=S&&b&&(0,Zn().qS)(b)&&y&&(0,er().nC)(y)&&"flattened"!==w&&"disabled"!==w,k=(0,Pt().oC)(c[0]);null!=k&&k.subitemFormat&&S&&f&&(0,er().nC)(f)&&Mt().Ch({blocksToDuplicate:[...c],duplicatedBlocks:[...d],environment:r,shouldDuplicate:l,originSubitemFormat:k.subitemFormat,destinationSubitemFormat:S,transaction:m,subitemRelationSchema:f,relationPropertyCollectionId:s.id});const I=S?(0,Pt().Ku)(d,S):void 0,T=I?d.filter(((e,t)=>I.includes(t))):[];for(const j of T){if(C){const e=(0,Pt().eO)({store:j,subitemFormat:S,propertySchema:y});for(const t of e){const e=ae().B.createChildStore(j,t);At().c3({environment:r,sourceStore:e,destStore:j,propertyWithInverse:S,transaction:m})}}if(i){const e=null!=u&&u.isExpanded?"into":"below";(0,pr().i)({environment:r,collectionContextStore:a,collectionStore:s,subitemPath:p&&(null==p?void 0:p.length)>0?p:[new(nr().PH)((0,Pt().f5)(g),[])],store:g,before:"into"===e,insertBlockStore:j,insertDirection:e,transaction:m})}}}({environment:i,isInsertingAsSubitem:Boolean(P),shouldDuplicate:I,collectionContextStore:g,collectionStore:l,droppedStores:d,wrappedStores:j,targetSubitemExpandedState:M,subitemPath:S,targetStore:s,transaction:u});const B=C.filter((e=>!R.includes(e))),V=B.indexOf(s),F=c===En().bH.Above||c===En().bH.Left?V:V+1,E=[...B.slice(0,F),...j,...B.slice(F)];(0,vr().z)({resultIds:E.map((e=>e.id)),collectionViewStore:v,collectionContextStore:g,transaction:u});const O=br({groupsPointer:m,collectionContextStore:g,blocks:R,formulasModule:h,environment:i}),D=W().n4(w.sort(),O.sort());(b||D)&&(0,gr().f)({environment:i,collectionContextStore:g});if(!g.collectionViewBlockStore())return;const z=P?s:x,L=j.map((e=>ae().B.createChildStore(z,{table:ht().ev,id:e.id})));return(0,Ft().t)({environment:i,stores:L}),function(e,t){var o,n;(null===(o=e.collectionViewStore())||void 0===o?void 0:o.getFormat().app_config_uri)===Qn().Lu&&"sprint_board"===(null===(n=a().default.state.mainEditorCurrentBlockStore)||void 0===n?void 0:n.getFormat().special_page_for_pm_launch)&&cr().tutorialAdvanceToStepAfter(t,"sprints-onboarding","sprint-task-tooltip")}(g,u),L}var wr=()=>o(157071),Cr=()=>o(357643),kr=()=>o(319357),Ir=()=>o(755531),Tr=()=>o(274570),jr=()=>o(90907),Ar=()=>o(835607),Mr=()=>o(877788),Pr=()=>o(42583),_r=()=>o(439549),Rr=()=>o(76726);const Br=(0,Le().YK)({recentsTitle:{id:"library.zeroState.recents.title",defaultMessage:"Your recently visited pages will appear here"},recentsDescription:{id:"library.zeroState.recents.description",defaultMessage:"Pages you visit will show up here so you can easily get back to them"},favoritesTitle:{id:"library.zeroState.favorites.title",defaultMessage:"Your favorite pages will appear here"},favoritesDescription:{id:"library.zeroState.favorites.description",defaultMessage:"Add pages to your favorites for quick access from anywhere in your workspace"},sharedTitle:{id:"library.zeroState.shared.title",defaultMessage:"Your shared pages will appear here"},sharedDescription:{id:"library.zeroState.shared.description",defaultMessage:"Pages shared with you by others in your workspace will show up here"},privateTitle:{id:"library.zeroState.private.title",defaultMessage:"Your private pages will appear here"},privateDescription:{id:"library.zeroState.private.description",defaultMessage:"Private pages in Notion are pages only you can access until you explicitly share them"},meetingsTitle:{id:"library.zeroState.meetings.title",defaultMessage:"Your meeting notes will appear here"},meetingsDescription:{id:"library.zeroState.meetings.description",defaultMessage:"Meeting notes captured by Notion will show up here automatically"},createNewPage:{id:"library.zeroState.createNewPage",defaultMessage:"Create new page"}});function Vr({viewName:e}){const t=(0,x().v3)(),{spaceStore:o,spaceViewStore:n}=(0,k().K8)((()=>({spaceStore:(0,Ir().S)(),spaceViewStore:a().default.state.sidebarSpaceViewStore})),[]),r=(0,I().IS)((()=>({container:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",gap:12,paddingTop:"20vh",paddingBottom:50,paddingInline:20},icon:{width:32,height:32,color:K().Tj.icon.secondary},body:{display:"flex",flexDirection:"column",alignItems:"center",textAlign:"center",gap:2,maxWidth:340},ctaContainer:{paddingTop:8}})),[]),{icon:i,title:l,description:s,showCta:c}=function(e){switch(e){case"recents":return{icon:Tr().clockIcon,title:Br.recentsTitle,description:Br.recentsDescription,showCta:!1};case"favorites":return{icon:Mr().w,title:Br.favoritesTitle,description:Br.favoritesDescription,showCta:!1};case"shared":return{icon:Ar().F,title:Br.sharedTitle,description:Br.sharedDescription,showCta:!1};case"private":return{icon:jr().lockIcon,title:Br.privateTitle,description:Br.privateDescription,showCta:!0};case"myMeetings":return{icon:Pr().D,title:Br.meetingsTitle,description:Br.meetingsDescription,showCta:!1};default:(0,H().HB)(e)}}(e);return(0,Ge.jsxs)("div",{style:r.container,children:[(0,Ge.jsx)(ke().I,{icon:i,size:"default",style:r.icon}),(0,Ge.jsxs)("div",{style:r.body,children:[(0,Ge.jsx)(Dn().D,{styleKey:"bodyMedium",colorVariant:"secondary",children:(0,Ge.jsx)(Le().sA,{...l})}),(0,Ge.jsx)(Dn().D,{styleKey:"bodyRegular",colorVariant:"secondary",children:(0,Ge.jsx)(Le().sA,{...s})})]}),c&&o&&n?(0,Ge.jsx)("div",{style:r.ctaContainer,children:(0,Ge.jsx)(On().A,{onClick:()=>{o&&n&&(_r().SE({environment:t,spaceStore:o,spaceViewStore:n,type:"private",prepend:!0,outlinerItemFrom:"library"}),(0,Rr().t6)({environment:t}))},colorPalette:"gray",children:(0,Ge.jsx)(Le().sA,{...Br.createNewPage})})}):void 0]})}var Fr=()=>o(631524),Er=()=>o(160432),Or=()=>o(120282),Dr=()=>o(854513);const zr=(0,Le().YK)({description:{id:"meetings.emptyState.description",defaultMessage:"Find all your AI Meeting Notes, including ones linked to meetings you attended, organized here for easy follow-up."},newMeeting:{id:"meetings.emptyState.newMeeting",defaultMessage:"+ New AI meeting note"},newMeetingNoPlus:{id:"meetings.emptyState.newMeetingNoPlus",defaultMessage:"New AI meeting note"}});function Lr(){const e=(0,x().v3)(),t=(0,T().fJ)(Dr().$),o=(0,k().K8)((()=>"v1"===u().default.getEligibleGroup({experimentId:"ai_meeting_notes_meetings_tab_primary_button"})),[]),n=(0,r.useCallback)((()=>{if("resolved"!==t.status)return;const{createAndNavigateToTranscriptionBlock:o}=t.value;o({environment:e,from:"meetings_empty_state",title:"none"})}),[e,t]),i=(0,I().IS)((()=>({container:{display:"flex",flexDirection:"column",alignItems:"center",alignSelf:"center",textAlign:"center",padding:50,gap:16,maxWidth:500},titleContainer:{display:"flex",flexDirection:"column",alignItems:"center",gap:8},icon:{width:32,height:32,color:K().Tj.icon.tertiary},buttonStyle:{color:K().Tj.blue.text.accentPrimary}})),[]);return(0,Ge.jsxs)("div",{style:i.container,children:[(0,Ge.jsx)(ke().I,{icon:Or().a,size:"default",style:i.icon,colorVariant:"tertiary"}),(0,Ge.jsxs)("div",{style:i.titleContainer,children:[(0,Ge.jsx)(Dn().D,{styleKey:"bodyRegular",colorVariant:"tertiary",children:(0,Ge.jsx)(Le().sA,{...zr.description})}),o?(0,Ge.jsx)(Er().A,{size:"md",onClick:n,colorPalette:"blue",children:(0,Ge.jsx)(Le().sA,{...zr.newMeetingNoPlus})}):(0,Ge.jsx)(Fr().p,{style:i.buttonStyle,onClick:n,children:(0,Ge.jsx)(Le().sA,{...zr.newMeeting})})]})]})}var Kr=()=>o(893665);const Wr=(0,Le().YK)({noResults:{id:"collectionView.emptyState.noResults",defaultMessage:"No results"},noResultsTooltip:{id:"collectionView.emptyState.noResultsTooltip",defaultMessage:"There is nothing to show in this view, and you do not have permission to create new items."},editGroups:{id:"collectionView.emptyState.editGroups",defaultMessage:"Edit groups"},clearSearch:{id:"collectionView.emptyState.clearSearch",defaultMessage:"Clear search"},editFilters:{id:"collectionView.emptyState.editFilter",defaultMessage:"Edit filters"}});const Hr=r.memo((function(e){const{collectionContextStore:t,paddingLeft:n,paddingRight:i,groupByKeyToOpen:l,headerWidth:a,groupsPointer:c}=e,d=(0,x().v3)(),p=(0,Le().tz)(),{isPhone:m}=(0,x().Y0)(),{value:S}=(0,T().fJ)(Vt().VI.duplicateActions),h=(0,k().O$)(t.isFullScreenStore),y=(0,k().O$)(t.searchQueryStore),v=(0,k().O$)(t.viewsModuleContextStore),f=(0,k().K8)((()=>t.collectionViewStore()),[t]),b=(0,k().K8)((()=>t.getViewType()??"table"),[t]),w=(0,k().K8)((()=>t.collectionViewBlockStore()),[t]),C=(0,k().K8)((()=>t.collectionStore()),[t]),j=(0,In().X)(t),A=(0,k().K8)((()=>{var e;const o=t.collectionViewStore(),n=null==o||null===(e=o.getCollectionSource())||void 0===e?void 0:e.type;if((0,Nn().a0)(n)&&"teamspaceDirectory"!==n&&"libraryExternalPages"!==n)return n}),[t]),M=(0,o(739375).yv)({disableExposureLogging:!0});(0,r.useEffect)((()=>{j&&M&&u().default.checkGate({gateName:"ai_meeting_notes_demo_available"})}),[j,M]);const P=(0,k().K8)((()=>(0,qn().N)({collectionContextStore:t}).length>0),[t]),_=(0,k().K8)((()=>{const e=t.permissionScopesStore.state,o=e.isExternallyImportedAndSyncedCollection;return(0,co().E)(d,(0,s().f)(t.collectionStore()))&&e.canCreatePagesInCollection&&!o}),[d,t]),R=(0,k().K8)((()=>t.permissionScopesStore.state.canConfigureCollection),[t.permissionScopesStore]),B=r.useCallback((async e=>{const o=await $t().T.formulas.load();et().createAndCommit({userAction:"CollectionViewEmptyState.handleDrop",environment:d,canUndo:!0,perform:n=>{if(!C||!w)return;const r=(0,Vn().H2)(t.normalizedFormatStore.state,"board"===b?"board_columns_by":"collection_group_by","board"===b?"board_columns":"collection_groups");let i;if(r){const e=t.normalizedSchemaStore.state[r.property];if(e&&(0,Vn().Eg)(e)){const t=(0,Vn().ro)(e);t&&(i={property:r.property,value:t})}}xr({environment:d,collectionContextStore:t,collectionStore:C,targetStore:w,droppedDirection:En().bH.Above,groupsPointer:c??(i?[i]:[]),droppedStores:e.droppedStores,duplicate:e.duplicate,collapsedGroup:!1,formulasModule:o,transaction:n,duplicateActions:S})}})}),[d,t,w,C,b,c,S]),V=(0,r.useMemo)((()=>{if(f){if(""!==y)return{title:p.formatMessage(Wr.clearSearch),onClick:()=>{t.searchQueryStore.setState("")},iconLeading:void 0};if(P)return{title:p.formatMessage(Wr.editFilters),onClick:()=>{m?Q().R8({collectionSettingsStore:t.settingsStore,item:{type:"phoneFilterAndSort"}}):Boolean(v)?t.filtersBarOpenStore.state?t.filterBarFlashTriggerStore.update((e=>e+1)):t.filtersBarOpenStore.setState(!0):Q().R8({collectionSettingsStore:t.settingsStore,item:{type:"filters"}})},iconLeading:Ln().filterSmallIcon};if(R){const e=l??"collection_group_by";return{title:p.formatMessage(Wr.editGroups),onClick:()=>{Q().R8({collectionSettingsStore:t.settingsStore,item:{type:"group",groupByKey:e,groupsFormatKey:"board"===b||"gallery"===b?Vn().Hw[e]:Vn().V1}})},iconLeading:Hn}}}}),[f,P,p,t.settingsStore,t.filtersBarOpenStore,t.filterBarFlashTriggerStore,t.searchQueryStore,m,l,y,b,R,v]),F=(0,I().IS)((()=>{const e=function(e){const{isFullScreen:t,isMobile:o,isInViewsModule:n,groupsPointer:r}=e;return r&&r.length>0?72:t||o||n?144:72}({isFullScreen:h,isMobile:g().A.isMobile,isInViewsModule:Boolean(v),groupsPointer:c});return{container:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",flexWrap:"wrap",alignContent:"center",gap:g().A.isMobile?16:12,..."timeline"===b?{position:"relative",width:"100%",height:c?e:"100%"}:{position:"sticky",insetInlineStart:n,height:e,width:a-n-i,marginInlineStart:"gallery"===b?void 0:`-${n}px`,marginInlineEnd:"gallery"===b?void 0:`-${i}px`}},libraryZeroStateContainer:{display:"flex",justifyContent:"center",width:"100%"},noResultsContainer:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",gap:4}}}),[h,v,b,c,n,a,i]);if(!w)return null;if(j&&M)return(0,Ge.jsx)(Lr,{});if(void 0!==A&&""===y&&!P)return(0,Ge.jsx)("div",{style:F.libraryZeroStateContainer,children:(0,Ge.jsx)(Vr,{viewName:A})});const E=c&&1===c.length?`collection_view_empty_state_${w.id}_${(0,Vn().Ix)(c.at(0))}`:`collection_view_empty_state_${w.id}`;return(0,Ge.jsx)(o(151838).A,{store:w,droppable:_,render:()=>(0,Ge.jsxs)(o(853994).Tl,{dropTargetKey:E,style:F.container,canNativeDropOnto:!1,keepTextSelectionOnDrop:!0,shouldShowDropZone:_,canAcceptDrop:()=>_,canDropOnto:_,onSelectableDrop:B,className:fn()._XL,children:[void 0!==V?(0,Ge.jsx)(Nr,{...V}):void 0,_?(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)(Gr,{collectionContextStore:t,groupsPointer:c,viewType:b}),(0,Ge.jsx)($r,{collectionContextStore:t})]}):void 0,_||void 0!==V?void 0:(0,Ge.jsx)(Wo().m,{placement:"top",render:e=>(0,Ge.jsx)(Dn().D,{styleKey:"bodyRegular",colorVariant:"tertiary",colorPalette:"gray",children:(0,Ge.jsxs)("div",{...e,style:F.noResultsContainer,children:[(0,Ge.jsx)(Le().sA,{...Wr.noResults}),(0,Ge.jsx)(ke().I,{icon:o(406533).questionMarkCircleIcon})]})}),renderTooltip:()=>(0,Ge.jsx)(Le().sA,{...Wr.noResultsTooltip})})]})})}));function Nr(e){const{title:t,onClick:o,iconLeading:n}=e,r=(0,I().IS)((()=>({plainButton:{fontSize:g().A.isMobile?17:14}})),[]);return(0,Ge.jsx)(On().A,{onClick:o,colorPalette:"gray",style:r.plainButton,size:g().A.isMobile?"xl":void 0,iconLeading:n?{icon:n,size:"sm"}:void 0,children:t})}function Gr(e){const{collectionContextStore:t,viewType:n,groupsPointer:i}=e,l=(0,x().v3)(),a=(0,k().O$)(t.isFullScreenStore),s=(0,k().O$)(t.viewsModuleContextStore),c=(0,k().O$)(t.isInPeekRendererStore),d=(0,k().K8)((()=>{var e;return null===(e=t.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[t]),u=(0,r.useCallback)((()=>{let e=t.collectionViewBlockStore(),r=t;if(null!=s&&s.collectionViewBlockStore){e=s.collectionViewBlockStore;const t=(0,o(799832).U)(e);t&&(r=t)}e&&(t.searchQueryStore.state&&(0,Cr().S)({searchQuery:"",collectionContextStore:t,isFullScreen:a}),et().createAndCommit({userAction:"CollectionViewEmptyState.handleAddPage",environment:l,canUndo:!0,perform:a=>{let s;const d=t.isMultiSourceViewFromStoreState?"center_peek":(0,ne().hH)(t);if("table"!==n&&"list"!==n&&"timeline"!==n)s=(0,o(248662).T)({transaction:a,store:e,collectionContextStore:r,environment:l,shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,from:{createBlock:"collection_view_empty_state"},showMoveTo:!1,peekModeOverride:d}),s&&$n().vH(l,{from:"collection_view_empty_state",type:"page",new_page_id:s.id,creating_block_id:e.id,...(0,Lt().sl)(t)});else{const e=(0,Xn().Q)({environment:l,collectionContextStore:t,groupsPointer:i??[],shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:a,from:{createBlock:"collection_view_empty_state"},inMemoryRecordCache:l.defaultRecordCache.inMemoryRecordCache});if(!e)return;if(s=e.newStore,e.coercionSucceeded){const e=()=>{s&&("table"===n||"timeline"===n?Un().ho({isNewBlock:!0,environment:l,blockPropertyValueOverlayStore:c?_n().A:Pn().A,store:s,property:"title",surface:"table",collectionContextStore:t}):"list"===n?(0,wr().v7)({environment:l,newStore:s,previousStore:void 0}):(0,H().HB)(n))};t.registerCallbackForItemMounted(s,e)}else(0,Kr().V)({environment:l,store:s,peekMode:d,collectionContextStore:t,pageVisitSource:de().y8.Create,resultsStore:void 0})}}}))}),[t,s,l,a,n,i,c]),p=(0,I().IS)((()=>({plainButton:{fontSize:g().A.isMobile?17:14}})),[]),m=g().A.isMobile?"xl":void 0;return(0,Ge.jsx)(On().A,{onClick:u,colorPalette:"gray",iconLeading:{icon:Ho().plusSmallIcon,size:"sm"},style:p.plainButton,size:m,children:(0,Ge.jsx)(Le().sA,{defaultMessage:"New {itemType}",id:"collectionView.emptyState.addNewPage",values:{itemType:(0,Gn().$O)(d)}})})}function $r(e){const{collectionContextStore:t}=e,o=(0,x().v3)(),n=(0,Le().tz)(),r=(0,k().K8)((()=>(0,ne().fG)({collectionContextStore:t,environment:o,intl:n})),[t,o,n]),i=(0,I().IS)((()=>({plainButton:{fontSize:g().A.isMobile?17:14}})),[]);if(!r)return null;const l=g().A.isMobile?"xl":void 0;return(0,Ge.jsx)(kr().O,{collectionContextStore:t,groupFormat:void 0,onAddOrLink:void 0,renderLinkButton:e=>(0,Ge.jsx)(On().A,{...e,colorPalette:"gray",iconLeading:{icon:zn().arrowDiagonalUpRightSmallIcon,size:"sm"},style:i.plainButton,size:l,children:(0,Ge.jsx)(Le().sA,{defaultMessage:"Link existing",id:"collectionView.emptyState.linkExisting"})})})}class Ur extends P().Store{getInitialState(){}}const qr=Ur;var Xr=()=>o(101981),Yr=()=>o(571628),Qr=()=>o(396671);const Zr=(0,Le().YK)({description:{id:"meetings.limitedState.description",defaultMessage:"Use AI Meeting Notes to capture your next meeting, interview, or brainstorm — automatically."},newMeeting:{id:"meetings.limitedState.newMeeting",defaultMessage:"New AI Meeting Note"}});function Jr(){const e=(0,x().v3)(),t=(0,T().fJ)(Dr().$),o=(0,r.useCallback)((()=>{if("resolved"!==t.status)return;const{createAndNavigateToTranscriptionBlock:o}=t.value;o({environment:e,from:"meetings_limited_state",title:"none"})}),[e,t]),n=(0,I().IS)((()=>({outerContainer:{borderBottom:`1px solid ${K().Tj.border.secondary}`,marginBottom:16},container:{display:"flex",flexDirection:"column",alignItems:"center",alignSelf:"center",textAlign:"center",padding:40,gap:16,maxWidth:500,marginInlineStart:"auto",marginInlineEnd:"auto"},titleContainer:{display:"flex",flexDirection:"column",alignItems:"center",textWrap:"balance",gap:16},icon:{width:32,height:32,color:K().Tj.icon.tertiary}})),[]);return(0,Ge.jsx)("div",{style:n.outerContainer,children:(0,Ge.jsxs)("div",{style:n.container,children:[(0,Ge.jsx)(ke().I,{icon:Or().a,size:"default",style:n.icon,colorVariant:"tertiary"}),(0,Ge.jsxs)("div",{style:n.titleContainer,children:[(0,Ge.jsx)(Dn().D,{styleKey:"bodyRegular",colorVariant:"tertiary",children:(0,Ge.jsx)(Le().sA,{...Zr.description})}),(0,Ge.jsx)(Er().A,{size:"md",colorPalette:"blue",onClick:o,children:(0,Ge.jsx)(Le().sA,{...Zr.newMeeting})})]})]})})}var ei=()=>o(792057),ti=()=>o(732810),oi=()=>o(700500),ni=()=>o(34026),ri=()=>o(649813),ii=()=>o(797535),li=()=>o(800002);const ai=(0,Le().YK)({optionAlreadyExists:{id:"handleCollectionAddGroupButtonAccept.optionAlreadyExists",defaultMessage:"Option already exists"}});async function si(e){const{update:t,collectionContextStore:o,groupsFormatKey:n,collectionStore:r,environment:i,schema:l,groupBy:a}=e,s=l[a.property];if(!s)return;const c="relation"===s.type&&(0,er().zO)(s),d=c&&new(ti().m)(i,{table:or().Vl,id:c});d&&await d.load(),et().createAndCommit({userAction:"collectionGroupActions.handleCollectionAddGroupButtonAccept",environment:i,canUndo:!0,perform:e=>{if(t.newGroups){if(t.newGroup){const e=t.newGroup;if((0,er().DQ)(s)){var l;const t="select"===e.value.type||"multi_select"===e.value.type?e.value.value:"status"===e.value.type&&"by_option"===(null===(l=e.value.value)||void 0===l?void 0:l.type)?e.value.value.option:void 0;if(t){var a;if(null===(a=s.options)||void 0===a?void 0:a.find((e=>e.value.toLowerCase()===t.toLowerCase())))return void ei().f1(Yn().A.formatMessage(ai.optionAlreadyExists))}}}(0,li().o)({collectionContextStore:o,newGroups:t.newGroups,groupsFormatKey:n,transaction:e}),ni().RZ({transaction:e,newGroups:t.newGroups,collectionContextStore:o,environment:i})}if(t.newSchema&&(0,ii().I)({environment:i,collectionStore:r,update:{schema:t.newSchema},transaction:e}),t.newPage&&"relation"===s.type&&d){const o=(0,L().x9d)(t.newPage.name),n=He().Wv({environment:i,id:t.newPage.id,type:oi().xd.page,spaceId:t.newPage.spaceId,properties:{title:o},inMemoryRecordCache:r.inMemoryRecordCache,transaction:e});ir().X$({parentStore:d,childStore:n,transaction:e});const l=d.getDefaultTemplatePageStore();l&&ri().TB({title:{text:o},environment:i,store:ae().B.createChildStore(d,n.pointer),templateStore:l,isKeyboard:!1,isCreateIn:!1,transaction:e,from:"collection_group_actions"})}}})}var ci=()=>o(934201);function di(e){const{isMobile:t,collectionContextStore:o,groupBy:n,subGroupBy:r}=e,i=o.groupsStore,l=(0,ne().CG)({collectionContextStore:o,isMobile:t}),a=i.getAllGroupStates(),s=r?"intersection":"independent",c=o.getViewType(),d=o.normalizedFormatStore.state,u="board"===c?null==d?void 0:d.board_cover:"gallery"===c?null==d?void 0:d.gallery_cover:void 0,p={type:s,defaultLimit:l,loadContentCover:Boolean(u&&"page_content"===u.type),groupOverrides:{}};for(const g of a){const e=g.currentLimit.state;if(e===l)continue;const t=g.groupsPointer;if("independent"!==s||1!==t.length){if("intersection"===s&&2===t.length&&r){const o=t.at(1),i=t.at(0);if(!o||o.value.type!==n.type)continue;if(!i||i.value.type!==r.type)continue;const l=(0,Vn().AC)(o.value),a=(0,Vn().AC)(i.value);p.groupOverrides[(0,Vn().A)([a,l])]={limit:e}}}else{const o=t.at(0);if(!o||o.value.type!==n.type)continue;const r=(0,Vn().AC)(o.value);p.groupOverrides[r]={limit:e}}}return p}var ui=()=>o(718827),pi=()=>o(206267),gi=()=>o(968021);const mi=30,Si=4,hi=4,yi=(0,Le().YK)({addGroup:{defaultMessage:"New group",id:"database.boardView.addGroupButtonTitle"}}),vi=r.memo((function({style:e,groupBy:t,groupFormatKey:n,currentGroups:i,schema:l,groupsLimitStore:a,collectionContextStore:s,parentStore:c,onAccept:d,disabled:u}){const p=(0,x().v3)(),m=(0,Le().tz)(),S=l[t.property],h=(0,k().uB)(void 0,V().A),y=(0,I().IS)((()=>({button:{display:"flex",alignItems:"center",marginTop:Si,marginBottom:hi,marginInlineStart:-5,width:"max-content",fontSize:g().A.isMobile?gi().hN:gi().Mi,color:K().Tj.text.tertiary,borderRadius:6,height:mi,paddingInlineStart:6,paddingInlineEnd:8,...e},icon:{marginInlineStart:g().A.isMobile?0:1,marginInlineEnd:7}})),[e]),v=(0,r.useCallback)((e=>{!function({schema:e,groupBy:t,groupFormatKey:o,currentGroups:n,groupsLimitStore:r,collectionContextStore:i,onAccept:l,environment:a,buttonPopupStore:s,update:c}){var d;const{newGroupValue:u}=c,p=e[t.property],g=r.state;if(!p||!(0,Vn().Eg)(p))return;"board"===i.getViewType()?(0,N().X)({environment:a,collectionContextStore:i,action:"board_add_group"}):(0,N().X)({environment:a,collectionContextStore:i,action:"add_group"});s.reset();const m=(null===(d=i.collectionViewStore())||void 0===d?void 0:d.getFormatStore().getKeyStore(o).getValue())??[];if(er().lx(p)){if(p.type!==u.type)return;if(void 0===u.value)return;const o=p.options||[],r={id:pi().JW(),value:u.value,color:(0,er().Zd)(o)},i=[...o,r],a={...p,options:i},s={...e,[t.property]:a},c={property:t.property,value:u,hidden:!1};l({newGroups:(0,ci().DF)({groupByFormat:t,currentGroups:n,formatGroups:m,newGroupFormat:c,groupsLimit:g}),newSchema:s,newGroup:c})}else if("person"===p.type||"relation"===p.type||(0,Vn().Vs)(p.type)){const e={property:t.property,value:u,hidden:!1};l({newGroups:(0,ci().DF)({groupByFormat:t,currentGroups:n,formatGroups:m,newGroupFormat:e,groupsLimit:g}),newPage:c.newPage,newGroup:e})}else(0,Vn()._o)(p.type)||"status"===p.type||"number"===p.type||"created_by"===p.type||"last_edited_by"===p.type||"formula"===p.type||"checkbox"===p.type||"location"===p.type||(0,H().HB)(p.type)}({schema:l,groupBy:t,groupFormatKey:n,currentGroups:i,groupsLimitStore:a,collectionContextStore:s,onAccept:d,environment:p,buttonPopupStore:h,update:e})}),[h,s,i,p,t,n,a,d,l]),f=(0,r.useCallback)((()=>{!function(e){e.reset()}(h)}),[h]),b=(0,r.useCallback)((()=>(0,Ge.jsx)(o(271080).p,{groupFormat:void 0,groupBy:t,currentGroups:i,schema:l,onChange:v,onClose:f,parentStore:c})),[i,t,v,f,c,l]);return S&&(0,Vn().Eg)(S)?(0,Ge.jsx)(Ce().A,{render:b,buttonPopupStore:h,popupType:g().A.isMobile?Ce().z.BottomSheet:Ce().z.Popup,renderOrigin:e=>(0,Ge.jsxs)(ui().Ay,{...e,style:y.button,disabled:u,children:[(0,Ge.jsx)(ke().I,{icon:Ho().plusSmallIcon,colorVariant:"tertiary",size:g().A.isMobile?Kn().Ev.default:Kn().Ev.sm,style:y.icon}),m.formatMessage(yi.addGroup)]})}):null}),Fn().A);var fi=()=>o(824565);function bi(e){const{environment:t,groupFormat:n,collectionContextStore:r}=e,i=r.collectionViewStore();if(!i)return;const l=r.groupsStore.getGroupState(n);if(!l)return;const a=o(763884).K.get({userId:t.currentUser.id,key:(0,o(801742).i)(i.id,n)});let s=a??!0;const c=i.getCollectionSource();c&&(0,Nn().a0)(c.type)&&"recents"===c.type&&(s=function(e,t){return"last_visited_time"!==e.value.type?t??!0:Boolean(e.value.value&&("today"===e.value.value.type||"yesterday"===e.value.value.type))}(n,a)),l.toggleStateStore.setState(s)}var xi=()=>o(588316),wi=()=>o(736986),Ci=()=>o(852302),ki=()=>o(606273),Ii=()=>o(888643),Ti=()=>o(519200),ji=()=>o(116952);function Ai(e){const{environment:t,collectionContextStore:o,groupFormat:n,newGroupFormat:r,groupsFormatKey:i,currentGroups:l,transaction:a}=e,s=o.collectionStore();!(0,Vn().OF)(n.value,r.value)&&s&&(0,ji().a)({environment:t,collectionStore:s,property:n.property,oldValue:n.value,newValue:r.value,preventPublishAppEventsForBlockUpdates:!1,transaction:a});const c=l.map((e=>(0,Vn().OF)(n.value,e.value)?r:e));(0,li().o)({collectionContextStore:o,newGroups:c,groupsFormatKey:i,transaction:a})}function Mi(e){const{newGroupValue:t,groupFormat:o,schema:n,collectionContextStore:r,currentGroups:i,groupsFormatKey:l,collectionStore:a,environment:s}=e,c=n[o.property];if(!c)return;if(!(0,Vn().Eg)(c))return;const d=o.value;if((0,er().lx)(c)){if(d.type!==c.type)return;if(t.type!==c.type)return;if(void 0===t.value)return;const e=c.options||[],n=t.value,u=e.map((e=>e.value===d.value?{...e,value:n}:e)),p={...c,options:u},g={...o,value:{...d,value:n}};et().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:s,canUndo:!0,perform:e=>{Ai({environment:s,collectionContextStore:r,groupFormat:o,newGroupFormat:g,currentGroups:i,transaction:e,groupsFormatKey:l}),(0,ii()._)({environment:s,collectionStore:a,propertyId:o.property,newPropertySchema:p,transaction:e})}})}else if("person"!==c.type)if((0,Vn().Vs)(c.type)){if(d.type!==c.type)return;if(t.type!==c.type)return;if(!t.value||"exact"!==t.value.type)return;const e={...o,value:t};et().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:s,canUndo:!0,perform:t=>{Ai({environment:s,collectionContextStore:r,groupFormat:o,newGroupFormat:e,currentGroups:i,groupsFormatKey:l,transaction:t})}})}else if("status"!==c.type)(0,Vn()._o)(c.type)||"created_by"===c.type||"last_edited_by"===c.type||"number"===c.type||"checkbox"===c.type||"formula"===c.type||"relation"===c.type||"location"===c.type||(0,H().HB)(c.type);else{if("status"!==d.type)return;if("status"!==t.type)return;if(!t.value||!d.value)return;const e=c.options??[];if("by_option"===t.value.type&&"by_option"===d.value.type){const n=t.value.option,u=d.value.option,p=e.map((e=>e.value===u?{...e,value:n}:e)),g=c.defaultOption===u?n:c.defaultOption,m={...c,options:p,defaultOption:g},S={...o,value:t};et().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:s,canUndo:!0,perform:e=>{Ai({environment:s,collectionContextStore:r,groupFormat:o,newGroupFormat:S,currentGroups:i,transaction:e,groupsFormatKey:l}),(0,ii()._)({environment:s,collectionStore:a,propertyId:o.property,newPropertySchema:m,transaction:e})}})}}else{if(d.type!==c.type)return;if(t.type!==c.type)return;const e={...o,value:t};et().createAndCommit({userAction:"collectionGroupActions.handleCollectionGroupValueChange",environment:s,canUndo:!0,perform:t=>{Ai({environment:s,collectionContextStore:r,groupFormat:o,newGroupFormat:e,currentGroups:i,groupsFormatKey:l,transaction:t})}})}}var Pi=()=>o(89849),_i=()=>o(871151),Ri=()=>o(236262),Bi=()=>o(654062),Vi=()=>o(314660),Fi=()=>o(575143),Ei=()=>o(893952),Oi=()=>o(161479);const Di=(0,o(583835).Dv)("deleteGroup");var zi=()=>o(357625);var Li=()=>o(604656);const Ki="color";const Wi=function({parent:e,groupFormat:t,collectionContextStore:o,groupsFormatKey:n,format:i,query:l,currentGroups:a,schema:s}){const c=(0,x().v3)(),d=(0,Le().tz)(),u=(0,k().O$)(j().e),p=(0,k().K8)((()=>W().oE([Gi({environment:c,groupFormat:t,collectionContextStore:o,groupsFormatKey:n,format:i,query:l,currentGroups:a,intl:d,isOnline:u}),Ni(c,s,t,o)])),[c,t,o,n,i,l,a,d,s,u]),m=(0,r.useCallback)((t=>{"string"==typeof t.key&&t.key.includes(Ki)||e.close()}),[e]);let S;return S=g().A.isMobile?{menuType:Te().gu.Modal,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"Action",id:"database.collectionGroupActionMenu.title"}),right:(0,Ge.jsx)(Le().sA,{...xe().W.done}),onClickRight:e.close}:{menuType:Te().gu.Popup},(0,Ge.jsx)(je().A,{...S,children:(0,Ge.jsx)(Me().A,{type:Me().O.Vertical,initialFocus:0,sections:p,onAccept:m})})};async function Hi(e,t,o,n,r,i){const l=t.collectionStore();if(!l)return;const a=n.value;if("relation"===a.type&&(0,Vn().WO)(a.value)){const e=ae().B.createChildStore(l,{id:a.value.id,table:ht().ev});await e.load();const t=e.getAssociatedCollectionStore();await(null==t?void 0:t.load())}et().createAndCommit({userAction:"CollectionGroupActionMenu.handleDelete",environment:e,canUndo:!0,perform:a=>{!function(e){const{environment:t,collectionStore:o,groupsFormatKey:n,property:r,groupFormat:i,currentGroups:l,collectionContextStore:a,transaction:s,intl:c}=e,d=o.getSchema(),p=d[i.property],g=l.filter((e=>!(0,Vn().OF)(i.value,e.value)));(0,li().o)({collectionContextStore:a,newGroups:g,groupsFormatKey:n,transaction:s});const m=i.value;if(p&&(0,er().lx)(p)&&m.type===p.type&&o){const e=(p.options||[]).filter((e=>e.value!==m.value)),n={...p,options:e},r={...d,[i.property]:n};(0,ii().I)({environment:t,collectionStore:o,update:{schema:r},transaction:s})}const S=t.currentUser.id,h=new Map,y=new Map,v=new Map,f=o.pointer.spaceId,b=t.idCreator.getSpaceIdCreatorSync(f??"");o.inMemoryRecordCache.forEachRecord(S,(async({model:e})=>{if(e.table!==ht().ev)return;const n=ae().B.createChildStore(o,e.pointer);if(mr().xw({block:e,groupBy:a.getGroupByAndGroupFormats().groupBy,schema:d,property:r,value:m,intl:c,timeZone:(0,tr().P)(),getRecordModel:o.getRecordModel,resultCache:h,regExpCache:y,formatDateCache:v,experimentService:u().default,collectionFeatureGates:(0,ar().i)(),spaceIdCreator:b,getRelationEdgeList:(0,sr().Y)({environment:t,spaceId:o.getSpaceId()}),sourceCollectionId:o.id}))if(e.parent_id===o.id)ir().by({childStore:n,transaction:s});else{const e=n.getAssociatedCollectionStore();e&&e.id===o.id&&("page"===n.getType()||"collection_view_page"===n.getType()&&!n.isCollectionViewPageWithContent())&&await Tt().Af({environment:t,blocks:[n],shouldCheckSuggestEdit:!0})}})),o.isDefaultRecordCache()&&s.postSubmitCallbacks.push((async e=>{const n=await zi().UT(t,Di,{collection:{id:o.id,spaceId:(0,Oi().e)(o.pointer.spaceId)},property:r,value:m},{spaceIds:[]}).next();if(n.value.error)throw n.value.error}))}({environment:e,collectionStore:l,property:n.property,groupFormat:n,currentGroups:o,groupsFormatKey:r,collectionContextStore:t,transaction:a,intl:i})}}),(0,N().X)({environment:e,collectionContextStore:t,action:"delete_group"})}function Ni(e,t,o,n){const r=o.value;if(void 0===r.value)return;const i=t[o.property];if(!i)return;if("select"!==i.type&&"multi_select"!==i.type)return;if(r.type!==i.type)return;const l=(i.options||[]).find((e=>e.value===r.value));if(!l)return;const a=K().tS.map((r=>{const i={key:`${Ki}_${r}`,render:e=>(0,Ge.jsx)(Ei().A,{...e,color:r,isChecked:l.color===r}),action:()=>{!function(e,t,o,n,r){const i=n[o.property];if(!i)return;if(!er().lx(i))return;const l=r.collectionStore();if(!l)return;const a=o.value;if(a.type!==i.type)return;const s=(i.options||[]).map((t=>t.value===a.value?{...t,color:e}:t)),c={...i,options:s},d={...n,[o.property]:c};et().createAndCommit({userAction:"CollectionGroupActionMenu.handleSelectPropertyColorPickerChange",environment:t,canUndo:!0,perform:e=>{(0,ii().I)({environment:t,collectionStore:l,update:{schema:d},transaction:e})}}),(0,N().X)({environment:t,collectionContextStore:r,action:"group_change_color"})}(r,e,o,t,n)}};return i}));return{key:"collection color section",render:e=>(0,Ge.jsx)(Pe().A,{...e,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"Colors",id:"database.collectionGroupActionMenu.colorSectionTitle"}),topBorder:!0}),items:a}}function Gi(e){var t;const{environment:o,groupFormat:n,collectionContextStore:r,groupsFormatKey:i,format:l,query:a,currentGroups:s,intl:c,isOnline:d}=e,u=[],p=n.value,g=r.permissionScopesStore.state,m="board_columns"===i?void 0===a.aggregations:void 0===l.collection_group_aggregation;d&&u.push({key:"editGroups",render:e=>(0,Ge.jsx)(Fi().A,{...e,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"Edit groups",id:"database.collectionGroupActionMenu.editGroupsTitle"}),svg:_i().p}),action:()=>{Q().a2({collectionSettingsStore:r.settingsStore,item:{type:"group",groupByKey:"collection_groups"===i?"collection_group_by":"board_columns_by",groupsFormatKey:i}})}}),d&&(m?u.push({key:"addAggregation",render:e=>(0,Ge.jsx)(Fi().A,{...e,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"Show aggregation",id:"database.collectionGroupActionMenu.addAggregationTitle"}),svg:Pi().eyeIcon}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:[Vn().VR]};et().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,Bi().F)({collectionViewStore:r,update:{query2:t},transaction:e})}})}else et().createAndCommit({userAction:"CollectionGroupActionMenu.handleShowGroupAggregation",environment:e,canUndo:!0,perform:e=>{We().zA({stores:[r],update:{collection_group_aggregation:Vn().VR},transaction:e})}})}(o,i,a,r)}):u.push({key:"removeAggregation",render:e=>(0,Ge.jsx)(Fi().A,{...e,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"Hide aggregation",id:"database.collectionGroupActionMenu.removeAggregationTitle"}),svg:Fe().e}),action:()=>function(e,t,o,n){const r=n.collectionViewStore();if(r)if("board_columns"===t){const t={...o,aggregations:null};et().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{(0,Vi().f)({collectionViewStore:r,update:t,transaction:e})}})}else et().createAndCommit({userAction:"CollectionGroupActionMenu.handleHideGroupAggregation",environment:e,canUndo:!0,perform:e=>{We().zA({stores:[r],update:{collection_group_aggregation:null},transaction:e})}})}(o,i,a,r)})),n.hidden||n.hiddenByDefault?u.push({key:"show",render:e=>(0,Ge.jsx)(Fi().A,{...e,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"Show group",id:"database.collectionGroupActionMenu.showButtonTitle"}),svg:Pi().eyeIcon}),action:()=>{(0,Li().m)({environment:o,collectionContextStore:r,groupsFormatKey:i,groupFormat:n,action:"toggle_group_visibility",currentGroups:s})}}):u.push({key:"hide",render:e=>(0,Ge.jsx)(Fi().A,{...e,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"Hide group",id:"database.collectionGroupActionMenu.hideButtonTitle"}),svg:Fe().e}),action:()=>{(0,Li().m)({environment:o,collectionContextStore:r,groupsFormatKey:i,groupFormat:n,action:"toggle_group_visibility",currentGroups:s})}}),void 0===p.value||!g.canEditContent||g.isSyncedCollection||"collectionTypedView"===r.contextTypeFromStoreState||g.isExternallyImportedAndSyncedCollection||(0,E().TR)(null===(t=r.collectionViewStore())||void 0===t?void 0:t.getCollectionSource())||u.push({key:"delete",render:e=>(0,Ge.jsx)(Fi().A,{...e,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"Delete pages",id:"database.collectionGroupActionMenu.deleteButtonTitle"}),svg:Ri().trashIcon}),action:()=>function(e,t,o,n,r,i){ei().ui({message:(0,Ge.jsx)(Le().sA,{defaultMessage:"Are you sure? All pages inside this group will be deleted.",id:"database.collectionGroupActionMenu.deleteDialogMessage"}),showCancel:!0,keepFocus:!1,items:[{label:"Delete",color:"red",onAccept:()=>Hi(e,t,o,n,r,i)}]})}(o,r,s,n,i,c)});const S={key:"collection group",render:e=>(0,Ge.jsx)(Pe().A,{...e}),items:u};return S}var $i=()=>o(383036),Ui=()=>o(356246),qi=()=>o(67657),Xi=()=>o(98126);function Yi(e,t){const{calculating:o,aggregation:n}=e.asyncAggregationStatusStore.state;return n?o&&(0,W().n4)(t,n):o}function Qi({collectionContextStore:e,aggregation:t,children:o}){const{isCalculating:n,changingType:i}=(0,k().K8)((()=>({isCalculating:Yi(e,t),changingType:e.asyncAggregationStatusStore.state.changingType})),[e,t]),l=function(e,t){const o=(0,r.useRef)(e);return(0,r.useEffect)((()=>{t||void 0===e&&"-"===e||(o.current=e)}),[t,e]),o.current}(o,n);return n?i?(0,Ge.jsx)(Xi().k,{}):(0,Ge.jsx)("span",{style:{opacity:.5},children:l??o}):(0,Ge.jsx)(Ge.Fragment,{children:o})}var Zi=()=>o(142680);const Ji=(0,Le().YK)({propertyAggregation:{id:"collection.aggregation.propertyType",defaultMessage:"{aggregationType} in {propertyName}{calculating, select, true { (Calculating…)} other {}}"},aggregationType:{id:"collection.aggregation.aggregationType",defaultMessage:"{aggregationType}{calculating, select, true { (Calculating…)} other {}}"},aggregationCalculating:{id:"collection.aggregation.calculating",defaultMessage:"Calculating…"}});var el=()=>o(525955),tl=()=>o(662971),ol=()=>o(518461);function nl({schema:e,groupFormat:t,format:o,groupAggregationKey:n,collectionContextStore:r,disabled:i,groupsResultStore:l}){const a=o[n]||{aggregator:"count"},s=(0,I().IS)((()=>({button:{fontWeight:pe().Wy.medium,color:K().Tj.text.tertiary,height:24}})),[]);return(0,Ge.jsx)(Wo().m,{renderTooltip:()=>(0,Ge.jsx)(pl,{schema:e,collectionContextStore:r,aggregation:a}),render:c=>(0,Ge.jsx)(Ce().A,{popupType:g().A.isMobile?Ce().z.BottomSheet:Ce().z.Popup,renderOrigin:o=>(0,Ge.jsx)(Fr().p,{disabled:i,style:s.button,...(0,$i().A)((0,$i().A)(c,o),{onClick:Ii().k}),children:(0,Ge.jsx)(ul,{collectionContextStore:r,schema:e,aggregation:a,groupFormat:t,groupsResultStore:l})}),disabled:i,render:t=>(0,Ge.jsx)(dl,{aggregation:a,parent:t,collectionContextStore:r,format:o,groupAggregationKey:n,schema:e})})})}function rl({aggregationType:e,isSelected:t,label:o,props:n}){const r=el().cx[e];return(0,Ge.jsx)(Wo().m,{placement:"right",delayThreshold:0,render:e=>(0,Ge.jsx)(Ae().A,{title:o,isChecked:t,...(0,$i().A)(e,n)}),renderTooltip:()=>(0,Ge.jsxs)("div",{style:{width:140,whiteSpace:"normal"},children:[r?(0,Ge.jsx)("img",{src:(0,ol().L)(r),style:{borderRadius:6,width:140,marginTop:4}}):void 0,el().fp[e]]})},n.key)}function il(e,t,o,n,r){const i=o.collectionViewStore();i&&(o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),et().createAndCommit({userAction:"CollectionGroupAggregation.handleChangeAggregation",environment:t,canUndo:!0,perform:t=>{(0,Bi().F)({collectionViewStore:i,update:{format:{...n,[r]:e}},transaction:t})}})),(0,N().X)({environment:t,collectionContextStore:o,action:"change_aggregation"})}function ll(e,t,o,n,r,i,l){const a=el().zY[o];return{key:o,render:t=>(0,Ge.jsx)(rl,{isSelected:e,aggregationType:o,label:a,props:t}),action:()=>{il({aggregator:o,enforceMaxAggregationLimit:t},n,r,i,l)}}}function al(e,t,o,n,r){const{enforceMaxAggregationLimit:i,disabled:l}=(0,el().NT)(e),a={...e,enforceMaxAggregationLimit:!i};return{key:"aggregationLimitToggle",render:e=>(0,Ge.jsx)(Zi().A,{on:i,disabled:l,menuListItemProps:e}),action:()=>il(a,t,o,n,r)}}function sl(e,t,o,n,r,i,l,a){const{device:s}=n,c=el().zY[t],d=W().oE(o.map((o=>function(e,t,o,n,r,i,l,a,s){const c=i[t];if(!c)return;const d=c.name;return{key:`${t}${o}`,render:t=>(0,Ge.jsx)(rl,{isSelected:e,aggregationType:o,label:d,props:t}),action:()=>{il({aggregator:o,property:t,enforceMaxAggregationLimit:n},r,l,a,s)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,!(!e.enforceMaxAggregationLimit||!(0,qi().AS)(t))&&e.enforceMaxAggregationLimit,n,r,i,l,a)))),u=d.findIndex((o=>o.key===`${e.property}${t}`));return{key:t+c,render:(e,t)=>(0,Ge.jsx)(tl().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,Ge.jsx)(Ae().A,{...e,ref:t,title:c}),renderExtension:(e,o)=>{let n;return n=g().A.isMobile?{menuType:Te().gu.Modal,title:c,right:s.isPhone?(0,Ge.jsx)(Le().sA,{...xe().W.done}):void 0,onClickRight:o.close,...e}:{menuType:Te().gu.Popup,width:200,...e},(0,Ge.jsx)(je().A,{...n,children:(0,Ge.jsx)(Me().A,{type:Me().O.Vertical,initialFocus:u,sections:[{key:"results",render:e=>(0,Ge.jsx)(Pe().A,{...e}),items:d}],onAccept:t.onAccept})})}}),action:()=>null}}function cl(e,t,o,n,r,i){const l={};for(const u of qi().VD)l[u]=ll(e.aggregator===u,e.enforceMaxAggregationLimit??!1,u,t,o,n,r);const a=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,qi().wG)(o)&&!("rollup"===o.type&&"status"===o.target_property_type)}))}(i);if(a.length>0)for(const u of qi().CG)"show_unique"!==u&&(l[u]=sl(e,u,a,t,i,o,n,r));const s=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,qi().OC)(o)}))}(i);if(s.length>0)for(const u of qi().Sn)l[u]=sl(e,u,s,t,i,o,n,r);const c=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,qi().fo)(o)}))}(i);if(c.length>0)for(const u of qi().zE)l[u]=sl(e,u,c,t,i,o,n,r);const d=function(e){return Object.keys(e).filter((t=>{const o=e[t];return o&&(0,qi().s_)(o)}))}(i);if(d.length>0)for(const u of Ui().QO)l[u]=sl(e,u,d,t,i,o,n,r);return l}function dl({aggregation:e,parent:t,collectionContextStore:o,format:n,groupAggregationKey:r,schema:i}){const l=(0,x().v3)(),{actions:a,initialFocus:s}=function(e,t,o,n,r,i){const l=[];let a=0,s=0;const c=cl(e,t,o,n,r,i);let d=0;return Object.entries(qi().Kn).forEach((([i,u])=>{const p=[];for(const t of u)c[t]&&(p.push(c[t]),e.aggregator===t&&(a=d,s=p.length-1));const m=[];if("count_aggregations"===i&&m.push({key:"limitToggleSection",render:e=>(0,Ge.jsx)(Pe().A,{...e}),items:[al(e,t,o,n,r)]}),m.push({key:"aggregations",render:e=>(0,Ge.jsx)(Pe().A,{topBorder:!0,...e}),items:p}),p.length>0){d++;const e=el().jA[i],t={key:e,render:(t,o)=>(0,Ge.jsx)(tl().A,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,Ge.jsx)(Ae().A,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=g().A.isMobile?{menuType:Te().gu.Modal,title:e,right:(0,Ge.jsx)(Le().sA,{...xe().W.done}),onClickRight:n.close,...t}:{menuType:Te().gu.Popup,width:250,...t},(0,Ge.jsx)(je().A,{...r,children:(0,Ge.jsx)(Me().A,{type:Me().O.Vertical,initialFocus:s,sections:m,onAccept:(e,t,r)=>{"aggregationLimitToggle"!==e.key&&(n.close(),o.onAccept&&o.onAccept(e,t,r))}})})}}),action:()=>null};l.push(t)}})),{actions:l,initialFocus:a}}(e,l,o,n,r,i);let c;return c=g().A.isMobile?{menuType:Te().gu.Modal,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"Aggregation",id:"database.collectionGroupAggregation.title"}),right:(0,Ge.jsx)(Le().sA,{...xe().W.done}),onClickRight:t.close}:{menuType:Te().gu.Popup,width:200},(0,Ge.jsx)(je().A,{...c,children:(0,Ge.jsx)(Me().A,{type:Me().O.Vertical,initialFocus:s,sections:[{key:"aggregation section",render:e=>(0,Ge.jsx)(Pe().A,{...e}),items:a}],onAccept:t.close})})}function ul(e){const t=(0,k().K8)((()=>{var t;const o=e.groupsResultStore.state;if(!o)return;const n=(0,Vn().Ix)(e.groupFormat);return null===(t=o.aggregationResults)||void 0===t?void 0:t[n]}),[e.groupFormat,e.groupsResultStore]);let o,n;if((0,qi().G9)(e.aggregation)){const t=e.schema[e.aggregation.property];!t||"formula"!==t.type&&"number"!==t.type||(o=t.number_format),t&&"date"===t.type&&(n=t.date_format)}return(0,Ge.jsx)(Qi,{aggregation:e.aggregation,collectionContextStore:e.collectionContextStore,children:t?(0,el().rv)({numberFormat:o,dateFormat:n,aggregation:e.aggregation,userTimeZone:(0,tr().P)(),value:t.aggregationResult,numberPrecision:void 0}):"–"})}function pl({schema:e,collectionContextStore:t,aggregation:o}){const n=(0,Le().tz)(),r=el().zY[(0,qi().V1)(o)],i=(0,k().K8)((()=>Yi(t,o)),[t,o]);if((0,qi().G9)(o)){const t=e[o.property];if(t){const e=t.name;return(0,Ge.jsx)(Ge.Fragment,{children:n.formatMessage(Ji.propertyAggregation,{aggregationType:r,propertyName:e,calculating:i})})}}return(0,Ge.jsx)(Ge.Fragment,{children:n.formatMessage(Ji.aggregationType,{aggregationType:r,calculating:i})})}var gl=()=>o(330918);function ml(e){const{onMount:t,isInPeekRenderer:n,style:i,paddingTop:l,disabled:a,stickyStyle:s,transitionStickyStyle:c,groupFormat:d,collectionContextStore:u,format:p,groupAggregationKey:g,stickyWrapStyle:m}=e,[S,h]=(0,r.useState)(void 0),y=(0,x().v3)(),v=(0,Ue().Zp)(),f=(0,r.useRef)(null);(0,r.useEffect)((()=>{null==t||t()}),[t]),(0,r.useEffect)((()=>{const e=u.collectionViewBlockStore();e&&h(new(ae().B)(y,{table:ht().ev,id:e.id}))}),[u,y]);const b=(0,k().K8)((()=>u.groupsStore.getGroupState(d)),[u.groupsStore,d]),w=(0,r.useMemo)((()=>{if((0,Vn().D1)(d.value)&&(0,Vn().WO)(d.value.value))return new(ae().B)(y,d.value.value)}),[y,d.value]),C=(0,k().K8)((()=>Boolean((null==w?void 0:w.isReady())&&!(null!=w&&w.canRead()))),[w]),j=(0,k().K8)((()=>(0,In().I)(u)),[u]),A=(0,k().K8)((()=>null==b?void 0:b.toggleStateStore.state),[b]),M=(0,k().O$)(u.permissionScopesStore),P=(0,wi().V)(u),_=(0,k().K8)((()=>(P||!a)&&u.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&!C&&!j),[u,a,C,j,P]),R=(0,k().O$)(u.isInHomeWidgetStore),B=void 0!==p[g]&&!(null!=v&&v.hideAggregation),V=(0,ne().Oz)(u),F=R?"transparent":(null==V?void 0:V.background)||void 0,E=(0,k().O$)(u.isUnlistedViewStore),O=(0,I().IS)((()=>{const t=E||n||j?K().Tj.background.elevated:K().Tj.background.primary;return{topLevelDiv:{position:"relative",zIndex:87,width:"100%",background:void 0===F?t:F,fontSize:14,overflow:e.stickyLeft?void 0:"auto",...i},stickyWrapStyle:{display:"flex",alignItems:"center",height:e.height??33,paddingTop:l,...e.stickyLeft&&{position:"sticky",insetInlineStart:e.isFullScreen||e.isRootChild?e.paddingLeft:0},...!A&&{marginBottom:e.toggleClosedMarginBottom},...m}}}),[F,n,A,l,e.height,e.isFullScreen,e.isRootChild,e.paddingLeft,e.stickyLeft,e.toggleClosedMarginBottom,i,m,E,j]),D=(0,r.useCallback)((()=>{if(!b)return;(0,Ye().I)({environment:y});const e=!A;(0,o(361743).J)({environment:y,groupFormat:d,toggleStateStore:b.toggleStateStore,newValue:e,collectionContextStore:u})}),[u,y,d,b,A]),z=(0,r.useCallback)((()=>(0,Ge.jsx)(ki().f,{isSidebar:!1,open:A??!1,fill:!0,onClick:D,onMouseDown:Ti().t,style:{flexShrink:0}})),[D,A]),{value:L}=(0,T().fJ)(Vt().VI.duplicateActions),W=(0,r.useCallback)((async e=>{const{droppedStores:t,duplicate:o}=e,n=f.current;if(!(n&&n instanceof Element))return;const r=await $t().T.formulas.load();et().createAndCommit({userAction:"CollectionGroupHeader.handleDrop",environment:y,canUndo:!0,perform:e=>xr({environment:y,collectionContextStore:u,groupsPointer:[d],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:r,duplicateActions:L})})}),[u,L,y,d]),H=(0,r.useMemo)((()=>({...s,paddingInlineStart:e.paddingLeft-2})),[s,e.paddingLeft]);return b&&S?(0,Ge.jsx)(Ci().g,{stickyAttachPoint:R?"no-stick":"ceiling",stickyStyle:H,transitionStickyStyle:c,nodeRef:f,children:(0,Ge.jsxs)("div",{style:O.topLevelDiv,ref:f,children:[(0,Ge.jsx)("div",{style:O.stickyWrapStyle,children:(0,Ge.jsx)("div",{style:{display:"flex",alignItems:"center",position:e.stickyLeft?"sticky":void 0,insetInlineStart:e.paddingLeft,overflow:"hidden"},children:(0,Ge.jsxs)(oo().Ay,{store:S,canDropOnto:!a&&!A,onSelectableDrop:W,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,analyticsName:"board_hidden_group",shouldShowDropZone:!0,groupsPointer:[d],style:{display:"flex",alignItems:"center",height:"100%",overflow:"hidden"},canSelect:!1,children:[z(),(0,Ge.jsx)(vl,{collectionGroupHeaderProps:e}),B?(0,Ge.jsx)(hl,{groupsResultStore:e.groupsResultStore,disabled:e.disabled,format:e.format,schema:e.schema,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,groupAggregationKey:e.groupAggregationKey}):void 0,!a&&M.canConfigureBlock?(0,Ge.jsx)(yl,{groupFormat:e.groupFormat,currentGroups:e.currentGroups,format:e.format,schema:e.schema,query:e.query,collectionContextStore:e.collectionContextStore,groupsFormatKey:e.groupsFormatKey,isGroupHoveredStore:e.isGroupHoveredStore}):void 0,_?(0,Ge.jsx)(fl,{collectionGroupHeaderProps:e,isGroupHoveredStore:e.isGroupHoveredStore}):void 0]})})}),e.children]})}):null}const Sl=r.memo(ml);function hl({disabled:e,format:t,schema:o,collectionContextStore:n,groupFormat:r,groupsResultStore:i,groupAggregationKey:l}){const a=!(0,k().O$)(j().e),s=(0,k().O$)(n.canConfigureBlockStore);return a?null:(0,Ge.jsx)(nl,{groupsResultStore:i,groupFormat:r,disabled:e||!s,groupAggregationKey:l,format:t,schema:o,collectionContextStore:n})}function yl({groupFormat:e,currentGroups:t,format:o,schema:n,query:r,collectionContextStore:i,groupsFormatKey:l,isGroupHoveredStore:a}){const s=(0,Le().tz)(),c=(0,k().O$)(a),[d,u]=(0,xi().A)(),p=(0,I().IS)((()=>({button:{transition:g().A.isMobile?void 0:"opacity 100ms ease-in-out",opacity:g().A.isMobile?void 0:c||u?1:0}})),[u,c]);return(0,Ge.jsx)(Ce().A,{popupType:g().A.isMobile?Ce().z.BottomSheet:Ce().z.Popup,renderOrigin:e=>(0,Ge.jsx)(Ie().A,{ariaLabel:s.formatMessage({id:"actionButtonComponent.ariaLabel",defaultMessage:"Show group options"}),ref:d,icon:Be().ellipsisSmallIcon,style:p.button,...e}),onClick:Ii().k,render:a=>(0,Ge.jsx)(Wi,{parent:a,groupFormat:e,currentGroups:t,format:o,schema:n,query:r,collectionContextStore:i,groupsFormatKey:l})})}function vl({collectionGroupHeaderProps:e}){const t=(0,x().v3)(),{groupFormat:o,schema:n,disabled:r,currentGroups:i,groupBy:l,collectionContextStore:a}=e,s=(0,k().O$)(a.permissionScopesStore);return(0,Ge.jsx)(gl().d,{groupBy:l,groupFormat:o,currentGroups:i,schema:n,disabled:r||!s.canConfigureCollection||s.isSyncedCollection||"formula"===l.type,isHiddenGroup:!1,onChange:o=>function(e,t,o){const{collectionContextStore:n}=o,r=n.collectionStore();r&&(Mi({...e,environment:t,collectionStore:r,...o}),(0,N().X)({environment:t,collectionContextStore:n,action:"rename_group"}))}(o,t,e),style:{maxWidth:400,lineHeight:"24px"},uncategorizedIconStyle:{marginInlineStart:2},collectionContextStore:a,source:"collection_group_header"})}function fl({collectionGroupHeaderProps:e,isGroupHoveredStore:t}){const o=(0,Le().tz)(),n=(0,x().v3)(),r=(0,k().O$)(t),[i,l]=(0,xi().A)(),a=(0,I().IS)((()=>({button:{transition:g().A.isMobile?void 0:"opacity 100ms ease-in-out",opacity:g().A.isMobile?void 0:r||l?1:0}})),[l,r]);return(0,Ge.jsx)(Wo().m,{renderTooltip:()=>(0,Ge.jsx)(Le().sA,{defaultMessage:"Create new",id:"database.collectionGroupHeader.actions.addNewPage.tooltip"}),render:t=>(0,Ge.jsx)(Ie().A,{ariaLabel:o.formatMessage({id:"collectionGroupHeader.actions.addNewPage.ariaLabel",defaultMessage:"Add new page in group"}),ref:i,icon:Ho().plusSmallIcon,onClick:()=>function(e,t){const{groupFormat:o,collectionContextStore:n,isFullScreen:r,onGroupHeaderAddItem:i}=t;n.groupsStore.getGroupState(o)&&(0,co().E)(e,(0,s().f)(n.collectionStore()))&&(n.searchQueryStore.state&&(0,Cr().S)({searchQuery:"",collectionContextStore:n,isFullScreen:r}),et().createAndCommit({userAction:"CollectionGroupHeader.handleAddItemClick",environment:e,canUndo:!0,perform:r=>{const l=(0,Xn().Q)({environment:e,collectionContextStore:n,groupsPointer:[o],insertAtIndex:0,shouldCoerce:!0,templateStore:n.defaultPageTemplateStore.state,transaction:r,from:{createBlock:"group_header"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});l&&(i(l.newStore,l.coercionSucceeded,t),$n().vH(e,{from:"group_add_item_top",type:"page",new_page_id:l.newStore.id,creating_block_id:l.newStore.id,...(0,Lt().sl)(n)}))}}))}(n,e),style:a.button,...t})})}const bl=P().Store.createClass(!1,{name:"IsGroupHoveredStore"}),xl=r.memo((function({renderGroupResults:e,groupFormat:t,groupsDisplayState:o,disabled:n,groupsFormatKey:i,groupAggregationKey:l,groupsResultStore:a,format:s,schema:c,query:d,collectionContextStore:u,onGroupHeaderAddItem:p,renderHeader:g,getGroupStyle:m,stickyLeft:S,paddingLeft:h,isFullScreen:y,index:v,isRootChild:f,isInPeekRenderer:b,groupBy:w,isLast:C}){const T=(0,x().v3)(),j=(0,r.useRef)(null),A=(0,k().uB)(void 0,bl),[M,P,_,R,B]=(0,k().K8)((()=>{const r=u.groupsStore.getGroupState(t),x=r?r.toggleStateStore:null,k=!!x&&x.state?e(t):null,I={groupFormat:t,currentGroups:o.currentGroups,disabled:n,groupsFormatKey:i,groupAggregationKey:l,groupsResultStore:a,format:s,schema:c,query:d,collectionContextStore:u,isFullScreen:y,isInPeekRenderer:b,onGroupHeaderAddItem:p,stickyLeft:S,index:v,paddingLeft:h,isRootChild:f,groupBy:w,isGroupHoveredStore:A},T=g?g(I):(0,Ge.jsx)(Sl,{...I});return[r,x,m&&x?m({groupFormat:t,index:v,isLast:C,toggleStateStore:x,isFullScreen:y,groupsDisplayState:o}):void 0,k,T]}),[u,t,e,o,n,i,l,a,s,c,d,y,b,p,S,v,h,f,w,A,g,m,C]),V=(0,k().K8)((()=>u.collectionViewStore()),[u]);(0,r.useEffect)((()=>{bi({environment:T,collectionContextStore:u,groupFormat:t})}),[V]);const F=(0,r.useCallback)((()=>{A.setState(!0)}),[A]),E=(0,r.useCallback)((()=>{A.setState(!1)}),[A]),O=(0,I().IS)((()=>({container:{width:"100%",position:"relative",..._}})),[_]);return M&&P?(0,Ge.jsx)("div",{style:O.container,onMouseEnter:F,onMouseLeave:E,ref:j,children:(0,Ge.jsxs)(fi().b,{nodeRef:j,isFirst:0===v,children:[B,R]})}):null}),Fn().A);var wl=()=>o(45941),Cl=()=>o(403733);const kl=10,Il=r.memo((function(e){const{type:t,groupsLimitStore:o,collectionContextStore:n,style:r}=e,i=(0,x().v3)(),l=(0,k().K8)((()=>(0,Yr().Mw)({collectionContextStore:n,isForColumnGroups:"board"===t})),[n,t]),a=(0,I().IS)((()=>({hovered:{background:K().Tj.whiteButtonBackground},hoveredButton:{background:K().Tj.buttonHoveredBackground},icon:{marginInlineStart:g().A.isMobile?0:1,..."default"===t?{marginInlineEnd:7}:{}},button:{display:"flex",alignItems:"center",fontSize:g().A.isMobile?gi().hN:gi().Mi,marginInlineStart:-5,paddingTop:2,paddingBottom:2,paddingInlineStart:6,paddingInlineEnd:8,color:K().Tj.text.tertiary,fontWeight:pe().Wy.regular,..."board"===t?{background:void 0,marginInlineEnd:12,width:"fit-content",...r}:{height:30,marginTop:4,marginBottom:4}}})),[r,t]);return"default"===t?(0,Ge.jsxs)(Fr().p,{onClick:()=>function(e,t,o){const n=(0,wl().TW)({isMobile:g().A.isMobile});o.setState(o.state+n),t.loadingDetailsStore.setState({type:"load_more_groups"}),Tl(e)}(i,n,o),onMouseDown:Ti().t,disabled:l,hoveredStyle:l?a.hovered:a.hoveredButton,style:{...a.button,...r},children:[(0,Ge.jsx)(ke().I,{icon:Cl().arrowStraightDownSmallIcon,colorVariant:"tertiary",size:g().A.isMobile?Kn().Ev.default:Kn().Ev.sm,style:a.icon}),(0,Ge.jsx)(Le().sA,{id:"database.groups.loadMoreButtonDefault",defaultMessage:"Load more"}),l?(0,Ge.jsx)("div",{style:{marginTop:1,marginInlineStart:8},children:(0,Ge.jsx)(Xi().A,{size:"sm"})}):void 0]}):(0,Ge.jsxs)(Fr().p,{onClick:()=>function(e,t,o){const n=(0,wl().TW)({isMobile:g().A.isMobile});o.setState(o.state+n),t.loadingDetailsStore.setState({type:"load_more_columns"}),Tl(e)}(i,n,o),onMouseDown:Ti().t,disabled:l,hoveredStyle:l?a.hovered:a.hoveredButton,style:a.button,children:[(0,Ge.jsx)("div",{style:{marginInlineEnd:8},children:l?(0,Ge.jsx)("div",{style:{marginInlineStart:4},children:(0,Ge.jsx)(Xi().A,{size:"sm"})}):(0,Ge.jsx)(ke().I,{icon:Be().ellipsisSmallIcon,colorVariant:"tertiary",size:g().A.isMobile?Kn().Ev.default:Kn().Ev.sm,style:a.icon})}),(0,Ge.jsx)("span",{style:{flexGrow:1},children:(0,Ge.jsx)(Le().sA,{id:"database.groups.loadMoreButtonBoard",defaultMessage:"Load more groups"})})]})}),Fn().A);function Tl(e){(0,i().DO_NOT_USE_trackLegacy)(e,"collection_load_more_groups")}function jl(e){const{format:t,isFullScreen:o,paddingLeft:n,isRootChild:r}=e,i=(0,x().v3)(),l=(0,k().K8)((()=>(0,wn().iw)({environment:i,format:t,isFullScreen:o,isRootChild:r})),[i,t,o,r]),a=(0,k().K8)((()=>"collectionTypedView"===e.collectionContextStore.contextTypeFromStoreState),[e.collectionContextStore]),s=(0,k().K8)((()=>(0,wn().Od)({environment:i,isRootChild:r,isFullScreen:o,format:t})?wn().HV:n),[i,t,o,r,n]);return l||a?null:(0,Ge.jsx)("div",{style:{width:"100%",height:mi+hi+Si,display:"flex"},children:(0,Ge.jsx)(vi,{groupFormatKey:"collection_groups",groupBy:e.groupBy,currentGroups:e.currentGroups,schema:e.schema,groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,onAccept:e.onAccept,parentStore:e.parentStore,style:{position:"sticky",insetInlineStart:e.isFullScreen?s:32,width:"max-content"}})})}function Al(e){const{format:t,isFullScreen:o,isRootChild:n}=e,r=(0,x().v3)(),i=(0,k().K8)((()=>(0,wn().iw)({environment:r,format:t,isFullScreen:o,isRootChild:n})),[r,t,o,n]),l=(0,k().K8)((()=>(0,wn().Od)({environment:r,isRootChild:n,isFullScreen:o,format:t})?wn().HV:e.paddingLeft),[r,t,o,n,e.paddingLeft]);return i?null:(0,Ge.jsx)(Il,{type:"default",groupsLimitStore:e.groupsLimitStore,collectionContextStore:e.collectionContextStore,style:{position:"sticky",insetInlineStart:o?l:32,width:"max-content",paddingInlineStart:4,paddingInlineEnd:8}})}var Ml=()=>o(991003),Pl=()=>o(689885),_l=()=>o(395361),Rl=()=>o(721908),Bl=()=>o(498521),Vl=()=>o(540355),Fl=()=>o(680288),El=()=>o(535960),Ol=()=>o(691809);class Dl extends P().Store{getInitialState(){return{}}}var zl=()=>o(508390),Ll=()=>o(651220);function Kl(e){return(0,k().K8)((()=>{var t;const o=e.collectionViewStore(),n=null==o||null===(t=o.getCollectionSource())||void 0===t?void 0:t.type;return(0,Nn().a0)(n)}),[e])}var Wl=()=>o(522419),Hl=()=>o(144440),Nl=()=>o(120672);function Gl(e){const{environment:t,collectionStore:o,targetStore:n,droppedDirection:r,files:i,transaction:l,collectionContextStore:a,groupsPointer:s,formulasModule:c,duplicateActions:d}=e,u=a.collectionViewStore(),p=(0,Nl().y)(t);if(!u)return;const g=o.inMemoryRecordCache,m=Hl().$C({environment:t,files:i,inMemoryRecordCache:g,pageWidth:p,transaction:l,spaceId:o.pointer.spaceId}).map(((e,n)=>{const r=i[n],a=He().Wv({environment:t,type:"page",inMemoryRecordCache:g,properties:{title:(0,L().x9d)(Wl().v5(r.name))},transaction:l,spaceId:o.pointer.spaceId});return rr().BC({parentStore:a.getContentStore(),appendStore:e,transaction:l}),a}));xr({environment:t,collectionStore:o,targetStore:n,droppedDirection:r,collectionContextStore:a,groupsPointer:s,droppedStores:m,duplicate:!1,transaction:l,collapsedGroup:!1,formulasModule:c,duplicateActions:d})}var $l=()=>o(278729),Ul=()=>o(848538),ql=()=>o(418211),Xl=()=>o(288157);function Yl(e){var t;const{environment:o,targetStore:n,droppedDirection:r,collectionContextStore:i,collectionViewStore:l,groupsPointer:s,droppedStores:c,transaction:d}=e;if(!(0,ql().c)({collectionContextStore:i}))return;const u=i.getLibraryViewName();u&&(0,Rr().DB)({environment:o,libraryViewName:u,numPagesReordered:c.length});const p=((null===(t=i.groupsStore.getGroupState(s))||void 0===t?void 0:t.resultsStore.state)||[]).filter((e=>!c.find((t=>t.id===e.id)))),g=p.indexOf(n),m=r===En().bH.Above||r===En().bH.Left?g:g+1;return function(e){const{resultIds:t,collectionViewStore:o,transaction:n}=e,r=o.getCollectionSource(),i=a().default.state.sidebarSpaceViewStore;if(i&&r&&(0,E().Ux)(null==r?void 0:r.type)){let e;if("private"===r.type)e=i.getPrivatePagesStore();else if("favorites"===r.type)e=i.getBookmarkedPagesStore();else{if("shared"!==r.type)return;e=i.getSharedPagesManualSortStore()}He().KY({transaction:n,store:e,value:t.slice(0,er().WF)})}}({resultIds:[...p.slice(0,m),...c,...p.slice(m)].map((e=>e.id)),collectionViewStore:l,transaction:d}),(0,Ft().t)({environment:o,stores:c}),c}async function Ql(e){const{droppedDirection:t,targetStore:o,collectionContextStore:n,groupsPointer:r,droppedStores:i,environment:l}=e,s=n.collectionViewStore();if(!s)return;const c=null==s?void 0:s.getCollectionSource();if((0,E().Ux)(null==c?void 0:c.type))if(t===En().bH.Onto){var d;const e=n.getLibraryViewName();if(!(0,Xl().FR)()||"private"!==e&&"shared"!==e)return;const{sidebarSpaceStore:t}=a().default.state,r=null===(d=l.currentUser)||void 0===d?void 0:d.id,s=t&&r?$l().V.createChildStore(t,Ul().i1({userId:r,spaceId:t.id})):void 0;await async function(e){const{environment:t,targetStore:o,droppedStores:n,collectionContextStore:r,spaceUserStore:i}=e,l=r.getLibraryViewName(),{sidebarSpaceStore:s,sidebarSpaceViewStore:c}=a().default.state;s&&c&&("private"===l||"shared"===l)&&await _r().Hu({environment:t,spaceUserStore:i,type:l,targetStore:o,targetParentStore:o.getRecordStoreUIParent(),droppedDirection:En().bH.Onto,droppedStores:n,isTopLevelItem:!1,isDroppingOnFullSection:!1,duplicate:!1,duplicateActions:void 0})}({environment:l,targetStore:o,droppedStores:i,collectionContextStore:n,spaceUserStore:s})}else if(t===En().bH.Above||t===En().bH.Below){if(!(0,ql().b)({collectionContextStore:n}))return;(0,et().createAndCommit)({userAction:"CollectionGroupResultsItem.handleDrop",environment:l,canUndo:!0,perform:e=>{(0,gr().f)({environment:l,collectionContextStore:n}),Yl({environment:l,droppedDirection:t,collectionContextStore:n,collectionViewStore:s,groupsPointer:r,targetStore:o,droppedStores:i,transaction:e})}})}else t===En().bH.Left||t===En().bH.Right||(0,H().HB)(t)}var Zl=()=>o(187174);var Jl=()=>o(696887),ea=()=>o(991114),ta=()=>o(968913),oa=()=>o(851802),na=()=>o(645302),ra=()=>o(121544),ia=()=>o(590894),la=()=>o(160811),aa=()=>o(61188);function sa(e){const{analyticsName:t,belowDropZoneMargin:n,blockPropertyValueOverlayStore:i,canDrag:l,canDrop:a,collectionContextStore:s,direction:c,disabled:d,disableScrollToRevealHorizontal:u,disableSelectable:p,dropzoneGap:g,getItemSelectableStyle:m,groupsPointer:S,handleOpenPeekPage:h,isLast:y,itemSelectableHaloStyle:v,onSelectableEnter:f,onSelectableInsertRow:b,passesFilter:w,renderItem:C,itemProps:j,store:A,subitemPath:M,toggleButton:P,touchDragOnly:_}=e,R=(0,x().v3)(),V=(0,Ue().Zp)(),{value:F}=(0,T().fJ)(Vt().VI.duplicateActions),E=(0,k().K8)((()=>(0,ta().Wi)(R,A.id)),[A,R]),O=(0,k().K8)((()=>A.canEdit()),[A]),D=(0,k().K8)((()=>A.getAssociatedCollectionStore()),[A]),z=(0,k().K8)((()=>{var e;return null===(e=s.collectionViewStore())||void 0===e?void 0:e.getType()}),[s]),L=(0,k().K8)((()=>"collectionTypedView"===s.contextTypeFromStoreState),[s]),K=(0,k().K8)((()=>{const e=s.groupsStore.getGroupState(S);return null==e?void 0:e.resultsStore}),[s,S]),W=(0,k().K8)((()=>ne().NM(A)),[A]),H=(0,k().K8)((()=>ne().f5({collectionContextStore:s})?60:void 0),[s]),N=(0,k().K8)((()=>{const e=ia().A.state;return e.isActive&&e.store===A}),[A]),G=(0,k().K8)((()=>s.isInLibraryBlock()),[s]),U=(0,k().K8)((()=>{var e;const t=En().Ay.state;if(!t.isDragging)return!1;const o=null===(e=t.currentDropZone)||void 0===e?void 0:e.direction;return t.draggedStores.some((e=>e.isCollectionView()))&&o===En().bH.Below&&!G}),[G]),q=(0,wi().V)(s),X=(0,k().K8)((()=>(q||!d)&&O&&!E),[d,O,E,q]),Y=e.shouldShowHoverMenu&&(X||G),Q=c!==ya.Vertical&&a,Z=c!==ya.Vertical&&a,J=c===ya.Vertical&&a,ee=(0,I().IS)((()=>({haloStyle:{...ne().wh(W),...("board"===z||"gallery"===z)&&{borderRadius:kl},...v}})),[z,v,W]),te=(0,r.useCallback)((e=>{const{insertStores:t,transaction:o}=e;return D?(0,la().D)({environment:R,collectionStore:D,collectionContextStore:s,groupsPointer:S,insertStores:t,store:A,before:!1,transaction:o}):[]}),[D,s,R,S,A]),oe=(0,r.useCallback)((e=>{const{insertStores:t,transaction:o}=e;return D?(0,la().D)({environment:R,collectionStore:D,collectionContextStore:s,groupsPointer:S,insertStores:t,store:A,before:!0,transaction:o}):[]}),[D,s,R,S,A]),re=(0,r.useCallback)((async e=>{const{droppedDirection:t,duplicate:o}=e,n=(0,ql().b)({collectionContextStore:s});if(!D&&!n)return[];const r=B().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");B().default.DO_NOT_USE_measureAfterNextFlushLegacy(r,{environment:R,getData:()=>Lt().tv({collectionContextStore:s,is_native_drop:!1,is_empty:!1})});const i=t!==En().bH.Onto?(0,ci().f0)({stores:e.droppedStores,collectionContextStore:s}):e.droppedStores;if(0===i.length&&L)return void ei().f1((0,Ge.jsx)(Le().sA,{...ci().K0.unsupportedGroupAction}));if(s.isInLibraryBlock())return void Ql({environment:R,droppedDirection:t,collectionContextStore:s,groupsPointer:S,targetStore:A,droppedStores:i});const l=await $t().T.formulas.load();et().createAndCommit({userAction:"CollectionGroupResultsItem.handleDrop",environment:R,canUndo:!0,perform:e=>{!xr({environment:R,collectionStore:L?void 0:D,targetStore:A,droppedDirection:t,collectionContextStore:s,groupsPointer:S,droppedStores:i,duplicate:o,transaction:e,subitemPath:M,collapsedGroup:!1,formulasModule:l,duplicateActions:F})&&L&&ei().f1((0,Ge.jsx)(Le().sA,{...ci().K0.unsupportedGroupAction}))}})}),[D,s,F,R,S,L,A,M]),ie=(0,r.useCallback)((async e=>{const{files:t,droppedDirection:o}=e;if(!D)return[];const n=B().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");B().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:R,getData:()=>Lt().tv({collectionContextStore:s,is_native_drop:!0,is_empty:!1})});const r=await $t().T.formulas.load();et().createAndCommit({userAction:"CollectionGroupResultsItem.handleNativeDrop",environment:R,canUndo:!0,perform:e=>{Gl({environment:R,collectionStore:D,targetStore:A,droppedDirection:o,collectionContextStore:s,groupsPointer:S,files:t,transaction:e,formulasModule:r,duplicateActions:F})}})}),[D,s,F,R,S,A]),le=(0,r.useCallback)((e=>({transaction:t})=>{if(!D)return[];const o=(0,aa().u)({environment:R,collectionContextStore:s,groupsPointer:S,store:A,before:"above"===e,collectionStore:D,transaction:t,subitemPath:M,subitemInsertDirection:"below"});if($n().vH(R,{...Lt().sl(s),type:"page",from:"below"===e?"table_insert_below":"table_insert_above",new_page_id:null==o?void 0:o.id,creating_block_id:null==o?void 0:o.id}),o&&b&&b(A,o),o&&i){const e=()=>{Un().ho({isNewBlock:!0,environment:R,blockPropertyValueOverlayStore:i,store:o,property:"title",surface:"table",collectionContextStore:s})};s.registerCallbackForItemMounted(o,e)}}),[D,i,s,R,S,b,A,M]),se=(0,r.useCallback)((e=>{le("above")(e)}),[le]),ce=(0,r.useCallback)((e=>{le("below")(e)}),[le]),de=(0,r.useCallback)((()=>{const e=s.collectionViewStore();B().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),null==h||h(),$().Ey({collectionContextStore:s,resultsStore:K});const t=null==e?void 0:e.getType();if(t){var o;const e=s.normalizedFormatStore.state.collection_peek_mode,n=e||ra().C9[t];na().bn(R,{is_peek:!0,from:t,peek_mode:n,block_id:A.id,block_type:A.getType(),...A.isType("transcription")&&{calendar_event_id:null===(o=A.getFormat().transcription_calendar_event)||void 0===o?void 0:o.uid}})}}),[s,R,h,K,A]),ue=(0,r.useCallback)((e=>{const{transaction:t}=e;if(s.isInLibraryBlock()){const e=A.getRecordStoreUIParent(),n=e instanceof ae().B&&e.isLibraryBlock();e&&!n&&e.table===o(42466).evP&&e.valueIs(o(76549)._B)&&rr().TF({childToRemoveStore:A,parentStore:e,transaction:t})}else S.length>0&&yr({store:A,transaction:t,groupsPointer:S,collectionContextStore:s,environment:R}),ir().by({childStore:A,transaction:t})}),[s,R,S,A]),pe=(0,k().K8)((()=>m?m(y):void 0),[m,y]);(0,r.useEffect)((()=>{s.onItemMount(A)}),[A,s]);const ge=r.createElement(C,{handleOpenPeekPage:de,collectionContextStore:s,...j,...E?{disabled:!0}:{},store:A,key:A.id,isLast:y,toggleButton:P,subitemPath:M,passesFilter:w});return p?ge:(0,Ge.jsx)(oo().Ay,{analyticsName:t,belowDropZoneMargin:n,canDrag:l,canDropBelow:J,canDropLeft:Q,canDropOnto:a,canDropRight:Z,canInsertAbove:a,canInsertBelow:a,canNativeDropBelow:J&&!L,canNativeDropLeft:Q&&!L,canNativeDropRight:Z&&!L,canSelect:X||G,canTriggerContextMenu:X,className:fn().E4t,disableScrollToRevealHorizontal:u,dropzoneGap:g,dropzoneMustBeWithinHorizontalBound:!0,dropzoneShouldNeverUseOrigin:!0,groupsPointer:S,haloStyle:ee.haloStyle,isLastItem:y,onEnter:f,onInsertAbove:oe,onInsertBelow:te,onInsertRowAbove:se,onInsertRowBelow:ce,onNativeDrop:ie,onRemove:ue,onSelectableDrop:re,shouldForceRenderSelectionHalo:W,shouldShowCommentMenu:!1,shouldShowDropZone:a&&!U,shouldShowHalo:!(N||null!=V&&V.isPreviewing),shouldShowHoverMenu:Y,showBlockMenuInput:!0,store:A,style:pe,touchDragOnly:_,verticalDropZoneExtraLeftEdgeOffset:H,children:ge})}const ca=r.memo(sa,Fn().A),da=r.memo((function(e){const{collectionContextStore:t,pathKey:o,titleColumnIndex:n,limit:i,indentLevel:l,paddingLeft:a}=e,{isSubitemToggleOnTitleColumn:s,viewType:c}=(0,k().K8)((()=>{const e=t.collectionViewStore();return{isSubitemToggleOnTitleColumn:"title"===(null==e?void 0:e.getFormat().table_subitem_toggle_column),viewType:null==e?void 0:e.getType()}}),[t]),d=(0,r.useCallback)((()=>{const{subitemExpandedStore:e}=t;e.state.set(o,{isExpanded:!0,limit:i+wl().s4}),e.emit()}),[t,i,o]),u=(0,I().IS)((()=>{const e=(0,te().si)({columnIndex:0,titleColumnIndex:n,indentLevel:l,isSubitemToggleOnTitleColumn:s});return{container:{width:"100%",height:xn().wc,borderBottom:"table"===c||"timeline"===c?`1px solid ${K().Tj.border.secondaryTranslucent}`:void 0,display:"flex",alignItems:"center"},button:{display:"inline-flex",alignItems:"center",fontSize:g().A.isMobile?gi().hN:gi().Mi,height:28,borderRadius:6,paddingInlineStart:6,paddingInlineEnd:8,position:"sticky",insetInlineStart:a+e},buttonInner:{height:32,width:"fit-content",display:"flex",alignItems:"center",position:"sticky",insetInlineStart:a+e},icon:{marginInlineEnd:6}}}),[n,l,s,a,c]);return(0,Ge.jsx)("div",{style:u.container,children:(0,Ge.jsx)(ui().Ay,{onClick:d,onMouseDown:Ti().t,style:u.button,children:(0,Ge.jsxs)("div",{style:u.buttonInner,children:[(0,Ge.jsx)(ke().I,{icon:Cl().arrowStraightDownSmallIcon,colorVariant:"tertiary",size:g().A.isMobile?Kn().Ev.default:Kn().Ev.sm,style:u.icon}),(0,Ge.jsx)(Dn().D,{styleKey:"bodyRegular",colorVariant:"tertiary",children:(0,Ge.jsx)(Le().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})})]})})})}),Fn().A);function ua(e){var t,n,i;const{store:l,collectionContextStore:a,pathKey:s,subitemPath:c,handleToggleClick:d,paddingLeft:u,getInjectedItemSelectableStyle:p,timelineType:g,compiledFilter:m}=e,S=(0,Le().tz)(),h=(0,x().v3)(),y=(0,k().O$)(a.subitemExpandedStore),v=(0,k().O$)(a.subitemRestrictedAncestorsStore),f=Boolean(null===(t=y.get(s))||void 0===t?void 0:t.isExpanded),b=(null===(n=y.get(s))||void 0===n?void 0:n.limit)??wl().s4,w=(null==c?void 0:c.length)??0,C=(0,k().K8)((()=>a.frozoneStore.state.frozenIndex),[a.frozoneStore]),T=(0,k().K8)((()=>{var e;return null===(e=a.collectionViewStore())||void 0===e?void 0:e.getType()}),[a]),j=(0,r.useCallback)((()=>{d(s,f)}),[d,s,f]),A=(0,I().IS)((()=>{let e=(0,Pt().KC)(w);return"table"===T&&(e-=4),{container:{width:"100%",height:xn().wc,display:"flex",alignItems:"center",borderBottom:"table"===T||"table"===g?`1px solid ${K().Tj.border.secondaryTranslucent}`:void 0,paddingInlineStart:e,cursor:"default"},stickyContent:{display:"flex",alignItems:"center",gap:"table"===T?8:4,...void 0!==C?{position:"sticky",insetInlineStart:u+e}:{}},icon:{marginInlineStart:"list"===T?2:0,marginInlineEnd:8}}}),[T,g,C,u,w]),M=v[l.id];if(!M||0===M.length)return null;const P=(null==c||null===(i=c[c.length-1])||void 0===i?void 0:i.children)??[],_=f&&P.length>0&&P.length===b;return(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)("div",{style:A.container,children:(0,Ge.jsxs)("div",{style:A.stickyContent,children:[(0,Ge.jsx)(ki().f,{isSidebar:!1,open:f,fill:!0,onClick:j,color:K().Tj.icon.primary}),(0,Ge.jsx)(Wo().m,{placement:"top",alignment:"start",textWrap:!1,renderTooltip:e=>(0,Ge.jsx)(Le().sA,{...e,id:"collectionGroupResultsNestedItem.noAccessRowTooltip",defaultMessage:"There is at least one inaccessible page above these nested pages.",description:"Tooltip for a row that has inaccessible nested pages."}),render:e=>(0,Ge.jsxs)("div",{...e,style:{display:"flex",alignItems:"center"},children:[(0,Ge.jsx)(ke().I,{icon:o(176412).L,size:"sm",colorVariant:"tertiary",style:A.icon}),(0,Ge.jsx)(Dn().D,{styleKey:"bodyRegular",colorVariant:"tertiary",children:(0,o(992214).mA)(S)})]})})]})}),f?P.map((t=>(0,r.createElement)(ga,{...e,key:t.value.store.id,childTree:t,compiledFilter:m,subitemPath:[...c,t],getInjectedItemSelectableStyle:p,environment:h}))):null,_?(0,Ge.jsx)(da,{collectionContextStore:a,pathKey:s,titleColumnIndex:0,limit:b,indentLevel:w,paddingLeft:u}):null]})}const pa=r.memo(ua,Fn().A);function ga(e){const{childTree:t,compiledFilter:o,subitemPath:n,getInjectedItemSelectableStyle:i,environment:l,...a}=e,{value:s}=(0,T().fJ)($t().T.formulas),c=(0,ea().C)();return(0,k().K8)((()=>{var e;const n=t.value.store,r=n.getModel();if(!o||!r)return!0;const i=null===(e=n.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return o({block:r,getRecordModel:n.getRecordModel,propertyMapping:i,formulaTimeoutTimestampMs:Date.now()+c,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,experimentService:u().default,formulasModule:s,spaceIdCreator:n.environment.idCreator.getSpaceIdCreatorSync(n.getSpaceId()),getRelationEdgeList:(0,sr().Y)({environment:l,spaceId:n.getSpaceId()})})}),[t,o,c,s,l])?(0,r.createElement)(ca,{...a,key:t.value.store.id,store:t.value.store,passesFilter:!0,isLast:!0,getItemSelectableStyle:i,subitemPath:n}):null}function ma(e){const{store:t,parentStore:n,collectionContextStore:l,subitemPath:a,titleColumnIndex:s,nestedCreateSubitemButton:c,getItemSelectableStyle:p,paddingLeft:m}=e,S=(0,x().v3)(),{value:h}=(0,T().fJ)($t().T.formulas),{currentSubitemFormatStoreForUiDisplayStore:y,subitemExpandedStore:v,subitemTreeStore:f}=l,b=(0,d().X)("collection_property_permissions"),w=(0,d().X)("can_create_pages_in_collection_permission"),C=(0,k().O$)(y),I=(0,k().K8)((()=>(0,ta().Wi)(S,t.id)),[S,t]),{collectionViewType:j,isSystemCollection:A}=(0,k().K8)((()=>{var e;return{collectionViewType:null===(e=l.collectionViewStore())||void 0===e?void 0:e.getType(),isSystemCollection:l.isSystemCollection()}}),[l]),M=a&&0===a.length,P=(0,k().K8)((()=>"favorites"===l.getLibraryViewName()),[l]),_=(0,k().K8)((()=>l.isInLibraryBlock()),[l]),R=(0,k().K8)((()=>M?(0,nr().Qe)(f.state.children,(e=>e.value.store===t)):a),[M,a,f,t],{useDeepEqual:!0}),B=(0,r.useMemo)((()=>R?(0,Pt().kY)(R.map((e=>e.value.store))):""),[R]),V=(0,k().K8)((()=>v.state.get(B)),[v,B]),F=Boolean(null==V?void 0:V.isExpanded),E=(0,k().K8)((()=>{if(!C)return;const e=n.getSchema()[C.property];return void 0!==e&&(0,er().nC)(e)?e:void 0}),[n,C]),O=(0,k().K8)((()=>M&&!t.isDefined()),[t,M]),D=(0,k().K8)((()=>{if(!C||!E)return!1;return 0===(0,Pt().eO)({store:t,subitemFormat:C,propertySchema:E}).length}),[t,C,E]),z=(0,k().K8)((()=>{if(!C)return!1;const e=l.normalizedFormatStore.state.subitem_display_mode??"show",t=l.normalizedFormatStore.state.subitem_filter_scope,n=(0,o(998391).r)(j);switch(t){case"subitems":return D;case"parents":return!n&&"show"===e&&!D;default:return!1}}),[l,j,D,C]),L=(0,k().K8)((()=>{const e=null==C?void 0:C.inverse,o=!e||j&&(0,Zn().qS)(j)?void 0:{property:e,filter:{operator:"is_empty"}};return!!C&&(0,Pt().Ch)({store:t,collectionStore:n,collectionContextStore:l,subitemFormat:C,subitemPathKey:B,propertyFilters:[...o&&e?[{id:e,filter:o}]:[],...l.currentPropertyFiltersStore.state],combinatorFilter:l.currentCombinatorFilterStore.state,currentUserId:S.currentUser.id,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,formulasModule:h,spaceIdCreator:S.idCreator.getSpaceIdCreatorSync(t.getSpaceId()??"")}).length>0}),[j,C,n,t,B,l,S.currentUser.id,S.idCreator,h]),H=(0,k().K8)((()=>!!C&&(!!(L||F||g().A.isMobile||"timeline"===j)||A&&t.canRead()&&(void 0===s||0===s)&&(0,o(396301).IX)({store:t,outlinerFilter:"library"}))),[C,A,t,s,L,F,j]),N=(0,k().K8)((()=>{if(!C)return!1;const e=w?l.permissionScopesStore.state.canCreatePagesInCollection:l.permissionScopesStore.state.canEditContent;return!(b&&!e&&!L)&&oa().A.getState().hoveredStore===t}),[b,l.permissionScopesStore,L,t,C,w]),G=(0,k().K8)((()=>{const e=(0,Jl().AU)({collectionContextStore:l,collectionStore:n,environment:S});if(e)return(0,o(214388).oR)(e)}),[l,n,S]),$=(0,k().K8)((()=>{const o=f.state;return o&&R&&o.children.length>0?(0,Pt().ag)(o).value.store===t:e.isLast}),[f,e.isLast,t,R]),U=(0,ea().C)(),q=(0,k().K8)((()=>{var e;const o=t.getModel();if(!G||!o)return!0;const n=null===(e=t.getAssociatedCollectionStore())||void 0===e?void 0:e.getPropertyMapping();return G({block:o,getRecordModel:t.getRecordModel,propertyMapping:n,formulaTimeoutTimestampMs:Date.now()+U,resultCache:new Map,regExpCache:new Map,formatDateCache:new Map,experimentService:u().default,formulasModule:h,spaceIdCreator:t.environment.idCreator.getSpaceIdCreatorSync(t.getSpaceId()),getRelationEdgeList:(0,sr().Y)({environment:S,spaceId:t.getSpaceId()})})}),[t,G,U,h,S]),X=(0,r.useMemo)((()=>{const e=!q&&!("table"===j||"list"===j)||I||z;return()=>({...p?p($):{},...e?{opacity:.5}:{}})}),[j,p,q,I,$,z]),{accessibleChildTrees:Y,restrictedChildTrees:Q}=(0,k().K8)((()=>{var e;const t=(null==R||null===(e=R[R.length-1])||void 0===e?void 0:e.children)??[],o=[],n=[];for(const r of t)r.value.store.isDefined()?o.push(r):n.push(r);return{accessibleChildTrees:o,restrictedChildTrees:n}}),[R],{equalityFn:Fn().k});(0,Zl().Yb)((async()=>{await t.load();const e=t.getRecordModel;H&&G&&E&&e&&C&&!q&&D&&(await(0,Pt().eI)({blockStore:t,subitemExpandedStore:v,subitemFormat:C,propertySchema:E,compiledFilter:G,pathKey:B,forceStoresToLoad:!0,visitedIds:new Set,resultCache:new Map,regExpCache:new Map,spaceIdCreator:S.idCreator.getSpaceIdCreatorSync(t.getSpaceId()??""),formatDateCache:new Map,collectionContextStore:l}),v.emit())}),[H,G,q,B,t,v,C,E,S.idCreator,l,D]);const Z=(0,r.useCallback)(((e,n)=>{const r=v.state;if(n){r.delete(e);const n=Et().default.state.stores.filter((e=>t.uiContains(e)));n.length>0&&(0,o(21259).D)({stores:(0,W().R9)(Et().default.state.stores,n)}),function(e,t){(0,i().DO_NOT_USE_trackLegacy)(e,"subitem_toggle_block_close",t)}(S,{...(0,Lt().sl)(l),depth:(null==R?void 0:R.length)||0}),v.emit()}else r.set(e,{isExpanded:!0,limit:wl().s4}),function(e,t){(0,i().DO_NOT_USE_trackLegacy)(e,"subitem_toggle_block_open",t)}(S,{...(0,Lt().sl)(l),depth:(null==R?void 0:R.length)||0}),G&&r&&E&&C?(0,Pt().eI)({blockStore:t,subitemExpandedStore:v,subitemFormat:C,propertySchema:E,compiledFilter:G,pathKey:e,forceStoresToLoad:!1,visitedIds:new Set,resultCache:new Map,regExpCache:new Map,spaceIdCreator:S.idCreator.getSpaceIdCreatorSync(t.getSpaceId()??""),formatDateCache:new Map,collectionContextStore:l}).then((()=>{v.emit()})):v.emit()}),[v,S,l,null==R?void 0:R.length,t,G,E,C]),J=(0,r.useCallback)((()=>{Z(B,F)}),[Z,B,F]);if(O)return(0,r.createElement)(pa,{...e,key:t.id,store:t,subitemPath:R??[],pathKey:B,handleToggleClick:Z,getInjectedItemSelectableStyle:X,timelineType:e.timelineType,compiledFilter:G});const ee=_?!P||(M??!1):e.canDrag,te=(0,Ge.jsx)(ca,{...e,canDrag:ee,passesFilter:q,isLast:$,getItemSelectableStyle:X,subitemPath:R,toggleButton:H||N?(0,Ge.jsx)(ki().f,{isSidebar:!1,open:F,fill:!0,onClick:J,color:L||F||A&&H?K().Tj.icon.primary:K().Tj.icon.secondary,disabled:R&&R.length>=Zn().x2}):void 0});if(!F||!R||0===R.length||R.length>=Zn().x2)return te;const oe=void 0!==c,ne=Y.length+Q.length,re=V&&ne>0&&ne===V.limit;return(0,Ge.jsxs)(Ge.Fragment,{children:[te,Y.map((t=>{const o=t.value.store;return(0,r.createElement)(Sa,{...e,key:o.id,store:o,subitemPath:[...R,t]})})),Q.map((t=>{const o=(0,Pt().F9)(B,t.value.store);return(0,r.createElement)(pa,{...e,key:t.value.store.id,store:t.value.store,subitemPath:[...R,t],pathKey:o,handleToggleClick:Z,getInjectedItemSelectableStyle:X,timelineType:e.timelineType,compiledFilter:G})})),oe?c({store:t,parentStore:n,subitemPath:R,indentLevel:R.length,titleColumnIndex:s,passesFilter:q}):null,re?(0,Ge.jsx)(da,{collectionContextStore:l,pathKey:B,titleColumnIndex:s,limit:V.limit,indentLevel:R.length,paddingLeft:m}):null]})}const Sa=r.memo(ma,Fn().A),ha=r.createContext(null);ha.displayName="CollectionGroupContainerContext";let ya=function(e){return e[e.Vertical=0]="Vertical",e[e.Horizontal=1]="Horizontal",e}({});function va(e){const{collectionContextStore:t,disabled:o,analyticsName:n,direction:i,disableRequest:l,onSelectableEnter:a,canDrop:s,canDrag:c,groupsPointer:d,loadContentCover:u,emptyDroppableSize:p,emptyDroppableStyle:g,virtualizeResults:m,timelineType:S,paddingLeft:h,paddingRight:y,headerWidth:v,shouldShowShimmer:f}=e,b=(0,x().v3)(),w=(0,k().K8)((()=>t.getViewType()),[t]),C=(0,k().K8)((()=>t.collectionViewBlockStore()),[t]),I=(0,r.useMemo)((()=>{if(C)return new(ae().B)(b,C.pointer)}),[C,b]),{groupState:T,reducer:j}=(0,k().K8)((()=>{const e=t.groupsStore.getGroupState(d);if(!e)return{groupState:void 0,reducer:void 0};const o=e.currentLimit.state,n=t.normalizedSchemaStore.state,r=W().oE(d.map((e=>(0,mr().K8)({schema:n,propertyMapping:void 0,groupBy:t.getGroupByAndGroupFormats().groupBy,group:e,timeZone:(0,tr().P)()}))));return{groupState:e,reducer:{type:"results",filter:r.length>0?{operator:"and",filters:r}:void 0,limit:o,loadContentCover:u}}}),[t,d,u]),A=(0,k().K8)((()=>{if(t.shouldDelayRenderStore.state)return[];const e=t.groupsStore.getGroupState(d);return e?e.resultsStore.state:[]}),[t.groupsStore,t.shouldDelayRenderStore,d]),M=(0,k().K8)((()=>{if("collectionTypedView"!==t.contextTypeFromStoreState)return t.collectionStore()}),[t]),P=(0,k().K8)((()=>{const e=t.normalizedSchemaStore.state;return d.some((t=>{const o=e[t.property];if("relation"===(null==o?void 0:o.type)&&null!=o&&o.property){const t=e[o.property];if("relation"===(null==t?void 0:t.type)&&1===t.limit)return!0}return!1}))}),[t,d]),_=i===ya.Vertical;var R;A.length>0&&(null===(R=t.databaseItemsVisibleTracker)||void 0===R||R.handleItemsRenderStart());(0,r.useEffect)((()=>t.renderEmitter.emit()));const B=(0,k().K8)((()=>t.permissionScopesStore.state.canCreatePagesInCollection),[t.permissionScopesStore]),V=""!==(0,k().O$)(t.searchQueryStore),F=(0,k().K8)((()=>(0,qn().N)({collectionContextStore:t}).length>0),[t]),E=Kl(t),O=d.length>0,D=0===A.length,z=S&&"table"===S,L=!f&&"board"!==w&&"calendar"!==w&&!(O&&"table"!==w&&"list"!==w&&!z)&&D&&(z||("list"===w||"table"===w)&&(V||F)||("list"===w||"table"===w||z||"gallery"===w)&&!1===B||E&&!V&&!F),K=p||void 0;return(0,Ge.jsxs)(Ge.Fragment,{children:[L?(0,Ge.jsx)(Hr,{collectionContextStore:t,paddingLeft:h,paddingRight:y,headerWidth:v,groupsPointer:d}):(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)("div",{style:{..._?{height:K}:{width:K},...g},children:(0,Ge.jsx)(ba,{collectionContextStore:t,disabled:o,analyticsName:n,direction:i,canDrop:s,groupsPointer:d,instanceCollectionViewBlockStore:I,resultStores:A,droppedIntoCollectionStore:M,onSelectableEnter:a})}),m?(0,Ge.jsx)(wa,{collectionContextStore:t,groupsPointer:d,resultComponentProps:e,canDrag:c&&!P,groupState:T,resultStores:A}):A.map(((t,o,n)=>(0,Ge.jsx)(ka,{store:t,isLast:o===n.length-1,...e,canDrag:c&&!P},t.id)))]}),(0,Ge.jsx)(Ia,{collectionContextStore:t,groupsPointer:d,disableRequest:l,resultsReducer:j})]})}const fa=r.memo(va,Fn().A);function ba(e){const{collectionContextStore:t,disabled:o,analyticsName:n,direction:i,onSelectableEnter:l,canDrop:a,groupsPointer:s,instanceCollectionViewBlockStore:c,resultStores:d,droppedIntoCollectionStore:u}=e,p=(0,x().v3)(),g=(0,k().K8)((()=>"collectionTypedView"===t.contextTypeFromStoreState),[t]),m=(0,k().O$)(t.isInHomeWidgetStore),S=(0,k().K8)((()=>ne().f5({collectionContextStore:t})?60:void 0),[t]),{value:h}=(0,T().fJ)(Vt().VI.duplicateActions),y=(0,r.useCallback)((async e=>{const o=await $t().T.formulas.load();return function(e,t,o,n,r,i,l){const{droppedDirection:a,duplicate:s}=e,c=o.collectionViewBlockStore();if(!c)return;const d=B().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");B().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>Lt().tv({collectionContextStore:o,is_native_drop:!1,is_empty:!0})});const u="collectionTypedView"===o.contextTypeFromStoreState,p=(0,ci().f0)({stores:e.droppedStores,collectionContextStore:o});if(0===p.length&&u)return void ei().f1(Yn().A.formatMessage(ci().K0.unsupportedGroupAction));if(o.isInLibraryBlock())return void Ql({environment:t,droppedDirection:a,collectionContextStore:o,groupsPointer:n,targetStore:c,droppedStores:p});et().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableDrop",environment:t,canUndo:!0,perform:e=>{!xr({environment:t,collectionStore:l,targetStore:c,droppedDirection:a,collectionContextStore:o,groupsPointer:n,droppedStores:p,duplicate:s,transaction:e,collapsedGroup:!1,formulasModule:r,duplicateActions:i})&&u&&ei().f1(Yn().A.formatMessage(ci().K0.unsupportedGroupAction))}})}(e,p,t,s,o,h,u)}),[t,u,h,p,s]),v=(0,r.useCallback)((async t=>{const o=await $t().T.formulas.load();return function(e,t,o,n,r,i,l){const{files:a,droppedDirection:s}=e;if(!l)return;const c=o.collectionViewBlockStore();if(!c)return;const d=B().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");B().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:t,getData:()=>Lt().tv({collectionContextStore:o,is_native_drop:!0,is_empty:!0})}),et().createAndCommit({userAction:"CollectionGroupResults.handleEmptyDroppableNativeDrop",environment:t,canUndo:!0,perform:e=>{Gl({environment:t,collectionStore:l,targetStore:c,droppedDirection:s,collectionContextStore:o,groupsPointer:n,files:a,transaction:e,formulasModule:r,duplicateActions:i})}})}(t,p,e.collectionContextStore,e.groupsPointer,o,h,u)}),[u,h,p,e.collectionContextStore,e.groupsPointer]);if(!c)return null;const f=i!==ya.Vertical&&(!o&&0===d.length),b=i===ya.Vertical&&!o;return(0,Ge.jsx)(oo().Ay,{store:c,canSelect:!1,canEditText:!1,shouldShowHalo:!m,canDrag:!1,canDropLeft:a&&f,canNativeDropLeft:a&&f&&!g,canDropBelow:a&&b,canNativeDropBelow:a&&b&&!g,canTriggerContextMenu:!1,isLastItem:0===d.length,showBlockMenuInput:!1,shouldShowHoverMenu:!1,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:y,onNativeDrop:v,analyticsName:n,shouldShowDropZone:a,onEnter:l,groupsPointer:s,verticalDropZoneExtraLeftEdgeOffset:S,style:i===ya.Vertical?void 0:{width:"100%",height:"100%"}})}function xa({collectionContextStore:e,groupsPointer:t,resultComponentProps:o,canDrag:n,groupState:i,resultStores:l}){var a;const s=0!==t.length,c=s,[d,u]=(0,r.useState)(!c),[p,S]=(0,r.useState)(0),h=(0,r.useContext)(m().U),y=(0,r.useRef)(null),v=(0,r.useRef)(null),f=l.length<=0,b=(0,r.useContext)(ha);(0,r.useEffect)((()=>{if(!s)return;const e=new ResizeObserver((()=>{var e;null===(e=v.current)||void 0===e||e.call(v)}));if(null!=b&&b.current)return e.observe(b.current),()=>e.disconnect();console.error("Missing block to observer resizes on, this will result in a broken virtualizer")}),[b,s]);const w=(0,k().K8)((()=>{var e;return null==h||null===(e=h.verticalScroller)||void 0===e?void 0:e.getStore().state.element}),[null==h?void 0:h.verticalScroller]);(0,r.useEffect)((()=>{if(y.current&&c&&!d&&!f){if(null==w||!w.deref())return;const e=new IntersectionObserver((e=>{e[0].isIntersecting&&u(!0)}),{root:w.deref(),rootMargin:"300px 0px 300px 0px"});return e.observe(y.current),()=>e.disconnect()}}),[d,f,w,c]);const C=(0,r.useCallback)((e=>{if(y.current=e,null==w||!w.deref())return;const t=()=>{let t=e,o=0;for(;t&&t!==document.body&&t!==w.deref();)o+=t.offsetTop,t=t.offsetParent;S(o)};t(),v.current=t}),[w]),I=(0,r.useCallback)((e=>l[e].id),[l]),T=(0,Ll().Te)({count:l.length,estimateSize:()=>34,scrollMargin:p,getScrollElement:()=>(null==w?void 0:w.deref())??null,getItemKey:I,overscan:d?10:1,initialOffset:null==w||null===(a=w.deref())||void 0===a?void 0:a.scrollTop});return function({virtualizer:e,resultsStores:t,collectionContextStore:o,groupState:n}){const i=(0,r.useRef)({fetching:!1,previousTotal:0}),l=(0,x().v3)(),a=e.getVirtualItems(),s=t.length+1,c=(0,k().K8)((()=>{var e;return(null==n||null===(e=n.reducerResultStore)||void 0===e||null===(e=e.state)||void 0===e?void 0:e.hasMore)??!1}),[null==n?void 0:n.reducerResultStore]);(0,r.useEffect)((()=>{if(null!=n&&n.groupsPointer.length)return;const{fetching:e,previousTotal:t}=i.current;e&&t!==s&&(i.current={fetching:!1,previousTotal:0})}),[null==n?void 0:n.groupsPointer.length,s]),(0,r.useEffect)((()=>{if(!c||null==n||!n.groupsPointer||n.groupsPointer.length>0||i.current.fetching)return;const[r]=a.slice(-1);if(!r||s<=0)return;const d=g().A.isMobile&&s<50?.5:.67;r.index-e.options.overscan>s*d&&(i.current={fetching:!0,previousTotal:s},o.infiniteScrollLongTaskObserver.observe(),(0,Vl().H)({collectionContextStore:o,environment:l,incrementLimitArgs:{isFullScreen:!0,currentResultCount:t.length,groupsPointer:null==n?void 0:n.groupsPointer,incrementLimitsInRelatedGroups:!1}}))}),[o,l,null==n?void 0:n.groupsPointer,c,t.length,s,a,e.options.overscan])}({virtualizer:T,resultsStores:l,collectionContextStore:e,groupState:i}),(0,r.useEffect)((()=>{e.virtualizedModule.setRowVirtualizer({virtualizer:T,groupsPointer:t})}),[e,T,t]),f?null:(0,Ge.jsx)("div",{ref:C,style:{height:T.getTotalSize(),width:"100%",position:"relative"},children:T.getVirtualItems().map((e=>{const t=l[e.index],r=l.length-1===e.index;return(0,Ge.jsx)("div",{"data-index":e.index,ref:T.measureElement,style:{position:"absolute",top:0,insetInlineStart:0,width:"100%",transform:`translateY(${(e.start??0)-T.options.scrollMargin}px)`},children:(0,Ge.jsx)(ka,{store:t,isLast:r,...o,canDrag:n},t.id)},e.key.toString())}))})}const wa=r.memo(xa,Fn().A);function Ca(e){const{isLast:t,collectionContextStore:o,dropzoneGap:n,itemProps:i,renderItem:l,groupsPointer:a,shouldShowHoverMenu:s,canDrag:c,disabled:d,format:u,getItemSelectableStyle:p,handleOpenPeekPage:g,belowDropZoneMargin:m,analyticsName:S,direction:h,onSelectableEnter:y,canDrop:v,disableScrollToRevealHorizontal:f,touchDragOnly:b,blockPropertyValueOverlayStore:x,onSelectableInsertRow:w,disableSelectable:C,titleColumnIndex:I,nestedCreateSubitemButton:T,itemSelectableHaloStyle:j,paddingLeft:A}=e,M=(0,k().K8)((()=>c&&e.store.canEdit()),[c,e.store]),P=(0,wi().V)(o),_=(0,k().K8)((()=>e.store.isDefined()?ne().Dj({store:e.store,collectionContextStore:o}):o.collectionStore()),[o,e.store]),R=(0,r.useMemo)((()=>[]),[]);return _?(0,Ge.jsx)(Sa,{getItemSelectableStyle:p,itemSelectableHaloStyle:j,store:e.store,parentStore:_,canDrag:M,itemProps:i,renderItem:l,collectionContextStore:o,groupsPointer:a,shouldShowHoverMenu:s,canDrop:v&&(P||!d),format:u,handleOpenPeekPage:g,belowDropZoneMargin:m,analyticsName:S,disabled:d,direction:h,dropzoneGap:n,onSelectableEnter:y,disableScrollToRevealHorizontal:f,touchDragOnly:b,isLast:t,subitemPath:R,titleColumnIndex:I,blockPropertyValueOverlayStore:x,onSelectableInsertRow:w,disableSelectable:C,nestedCreateSubitemButton:T,paddingLeft:A,timelineType:e.timelineType}):null}const ka=r.memo(Ca,Fn().A);function Ia({collectionContextStore:e,groupsPointer:t,disableRequest:o,resultsReducer:n}){const r=(0,k().K8)((()=>e.groupsStore.getGroupState(t)),[e,t]),i=(0,k().K8)((()=>u().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]),l=t.length>0;return o||!n||!r||l?null:(0,Ge.jsx)(Xr().A,{id:Bn().XL,reducer:n,groupsPointer:t,collectionContextStore:e,resultStore:r.reducerResultStore,debounceWait:i})}var Ta=()=>o(573451),ja=()=>o(860118);const Aa=Object.freeze({fontSize:15,lineHeight:1.5,minHeight:22.5,fontWeight:pe().Wy.medium,width:"auto"}),Ma=Object.freeze({fontSize:17,lineHeight:1.5,minHeight:25.5,fontWeight:pe().Wy.medium,width:"auto"});function Pa(e){const{isMobile:t}=e;return t?Ma:Aa}function _a(e,t,o,n,r){const i=o.getViewType();if(!t.isDefined()||!i)return[];return(0,Fl().Wp)({viewType:i,format:o.normalizedFormatStore.state,visible:!0}).filter((i=>n&&i.property!==er().rn||(0,ja().T)({block:t.getModel(),property:i.property,schema:o.normalizedSchemaStore.state,getRecordModel:t.getRecordModel,userId:e.currentUser.id,userTimeZone:(0,tr().P)(),intl:Yn().A.getIntl(),experimentService:u().default,collectionFeatureGates:(0,ar().i)(),formulasModule:r,spaceIdCreator:e.idCreator.getSpaceIdCreatorSync(t.getSpaceId()??""),getRelationEdgeList:(0,sr().Y)({environment:e,spaceId:t.getSpaceId()})})))}function Ra(e){const t=e.getViewType();if("board"===t||"gallery"===t){const o=e.normalizedFormatStore.state;return(0,Fl().qI)(o,t)}return!1}var Ba=()=>o(518489),Va=()=>o(970501),Fa=()=>o(260850),Ea=()=>o(110525),Oa=()=>o(777045),Da=()=>o(246766),za=()=>o(598729);const La=r.memo(r.forwardRef((function(e,t){const{groupsPointer:o,groupFormat:n,collectionContextStore:i,isSingleColumn:l,isButtonOnOwnRow:c,coverHeight:d,hasVisibleProperties:u,isFullScreen:p}=e,m=(0,x().v3)(),S=(0,Le().tz)(),h=(0,r.useContext)(Ea().n),y=(0,k().K8)((()=>ne().fG({collectionContextStore:i,environment:m,intl:S})),[i,m,S]),v=(0,r.useCallback)((e=>{h?h(e):(0,Da().navigate)({environment:m,url:e})}),[m,h]),f=(0,r.useCallback)((()=>{const e=(0,s().f)(i.collectionStore());if(!(0,co().E)(m,e))return void(0,za().Q)(m,e);const t=i.groupsStore.getGroupState(o);t&&et().createAndCommit({userAction:"CollectionGalleryView.handleAddItemClick",environment:m,canUndo:!0,perform:e=>{const{mainEditorCurrentBlockStore:n}=a().default.state,r=(0,Xn().Q)({environment:m,collectionContextStore:i,groupsPointer:o,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:e,from:{createBlock:"gallery"},inMemoryRecordCache:m.defaultRecordCache.inMemoryRecordCache});if(!r)return;const l=ne().wy({environment:m,store:r.newStore,mainEditorCurrentBlockStore:n,collectionContextStore:i})??(0,Se().Ay)({store:r.newStore,pageVisitSource:de().y8.Create});v(l),$().Ey({collectionContextStore:i,resultsStore:t.resultsStore}),$n().vH(m,{from:"gallery_view_add_item_bottom",type:"page",new_page_id:r.newStore.id,creating_block_id:r.newStore.id,...(0,Lt().sl)(i)})}})}),[m,i,o,v]),b=(0,I().eP)(),w=(0,I().IS)((()=>{const{fontSize:e}=Pa({isMobile:g().A.isMobile}),t=ne().rU({isMobile:g().A.isMobile}),o=d>0&&p&&!l&&!c,n=o&&u?d+t:o?d:t;return{wrapper:{display:"flex",flexDirection:"column",alignItems:"stretch"},addItemButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:e,borderRadius:kl,boxShadow:"dark"===b?`${K().Tj.border.primaryTranslucent} 0px 0px 0px 1px`:`${K().Tj.border.secondaryTranslucent} 0px 0px 0px 1px`,padding:g().A.isMobile?"12px 14px 12px 14px":"9px 14px 8px",minHeight:n,height:"100%"},linkExistingButton:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:e,borderRadius:kl,padding:g().A.isMobile?"12px 14px 12px 14px":"9px 14px 8px",marginTop:8},buttonContent:{display:"flex",alignItems:"center",marginInlineStart:-6,color:K().Tj.icon.tertiary},buttonIcon:{width:e,height:e,marginInlineStart:l?void 0:-1,marginInlineEnd:6}}}),[d,p,l,c,u,b]),C=(0,r.useCallback)((e=>(0,Ge.jsx)(ui().Ay,{style:w.linkExistingButton,...e,children:(0,Ge.jsxs)("div",{style:w.buttonContent,children:[(0,Ge.jsx)(ke().I,{icon:_e().arrowDiagonalUpRightIcon,colorVariant:"tertiary",style:w.buttonIcon}),(0,Ge.jsx)(Le().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})),[w]);return(0,Ge.jsxs)("div",{ref:t,style:w.wrapper,children:[(0,Ge.jsx)(ui().Ay,{onClick:f,onMouseDown:Ti().t,style:w.addItemButton,children:(0,Ge.jsxs)("div",{style:w.buttonContent,children:[g().A.isMobile?(0,Ge.jsx)(ke().I,{icon:Ho().plusSmallIcon,colorVariant:"tertiary",style:w.buttonIcon}):(0,Ge.jsx)(ke().I,{icon:ze().plusIcon,colorVariant:"tertiary",style:w.buttonIcon}),(0,Ge.jsx)(Oa().w,{collectionContextStore:i})]})}),y?(0,Ge.jsx)(kr().O,{collectionContextStore:i,groupFormat:n,renderLinkButton:C}):null]})})));var Ka=()=>o(312788),Wa=()=>o(465628),Ha=()=>o(988662),Na=()=>o(27542),Ga=()=>o(752773),$a=()=>o(765101),Ua=()=>o(34556),qa=()=>o(539297),Xa=()=>o(739041),Ya=()=>o(468882);function Qa(e,t,o,n,r){const i=o.getViewType();if((0,qa().x)(i)){const l=(0,Fl().yT)(t);(0,Ba().h)({environment:e,store:t}),(0,Fa().z)({store:l}),(0,Ta().C)({store:t}),r&&(0,Xa().u)(e,"board_item_edit_mode_enter",{...(0,Lt().sl)(o),block_id:t.id,from:r,view_type:i}),n.setState("existing")}}function Za(e,t,o,n,r,i,l,a){const s=r.normalizedSchemaStore.state,c=n.state,d=r.getViewType();if(!c.isOpen||!(0,qa().x)(d))return;const u=_a(t,o,r,l,a).map((e=>e.property)),p=u.findIndex((e=>e===c.property));let g;if("tab"===e){const e=u.find(((e,t)=>t>p&&(0,Ya().B2)(s[e])))||u.find(((e,t)=>!l&&(0,Ya().B2)(s[e])));g=e}else{const e=W().Uk(u,((e,t)=>t<p&&(0,Ya().B2)(s[e])))||W().Uk(u,((e,t)=>!l&&(0,Ya().B2)(s[e])));g=e}g?b().default.afterNextFlush((()=>{Un().ho({environment:t,blockPropertyValueOverlayStore:n,store:o,property:g,surface:d,collectionContextStore:r})})):l&&b().default.afterNextFlush((()=>{Qa(t,o,r,i)})),Un().VN({environment:t,blockPropertyValueOverlayStore:n}),i.preventEmptyDelete()}function Ja(e,t,o,n,r,i,l,a){const s=n.getViewType();if(!(0,qa().x)(s))return;const c=n.normalizedSchemaStore.state,d=_a(t,o,n,l,a).map((e=>e.property));let u;if("tab"===e){u=d.find(((e,t)=>{const o=c[e];return(0,Ya().B2)(o)}))}else{u=W().Uk(d,((e,t)=>{const o=c[e];return(0,Ya().B2)(o)}))}u&&Un().ho({environment:t,blockPropertyValueOverlayStore:r,store:o,property:u,surface:s,collectionContextStore:n}),i.preventEmptyDelete()}function es(e,t,n,r){const i=t.getViewType();"board"!==i&&"gallery"!==i||((0,o(299709).E)({environment:e,collectionContextStore:t,block_id:n.id,property:"title",property_type:"text",from:i}),r.preventEmptyDelete())}var ts=()=>o(751735);function os(e){const{viewType:t,colorStyle:o,backgroundColor:n}=e;return n||("board"===t?(null==o?void 0:o.cardBackgroundColor)||K().Tj.boardItemDefaultBackground:K().Tj.collectionGalleryPreviewCardBackground)}function ns(e){const{backgroundColor:t,colorStyle:o,isInHomeWidget:n,viewType:r}=e;return t?(0,ts().e$)(t,.2):n?os({viewType:r,colorStyle:o,backgroundColor:t}):(null==o?void 0:o.cardHoveredBackgroundColor)||K().Tj.cardHoveredBackground}function rs(e){const{backgroundColor:t,colorStyle:o,isInHomeWidget:n,viewType:r}=e;return t?(0,ts().e$)(t,.3):n?os({viewType:r,colorStyle:o,backgroundColor:t}):(null==o?void 0:o.cardPressedBackgroundColor)||K().Tj.cardPressedBackground}var is=()=>o(371727),ls=()=>o(825225);class as extends P().Store{getInitialState(){return"existing"}preventEmptyDelete(){"new_empty"===this.state&&(this.setState("new"),ia().A.state.isActive&&ia().A.setState({...ia().A.state,transient:!1}))}}const ss=as;var cs=()=>o(347100),ds=(o(941795),()=>o(609679)),us=()=>o(451306),ps=()=>o(963575);function gs(e){const{button:t,isLast:o}=e,n=(0,I().IS)((()=>({button:{display:"flex",alignItems:"center",padding:"4px 6px",fontWeight:pe().Wy.medium,borderInlineEnd:`1px solid ${K().Tj.border.secondaryTranslucent}`,color:K().Tj.text.secondary,fill:K().Tj.text.secondary},buttonLast:{borderInlineEnd:"none"},buttonHovered:{background:K().Tj.whiteButtonHoveredBackground},buttonPressed:{background:K().Tj.whiteButtonPressedBackground}})),[]);return r.cloneElement(t,{...(0,us().ow)(t.props.style,n.button,o&&n.buttonLast),hoveredStyle:(0,us().ow)(n.buttonHovered,o&&n.buttonLast).style,pressedStyle:n.buttonPressed})}const ms=function({children:e,isVisible:t,position:o,style:n}){const i=(0,I().IS)((()=>({container:{color:K().Tj.text.secondary,fill:K().Tj.text.secondary,fontSize:12,background:K().Tj.whiteButtonBackground,boxShadow:K().Tj.shadowSM,display:"flex",whiteSpace:"nowrap",borderRadius:ps().A.borderRadius,maxWidth:"calc(100% - 16px)",minHeight:24,overflow:"hidden",pointerEvents:g().A.isMobile?"auto":"none",opacity:g().A.isMobile?1:0,fontFamily:pe().vc(ds().locale).sans,position:"absolute",insetInlineEnd:ps().A.horizontal.small,bottom:ps().A.vertical.small,zIndex:2},containerHover:{pointerEvents:"auto",opacity:1},containerTop:{top:ps().A.vertical.small,bottom:void 0}})),[]),l=r.Children.toArray(e).filter(H().O9),a=l.length;return(0,Ge.jsx)(fe().A,{animate:{opacity:t?1:0},...(0,us().ow)(i.container,n,t&&i.containerHover,"top"===o&&i.containerTop),children:l.map(((e,t)=>{const o=t===a-1;if(e&&"object"==typeof e&&"type"in e){if(e.type===Wo().m&&r.isValidElement(e))return r.cloneElement(e,{render:(t,n)=>{const r=e.props.render(t,n);return(0,Ge.jsx)(gs,{isLast:o,button:r},e.key)}});if(e.type===ui().Ay&&r.isValidElement(e))return(0,Ge.jsx)(gs,{isLast:o,button:e},e.key)}}))})};function Ss(e){const{navigate:t}=(0,r.useContext)(Ka().E),n=(0,x().v3)(),{value:i}=(0,T().fJ)($t().T.formulas),l=(0,k().K8)((()=>e.collectionContextStore.normalizedFormatStore.state),[e.collectionContextStore.normalizedFormatStore]),s=(0,k().K8)((()=>e.collectionContextStore.getViewType()),[e.collectionContextStore]),c=(0,k().K8)((()=>e.collectionContextStore.permissionScopesStore.state),[e.collectionContextStore.permissionScopesStore]),d=(0,k().K8)((()=>ia().A.state.isActive&&ia().A.state.store===e.store),[e.store]),u=(0,k().K8)((()=>c.canEditContent&&e.store.canEdit()),[c.canEditContent,e.store]),p=(0,k().K8)((()=>ve().default.state.open&&ve().default.state.targetStore.id===e.store.id),[e.store.id]),m=(0,k().K8)((()=>{const t=(0,ne().hH)(e.collectionContextStore);return(0,Ya().lA)(t,!1)}),[e.collectionContextStore]),S=(0,k().K8)((()=>(0,ne().wy)({environment:n,store:e.store,mainEditorCurrentBlockStore:a().default.state.mainEditorCurrentBlockStore,collectionContextStore:e.collectionContextStore,fullyQualified:!1})),[n,e.store,e.collectionContextStore]),h=(0,k().K8)((()=>Ra(e.collectionContextStore)),[e.collectionContextStore]),y=(0,k().K8)((()=>{const t=s?(0,Fl().Wp)({viewType:s,format:l,visible:!0}):[],o=_a(n,e.store,e.collectionContextStore,d,i);return t.length>0&&t.length!==o.length}),[n,l,d,e.collectionContextStore,e.store,s,i]),v=(0,k().K8)((()=>{var t;const o=St().default.state;return!("editing"!==o.mode||!e.blockPropertyValueOverlayStore.state.isOpen)&&(null===(t=(0,Wa().H)(o.multiSelection))||void 0===t?void 0:t.store)===(0,Fl().yT)(e.store)}),[e.store,e.blockPropertyValueOverlayStore]),f=(0,k().K8)((()=>!(c.isLocked||!c.canEditContent||c.isSyncedCollection||c.isExternallyImportedAndSyncedCollection)&&("collectionTypedView"===e.collectionContextStore.contextTypeFromStoreState||e.store.canEdit())),[c.canEditContent,c.isExternallyImportedAndSyncedCollection,c.isLocked,c.isSyncedCollection,e.collectionContextStore,e.store]),b=e.lastProxiedUrl&&e.coverFormat&&"contain"!==e.coverAspectFormat&&u,w=f&&!d&&!v&&(h||y),C=d&&!p&&!e.disablePeekButton,I=!e.controlArgs.isRepositioning&&!e.disableMoreButton;return g().A.isMobile?null:(0,Ge.jsxs)(ms,{isVisible:e.controlArgs.isVisible,position:"top",children:[b&&!e.controlArgs.isRepositioning?(0,Ge.jsx)(ui().Ay,{style:cs().k,onClick:t=>e.controlArgs.handleRepositionClick(t,e.lastProxiedUrl),children:(0,Ge.jsx)(Le().sA,{defaultMessage:"Reposition",id:"collectionViewCardItem.action.reposition"})}):void 0,b&&e.controlArgs.isRepositioning?(0,Ge.jsx)(ui().Ay,{style:cs().k,onClick:e.controlArgs.handleSavePositionClick,children:(0,Ge.jsx)(Le().sA,{defaultMessage:"Save position",id:"collectionViewCardItem.action.savePosition"})}):void 0,b&&e.controlArgs.isRepositioning?(0,Ge.jsx)(ui().Ay,{style:cs().k,onClick:e.controlArgs.handleCancelClick,children:(0,Ge.jsx)(Le().sA,{defaultMessage:"Cancel",id:"collectionViewCardItem.action.cancel"})}):void 0,w?(0,Ge.jsx)(Wo().m,{renderTooltip:()=>(0,Ge.jsx)(Le().sA,{defaultMessage:"Edit",id:"collectionCardItem.edit.tooltip"}),render:t=>(0,Ge.jsx)(ui().Ay,{style:cs().k,onClick:()=>{Qa(n,e.store,e.collectionContextStore,e.editModeStore,"click")},...t,children:(0,Ge.jsx)(ke().I,{icon:o(523389).pencilLineSmallIcon,size:"sm"})})}):void 0,C?(0,Ge.jsx)(Wo().m,{renderTooltip:()=>m.tooltip,render:o=>(0,Ge.jsx)(ui().Ay,{style:cs().k,onClick:()=>{S&&(t({environment:n,url:S}),e.editModeStore.preventEmptyDelete())},...o,children:(0,Ge.jsx)(ke().I,{icon:m.icon,size:"sm"})})}):void 0,I?(0,Ge.jsx)(Wo().m,{renderTooltip:()=>(0,Ge.jsx)(Le().sA,{defaultMessage:"Rename, delete, move to and more…",id:"collectionViewCardItem.repositionAction.tooltip"}),render:t=>(0,Ge.jsx)(ui().Ay,{style:cs().k,onClick:t=>{(0,Va().L)({environment:n,store:e.store}),o(901265).it({environment:n,stores:Et().default.state.stores,left:t.clientX,top:t.clientY,showInput:!0,actionSectionGroupKey:"block_in_collection",analyticsFrom:"block_more_menu",optionalAnalyticsProperties:{collectionContextStore:e.collectionContextStore}})},...t,children:(0,Ge.jsx)(ke().I,{icon:Be().ellipsisSmallIcon,size:"sm"})})}):void 0]})}const hs=r.memo(Ss);var ys=()=>o(651124),vs=()=>o(427571);function fs({propertyFormat:e,store:t,blockPropertyValueOverlayStore:o,collectionContextStore:n,disabled:i,editModeStore:l,isCardSelected:a}){const s=(0,x().v3)(),{value:c}=(0,T().fJ)($t().T.formulas),{collectionStore:d,canEdit:u}=(0,k().K8)((()=>({collectionStore:t.getAssociatedCollectionStore(),canEdit:t.canEdit()})),[t]),{viewType:p,collectionViewStore:g,isTableWrapped:m}=(0,k().K8)((()=>({viewType:n.getViewType(),collectionViewStore:n.collectionViewStore(),isTableWrapped:Boolean(n.normalizedFormatStore.state.table_wrap)})),[n]),S=(0,k().K8)((()=>n.permissionScopesStore.state.isLocked||!n.permissionScopesStore.state.canEditContent),[n.permissionScopesStore]),h=(0,r.useCallback)((()=>Za("tab",s,t,o,n,l,a,c)),[s,t,o,n,l,a,c]),y=(0,r.useCallback)((()=>Za("untab",s,t,o,n,l,a,c)),[s,t,o,n,l,a,c]),v=(0,r.useCallback)((()=>function(e,t,o,n){Un().VN({environment:e,blockPropertyValueOverlayStore:t}),(0,Va().L)({environment:e,store:o}),n.preventEmptyDelete()}(s,o,t,l)),[s,o,t,l]),f=(0,k().K8)((()=>{if(d)return d.getSchema()[e.property]}),[d,e.property]),b=(0,k().K8)((()=>!("compact"!==(0,is().C)(g)||!f)&&"full_line"===(0,ys().j0)({propertySchema:f,propertyFormat:e})),[f,e,g]),w=(0,I().IS)((()=>({wrapperStyle:{...b?{width:"100%"}:{}}})),[b]);return d?(0,Ge.jsx)("div",{style:w.wrapperStyle,children:(0,Ge.jsx)(vs().BlockPropertyRouter,{store:t,property:e.property,disabled:i||!u,locked:S,surface:"gallery"===p?"gallery":"board",tableWrap:m||Boolean(e.wrap),blockPropertyValueOverlayStore:o,collectionStore:d,showIfEmpty:a,onEnter:v,onEsc:v,onBgClick:v,onTab:h,onUntab:y,collectionViewStore:g},e.property)}):null}const bs=r.memo(fs);var xs=()=>o(755125),ws=()=>o(532940),Cs=()=>o(819527);const ks=(0,Le().YK)({untitledBlock:{defaultMessage:"Untitled",id:"collectionViewCardItem.untitledBlock"},typeAName:{defaultMessage:"Type a name…",id:"collectionViewCardItem.itemName.placeholder"}}),Is=Object.freeze({property:!0}),Ts=r.memo((function(e){const{store:t,collectionContextStore:o,editModeStore:n,onTextEsc:i,onTextEnter:l,blockPropertyValueOverlayStore:a,isCardSelected:s}=e,c=(0,x().v3)(),d=(0,Le().tz)(),{value:u}=(0,T().fJ)($t().T.formulas),{collectionViewBlockId:p,collectionViewId:m,viewType:S}=(0,k().K8)((()=>{var e,t;return{collectionViewId:null===(e=o.collectionViewStore())||void 0===e?void 0:e.id,collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id,viewType:o.getViewType()}}),[o]),h=(0,k().K8)((()=>_a(c,t,o,s,u).length>0),[c,t,o,s,u]),y=(0,k().K8)((()=>(0,Pt().Kk)({collectionContextStore:o,blockStore:t})),[t,o]),{titleStore:v,icon:f,isEmptyPage:b,hasError:w}=(0,k().K8)((()=>({titleStore:(0,Fl().yT)(t),icon:t.getIcon(),isEmptyPage:t.isEmptyPage(),hasError:t.hasError()})),[t]),C=(0,k().K8)((()=>(0,ge().Te)(t)),[t]),j=(0,k().K8)((()=>(Boolean(t.getIcon())||!t.isEmptyPage())&&o.shouldShowPageIcon()),[t,o]),A=(0,k().K8)((()=>{var e;return s?d.formatMessage(ks.typeAName):(null===(e=t.getModel())||void 0===e?void 0:e.getEmptyTitlePlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,tr().P)(),intl:d}))||d.formatMessage(ks.untitledBlock)}),[s,d,t]),M=(0,k().K8)((()=>t.canEdit()&&o.permissionScopesStore.state.canEditContent),[t,o]),P=(0,r.useCallback)((()=>{Ja("tab",c,t,o,a,n,s,u)}),[c,t,o,n,a,s,u]),_=(0,r.useCallback)((()=>{Ja("untab",c,t,o,a,n,s,u)}),[c,t,o,n,a,s,u]),R=(0,r.useCallback)((()=>{(0,Ua().x)(),(0,xs().clear)({environment:c});t.canEdit()&&o.permissionScopesStore.state.canEditContent&&("new_empty"===n.state?i(t):"new"===n.state?l(t):(0,Va().L)({environment:c,store:t}),n.preventEmptyDelete())}),[c,t,o.permissionScopesStore,n,i,l]),B=(0,r.useCallback)((()=>{(0,Ua().x)();t.canEdit()&&o.permissionScopesStore.state.canEditContent&&("new_empty"===n.state?i(t):(0,Va().L)({environment:c,store:t}),n.preventEmptyDelete())}),[t,o.permissionScopesStore,n,i,c]),V=(0,r.useCallback)((()=>{es(c,o,t,n)}),[c,t,o,n]),F=(0,r.useCallback)((e=>{const o=t.getIconStore();o&&et().createAndCommit({userAction:"CollectionViewCardItemTitle.handleRecordIconChange",environment:c,canUndo:!0,perform:t=>{He().KY({store:o,value:e,transaction:t})}})}),[c,t]),E=(0,I().IS)((()=>({titleWrap:{position:"relative",width:"gallery"===S?"100%":"auto",display:"flex",alignItems:"center",paddingInlineStart:Cs().w_,paddingInlineEnd:Cs().w_,paddingBottom:h?6:g().A.isMobile?12:8,paddingTop:y?4:g().A.isMobile?12:8},recordIcon:{float:"inline-start",borderRadius:5,width:24,height:24,marginTop:0,marginInlineEnd:4,marginInlineStart:-2,alignSelf:"flex-start"},warningIcon:{fill:K().Tj.palette.orange[500],paddingBottom:6,paddingTop:6,display:"inline-block",verticalAlign:"bottom",...g().A.isMobile?{width:Kn().Ev.default,marginInlineStart:0,marginInlineEnd:4}:{width:Kn().Ev.sm,marginInlineStart:0,marginInlineEnd:6}},text:{pointerEvents:s?void 0:"none",cursor:s?"text":void 0,flexGrow:1,padding:"0 1px",whiteSpace:"pre-wrap",...Pa({isMobile:g().A.isMobile})}})),[h,s,y,S]),O=(0,r.useMemo)((()=>({type:"page_property_value_match",propertyId:"title",collectionViewId:m,collectionViewBlockId:p})),[p,m]),D=(j||s)&&!w;return(0,Ge.jsxs)("div",{style:E.titleWrap,children:[D?M?(0,Ge.jsx)(ge().B6,{disabled:!1,bucket:"secure",style:E.recordIcon,progressContainerStyle:E.recordIcon,icon:f,iconRecordCategory:C,store:t,size:g().A.isMobile?24:20,isEmptyPage:b,onChange:F}):(0,Ge.jsx)(ge().B6,{disabled:!0,icon:f,iconRecordCategory:C,isEmptyPage:b,size:g().A.isMobile?24:20,style:E.recordIcon,isInCollectionView:!0}):null,w?(0,Ge.jsx)(ke().I,{icon:ws().exclamationMarkTriangleIcon,style:E.warningIcon}):null,(0,Ge.jsx)(Qe().A,{store:v,disabled:!s,disableSlashCommands:!0,disableEmojiCommands:!0,disableStyleAnnotations:!0,disableInsertedDeletedAnnotations:!0,disableEmbedMenu:!0,onEnter:R,onEsc:B,onTab:P,onUntab:_,onChange:V,placeholder:A,style:E.text,disableSelectAllBlocks:!0,pasteBehavior:"inline",inPageFind:O,disabledMentionTypes:Is})]})}));function js(e,t){const{navigate:n}=(0,r.useContext)(Ka().E),{store:i,onTextEsc:l,onTextEnter:s,onShiftEnter:c,handleOpenPeekPage:d,collectionContextStore:u,blockPropertyValueOverlayStore:p}=e,g=(0,x().v3)(),m=(0,r.useRef)(null),{value:S}=(0,T().fJ)($t().T.formulas),h=(0,k().uB)(void 0,o(968578).A),y=(0,k().uB)(void 0,ss),v=(0,k().r6)((()=>{const t=ia().A.state;return t.isActive&&t.store===e.store}),[e.store]),f=(0,k().O$)(v),b=(0,k().K8)((()=>Et().default.state.stores.includes(i)),[i]),C=(0,k().K8)((()=>{var e,t,o;return!(i.getSpaceId()!==(null===(e=(0,Ir().S)())||void 0===e?void 0:e.id))&&((null===(t=u.collectionViewStore())||void 0===t?void 0:t.getFormat().app_config_uri)===Qn().Lu&&i.getFormat().app_config_uri===Qn().e4&&"sprint_board"===(null===(o=a().default.state.mainEditorCurrentBlockStore)||void 0===o?void 0:o.getFormat().special_page_for_pm_launch))}),[i,u]),I=(0,k().K8)((()=>{const e=a().default.state.mainEditorCurrentBlockStore;return(0,ne().wy)({environment:g,store:i,mainEditorCurrentBlockStore:e,collectionContextStore:u,fullyQualified:!1})}),[g,u,i]),j=(0,r.useCallback)((()=>{Qa(g,i,u,y,"space")}),[g,i,u,y]),A=(0,r.useCallback)((()=>{(0,Ua().x)(),y.preventEmptyDelete()}),[y]),M=(0,r.useCallback)((()=>{s(i)}),[s,i]),P=(0,r.useCallback)((()=>{Za("tab",g,i,p,u,y,f,S)}),[g,i,p,u,y,f,S]),_=(0,r.useCallback)((()=>{Za("untab",g,i,p,u,y,f,S)}),[g,i,p,u,y,f,S]),R=(0,r.useCallback)((()=>{et().createAndCommit({userAction:"CollectionViewCardItem.handleShiftEnter",environment:g,canUndo:!0,perform:e=>{c({blocks:Et().default.state.stores,transaction:e})}})}),[g,c]),B=(0,r.useCallback)((e=>{"new_empty"!==y.state||e.state||u.defaultPageTemplateStore.state||(l(i),e.removeListener(B))}),[u.defaultPageTemplateStore,y,l,i]);return(0,w().l)((()=>{var t;const o=St().default.state,n=ia().A.state,r=n.isActive&&n.transient,i="editing"===o.mode&&(null===(t=(0,Wa().H)(o.multiSelection))||void 0===t?void 0:t.store)===(0,Fl().yT)(e.store);i&&r?y.setState("new_empty"):i?y.setState("new"):y.setState("existing")})),(0,r.useEffect)((()=>(v.state&&"new_empty"===y.state&&v.addListener(B),()=>{v.removeListener(B)})),[y,v,B]),(0,Qt().NW)(i,t,(0,r.useMemo)((()=>({renderedType:"page",getBlockStore:()=>i,getNode:()=>m.current,activate:()=>{I&&(d(),n({environment:g,url:I}))}})),[g,d,I,i,n]),(0,Ge.jsx)(mt().N,{debugName:"CollectionViewCardItem",capture:f,onEsc:A,onEnter:M,onSpace:j,onTab:P,onUntab:_,children:(0,Ge.jsxs)(mt().N,{debugName:"CollectionViewCardItem",capture:b,onShiftEnter:R,onSpace:e=>e.stopPropagation(),children:[(0,Ge.jsx)(Ms,{...e,ref:m,mouseStore:h,editModeStore:y,isCardSelected:f,peekUrl:I}),C?(0,Ge.jsx)($a().Ni,{origin:m}):void 0]})}))}const As=r.memo(r.forwardRef(js)),Ms=r.memo(r.forwardRef((function(e,t){var n;const{store:i,disabled:l,peekUrl:a,editModeStore:s,handleOpenPeekPage:c,collectionContextStore:u,blockPropertyValueOverlayStore:p,mouseStore:m,isCardSelected:S,coverFormat:h,coverAspectFormat:y,colorStyle:v,coverSizeFormat:f,coverWidth:b,coverHeight:w}=e,C=(0,x().v3)(),j=(0,Ue().Zp)(),A=(0,d().X)("collection_video_card_preview")&&!(null!=j&&j.disableContentPointerEvents),{value:M}=(0,T().fJ)($t().T.formulas),[P,_]=(0,r.useState)(void 0),R=null===(n=(0,ls().y)(i))||void 0===n?void 0:n.background,B=(0,k().K8)((()=>(0,ta().Wi)(C,i.id)),[C,i]),V=(0,k().K8)((()=>m.state.mouseEntered),[m]),{viewType:F,isInHomeWidget:E}=(0,k().K8)((()=>({viewType:u.getViewType(),isInHomeWidget:u.isInHomeWidgetStore.state})),[u]),O=(0,k().K8)((()=>(0,Se().Ay)({store:i,fullyQualified:!1,pageVisitSource:de().y8.LinkInPage})),[i]),D=(0,k().K8)((()=>Ra(u)),[u]),z=(0,k().K8)((()=>_a(C,i,u,S,M)),[C,i,u,S,M]),L=(0,k().K8)((()=>(0,Pt().xC)({collectionContextStore:u,blockStore:i})),[u,i]),W=(0,k().K8)((()=>(0,Pt().Kk)({collectionContextStore:u,blockStore:i})),[u,i]),H=(0,k().K8)((()=>(0,o(299545).oC)(i,{recursivelyLoadAllDiscussions:!1})>0),[i]),N=(0,k().K8)((()=>(0,is().C)(u.collectionViewStore())),[u]),G=(0,r.useCallback)((e=>{_(e)}),[_]),$=(0,r.useCallback)((e=>{c(),s.preventEmptyDelete()}),[s,c]),U=(0,r.useCallback)((()=>{io().A.state||m.setState({...m.state,mouseEntered:!0})}),[m]),q=(0,Rl().d)(U,100),X=(0,r.useCallback)((()=>{m.setState({...m.state,mouseEntered:!1})}),[m]),Y=(0,_l().Y)(X,100),Q=(0,r.useCallback)((e=>{et().createAndCommit({userAction:"CollectionViewCardItem.handleFlushTemporaryPosition",environment:C,canUndo:!0,perform:t=>{We().G8({store:i,coverPosition:e.imagePosition,transaction:t}),e.reset()}})}),[C,i]),Z=(0,r.useCallback)((e=>B||null!=j&&j.disableContentPointerEvents?null:(0,Ge.jsx)(hs,{store:i,collectionContextStore:u,blockPropertyValueOverlayStore:p,coverFormat:h,coverAspectFormat:y,lastProxiedUrl:P,editModeStore:s,controlArgs:e,disablePeekButton:null==j?void 0:j.disablePageLinks,disableMoreButton:null==j?void 0:j.disablePageLinks})),[p,u,j,y,h,s,P,i,B]),J=(0,I().IS)((()=>{const e=os({viewType:F,colorStyle:v,backgroundColor:R}),t=E?K().Tj.homeShadow.card.base:`${K().Tj.shadow.base.sm}, 0 0 0 1px ${(null==v?void 0:v.borderColor)||K().Tj.border.secondaryTranslucent}`;return{linkBox:{borderRadius:kl,position:V?"relative":"static",overflow:"hidden",transition:"background 100ms ease-out",background:e,..."board"===F?{marginBottom:g().A.isMobile?10:8}:{height:"100%"},boxShadow:t},linkBoxInner:{userSelect:S?void 0:"none",WebkitUserSelect:S?void 0:"none",height:"100%",..."board"===F?{minHeight:40}:{display:"flex",flexDirection:"column"}},linkBoxHovered:{background:ns({backgroundColor:R,colorStyle:v,isInHomeWidget:E,viewType:F}),boxShadow:t},linkBoxPressed:{background:rs({backgroundColor:R,colorStyle:v,isInHomeWidget:E,viewType:F}),boxShadow:t},propertiesWrapper:{paddingTop:D?0:8,lineHeight:1.5,display:"flex",flexDirection:"compact"===N?"row":"column",flexWrap:"compact"===N?"wrap":void 0,alignItems:"compact"===N?"center":void 0,marginInlineStart:"compact"===N?6:0,marginInlineEnd:"compact"===N?6:0,paddingBottom:8,...E&&{flexWrap:"wrap"}},iconsWrapper:{display:"flex",alignItems:"center",paddingInlineEnd:10,paddingBottom:H?4:8,paddingInlineStart:!H||W||D?10:4,paddingTop:"gallery"===F&&0===z.length?8:0,marginTop:"board"===F&&H?-2:0},commentsIndicatorWrapper:{display:"flex",alignItems:"center",color:K().Tj.text.tertiary,fill:K().Tj.text.tertiary,fontWeight:pe().Wy.medium,fontSize:12}}}),[R,F,v,V,E,S,H,W,D,z.length,N]);return"board"!==F&&"gallery"!==F?null:(0,Ge.jsxs)(be().Q,{ref:t,href:O,metaHref:g().A.isMobile?O:a,onMouseEnter:q,onMouseMove:q,onMouseLeave:Y,onClick:$,style:J.linkBox,innerStyle:J.linkBoxInner,hoveredStyle:S?{background:J.linkBox.background}:J.linkBoxHovered,pressedStyle:S?{background:J.linkBox.background}:J.linkBoxPressed,disabled:null==j?void 0:j.disablePageLinks,disableForOffline:B,children:[(0,Ge.jsx)(o(801678).A,{store:i,source:F,mouseStore:m,renderControl:Z,small:"small"===f,onFlushTemporaryPosition:Q,render:({imagePosition:e})=>h&&(0,Ge.jsx)(o(358006).z,{variant:"gallery",store:i,coverWidth:b,coverHeight:w,coverFormat:h,allowVideoPlayback:A,coverAspectFormat:y,coverSizeFormat:f,coverPosition:e,showEmptyGalleryCover:"gallery"===F,onLoadProxiedImage:G,isInHomeWidget:u.isInHomeWidgetStore.state})}),L?(0,Ge.jsx)("div",{style:{paddingInlineEnd:6,paddingTop:8,paddingBottom:0,paddingInlineStart:6,maxWidth:"100%"},children:(0,Ge.jsx)(Na().n,{blockStore:i,collectionContextStore:u})}):void 0,D?(0,Ge.jsx)(Ts,{collectionContextStore:u,store:i,blockPropertyValueOverlayStore:p,onTextEsc:e.onTextEsc,onTextEnter:e.onTextEnter,editModeStore:e.editModeStore,isCardSelected:e.isCardSelected}):null,z.length>0?(0,Ge.jsx)("div",{style:J.propertiesWrapper,children:z.map((e=>(0,Ge.jsx)(bs,{store:i,disabled:l,blockPropertyValueOverlayStore:p,collectionContextStore:u,editModeStore:s,isCardSelected:S,propertyFormat:e},e.property)))}):void 0,H||W?(0,Ge.jsxs)("div",{style:J.iconsWrapper,children:[W?(0,Ge.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,Ge.jsx)(Ga().W,{blockStore:i,collectionContextStore:u})}):void 0,(0,Ge.jsx)(Ha().g,{store:i,iconStyle:J.commentsIndicatorWrapper,buttonStyle:{position:"relative",marginInlineStart:W?-3:0}})]}):void 0]})}))),Ps=r.memo((function(e){const{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:a,style:s,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:g,coverFormat:m,coverAspectFormat:S,coverSizeFormat:h,coverHeight:y,coverWidth:v,onTextEnter:f,onTextEsc:b,onShiftEnter:x,blockPropertyValueOverlayStore:w,handleOpenPeekPage:C,collectionContextStore:k}=e;return(0,Ge.jsx)(Ne().c,{store:t,step:"demo_collection_record",children:(0,Ge.jsx)(As,{store:t,disabled:o,isFirstItem:n,isLastItem:r,hideContent:i,blockResizerStore:l,isQuickFind:a,style:s,disableCommentMenu:c,disableHoverMenu:d,disableDrag:u,numberedListCounterStore:p,bulletedListFormatStore:g,coverFormat:m,coverAspectFormat:S,coverSizeFormat:h,coverHeight:y,coverWidth:v,colorStyle:void 0,onTextEnter:f,onTextEsc:b,onShiftEnter:x,blockPropertyValueOverlayStore:w,handleOpenPeekPage:C,collectionContextStore:k})})}));function _s(e){const t=e.minHeight||Es,o=(0,I().IS)((()=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:4,background:K().Tj.largeShimmerColor,minHeight:t}})),[t]);return(0,Ge.jsx)(zo().P,{style:o.card})}function Rs(e){const{hasPartialResults:t}=e;if(!(0,Ml().A)(!0,0,100))return null;const o=e.coverHeight??ps().A.card.desktop.medium.height,n=t?void 0:o+40,r=t?1:3,i=W().Hn(r,(e=>(0,Ge.jsx)(_s,{minHeight:n},e)));return(0,Ge.jsx)(Ge.Fragment,{children:i})}const Bs=r.memo((function(e){var t;const{groupFormat:o,store:n,format:i,disabled:l,collectionContextStore:a,schema:s,blockPropertyValueOverlayStore:c,isFullScreen:d,collectionGalleryViewStore:u,headerWidth:p,paddingLeft:m,paddingRight:S}=e,h=(0,r.useRef)(null),y=(0,r.useRef)(null),[v,f]=(0,r.useState)(!1),b=(0,r.useMemo)((()=>o?[o]:[]),[o]),x=p<=Fs,w=(0,k().K8)((()=>a.groupsStore.anyGroupHasResults()),[a]),C=(0,k().K8)((()=>a.groupsStore.getGroupState(b)),[a,b]),T=(0,k().K8)((()=>u.state.coverHeight),[u]),{reducerResult:j,hasPartialResults:A}=(0,k().K8)((()=>{const e=null==C?void 0:C.reducerResultStore.state;return{reducerResult:e,hasPartialResults:void 0!==e&&(null==e?void 0:e.blockIds.length)>0}}),[C]),M=(0,k().K8)((()=>(0,Yr().iv)({collectionContextStore:a,groupsPointer:b,hasPartialResults:A})),[a,b,A]),P=(0,k().K8)((()=>ne().XQ({collectionContextStore:a,reducerResult:j,isFullScreen:d})),[a,j,d]),{canEditContent:_,isSyncedCollection:R}=(0,k().O$)(a.permissionScopesStore),B=(0,wi().V)(a),V=(0,k().K8)((()=>n.isSystemBlock()),[n]),F=(0,k().K8)((()=>n.canEdit()&&("collectionTypedView"===a.contextTypeFromStoreState||_)),[n,a,_]),E=(0,k().O$)(a.isInHomeWidgetStore);(0,r.useEffect)((()=>y.current&&h.current?f(y.current.offsetTop>h.current.offsetTop):f(!1)),[y,h,null==j?void 0:j.blockIds]);const O=(0,I().IS)((()=>{const e=i.collection_group_by,t=i.gallery_cover_size,{fontSize:n}=Pa({isMobile:g().A.isMobile});return{container:{paddingBottom:o?16:void 0},resultsWrapper:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${x?"100%":`${ne().rq(t)}px`}, 1fr))`,gridRowGap:16,gridColumnGap:16,paddingTop:e?1:16,paddingBottom:4,...E?{paddingInlineStart:8,paddingInlineEnd:8}:{}},loadMoreButton:{fontSize:n},loadMoreButtonIcon:{width:n,height:n},renderLoadMoreButtonDivider:{width:"100%",borderTop:o?void 0:`1px solid ${K().Tj.border.primary}`,marginTop:4,marginBottom:4}}}),[i.collection_group_by,i.gallery_cover_size,o,E,x]);if(!C)return null;const D=void 0!==o,z=!E&&w&&(B||!l&&F)&&!R&&(A||!M)&&!V,L=Boolean(null===(t=i.gallery_properties)||void 0===t||null===(t=t.filter((e=>e.visible)))||void 0===t?void 0:t.length);return(0,Ge.jsxs)("div",{style:O.container,children:[(0,Ge.jsxs)("div",{style:O.resultsWrapper,children:[(0,Ge.jsx)(Vs,{collectionContextStore:a,groupFormat:o,format:i,schema:s,disabled:l,store:n,blockPropertyValueOverlayStore:c,collectionGalleryViewStore:u,isSingleColumn:x,paddingLeft:m,paddingRight:S,headerWidth:p,shouldShowShimmer:M}),(0,Ge.jsx)("div",{ref:h,style:{display:"none"}}),M?(0,Ge.jsx)(Rs,{hasGroups:D,hasPartialResults:A,coverHeight:T}):null,z?(0,Ge.jsx)(La,{ref:y,collectionContextStore:a,groupsPointer:b,groupFormat:o,isSingleColumn:x,isButtonOnOwnRow:v,coverHeight:i.gallery_cover&&T?T:0,hasVisibleProperties:L,isFullScreen:d}):null]}),P?(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)("div",{style:O.renderLoadMoreButtonDivider}),(0,Ge.jsx)(zl().jJ,{groupsPointer:b,store:n,collectionContextStore:a,format:i,isFullScreen:d,incrementLimitsInRelatedGroups:!1,style:O.loadMoreButton,iconStyle:O.loadMoreButtonIcon})]}):null]})})),Vs=r.memo((function(e){const{collectionContextStore:t,groupFormat:o,format:n,schema:i,disabled:l,store:a,blockPropertyValueOverlayStore:s,collectionGalleryViewStore:c,isSingleColumn:d,paddingLeft:u,paddingRight:p,headerWidth:g,shouldShowShimmer:m}=e,S=(0,x().v3)(),h=(0,r.useMemo)((()=>o?[o]:[]),[o]),y=(0,k().O$)(t.permissionScopesStore),v=(0,k().K8)((()=>a.canEdit()&&("collectionTypedView"===t.contextTypeFromStoreState||y.canEditContent)),[t,y.canEditContent,a]),f=(0,r.useCallback)((e=>{const t=e.blocks;if(t.length>0){const e=t[0],o=e.getBlockTitleStore();(0,Ba().h)({environment:S,store:e}),(0,Fa().z)({store:o}),(0,Ta().C)({store:e})}}),[S]),b=(0,r.useCallback)((e=>{const o=t.collectionStore(),n=e.getTitleStore();if(!n)return;L().q4_(n.getValue())?(0,Va().L)({environment:S,store:e}):o&&et().createAndCommit({userAction:"CollectionGalleryView.handleItemTextEsc",environment:S,canUndo:!0,perform:t=>{ir().by({childStore:e,transaction:t})}})}),[t,S]),w=(0,r.useMemo)((()=>d?{position:"absolute",top:6,insetInlineStart:0,insetInlineEnd:0,height:4}:{position:"absolute",top:16,bottom:4,width:4,height:"none"}),[d]),{gallery_cover:C,gallery_cover_aspect:I,gallery_cover_size:T}=n,j=!l&&v&&!y.isSyncedCollection,{coverHeight:A,coverWidth:M}=(0,k().O$)(c),P=(0,r.useMemo)((()=>({format:n,schema:i,onTextEnter:b,onTextEsc:b,onShiftEnter:f,disabled:l,coverFormat:C,coverAspectFormat:I,coverSizeFormat:T,coverHeight:A,coverWidth:M,blockPropertyValueOverlayStore:s,collectionContextStore:t})),[s,t,A,M,I,C,T,l,n,f,b,i]);return(0,Ge.jsx)(fa,{collectionContextStore:t,groupsPointer:h,format:n,canDrag:j,onSelectableEnter:f,itemProps:P,renderItem:Ps,canDrop:!0,disabled:l,shouldShowHoverMenu:!1,direction:d?ya.Vertical:ya.Horizontal,belowDropZoneMargin:6,emptyDroppableSize:4,dropzoneGap:10,analyticsName:"gallery",emptyDroppableStyle:w,loadContentCover:C&&"page_content"===C.type,paddingLeft:u,paddingRight:p,headerWidth:g,shouldShowShimmer:m})})),Fs=480,Es=40,Os=r.memo((function(e){const{store:t,format:o,collectionContextStore:n,isFullScreen:i,isPreviewing:l,isRootChild:a,blockPropertyValueOverlayStore:s,disabled:c,schema:d,paddingBottom:u,paddingLeft:p,paddingRight:m,minWidth:h,headerWidth:y}=e,v=(0,x().v3)(),b=(0,r.useRef)(null),w=(0,k().uB)(void 0,Dl),{coverWidth:C,coverHeight:T}=(0,k().O$)(w),j=(0,k().K8)((()=>ne().mM(n,i)),[n,i]),A=(0,k().O$)(n.isInHomeWidgetStore),M=(0,k().K8)((()=>Boolean(n.viewsModuleContextStore.getViewModuleType())),[n]),P=(0,r.useCallback)((()=>{if(b.current){const e=b.current.getNode();if(e){const t=e.querySelector(`.${fn().E4t}`);if(null!==t&&t instanceof HTMLDivElement)return t.offsetWidth}}return ne().rq(o.gallery_cover_size)}),[o.gallery_cover_size]),_=(0,r.useCallback)((e=>{w.setState({coverHeight:w.state.coverHeight,coverWidth:e||P()})}),[w,P]),R=(0,r.useCallback)((()=>P()*(9/16)),[P]),B=(0,r.useCallback)((e=>{w.setState({coverWidth:w.state.coverWidth,coverHeight:e||R()})}),[w,R]),V=(0,r.useCallback)((e=>{var t;const o=n.isLoadingStore.state,r=null===(t=n.groupsStore.getGroupState([]))||void 0===t||null===(t=t.reducerResultStore)||void 0===t?void 0:t.state;e<Mo().B.incrementScrollOffset&&r&&!o&&null!=r&&r.hasMore&&(0,Vl().H)({collectionContextStore:n,environment:v,incrementLimitArgs:{isFullScreen:i,currentResultCount:r.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[n,v,i]),F=(0,r.useCallback)((()=>{const e=R(),t=P();T!==e&&B(e),C!==t&&_(t)}),[R,P,T,C,B,_]),E=(0,_l().Y)(F,100),O=(0,Rl().d)(F,100);(0,r.useEffect)((()=>{_(P()),B()}),[P,B,_,null==o?void 0:o.gallery_cover_size]),(0,r.useEffect)((()=>((0,S().P)(window,"resize",O),g().A.isMobile&&(0,S().P)(window,"orientationchange",E),()=>{(0,f().O)(window,"resize",O),g().A.isMobile&&(0,f().O)(window,"orientationchange",E)})),[E,O]);const D=(0,I().IS)((()=>({container:{paddingBottom:u,paddingInlineStart:p,paddingInlineEnd:m,minWidth:h}})),[h,u,p,m]),z=o.collection_group_by,L=(0,Ue().Zp)();return(0,Ol().A)((e=>(0,Ge.jsxs)("div",{style:D.container,className:fn().wx0,children:[(0,Ge.jsx)(oo().Ay,{location:"collectionGalleryView",store:t,shouldShowHalo:!i&&!A&&!l,canSelect:!i&&!M,disablePointerEvents:null==L?void 0:L.disableContentPointerEvents,analyticsName:"gallery",...e,ref:b,children:z?(0,Ge.jsx)(Ds,{blockPropertyValueOverlayStore:s,collectionContextStore:n,collectionGalleryViewStore:w,disabled:c,format:o,isFullScreen:i,isRootChild:a,paddingLeft:p,paddingRight:m,headerWidth:y,schema:d,store:t}):(0,Ge.jsx)(Bs,{blockPropertyValueOverlayStore:s,collectionContextStore:n,collectionGalleryViewStore:w,disabled:c,format:o,groupFormat:void 0,isFullScreen:i,headerWidth:y,schema:d,store:t,paddingLeft:p,paddingRight:m})}),j?void 0:(0,Ge.jsx)(Bl().A,{onChange:V})]})))}),Fn().A),Ds=r.memo((function(e){const{collectionContextStore:t,store:o,format:n,disabled:i,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:s,paddingLeft:c,paddingRight:d,isRootChild:u,headerWidth:p,collectionGalleryViewStore:m}=e,S=(0,x().v3)(),h=(0,r.useCallback)((e=>(0,Ge.jsx)(zs,{collectionGroupHeaderProps:e})),[]),y=(0,r.useCallback)((e=>{if(g().A.isMobile)(0,El().u)({environment:S,store:e,pageVisitSource:de().y8.Create});else{const o="collectionTypedView"===t.contextTypeFromStoreState;(0,Kr().V)({environment:S,store:e,peekMode:ne().hH(t),showMoveTo:o,resultsStore:void 0,collectionContextStore:t,pageVisitSource:de().y8.Create})}}),[t,S]),v=(0,r.useCallback)((e=>(0,Ge.jsx)(Bs,{store:o,format:n,disabled:i,collectionContextStore:t,schema:l,blockPropertyValueOverlayStore:a,isFullScreen:s,collectionGalleryViewStore:m,groupFormat:e,headerWidth:p,paddingLeft:c,paddingRight:d})),[o,n,i,t,l,a,s,m,p,c,d]),f=(0,r.useCallback)((e=>({})),[]);return(0,Ge.jsx)(Qs,{reducerId:Bn().X8,store:o,collectionContextStore:t,disabled:i,isFullScreen:s,isRootChild:u,paddingLeft:c,paddingRight:d,stickyLeft:!1,renderHeader:h,onGroupHeaderAddItem:y,renderGroupResults:v,getGroupStyle:f,headerWidth:p})})),zs=r.memo((function(e){const{collectionGroupHeaderProps:t}=e,o=(0,k().O$)(t.collectionContextStore.isInHomeWidgetStore),{stickyStyle:n}=(0,I().IS)((()=>({stickyStyle:{boxShadow:`0 -1px 0 ${K().Tj.background.primary}`}})),[]);return(0,Ge.jsx)(Sl,{...t,height:o?Fl().ag:48,stickyStyle:n})}));function Ls(e){const{width:t}=e,o=(0,x().v3)(),n=(0,k().K8)((()=>o.WindowSizeStore.state.width<=Fs),[o]),r=(0,I().IS)((()=>({container:{display:"flex",flexDirection:"column",alignItems:"flexStart",alignSelf:"stretch",paddingBottom:12,height:t},groupContainer:{display:"flex",height:46,alignItems:"center",alignSelf:"stretch"},itemsContainer:{display:"grid",position:"relative",gridTemplateColumns:`repeat(auto-fill, minmax(${n?"100%":`${t}px`}, 1fr))`,gap:16,paddingTop:1,paddingBottom:4,width:"100%",height:"100%"},iconContainer:{display:"flex",width:22,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},groupShimmer:{width:120,height:10,marginInlineStart:8,borderRadius:12,backgroundColor:K().Tj.background.tertiaryTranslucent}})),[t,n]);return(0,Ge.jsxs)("div",{style:r.container,children:[(0,Ge.jsxs)("div",{style:r.groupContainer,children:[(0,Ge.jsx)("div",{style:r.iconContainer,children:(0,Ge.jsx)(ke().I,{icon:Pl().U,size:"xxs",colorVariant:"tertiary"})}),(0,Ge.jsx)(zo().P,{style:r.groupShimmer})]}),(0,Ge.jsxs)("div",{style:r.itemsContainer,children:[(0,Ge.jsx)(_s,{}),(0,Ge.jsx)(_s,{}),(0,Ge.jsx)(_s,{})]})]})}function Ks(e){const{isFullScreen:t,galleryCoverSize:o}=e,n=t?2:1,r=(0,ne().rq)(o),i=W().Hn(n,(e=>(0,Ge.jsx)(Ls,{width:r},e)));return(0,Ge.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:i})}function Ws(){const e=(0,I().IS)((()=>({container:{padding:"8px 0px",width:"100%"},groupContainer:{display:"flex",height:36,paddingInlineEnd:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",paddingInlineStart:16,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},rowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch",borderBottom:`1px solid ${K().Tj.border.secondaryTranslucent}`},lastRowContainer:{display:"flex",alignItems:"flex-start",gap:1,alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:K().Tj.background.tertiaryTranslucent},circleShimmer:{width:16,height:16,flexShrink:0,borderRadius:12,backgroundColor:K().Tj.background.tertiaryTranslucent},rowShimmer:{width:100,height:10,flexShrink:0,borderRadius:12,backgroundColor:K().Tj.background.tertiaryTranslucent},rowShimmerShort:{width:60,height:10,flexShrink:0,borderRadius:12,backgroundColor:K().Tj.background.tertiaryTranslucent},rowShimmerLong:{width:200,height:10,flexShrink:0,borderRadius:12,backgroundColor:K().Tj.background.tertiaryTranslucent},firstColumn:{display:"flex",width:360,height:34,padding:"7px 8px",alignItems:"center",gap:6},column:{display:"flex",width:200,height:34,padding:"6px 8px",alignItems:"center",gap:6}})),[]);return(0,Ge.jsxs)("div",{style:e.container,children:[(0,Ge.jsxs)("div",{style:e.groupContainer,children:[(0,Ge.jsx)("div",{style:e.iconContainer,children:(0,Ge.jsx)(ke().I,{icon:Pl().U,size:"xxs",colorVariant:"tertiary"})}),(0,Ge.jsx)(zo().P,{style:e.groupShimmer})]}),(0,Ge.jsxs)("div",{style:e.rowsContainer,children:[(0,Ge.jsxs)("div",{style:e.rowContainer,children:[(0,Ge.jsxs)("div",{style:e.firstColumn,children:[(0,Ge.jsx)(zo().P,{style:e.circleShimmer}),(0,Ge.jsx)(zo().P,{style:e.rowShimmerShort})]}),(0,Ge.jsx)("div",{style:e.column,children:(0,Ge.jsx)(zo().P,{style:e.rowShimmerShort})}),(0,Ge.jsx)("div",{style:e.column,children:(0,Ge.jsx)(zo().P,{style:e.rowShimmerShort})}),(0,Ge.jsx)("div",{style:e.column,children:(0,Ge.jsx)(zo().P,{style:e.rowShimmerShort})})]}),(0,Ge.jsxs)("div",{style:e.rowContainer,children:[(0,Ge.jsxs)("div",{style:e.firstColumn,children:[(0,Ge.jsx)(zo().P,{style:e.circleShimmer}),(0,Ge.jsx)(zo().P,{style:e.rowShimmerLong})]}),(0,Ge.jsx)("div",{style:e.column,children:(0,Ge.jsx)(zo().P,{style:e.rowShimmer})}),(0,Ge.jsx)("div",{style:e.column,children:(0,Ge.jsx)(zo().P,{style:e.rowShimmer})}),(0,Ge.jsx)("div",{style:e.column,children:(0,Ge.jsx)(zo().P,{style:e.rowShimmer})})]}),(0,Ge.jsxs)("div",{style:e.lastRowContainer,children:[(0,Ge.jsxs)("div",{style:e.firstColumn,children:[(0,Ge.jsx)(zo().P,{style:e.circleShimmer}),(0,Ge.jsx)(zo().P,{style:e.rowShimmerLong})]}),(0,Ge.jsx)("div",{style:e.column,children:(0,Ge.jsx)(zo().P,{style:e.rowShimmer})}),(0,Ge.jsx)("div",{style:e.column,children:(0,Ge.jsx)(zo().P,{style:e.rowShimmer})}),(0,Ge.jsx)("div",{style:e.column,children:(0,Ge.jsx)(zo().P,{style:e.rowShimmer})})]})]})]})}function Hs(e){const{isFullScreen:t}=e,o=t?2:1,n=W().Hn(o,(e=>(0,Ge.jsx)(Ws,{},e)));return(0,Ge.jsx)("div",{style:{display:"flex",paddingTop:8,paddingInlineStart:4,flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch",width:"100%"},children:n})}function Ns(){const e=(0,I().IS)((()=>({rowsContainer:{paddingTop:8},rowContainer:{display:"flex",height:28,alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0"},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginInlineStart:12,backgroundColor:K().Tj.background.tertiaryTranslucent},rowShimmerShort:{width:"50%",height:10,flexShrink:0,borderRadius:12,marginInlineStart:12,backgroundColor:K().Tj.background.tertiaryTranslucent}})),[]);return(0,Ge.jsxs)("div",{style:e.rowsContainer,children:[(0,Ge.jsx)("div",{style:e.rowContainer,children:(0,Ge.jsx)(zo().P,{style:e.rowShimmerShort})}),(0,Ge.jsx)("div",{style:e.rowContainer,children:(0,Ge.jsx)(zo().P,{style:e.rowShimmer})})]})}var Gs=()=>o(387034);function $s(){const e=(0,I().IS)((()=>({container:{display:"flex",padding:"8px 0px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},groupContainer:{display:"flex",height:36,paddingInlineEnd:0,alignItems:"center",alignSelf:"stretch",gap:8},rowsContainer:{display:"flex",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},iconContainer:{display:"flex",width:16,height:16,flexDirection:"column",justifyContent:"center",alignItems:"center",gap:10},groupShimmer:{width:120,height:10,borderRadius:12,backgroundColor:K().Tj.background.tertiaryTranslucent}})),[]),t=(0,_t().Ks)(),o=(0,k().K8)((()=>null==t?void 0:t.isInHomeWidgetStore.state),[t]),n=["50%","30%","40%"].map(((e,t)=>(0,Ge.jsx)(Gs().J,{widthPercentage:e,isInHomeWidget:o},t)));return(0,Ge.jsxs)("div",{style:e.container,children:[(0,Ge.jsxs)("div",{style:e.groupContainer,children:[(0,Ge.jsx)("div",{style:e.iconContainer,children:(0,Ge.jsx)(ke().I,{icon:Pl().U,size:"xxs",colorVariant:"tertiary"})}),(0,Ge.jsx)(zo().P,{style:e.groupShimmer})]}),(0,Ge.jsx)("div",{style:e.rowsContainer,children:n})]})}function Us(e){const{isFullScreen:t}=e,o=t?2:1,n=W().Hn(o,(e=>(0,Ge.jsx)($s,{},e)));return(0,Ge.jsx)("div",{style:{display:"flex",padding:"8px 4px",flexDirection:"column",alignItems:"flex-start",alignSelf:"stretch"},children:n})}function qs(e){const{viewType:t,isFullScreen:o,galleryCoverSize:n}=e;if(!(0,Ml().A)(!0,0,100))return null;switch(t){case"table":return(0,Ge.jsx)(Hs,{isFullScreen:o});case"list":return(0,Ge.jsx)(Us,{isFullScreen:o});case"gallery":return(0,Ge.jsx)(Ks,{isFullScreen:o,galleryCoverSize:n});case"timeline":return(0,Ge.jsx)(Ns,{});default:return null}}const Xs=new Set(["dropzone","table"]),Ys=new Set(["item","table"]),Qs=r.memo((function(e){const{collectionContextStore:t,disabled:n,getGroupStyle:i,headerWidth:l,isFullScreen:a,isRootChild:s,onGroupHeaderAddItem:c,paddingLeft:d,paddingRight:p,reducerId:m,renderGroupResults:S,renderHeader:h,stickyLeft:y,store:v,timelineType:f}=e,b=(0,k().O$)(t.isInPeekRendererStore),x=(0,k().K8)((()=>{var e;return null===(e=t.collectionViewStore())||void 0===e?void 0:e.getType()}),[t]),w=(0,k().O$)(t.permissionScopesStore),C=(0,k().O$)(t.normalizedFormatStore),T=null==C?void 0:C.collection_group_by,j=null==C?void 0:C.board_columns_by,A=(0,k().O$)(t.groupsLimitStore),M=(0,k().O$)(t.normalizedSchemaStore),P=(0,k().K8)((()=>t.normalizedQueryStore.state??{}),[t.normalizedQueryStore]),_=(0,k().K8)((()=>{if("board"===x&&T&&j)return;if(!T||!C)return;if(f&&Xs.has(f))return;const e=di({collectionContextStore:t,isMobile:g().A.isMobile,groupBy:T});return(0,Rn().p)({groupBy:T,schema:M,format:C,groupsFormatKey:Vn().V1,limit:A,aggregation:C.collection_group_aggregation,blockResults:e})}),[x,T,j,C,f,t,M,A],{useDeepEqual:!0}),R=(0,k().uB)(e.groupsResultStore,qr),B=(0,k().O$)(R),V=(0,Qr().d)("board"===x?{subGroupBy:T,reducerResult:B}:{groupBy:T,reducerResult:B}),F=(0,k().K8)((()=>!(f&&Ys.has(f))&&(0,Yr().c_)({collectionContextStore:t,displayState:V})),[t,V,f]),E=(0,In().X)(t),O=(0,k().K8)((()=>{if(!E)return 0;let e=0;for(const o of V.visibleGroups){const n=t.groupsStore.getGroupState([o]);if(n&&(e+=n.resultsStore.state.length,e>5))return e}return e}),[E,t,V]),D=E&&O>0&&O<=5,z=(0,k().K8)((()=>D?u().default.getEligibleGroup({experimentId:"ai_meeting_notes_meetings_tab_limited_state",defaultGroup:"control",disableExposureLogging:!1}):"control"),[D]),L=D&&"v1"===z,K=(0,k().K8)((()=>{const{visibleGroups:e}=V;return 0===e.length&&!t.shouldShowSpinnerStore.state||e.length>0}),[t,V]),W=(0,k().K8)((()=>(0,ci().Zl)(V,t,!1)),[V,t]),H=(0,k().K8)((()=>!n&&!w.isLocked&&w.canConfigureBlock&&!F&&T&&(0,Vn().pP)(T,w.canConfigureCollection)&&"collectionTypedView"!==t.contextTypeFromStoreState&&!(0,o(443239).u)(T.property)&&K),[K,t,w.canConfigureBlock,w.canConfigureCollection,w.isLocked,n,T,F]),N=(0,k().K8)((()=>u().default.getConfigKey("collection_reducer_request_settings","general_debounce_wait_ms")),[]),G=(0,k().O$)(t.isInHomeWidgetStore),$=(0,I().IS)((()=>({container:{display:"flex",flexDirection:"column",gap:"list"===x?g().A.isMobile?0:G?8:16:void 0},buttonWrapper:{display:"flex",flexDirection:Boolean(f)?"column":"row",marginTop:"board"===x?-12:void 0,marginBottom:8,gap:5,position:"sticky",insetInlineStart:d?d+2:0,width:"fit-content"}})),[d,f,x,G]),U=!("board"===x||"dropzone"===f||"item"===f)&&!F&&0===V.visibleGroups.length&&0===V.pinnedGroups.groups.length,q=(0,r.useCallback)((()=>U?(0,Ge.jsx)(Hr,{collectionContextStore:t,paddingLeft:d,paddingRight:p,headerWidth:l}):(0,Ge.jsxs)(Ge.Fragment,{children:[L?(0,Ge.jsx)(Jr,{}):void 0,(0,Ge.jsx)("div",{style:$.container,children:T?V.visibleGroups.map(((e,o)=>(0,Ge.jsx)(xl,{collectionContextStore:t,groupsDisplayState:V,groupFormat:e,groupBy:T,groupsResultStore:R,disabled:n,groupsFormatKey:Vn().V1,groupAggregationKey:Vn().FJ,format:C,schema:M,query:P,isInPeekRenderer:b,isFullScreen:a,isRootChild:s,paddingLeft:d,stickyLeft:y,renderGroupResults:S,renderHeader:h,onGroupHeaderAddItem:c,getGroupStyle:i,index:o,isLast:o===V.visibleGroups.length-1},(0,Vn().Ix)(e)))):void 0}),F?(0,Ge.jsx)(qs,{viewType:x,isFullScreen:a,galleryCoverSize:C.gallery_cover_size}):void 0,(0,Ge.jsxs)("div",{style:$.buttonWrapper,children:[W?(0,Ge.jsx)(Zs,{timelineType:f,collectionContextStore:t,format:C,isFullScreen:a,isRootChild:s,paddingLeft:d,stickyLeft:y}):void 0,H?(0,Ge.jsx)(Js,{timelineType:f,store:v,collectionContextStore:t,schema:M,format:C,isFullScreen:a,isRootChild:s,paddingLeft:d,groupsDisplayState:V,groupBy:T}):void 0]})]})),[t,n,C,i,T,V,R,l,a,b,s,c,d,p,P,S,h,M,L,H,U,W,F,y,v,$.buttonWrapper,$.container,f,x]);return C?_?(0,Ge.jsx)(Xr().A,{id:m,reducer:_,collectionContextStore:t,resultStore:R,render:q,debounceWait:N}):q():null}),Fn().A);function Zs(e){const{collectionContextStore:t,timelineType:o,format:n,isFullScreen:r,isRootChild:i,paddingLeft:l,stickyLeft:a}=e,s=(0,I().IS)((()=>({container:{display:"flex"},loadMoreButton:a?{position:"sticky",insetInlineStart:l}:{}})),[l,a]);return"dropzone"===o?null:"item"===o?(0,Ge.jsx)(Al,{type:"default",collectionContextStore:t,groupsLimitStore:t.groupsLimitStore,format:n,isFullScreen:r,isRootChild:i,paddingLeft:l}):(0,Ge.jsx)("div",{style:s.container,children:(0,Ge.jsx)(Il,{type:"default",collectionContextStore:t,groupsLimitStore:t.groupsLimitStore,style:s.loadMoreButton})})}function Js(e){const{collectionContextStore:t,format:o,groupBy:n,groupsDisplayState:i,isFullScreen:l,isRootChild:a,paddingLeft:s,schema:c,store:d,timelineType:u}=e,p=(0,x().v3)(),g=(0,r.useCallback)((e=>{if(!n)return;const o=t.collectionStore();o&&si({update:e,collectionContextStore:t,groupsFormatKey:Vn().V1,collectionStore:o,environment:p,groupBy:n,schema:c})}),[t,p,n,c]);return n?"dropzone"===u?null:"item"===u?(0,Ge.jsx)(jl,{groupFormatKey:"collection_groups",collectionContextStore:t,parentStore:d,groupsLimitStore:t.groupsLimitStore,groupBy:n,currentGroups:i.currentGroups,schema:c,format:o,paddingLeft:s,isFullScreen:l,isRootChild:a,onAccept:g}):(0,Ge.jsx)(vi,{groupFormatKey:"collection_groups",collectionContextStore:t,parentStore:d,groupsLimitStore:t.groupsLimitStore,groupBy:n,currentGroups:i.currentGroups,schema:c,onAccept:g}):null}var ec=()=>o(312296),tc=()=>o(271205);function oc(e){return(0,ne().rq)(e.board_cover_size)}function nc(e){const{disableBoardColorColumns:t,isInHomeWidget:o,isMobile:n}=e;if(o)return 0;return(t?4:8)+(n?12:0)}function rc(e){const{displayState:t,format:o,permissionScopes:n}=e,{visibleGroups:r}=t,i=o.board_columns_by;return!!i&&(0!==r.length&&(n.canConfigureBlock&&!n.isSyncedCollection&&(0,Vn().pP)(i,n.canConfigureCollection)))}const ic=r.memo((function({format:e,schema:t,collectionContextStore:o,store:n,currentGroups:r,disabled:i}){const l=(0,x().v3)(),a=(0,k().K8)((()=>o.contextTypeFromStoreState),[o]);return e.board_columns_by?"collectionTypedView"===a?null:(0,Ge.jsx)(vi,{groupFormatKey:"board_columns",groupBy:e.board_columns_by,schema:t,currentGroups:r,onAccept:n=>function(e){const{update:t,collectionContextStore:o,schema:n,format:r,environment:i}=e,l=o.collectionStore();if(!l)return;const a=r.board_columns_by;if(!a)return;si({update:t,collectionContextStore:o,groupsFormatKey:"board_columns",collectionStore:l,schema:n,groupBy:a,environment:i})}({update:n,collectionContextStore:o,schema:t,format:e,environment:l}),groupsLimitStore:o.boardColumnsLimitStore,parentStore:n,collectionContextStore:o,style:{marginInlineStart:0}}):null}));const lc=r.memo((function(e){const{render:t,collectionContextStore:o,groupsResultStore:n,groupsReducer:r}=e;return r?(0,Ge.jsx)(Xr().A,{id:Bn().rx,reducer:r,collectionContextStore:o,resultStore:n,render:t}):(0,Ge.jsx)(Ge.Fragment,{children:t()})}));var ac=()=>o(615927);const sc=r.memo((function(e){const{collectionContextStore:t,isFullScreen:o,paddingLeft:n,paddingRight:i,paddingBottom:l}=e,a=(0,k().O$)(t.canConfigureBlockStore),s=t.settingsStore,c=(0,r.useCallback)((()=>{(0,J().O)({collectionContextStore:t,collectionSettingsStore:s}),Q().a2({collectionSettingsStore:s,item:{type:"properties",timelineViewTab:"table"}})}),[t,s]);return(0,Ge.jsx)(ac().Ay,{title:(0,Ge.jsx)(Le().sA,{defaultMessage:"No group by property",id:"database.boardView.missingSelectPropertyTitle"}),description:a?(0,Ge.jsx)(Le().sA,{defaultMessage:"<opensettingslink>Add a property to group by</opensettingslink> to your database in order to display a Board view.",id:"database.boardView.missingSelectProperty",values:{opensettingslink:e=>(0,Ge.jsx)(ac().P6,{onClick:c,children:e})}}):(0,Ge.jsx)(Le().sA,{defaultMessage:"Board views require a property to group by in order to display.",id:"database.boardView.missingSelectPropertyNoPermissions"}),style:{paddingInlineStart:n,paddingInlineEnd:i,paddingBottom:o?void 0:l}})}));function cc(e){var t;const{transaction:o,environment:n,collectionContextStore:r,isFullScreen:i,groupsPointer:l,insertAtIndex:a,from:s,transient:c}=e,d=null===(t=r.groupsStore.getGroupState(l))||void 0===t?void 0:t.resultsStore;if(!d)return;r.searchQueryStore.state&&(0,Cr().S)({searchQuery:"",collectionContextStore:r,isFullScreen:i});const u=(0,Xn().Q)({environment:n,collectionContextStore:r,groupsPointer:l,insertAtIndex:a,shouldCoerce:!0,templateStore:r.defaultPageTemplateStore.state,transaction:o,from:{createBlock:s},inMemoryRecordCache:n.defaultRecordCache.inMemoryRecordCache});if(!u)return;const p=u.coercionSucceeded,m=u.newStore;if(g().A.isMobile)(0,El().u)({environment:n,store:m,pageVisitSource:de().y8.Create});else if(p){const e=m.getBlockTitleStore();(0,Ba().h)({environment:n,store:m}),(0,Fa().z)({store:e}),(0,Ta().C)({store:m,transient:c})}else{const e="collectionTypedView"===r.contextTypeFromStoreState;(0,Kr().V)({environment:n,store:m,peekMode:(0,ne().hH)(r),showMoveTo:e,resultsStore:d,collectionContextStore:r,pageVisitSource:de().y8.Create})}$n().vH(n,{from:s,type:"page",new_page_id:m.id,creating_block_id:m.id,...(0,Lt().sl)(r)})}const dc=r.memo((function(e){const{collectionContextStore:t,textColor:o,hoverColor:n,groupsPointer:i,isFullScreen:l,shouldShowSpinner:a}=e,c=(0,k().K8)((()=>t.collectionStore()),[t]),d=(0,x().v3)(),u=(0,I().eP)(),p=(0,I().IS)((()=>{const e=o||K().Tj.text.tertiary,{fontSize:t}=Pa({isMobile:g().A.isMobile});return{addItemButton:{width:"100%",color:e,borderRadius:kl,boxShadow:uc({themeMode:u,color:o}),paddingInlineStart:Cs().w_,paddingInlineEnd:Cs().w_,minHeight:(0,ne().rU)({isMobile:g().A.isMobile}),fontSize:t,gap:9},addItemButtonHover:{background:n},spinner:{marginTop:0,marginInlineEnd:0,marginBottom:0,marginInlineStart:"auto"}}}),[o,n,u]),m=(0,r.useCallback)((()=>{const e=(0,s().f)(c);(0,co().E)(d,e)?et().createAndCommit({userAction:"BoardGroupAddItemButton.handleClick",environment:d,canUndo:!0,perform:e=>{cc({transaction:e,environment:d,collectionContextStore:t,isFullScreen:l,groupsPointer:i,from:"board_group_add_item_bottom",transient:!1})}}):(0,za().Q)(d,e)}),[t,d,i,l,c]);return(0,Ge.jsxs)(Fr().p,{iconLeading:{icon:Ho().plusSmallIcon,size:g().A.isMobile?"default":"sm",style:{marginInlineStart:2}},colorVariant:"tertiary",size:"lg",style:p.addItemButton,hoveredStyle:p.addItemButtonHover,onClick:m,onMouseDown:Ti().t,children:[(0,Ge.jsx)(Oa().w,{collectionContextStore:t}),a?(0,Ge.jsx)("div",{style:p.spinner,children:(0,Ge.jsx)(Xi().A,{size:"sm"})}):null]})}));function uc(e){const{themeMode:t,color:o}=e,n=function(e,t){if(void 0===e)return"";try{return(0,ts().X4)(e,t)}catch(o){return""}}(o,.1);return""!==n?`${n} 0px 0px 0px 1px`:"dark"===t?`${K().IF.whiteWithAlpha(.05)} 0px 0px 0px 1px`:`${K().Tj.border.secondaryTranslucent} 0px 0px 0px 1px`}const pc=r.memo((function(e){const{color:t,collectionContextStore:o,groupFormat:n,isHovered:i}=e,l=(0,I().IS)((()=>{const e=t||K().Tj.text.tertiary,{fontSize:o}=Pa({isMobile:g().A.isMobile});return{linkButton:{visibility:i?"visible":"hidden",marginTop:8,width:"100%",color:e,borderRadius:kl,paddingTop:12,paddingInlineEnd:16,paddingBottom:12,paddingInlineStart:16,fontSize:o}}}),[t,i]),a=(0,r.useCallback)((e=>(0,Ge.jsx)(Fr().p,{iconLeading:{icon:_e().arrowDiagonalUpRightIcon,size:g().A.isMobile?"default":"sm"},colorVariant:"tertiary",size:"lg",style:l.linkButton,...e,children:(0,Ge.jsx)(Le().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})})),[l.linkButton]);return(0,Ge.jsx)(kr().O,{collectionContextStore:o,groupFormat:n,renderLinkButton:a})})),gc=r.memo((function(e){const{blockPropertyValueOverlayStore:t,blockResizerStore:o,bulletedListFormatStore:n,collectionContextStore:r,colorStyle:i,coverAspectFormat:l,coverFormat:a,coverSizeFormat:s,disableCommentMenu:c,disabled:d,disableDrag:u,disableHoverMenu:p,handleOpenPeekPage:g,hideContent:m,isFirstItem:S,isLastItem:h,isQuickFind:y,numberedListCounterStore:v,onShiftEnter:f,onTextEnter:b,onTextEsc:x,store:w,style:C}=e;return(0,Ge.jsx)(As,{blockPropertyValueOverlayStore:t,blockResizerStore:o,bulletedListFormatStore:n,collectionContextStore:r,colorStyle:i,coverAspectFormat:l,coverFormat:a,coverHeight:void 0,coverSizeFormat:s,coverWidth:void 0,disableCommentMenu:c,disabled:d,disableDrag:u,disableHoverMenu:p,handleOpenPeekPage:g,hideContent:m,isFirstItem:S,isLastItem:h,isQuickFind:y,numberedListCounterStore:v,onShiftEnter:f,onTextEnter:b,onTextEsc:x,store:w,style:C})}),Fn().A);function mc(e){const t=e.minHeight||Es,o=(0,I().IS)((()=>({card:{display:"flex",justifyContent:"center",alignItems:"flex-start",alignSelf:"stretch",borderRadius:kl,backgroundColor:K().Tj.largeShimmerColor,minHeight:t,width:"100%",marginBottom:4}})),[t]);return(0,Ge.jsx)(zo().P,{style:o.card})}function Sc(){return(0,Ml().A)(!0,0,100)?(0,Ge.jsx)(mc,{}):null}const hc=r.memo((function(e){const{groupsPointer:t,schema:o,format:n,collectionContextStore:i,store:l,disabled:a,blockPropertyValueOverlayStore:c,isFullScreen:d,anyGroupHasResults:u,hoveredGroupStore:p,paddingLeft:m,paddingRight:S,headerWidth:h}=e,v=(0,I().DP)(),f=(0,x().v3)(),b=(0,Le().tz)(),w=(0,k().K8)((()=>{const e=t.at(-1);return(0,ci().$e)({environment:f,groupFormat:e,schema:o,format:n,theme:v})}),[t,o,n,f,v]),C=(0,k().K8)((()=>{const e=i.groupsStore.getGroupState(t);return Boolean(null==e?void 0:e.reducerResultStore.state)}),[t,i]),T=(0,k().K8)((()=>i.groupsStore.getGroupState(t)),[i,t]),j=(0,k().K8)((()=>(0,ne().mM)(i,d)),[i,d]),A=(0,k().K8)((()=>null==T?void 0:T.reducerResultStore.state),[T]),M=(0,k().K8)((()=>i.permissionScopesStore.state.isSyncedCollection),[i.permissionScopesStore]),P=(0,k().O$)(i.isInHomeWidgetStore),_=(0,wi().V)(i),R=(0,k().K8)((()=>(!a||_)&&C&&i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!P})),[a,C,i,P,_]),B=(0,k().K8)((()=>(0,ne().XQ)({reducerResult:A,collectionContextStore:i,isFullScreen:d})),[A,i,d]),V=(0,k().K8)((()=>(0,Yr().iv)({collectionContextStore:i,groupsPointer:t,hasPartialResults:u})),[i,t,u]),F=(0,k().K8)((()=>u&&i.shouldShowSpinnerStore.state&&"load_general"===i.loadingDetailsStore.state.type),[i,u]),E=(0,k().K8)((()=>(0,ne().fG)({collectionContextStore:i,environment:f,intl:b})),[f,i,b]),O=(0,k().K8)((()=>g().A.isMobile||(0,Vn().Mn)(p.state,t.at(-1))),[p,t]),D=(0,r.useCallback)((e=>{const{target:t}=e;!g().A.isMobile&&t instanceof HTMLElement&&(0,y().SQ)(e,y().y$.EditorMouseDown,(()=>{e.preventDefault(),(0,to().j)({environment:f,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}))}),[f]),z=(0,r.useCallback)((()=>{const e=t.at(-1);e&&p.state!==e&&p.setState(e)}),[t,p]),L=(0,I().IS)((()=>{const e=Boolean(n.collection_group_by);return{container:{flex:"none",paddingInlineStart:8,paddingInlineEnd:8,paddingBottom:8,marginInlineEnd:12,marginBottom:16,boxSizing:"content-box",width:fc(n),height:e?void 0:"max-content",...w&&C&&{backgroundColor:w.backgroundColor,...e?{borderRadius:kl}:{borderEndStartRadius:kl,borderEndEndRadius:kl}}},loadMoreButton:{borderRadius:kl,fontSize:g().A.isMobile?16:14,paddingTop:5,paddingInlineEnd:4,paddingBottom:5,paddingInlineStart:11,height:void 0},loadMoreButtonIcon:{width:g().A.isMobile?16:14,height:g().A.isMobile?16:14}}}),[w,n,C]),W=function(e){return e?e.board_cover:void 0}(n),H=(0,r.useMemo)((()=>({format:n,schema:o,onTextEnter:e=>function(e,t,o,n,r,i){if(!(0,co().E)(i,(0,s().f)(o.collectionStore()))||!o.collectionStore())return Cc(e,o,r,t,i);const l=bc(t,o);if(!l)return;const a=l.state.findIndex((t=>t===e))+1;et().createAndCommit({userAction:"BoardGroupResults.handleItemTextEnter",environment:i,canUndo:!0,perform:e=>{cc({transaction:e,environment:i,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:a,from:"board_group_enter_add_item",transient:!0})}})}(e,t,i,d,l,f),onShiftEnter:e=>wc(e,t,i,d,f),coverFormat:W,coverAspectFormat:yc(n),coverSizeFormat:vc(n),colorStyle:w,onTextEsc:e=>Cc(e,i,l,t,f),disabled:a,blockPropertyValueOverlayStore:c,collectionContextStore:i})),[c,i,w,W,a,f,n,t,d,o,l]);if(!T)return null;const N=!a&&!M,G=Boolean(n.collection_group_by),$=!u&&G&&V;return(0,Ge.jsxs)("div",{className:fn().mVR,style:L.container,onMouseDown:D,onClick:xc,onMouseMove:z,children:[(0,Ge.jsx)(fa,{collectionContextStore:i,groupsPointer:t,format:n,canDrag:N,paddingLeft:m,paddingRight:S,headerWidth:h,shouldShowShimmer:$,onSelectableEnter:e=>wc(e,t,i,d,f),itemProps:H,canDrop:!0,renderItem:gc,disabled:a,direction:ya.Vertical,shouldShowHoverMenu:!1,belowDropZoneMargin:2,emptyDroppableSize:G?8:3,analyticsName:"board",loadContentCover:W&&"page_content"===W.type}),$?(0,Ge.jsx)(Sc,{}):null,B?(0,Ge.jsx)(zl().jJ,{groupsPointer:t,store:l,collectionContextStore:i,format:n,isFullScreen:d,incrementLimitsInRelatedGroups:!0,style:L.loadMoreButton,iconStyle:L.loadMoreButtonIcon}):null,R?(0,Ge.jsxs)(Ge.Fragment,{children:[B?(0,Ge.jsx)("div",{style:{width:"100%",borderTop:`1px solid ${K().Tj.border.primary}`,marginTop:4,marginBottom:4}}):void 0,(0,Ge.jsx)(dc,{groupsPointer:t,collectionContextStore:i,isFullScreen:d,textColor:null==w?void 0:w.textColor,hoverColor:null==w?void 0:w.cardHoveredBackgroundColor,shouldShowSpinner:F})]}):void 0,E?(0,Ge.jsx)(pc,{groupFormat:t.at(-1),collectionContextStore:i,color:null==w?void 0:w.textColor,isHovered:O}):void 0,j?void 0:(0,Ge.jsx)(Bl().A,{onChange:e=>function(e,t,o,n,r){const i=t.isLoadingStore.state,l=t.groupsStore.getGroupState(n),a=null==l?void 0:l.reducerResultStore.state;e<Mo().B.incrementScrollOffset&&!i&&a&&a.hasMore&&((0,Vl().H)({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:o,currentResultCount:a.blockIds.length,groupsPointer:n,incrementLimitsInRelatedGroups:!1}}),t.loadingDetailsStore.setState({type:"load_general"}))}(e,i,d,t,f)})]})}));function yc(e){return e?e.board_cover_aspect:void 0}function vc(e){return e?e.board_cover_size:void 0}function fc(e){const t=e.board_cover_size;return(0,ne().rq)(t)}function bc(e,t){const o=t.groupsStore.getGroupState(e);return null==o?void 0:o.resultsStore}function xc(e){(0,y().SQ)(e,y().y$.Click,(()=>{}))}function wc(e,t,o,n,r){const{blocks:i,transaction:l}=e;if(0===i.length)return;const a=i[0];if(!(0,co().E)(r,(0,s().f)(o.collectionStore()))||!o.collectionStore()||!o.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const c=bc(t,o);if(!c)return;cc({transaction:l,environment:r,collectionContextStore:o,isFullScreen:n,groupsPointer:t,insertAtIndex:c.state.findIndex((e=>e===a))+1,from:"board_group_enter_add_item",transient:!0})}function Cc(e,t,o,n,r){const l=t.collectionStore(),a=e.getTitleStore();if(!a)return;if((0,L().q4_)(a.getValue()))(0,Va().L)({environment:r,store:e});else if(l){const l=bc(n,t);if(!l)return;const a=l.state.findIndex((t=>t===e))-1,s=t.collectionViewStore(),c=t.collectionViewBlockStore();if(s&&c&&function(e,t){(0,i().DO_NOT_USE_trackLegacy)(e,"board_item_delete_newly_created",t)}(r,{...(0,Lt().sl)(t),block_id:o.id}),et().createAndCommit({userAction:"BoardGroupResults.handleItemTextEsc",environment:r,canUndo:!0,perform:t=>{ir().by({childStore:e,transaction:t})}}),a>=0){const e=l.state[a];(0,Va().L)({environment:r,store:e})}}}function kc(e){const{height:t,boardCoverSize:o,showGroupHeader:n,areColumnsColored:r,disableBoardColorColumns:i,isInHomeWidget:l,numBoardColumns:a=3}=e,s=(0,I().IS)((()=>({container:{display:"flex",alignItems:"flex-start",paddingTop:nc({disableBoardColorColumns:i,isMobile:g().A.isMobile,isInHomeWidget:l})},groupHeader:{backgroundColor:K().Tj.largeShimmerColor,height:16,marginBottom:10,borderRadius:12,width:"50%",opacity:n?1:0},group:{marginTop:r?20:12,marginInlineEnd:10,width:"100%",minWidth:(0,ne().rq)(o)+16}})),[r,o,i,l,n]);return(0,Ge.jsx)("div",{style:s.container,children:Array.from({length:a},((e,o)=>(0,Ge.jsxs)("div",{style:s.group,children:[(0,Ge.jsx)(zo().P,{style:s.groupHeader}),(0,Ge.jsx)(mc,{minHeight:t})]},o)))})}const Ic=r.memo((function(e){const{selectedAggregation:t,parent:o,onChange:n,collectionContextStore:i,schema:l}=e,a=(0,x().v3)(),s=g().A.isMobile?{menuType:Te().gu.Modal,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"Aggregation",id:"database.mobileBoardAggregationMenu.title"}),right:(0,Ge.jsx)(Le().sA,{...xe().W.done}),onClickRight:o.close}:{menuType:Te().gu.Popup,width:200},{sections:c,initialFocus:d}=(0,r.useMemo)((()=>{const{actions:e,initialFocus:o}=function(e,t,o,n,r){const i=[];let l=0,a=0;const s=function(e,t,o,n,r){const i={};for(const a of qi().VD)i[a]=Pc(e.aggregator===a,e.enforceMaxAggregationLimit??!1,a,o,n,t);const l=Object.keys(r).filter((e=>{const t=r[e];return t&&(0,qi().wG)(t)&&!("rollup"===t.type&&"status"===t.target_property_type)}));if(l.length>0)for(const a of qi().CG)"show_unique"!==a&&(i[a]=Mc(e,a,l,t,r,o,n));return jc.forEach((({supportCheck:l,aggregationTypes:a})=>{const s=Object.keys(r).filter((e=>{const t=r[e];return t&&l(t)}));if(s.length>0)for(const c of a)i[c]=Mc(e,c,s,t,r,o,n)})),i}(e,t,o,n,r);let c=0;return Object.entries(qi().Kn).forEach((([t,n])=>{const r=[];for(const o of n)s[o]&&(r.push(s[o]),e.aggregator===o&&(l=c,a=r.length-1));const d=[];if("count_aggregations"===t&&d.push({key:"limitToggleSection",render:e=>(0,Ge.jsx)(Pe().A,{...e}),items:[Ac(e,o)]}),d.push({key:"aggregations",render:e=>(0,Ge.jsx)(Pe().A,{topBorder:!0,...e}),items:r}),r.length>0){c++;const e=el().jA[t],o={key:e,render:(t,o)=>(0,Ge.jsx)(tl().A,{...t,disableDefaultClick:!0,onFocus:o.onFocus,renderOrigin:(t,o)=>(0,Ge.jsx)(Ae().A,{...t,ref:o,title:e}),renderExtension:(t,n)=>{let r;return r=g().A.isMobile?{menuType:Te().gu.Modal,title:e,right:(0,Ge.jsx)(Le().sA,{...xe().W.done}),onClickRight:n.close,...t}:{menuType:Te().gu.Popup,width:250,...t},(0,Ge.jsx)(je().A,{...r,children:(0,Ge.jsx)(Me().A,{type:Me().O.Vertical,initialFocus:a,sections:d,onAccept:(e,t,r)=>{"aggregationLimitToggle"!==e.key&&(n.close(),o.onAccept&&o.onAccept(e,t,r))}})})}}),action:()=>null};i.push(o)}})),{actions:i,initialFocus:l}}(t,a,n,i,l);return{sections:[{key:"aggregation section",render:e=>(0,Ge.jsx)(Pe().A,{...e}),items:e}],initialFocus:o}}),[i,a,n,l,t]);return(0,Ge.jsx)(je().A,{...s,children:(0,Ge.jsx)(Me().A,{type:Me().O.Vertical,initialFocus:d,sections:c,onAccept:o.close})})})),Tc=r.memo((function(e){const{aggregationType:t,isSelected:o,label:n,innerProps:i}=e,l=el().cx[t],a=(0,I().IS)((()=>({container:{width:140,whiteSpace:"normal"},image:{borderRadius:6,width:140,marginTop:4}})),[]),s=(0,r.useCallback)((e=>(0,Ge.jsx)(Ae().A,{title:n,isChecked:o,...(0,$i().A)(e,i)})),[o,i,n]),c=(0,r.useCallback)((()=>(0,Ge.jsxs)("div",{style:a.container,children:[l?(0,Ge.jsx)("img",{src:(0,ol().L)(l),style:a.image}):void 0,el().fp[t]]})),[l,a.container,a.image,t]);return(0,Ge.jsx)(Wo().m,{placement:"right",delayThreshold:0,render:s,renderTooltip:c})}));const jc=[{supportCheck:qi().OC,aggregationTypes:qi().Sn},{supportCheck:qi().fo,aggregationTypes:qi().zE},{supportCheck:qi().s_,aggregationTypes:Ui().QO}];function Ac(e,t){const{enforceMaxAggregationLimit:o,disabled:n}=(0,el().NT)(e),r={...e,enforceMaxAggregationLimit:!o};return{key:"aggregationLimitToggle",render:e=>(0,Ge.jsx)(Zi().A,{on:o,disabled:n,menuListItemProps:e}),action:()=>{t(r)}}}function Mc(e,t,o,n,r,i,l){const a=el().zY[t],s=W().oE(o.map((o=>function(e,t,o,n,r,i,l,a){const s=r[t];if(!s)return;const c=s.name;return{key:`${t}${o}`,render:t=>(0,Ge.jsx)(Tc,{isSelected:e,aggregationType:o,label:c,innerProps:t}),action:()=>{_c({aggregator:o,property:t,enforceMaxAggregationLimit:n},i,l,a)}}}((null==e?void 0:e.aggregator)===t&&(null==e?void 0:e.property)===o,o,t,!(!e.enforceMaxAggregationLimit||!(0,qi().AS)(t))&&e.enforceMaxAggregationLimit,r,i,l,n)))),c=s.findIndex((o=>o.key===`${e.property}${t}`));return{key:`${t}${a}`,render:(e,t)=>(0,Ge.jsx)(tl().A,{...e,onFocus:t.onFocus,renderOrigin:(e,t)=>(0,Ge.jsx)(Ae().A,{...e,ref:t,title:a}),renderExtension:(e,o)=>{let n;return n=g().A.isMobile?{menuType:Te().gu.Modal,title:a,right:(0,Ge.jsx)(Le().sA,{...xe().W.done}),onClickRight:o.close,...e}:{menuType:Te().gu.Popup,width:200,...e},(0,Ge.jsx)(je().A,{...n,children:(0,Ge.jsx)(Me().A,{type:Me().O.Vertical,initialFocus:c,sections:[{key:"results",render:e=>(0,Ge.jsx)(Pe().A,{...e}),items:s}],onAccept:(e,n,r)=>{o.close(),t.onAccept&&t.onAccept(e,n,r)}})})}}),action:()=>null}}function Pc(e,t,o,n,r,i){const l=el().zY[o];return{key:o,render:t=>(0,Ge.jsx)(Tc,{isSelected:e,aggregationType:o,label:l,innerProps:t}),action:()=>{_c({aggregator:o,enforceMaxAggregationLimit:t},n,r,i)}}}function _c(e,t,o,n){o.isLoadingStore.state||o.loadingDetailsStore.setState({type:"load_aggregation"}),o.isClientModeEnabledStore.state||o.asyncAggregationStatusStore.setState({calculating:!0,aggregation:e,changingType:!0}),t(e),(0,N().X)({environment:n,collectionContextStore:o,action:"board_change_aggregation"})}const Rc=r.memo((function(e){const{aggregation:t,schema:o,groupFormat:n,groupsResultStore:i,collectionContextStore:l,disabled:a,color:s,onChange:c}=e,d=!(0,k().O$)(j().e),u=(0,I().IS)((()=>({button:{fontWeight:pe().Wy.regular,color:s||K().Tj.text.tertiary,padding:"0 6px",minHeight:20,minWidth:20,borderRadius:4,height:void 0,lineHeight:void 0}})),[s]),p=(0,r.useCallback)((()=>(0,Ge.jsx)(Bc,{aggregation:t,schema:o,collectionContextStore:l})),[t,l,o]),m=(0,r.useCallback)((e=>(0,Ge.jsx)(Ce().A,{popupType:g().A.isMobile?Ce().z.BottomSheet:Ce().z.Popup,renderOrigin:r=>(0,Ge.jsx)(Fr().p,{disabled:a,style:u.button,...(0,$i().A)(e,r),children:(0,Ge.jsx)(Vc,{schema:o,aggregation:t,collectionContextStore:l,groupFormat:n,groupsResultStore:i})}),disabled:a,render:e=>(0,Ge.jsx)(Ic,{parent:e,selectedAggregation:t,onChange:c,collectionContextStore:l,schema:o})})),[a,u.button,o,t,l,n,i,c]);return d?null:(0,Ge.jsx)(Wo().m,{renderTooltip:p,render:m})}));function Bc({aggregation:e,schema:t,collectionContextStore:o}){const n=(0,Le().tz)(),r=(0,k().K8)((()=>!!Boolean(e)&&Yi(o,e)),[o,e]);if(e){const o=el().zY[(0,qi().V1)(e)];if((0,qi().G9)(e)){const i=t[e.property];if(i){const e=i.name;return(0,Ge.jsx)(Ge.Fragment,{children:n.formatMessage(Ji.propertyAggregation,{aggregationType:o,propertyName:e,calculating:r})})}}return(0,Ge.jsx)(Ge.Fragment,{children:n.formatMessage(Ji.aggregationType,{aggregationType:o,calculating:r})})}return(0,Ge.jsx)(Le().sA,{defaultMessage:"Aggregate",id:"database.boardAggregation.tooltip"})}function Vc(e){const t=(0,k().K8)((()=>{var t;const o=e.groupsResultStore.state;if(!o)return;const n=(0,Vn().Ix)(e.groupFormat);return null===(t=o.aggregationResults)||void 0===t?void 0:t[n]}),[e.groupFormat,e.groupsResultStore]);let o,n;if((0,qi().G9)(e.aggregation)){const t=e.schema[e.aggregation.property];!t||"formula"!==t.type&&"number"!==t.type||(o=t.number_format),t&&"date"===t.type&&(n=t.date_format)}return(0,Ge.jsx)(Qi,{aggregation:e.aggregation,collectionContextStore:e.collectionContextStore,children:t?(0,el().rv)({numberFormat:o,dateFormat:n,aggregation:e.aggregation,userTimeZone:(0,tr().P)(),value:t.aggregationResult,numberPrecision:void 0}):"–"})}const Fc=r.memo((function(e){const{hoveredGroupStore:t,groupFormat:o,schema:n,format:i,groupsResultStore:l,collectionContextStore:a,disabled:s,hidden:c,isPopup:d,query:u,currentGroups:p,isFullScreen:m}=e,S=(0,x().v3)(),h=(0,Le().tz)(),y=(0,I().DP)(),v=(0,Ue().Zp)(),f=(0,k().K8)((()=>!!g().A.isMobile||(0,Vn().Mn)(t.state,o)),[t,o]),b=(0,k().K8)((()=>(0,ci().$e)({environment:S,groupFormat:o,schema:n,format:i,theme:y})),[o,n,i,S,y]),w=(0,k().O$)(a.canConfigureBlockStore),C=(0,r.useMemo)((()=>{if((0,Vn().D1)(o.value)&&(0,Vn().WO)(o.value.value))return new(ae().B)(S,o.value.value)}),[S,o.value]),T=(0,k().K8)((()=>Boolean((null==C?void 0:C.isReady())&&!(null!=C&&C.canRead()))),[C]),j=(0,k().K8)((()=>a.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})&&!T),[a,T]),A=(0,k().K8)((()=>(0,ne().fG)({collectionContextStore:a,environment:S,intl:h})),[a,S,h]),M=(0,k().K8)((()=>{const e=a.collectionStore();return(!(null==e?void 0:e.inMemoryRecordCache.isTemporaryData)||null==v||!v.isPreviewing)&&(u.aggregations&&u.aggregations.length>0)}),[a,u,v]),P=(0,r.useCallback)((()=>{t.state!==o&&t.setState(o)}),[o,t]),_=(0,I().IS)((()=>{const e=oc(i),t=Boolean(i.collection_group_by);return{container:{display:"flex",alignItems:"center",fontSize:14,width:e,paddingInlineStart:8,paddingInlineEnd:8,marginInlineEnd:12,marginBottom:c?4:0,boxSizing:"content-box",flexShrink:0,...d&&{padding:g().A.isMobile?"6px 16px":"8px 12px 4px",width:"none",minWidth:e},...b&&!c&&{backgroundColor:b.backgroundColor,...t?{borderRadius:kl}:{borderStartStartRadius:kl,borderStartEndRadius:kl}}},spacer:{flexGrow:1}}}),[b,i,c,d]);return(0,Ge.jsxs)("div",{style:_.container,onMouseMove:P,children:[(0,Ge.jsx)(Ec,{boardGroupHeaderProps:e}),M?(0,Ge.jsx)(Oc,{groupsResultStore:l,disabled:s,query:u,schema:n,collectionContextStore:a,groupFormat:o,hidden:c,boardSelectStyle:b}):null,(0,Ge.jsx)("div",{style:_.spacer}),!s&&w?(0,Ge.jsx)(Dc,{hidden:c,groupFormat:o,currentGroups:p,format:i,schema:n,query:u,collectionContextStore:a,boardSelectStyle:b,isHovered:f}):null,j?(0,Ge.jsx)(zc,{format:i,groupFormat:o,collectionContextStore:a,isFullScreen:m,hidden:c,isHovered:f,boardSelectStyle:b}):null,A?(0,Ge.jsx)(Lc,{groupFormat:o,collectionContextStore:a,hidden:c,isHovered:f,boardSelectStyle:b}):null]})}));function Ec(e){const{boardGroupHeaderProps:t}=e,{groupFormat:o,schema:n,disabled:i,currentGroups:l,format:a,groupBy:s,collectionContextStore:c}=t,d=(0,x().v3)(),u=(0,k().O$)(c.canConfigureBlockStore),p=(0,k().K8)((()=>c.groupsStore.getGroupState(o)),[c,o]),g=(0,r.useCallback)((e=>{const o=c.collectionStore();o&&(Mi({...e,environment:d,groupsFormatKey:"board_columns",collectionStore:o,...t}),(0,N().X)({environment:d,collectionContextStore:c,action:"rename_group"}))}),[t,c,d]),m=(0,I().IS)((()=>({container:{maxWidth:oc(a)-70}})),[a]);return p?(0,Ge.jsx)(gl().d,{collectionContextStore:c,groupBy:s,groupFormat:o,currentGroups:l,schema:n,disabled:i||!u,isHiddenGroup:!1,onChange:g,style:m.container,source:"board_group_header"}):null}function Oc(e){const{disabled:t,query:o,schema:n,collectionContextStore:i,groupFormat:l,hidden:a,boardSelectStyle:s,groupsResultStore:c}=e,d=(0,x().v3)(),u=(0,k().O$)(i.canConfigureBlockStore),p=(0,r.useCallback)((e=>{const t=i.collectionViewStore();if(!t)return;const n=e?[e]:[],r={...o,aggregations:n};et().createAndCommit({userAction:"BoardGroupHeader.handleAggregationChange",environment:d,canUndo:!0,perform:e=>{(0,Bi().F)({collectionViewStore:t,update:{query2:r},transaction:e})}})}),[i,d,o]),g=(0,I().IS)((()=>({container:{color:Kc({hidden:a,boardSelectStyle:s})}})),[a,s]),m=o.aggregations?o.aggregations[0]:void 0;return m?(0,Ge.jsx)(Rc,{groupFormat:l,groupsResultStore:c,disabled:t||!u,aggregation:m,schema:n,collectionContextStore:i,color:g.container.color,onChange:p}):null}function Dc(e){const{hidden:t,groupFormat:o,currentGroups:n,format:i,schema:l,query:a,collectionContextStore:s,boardSelectStyle:c,isHovered:d}=e,u=(0,Le().tz)(),p=(0,I().IS)((()=>{const e=Kc({hidden:t,boardSelectStyle:c});return{button:Wc({hidden:t,isHovered:d}),icon:{width:Kn().Ev.sm,height:Kn().Ev.sm,fill:e}}}),[t,c,d]),m=(0,r.useCallback)((e=>(0,Ge.jsx)(Ie().A,{style:p.button,icon:Be().ellipsisSmallIcon,iconStyle:p.icon,ariaLabel:u.formatMessage({defaultMessage:"More group options",id:"database.boardGroupHeader.actions.moreGroupOptions.tooltip"}),...e})),[u,p.button,p.icon]),S=(0,r.useCallback)((e=>(0,Ge.jsx)(Wi,{parent:e,groupFormat:o,currentGroups:n,format:i,query:a,schema:l,collectionContextStore:s,groupsFormatKey:"board_columns"})),[s,i,o,n,l,a]);return(0,Ge.jsx)(Ce().A,{popupType:g().A.isMobile?Ce().z.BottomSheet:Ce().z.Popup,renderOrigin:m,render:S})}function zc(e){const{navigate:t}=(0,r.useContext)(Ka().E),{format:o,groupFormat:n,collectionContextStore:i,isFullScreen:l,hidden:a,isHovered:c,boardSelectStyle:d}=e,u=(0,x().v3)(),p=(0,Le().tz)(),m=(0,r.useContext)(Ea().n),S=(0,k().K8)((()=>i.collectionStore()),[i]),h=(0,r.useCallback)((()=>{if(!(0,co().E)(u,(0,s().f)(S)))return;const e="collectionTypedView"===i.contextTypeFromStoreState,r=Boolean(o.collection_group_by);i.searchQueryStore.state&&(0,Cr().S)({searchQuery:"",collectionContextStore:i,isFullScreen:l});const a=i.groupsStore.getGroupState(n);if(!a)return;const c=a.resultsStore;et().createAndCommit({userAction:"BoardGroupHeader.handleAddItemClick",environment:u,canUndo:!0,perform:o=>{const l=(0,Xn().Q)({environment:u,collectionContextStore:i,groupsPointer:[n],insertAtIndex:0,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"board_group_header"},inMemoryRecordCache:u.defaultRecordCache.inMemoryRecordCache});if(!l)return;const a=l.coercionSucceeded,s=l.newStore;if(g().A.isMobile){const e=(0,Se().Ay)({store:s,pageVisitSource:de().y8.Create});m?m(e):t({environment:u,url:e})}else if(a&&!r){const e=s.getBlockTitleStore();(0,Ba().h)({environment:u,store:s}),(0,Fa().z)({store:e}),(0,Ta().C)({store:s})}else(0,Kr().V)({environment:u,store:s,peekMode:(0,ne().hH)(i),showMoveTo:e,resultsStore:c,collectionContextStore:i,pageVisitSource:de().y8.Create});$n().vH(u,{from:"board_group_add_item_top",type:"page",new_page_id:s.id,creating_block_id:s.id,...(0,Lt().sl)(i)})}})}),[u,i,o.collection_group_by,S,n,l,m,t]),y=(0,k().K8)((()=>{var e;return null===(e=i.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[i]),v=(0,r.useMemo)((()=>{const e=(0,Gn().$O)(y);return p.formatMessage({defaultMessage:"New {newItemName}",id:"database.boardView.actions.addNewItem.tooltip"},{newItemName:e})}),[y,p]),f=(0,I().IS)((()=>{const e=Kc({hidden:a,boardSelectStyle:d});return{button:Wc({hidden:a,isHovered:c}),icon:{width:Kn().Ev.sm,height:Kn().Ev.sm,fill:e}}}),[d,a,c]),b=(0,r.useCallback)((()=>v),[v]),w=(0,r.useCallback)((e=>(0,Ge.jsx)(Ie().A,{icon:Ho().plusSmallIcon,onClick:h,style:f.button,iconStyle:f.icon,ariaLabel:v,...e})),[h,v,f.button,f.icon]);return(0,Ge.jsx)(Wo().m,{renderTooltip:b,render:w})}function Lc(e){const{groupFormat:t,collectionContextStore:o,hidden:n,isHovered:i,boardSelectStyle:l}=e,a=(0,Le().tz)(),s=(0,k().K8)((()=>{var e;return null===(e=o.collectionStore())||void 0===e?void 0:e.getFormat().app_config_uri}),[o]),c=(0,r.useMemo)((()=>{const e=(0,Gn().$O)(s);return a.formatMessage({defaultMessage:"Link existing {newItemName}",id:"database.boardView.actions.linkExistingItem.tooltip"},{newItemName:e})}),[s,a]),d=(0,I().IS)((()=>{const e=Kc({hidden:n,boardSelectStyle:l});return{button:Wc({hidden:n,isHovered:i}),icon:{width:Kn().Ev.sm,height:Kn().Ev.sm,fill:e}}}),[l,n,i]),u=(0,r.useCallback)((()=>c),[c]),p=(0,r.useCallback)(((e,t)=>(0,Ge.jsx)(Ie().A,{icon:zn().arrowDiagonalUpRightSmallIcon,style:d.button,iconStyle:d.icon,...e,...t,ariaLabel:c})),[c,d.button,d.icon]);return(0,Ge.jsx)(kr().O,{collectionContextStore:o,groupFormat:t,renderLinkButton:e=>(0,Ge.jsx)(Wo().m,{renderTooltip:u,render:t=>p(t,e)})})}function Kc(e){const{hidden:t,boardSelectStyle:o}=e;return!t&&o?o.textColor:K().Tj.text.tertiary}function Wc(e){const{hidden:t,isHovered:o}=e;return t?{}:{transition:"opacity 100ms ease-in-out, visibility 100ms ease-in-out",opacity:o?1:0,visibility:o?"visible":"hidden"}}const Hc=r.memo((function(e){const{collectionContextStore:t,columnsDisplayState:n,groupsResultStore:i,currentGroups:l,disableBoardColorColumns:a,disabled:s,format:c,headerPlaceholderHeight:d,hiddenGroups:u,hoveredGroupStore:p,isFullScreen:m,isInPeekRenderer:S,isRootChild:h,paddingLeft:y,paddingRight:v,query:f,schema:b,visibleGroups:w}=e,C=(0,x().v3)(),T=(0,x().Y0)(),j=(0,r.useRef)(null),A=(0,k().O$)(t.canConfigureBlockStore),M=(0,k().K8)((()=>(0,ci().K3)({device:T,isFullScreen:m,isRootChild:h})),[T,m,h]),P=(0,k().O$)(t.isInHomeWidgetStore),_=(0,ne().Oz)(t),R=(0,I().IS)((()=>{const e=P?"transparent":(null==_?void 0:_.background)||(S?K().Tj.background.elevated:K().Tj.background.primary),t=nc({disableBoardColorColumns:a,isInHomeWidget:P,isMobile:g().A.isMobile});return{header:{position:"absolute",background:e,height:40+t,paddingTop:t,zIndex:85,display:"flex",boxShadow:`calc(var(--direction, 1) * -3px) 0 0 ${e}`,minWidth:"100%"},stickyHeader:{paddingInlineStart:y,paddingInlineEnd:v},spacer:{height:"calc(100% + 17px)",...P?{}:{background:S?K().Tj.background.elevated:K().Tj.background.primary},width:20,marginInlineStart:-20,marginTop:-17}}}),[P,null==_?void 0:_.background,S,a,y,v]),B=(0,k().K8)((()=>{const e=t.normalizedFormatStore.state.board_columns_by;if(!e)return!1;const o=(0,Vn().Nf)(e);return A&&o.includes("manual")}),[t.normalizedFormatStore,A]),V=(0,r.useCallback)(((e,o)=>(0,Ge.jsx)(Nc,{schema:b,collectionContextStore:t,format:c,query:f,disabled:s,isFullScreen:m,hoveredGroupStore:p,groupFormat:w[o],currentGroups:l,groupsResultStore:i})),[t,l,s,c,p,m,f,i,b,w]),F=(0,r.useCallback)((e=>{(0,o(864403).r)({environment:C,collectionContextStore:t,groupByKey:"board_columns_by",groupsFormatKey:"board_columns",newGroupIds:e,currentGroups:n.currentGroups,containsAllGroups:!1})}),[t,n.currentGroups,C]);if(0===w.length&&0===u.length&&0===n.pinnedGroups.groups.length)return null;const E=w.map((e=>(0,Vn().Ix)(e)));return c.board_columns_by?(0,Ge.jsx)(Ci().g,{stickyAttachPoint:P?"no-stick":"ceiling",absoluteHeight:d,nodeRef:j,stickyStyle:R.stickyHeader,children:(0,Ge.jsxs)("div",{style:R.header,ref:j,children:[M?(0,Ge.jsx)("div",{style:R.spacer}):void 0,B?(0,Ge.jsx)(tc().Ay,{direction:"horizontal",keys:E,renderKey:V,onDrop:F}):E.map(((e,o)=>(0,Ge.jsx)(Nc,{schema:b,collectionContextStore:t,format:c,query:f,disabled:s,isFullScreen:m,hoveredGroupStore:p,groupFormat:w[o],currentGroups:l,groupsResultStore:i},(0,Vn().Ix)(w[o]))))]})}):null})),Nc=r.memo((function({groupFormat:e,currentGroups:t,schema:o,collectionContextStore:n,format:r,query:i,disabled:l,isFullScreen:a,hoveredGroupStore:s,groupsResultStore:c}){return(0,k().K8)((()=>n.groupsStore.getGroupState([e])),[n,e])&&r.board_columns_by?(0,Ge.jsx)(Fc,{currentGroups:t,groupFormat:e,query:i,schema:o,format:r,groupBy:r.board_columns_by,collectionContextStore:n,hoveredGroupStore:s,disabled:l,hidden:!1,isPopup:!1,isFullScreen:a,groupsResultStore:c}):null}));const Gc=r.memo((function(e){const{collectionContextStore:t,columnsDisplayState:n,disabled:r}=e,i=n.pinnedGroups;return(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)(Fr().p,{colorVariant:"tertiary",iconLeading:{icon:o(991941).M,size:"sm"},style:{width:"fit-content",gap:8},onClick:()=>{const e=t.settingsStore;Q().R8({collectionSettingsStore:e,item:{type:"group",groupByKey:"board_columns_by",groupsFormatKey:"board_columns"}})},children:(0,Ge.jsx)(Le().sA,{...ci().K0.pinnedGroups})}),(0,Ge.jsx)("div",{style:{marginInlineStart:24,marginTop:8},children:i.groups.map((e=>{const o=(0,Vn().Ix)(e),l=i.aggregations[o]??0;return(0,Ge.jsx)($c,{groupFormat:e,count:l,collectionContextStore:t,columnsDisplayState:n,disabled:r},(0,Vn().Ix)(e))}))})]})}));function $c(e){const{groupFormat:t,collectionContextStore:n,columnsDisplayState:i,disabled:l}=e,a=(0,x().v3)(),s=(0,Le().tz)(),c=r.useRef(null),d=(0,k().O$)(n.normalizedFormatStore),u=(0,k().O$)(n.normalizedSchemaStore),p=(0,k().O$)(n.temporaryStateStore),[g,m]=r.useState(!1),S=(0,k().K8)((()=>{const e=n.collectionViewBlockStore();return e?new(ae().B)(a,{table:ht().ev,id:e.id}):null}),[a,n]),{value:h}=(0,T().fJ)(Vt().VI.duplicateActions),y=r.useCallback((async e=>{const{droppedStores:t,duplicate:o,groupFormat:r}=e,i=c.current;if(!i)return;if(!(i instanceof Element))return;const l=await $t().T.formulas.load();et().createAndCommit({userAction:"BoardPinnedGroup.handleDrop",environment:a,canUndo:!0,perform:e=>xr({environment:a,collectionContextStore:n,groupsPointer:[r],droppedStores:t,duplicate:o,transaction:e,collapsedGroup:!0,collectionStore:void 0,targetStore:void 0,droppedDirection:void 0,formulasModule:l,duplicateActions:h})})}),[n,h,a]),v=r.useCallback((()=>{(0,Li().m)({environment:a,collectionContextStore:n,groupsFormatKey:"board_columns",groupFormat:t,currentGroups:i.currentGroups,action:"toggle_group_pin"})}),[a,n,t,i]),f=d.board_columns_by,b=r.useMemo((()=>{if(!f)return null;const e=oc(d);return(0,Ge.jsx)(gl().d,{collectionContextStore:n,currentGroups:i.currentGroups,groupBy:f,groupFormat:t,schema:u,disabled:!0,isHiddenGroup:!1,style:{fontSize:14,cursor:"inherit",maxWidth:e-24,overflow:"hidden",textOverflow:"ellipsis"},source:"collection_settings"})}),[n,i.currentGroups,d,f,t,u]),w=(0,I().IS)((()=>({container:{display:"flex",alignItems:"center",paddingTop:2,paddingBottom:2},pinIcon:{width:16,height:16,fill:K().Tj.text.tertiary}})),[]);if(!f)return null;if(!S)return null;const C={onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1)};return(0,Ge.jsx)("div",{ref:c,children:(0,Ge.jsxs)(oo().Ay,{location:"boardPinnedGroup",analyticsName:"board_pinned_group",store:S,canDropOnto:!l,shouldShowDropZone:!0,dropzoneMustBeWithinHorizontalBound:!0,dropzoneShouldNeverUseOrigin:!0,onSelectableDrop:async e=>{await y({...e,groupFormat:t})},style:w.container,children:[(0,Ge.jsxs)(Fr().p,{onClick:()=>{(0,o(701311).d)({collectionContextStore:n,environment:a,groupFormat:t,groupBy:f,temporaryViewState:p,title:b})},hoveredStyle:{cursor:"pointer"},children:[b,(0,Ge.jsx)("span",{style:{opacity:.5,fontSize:14,marginInlineStart:8},children:(0,o(72135).ZV)(e.count,"number",s,"compact")})]}),l?null:(0,Ge.jsx)(Wo().m,{renderTooltip:e=>(0,Ge.jsx)(Le().sA,{...e,...ci().K0.unpinGroup}),render:e=>(0,Ge.jsx)(Ie().A,{...(0,$i().A)(e,C),ariaLabel:s.formatMessage(ci().K0.unpinGroup),icon:g?o(230979).N:o(68207).S,iconStyle:w.pinIcon,onClick:v})})]})},(0,Vn().Ix)(t))}const Uc=r.memo((function(e){const{args:t,collectionContextStore:o,isInPeekRenderer:n,format:i,setSubgroupsMounted:l,visibleGroups:a}=e,s=(0,k().O$)(o.isInHomeWidgetStore),c=(0,r.useMemo)((()=>function(e){const{format:t,visibleGroups:o}=e;return o.length*(oc(t)+16+12)}({format:i,visibleGroups:a})),[i,a]),{stickyStyle:d}=(0,I().IS)((()=>s?{stickyStyle:{}}:{stickyStyle:{background:n?K().Tj.background.elevated:K().Tj.background.primary,boxShadow:`0 1px 0 ${n?K().Tj.background.elevated:K().Tj.background.primary}`}}),[s,n]);return(0,Ge.jsx)(Sl,{...t,height:s?Fl().ag:36,stickyStyle:d,style:{...t.style,minWidth:c},onMount:l})})),qc=P().Store.createClass(void 0,{name:"GroupsReducerResultStore"}),Xc=P().Store.createClass(void 0,{name:"HoveredGroupStore"}),Yc=r.memo((function(e){const{store:t,format:n,schema:i,collectionContextStore:l,isFullScreen:a,isPreviewing:s,paddingLeft:c,paddingRight:d,paddingBottom:u,disabled:p,query:m,blockPropertyValueOverlayStore:S,isInPeekRenderer:h,isRootChild:v,headerWidth:f}=e,b=(0,x().v3)(),w=(0,I().DP)(),C=(0,Le().tz)(),T=(0,r.useRef)(null),j=(0,k().uB)(void 0,qc),A=(0,k().O$)(j),M=(0,k().uB)(void 0,Xc),[P,_]=(0,r.useState)(!1),R=(0,k().r6)((()=>{var e,t;const o=l.collectionViewStore();if(!o)return[void 0,void 0];return[null==o||null===(e=o.getFormatStore())||void 0===e?void 0:e.getKeyStore("collection_group_by").getValue(),null==o||null===(t=o.getFormatStore())||void 0===t?void 0:t.getKeyStore("board_columns_by").getValue()]}),[l],{useDeepEqual:!0}),{collectionStore:B,collectionViewStore:V}=(0,k().K8)((()=>({collectionStore:l.collectionStore(),collectionViewStore:l.collectionViewStore()})),[l]),F=(0,k().K8)((()=>"collectionTypedView"===l.contextTypeFromStoreState),[l]),E=(0,k().O$)(l.permissionScopesStore),O=(0,k().K8)((()=>!Boolean((0,ci().$e)({environment:b,groupFormat:void 0,schema:i,format:n,theme:w}))),[b,n,i,w]),D=(0,Qr().d)({groupBy:n.board_columns_by,reducerResult:A}),z=(0,Qr().d)({subGroupBy:n.collection_group_by,reducerResult:A}),L=(0,k().K8)((()=>l.groupsStore.anyGroupHasResults()),[l]),K=(0,k().K8)((()=>{var e;const t=n.board_columns_by;if(!t)return;const o=n.collection_group_by?{groupBy:n.collection_group_by,groupsFormatKey:"collection_groups",limit:l.groupsLimitStore.state,subGroupAggregation:n.collection_group_aggregation}:void 0,r=di({collectionContextStore:l,isMobile:g().A.isMobile,groupBy:t,subGroupBy:n.collection_group_by});return(0,Rn().p)({groupBy:t,schema:i,format:n,groupsFormatKey:"board_columns",limit:l.boardColumnsLimitStore.state,aggregation:null===(e=m.aggregations)||void 0===e?void 0:e.at(0),returnPinnedGroups:!0,subGroupArgs:o,blockResults:r})}),[l,n,m.aggregations,i],{useDeepEqual:!0}),W=(0,Qt().bx)(t,p),H=(0,r.useMemo)((()=>W),[W]),N=(0,r.useCallback)((()=>{B&&B.isDefined()&&V&&E.canConfigureBlock&&et().createAndCommit({userAction:"Board.updateOrCreateColumnsByProperty",environment:b,canUndo:!0,perform:e=>{const t=(0,o(586686).I)(i);if(!t)return;const n=i[t];n&&(0,Vn().Eg)(n)&&(We().zA({stores:[V],update:{board_columns_by:(0,Vn().V0)({property:t,propertySchema:n,isCollectionTypedView:F})},transaction:e}),He().zv({store:V,data:{type:"board"},transaction:e}))}})}),[B,V,b,F,E.canConfigureBlock,i]);(0,r.useEffect)((()=>{B&&!n.board_columns_by&&t.isDefined()&&B.isDefined()&&N()}),[l,B,b,n.board_columns_by,C,i,t,N]),(0,r.useEffect)((()=>{const e=()=>_(!1);return R.addListener(e),()=>R.removeListener(e)}),[R]);const G=(0,r.useCallback)((()=>M.setState(void 0)),[M]),$=(0,r.useCallback)((e=>{const o=D.visibleGroups;return(0,Ge.jsx)("div",{style:tc().Z0,children:o.map(((r,s)=>{const u=s===o.length-1,g=e?[e,r]:[r],h=0!==D.hiddenGroups.length;return l.groupsStore.getGroupState(g)?(0,Ge.jsx)(hc,{store:t,hoveredGroupStore:M,query:m,schema:i,format:n,groupsPointer:g,collectionContextStore:l,isFullScreen:a,disabled:p||!H,isLast:u&&!h,blockPropertyValueOverlayStore:S,anyGroupHasResults:L,paddingLeft:c,paddingRight:d,headerWidth:f},(0,Vn().Hm)(g)):null}))})}),[L,S,H,l,D.hiddenGroups.length,D.visibleGroups,p,n,f,M,a,c,d,m,i,t]),U=(0,r.useCallback)((()=>{_(!0)}),[_]),q=(0,r.useCallback)((e=>(0,Ge.jsx)(Uc,{collectionContextStore:l,isInPeekRenderer:h,format:n,setSubgroupsMounted:U,visibleGroups:D.currentGroups,args:e})),[l,D.currentGroups,n,h,U]),X=(0,r.useCallback)((e=>{g().A.isMobile?(0,El().u)({environment:b,store:e,pageVisitSource:de().y8.Create}):(0,Kr().V)({environment:b,store:e,peekMode:ne().hH(l),showMoveTo:F,resultsStore:void 0,collectionContextStore:l,pageVisitSource:de().y8.Create})}),[l,b,F]),Y=L,Q=P,Z=(0,k().O$)(l.shouldShowSpinnerStore),J=Z&&!Q&&!Y,ee=(0,k().O$)(l.isInHomeWidgetStore),te=(0,k().K8)((()=>Boolean(l.viewsModuleContextStore.getViewModuleType())),[l]),{visibleGroups:oe,hiddenGroups:re,currentGroups:ie}=D,le=n.collection_group_by,ae=a?480:ee?220:360,se=nc({disableBoardColorColumns:O,isInHomeWidget:ee,isMobile:g().A.isMobile}),ce=40+se,ue=(0,Ue().Zp)(),pe=(0,r.useCallback)((e=>{const{target:t}=e;!g().A.isMobile&&0===e.button&&t instanceof HTMLElement&&(0,y().SQ)(e,y().y$.EditorMouseDown,(()=>{e.preventDefault(),(0,to().j)({environment:b,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}))}),[b]),ge=(0,r.useCallback)((()=>({})),[]),me=(0,I().IS)((()=>({container:{position:"relative",marginInlineStart:c,marginInlineEnd:d,float:"inline-start"},selectable:{display:"flex",position:"relative",flexGrow:1,paddingBottom:u},groupsWrapper:{display:"flex",flexDirection:"column",position:"relative",marginTop:ce}})),[ce,u,c,d]),Se=(0,r.useCallback)((()=>{const e=0===D.currentGroups.length&&0===D.pinnedGroups.groups.length,o=n.collection_group_by&&0===z.currentGroups.length;if(!J&&(e||o)){let t="board_columns_by";return!e&&n.collection_group_by&&0===z.visibleGroups.length&&(t="collection_group_by"),(0,Ge.jsx)(Hr,{collectionContextStore:l,groupByKeyToOpen:t,paddingLeft:c,paddingRight:d,headerWidth:f})}return(0,Ol().A)((e=>(0,Ge.jsx)("div",{className:fn().okd,style:me.container,...e,ref:T,children:(0,Ge.jsx)(fi().b,{nodeRef:T,children:(0,Ge.jsxs)(oo().Ay,{location:"collectionBoard",style:me.selectable,store:t,shouldShowHalo:!a&&!ee&&!s,canSelect:!a&&!te,disablePointerEvents:null==ue?void 0:ue.disableContentPointerEvents,onMouseDown:pe,analyticsName:"board",onMouseLeave:G,children:[J&&ee?null:(0,Ge.jsx)(Hc,{collectionContextStore:l,columnsDisplayState:D,currentGroups:ie,disableBoardColorColumns:O,disabled:p,groupsResultStore:j,format:n,headerPlaceholderHeight:ce,hiddenGroups:re,hoveredGroupStore:M,isFullScreen:a,isInPeekRenderer:h,isRootChild:v,paddingLeft:c,paddingRight:d,query:m,schema:i,visibleGroups:oe}),J?(0,Ge.jsx)(kc,{height:ae,numBoardColumns:oe.length,boardCoverSize:n.board_cover_size,areColumnsColored:!O,showGroupHeader:0===oe.length,disableBoardColorColumns:O,isInHomeWidget:ee}):null,oe.length>0?(0,Ge.jsx)("div",{style:me.groupsWrapper,children:le?(0,Ge.jsx)(Qs,{reducerId:Bn().bq,store:t,groupsResultStore:j,collectionContextStore:l,disabled:p,isFullScreen:a,isRootChild:v,paddingLeft:c,paddingRight:d,stickyLeft:!g().A.isMobile,renderGroupResults:$,getGroupStyle:ge,renderHeader:q,onGroupHeaderAddItem:X,headerWidth:f}):$(void 0)}):null,(0,Ge.jsxs)("div",{style:{display:"flex",flexDirection:"column",width:"fit-content",height:"fit-content",marginTop:se+6},children:[(0,ci().Zl)(D,l,!0)?(0,Ge.jsx)(Il,{type:"board",groupsLimitStore:l.boardColumnsLimitStore,collectionContextStore:l}):void 0,rc({displayState:D,format:n,permissionScopes:E})?(0,Ge.jsx)(ic,{format:n,schema:i,collectionContextStore:l,store:t,currentGroups:ie,disabled:Z}):void 0,D.pinnedGroups.groups.length>0&&!J?(0,Ge.jsx)(Gc,{collectionContextStore:l,columnsDisplayState:D,disabled:p}):void 0]})]})})})))}),[D,n,z.currentGroups.length,z.visibleGroups.length,J,l,c,d,f,me.container,me.selectable,me.groupsWrapper,t,a,ee,s,te,null==ue?void 0:ue.disableContentPointerEvents,pe,G,ie,O,p,j,ce,re,M,h,v,m,i,oe,ae,le,$,ge,q,X,se,E,Z]);return n.board_columns_by?(0,Ge.jsx)(lc,{collectionContextStore:l,groupsResultStore:j,groupsReducer:K,render:Se}):(0,Ge.jsx)(sc,{collectionContextStore:l,isFullScreen:a,paddingLeft:c,paddingRight:d,paddingBottom:u})}));var Qc=()=>o(587682),Zc=()=>o(862e3),Jc=()=>o(811481),ed=()=>o(604995),td=()=>o(183558),od=()=>o(636740),nd=()=>o(703878),rd=()=>o(253021),id=()=>o(747671),ld=()=>o(597777);function ad(e){const{blockPropertyValueOverlayStore:t,calendarBy:n,calendarViewRange:i,canEditCalendar:l,collectionContextStore:a,columnIndex:s,currentlyViewedMonth:c,endOfDay:d,format:u,items:p,query:g,sortedResultsStore:m,schema:S,shouldShowShimmer:h,startOfDay:y}=e,v=(0,ed().vY)({firstDate:y,secondDate:c}),f=(0,ed().c_)(y),b=!v&&!f&&"week"!==i,x=(0,I().IS)((()=>({button:{width:"100%",height:44,borderRadius:6},dayNumber:{height:28,color:b?K().Tj.text.tertiary:f?K().Tj.white:void 0,...f?{width:28,lineHeight:"28px",borderRadius:"100%",textAlign:"center",background:K().oZ.red,marginInlineStart:"auto",marginInlineEnd:"auto"}:{display:"flex",alignItems:"center",justifyContent:"center"}},eventDot:{width:8,height:8,background:K().Tj.icon.secondary,borderRadius:"100%",marginTop:2,marginInlineStart:"auto",marginInlineEnd:"auto"}})),[f,b]),w=(0,r.useMemo)((()=>p.find((e=>(0,ld().m6)(y,d,e.start,e.end?e.end:void 0)))),[p,y,d]),C=(0,ed().wN)(y),k=(0,r.useCallback)((e=>(0,Ge.jsxs)(ui().Ay,{style:x.button,...e,children:[(0,Ge.jsx)("div",{style:x.dayNumber,className:h?`notion-shimmer-calendar-transition notion-shimmer-text animation-delay-${s}`:"notion-shimmer-calendar-transition",children:C}),w?(0,Ge.jsx)("div",{style:x.eventDot}):void 0]})),[x,h,s,C,w]),T=(0,r.useCallback)((e=>(0,Ge.jsx)(o(824622).iq,{collectionContextStore:a,initialStartOfDay:y,format:u,schema:S,query:g,calendarBy:n,disabled:!l,onDismiss:e.close,blockPropertyValueOverlayStore:t,resultsStore:m})),[a,y,u,S,g,n,l,t,m]);return(0,Ge.jsx)(Ce().A,{popupType:Ce().z.SlideUp,renderOrigin:k,render:T},C.toString())}const sd=(0,r.memo)(ad);function cd(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarViewRange:n,canEditCalendar:i,collectionContextStore:l,currentlyViewedMonth:a,format:s,items:c,query:d,sortedResultsStore:u,schema:p,shouldShowShimmer:g,showWeekends:m,startOfWeek:S}=e,h=(0,I().IS)((()=>({container:{display:"flex",boxShadow:`0 -1px 0 ${K().Tj.border.primary}`,paddingTop:8,paddingBottom:8,fontSize:14}})),[]),y=m?7:5,v=(0,r.useMemo)((()=>[...Array(y).keys()].map((e=>{const t=(0,ed().K1)({date:S,daysToAdd:e});return{startOfDay:t,endOfDay:(0,ed().P9)(t)}}))),[y,S]);return(0,Ge.jsx)("div",{style:h.container,children:v.map(((e,r)=>(0,Ge.jsx)(sd,{blockPropertyValueOverlayStore:t,calendarBy:o,canEditCalendar:i,collectionContextStore:l,columnIndex:r,currentlyViewedMonth:a,endOfDay:e.endOfDay,format:s,items:c,query:d,sortedResultsStore:u,schema:p,shouldShowShimmer:g,startOfDay:e.startOfDay,calendarViewRange:n},e.startOfDay.toString())))},S.toString())}const dd=(0,r.memo)(cd);var ud=()=>o(465364);const pd=30,gd=(0,Le().YK)({addItemLabel:{defaultMessage:"Add an item",id:"database.calendarView.addItemButtonTooltip"},linkExistingLabel:{defaultMessage:"Link an existing item",id:"database.calendarView.linkExistingButtonTooltip"},linkExistingCompleteToast:{defaultMessage:"{pageTitle} linked and {numUpdates, plural, one {{numUpdates} property} other {{numUpdates} properties}} updated",id:"database.calendarView.linkExistingToast"}});function md(e){const{blockStore:t,calendarStore:n,collectionContextStore:i,columnIndex:l,startOfDay:c,canEditCalendar:d,isInHomeWidget:u,isInPeekRenderer:p,isTypedMsvCollection:g,currentlyViewedMonth:m,calendarBy:S,propertySchema:h,calendarViewRange:y,shouldShowShimmer:v}=e,f=(0,wi().V)(i),b=(0,x().v3)(),w=(0,Le().tz)(),C=(0,r.useContext)(Ea().n),{navigate:j}=(0,r.useContext)(Ka().E),A=(0,k().O$)(a().AppStoreMainEditorCurrentBlockStore),M=(0,k().K8)((()=>i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[i]),{dayStoreMap:P,isDragging:_,hoveredDay:R}=(0,k().K8)((()=>({dayStoreMap:n.state.dayStoreMap,isDragging:n.state.isDragging,hoveredDay:n.state.isDragging?void 0:n.state.hoveredDay})),[n]),{pointer:V,userId:F,inMemoryRecordCache:E}=(0,k().K8)((()=>t),[t]),O=(0,r.useMemo)((()=>{const e=P.get(c);if(e)return e;const t=new(ae().B)(b,V,{userId:F,inMemoryRecordCache:E});return P.set(c,t),t}),[P,b,E,V,c,F]),D=(0,ed().vY)({firstDate:c,secondDate:m}),z=(0,ed().c_)(c),L=(0,ed().sm)(c),W="date"===h.type,H=!D&&!z&&"week"!==y,N=!_&&R===c&&(W||z)&&M&&(d||f),G=(0,r.useMemo)((()=>1!==(0,ed().wN)(c)||z?(0,ed().wN)(c):`${new Intl.DateTimeFormat(w.locale,{month:"short",day:"numeric"}).format(new Date(c))} `),[w.locale,z,c]),U=(0,r.useCallback)((()=>{const{performResult:e}=et().createAndCommit({userAction:"Calendar.createBlockInDay",environment:b,canUndo:!0,perform:e=>{const t=(0,Xn().Q)({environment:b,collectionContextStore:i,groupsPointer:[],insertAtIndex:0,shouldCoerce:!0,templateStore:i.defaultPageTemplateStore.state,transaction:e,from:{createBlock:"calendar"},inMemoryRecordCache:b.defaultRecordCache.inMemoryRecordCache});if(!t)return;const o=t.newStore.getAssociatedCollectionStore(),n=(null==o?void 0:o.getMappedProperty(S))??S;ud().D5({type:"timestamp",environment:b,store:t.newStore,propertyId:n,timestampMs:c,transaction:e});const r=ne().wy({environment:b,store:t.newStore,mainEditorCurrentBlockStore:A,collectionContextStore:i,showMoveTo:g})??(0,Se().Ay)({store:t.newStore,pageVisitSource:de().y8.Create});return C?C(r):j({environment:b,url:r}),$().Ey({collectionContextStore:i,resultsStore:void 0}),t.newStore}});return e}),[S,i,b,g,A,j,C,c]),q=(0,r.useCallback)(((e,t,n)=>{const r=t.getAssociatedCollectionStore(),i=(null==r?void 0:r.getMappedProperty(S))??S;if(ud().D5({type:"timestamp",environment:b,store:t,propertyId:i,timestampMs:c,transaction:e}),n){var l;const e=Object.keys(n).length+(i in n?0:1),r=(null===(l=t.getModel())||void 0===l?void 0:l.getRenderTitleWithEmojiOrPlaceholder({getRecordModel:t.getRecordModel,userTimeZone:(0,tr().P)(),intl:w}))||"",a=r.length>53?`${r.slice(0,50)}…`:r;(0,o(517415).r)({item:{label:w.formatMessage(gd.linkExistingCompleteToast,{pageTitle:a,numUpdates:e})},undoFunc:()=>{o(495262).tN({environment:b,preventSelectText:!0})}})}}),[S,b,c,w]),{value:X}=(0,T().fJ)(Vt().VI.duplicateActions),Y=(0,r.useCallback)((e=>{et().createAndCommit({userAction:"Calendar.renderDay",environment:b,canUndo:!0,perform:t=>{const o=i.collectionStore();if(!o&&"collectionTypedView"!==i.contextTypeFromStoreState)return;const n=B().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");B().default.DO_NOT_USE_measureAfterNextFlushLegacy(n,{environment:b,getData:()=>Lt().tv({collectionContextStore:i,is_native_drop:!1,is_empty:!1})}),ud().M9({...e,environment:b,startOfDay:c,calendarBy:S,collectionStore:o,collectionContextStore:i,transaction:t,duplicateActions:X})}})}),[S,i,X,b,c]),Q=(0,r.useCallback)((()=>{if((d||f)&&(0,co().E)(b,(0,s().f)(i.collectionStore()))&&M){const e=U();$n().vH(b,{type:"page",from:"calendar_day_double_click",new_page_id:null==e?void 0:e.id,creating_block_id:null==e?void 0:e.id,...(0,Lt().sl)(i)})}}),[d,f,b,M,U,i]),Z=(0,I().IS)((()=>{const e=(()=>{if(L)return u?(0,ts().X4)(K().Tj.tableHomeDividerColor,.05):K().Tj.background.secondary})(),t=H?K().Tj.text.tertiary:z?K().Tj.white:void 0;return{selectable:{position:"relative",flexGrow:1,flexShrink:0,flexBasis:0,borderInlineEnd:`1px solid ${K().Tj.border.primary}`,borderBottom:`1px solid ${K().Tj.border.primary}`,cursor:"default",background:e},dayNumber:{position:"absolute",fontSize:14,top:4,height:24,lineHeight:"24px",color:t,...z?{insetInlineEnd:4,width:24,borderRadius:"100%",textAlign:"center",background:K().Tj.red.background.accentPrimary}:{insetInlineEnd:10,textAlign:"end",transition:"color 100ms ease-out"}}}}),[u,p,z,L,H]),J=(0,Ue().Zp)();return(0,Ge.jsxs)(oo().Ay,{location:"calendarDay",style:Z.selectable,store:O,canDropOnto:d&&W,onSelectableDrop:Y,onDoubleClick:Q,analyticsName:"calendar_day",shouldShowDropZone:!0,children:[!N||null!=J&&J.disablePageLinks?void 0:(0,Ge.jsx)(Sd,{collectionContextStore:i,createBlockFunc:U,updateBlockDayProperty:q}),(0,Ge.jsx)("div",{style:Z.dayNumber,...z?{"data-testid":"today-day-number"}:{},className:v?`${fn().yWO} notion-shimmer-text animation-delay-${l} notion-shimmer-calendar-transition`:`${fn().yWO} notion-shimmer-calendar-transition`,children:G})]},c.toString())}function Sd({collectionContextStore:e,createBlockFunc:t,updateBlockDayProperty:o}){const n=(0,x().v3)(),i=(0,Le().tz)(),l=(0,k().K8)((()=>ne().fG({collectionContextStore:e,environment:n,intl:i})),[e,n,i]),a=(0,r.useCallback)((()=>{const o=(0,s().f)(e.collectionStore());if((0,co().E)(n,o)){const o=t();$n().vH(n,{type:"page",from:"calendar_day_add_button",new_page_id:null==o?void 0:o.id,creating_block_id:null==o?void 0:o.id,...(0,Lt().sl)(e)})}else(0,za().Q)(n,o)}),[n,t,e]),c=(0,I().IS)((()=>({iconToolbar:{position:"absolute",display:"flex",top:6,insetInlineStart:6,padding:2,borderRadius:8,background:K().Tj.popoverBackground,boxShadow:K().Tj.shadowMD,zIndex:1},iconButton:{width:20,height:20}})),[]),d=(0,r.useCallback)(((e,t)=>(0,Ge.jsx)(Ie().A,{ariaLabel:i.formatMessage(gd.addItemLabel),icon:ze().plusIcon,size:"md",style:c.iconButton,onClick:a,...(0,$i().A)(e,{onMouseDown:Ti().t})})),[a,i,c.iconButton]);return(0,Ge.jsxs)("div",{style:c.iconToolbar,children:[(0,Ge.jsx)(Wo().m,{renderTooltip:()=>i.formatMessage(gd.addItemLabel),render:d}),l?(0,Ge.jsx)(Wo().m,{renderTooltip:()=>i.formatMessage(gd.linkExistingLabel),render:t=>(0,Ge.jsx)(kr().O,{collectionContextStore:e,renderLinkButton:e=>(0,Ge.jsx)(Ie().A,{ariaLabel:i.formatMessage(gd.linkExistingLabel),icon:_e().arrowDiagonalUpRightIcon,style:c.iconButton,...e,...(0,$i().A)(t,{onMouseDown:Ti().t})}),onAddOrLink:o})}):null]})}const hd=(0,r.memo)(md);var yd=()=>o(758431),vd=()=>o(869190),fd=()=>o(765974),bd=()=>o(424641),xd=()=>o(222321);const wd=2,Cd=3;function kd(e,t){const{navigate:o}=(0,r.useContext)(Ka().E),{store:n,collectionContextStore:i,handleOpenPeekPage:l}=e,s=(0,x().v3)(),c=(0,r.useRef)(null),d=(0,r.useCallback)((()=>{const e=function(e){const{environment:t,store:o,collectionContextStore:n}=e,{mainEditorCurrentBlockStore:r}=a().default.state;return ne().wy({environment:t,store:o,mainEditorCurrentBlockStore:r,collectionContextStore:n,fullyQualified:!1})}({environment:s,store:n,collectionContextStore:i});e&&(l(),o({environment:s,url:e}))}),[i,s,l,n,o]),u=(0,r.useMemo)((()=>({store:n,renderedType:"page",getNode:()=>c.current,getBlockStore:()=>n,activate:d})),[d,n]);(0,k().K8)((()=>{i.onItemMount(n)}),[i,n]);const p=(0,Ge.jsx)("div",{ref:c,children:(0,Ge.jsx)(Td,{...e})});return(0,Qt().NW)(n,t,u,p)}const Id=r.forwardRef(kd);function Td(e){const t=(0,Le().tz)(),{store:o,row:n,schema:r,format:i,disabled:l,calendarBy:a,showWeekends:s,collectionContextStore:c,includeTime:d,handleOpenPeekPage:p,blockPropertyValueOverlayStore:g,calendarStore:m}=e,S=(0,x().v3)(),{value:h}=(0,T().fJ)($t().T.formulas),y=r[a],v=(0,k().K8)((()=>!l&&"date"===(null==y?void 0:y.type)&&!c.permissionScopesStore.state.isSyncedCollection),[c.permissionScopesStore,l,null==y?void 0:y.type]),{start:f,end:b,startOfWeek:w,endOfWeek:C,startColumn:I,columnCount:j}=(0,bd().Gj)({startUnixTimestampMS:e.start,endUnixTimestampMS:e.end,startOfWeekUnixTimestampMS:e.startOfWeek,endOfWeekUnixTimestampMS:e.endOfWeek}),A=(0,k().K8)((()=>{const e=i.calendar_properties?i.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[],n=e.filter((e=>(0,ja().T)({block:o.getModel(),property:e,schema:r,getRecordModel:o.getRecordModel,userId:S.currentUser.id,userTimeZone:(0,tr().P)(),intl:t,experimentService:u().default,collectionFeatureGates:(0,ar().i)(),formulasModule:h,spaceIdCreator:S.idCreator.getSpaceIdCreatorSync(o.getSpaceId()??""),getRelationEdgeList:(0,sr().Y)({environment:S,spaceId:o.getSpaceId()})})));return n.concat(W().R9(e,n))}),[i.calendar_properties,o,r,S,t,h]),M=(0,k().K8)((()=>(0,Pt().jz)({collectionContextStore:c})),[c]);if(!y||!(0,Zc().$)(y))return null;const P=A.length+(M?1:0),_=f<w,R=void 0!==b&&b>C;return(0,Ge.jsxs)(jd,{store:o,row:n,numRows:P,columnCount:j,startIsBeforeStartOfWeek:_,endIsAfterEndOfWeek:R,startColumn:I,disabled:l,isEditableDate:v,calendarBy:a,showWeekends:s,handleOpenPeekPage:p,children:[M?(0,Ge.jsx)("span",{style:{paddingInlineEnd:4,paddingInlineStart:8,maxWidth:"100%",overflowX:"hidden",textOverflow:"ellipsis"},children:(0,Ge.jsx)(Na().n,{blockStore:o,collectionContextStore:c})}):void 0,(0,Ge.jsx)(_d,{store:o,collectionContextStore:c,disabled:l,start:f,startOfWeek:w,end:b,endOfWeek:C,includeTime:d,propertySchema:y}),(0,Ge.jsx)(Bd,{store:o,sortedProperties:A,startIsBeforeStartOfWeek:_,disabled:l,blockPropertyValueOverlayStore:g}),v?(0,Ge.jsx)(Vd,{store:o,start:f,startOfWeek:w,end:b,endOfWeek:C,calendarBy:a,calendarStore:m}):void 0]})}function jd(e){var t;const{store:o,children:n,columnCount:i,row:l,numRows:s,startColumn:c,disabled:d,isEditableDate:u,calendarBy:p,showWeekends:g,handleOpenPeekPage:m,startIsBeforeStartOfWeek:S,endIsAfterEndOfWeek:h}=e,y=(0,x().v3)(),v=(0,_t().ET)(),f=(0,Ue().Zp)(),b=(0,k().K8)((()=>ne().NM(o)),[o]),w=(0,k().K8)((()=>(0,ta().Wi)(y,o.id)),[y,o.id]),C=Pd(s,(0,k().K8)((()=>{var e;return null===(e=v.collectionViewStore())||void 0===e?void 0:e.getFormat()}),[v])),T=pd+C*l,j=(0,k().uB)(void 0,yd().A),A=(0,k().K8)((()=>io().A.state?!0===j.state.dragging:oa().A.state.hoveredStore===o),[o,j]),M=g?7:5,P=null===(t=(0,ls().y)(o))||void 0===t?void 0:t.background,_=(0,I().IS)((()=>({selectable:{position:"absolute",paddingTop:3,paddingBottom:3,paddingInlineStart:S?0:6,paddingInlineEnd:h?0:6,width:h?`calc(100% / ${M} * ${i} - 1px)`:`calc(100% / ${M} * ${i})`,insetInlineStart:`calc(100% / ${M} * ${c})`,height:C,top:T},haloStyle:{...ne().wh(b),borderRadius:6,marginTop:2,marginBottom:2,marginInlineStart:S?0:5,marginInlineEnd:h?0:5},linkBoxStyle:{height:"100%",background:P??K().Tj.calendarItemBackground,borderStartStartRadius:6,borderStartEndRadius:6,borderEndStartRadius:6,borderEndEndRadius:6,boxShadow:K().Tj.shadowXS,...h&&{borderStartEndRadius:0,borderEndEndRadius:0},...S&&{borderStartStartRadius:0,borderEndStartRadius:0},...w&&{opacity:.5}},linkBoxHoveredStyle:{opacity:w?.5:1,background:P?(0,ts().e$)(P,.2):K().Tj.calendarItemHoveredBackground},linkBoxInnerStyle:{display:"flex",position:"relative",paddingTop:2,paddingBottom:2,height:"100%",alignItems:"flex-start",flexDirection:"column"}})),[i,h,C,M,b,c,S,T,w,P]),R=(0,r.useCallback)((e=>{const t=o.getAssociatedCollectionStore();return t?ud().jo({environment:y,collectionStore:t,collectionContextStore:v,store:o,insertStores:e.insertStores,calendarBy:p,transaction:e.transaction}):[]}),[p,v,y,o]),B=(0,r.useCallback)((e=>{const{transaction:t}=e;o.getAssociatedCollectionStore()&&ir().by({childStore:o,transaction:t})}),[o]),[V,F]=(0,k().K8)((()=>{const{mainEditorCurrentBlockStore:e}=a().default.state,t=ne().wy({environment:y,store:o,mainEditorCurrentBlockStore:e,collectionContextStore:v,fullyQualified:!1});return[(0,Se().Ay)({store:o,fullyQualified:!1,pageVisitSource:de().y8.LinkInPage}),t]}),[y,v,o]),E=(0,k().O$)(v.isInHomeWidgetStore);return(0,Ge.jsx)(oo().Ay,{location:"calendarItem",store:o,style:_.selectable,canSelect:!d,shouldShowHalo:!(E||null!=f&&f.isPreviewing),shouldForceRenderSelectionHalo:b,haloStyle:_.haloStyle,canTriggerContextMenu:!d,showBlockMenuInput:!0,canDrag:u,onInsertAbove:R,onInsertBelow:R,onRemove:B,canInsertAbove:u,canInsertBelow:u,disableDragOnCtrlClick:!0,analyticsName:"calendar",shouldShowDropZone:!0,className:fn().E4t,draggableStore:j,children:(0,Ge.jsx)(be().Q,{style:_.linkBoxStyle,hoveredStyle:_.linkBoxHoveredStyle,pressedStyle:_.linkBoxHoveredStyle,innerStyle:_.linkBoxInnerStyle,onClick:m,href:V,metaHref:F,hovered:A,disabled:null==f?void 0:f.disablePageLinks,disableForOffline:w,children:n})},o.id)}const Ad=24,Md=36;function Pd(e,t){var o;return((null==t?void 0:t.table_wrap)||!0===(null==t||null===(o=t.calendar_properties)||void 0===o||null===(o=o.find((e=>"title"===e.property)))||void 0===o?void 0:o.wrap)?Md:Ad)+e*gi().CL+2*wd+2*Cd}function _d(e){const{store:t,collectionContextStore:o,disabled:i,start:l,startOfWeek:a,end:s,endOfWeek:c,includeTime:d,propertySchema:u}=e,p=(0,x().v3)(),g=l<a,m=s&&s>c,S=(0,k().K8)((()=>(0,Pt().Kk)({collectionContextStore:o,blockStore:t})),[o,t]),h="time_format"in u?u.time_format:ld().CE,[y,v,f]=(0,k().K8)((()=>[t.getIcon(),t.isEmptyPage(),t.hasError()]),[t]),b=(0,r.useCallback)((e=>{const o=t.getIconStore();o&&et().createAndCommit({userAction:"CalendarItem.handleRecordIconChange",environment:p,canUndo:!0,perform:t=>{He().KY({store:o,value:e,transaction:t})}})}),[p,t]),w=(0,k().K8)((()=>{var e,t,n;const r=null===(e=o.collectionViewStore())||void 0===e?void 0:e.getFormat().calendar_properties;return(null===(t=o.collectionViewStore())||void 0===t?void 0:t.getFormat().table_wrap)||!0===(null==r||null===(n=r.find((e=>"title"===e.property)))||void 0===n?void 0:n.wrap)}),[o]),C=(0,I().IS)((()=>({titleContainer:{paddingInlineStart:6,paddingInlineEnd:6,overflow:"hidden",...g&&{paddingInlineStart:12},...m&&{paddingInlineEnd:11},width:"100%",...w?{display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",lineHeight:"17px",height:Md,paddingTop:2}:{height:Ad,whiteSpace:"nowrap"},overflowWrap:"break-word",textOverflow:"ellipsis",fontSize:14,fontWeight:pe().Wy.semibold},recordIconStyle:{display:"inline",float:"inline-start",marginInlineEnd:3,paddingTop:w?2:4},subitemCountIndicatorContainer:{display:"flex",alignItems:"center",float:"inline-end",paddingTop:w?2:4},timeStyle:{color:K().Tj.text.secondary,float:"inline-end",fontSize:10,marginInlineStart:4,height:14,paddingTop:w?2:4},subitemsWrapperStyle:{paddingInlineEnd:0,paddingInlineStart:4}})),[m,g,w]),T=d&&s&&n().IX.fromDateTimes(a,c).contains(s)&&l.day!==s.day,j=(0,k().K8)((()=>o.shouldShowPageIcon()&&(void 0!==y||!v)&&!f),[o,y,v,f]),A=(0,k().K8)((()=>(0,ge().Te)(t)),[t]);return(0,Ge.jsxs)("div",{style:C.titleContainer,children:[j?i?(0,Ge.jsx)(ge().B6,{disabled:!0,icon:y,iconRecordCategory:A,isEmptyPage:v,size:14,style:C.recordIconStyle}):(0,Ge.jsx)(ge().B6,{disabled:!1,store:t,bucket:"secure",icon:y,iconRecordCategory:A,isEmptyPage:v,size:14,style:C.recordIconStyle,onChange:b}):void 0,f?(0,Ge.jsx)(ke().I,{icon:fd().exclamationMarkTriangleFillIcon,colorPalette:"orange",colorVariant:"accentPrimary"}):void 0,(0,Ge.jsx)(Rd,{store:t,titlePropertyIsWrapped:w}),S?(0,Ge.jsx)("div",{style:C.subitemCountIndicatorContainer,children:(0,Ge.jsx)(Ga().W,{blockStore:t,collectionContextStore:o,wrapperStyle:C.subitemsWrapperStyle})}):void 0,d&&n().IX.fromDateTimes(a,c).contains(l)?(0,Ge.jsxs)("div",{style:C.timeStyle,children:[(0,vd().PS)({dateTime:l,humanReadable:!1,timeFormat:h}),T?(0,Ge.jsxs)("span",{children:[" → ",(0,vd().PS)({dateTime:s,humanReadable:!1,timeFormat:h})]}):void 0]}):void 0,(0,Ge.jsx)(me().A,{store:t,shouldWrap:w})]})}function Rd(e){const{store:t,titlePropertyIsWrapped:o}=e,n=(0,I().IS)((()=>({discussionIndicatorStyle:{display:"flex",alignItems:"center",color:K().Tj.text.tertiary,fontSize:12,flexShrink:0},discussionIndicatorContainerStyle:{float:"inline-end",marginInlineStart:4,marginTop:o?-2:1}})),[o]);return(0,Ge.jsx)(Ha().g,{store:t,iconStyle:n.discussionIndicatorStyle,buttonStyle:n.discussionIndicatorContainerStyle,size:12})}function Bd(e){const{store:t,sortedProperties:o,startIsBeforeStartOfWeek:n,disabled:r,blockPropertyValueOverlayStore:i}=e,l=(0,_t().ET)(),a=(0,k().K8)((()=>l.permissionScopesStore.state.isLocked||!l.permissionScopesStore.state.canEditContent),[l.permissionScopesStore]),[s,c]=(0,k().K8)((()=>[ne().Dj({store:t,collectionContextStore:l}),l.collectionViewStore()]),[t,l]);return s?(0,Ge.jsx)("div",{style:{paddingInlineStart:6,paddingInlineEnd:6,overflow:"hidden",width:"100%",...n&&{paddingLeft:12}},children:o.map((e=>(0,Ge.jsx)(vs().BlockPropertyRouter,{store:t,property:e,disabled:r,locked:a,surface:"calendar",tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:s,collectionViewStore:c},e)))}):null}function Vd(e){const{store:t,calendarStore:o,start:n,startOfWeek:i,end:l,endOfWeek:a,calendarBy:s}=e,c=(0,x().v3)(),d=(0,I().IS)((()=>({leftDragHandle:{position:"absolute",top:0,insetInlineStart:-4,height:"100%",width:12,cursor:"col-resize"},rightDragHandle:{position:"absolute",top:0,insetInlineEnd:-4,height:"100%",width:12,cursor:"col-resize"}})),[]),u=(0,r.useCallback)((e=>{ud().GB({calendarStore:o,x:e.currentX,y:e.currentY,calendarBy:s})}),[o,s]),p=(0,r.useCallback)((()=>{et().createAndCommit({userAction:"CalendarItem.handleDraggableDragEnd",environment:c,canUndo:!0,perform:e=>{ud().eW({environment:c,transaction:e,calendarStore:o,calendarBy:s})}})}),[s,o,c]),g=(0,r.useCallback)((()=>{ud().Pt({calendarStore:o})}),[o]),m=n>=i&&(0,Ge.jsx)(xd().A,{render:e=>(0,Ge.jsx)("div",{className:fn().rvW,style:d.leftDragHandle,...e}),onDraggableDragStart:()=>{ud().v7({calendarStore:o,targetStore:t,direction:id().Q.Left})},onDraggableDragMove:u,onDraggableDragEnd:p,onDraggableDragCancel:g}),S=(!l||l&&l<a)&&(0,Ge.jsx)(xd().A,{render:e=>(0,Ge.jsx)("div",{className:fn().mvP,style:d.rightDragHandle,...e}),onDraggableDragStart:e=>{ud().v7({calendarStore:o,targetStore:t,direction:id().Q.Right})},onDraggableDragMove:u,onDraggableDragEnd:p,onDraggableDragCancel:g});return(0,Ge.jsxs)(Ge.Fragment,{children:[m,S]})}function Fd(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:n,calendarStore:i,calendarViewRange:l,canEditCalendar:a,collectionContextStore:s,collectionViewStore:c,currentlyViewedMonth:d,endOfWeek:u,format:p,isInHomeWidget:g,isInPeekRenderer:m,isTypedMsvCollection:S,items:h,propertySchema:y,schema:v,shouldShowShimmer:f,showWeekends:b,sortedResultsStore:w,startOfWeek:C}=e,T=(0,x().v3)(),{isDragging:j,targetStore:A,temporaryValue:M}=(0,k().K8)((()=>{const{isDragging:e}=i.state;return{isDragging:e,targetStore:e?i.state.targetStore:void 0,temporaryValue:e?i.state.temporaryValue:void 0}}),[i]),{targetStoreCollectionStoreSchema:P,targetStoreCollectionStoreCalendarBy:_}=(0,k().K8)((()=>{const e=null==A?void 0:A.getAssociatedCollectionStore();return{targetStoreCollectionStoreSchema:null==e?void 0:e.getSchema(),targetStoreCollectionStoreCalendarBy:null==e?void 0:e.getMappedProperty(n)}}),[A,n]),R=(0,r.useCallback)((()=>{B().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag"),$().Ey({collectionContextStore:s,resultsStore:w});const e=s.normalizedFormatStore.state.collection_peek_mode,t=e||ra().C9.calendar;na().bn(T,{is_peek:!0,from:"calendar",peek_mode:t})}),[s,T,w]),V=b?7:5,F=(0,r.useMemo)((()=>{const e=[];h.forEach((o=>{const r=ae().B.createChildStore(c,{table:ht().ev,id:o.id});j&&A===r&&M||e.push((0,Ge.jsx)(Ed,{blockPropertyValueOverlayStore:t,calendarBy:n,calendarStore:i,collectionContextStore:s,endOfWeek:u,format:p,handleOpenPeekPage:R,item:o,schema:v,showWeekends:b,startOfWeek:C,store:r},o.id))}));const o=j&&M&&(0,ed().uo)(M,(0,tr().P)());if(j&&M&&o&&(0,ld().m6)(C,u,o.start,o.end)&&A&&null!=A&&A.id){const r=h.find((e=>e.id===A.id));e.push((0,Ge.jsx)(Ed,{blockPropertyValueOverlayStore:t,calendarBy:_??n,calendarStore:i,collectionContextStore:s,endOfWeek:u,format:p,handleOpenPeekPage:R,schema:P??v,showWeekends:b,startOfWeek:C,store:A,item:{id:A.id,start:o.start,end:o.end,row:r?r.row:0,includeTime:"datetime"===M.type||"datetimerange"===M.type}},A.id))}return e}),[t,n,i,s,c,u,p,R,j,h,v,b,C,A,_,P,M]),E=(0,r.useMemo)((()=>Math.max(0,...h.map((e=>e.row)))),[h]),O=(0,k().K8)((()=>(0,Pt().jz)({collectionContextStore:s})),[s]),D=(0,I().IS)((()=>{const e=(p.calendar_properties?p.calendar_properties.filter((e=>e.visible&&"title"!==e.property)).map((e=>e.property)):[]).length+(O?1:0),t="week"===l?372:124,o=Pd(e,p);return{container:{position:"relative",display:"flex",height:Math.max((E+1)*o+pd+4,t)}}}),[l,p,E,O]);return(0,Ge.jsxs)("div",{style:D.container,children:[[...Array(V).keys()].map((e=>{const t=(0,ed().K1)({date:C,daysToAdd:e});return(0,Ge.jsx)(hd,{blockStore:o,calendarStore:i,collectionContextStore:s,columnIndex:e,startOfDay:t,calendarBy:n,currentlyViewedMonth:d,canEditCalendar:a,isInHomeWidget:g,isInPeekRenderer:m,isTypedMsvCollection:S,propertySchema:y,calendarViewRange:l,shouldShowShimmer:f},e)})),F]},C.toString())}function Ed(e){const{blockPropertyValueOverlayStore:t,calendarBy:o,calendarStore:n,collectionContextStore:r,endOfWeek:i,format:l,handleOpenPeekPage:a,item:s,schema:c,showWeekends:d,startOfWeek:u,store:p}=e,{canEdit:g,collectionStore:m}=(0,k().K8)((()=>({canEdit:p.canEdit(),collectionStore:p.getAssociatedCollectionStore()})),[p]),{collectionStoreSchema:S,collectionStoreCalendarBy:h}=(0,k().K8)((()=>({collectionStoreSchema:null==m?void 0:m.getSchema(),collectionStoreCalendarBy:null==m?void 0:m.getMappedProperty(o)})),[m,o]);return m?(0,Ge.jsx)(Id,{collectionContextStore:r,store:p,startOfWeek:u,endOfWeek:i,showWeekends:d,start:s.start,end:s.end,row:s.row,includeTime:s.includeTime,format:l,schema:S??c,calendarBy:h??o,disabled:!g,calendarStore:n,blockPropertyValueOverlayStore:t,handleOpenPeekPage:a},p.id):null}const Od=(0,r.memo)(Fd);function Dd(e){const{blockPropertyValueOverlayStore:t,blockStore:o,calendarStore:n,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:a,isInHomeWidget:s,isInPeekRenderer:c,isTypedMsvCollection:d,query:u,resultStore:p,schema:g,sortedResultsStore:m,weeks:S}=e,{isPhone:h}=(0,x().Y0)(),y=(0,k().K8)((()=>{var e,t;return(void 0===(null===(e=p.getState())||void 0===e?void 0:e.blockIds)||0===(null===(t=p.getState())||void 0===t?void 0:t.blockIds.length))&&(0,Yr().iv)({collectionContextStore:i,groupsPointer:[],hasPartialResults:!1})}),[i,p]),{collectionViewStore:v,calendarViewRange:f,showWeekends:b}=(0,k().K8)((()=>{const e=i.collectionViewStore(),t=null==e?void 0:e.getFormatStore();return{collectionViewStore:e,calendarViewRange:(null==t?void 0:t.getKeyStore("calendar_view_range").getValue())??"month",showWeekends:(null==t?void 0:t.getKeyStore("calendar_show_weekends").getValue())??!0}}),[i]);var w;S&&S.length>0&&(null===(w=i.databaseItemsVisibleTracker)||void 0===w||w.handleItemsRenderStart());const C=(0,I().IS)((()=>({container:h?{}:{boxShadow:`calc(var(--direction, 1) * -1px) 0 0 ${K().Tj.border.primary}`,marginTop:1,overflow:"hidden"}})),[h]),{calendar_by:T}=u;if(!T)return null;const j=g[T];return j&&v?(0,Ge.jsx)("div",{style:C.container,children:S?S.map((e=>h?(0,Ge.jsx)(dd,{blockPropertyValueOverlayStore:t,calendarBy:T,calendarViewRange:f,canEditCalendar:r,collectionContextStore:i,currentlyViewedMonth:l,format:a,items:e.items,query:u,schema:g,shouldShowShimmer:y,showWeekends:b,sortedResultsStore:m,startOfWeek:e.start},e.start):(0,Ge.jsx)(Od,{blockPropertyValueOverlayStore:t,blockStore:o,calendarBy:T,calendarStore:n,calendarViewRange:f,canEditCalendar:r,collectionContextStore:i,collectionViewStore:v,currentlyViewedMonth:l,endOfWeek:e.end,format:a,isInHomeWidget:s,isInPeekRenderer:c,isTypedMsvCollection:d,items:e.items,propertySchema:j,schema:g,shouldShowShimmer:y,showWeekends:b,sortedResultsStore:m,startOfWeek:e.start},e.start))):void 0}):null}const zd=(0,r.memo)(Dd);var Ld=()=>o(287940);const Kd=(0,Le().YK)({previousMonthButtonAriaLabel:{id:"database.calendarViewHeader.previousMonthButton.ariaLabel",defaultMessage:"Previous Month"},nextMonthButtonAriaLabel:{id:"database.calendarViewHeader.nextMonthButton.ariaLabel",defaultMessage:"Next Month"},todayButtonLabel:{id:"database.calendarViewHeader.todayButton.label",defaultMessage:"Today"}}),Wd=r.memo((function(e){const{currentlyViewedMonth:t,calendarViewRange:n,setNewCalendarStart:i,isInHomeWidget:l,dateRangeStart:a,isInPeekRenderer:s,stickyStyle:c,collectionContextStore:d,weeks:u,userSettingsStartOfWeekStore:p}=e,g=(0,Le().tz)(),{isPhone:m}=(0,x().Y0)(),S=(0,r.useRef)(null),h=(0,ne().Oz)(d),y=(0,k().K8)((()=>{const e=p.state,t=d.collectionViewStore(),o=null==t?void 0:t.getFormatStore();return(null==o?void 0:o.getKeyStore("calendar_show_weekends").getValue())??!0?(0,vd().zI)(e,ds().locale):(0,vd().rj)(ds().locale)}),[d,p]),v=(0,r.useMemo)((()=>{const e=(0,vd().W_)(t,"month_year_long",ds().locale);if("month"===n)return e;if(!u||void 0===u[0])return"";const o=u[0];if((0,ed().vY)({firstDate:o.start,secondDate:o.end}))return e;return`${(0,vd().W_)(o.start,(0,ed().St)({firstDate:o.start,secondDate:o.end})?"month_short":"month_year_short",ds().locale)} - ${(0,vd().W_)(o.end,"month_year_short",ds().locale)}`}),[t,n,u]),f=(0,r.useCallback)((()=>{const e=p.state,t="month"===n?(0,ed().mK)((0,ed().Mw)(Date.now()),e):(0,ed().mK)(Date.now(),e);i({newCalendarStart:t,calendarViewRange:n,startOfWeek:e})}),[n,i,p]),b=(0,r.useCallback)((e=>{const t=p.state,o=(0,ed().to)(a,t);if("month"===n){const r="left"===e?-1:1,l=(0,ed().mK)((0,ed().Mw)((0,ed().AQ)({date:o,monthsToAdd:r})),t);i({newCalendarStart:l,calendarViewRange:n,startOfWeek:t})}else{const o="left"===e?-7:7,r=(0,ed().mK)((0,ed().K1)({date:a,daysToAdd:o}),t);i({newCalendarStart:r,calendarViewRange:n,startOfWeek:t})}}),[p,a,n,i]),w=(0,r.useCallback)((()=>{b("left")}),[b]),C=(0,r.useCallback)((()=>{b("right")}),[b]),T=(0,I().IS)((()=>{const e=m?K().Tj.background.primary:null!=h&&h.background?h.background:s?K().Tj.background.elevated:K().Tj.background.primary;return{container:{...!l&&{position:"absolute",insetInlineStart:0,insetInlineEnd:0,zIndex:85,background:e}},icon:{width:Kn().Ev.default,height:Kn().Ev.default},monthSwitcher:{display:"flex",height:42,alignItems:"center",marginBottom:2},monthHeader:{fontWeight:pe().Wy.semibold,marginInlineStart:8,marginInlineEnd:8,lineHeight:1,fontSize:m?16:14},spacer:{flexGrow:1},weekdayNamesContainer:{display:"flex",marginTop:m?8:0,boxShadow:`0 1px 0 ${K().Tj.border.primary}`},weekdayName:{flexGrow:1,flexBasis:0,textAlign:"center",fontSize:12,color:K().Tj.text.tertiary,height:24}}}),[h,l,s,m]);return(0,Ge.jsx)(Ci().g,{stickyAttachPoint:l?"no-stick":"ceiling",nodeRef:S,stickyStyle:c,transitionStickyStyle:c,absoluteHeight:98,children:(0,Ge.jsxs)("div",{style:T.container,ref:S,children:[(0,Ge.jsxs)("div",{style:T.monthSwitcher,children:[(0,Ge.jsx)("div",{style:T.monthHeader,children:v}),(0,Ge.jsx)("div",{style:T.spacer}),(0,Ge.jsx)("div",{style:{marginInlineEnd:8,marginTop:2},children:(0,Ge.jsx)(Ld().A,{collectionContextStore:d,entrypoint:"calendar_view"})}),(0,Ge.jsx)(Ie().A,{ariaLabel:g.formatMessage(Kd.previousMonthButtonAriaLabel),icon:o(879765).$,iconStyle:T.icon,onClick:w}),(0,Ge.jsx)(Fr().p,{size:"sm",onClick:f,children:(0,Ge.jsx)(Le().sA,{...Kd.todayButtonLabel})}),(0,Ge.jsx)(Ie().A,{ariaLabel:g.formatMessage(Kd.nextMonthButtonAriaLabel),icon:o(222334).arrowChevronSingleRightIcon,iconStyle:T.icon,onClick:C})]}),(0,Ge.jsx)("div",{style:T.weekdayNamesContainer,className:fn().VO,children:y.map((([e,t])=>(0,Ge.jsx)("div",{style:T.weekdayName,children:t},e)))})]})})})),Hd=r.memo((function(e){const{blockPropertyValueOverlayStore:t,collectionContextStore:n,store:i,format:l,query:a,schema:s,isFullScreen:c,isInPeekRenderer:d,isPreviewing:u,maxHeight:p,minWidth:m,paddingBottom:h,paddingLeft:v,paddingRight:b}=e,j=(0,Le().tz)(),A=(0,x().v3)(),M=A.currentUser.id,{isPhone:_}=(0,x().Y0)(),{value:R}=(0,T().fJ)($t().T.formulas),B=(0,r.useRef)(null),V=(0,r.useRef)(null),E=(0,o(93583).A)(V,B),O=(0,k().uB)(void 0,id().a),D=(0,k().uB)(void 0,P().Store),z=(0,k().K8)((()=>n.collectionViewStore()),[n]),L=null==z?void 0:z.id,K=(0,k().K8)((()=>n.collectionStore()),[n]),H=(0,Qt().bx)(i,!1),N=(0,k().O$)(io().A),G=(0,k().K8)((()=>"collectionTypedView"===n.contextTypeFromStoreState),[n]),$=(0,k().O$)(n.isInHomeWidgetStore),U=(0,k().K8)((()=>Boolean(n.viewsModuleContextStore.getViewModuleType())),[n]),q=(0,k().O$)(n.dateRangeStartStore),X=(0,k().O$)(n.dateRangeEndStore),Y=(0,k().O$)(n.canConfigureBlockStore),Z=(0,k().O$)(n.permissionScopesStore),ee=(0,k().O$)(O),{dayStoreMap:te,startingMonth:oe,isDragging:ne}=ee,re=ne?void 0:ee.hoveredDay,ie=H,le=(0,k().K8)((()=>{var e;return(null==z||null===(e=z.getFormatStore())||void 0===e?void 0:e.getKeyStore("calendar_view_range").getValue())??"month"}),[z]),se=c&&!g().A.isMobile&&"month"===le,ce=(0,k().K8)((()=>{const e=Sr().XX.state;return se||!q?oe:(0,ed().Mw)((0,ed().to)(q,e))}),[se,q,oe]),de=(0,k().K8)((()=>(0,nd().j2)({collectionContextStore:n})),[n],{useDeepEqual:!0}),ue=(0,k().K8)((()=>{if(!z)return[];const e=D.state;if(!e||!e.blockIds)return[];const t=e.blockIds.map((e=>ae().B.createChildStore(z,{id:e,table:ht().ev})))||[];return(0,nd().oq)({collectionContextStore:n,results:t,getRecordValue:i.getRecordValue,intl:j,formulasModule:R,environment:A})}),[z,D,n,i.getRecordValue,j,R,A],{useDeepEqual:!0}),pe=(0,k().r6)((()=>z&&ue&&(null==ue?void 0:ue.flatMap((e=>e.items.map((e=>ae().B.createChildStore(z,{table:ht().ev,id:e.id}))))))||[]),[z,ue],{useDeepEqual:!0,debugName:"sortedResultsStore"});(0,k().O$)(pe);const[ge,me]=(0,r.useState)();(0,r.useEffect)((()=>{var e;null!==(e=B.current)&&void 0!==e&&e.parentElement&&me((0,F().NM)(B.current.parentElement))}),[]);const Se=(0,r.useCallback)((e=>{const{newCalendarStart:t,calendarViewRange:o,startOfWeek:r}=e,i=(0,ed().to)(t,r);let l;"month"===o?(l=se?(0,ed().to)((0,ed().AQ)({date:i,monthsToAdd:1}),r):(0,ed().to)((0,ed().Xf)(i),r),ge&&se&&(ge.scrollTop=0)):l=i,(0,od().r)({dateRangeStart:t,dateRangeEnd:l,collectionContextStore:n}),O.update((e=>({...e,startingMonth:(0,ed().Mw)((0,ed().to)(t,r))}))),L&&(0,rd().LQ)({newCalendarStart:t,newCalendarEnd:l,collectionViewId:L,currentUserId:M})}),[n,O,se,ge,L,M]),he=(0,r.useCallback)((()=>{K&&K.isDefined()&&z&&Y&&et().createAndCommit({userAction:"Calendar.createCalendarProperty",environment:A,canUndo:!0,perform:e=>{let t,o=(0,Jc().z)(s);if(!o&&Z){o=(0,td().Ay)();t={[o]:{name:j.formatMessage({id:"database.calendarView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}if(!o)return;(0,Vi().f)({collectionViewStore:z,update:{calendar_by:o},transaction:e});const r=n.settingsStore;(0,J().O)({collectionContextStore:n,collectionSettingsStore:r}),Q().a2({collectionSettingsStore:r,item:{type:"property",property:o,formatKey:void 0,selectNameInitial:!0}}),He().zv({store:z,data:{type:"calendar"},transaction:e}),t&&(0,ec().F)({environment:A,collectionStore:K,update:t,transaction:e})}})}),[K,z,A,Y,s,j,Z,n]),ye=(0,r.useCallback)((()=>{K&&K.isDefined()&&z&&Y&&et().createAndCommit({userAction:"Calendar.updateCalendarBy",environment:A,canUndo:!0,perform:e=>{const t=(0,Jc().z)(s);t&&((0,Vi().f)({collectionViewStore:z,update:{calendar_by:t},transaction:e}),He().zv({store:z,data:{type:"calendar"},transaction:e}))}})}),[K,z,A,Y,s]),ve=(0,r.useCallback)((e=>{if(!z||!L)return;const t=(0,rd().dI)({collectionViewId:L,currentUserId:M}),o=e.state,n=(0,ed().mK)(t,o),r=(0,ed().mK)(new Date((0,ed().to)(t,o)).getDate()>7?(0,ed().Mw)(t):t,o),i="month"===le?r:n;O.update((e=>({...e,startingMonth:r.valueOf()}))),Se({newCalendarStart:i,calendarViewRange:le,startOfWeek:o})}),[z,L,M,le,O,Se]),fe=(0,r.useCallback)((()=>{if(!V.current||!se)return;const e=W().Ul(Array.from(te.entries()).map((([e,t])=>({store:t,timestamp:e}))),(({timestamp:e})=>e)),t=V.current.getBoundingClientRect(),n=e.find((({store:e})=>{const n=o(836724).T.getRectFromStore(e);if(!n)return;const r=(null==ge?void 0:ge.scrollTop)??0,i=n.top<=t.top+r,l=n.bottom>=t.top+r;return i&&l}));if(n){const e=Sr().XX.state,t=(0,ed().Mw)((0,ed().K1)({date:(0,ed().to)(n.timestamp,e),daysToAdd:1}));t!==oe&&O.update((e=>({...e,startingMonth:t})))}}),[O,te,se,oe,null==ge?void 0:ge.scrollTop]),be=(0,Rl().d)(fe,100),xe=(0,r.useCallback)((e=>{if(e<Mo().B.incrementScrollOffset&&!n.isLoadingStore.state&&se){const e=Sr().XX.state,t=(0,ed().to)((0,ed().AQ)({date:X,monthsToAdd:2}),e);(0,od().r)({dateRangeStart:q,dateRangeEnd:t,collectionContextStore:n})}}),[n,X,q,se]),we=(0,r.useCallback)((e=>{const{target:t,button:o,ctrlKey:n}=e;!(0!==o||A.device.isMac&&n||_)&&t instanceof HTMLElement&&(0,y().SQ)(e,y().y$.EditorMouseDown,(()=>{e.preventDefault(),(0,to().j)({environment:A,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[i],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!1})}))}),[A,_,i]),Ce=(0,r.useCallback)((e=>{if(!N&&(0,nd().kc)(ee)){const t=function(e,t){(0,o(673660).A)();const{selectableRectMap:n}=o(52957).default.state,r=Array.from(te.keys()),i=Array.from(te.values());for(const[o,l]of n.entries())if(l&&Qc().ux(l,e,t)&&i.indexOf(o.props.store)>=0)return r.find((e=>te.get(e)===o.props.store))}(e.clientX,e.clientY);re!==t&&O.update((e=>({...e,hoveredDay:t})))}}),[O,ee,te,re,N]),ke=(0,Rl().d)(Ce,100);(0,w().l)((()=>{ve(Sr().XX),Sr().XX.addListener(ve)})),(0,C().X)((()=>{Sr().XX.removeListener(ve)})),(0,r.useEffect)((()=>{N&&(0,nd().kc)(ee)&&O.update((e=>({...e,hoveredDay:void 0}))),a.calendar_by||ye()}),[O,ee,N,a.calendar_by,ye]),(0,r.useEffect)((()=>{const e=B.current,t=null==e?void 0:e.parentElement,o=ge;return t&&((0,S().P)(t,"mousemove",ke),o&&(0,S().P)(o,"scroll",be)),()=>{t&&(0,f().O)(t,"mousemove",ke),o&&(0,f().O)(o,"scroll",be)}}),[ke,be,ge]);const Ie=(0,I().IS)((()=>({scroller:{height:"calc(100% - 66px)",maxHeight:p?p-(_?74:66):"inherit",paddingBottom:16,maskImage:"none",WebkitMaskImage:"none",...$?{paddingTop:12}:{}},scrollOffset:$?{height:"100%",maxHeight:"inherit"}:{},selectable:{position:"relative",paddingInlineStart:1,...$&&{height:"100%",maxHeight:"inherit"}},container:{paddingBottom:h,paddingInlineStart:v,paddingInlineEnd:b,minWidth:m,...$&&{height:"100%",maxHeight:"inherit"}},sticky:{paddingInlineStart:v,paddingInlineEnd:b,minWidth:m}})),[$,_,p,m,h,v,b]),Te=(0,Ue().Zp)(),je=(0,r.useCallback)((()=>(0,Ol().A)((e=>(0,Ge.jsx)(fi().b,{nodeRef:V,children:(0,Ge.jsx)(Bl().A,{onChange:xe,style:Ie.scrollOffset,children:(0,Ge.jsx)("div",{ref:E,style:Ie.container,className:fn().G1r,children:(0,Ge.jsxs)(oo().Ay,{location:"collectionCalendar",store:i,onMouseDown:we,style:Ie.selectable,shouldShowHalo:!c&&!$&&!u,canSelect:!c&&!U,analyticsName:"calendar",disablePointerEvents:null==Te?void 0:Te.disableContentPointerEvents,...e,children:[null!=Te&&Te.disableContentPointerEvents?void 0:(0,Ge.jsx)(Wd,{collectionContextStore:n,weeks:ue,userSettingsStartOfWeekStore:Sr().XX,dateRangeStart:q,currentlyViewedMonth:ce,setNewCalendarStart:Se,calendarViewRange:le,isInHomeWidget:$,isInPeekRenderer:d,stickyStyle:Ie.sticky}),$?(0,Ge.jsx)(Tn,{style:Ie.scroller,children:(0,Ge.jsx)(zd,{blockPropertyValueOverlayStore:t,collectionContextStore:n,blockStore:i,calendarStore:O,resultStore:D,sortedResultsStore:pe,format:l,query:a,schema:s,weeks:ue,isInPeekRenderer:d,currentlyViewedMonth:ce,canEditCalendar:ie,isInHomeWidget:$,isTypedMsvCollection:G})}):(0,Ge.jsx)(zd,{blockPropertyValueOverlayStore:t,collectionContextStore:n,blockStore:i,calendarStore:O,resultStore:D,sortedResultsStore:pe,format:l,query:a,schema:s,weeks:ue,isInPeekRenderer:d,currentlyViewedMonth:ce,canEditCalendar:ie,isInHomeWidget:$,isTypedMsvCollection:G})]})})})})))),[xe,Ie.scrollOffset,Ie.container,Ie.selectable,Ie.sticky,Ie.scroller,E,i,we,c,$,u,U,null==Te?void 0:Te.disableContentPointerEvents,n,ue,q,ce,Se,le,d,t,O,D,pe,l,a,s,ie,G]),{calendar_by:Ae}=a;if(!Ae)return(0,Ge.jsx)(Nd,{collectionContextStore:n,isFullScreen:c,paddingBottom:h,paddingLeft:v,paddingRight:b,createCalendarProperty:he});const Me=s[Ae];return Me&&(0,Zc().$)(Me)?de?(0,Ge.jsx)(Xr().A,{id:Bn().Lo,resultStore:D,collectionContextStore:n,reducer:de,render:je}):null:(0,Ge.jsx)(Nd,{collectionContextStore:n,isFullScreen:c,paddingBottom:h,paddingLeft:v,paddingRight:b,createCalendarProperty:he})}));function Nd(e){const{collectionContextStore:t,isFullScreen:o,paddingBottom:n,paddingLeft:r,paddingRight:i,createCalendarProperty:l}=e,a=(0,k().O$)(t.canConfigureBlockStore),s=(0,I().IS)((()=>({container:{paddingInlineStart:r,paddingInlineEnd:i,paddingBottom:o?void 0:n}})),[o,n,r,i]);return(0,Ge.jsx)(ac().Ay,{style:s.container,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"No date property",id:"database.calendarView.missingDatePropertyTitle"}),description:a?(0,Ge.jsx)(Le().sA,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Calendar view.",id:"database.calendarView.missingDateProperty",values:{opensettingslink:e=>(0,Ge.jsx)(ac().P6,{onClick:()=>{l()},children:e})}}):(0,Ge.jsx)(Le().sA,{defaultMessage:"Calendar views require a date property in order to display.",id:"database.calendarView.missingDatePropertyNoPermissions"})})}const Gd=(0,T()._h)(new(T().O2)("CollectionDashboardView",(async()=>await Promise.all([o.e(38293),o.e(80325)]).then(o.bind(o,566380)))),(e=>e.CollectionDashboardView));function $d(e){const t=(0,x().v3)(),{store:o,collectionContextStore:n,disabled:l,groupsPointer:a,collectionStore:s,subitemPath:c,indentLevel:d,onSubitemCreate:u,paddingLeft:p}=e,{isSubitemToggleOnTitleColumn:m,viewType:S}=(0,k().K8)((()=>{const e=n.collectionViewStore();return{isSubitemToggleOnTitleColumn:"title"===(null==e?void 0:e.getFormat().table_subitem_toggle_column),viewType:null==e?void 0:e.getType()}}),[n]),h=(0,ln().Sm)(o),y=(0,I().IS)((()=>{const t="list"===S?24:22,{fontSize:o,iconSize:n}={fontSize:g().A.isMobile?gi().hN:gi().Mi,iconSize:g().A.isMobile?Kn().Ev.default:Kn().Ev.sm},r=(0,te().si)({columnIndex:0,titleColumnIndex:0,indentLevel:d,isSubitemToggleOnTitleColumn:m});return{newRowButtonWrapper:{display:"flex",alignItems:"center",height:xn().wc,width:"100%",paddingInlineStart:r,borderBottom:`1px solid ${K().Tj.border.secondaryTranslucent}`,insetInlineStart:0,insetInlineEnd:0,..."timeline"===S&&{borderTop:"none"},...e.styles},newRowButton:{display:"inline-flex",alignItems:"center",fontSize:o,height:28,borderRadius:6,paddingInlineStart:6,paddingInlineEnd:8,marginInlineStart:t,position:"sticky",insetInlineStart:p+r+t},newRowContainer:{display:"inline-flex",alignItems:"center",position:"sticky",insetInlineStart:r+8,color:K().Tj.text.tertiary},newIcon:{width:n,height:n,marginInlineEnd:g().A.isMobile||"list"===S?8:7,marginInlineStart:g().A.isMobile?2:void 0}}}),[S,d,m,e.styles,p]),{isInLibraryBlock:v,sourceType:f}=(0,k().K8)((()=>{var e;return{isInLibraryBlock:n.isInLibraryBlock(),sourceType:null===(e=n.collectionViewStore())||void 0===e||null===(e=e.getCollectionSource())||void 0===e?void 0:e.type}}),[n]),b=(0,wi().V)(n),w=(0,k().K8)((()=>{const e=n.permissionScopesStore.state,t=s.isSyncedCollection();if(v)return o.canEdit()&&!o.isLocked();return(b||!l&&e.canEditContent)&&!t}),[n,l,s,v,o,b]),C=(0,r.useCallback)((e=>{if(v)return et().createAndCommit({userAction:"CollectionNestedCreateSubitemButton.createdPage",environment:t,canUndo:!0,perform:e=>{const n=_r().rU({environment:t,store:o,transaction:e,navigateToParent:!1,from:"library"});n&&u(n)}}),void((0,Nn().a0)(f)&&(0,Rr().bD)({environment:t,libraryViewName:f}));et().createAndCommit({userAction:"CollectionNestedCreateSubitemButton.handleClick",environment:t,canUndo:!0,perform:r=>{const i=(0,aa().u)({environment:t,collectionContextStore:n,groupsPointer:a,store:o,before:!1,collectionStore:s,transaction:r,subitemPath:c,subitemInsertDirection:"into",from:"cvb_new_subitem",event:e});i&&u(i)}}),function(e,t){(0,i().DO_NOT_USE_trackLegacy)(e,"create_subitem",t)}(t,{...(0,Lt().sl)(n)})}),[n,t,a,s,o,c,u,f,v]);return!w||h?null:(0,Ge.jsx)("div",{style:y.newRowButtonWrapper,children:(0,Ge.jsx)(ui().Ay,{onClick:C,onMouseDown:Ti().t,style:y.newRowButton,children:(0,Ge.jsxs)("span",{style:y.newRowContainer,children:[(0,Ge.jsx)(ke().I,{icon:Ho().plusSmallIcon,colorVariant:"tertiary",style:y.newIcon}),(0,Ge.jsx)(Dn().D,{styleKey:"bodyRegular",colorVariant:"tertiary",children:v?(0,Ge.jsx)(Le().sA,{defaultMessage:"Add new",id:"database.tableView.nest.addNew"}):(0,Ge.jsx)(Le().sA,{defaultMessage:"New sub-item",id:"database.tableView.nest.addSubitem"})})]})})})}var Ud=()=>o(308195),qd=()=>o(372267),Xd=()=>o(66129);const Yd=r.memo((function(e){const{property:t,propertyIndex:o,showProperties:n,blockPropertyValueOverlayStore:i,store:l,schema:a,collectionContextStore:s,disabled:c,isEditing:d,mouseIsEntered:u}=e,p=(0,x().v3)(),g=(0,k().K8)((()=>ne().Dj({store:l,collectionContextStore:s})),[l,s]),m=(0,k().K8)((()=>s.collectionViewStore()),[s]),S=(0,k().O$)(s.isInHomeWidgetStore),h=(0,k().O$)(s.isUnlistedViewStore),y=(0,k().O$)(s.isInlineViewStore),{isLocked:v,canEditContent:f}=(0,k().O$)(s.permissionScopesStore),b=(0,r.useMemo)((()=>{if("title"!==t)return!1;return u&&!S&&!(h&&y)}),[S,y,h,u,t]),w=(0,k().K8)((()=>l.canEdit()),[l]),C=d||S,I=(0,r.useCallback)((async()=>wr().V_(p,i,l,a,n,s,d)),[p,i,l,a,n,s,d]),T=(0,r.useCallback)((async()=>wr().Un(p,i,l,a,n,s,d)),[p,i,l,a,n,s,d]),j=(0,r.useCallback)((()=>wr().lY(p,i,l)),[p,i,l]),A=(0,r.useCallback)((()=>wr().PH(l)),[l]);return g?(0,Ge.jsx)(vs().BlockPropertyRouter,{store:l,property:t,propertyIndex:o,disabled:c||!w,locked:v||!f,surface:"list",tableWrap:!1,blockPropertyValueOverlayStore:i,collectionStore:g,collectionViewStore:m,forceMouseEntered:b,showIfEmpty:C,onBgClick:j,onEnter:j,onEsc:j,onTab:T,onUntab:I,onClick:A},t):null}));function Qd(e){const{collectionContextStore:t,toggleButton:o,subitemPath:n}=e,r=(0,k().O$)(t.currentSubitemFormatStoreForUiDisplayStore),i=(null==n?void 0:n.length)??0,l=(0,Pt().KC)(i),a=(0,I().IS)((()=>({noToggleIndent:{minWidth:l+Pt().yy},toggleIndent:{minWidth:l},container:{paddingTop:g().A.isMobile?8:4,display:"flex"}})),[l]);return r?o?(0,Ge.jsxs)("div",{style:a.container,children:[(0,Ge.jsx)("div",{style:a.toggleIndent}),o]}):(0,Ge.jsx)("div",{style:a.noToggleIndent}):null}const Zd=r.forwardRef((function(e,t){var n;const{store:i,schema:l,blockPropertyValueOverlayStore:a,handleOpenPeekPage:s,collectionContextStore:c,onShiftEnter:d,toggleButton:u,subitemPath:p,showProperties:m,disabled:S,isLast:h}=e,y=(0,Le().tz)(),v=Boolean(e.passesFilter),f=(0,x().v3)(),{isPhone:b}=(0,x().Y0)(),w=(0,Ue().Zp)(),T=(0,k().K8)((()=>c.shouldShowPageIcon()),[c]),j=(0,r.useRef)(null),A=(0,r.useRef)(null),[M,P]=(0,r.useState)(!1),[_,R]=(0,r.useState)(!1),[B,V]=(0,r.useState)(!1),[F,E]=(0,r.useState)(!1),O=(0,k().K8)((()=>{const e=ia().A.state;return Boolean(e.isActive&&e.store.id===i.id)}),[i.id]),D=(0,k().K8)((()=>{const e=Ud().A.state;return e.store&&e.store.id===i.id?e.editMode:void 0}),[i.id]),z=(0,Rl().d)((()=>{io().A.state||E(!0)}),100),L=(0,_l().Y)((()=>{E(!1)}),100),W=(0,Rl().d)((()=>{V(!0)}),100),H=(0,Rl().d)((()=>{R(!0)}),100),N=(0,k().K8)((()=>Et().default.state.stores.length>0&&Et().default.state.stores[0].id===i.id),[i.id]),G=(0,r.useCallback)((()=>{const e=qd().NK({environment:f,store:i,collectionContextStore:c});e&&(s(),(0,Da().navigate)({environment:f,url:e}))}),[f,s,i,c]),$=(0,k().K8)((()=>i.getBlockTitleStore()),[i]),U=(0,k().K8)((()=>qd().uM((0,Xd().z)(i))),[i]),q=(0,k().K8)((()=>qd().NK({environment:f,store:(0,Xd().z)(i),collectionContextStore:c})),[f,i,c]),X=(0,k().K8)((()=>m.map((e=>i.getPropertyValue(e)))),[m,i]),Y=(0,r.useCallback)((()=>{wr().zU(i,s)}),[i,s]),Q=(0,r.useCallback)((()=>{A.current&&P(A.current.scrollWidth>A.current.clientWidth)}),[]),Z=(0,Rl().d)(Q,100),J=(0,k().K8)((()=>(0,ta().Wi)(f,i.id)),[f,i]),ee=Cs().kG+Cs().mA,te=null===(n=(0,ls().y)(i))||void 0===n?void 0:n.background,oe=(0,k().K8)((()=>Boolean(c.normalizedFormatStore.state.collection_group_by)),[c])&&!h,ne=(0,I().IS)((()=>({container:{display:"flex",position:"relative"},linkBox:{position:"relative",...qd().nq(O?"multi":"single"),...te&&{background:te}},mobileLinkBox:{flexGrow:1,textDecoration:"none",overflow:"hidden",borderBottom:oe?`1px solid ${K().Tj.border.secondary}`:void 0,borderImage:T&&oe?`linear-gradient(to right, transparent ${ee+Cs().qR}px, ${K().Tj.border.secondary} ${ee+Cs().qR}px) 1`:void 0,...te&&{background:te}},linkBoxInner:{display:"flex",alignItems:"center",paddingInlineStart:4,userSelect:O?void 0:"none",WebkitUserSelect:O?void 0:"none",opacity:v?1:.5},mobileLinkBoxInner:{paddingInlineStart:Cs().qR,paddingInlineEnd:4,paddingBottom:4,paddingTop:4},propertiesWithTitleContainer:{display:"flex",alignItems:"center"},propertiesAfterTitleContainer:{display:"flex",alignItems:"center",paddingInlineStart:g().A.isMobile&&T?ee-Cs().iH:g().A.isMobile?0:6,paddingBottom:g().A.isMobile?6:4},hoveredStyle:{background:tu({isEditing:O,backgroundColor:te})},pressedStyle:{background:eu({isEditing:O,backgroundColor:te})},overflowButtonArea:{position:"absolute",insetInlineEnd:-28,top:"50%",transform:"translateY(-50%)",width:28,height:"100%",cursor:"pointer"},overflowButton:{position:"absolute",insetInlineEnd:0,top:"50%",transform:"translateY(-50%)",display:"flex",width:20,height:20,borderRadius:4,justifyContent:"center",alignItems:"center",isolation:"isolate",zIndex:2,backdropFilter:"blur(8px)",background:K().Tj.background.elevated,transition:"none",paddingInlineStart:2,paddingInlineEnd:0},overflowIcon:{width:12,height:12,fill:K().Tj.icon.tertiary,marginInlineStart:-2}})),[O,te,T,ee,v,oe]);(0,r.useEffect)((()=>{O&&"new"===D&&(0,Fa().z)({store:$})}),[O,D,$]),(0,r.useEffect)((()=>(window.addEventListener("resize",Z),()=>window.removeEventListener("resize",Z))),[Z]),(0,r.useEffect)((()=>{Z()}),[Z,X]),(0,C().X)((()=>{Ud().A.reset(),ia().A.reset()}));const re=(0,r.useMemo)((()=>m.indexOf("title")),[m]),ie=b&&m.length>0,le=(0,Ge.jsx)(Qd,{collectionContextStore:c,toggleButton:u,subitemPath:p}),ae=(e,t)=>(0,Ge.jsx)(Yd,{blockPropertyValueOverlayStore:a,collectionContextStore:c,disabled:S,isEditing:O,mouseIsEntered:F,property:e,propertyIndex:t,showProperties:m,schema:l,store:i},e);let se;if(ie){const[e,t]=[m.slice(0,re+1),m.slice(re+1)];se=(0,Ge.jsxs)("div",{style:ne.container,ref:j,children:[le,(0,Ge.jsxs)(be().Q,{ref:A,href:U,metaHref:q,external:!1,style:ne.mobileLinkBox,innerStyle:ne.mobileLinkBoxInner,disabled:null==w?void 0:w.disablePageLinks,disableForOffline:J,children:[(0,Ge.jsx)("div",{style:ne.propertiesWithTitleContainer,children:e.map(ae)}),t.length>0?(0,Ge.jsx)("div",{style:ne.propertiesAfterTitleContainer,children:t.map(ae)}):void 0]})]})}else{const e=y.formatMessage({id:"collectionList.overflow.tooltip",defaultMessage:"See all properties"});se=(0,Ge.jsx)(mt().N,{debugName:"ListItem",capture:N,onShiftEnter:d,children:(0,Ge.jsxs)("div",{style:ne.container,ref:j,onMouseEnter:H,onMouseLeave:()=>R(!1),children:[le,(0,Ge.jsx)(be().Q,{ref:A,href:U,metaHref:q,altHref:q,onClick:Y,external:!1,style:ne.linkBox,innerStyle:ne.linkBoxInner,hoveredStyle:ne.hoveredStyle,pressedStyle:ne.pressedStyle,onMouseEnter:z,onMouseMove:z,onMouseLeave:L,disabled:null==w?void 0:w.disablePageLinks,disableForOffline:J,children:m.map(ae)}),M?(0,Ge.jsx)("div",{style:ne.overflowButtonArea,children:B||_?(0,Ge.jsx)(Wo().m,{renderTooltip:()=>e,placement:"bottom",render:t=>(0,Ge.jsx)(Ie().A,{icon:o(569397).arrowStraightRightSmallIcon,iconStyle:ne.overflowIcon,ariaLabel:e,style:ne.overflowButton,onClick:G,onMouseEnter:W,onMouseLeave:()=>V(!1),...t})}):null}):null]})})}return(0,Qt().NW)(i,t,(0,r.useMemo)((()=>({renderedType:"page",getBlockStore:()=>i,getNode:()=>j.current,activate:G})),[i,G]),se)})),Jd=r.memo(Zd);function eu(e){const{isEditing:t,backgroundColor:o}=e;return o?(0,ts().e$)(o,.3):t?"transparent":K().Tj.buttonPressedBackground}function tu(e){const{isEditing:t,backgroundColor:o}=e;return o?(0,ts().e$)(o,.2):t?"transparent":K().Tj.buttonHoveredBackground}function ou(){return{marginTop:1,marginBottom:1}}const nu=r.memo((function(e){const{groupFormat:t,store:o,format:n,disabled:i,collectionContextStore:l,schema:a,blockPropertyValueOverlayStore:s,paddingLeft:c,paddingRight:d,headerWidth:u,shouldShowShimmer:p}=e,g=(0,x().v3)(),m=(0,r.useMemo)((()=>t?[t]:[]),[t]),S=(0,k().K8)((()=>l.getIsInDashboardBuildMode()),[l]),h=(0,r.useMemo)((()=>(n.list_properties?n.list_properties:[]).filter((e=>e.visible)).map((({property:e})=>e))),[n]),y=(0,k().O$)(l.permissionScopesStore),v=(0,k().K8)((()=>l.groupsStore.getGroupState(m)),[m,l]),f=(0,k().K8)((()=>!i&&o.canEdit()&&y.canEditContent&&!y.isSyncedCollection),[i,o,y]),b=(0,r.useCallback)((()=>{if(!v)return;const e=l.collectionStore();if(!e||!l.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=Et().default.state.stores[0];if(!t)return;const o=l.subitemTreeStore.state,n=(0,nr().Qe)(o.children,(e=>e.value.store===t)),r=n?(0,Pt().kY)(n.map((e=>e.value.store))):"",i=l.subitemExpandedStore.state.get(r),a=Boolean(null==i?void 0:i.isExpanded);et().createAndCommit({userAction:"ListView.onItemShiftEnter",environment:g,canUndo:!0,perform:o=>{const r=(0,aa().u)({environment:g,collectionContextStore:l,groupsPointer:v.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:n,subitemInsertDirection:a?"into":"below",from:"list_selection_overlay_shift_enter"});r&&wr().v7({environment:g,newStore:r,previousStore:t})}}),(0,Xa().u)(g,"list_item_edit_mode_enter",{...(0,Lt().sl)(l),block_id:t.id,from:"shiftEnter",view_type:"list"})}),[l,g,v]),w=(0,r.useCallback)(((e,t)=>{wr().v7({environment:g,newStore:t,previousStore:e})}),[g]),C=(0,r.useMemo)((()=>({blockPropertyValueOverlayStore:s,collectionContextStore:l,disabled:i,onShiftEnter:b,schema:a,showProperties:h,collectionViewBlockStore:o})),[s,l,i,b,a,h,o]),I=(0,r.useCallback)((e=>{const{store:t,parentStore:o,subitemPath:n,indentLevel:r}=e;if(o)return(0,Ge.jsx)($d,{store:t,collectionStore:o,subitemPath:n,indentLevel:r,collectionContextStore:l,disabled:i,groupsPointer:m,paddingLeft:c,styles:{borderBottom:void 0,borderTop:void 0},onSubitemCreate:e=>{(0,Ta().C)({store:e,transient:!1}),Ud().A.setState({store:e,editMode:"new",previousStore:void 0})}})}),[l,i,m,c]);return v?(0,Ge.jsx)(fa,{collectionContextStore:l,groupsPointer:m,format:n,canDrag:f,itemProps:C,renderItem:Jd,canDrop:!0,disabled:i,shouldShowHoverMenu:!S,direction:ya.Vertical,analyticsName:"list",getItemSelectableStyle:ou,emptyDroppableSize:0,onSelectableInsertRow:w,nestedCreateSubitemButton:I,paddingLeft:c,paddingRight:d,headerWidth:u,shouldShowShimmer:p}):null}));const ru=r.memo((function(e){const{store:t,format:o,paddingBottom:n,paddingLeft:i,paddingRight:l,isFullScreen:a,isPreviewing:s,isRootChild:c,minWidth:d,disabled:u,collectionContextStore:p,headerWidth:m}=e,S=(0,x().v3)(),h=(0,k().K8)((()=>ne().mM(p,a)),[p,a]),y=(0,k().K8)((()=>null==p?void 0:p.isInHomeWidgetStore.state),[p]),v=(0,In().X)(p),f=(0,k().K8)((()=>"collectionSystemView"===(null==p?void 0:p.contextTypeFromStoreState)),[p]),b=(0,k().K8)((()=>Boolean(p.viewsModuleContextStore.getViewModuleType())),[p]),w=o.collection_group_by,C=(0,r.useCallback)(((e,t,o)=>{if(g().A.isMobile)(0,El().u)({environment:S,store:e,pageVisitSource:de().y8.Create});else if(t)wr().v7({environment:S,newStore:e,previousStore:void 0});else{const{groupFormat:t}=o,n=t?[t]:[],r=p.groupsStore.getGroupState(n),i="collectionTypedView"===p.contextTypeFromStoreState;(0,Kr().V)({environment:S,store:e,peekMode:ne().hH(p),showMoveTo:i,resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:p,pageVisitSource:de().y8.Create})}}),[S,p]),T=(0,r.useCallback)((()=>({})),[]),j=(0,r.useCallback)((e=>(0,Ge.jsx)(iu,{collectionGroupHeaderProps:e})),[]),A=(0,r.useCallback)((o=>(0,Ge.jsx)(Qs,{reducerId:Bn().FD,store:t,collectionContextStore:p,disabled:u,isFullScreen:a,isRootChild:c,paddingLeft:i,paddingRight:l,headerWidth:m,stickyLeft:!1,renderGroupResults:function(t){return(0,Ge.jsx)(lu,{...e,groupFormat:t})},getGroupStyle:T,renderHeader:j,onGroupHeaderAddItem:C})),[e,p,u,T,C,m,a,c,i,l,t,j]),M=(0,r.useCallback)((e=>{const t=p.isLoadingStore.state,o=p.groupsStore.getGroupState([]);if(!o)return;if("collectionSystemView"===p.contextTypeFromStoreState)return;const n=o.reducerResultStore.state;e<Mo().B.incrementScrollOffset&&n&&!t&&n.hasMore&&(0,Vl().H)({collectionContextStore:p,environment:S,incrementLimitArgs:{isFullScreen:a,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[p,S,a]),P=(0,I().IS)((()=>({container:{paddingBottom:y||v?0:n,paddingInlineStart:i,paddingInlineEnd:l,minWidth:d},selectable:{display:"flex",flexDirection:"column",paddingTop:w||y||f?void 0:4,paddingBottom:v?0:4}})),[n,i,l,d,w,y,f,v]),_=(0,Ue().Zp)();return(0,Ol().A)((o=>(0,Ge.jsxs)("div",{style:P.container,className:fn()._OD,children:[(0,Ge.jsx)(oo().Ay,{location:"collectionListView",store:t,shouldShowHalo:!(a||y||v||s),canSelect:!a&&!b,disablePointerEvents:null==_?void 0:_.disableContentPointerEvents,analyticsName:"list",style:P.selectable,...o,children:w?A(w):(0,Ge.jsx)(lu,{...e,groupFormat:w})}),h?void 0:(0,Ge.jsx)(Bl().A,{onChange:M})]})))}));function iu(e){const{collectionGroupHeaderProps:t}=e,{collectionContextStore:o}=t,n=(0,k().O$)(o.isInHomeWidgetStore),r=(0,I().IS)((()=>({stickyStyle:{boxShadow:`0 -1px 0 ${K().Tj.background.primary}`}})),[]);return(0,Ge.jsx)(Sl,{...t,height:n?Fl().ag:48,stickyStyle:r.stickyStyle})}const lu=r.memo((function(e){const{store:t,format:n,schema:i,disabled:l,groupFormat:a,isFullScreen:s,collectionContextStore:c,blockPropertyValueOverlayStore:d,paddingLeft:u,paddingRight:p,headerWidth:m}=e,S=void 0!==a,h=(0,r.useMemo)((()=>a?[a]:[]),[a]),{groupState:y,isEmpty:v}=(0,k().K8)((()=>{const e=c.groupsStore.getGroupState(h);return{groupState:e,isEmpty:0===(null==e?void 0:e.resultsStore.state.length)}}),[c,h]),f=(0,k().O$)(null==y?void 0:y.reducerResultStore),b=""!==(0,k().O$)(c.searchQueryStore),x=(0,k().K8)((()=>(0,qn().N)({collectionContextStore:c}).length>0),[c]),w=(0,k().K8)((()=>c.groupsStore.anyGroupHasResults()),[c]),{canEditContent:C,isSyncedCollection:T}=(0,k().K8)((()=>{const e=c.permissionScopesStore.state;return{canEditContent:e.canEditContent,isSyncedCollection:e.isSyncedCollection}}),[c]),j=(0,wi().V)(c),A=(0,k().K8)((()=>"collectionTypedView"===c.contextTypeFromStoreState),[c]),M=(0,k().O$)(c.isInHomeWidgetStore),P=(0,In().X)(c),_=v&&(b||x),R=(0,k().K8)((()=>{const e=j||!l&&t.canEdit()&&(C||A);return w&&e&&!T&&!_&&!P}),[w,l,t,C,A,T,_,P,j]),B=void 0!==f&&(null==f?void 0:f.blockIds.length)>0,V=(0,k().K8)((()=>(0,Yr().iv)({collectionContextStore:c,groupsPointer:h,hasPartialResults:B})),[c,h,B]),F=(0,k().K8)((()=>ne().XQ({collectionContextStore:c,reducerResult:f,isFullScreen:s})),[c,f,s]),E=(0,I().IS)((()=>({groupLoadMoreButton:{fontSize:g().A.isMobile?gi().hN:gi().Mi,marginTop:g().A.isMobile?4:void 0,paddingInlineStart:6,paddingInlineEnd:8},groupLoadMoreIcon:{width:g().A.isMobile?Kn().Ev.default:Kn().Ev.sm,height:g().A.isMobile?Kn().Ev.default:Kn().Ev.sm,marginInlineStart:g().A.isMobile?0:1,marginInlineEnd:g().A.isMobile?6:8},spacer:{width:"100%",borderTop:a||M?void 0:`1px solid ${K().Tj.border.primary}`,marginTop:4,marginBottom:4}})),[a,M]);return y?(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)(nu,{groupFormat:a,store:t,format:n,disabled:l,collectionContextStore:c,schema:i,blockPropertyValueOverlayStore:d,paddingLeft:u,paddingRight:p,headerWidth:m,shouldShowShimmer:V}),V?(0,Ge.jsx)(o(286993).c,{isFullScreen:s,hasGroups:S,hasPartialResults:B,hasSearchQuery:b,overrideNumShimmerRows:M&&!B?6:void 0}):void 0,R?(0,Ge.jsxs)(Ge.Fragment,{children:[F?(0,Ge.jsx)("div",{style:E.spacer}):void 0,(0,Ge.jsx)(au,{collectionContextStore:c,isFullScreen:s,groupState:y,groupFormat:a})]}):void 0,F?(0,Ge.jsx)(zl().jJ,{groupsPointer:h,store:t,collectionContextStore:c,format:n,isFullScreen:s,incrementLimitsInRelatedGroups:!1,style:E.groupLoadMoreButton,iconStyle:E.groupLoadMoreIcon}):void 0]}):null})),au=r.memo((function(e){const{groupState:t,groupFormat:o,collectionContextStore:n,isFullScreen:i}=e,l=(0,x().v3)(),a=(0,Le().tz)(),c=(0,k().O$)(n.isInHomeWidgetStore),d=(0,k().K8)((()=>ne().fG({collectionContextStore:n,environment:l,intl:a})),[n,l,a]),u=(0,r.useCallback)((()=>{const e=(0,s().f)(n.collectionStore());if(!(0,co().E)(l,e))return void(0,za().Q)(l,e);const o=n.currentSubitemFormatStoreForUiDisplayStore.state;et().createAndCommit({userAction:"ListView.handleAddItemClick",environment:l,canUndo:!0,perform:e=>{wr().hn({transaction:e,environment:l,results:t.resultsStore.state,collectionContextStore:n,isFullScreen:i,groupsPointer:t.groupsPointer,insertAtIndex:t.resultsStore.state.length,from:o?"list_view_add_parent_item_bottom":"list_view_add_item_bottom"})}})}),[l,t,n,i]),p=(0,I().IS)((()=>({button:{display:"flex",alignItems:"center",height:g().A.isMobile?44:30,borderRadius:6,fontSize:g().A.isMobile?gi().hN:gi().Mi,color:K().Tj.text.tertiary,paddingInlineStart:6,paddingInlineEnd:8},icon:{...c?{width:Kn().Ev.xxs,height:Kn().Ev.xxs,marginInlineStart:10,marginInlineEnd:6}:{width:g().A.isMobile?Kn().Ev.default:Kn().Ev.sm,height:g().A.isMobile?Kn().Ev.default:Kn().Ev.sm,marginInlineStart:g().A.isMobile?0:1,marginInlineEnd:g().A.isMobile?6:8}},buttonContainer:{display:"flex"}})),[c]);return d?(0,Ge.jsxs)("div",{style:p.buttonContainer,children:[(0,Ge.jsxs)(ui().Ay,{onClick:u,onMouseDown:Ti().t,style:p.button,children:[(0,Ge.jsx)(ke().I,{icon:Ho().plusSmallIcon,colorVariant:"tertiary",style:p.icon}),(0,Ge.jsx)(Oa().w,{collectionContextStore:n})]}),(0,Ge.jsx)(kr().O,{collectionContextStore:n,groupFormat:o,renderLinkButton:e=>(0,Ge.jsxs)(ui().Ay,{style:p.button,...e,children:[(0,Ge.jsx)(ke().I,{icon:_e().arrowDiagonalUpRightIcon,colorVariant:"tertiary",style:p.icon}),(0,Ge.jsx)(Le().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})]}):(0,Ge.jsxs)(ui().Ay,{onClick:u,onMouseDown:Ti().t,style:p.button,children:[(0,Ge.jsx)(ke().I,{icon:Ho().plusSmallIcon,colorVariant:"tertiary",style:p.icon}),(0,Ge.jsx)(Oa().w,{collectionContextStore:n})]})}));class su extends P().Store{getInitialState(){return{}}getCurrentFormat(e){return this.state.temporaryFormat?this.state.temporaryFormat:e}getCurrentProperties(e,t){return this.getCurrentFormat(t)[e]||[]}}const cu=su;var du=()=>o(943101),uu=()=>o(209199),pu=()=>o(675592);function gu({isPhone:e,elementWidth:t,paddingLeft:o,paddingRight:n,propertyWidths:r}){let i=t-o-n,l=0;for(let s=0;s<r.length;s++){if(i-=r[s]??0,l=s,i<=0)break}const a=l+1;return r.length>a+(e?2:5)}const mu=r.memo((function({collectionContextStore:e,tableProperties:t,paddingLeft:n,paddingRight:i,children:l}){const a=(0,x().v3)(),{isPhone:s}=(0,x().Y0)(),c=(0,r.useRef)(null),d=(0,r.useContext)(m().U),u=(0,r.useMemo)((()=>t.filter((e=>e.visible))),[t]),p=(0,k().K8)((()=>{var e;return null==d||null===(e=d.horizontalScroller)||void 0===e?void 0:e.getStore().state.element}),[d]),g=(0,k().K8)((()=>{const t=e.frozoneStore.state.frozenIndex;return void 0===t?0:t+1}),[e]),S=(0,k().K8)((()=>u.map((e=>(0,te().oe)({environment:a,propertyFormat:e})))),[a,u]),[h,y]=(0,r.useState)((()=>{var e;return gu({isPhone:s,elementWidth:(null==p||null===(e=p.deref())||void 0===e?void 0:e.clientWidth)??0,paddingLeft:n,paddingRight:i,propertyWidths:S})})),v=(0,r.useCallback)((e=>{ve().default.state.open&&ve().default.state.mode===o(868840).A||y(gu({isPhone:s,elementWidth:e.width,paddingLeft:n,paddingRight:i,propertyWidths:S}))}),[n,i,S,s]);(0,du().tK)(c,v);const f=(0,r.useCallback)((e=>e+g>S.length-1?35:S[e+g]??35),[S,g]),b=(0,Ll().Te)({enabled:h,count:u.length,estimateSize:f,scrollMargin:n,getScrollElement:()=>(null==p?void 0:p.deref())??null,getItemKey:e=>u[e].property||e,overscan:2,horizontal:!0,isRtl:(0,uu().A1)()}),w=b.getVirtualItems(),[C,I]=(0,r.useMemo)((()=>w.length>0?[w[0].start-n,b.getTotalSize()+n-w[w.length-1].end]:[0,0]),[w,b,n]),T=0===w.length?0:g+w[0].index,j=0===w.length?0:w[w.length-1].index+1,{propertiesInRange:A,propertiesInRangeIndices:M}=(0,r.useMemo)((()=>0===w.length?{propertiesInRange:[],propertiesInRangeIndices:[]}:{propertiesInRange:u.slice(T,j),propertiesInRangeIndices:Array.from({length:j-T},((e,t)=>T+t))}),[w.length,j,T,u]),P=(0,r.useMemo)((()=>({propertiesInRange:A,propertiesInRangeIndices:M,beforeWidth:C,afterWidth:I})),[I,C,A,M]);return(0,Ge.jsx)(pu().Pr.Provider,{value:b,children:(0,Ge.jsx)(pu().Z6.Provider,{value:h,children:(0,Ge.jsx)(pu().Wm.Provider,{value:P,children:l})})})}));var Su=()=>o(271238),hu=()=>o(124311);function yu(e,t){const n=(0,d().X)("adoption_enable_ai_property_suggestion");return(0,k().K8)((()=>{if(!o(383070).zD.isAiEnabled())return!1;if(!n)return!1;const r=null==e?void 0:e.collectionSuggestionStore.state.experimentVariant;return(void 0===r||"ghost_column"===r)&&(!!e&&(!!t||e.collectionSuggestionStore.state.isEnabled))}),[n,e,t])}var vu=()=>o(316369),fu=()=>o(250452),bu=()=>o(358898),xu=()=>o(421107),wu=()=>o(480912);const Cu=r.memo((function(e){const{disabled:t,property:n,schema:i,collectionContextStore:l,groupFormat:a,propertyFormat:s,isHovered:c,aggregation:d,onChange:p,forViewType:m}=e,S=(0,x().v3)(),h=(0,Le().tz)(),y=(0,k().K8)((()=>l.permissionScopesStore.state.isLocked),[l]),[v,f]=(0,r.useState)(void 0),b=(0,r.useMemo)((()=>Boolean((null==s?void 0:s.width)&&s.width<100)),[s]),w=(0,k().K8)((()=>Yi(l,d)),[l,d]),C=(0,k().K8)((()=>{var e;if(!d)return;const t=null===(e=l.collectionStore())||void 0===e?void 0:e.getSpaceId(),o=S.idCreator.getSpaceIdCreatorSync(t??"");return{type:"aggregation",filter:a?(0,mr().Yy)({schema:i,propertyMapping:void 0,groupBy:l.getGroupByAndGroupFormats().groupBy,group:a,timeZone:(0,tr().P)(),experimentService:u().default,spaceIdCreator:o}):void 0,aggregation:d}}),[i,a,d,l,S]),T=(0,r.useCallback)((({aggregationType:e,enforceMaxAggregationLimit:t})=>{if(e){const o={aggregator:e,property:n,enforceMaxAggregationLimit:t};p(n,o),f(o),(0,N().X)({environment:S,collectionContextStore:l,action:"table_change_aggregation"})}else p(n,void 0),(0,N().X)({environment:S,collectionContextStore:l,action:"table_remove_aggregation"})}),[S,p,n,l]),j=(0,I().IS)((()=>({buttonContainer:{display:"flex",justifyContent:"flex-end",alignItems:"center",width:"100%",marginInlineEnd:4},buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",padding:"0px 6px",borderRadius:6,overflow:"hidden",whiteSpace:"nowrap",userSelect:"auto",WebkitUserSelect:"auto",transition:"background 0.2s ease"}})),[]);(0,r.useEffect)((()=>{v&&!Yi(l,v)&&(0,W().n4)(d,v)&&f(void 0)}),[w,v,l,d]);const A=(0,r.useMemo)((()=>b&&null!=d&&d.aggregator?el().zY[(0,qi().V1)(d)]:void 0),[b,d]),M=(0,r.useMemo)((()=>d?(0,o(436477).H)(n,d,a):""),[a,n,d]),P=(0,r.useCallback)(((e,t)=>{if(t){var o;const r=e["timeline"===m?Bn().qK:Bn().Tt];if("groups"!==(null==r?void 0:r.type))return;const i=(0,Vn().Ix)(t[0]),l=null===(o=r.propertyAggregationResults)||void 0===o||null===(o=o[i])||void 0===o?void 0:o[n];return l?{aggregationResult:l,type:"aggregation"}:void 0}}),[n,m]),_=(0,r.useCallback)((e=>C?(0,Ge.jsx)(Xr().A,{id:M,collectionContextStore:l,reducer:C,groupsPointer:a?[a]:void 0,resultLookupFn:P,isDerivedReducer:!0,render:o=>(0,Ge.jsx)(Wo().m,{alignment:b?"center":"end",disableTooltip:!w&&!A,renderTooltip:()=>w?h.formatMessage(Ji.aggregationCalculating):A,render:r=>(0,Ge.jsx)(ui().Ay,{disabled:t||y,style:j.buttonStyle,...(0,$i().A)(r,e),children:(0,Ge.jsx)(ku,{resultStore:o,aggregation:d,schema:i,property:n,hideLabelText:b})})})},M):(0,Ge.jsx)(ui().Ay,{disabled:t,style:j.buttonStyle,...e,children:(0,Ge.jsx)(Iu,{disabled:t,isHovered:c,hideLabelText:b})})),[d,M,l,C,a,t,j.buttonStyle,c,b,P,w,A,h,i,n,y]),R=(0,r.useCallback)((({close:e})=>(0,Ge.jsx)(o(680341).v,{currentAggregation:d,property:n,schema:i,onChange:T,onClose:e,source:"tableAggregation"})),[T,d,n,i]);return(0,Ge.jsx)("div",{style:j.buttonContainer,children:(0,Ge.jsx)(Ce().A,{popupType:g().A.isMobile?Ce().z.SlideUp:Ce().z.Popup,disabled:t||y,renderOrigin:_,render:R})})})),ku=r.memo((function(e){const{aggregation:t,resultStore:n,schema:i,property:l,hideLabelText:a}=e,s=(0,_t().ET)(),c=(0,I().IS)((()=>({container:{display:"flex",alignItems:"center"},valueStyle:{color:K().Tj.text.secondary,height:"100%"},aggregationTypeNameStyle:{fontWeight:500,color:K().Tj.text.tertiary,fontSize:g().A.isMobile?12:10,textTransform:"uppercase",letterSpacing:1,marginInlineEnd:4,userSelect:"none",WebkitUserSelect:"none"}})),[]),d=(0,k().O$)(n),u=(0,r.useMemo)((()=>{if(!t)return;let e=el().SE[(0,qi().V1)(t)];return(0,qi().ET)(t.aggregator)&&(e=t.aggregator.groupName in wu().OR?wu().OR[t.aggregator.groupName]:t.aggregator.groupName),e}),[t]),{numberFormat:p,numberPrecision:m}=(0,k().K8)((()=>{const e=i[l];if(!e)return{};if(e&&("formula"===e.type||"number"===e.type)){const o=e.number_format,n=e.number_precision;return{numberFormat:o,numberPrecision:t?(0,el().zI)(t.aggregator,n):n}}if("rollup"===e.type&&e.relation_property&&e.target_property&&"number"===e.target_property_type&&void 0!==i[e.relation_property]){var n;const r=i[e.relation_property],l=(0,o(113105).pg)(s,r),a=null==l||null===(n=l.getModel())||void 0===n?void 0:n.getNormalizedSchema(),c=null==a?void 0:a[e.target_property];if("number"===(null==c?void 0:c.type)){const e=c.number_format,o=c.number_precision;return{numberFormat:e,numberPrecision:t?(0,el().zI)(t.aggregator,o):o}}}return{}}),[i,l,t,s]);if(!u)return null;const S=(0,Ge.jsx)("span",{style:c.valueStyle,children:t?(0,Ge.jsx)(Qi,{aggregation:t,collectionContextStore:s,children:d?(0,el().rv)({numberFormat:p,dateFormat:void 0,aggregation:t,userTimeZone:(0,tr().P)(),value:d.aggregationResult,numberPrecision:m}):void 0}):void 0},"value");return a?S:(0,Ge.jsxs)("div",{style:c.container,children:[(0,Ge.jsx)("span",{style:c.aggregationTypeNameStyle,children:u},"type"),S]})})),Iu=r.memo((function(e){const{disabled:t,isHovered:n,hideLabelText:r}=e,i=(0,I().IS)((()=>({placeholderWrapper:{display:"flex",alignItems:"center",height:26},placeholderText:{color:K().Tj.text.tertiary}})),[]);return t||!n?null:(0,Ge.jsx)(fe().A,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:i.placeholderWrapper,children:(0,Ge.jsx)("div",{style:i.placeholderWrapper,children:r?(0,Ge.jsx)("span",{style:i.placeholderText,children:(0,Ge.jsx)(ke().I,{icon:o(153057).A,size:"xs",colorVariant:"tertiary"})},"placeholder"):(0,Ge.jsx)("span",{style:i.placeholderText,children:(0,Ge.jsx)(Le().sA,{defaultMessage:"Calculate",id:"database.tableView.aggregationPlaceholder"})},"placeholder")})})})),Tu=r.memo((function({collectionContextStore:e,disabled:t,groupFormat:o,isFullScreen:n,isInPeekRenderer:i,query:l,schema:a,showPropertyFormats:s,showRightActionsSpacer:c,pageCount:d,style:u,paddingLeft:g,paddingRight:m,disableSticky:S,forViewType:h}){var v;const f=(0,x().v3)(),{isPhone:b}=(0,x().Y0)(),w=(0,I().DP)(),C=(0,k().K8)((()=>e.frozoneStore.state.frozenIndex),[e.frozoneStore]),{unfrozenIndexAddendum:T,frozenPropertyFormats:A,unfrozenPropertyFormats:M}=(0,k().K8)((()=>{const e=s;let t=[],o=e;const n=(0,ne().qi)(C);return void 0!==C&&(t=e.slice(0,n),o=e.slice(n)),{unfrozenIndexAddendum:n,frozenPropertyFormats:t,unfrozenPropertyFormats:o}}),[C,s]),P=(0,k().O$)(e.isInHomeWidgetStore),_=Boolean(null===(v=l.aggregations)||void 0===v?void 0:v.length),R=(0,r.useMemo)((()=>d>0&&!t),[d,t]),B=(0,r.useContext)(Do().w),V=(0,ne().Oz)(e),F=(0,I().IS)((()=>{const e=P?void 0:(null==V?void 0:V.background)||(i?K().Tj.background.elevated:K().Tj.background.primary);return{aggregationRow:{borderTop:R?`1px solid ${K().Tj.border.secondaryTranslucent}`:"none",display:"flex",background:e,zIndex:85,fontSize:14,height:xn().wc+(n&&!o?B:0),minWidth:"100%",clipPath:"polygon(0% -20%, 100% -20%, 100% 100%, 0% 100%)",insetInlineStart:0,boxSizing:"border-box",...u},stickyStyle:{paddingInlineStart:g,paddingInlineEnd:m,fontVariantNumeric:"lining-nums tabular-nums",paddingBlockEnd:0,background:e},container:{display:"flex",paddingInlineEnd:!t&&c?32:0},innerContainer:{display:"flex"}}}),[P,null==V?void 0:V.background,i,n,o,B,u,g,m,t,c,R]),E=(0,k().K8)((()=>void 0!==C&&(0,te().wy)({environment:f,collectionContextStore:e,isPhone:b,theme:w})),[C,f,e,b,w]),O=(0,r.useCallback)((e=>{(0,y().SQ)(e,y().y$.EditorMouseDown,(()=>{}))}),[]),D=(0,r.useCallback)(((n,r)=>(0,Ge.jsx)(ju,{propertyFormat:n,groupFormat:o,disabled:t,collectionContextStore:e,schema:a,query:l,forViewType:h},n.property)),[e,t,o,l,a,h]),z=!P&&(_||n),L=(0,r.useRef)(null),W=(0,Ge.jsx)(p().s,{allowSelectionWithin:!1,style:F.aggregationRow,onMouseDown:O,ref:L,children:(0,Ge.jsx)("div",{style:F.container,children:(0,Ge.jsxs)("div",{style:F.innerContainer,children:[void 0!==C?(0,Ge.jsx)("div",{style:{...E,display:"flex"},children:A.map(D)}):void 0,M.map(((e,t)=>D(e,t+T)))]})})});return!(0,k().O$)(j().e)?null:z?(0,Ge.jsx)(Ci().g,{stickyAttachPoint:S?"no-stick":"floor",stickyStyle:F.stickyStyle,nodeRef:L,children:W}):W})),ju=r.memo((function({propertyFormat:e,groupFormat:t,disabled:n,collectionContextStore:i,query:l,schema:a,forViewType:s}){var c;const d=(0,x().v3)(),[u,p]=(0,r.useState)(!1),g=(0,k().K8)((()=>i.permissionScopesStore.state.isLocked),[i.permissionScopesStore]),m=(0,I().IS)((()=>({wrapper:{display:"flex",width:e.width}})),[e.width]),S=(0,r.useCallback)(((e,t)=>{(0,o(500733).I)({environment:d,collectionContextStore:i,query:l,property:e,newAggregation:t})}),[i,l,d]),h=!n&&!g&&u,y=(0,r.useCallback)((()=>{p(!0)}),[p]),v=(0,r.useCallback)((()=>{p(!1)}),[p]);return(0,Ge.jsx)("div",{style:m.wrapper,onMouseEnter:y,onMouseLeave:v,children:(0,Ge.jsx)(Cu,{groupFormat:t,propertyFormat:e,disabled:n,isHovered:h,aggregation:null===(c=l.aggregations)||void 0===c?void 0:c.find((t=>t.property===e.property)),property:e.property,collectionContextStore:i,schema:a,onChange:S,forViewType:s})})})),Au=r.memo(r.forwardRef((function(e,t){var o;const{collectionContextStore:n,handleAddRowClick:i,numberOfBlankRows:l,isBlockPropertyValueOverlayOpen:a,propertyFormats:s,query:c}=e,[d,u]=(0,r.useState)(0),p=(0,r.useCallback)((()=>{u(0)}),[]),g=Boolean(null===(o=c.aggregations)||void 0===o?void 0:o.length),m=(0,I().IS)((()=>{const{button:e}=(0,te().BJ)({hideTextWithTransition:!1,hideTextWithoutTransition:a});return{button:{...e,transition:"background 0.2s ease",borderBottom:`1px solid ${K().Tj.border.secondaryTranslucent}`,paddingInlineStart:0},buttonHovered:{background:K().Tj.tableRowHoveredBackground},lastRow:{...!g&&{marginBottom:6}},text:{fontSize:14,color:K().Tj.text.tertiary,display:"inline-flex",alignItems:"center",height:"100%",opacity:1,transition:"opacity 0.2s ease",...a&&{display:"none"}}}}),[a,g]);return 0===s.length?null:(0,Ge.jsx)("div",{onMouseLeave:p,ref:t,children:Array.from({length:l}).map(((e,t)=>(0,Ge.jsx)(ui().Ay,{className:fn().Mbm,onClick:i,onMouseDown:Ti().t,style:{...m.button,...t===l-1&&m.lastRow},hoveredStyle:m.buttonHovered,onMouseEnter:()=>u(t),children:(0,Ge.jsx)("span",{style:m.text,children:(0,Ge.jsx)(Mu,{propertyFormats:s,collectionContextStore:n,isRowHovered:d===t})})},`row-${t}`)))})})));function Mu(e){const{propertyFormats:t,collectionContextStore:o,isRowHovered:n}=e;return(0,Ge.jsx)(Ge.Fragment,{children:t.map(((e,t)=>(0,Ge.jsx)(Pu,{propertyFormat:e,collectionContextStore:o,isRowHovered:n,isFirstColumn:0===t},e.property)))})}function Pu(e){const{propertyFormat:t,collectionContextStore:o,isRowHovered:n,isFirstColumn:r}=e,i=(0,x().v3)(),l=(0,k().K8)((()=>(0,te().oe)({environment:i,propertyFormat:t})),[t,i]),a=(0,I().IS)((()=>({tableCell:{display:"flex",width:l,height:"100%",position:"relative",borderInlineEnd:`1px solid ${K().Tj.border.secondaryTranslucent}`},icon:{marginInlineStart:g().A.isMobile?0:1,marginInlineEnd:7},newPageLabel:{display:"flex",alignItems:"center",paddingInlineStart:8,minWidth:100,...g().A.isMobile&&{fontSize:17,color:K().Tj.text.tertiary}}})),[l]);return(0,Ge.jsx)("div",{style:a.tableCell,children:n&&r?(0,Ge.jsxs)("div",{style:a.newPageLabel,children:[(0,Ge.jsx)(ke().I,{icon:Ho().plusSmallIcon,size:"sm",colorVariant:"tertiary",style:a.icon}),(0,Ge.jsx)(Oa().w,{collectionContextStore:o})]}):void 0})}var _u=()=>o(534513),Ru=()=>o(338381),Bu=()=>o(40845),Vu=()=>o(634201);const Fu={position:"absolute",display:"flex",opacity:.5},Eu=function(e){const t=(0,r.useRef)(null),n=(0,r.useRef)(),i=(0,k().uB)(e.store,o(170253).A),l=(0,k().O$)(i),{direction:a,sectionedKeys:s,sectionStyles:c,keys:d,disableVerticalEdgeScroll:u,disableHorizontalEdgeScroll:p,disabled:g,renderKey:m,ghostZIndex:S}=e,h={..."horizontal"===a?tc().Z0:tc().Bb,...l.isDragging&&{position:"relative",zIndex:1,width:l.savedContainerRect.width,height:l.savedContainerRect.height},...e.style};function y(e){return"string"==typeof e?e:e.key}const v=(0,k().K8)((()=>d.map(((e,t)=>{const o=y(e),n=m(o,t,t===d.length-1);if(l.isDragging&&l.draggingKey===o){const{savedKeyRects:e,savedContainerRect:r,currentXOffset:i,currentYOffset:s}=l,c=e[t];let d,u;"vertical"===a?(d=(0,Bu().A)(c.top+s,r.top,r.top+r.height-c.height)-r.top,u=c.left-r.left):(d=c.top-r.top,u=(0,Bu().A)(c.left+i,r.left,r.left+r.width-c.width)-r.left);const p={...Fu,zIndex:S,left:u,top:d,width:c.width,height:c.height};return(0,Ge.jsx)("div",{style:p,children:n},o)}}))),[d,m,a,l]);function f(){const{direction:o}=e;return!n.current&&t.current&&(n.current="vertical"===o?(0,F().NM)(t.current):(0,F().T8)(t.current)),n.current}const b=g?{}:{onDraggableDragCancel:()=>{l.isDragging&&i.reset()},onDraggableDragEnd:()=>{if(l.isDragging){const{keys:t,onDrop:o}=e,{startKeyPosition:n,currentKeyPosition:r}=l;if(n!==r){const e=W().o8(t);e.splice(r,0,e.splice(n,1)[0]);const i=y(t[n]);o(e.map(y),{key:i,startPosition:n,endPosition:r})}e.onDragEnd&&e.onDragEnd(),i.reset()}},onDraggableDragStart:o=>{o.preventDefault();const{keys:n}=e,r=t.current;if(!r)return;if(!(r instanceof Element))return;const l=Ru().EV(o.target,(e=>Ru().vq(e)&&e.classList.contains(fn().wAf))),a=Ru().EV(o.target,(e=>e.parentNode===l));if(l&&a){const t=Vu().PE(r.children).indexOf(l),o=Vu().PE(l.children).indexOf(a);let c=0;const d=Object.keys(s);for(let e=0;e<t;e++)c+=s[d[e]].length;c+=o;const u=n[c];if("object"==typeof u&&!u.draggable)return;const p=r.getBoundingClientRect(),g=W().Bq(Object.keys(s).map(((e,t)=>s[e].map(((e,o)=>r.children[t].children[o].getBoundingClientRect()))))),m=f();if(m){const t=y(n[c]);e.onDraggingKeyChanged&&e.onDraggingKeyChanged(t),i.setState({isDragging:!1,willDrag:!0,currentXOffset:0,currentYOffset:0,draggingKey:t,startKeyPosition:c,startScrollX:m.scrollLeft,startScrollY:m.scrollTop,currentKeyPosition:c,savedContainerRect:p,savedKeyRects:g})}}},onDraggableDragMove:t=>{!l.isDragging&&l.willDrag&&l.draggingKey&&(0,_u().A)(t.startX,t.startY,t.currentX,t.currentY)>=o(450183).t[t.device]&&(i.setState({currentXOffset:l.currentXOffset,currentYOffset:l.currentYOffset,startScrollX:l.startScrollX,startScrollY:l.startScrollY,startKeyPosition:l.startKeyPosition,currentKeyPosition:l.currentKeyPosition,savedKeyRects:l.savedKeyRects,savedContainerRect:l.savedContainerRect,draggingKey:l.draggingKey,isDragging:!0,willDrag:!1}),e.onDragStart&&e.onDragStart());const n=f();if(l.isDragging&&n){const{savedKeyRects:e,startScrollX:o,startScrollY:r}=l,a=n.scrollLeft-o,s=n.scrollTop-r,c=W().wq(e,(e=>(0,_u().A)(t.currentX+a,t.currentY+s,e.left+e.width/2,e.top+e.height/2)));if(c){const o=e.indexOf(c);i.setState({...l,currentXOffset:t.diffX+a,currentYOffset:t.diffY+s,currentKeyPosition:o})}}}};return(0,Ge.jsx)(xd().A,{...b,forceTouch:!0,allowDragWhileTextEditing:!0,disableVerticalEdgeScroll:u||"horizontal"===a,disableHorizontalEdgeScroll:p||"vertical"===a,render:o=>{let n=0;return(0,Ge.jsxs)("div",{ref:t,style:h,...o,children:[Object.entries(s).map((([t,o])=>{const r=((e,t)=>(0,Ge.jsx)("div",{className:fn().wAf,style:null==c?void 0:c[e],children:t},e))(t,o.map(((t,o)=>((t,o)=>{const n=y(t),r=e.keys.map(y),i=m(n,o,r.length-1===o);let a="";if(l.isDragging){const{startKeyPosition:t,currentKeyPosition:n}=l;t===n?a="":"horizontal"===e.direction?n===o&&o<t?a=`inset 4px 0 ${K().IF.blueWithAlpha(.5)}`:n===o&&o>t&&(a=`inset -4px 0 ${K().IF.blueWithAlpha(.5)}`):"vertical"===e.direction&&(n===o&&o<t?a=`inset 0 4px ${K().IF.blueWithAlpha(.5)}`:n===o&&o>t&&(a=`inset 0 -4px ${K().IF.blueWithAlpha(.5)}`))}return(0,Ge.jsx)("div",{style:{display:"flex",flexDirection:"vertical"===e.direction?"column":"horizontal"===e.direction?"row":(0,H().HB)(e.direction),boxShadow:a},children:i},n)})(t,o+n))));return n+=o.length,r})),v]})}})};function Ou({collectionContextStore:e}){const t=(0,x().v3)(),n=(0,k().O$)(e.normalizedSchemaStore),i=(0,r.useMemo)((()=>Object.keys(n).length<=1),[n]),l=(0,I().DP)(),a=(0,I().IS)((()=>({dotsIcon:{fill:(0,o(852424).P0)({theme:l,willShowOnTooltip:!1})},button:{display:i?"none":"flex",alignItems:"center",justifyContent:"center",borderRadius:6,width:g().A.isMobile?32:28,height:g().A.isMobile?32:28}})),[i,l]),s=(0,r.useCallback)((()=>{(0,J().O)({collectionContextStore:e,collectionSettingsStore:e.settingsStore}),(0,N().X)({environment:t,collectionContextStore:e,action:"click_table_header_dot_menu"}),Q().a2({collectionSettingsStore:e.settingsStore,item:{type:"propertyVisibility",timelineViewTab:"timeline"}})}),[e,t]);return(0,Ge.jsx)(Wo().m,{renderTooltip:()=>(0,Ge.jsx)(Le().sA,{defaultMessage:"Show or hide properties",id:"collectionTable.configureColumnsButton.showOrHideProperties"}),render:e=>(0,Ge.jsx)(ui().Ay,{...e,style:a.button,onMouseDown:bu().tr,onClick:s,className:fn().LcC,children:(0,Ge.jsx)("div",{style:bu().w6,children:(0,Ge.jsx)(ke().I,{icon:Be().ellipsisSmallIcon,size:"sm",style:a.dotsIcon})})})})}var Du=()=>o(452337);const zu=r.memo((function(e){const{groupsPointer:t,collectionContextStore:o,hasMoreReducerResults:n,frozoneProps:i}=e,l=(0,x().v3)(),a=(0,r.useCallback)((()=>{const e=(0,Pt().v2)(t[0],o),n=o.isInLibraryBlock();return e.filter((e=>e.canEdit()||n))}),[o,t]),s=(0,k().K8)((()=>0===a().length),[a]),{checkedState:c,allVisibleItemsChecked:d}=(0,k().K8)((()=>{const e=a(),t=e.length;if(0===t)return{checkedState:!1,allVisibleItemsChecked:!0};const o=Et().default.state.stores.filter((t=>e.includes(t))).length;return{checkedState:0!==o&&(o===t&&!n||"partial"),allVisibleItemsChecked:o===t}}),[a,n]),u=(0,r.useCallback)((e=>{var t;const n=a(),r=Et().default.state.stores,i=(0,te().ut)({collectionViewBlockId:null===(t=o.collectionViewBlockStore())||void 0===t?void 0:t.id})?[]:r;!1===c||"partial"===c&&!d?(0,Ft().t)({environment:l,stores:W().KC(i,n)}):(!0===c||"partial"===c&&d)&&(0,Ft().t)({environment:l,stores:W().FF(i,...n)}),e.stopPropagation(),e.preventDefault()}),[c,o,l,a,d]),p=(0,k().K8)((()=>(0,ne().f5)({collectionContextStore:o})),[o]),g=(0,I().IS)((()=>({wrapper:{...null==i?void 0:i.frozenStyles,...-1===(null==i?void 0:i.frozenIndex)&&{background:void 0}},checkboxContainer:p?{position:"absolute",insetInlineStart:-xn().Fh,background:-1===(null==i?void 0:i.frozenIndex)||null==i?void 0:i.frozenStyles.background}:{display:"contents"}})),[null==i?void 0:i.frozenIndex,null==i?void 0:i.frozenStyles,p]);return(0,Ge.jsx)("div",{style:g.wrapper,children:(0,Ge.jsx)("div",{style:g.checkboxContainer,children:(0,Ge.jsx)(Du().V,{passesFilter:!0,checkedState:c,onClick:u,checkboxType:"group",collectionContextStore:o,frozoneProps:i?{...i,isCollectionViewBlockSelected:!1}:void 0,disabled:s})})})}));var Lu=()=>o(59400),Ku=()=>o(148297),Wu=()=>o(232930),Hu=()=>o(431135),Nu=()=>o(285176),Gu=()=>o(782473);function $u(e){const{origin:t,propertyType:o}=e,n=(0,x().v3)();return(0,Ge.jsx)(Ku().k,{origin:t,placementToOrigin:"bottom",header:function(){switch(o){case"owner":return(0,Ge.jsx)(Le().sA,{id:"WikiPropertiesOnboardingTooltip.header.ownerProperty",defaultMessage:"Owner"});case"verification":return(0,Ge.jsx)(Le().sA,{id:"WikiPropertiesOnboardingTooltip.header.verificationProperty",defaultMessage:"Verification"});case"tags":return(0,Ge.jsx)(Le().sA,{id:"WikiPropertiesOnboardingTooltip.header.tagsProperty",defaultMessage:"Add tags and more"});default:(0,H().HB)(o)}}(),content:function(){switch(o){case"owner":return(0,Ge.jsx)(Le().sA,{defaultMessage:"Owners are responsible for keeping the page updated. By default, the owner is the page creator",id:"WikiPropertiesOnboardingTooltip.content.ownerProperty"});case"verification":return(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)(Le().sA,{defaultMessage:"Page owners can mark a page as verified or expired, to help viewers understand whether they can trust the content",id:"WikiPropertiesOnboardingTooltip.content.verificationProperty"}),(0,Ge.jsx)(Nu().o,{href:(0,Wu().x)("guides.wikis"),style:{color:K().oZ.uiLightGray}})]});case"tags":return(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)(Le().sA,{defaultMessage:"Customize your wiki with tags or other database properties",id:"WikiPropertiesOnboardingTooltip.content.tagsProperty"}),(0,Ge.jsx)(Nu().o,{href:(0,Wu().x)("guides.databaseProperties"),style:{color:K().oZ.uiLightGray}})]});default:(0,H().HB)(o)}}(),numSteps:3,currStepIndex:function(){switch(o){case"owner":return 0;case"verification":return 1;case"tags":return 2;default:(0,H().HB)(o)}}(),onCloseClick:()=>{Hu().ZP(n)},onPrimaryButtonClick:()=>Hu().A6(n),onBackButtonClick:()=>Hu().Jz(n),enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerLength:Gu().gO,pointerOffset:Gu().j$,style:{width:Gu().Sw}})}var Uu=()=>o(790748),qu=()=>o(422164),Xu=()=>o(334146),Yu=()=>o(905388),Qu=()=>o(100102),Zu=()=>o(646836),Ju=()=>o(713998);function ep(e){const{propertySchema:t}=e,o=tp({propertySchema:t}),n=(0,I().IS)((()=>({icon:{padding:2}})),[]);return o?(0,Ge.jsx)(ke().I,{icon:ws().exclamationMarkTriangleIcon,colorPalette:"yellow",colorVariant:"accentPrimary",style:n.icon}):null}function tp(e){const{propertySchema:t}=e,o=!(0,k().O$)(j().e);if(!t||!o)return!1;const n="formula"===t.type,r=(0,er().$M)(t)&&(0,H().O9)((0,er().om)(t)),i=(0,H().O9)((0,Ju().Dz)(t));return n||r||i}function op(e){const{collectionStore:t,spaceId:n,property:r}=e,{getWorkflowsForProperty:i}=(0,o(330863).i)(t,n),l=(0,k().K8)((()=>i(r)),[i,r]),a=(0,k().K8)((()=>l.slice(0,3).map((e=>({id:e.id,displayData:(0,o(233692).m)(e),workflowStore:e})))),[l]),s=(0,I().IS)((()=>({container:{display:"flex",flexDirection:"row",alignItems:"center"},iconWrapper:{marginInlineStart:-10},fadedIcon:{opacity:.5}})),[]);return 0===a.length?null:(0,Ge.jsx)("div",{style:s.container,children:a.map((({id:e,displayData:t,workflowStore:n},r)=>{const i=0===r,l=2===r,a=3-r;return(0,Ge.jsx)("div",{style:{...!i&&s.iconWrapper,...l&&s.fadedIcon,position:"relative",zIndex:a},children:(0,Ge.jsx)(o(622936).AgentIcon,{agentIcon:t.icon,workflowStore:n,size:18})},e)}))})}var np=()=>o(913687),rp=()=>o(302655),ip=()=>o(912720),lp=()=>o(840094);function ap(e){const{collectionContextStore:t,collectionViewBlockStore:o,property:n,propertySchema:r}=e,i=(0,k().K8)((()=>o.getSpaceId()),[o]),l="button"===(null==r?void 0:r.type)&&(0,H().O9)(r.automation_id)?rp().d.createChildStore(o,{id:r.automation_id,table:ip().yB,spaceId:i}):void 0;return(0,lp().cN)({automationStore:l,property:n,propertySchema:r,collectionContextStore:t})}function sp(e){const{collectionContextStore:t,collectionStore:n,collectionViewBlockStore:i,isCrossSpaceFormula:l,isCrossSpaceRelation:a,isHoveringDescriptionIcon:s,property:c,propertySchema:d,render:u,isNameTruncated:p}=e,g=(0,k().K8)((()=>(0,er().$M)(d)&&(0,er().om)(d)),[d]),m=void 0!==(null==d?void 0:d.description)&&d.description.length>0,S=(0,o(763870).i)({collectionStore:n,property:c,propertySchema:d}),h=(0,H().O9)(S)&&(0,H().O9)(n),y=tp({propertySchema:d}),v=(0,H().O9)(g)&&!1!==g&&(0,H().O9)(g.auto_update_on_edit)&&!y,f=ap({collectionContextStore:t,collectionViewBlockStore:i,property:c,propertySchema:d}),b=Boolean(d.name)&&p||m||h||v||y||f,x=(0,I().IS)((()=>({description:{color:K().Tj.text.inverseSecondary},personPropertyPermissionsTooltip:{color:K().Tj.text.inverseSecondary},aiUpdate:{color:K().Tj.text.inverseSecondary},offlineWarning:{color:K().Tj.text.inverseSecondary},buttonError:{color:K().Tj.text.inverseSecondary}})),[]),w=(0,r.useCallback)((e=>(0,Ge.jsxs)("div",{...e,style:o(206372).Q$,children:[b?(0,Ge.jsx)("div",{children:d.name}):void 0,m?(0,Ge.jsx)("div",{style:x.description,children:d.description}):void 0,h?(0,Ge.jsx)(o(7797).t,{propertySchema:d,property:c,collectionStore:n,style:x.personPropertyPermissionsTooltip,blockStore:void 0}):void 0,v?(0,Ge.jsx)("div",{style:x.aiUpdate,children:(0,Ge.jsx)(Le().sA,{...np().A.keptUpToDateWithNotionAITooltip})}):void 0,y?(0,Ge.jsx)("div",{style:x.offlineWarning,children:(0,Ge.jsx)(Le().sA,{..."formula"===d.type?np().A.offlineWarningFormula:np().A.offlineWarningAutoUpdate})}):void 0,f?(0,Ge.jsx)("div",{style:x.buttonError,children:(0,Ge.jsx)(Le().sA,{...np().A.buttonPropertyErrorTooltip})}):void 0]})),[b,d,m,x.description,x.personPropertyPermissionsTooltip,x.aiUpdate,x.offlineWarning,x.buttonError,n,h,c,v,y,f]);return(0,Ge.jsx)(Wo().m,{alignment:"start",tooltipClassName:fn().StS,disableTooltip:a||l||!b,delayThreshold:s?0:500,renderTooltip:w,render:u})}const cp=r.memo((function(e){const{allowHidingTitle:t,collectionContextStore:n,collectionViewBlockStore:i,columnIndex:l,disableCellRightBorder:a,disabled:s,format:c,formatKey:d,handleTemporaryNewPropertyInsertion:p,isLast:m,paddingTop:S,property:h,renderSpacer:v,schema:f,width:b}=e,w=(0,x().v3)(),C=f[h],j=(0,o(399385).Q)(h),A=r.useMemo((()=>{if(!j)return null;const e=K().Tj.background.primary;return"jira"===j?(0,o(280746).jiraIcon)({width:12,height:12,stroke:e,strokeWidth:1,paintOrder:"stroke fill",vectorEffect:"non-scaling-stroke"}):(0,o(769145).salesforceIcon)({width:12,height:12,stroke:e,strokeWidth:1,paintOrder:"stroke fill",vectorEffect:"non-scaling-stroke"})}),[j]),M=(0,r.useRef)(null),P=(0,r.useRef)(null),{value:_}=(0,T().fJ)($t().T.formulas),{value:R}=(0,T().fJ)($t().T.formulaConstants),{value:B}=(0,T().fJ)($t().T.formulaPermissions),[F,E]=(0,r.useState)(!1);(0,r.useEffect)((()=>{!function(){const e=P.current;e&&E(e.scrollWidth>e.clientWidth+1)}()}),[b,null==C?void 0:C.name]),(0,Uu().b)(o(344482).A,(()=>({collectionContextStore:n,property:h,getNode:()=>M.current})),[n,h]);const O=(0,k().K8)((()=>{var e;return null===(e=n.collectionViewStore())||void 0===e?void 0:e.getCollectionStore()}),[n]),D=(0,Yu().n_)({collectionContextStore:n,property:h,propertySchema:C}),[z,L]=(0,r.useState)(!1),W=(0,r.useCallback)((e=>{L(e)}),[L]),H=(0,k().O$)(n.canConfigureBlockStore),N=(0,k().uB)(void 0,V().A),G=(0,k().K8)((()=>o(267956).A.state.publicPageData),[]),{frozenIndex:$,isScrolled:U}=(0,k().O$)(n.frozoneStore),q=$===l,X=(0,k().K8)((()=>{var e;if("relation"!==(null==C?void 0:C.type))return!1;const t=null===(e=n.collectionStore())||void 0===e?void 0:e.getSpaceId();return(0,er().o2)(t,C)}),[n,C]),[{value:Y=!1}]=(0,Zl().Yb)((async()=>{var e;if("formula"!==(null==C?void 0:C.type))return!1;const t=n.collectionStore(),r=null===(e=n.collectionStore())||void 0===e?void 0:e.pointer;if(!(t&&r&&_&&R&&B))return!1;const i=t.getSpaceId(),l=(0,ar().i)(),a=(0,o(502856).MC)({collectionFeatureGates:l,experimentService:u().default,getRecordModel:t.getRecordModel,loadRecordModel:t.loadRecordModel,spaceIdCreator:w.idCreator.getSpaceIdCreatorSync(i)}),s={type:"block",collection:r},c={kind:R.FormulaContextValueKind.ThisRow,type:s},d={sourceProperty:h,valueTypes:[c],handleDataRequest:a,publicPageDataCollection:{id:null==G?void 0:G.collectionId,schema:null==G?void 0:G.collectionSchema},spaceId:t.getSpaceId(),featureGates:l};return!(await B.hasAccessToProperty({collectionPointer:r,collectionSchema:f,context:d,propertyId:h,hasAccessFn:B.hasSameSpaceAccess}))}),[null==C?void 0:C.type,n,_,R,B,h,null==G?void 0:G.collectionId,null==G?void 0:G.collectionSchema,f,w.idCreator]),Q=(0,r.useCallback)((()=>{(0,xs().clear)({environment:w}),(0,Ye().I)({environment:w}),(0,o(404779).y)()}),[w]),Z=(0,r.useCallback)((e=>{g().A.isMobile||(e.preventDefault(),(0,y().SQ)(e,y().y$.EditorContextMenu,(()=>{Q(),N.setState({open:!0})})))}),[Q,N]),J=ap({collectionContextStore:n,collectionViewBlockStore:i,property:h,propertySchema:C}),ee=(0,I().eP)(),te=(0,I().IS)((()=>({container:{display:"flex",flexShrink:0,overflow:"hidden",fontSize:14,padding:0,width:b,borderInlineEnd:a?void 0:`1px solid ${K().Tj.border.secondaryTranslucent}`,background:D?"dark"===ee?"rgba(255, 255, 255, 0.045)":"rgba(55, 53, 47, 0.03)":void 0},button:{display:"flex",alignItems:"center",width:"100%",height:"100%",paddingInlineStart:8,paddingInlineEnd:8,paddingTop:S},buttonHovered:{background:K().Tj.tableRowHoveredBackground},property:{fontSize:14,flex:"1 1 auto",...g().A.isMobile&&{fontSize:15,color:K().Tj.text.tertiary}},icon:{...g().A.isMobile&&{fill:K().Tj.text.tertiary}},menuWrapper:{marginInlineStart:-6}})),[b,a,S,D,ee]),oe=(0,r.useCallback)(((e,t)=>{var r;return C?(0,Ge.jsxs)(ui().Ay,{style:te.button,hoveredStyle:te.buttonHovered,disabled:s,...(0,$i().A)(e,t),children:[v?v(m):void 0,(0,Ge.jsx)(qu().mA,{property:h,propertySchema:C,textRef:P,showIcon:!0,iconStyle:te.icon,showIntegrationIconOverlay:A,badge:(0,Ge.jsxs)(Ge.Fragment,{children:[O?(0,Ge.jsx)(o(846875).$,{collectionStore:O,property:h,propertySchema:C,blockStore:void 0}):void 0,"button"===C.type&&J?(0,Ge.jsx)(ke().I,{icon:fd().exclamationMarkTriangleFillIcon,colorVariant:"secondary"}):void 0,Boolean(null===(r=C.description)||void 0===r?void 0:r.length)&&!g().A.isMobile?(0,Ge.jsx)(o(769068).g,{setIsHovered:W}):void 0,(0,Ge.jsx)(qu().Jv,{propertySchema:C}),O?(0,Ge.jsx)(op,{collectionStore:O,spaceId:O.getSpaceId(),property:h}):void 0,(0,Ge.jsx)(o(534239).Zr,{propertyId:h,propertySchema:C,collectionContextStore:n}),(0,Ge.jsx)(o(237383).i,{propertySchema:C,collectionContextStore:n}),(0,Ge.jsx)(ep,{propertySchema:C})]}),style:te.property}),X?(0,Ge.jsx)(Zu().default,{type:"relation"}):void 0,Y?(0,Ge.jsx)(Zu().default,{type:"formula"}):void 0,q?(0,Ge.jsx)(Xu().A,{isCollectionViewBlockSelected:!1,passesFilter:!0,isScrolled:Boolean(U)}):void 0]}):null}),[C,te.button,te.buttonHovered,te.icon,te.property,s,v,m,O,h,J,W,n,X,Y,q,U,A]),ne=(0,r.useCallback)((e=>C?(0,Ge.jsx)(sp,{collectionContextStore:n,collectionViewBlockStore:i,collectionStore:O,propertySchema:C,property:h,isCrossSpaceRelation:X,isCrossSpaceFormula:Y,isHoveringDescriptionIcon:z,isNameTruncated:F,render:t=>oe(t,e)}):null),[n,O,i,Y,X,z,h,C,oe,F]),re=(0,r.useCallback)((e=>(0,Ge.jsx)(Su().$m,{allowHidingTitle:t,collectionContextStore:n,handleTemporaryNewPropertyInsertion:p,columnIndex:l,format:c,formatKey:d,parent:e,property:h,schema:f})),[t,n,p,l,c,d,h,f]);return C?(0,Ge.jsxs)("div",{ref:M,style:te.container,className:fn().P2l,onContextMenu:Z,children:[(0,Ge.jsx)(Qu().dT,{origin:M,store:n}),(0,Ge.jsx)(Ce().A,{popupType:g().A.isMobile?we().nl.BottomSheet:we().nl.Popup,bottomSheetInitialState:"half",disabled:!H,originGap:0,popupWrapStyle:te.menuWrapper,alignmentToOrigin:"start",buttonPopupStore:N,renderOrigin:ne,render:re,onClick:Q})]}):null}));var dp=()=>o(708685);const up={position:"absolute",insetInlineEnd:0,width:0,flexGrow:0,zIndex:1},pp=r.memo((function({leftFormat:e,height:t,onTemporaryResize:n,onAccept:i,onCancel:l,propertySchema:a,resultStore:s}){const c=(0,r.useRef)(void 0),{isPhone:d}=(0,x().Y0)(),[u,p]=(0,r.useState)(!1),[g,m]=(0,r.useState)(!1),S=!d&&(g||u),h=(0,r.useCallback)((t=>{const o=c.current;if(!o||!o.width)return;const n=Math.max(o.width+t.diffX*((0,uu().A1)()?-1:1),hp(a,e,o.width,t.optionKey));return{...o,width:n}}),[e,a]),y=(0,r.useCallback)((t=>{t.preventDefault(),c.current=e,m(!0)}),[e]),v=(0,r.useCallback)((e=>{const t=h(e);t&&n(t)}),[h,n]),f=(0,r.useCallback)((e=>{const t=h(e);t&&i(t),m(!1)}),[h,i]),b=(0,r.useCallback)((()=>{l(),c.current=void 0,m(!1)}),[l]),w=(0,r.useCallback)((t=>{const n=s.state?s.state.blockIds:[],r=W().oE(n.map((t=>{const n=o(57618).A.findBlockPropertyValueByBlockId(t,e.property),r=null==n?void 0:n.getNode();if(r)return function(e){const t=e.cloneNode(!0);let o=!1;"relative"===(null==e?void 0:e.style.position)&&(e.style.position="unset",o=!0);const n=getComputedStyle(e);for(let l=0;l<n.length;l++){const e=n[l],o=n.getPropertyValue(e);t.style[e]=o}o&&(e.style.position="relative");t.id="notion-table-view-cell-shadow",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.width="auto",t.style.opacity="0",t.style.display="flex",t.style.position="absolute";const r=t.querySelectorAll("*");for(const l of r)l.style&&(l.style.pointerEvents="none",l.style.width="auto");document.body.appendChild(t);const i=t.getBoundingClientRect();return t.remove(),null!=i&&i.width?Math.ceil(i.width)+1:void 0}(r)})));if(e.width){const t={...e,width:Math.min(800,Math.max(Math.max(...r),hp(a,e,e.width)))};i(t)}}),[e,i,a,s]),C=(0,r.useCallback)((e=>(0,Ge.jsx)("div",{style:S?vp(t):yp(t),onDoubleClick:w,...e})),[w,t,S]);return(0,Ge.jsx)("div",{style:up,onMouseMove:()=>p(!0),onMouseLeave:()=>p(!1),children:(0,Ge.jsx)(xd().A,{onDraggableDragStart:y,onDraggableDragMove:v,onDraggableDragEnd:f,onDraggableDragCancel:b,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,render:C})})}));const gp=32,mp=64,Sp=100;function hp(e,t,o,n=!1){if(n)return gp;const r=function(e,t){var o;if("checkbox"===(null==e?void 0:e.type))return gp;if("status"===(null==e?void 0:e.type)&&"checkbox"===t.statusShowAs)return gp;if(("number"===(null==e?void 0:e.type)||"formula"===(null==e?void 0:e.type)&&"number"===(0,dp().getFormulaPropertySchemaResultType)(e))&&"ring"===(null==e||null===(o=e.show_as)||void 0===o?void 0:o.type))return gp;if("auto_increment_id"===(null==e?void 0:e.type))return mp;return Sp}(e,t);return o&&o<r?gp:r}function yp(e){return{width:5,marginInlineStart:-3,marginTop:-1,height:e,transition:"background 200ms ease-out",background:K().IF.blueWithAlpha(0),cursor:"col-resize"}}function vp(e){return{...yp(e),background:K().IF.blueWithAlpha(.8)}}const fp=r.memo((function({store:e,collectionContextStore:t,schema:n,query:i,disabled:l,formatKey:a,disableCellRightBorder:s,renderSpacer:c,allowHidingTitle:d,paddingTop:u,showRightActions:p,showPropertyFormats:m,resultStore:S,format:h,tableStore:y,height:v,groupsPointer:f,property:b,index:w,isLast:C}){const T=(0,x().v3)(),{isPhone:j}=(0,x().Y0)(),A=(0,r.useRef)(null),M=(0,k().K8)((()=>y.getCurrentFormat(h)),[h,y],{useDeepEqual:!0}),P=m[w],{wikiOnboardingPhase:_,showWikiTooltip:R}=(0,k().K8)((()=>{var r,i,l,a;const s=Hu().WH(),c="notion://wiki_collection"===(null===(r=t.collectionStore())||void 0===r?void 0:r.getFormatStore().getKeyStore("app_config_uri").getValue())&&e.isCollectionViewPageWithContent()&&e.id===(null===(i=t.collectionViewBlockStore())||void 0===i?void 0:i.id),d=c&&("notion://wiki/owner_property"===b||b===o(931075)._e.Owner)&&"owner"===s,u=c&&"verification"===(null===(l=n[b])||void 0===l?void 0:l.type)&&"verification"===s,p=c&&"multi_select"===(null===(a=n[b])||void 0===a?void 0:a.type)&&"tags"===s;return{wikiOnboardingPhase:s,showWikiTooltip:!g().A.isMobile&&(d||u||p)}}),[t,b,n,e]),B=(0,k().K8)((()=>s||C&&!(0,bu().fz)(l,p)),[s,l,C,p]),V=(0,k().K8)((()=>(0,te().oe)({environment:T,propertyFormat:P})),[T,P]),F=(0,k().K8)((()=>{const e=y.getCurrentFormat(M);return y.getCurrentProperties(a,e)}),[M,a,y],{useDeepEqual:!0}),E=(0,r.useCallback)(((e,t)=>{const o=y.getCurrentFormat(M),n={property:xn().uR,width:xn().XJ,visible:!0},r=[...y.getCurrentProperties(a,o)];"left"===e?r.splice(w,0,n):r.splice(w+1,0,n);const i={...o,[a]:r},l=f.length>0?f[0].value:void 0;return t&&y.setState({...y.state,temporaryFormat:i,showNewPropertyMenuForGroup:l}),r}),[y,M,a,w,f]),O=(0,r.useCallback)((()=>{y.setState({...y.state,temporaryFormat:void 0,showNewPropertyMenuForGroup:void 0})}),[y]),D=(0,r.useCallback)((e=>{const t=y.getCurrentFormat(M),o=y.getCurrentProperties(a,t).map((t=>t.property===e.property?e:t)),n={...t,[a]:o};y.setState({...y.state,temporaryFormat:n})}),[y,a,M]),z=(0,r.useCallback)((e=>{const o=t.collectionViewStore();if(!o)return;const n=y.getCurrentFormat(M),r=y.getCurrentProperties(a,M).map((t=>t.property===e.property?e:t)),i={...n,[a]:r};et().createAndCommit({userAction:"TableHeaderRow.handleColumnResizeAccept",environment:T,canUndo:!0,perform:e=>{(0,Bi().F)({collectionViewStore:o,update:{format:i},transaction:e})}}),y.setState({...y.state,temporaryFormat:void 0}),(0,N().X)({environment:T,collectionContextStore:t,action:"table_resize_columns"})}),[t,T,M,a,y]),L=(0,r.useCallback)((()=>{y.setState({...y.state,temporaryFormat:void 0})}),[y]),K=(0,I().IS)((()=>({container:{display:"flex",position:"relative"}})),[]),W=(0,k().K8)((()=>{const e=f.length>0?f[0].value:void 0;return!y.state.showNewPropertyMenuForGroup||y.state.showNewPropertyMenuForGroup===e}),[y,f]),H=(0,k().K8)((()=>t.isInLibraryBlock()),[t]);return(0,Ge.jsxs)("div",{style:K.container,ref:R?A:null,children:[R?(0,Ge.jsx)($u,{origin:A,propertyType:_}):void 0,b===xn().uR?(0,Ge.jsx)(we().zD,{popupType:we().nl.Popup,popupWrapStyle:{boxShadow:"none",overflow:void 0,background:"none"},open:W,origin:(0,Ge.jsx)("div",{style:{width:xn().XJ,height:32}}),onDismiss:O,alignmentToOrigin:"start",trapFocus:!0,render:()=>(0,Ge.jsx)(Lu().FZ,{collectionContextStore:t,collectionSettingsStore:t.settingsStore,handleClosePopup:O,newPropertyFormat:F})}):V?(0,Ge.jsx)(cp,{format:M,schema:n,query:i,property:b,handleTemporaryNewPropertyInsertion:E,width:V,collectionViewBlockStore:e,collectionContextStore:t,disabled:l,formatKey:a,isLast:C,disableCellRightBorder:B,allowHidingTitle:d,renderSpacer:c,paddingTop:u,columnIndex:w,groupsPointer:f}):null,!l&&!j||H?(0,Ge.jsx)(pp,{leftFormat:P,onTemporaryResize:D,onAccept:z,onCancel:L,height:v,propertySchema:n[b],resultStore:S}):void 0]},b)})),bp=new(T().O2)("TableSuggestionInlineCells",(()=>o.e(79565).then(o.bind(o,972732)))),xp=(0,T()._h)(bp,(e=>e.TableSuggestionInlineCells)),wp=P().Store.createClass(void 0,{name:"ReducerResultStore"}),Cp=r.memo((function({allowHidingTitle:e,children:t,collectionContextStore:n,disabled:i,disableHorizontalEdgeScroll:l,disableTopBorder:a,format:s,formatKey:c,frozoneProps:d,groupFormat:p,hasMoreReducerResults:g,height:m,isInHomeWidget:S,isInPeekRenderer:h,minWidth:y,paddingLeft:v,paddingRight:f,paddingTop:b,query:w,renderSpacer:C,resultStore:j,schema:A,showHoverActionsStore:M,showPropertyFormats:P,showRightActions:_,store:R,tableStore:B}){const V=(0,r.useRef)(null),F=(0,x().Y0)(),E=(0,r.useRef)(0),O=(0,r.useRef)(!0);r.useEffect((()=>()=>{O.current=!1}),[]);const D=(0,k().K8)((()=>(0,ne().f5)({collectionContextStore:n})),[n]),z=(0,k().O$)(n.canConfigureBlockStore),L=(0,k().K8)((()=>n.permissionScopesStore.state.canConfigureCollection),[n]),W=(0,k().uB)(j,wp),H=(0,r.useMemo)((()=>p?[p]:[]),[p]),N=(0,r.useMemo)((()=>(0,bu().fz)(i,_)&&(L||z)),[i,_,L,z]),G=(0,k().K8)((()=>!!M&&M.state),[M]),$=(0,k().K8)((()=>{var e;return null===(e=n.collectionViewStore())||void 0===e?void 0:e.getType()}),[n]),U=(0,k().O$)(n.isUnlistedViewStore),q=(0,x().v3)(),X=yu(n),Y=function(e){return(0,k().K8)((()=>{const t=e.collectionStore();if(!t)return!1;const o=t.getSchema(),n=Object.values(o).filter((e=>(null==e?void 0:e.type)&&"title"!==(null==e?void 0:e.type))).length>0,r=e.resultSetStore.state.blockIds.size>0;return!n&&!r}),[e])}(n),Q=(0,T().fJ)(Su().IG,{disabled:!X}),Z=(0,r.useRef)(!1);r.useEffect((()=>{Z.current||(Z.current=!0,n.collectionSuggestionStore.setWasInitiallyEmpty(Y))}),[n,Y]);const J=(0,k().K8)((()=>{const e=n.collectionStore();if(!e)return!1;const t=e.getNameStore();return Boolean((0,Je().j)(t))}),[n]),ee=(0,k().K8)((()=>{const e=n.collectionStore(),t=null==e?void 0:e.getNameStore();return t&&e?(0,Xt().r4)(t.getValue(),e):""}),[n]),te=(0,k().K8)((()=>{const e=u().default.getConfigKey("database_newbie_ai_property_preview","ai_property_suggestion");return(null==e?void 0:e.debounce_fetch_suggestion_delay_ms)??500}),[]),oe=(0,_l().Y)((async e=>{if("resolved"!==Q.status)return;E.current+=1;const t=E.current;await Q.value.loadSuggestions({collectionContextStore:n,collectionNameText:e,environment:q,device:F,requestId:t,latestRequestIdRef:E,isMountedRef:O})}),te),re=r.useRef("");r.useEffect((()=>{if(!X)return;const e=n.collectionSuggestionStore;if(!1===e.state.wasInitiallyEmpty)return;if(!J)return;if(!ee.trim())return e.setSuggestions([]),e.clearRemovedPropertySuggestions(),void(re.current="");const t=e.state.suggestions.length>0;(Y||t)&&(re.current!==ee&&(e.clearRemovedPropertySuggestions(),re.current=ee),oe(ee))}),[n,J,ee,Y,oe,X,Q]);const ie=(0,ne().Oz)(n),le=(0,I().IS)((()=>{const e=S?"transparent":U?K().Tj.background.elevated:(null==ie?void 0:ie.background)||(h?K().Tj.background.elevated:K().Tj.background.primary);return{buttonContainer:{display:"flex",justifyContent:"center",alignItems:"center",height:xn().sH},headerRow:{display:"flex",background:e,zIndex:87,height:m,color:K().Tj.text.secondary,boxShadow:`calc(var(--direction, 1) * -3px) 0 0 ${e}, inset 0 -1px 0 ${K().Tj.border.secondaryTranslucent}${a?"":`, inset 0 1px 0 ${K().Tj.border.secondaryTranslucent}`}`,minWidth:y,insetInlineStart:"timeline"===$?void 0:0,insetInlineEnd:"timeline"===$?void 0:0,position:"relative",boxSizing:"border-box"},stickyStyle:{paddingInlineStart:v,paddingInlineEnd:f,minWidth:y,background:e,borderInlineEnd:"timeline"===$?`1px solid ${K().Tj.border.secondaryTranslucent}`:void 0},transitionStickyStyle:{..."timeline"===$?{borderInlineEnd:void 0}:{}}}}),[S,m,a,y,$,v,f,U,h,null==ie?void 0:ie.background]),ae=(0,k().K8)((()=>n.isInLibraryBlock()),[n]),se=(0,k().K8)((()=>{const e=n.userAddedPropertyStore.state,t=n.collectionSuggestionStore;return X&&!e&&t.state.isEnabled&&t.state.isLoading?(0,Ge.jsx)(Su().vO,{}):null}),[X,n]);return(0,Ge.jsx)(Ci().g,{stickyAttachPoint:S?"no-stick":"ceiling",absoluteHeight:m,nodeRef:V,stickyStyle:le.stickyStyle,transitionStickyStyle:le.transitionStickyStyle,children:(0,Ge.jsxs)("div",{className:fn().FYj,style:le.headerRow,ref:V,children:[D?(0,Ge.jsx)(zu,{groupsPointer:H,collectionContextStore:n,frozoneProps:d,hasMoreReducerResults:Boolean(g)}):void 0,(0,Ge.jsx)(kp,{showRightActions:_,store:R,collectionContextStore:n,schema:A,query:w,disabled:i,formatKey:c,disableCellRightBorder:!0,renderSpacer:C,allowHidingTitle:e,paddingTop:b,frozoneProps:d,disableTopBorder:a,backgroundColor:le.headerRow.background,disableHorizontalEdgeScroll:l,showPropertyFormats:P,format:s,height:m,tableStore:B,groupsPointer:H,resultStore:W}),(0,Ge.jsxs)(fe().A,{visible:N,animate:{opacity:G?1:0},style:le.buttonContainer,children:[se,L?(0,Ge.jsx)(o(928196).L,{collectionContextStore:n}):null,z&&!ae?(0,Ge.jsx)(Ou,{collectionContextStore:n}):null]}),t]})})})),kp=r.memo((function({allowHidingTitle:e,backgroundColor:t,collectionContextStore:o,disableHorizontalEdgeScroll:n,disableTopBorder:i,disabled:l,format:a,formatKey:s,frozoneProps:c,groupsPointer:d,height:u,paddingTop:p,query:g,renderSpacer:m,resultStore:S,schema:h,showPropertyFormats:y,showRightActions:v,store:f,tableStore:b}){const w=(0,x().v3)(),C=(0,k().O$)(o.canConfigureBlockStore),T=(0,k().O$)(o.isInHomeWidgetStore),j=yu(o),A=(0,k().K8)((()=>{const e=o.collectionStore();if(!e)return!1;const t=e.getNameStore();return Boolean((0,Je().j)(t))}),[o]),{frozenIndex:M,unfrozenIndexAddendum:P,stickyLeft:_}=(0,r.useMemo)((()=>{const e=null==c?void 0:c.frozenIndex;return{frozenIndex:e,unfrozenIndexAddendum:(0,ne().qi)(e),stickyLeft:null==c?void 0:c.frozenStyles.insetInlineStart}}),[null==c?void 0:c.frozenIndex,null==c?void 0:c.frozenStyles.insetInlineStart]),{showProperties:R,frozenShowProperties:B,unfrozenShowProperties:V}=(0,r.useMemo)((()=>{const e=y.map((e=>e.property)),[t,o]=[e.slice(0,P),e.slice(P)];return{showProperties:e,frozenShowProperties:t,unfrozenShowProperties:o}}),[y,P]),F=(0,r.useCallback)((e=>{const t=o.collectionViewStore();if(!t)return;const n=b.getCurrentFormat(a),r=W().Ul(b.getCurrentProperties(s,a),(t=>{const o=e.indexOf(t.property);return o>=0?o:1/0})),i={...n,[s]:r};et().createAndCommit({userAction:"TableHeaderRow.handleColumnReorder",environment:w,canUndo:!0,perform:e=>{(0,Bi().F)({collectionViewStore:t,update:{format:i},transaction:e})}}),(0,N().X)({environment:w,collectionContextStore:o,action:"table_reorder_columns"})}),[o,w,a,s,b]),E=(0,I().IS)((()=>({flex:{display:"flex"},frozenStyle:{display:"flex",...null==c?void 0:c.frozenStyles,insetInlineStart:T?xn().hj:_??0,boxShadow:`calc(var(--direction, 1) * -3px) 0 0 ${t}, inset 0 -1px 0 ${K().Tj.border.secondaryTranslucent}${i?"":`, inset 0 1px 0 ${K().Tj.border.secondaryTranslucent}`}`}})),[t,i,null==c?void 0:c.frozenStyles,T,_]),O=(0,r.useMemo)((()=>({frozen:B,unfrozen:V})),[B,V]),D=(0,r.useMemo)((()=>({frozen:E.frozenStyle,unfrozen:{display:"flex"}})),[E.frozenStyle]),z=(0,k().K8)((()=>o.collectionSuggestionStore.getActiveSuggestions()),[o]),L=(0,k().K8)((()=>o.userAddedPropertyStore.state),[o]),H=(0,k().K8)((()=>j&&o.collectionSuggestionStore.state.isEnabled&&!L&&(A||z.length>0)),[j,o,L,A,z]),G=(0,r.useCallback)(((t,n,r)=>(0,Ge.jsx)(fp,{collectionContextStore:o,store:f,schema:h,query:g,disabled:l,format:a,formatKey:s,allowHidingTitle:e,showPropertyFormats:y,resultStore:S,showRightActions:v,disableCellRightBorder:!0,renderSpacer:m,paddingTop:p,tableStore:b,groupsPointer:d,height:u,property:t,index:n,isLast:r},t)),[e,o,l,a,s,d,u,p,g,m,S,h,y,v,f,b]),$=(0,r.useMemo)((()=>H&&0!==z.length?(0,Ge.jsx)(xp,{collectionContextStore:o,suggestions:z,renderLoading:()=>null}):null),[H,z,o]);return l||!C?(0,Ge.jsxs)("div",{style:tc().Z0,children:[(0,Ge.jsx)("div",{style:E.frozenStyle,children:B.map(((e,t)=>G(e,t,t===R.length-1)))}),V.map(((e,t)=>G(e,t+P,t===R.length-1))),$]}):(0,ne().Eh)(M)?(0,Ge.jsxs)("div",{style:E.flex,children:[(0,Ge.jsx)(Eu,{style:E.flex,direction:"horizontal",keys:R,sectionedKeys:O,sectionStyles:D,renderKey:G,onDrop:F,disableHorizontalEdgeScroll:n,ghostZIndex:te().OC}),$]}):(0,Ge.jsxs)("div",{style:E.flex,children:[(0,Ge.jsx)(tc().Ay,{direction:"horizontal",keys:R,renderKey:G,onDrop:F,disableHorizontalEdgeScroll:n}),$]})}));function Ip({store:e,collectionContextStore:t,children:o,anyWrapping:n}){return(0,pu().DV)()&&n?(0,Ge.jsx)(Tp,{store:e,collectionContextStore:t,children:o}):(0,Ge.jsx)("div",{style:{display:"flex"},children:o})}function Tp({store:e,collectionContextStore:t,children:o}){const n=(0,x().WS)(),i=(0,r.useRef)(null),l=(0,r.useRef)(null),a=t.virtualizedModule.getBlockHeightsCache(),s=(0,k().O$)(a.getBlockHeightStore(e.id)),c=(0,r.useCallback)((()=>{a.expandHeightToTallestCached(e.id)}),[a,e]);(0,du().tK)(0===s?i:l,c);const d=(0,I().IS)((()=>{const e=n?xn().Um:xn().tt;return{row:{display:"flex",...s?{height:Math.max(s,e),overflowY:"clip"}:{}}}}),[s,n]);return(0,Ge.jsx)("div",{ref:i,style:d.row,children:o})}var jp=()=>o(60481),Ap=()=>o(807990);const Mp=r.memo((function(e){const{store:t,passesFilter:n,canEdit:i,frozoneProps:l}=e,a=(0,_t().ET)(),s=(0,x().v3)(),c=(0,k().K8)((()=>Et().default.state.stores.includes(t)),[t]),d=(0,k().K8)((()=>{var e;return Ap().default.state.isOpen&&(null===(e=Ap().default.state.currentStore)||void 0===e?void 0:e.id)===t.id}),[t]),u=(0,r.useCallback)((e=>{var n;(0,te().ut)({collectionViewBlockId:null===(n=a.collectionViewBlockStore())||void 0===n?void 0:n.id})?(0,Ft().t)({environment:s,stores:[t]}):(0,Va().L)({environment:s,store:t,selectMode:(0,o(338513).g)()?jp().S.MULTI_SELECT_FROM_BOUNDARY:jp().S.TOGGLE}),e.stopPropagation()}),[a,s,t]),p=(0,k().K8)((()=>i||a.isInLibraryBlock()),[i,a]);return(0,Ge.jsx)(Du().V,{checkedState:c,onClick:u,checkboxType:"single_row",collectionContextStore:a,isBlockHovered:d,frozoneProps:l,passesFilter:n,disabled:!p})}));var Pp=()=>o(201941),_p=()=>o(579372),Rp=()=>o(923925);const Bp=r.memo((function(e){const{toggleButton:t,subitemPath:o,shouldShowMultiSelectCheckbox:n,propertyIndex:r}=e,i=(0,I().IS)((()=>{const e=(null==o?void 0:o.length)??0,t=Math.max((e-1)*Pt().yy,0)+Pt().Pi;return{hiddenContainer:{minWidth:t+Pt().yy,...0===r&&n&&{marginInlineStart:-8,marginInlineEnd:4}},buttonContainer:{display:"flex",marginTop:(xn().wc-Pt().yy)/2,...0===r&&n&&{marginInlineStart:-8,marginInlineEnd:0,gap:4}},width:{width:t}}}),[r,n,null==o?void 0:o.length]);return t?(0,Ge.jsxs)("div",{style:i.buttonContainer,children:[(0,Ge.jsx)("div",{style:i.width}),t]}):(0,Ge.jsx)("div",{style:i.hiddenContainer})})),Vp=r.memo((function(e){const{blockPropertyValueOverlayStore:t,canEdit:n,collectionStore:i,collectionViewStore:l,disableCellBorderRight:a,disabled:s,disableHorizontalEdgeScroll:c,disableLastCellBorderRight:u,forceMouseEntered:p,groupFormat:g,handleOpenPeekPage:m,hasColumnVirtualizer:S,index:h,isCollectionViewBlockSelected:y,isLastColumn:v,isLocked:f,isRightMostFrozenColumn:b,isScrolled:w,isSubitemToggleOnTitleColumn:C,normalizedTableSelection:T,onOpenProperty:A,onPropertyBgClick:M,onPropertyClick:P,onPropertyContextMenu:_,onPropertyEnter:R,onPropertyEsc:B,onPropertyTab:V,onPropertyUntab:F,onShiftEnter:E,passesFilter:O,propertyFormat:D,rowIndex:z,schema:L,shouldCaptureKeyboard:N,shouldSetCellHeight:G,shouldShowMultiSelectCheckbox:$,store:U,subitemFormat:q,subitemPath:X,tableWrap:Y,titleColumnIndex:Q,toggleButton:Z}=e,{property:J,wrap:ee}=D,oe=(0,r.useRef)(null),ne=(0,x().v3)(),re=(0,Le().tz)(),ie=(0,_t().ET)(),le=(0,Pp().u)(),ae=(0,k().K8)((()=>(0,te().oe)({environment:ne,propertyFormat:D})),[ne,D]),se=(null==X?void 0:X.length)??0,ce=q&&(0,te().BC)({columnIndex:h,titleColumnIndex:Q,isSubitemToggleOnTitleColumn:C}),de=(0,r.useMemo)((()=>{if(void 0!==ae){if(ce){const e=(0,te().si)({columnIndex:h,indentLevel:se,titleColumnIndex:Q,isSubitemToggleOnTitleColumn:C});return ae-e}return ae}}),[se,h,C,ce,Q,ae]),ue=s||!n,pe=!(0,k().O$)(j().e),ge=(0,Ju()._g)({schema:L,property:D.property}),me=(0,d().X)("collection_view_conditional_colors_property_level"),{background:Se}=(0,o(898009).g)(U,J,L)??{},he=(0,Yu().n_)({collectionContextStore:ie,property:J,propertySchema:ge}),ye=pe&&(0,H().O9)(ge)&&(0,o(334684).$)({propertyType:ge.type,propertySchema:ge,allowAIProperty:!0}),[ve,fe]=(0,k().K8)((()=>{const e=ie.collectionViewBlockStore();if(!e)return[!1,!1];const t=xu().A.state;if(!t.isActive||!(0,xu().g)(t.selectionKey,{collectionViewBlockStore:e,groupFormat:g})||!T)return[!1,!1];const o=T,{start:n,end:r}=o,i=z===n.row||z===r.row||W().r4(z,n.row,r.row),l=h===n.col||h===r.col||W().r4(h,n.col,r.col);return[i&&l,z===n.row&&h===n.col]}),[ie,g,h,T,z]),be=(0,k().K8)((()=>{const e=ie.frozoneStore.state.frozenIndex;return void 0!==e&&h<=e}),[ie,h]),xe=(0,o(736230).V)({collectionContextStore:ie,blockId:U.id,property:J,featureEnabled:S}),we=(0,k().K8)((()=>{const e=ie.permissionScopesStore.state;if(!(!n&&!e.canEditContent&&!Y&&!ee&&["text","title"].includes((null==ge?void 0:ge.type)??"")))return;const t=U.getPropertyValue(J);if(!t||0===t.length)return;const r=(0,o(450648).r4)({textValue:t,getRecordModel:U.getRecordModel,userTimeZone:(0,tr().P)(),intl:re});return 8*r.trim().length>((de?de-16:void 0)??0)?r.trim():void 0}),[n,ie,de,re,J,null==ge?void 0:ge.type,ee,U,Y]),Ce=(0,Rp().f)({tutorialType:"database_onboarding",stepType:"database_onboarding_status_property_tooltip",additionalChecks:e=>"database_onboarding_status_property_tooltip"===(null==e?void 0:e.stepType)&&(null==e?void 0:e.databasePageId)===U.id&&(null==e?void 0:e.statusPropertyId)===J}),ke=(0,Rp().f)({tutorialType:"database_onboarding",stepType:"database_onboarding_database_page_tooltip",additionalChecks:e=>"database_onboarding_database_page_tooltip"===(null==e?void 0:e.stepType)&&(null==e?void 0:e.databasePageId)===U.id&&0===h}),Ie=Ce||ke,Te=(0,r.useCallback)((()=>{P(U,J,L)}),[P,J,L,U]),je=({isWithinFrozenColumns:e,isCollectionViewBlockSelected:t})=>e&&t?K().Tj.tableFrozenSelectedDividerColor:K().Tj.border.secondaryTranslucent,Ae=(0,I().eP)(),Me=(0,I().IS)((()=>{const e=me?Se:void 0;let t;return t=void 0!==e?he?(0,ts().e0)(e,"dark"===Ae?.04:-.04):e:he?"dark"===Ae?"rgba(255, 255, 255, 0.045)":"rgba(55, 53, 47, 0.03)":void 0,{tableCell:{display:"flex",width:ae||void 0,height:xe?void 0:"100%",position:"relative",borderInlineEnd:a||b||v&&u?"none":`1px solid ${je({isWithinFrozenColumns:be,isCollectionViewBlockSelected:y})}`,opacity:ye?.4:1,background:t,borderBottom:me?`1px solid ${K().Tj.border.secondaryTranslucent}`:void 0},tableSelectionOverlay:{borderRadius:fe?2:void 0,background:ve?K().IF.blueWithAlpha(.07):void 0,boxShadow:fe?`inset 0 0 0 2px ${K().Tj.simpleTableSelectionBorder}`:void 0,position:"absolute",pointerEvents:"none",top:0,height:"100%",zIndex:84,width:"100%",insetInlineStart:0},propertyValueContainer:{display:"flex",overflowX:"clip",height:"100%",width:de||void 0,opacity:O?1:.5,color:he?K().Tj.text.secondary:void 0},tourtip:{boxShadow:K().Tj.buttonBlueFocusRing,borderRadius:4}}}),[ae,xe,a,b,v,u,be,y,ye,ve,fe,de,O,Se,he,me,Ae]),Pe=(0,Ge.jsxs)(mt().N,{debugName:"TableRow",capture:N,onShiftEnter:E,children:[(0,Ge.jsx)(vs().BlockPropertyRouter,{collectionStore:i,store:U,property:J,disabled:ue,locked:f,width:de,surface:"table",forceMouseEntered:!!ke||p,tableWrap:Boolean(Y||ee),isLast:v,indentLevel:0===h&&X?X.length:void 0,onTab:V,onUntab:F,onEnter:R,onClick:Te,onEsc:B,onBgClick:M,onContextMenu:_,collectionViewStore:l,shouldSetCellHeight:G,onOpenProperty:A,blockPropertyValueOverlayStore:t,disableHorizontalEdgeScroll:c,handleOpenPeekPage:m,propertyIndex:h,shouldShowMultiSelectCheckbox:$},J),b?(0,Ge.jsx)(Xu().A,{isCollectionViewBlockSelected:y,passesFilter:O,isScrolled:w}):void 0]}),_e=(0,r.useRef)(null),Re=(0,Ge.jsxs)("div",{ref:_e,className:fn().WvK,"data-row-index":z,"data-col-index":h,style:Me.tableCell,children:[ce?(0,Ge.jsx)(Bp,{subitemFormat:q,toggleButton:Z,subitemPath:X,shouldShowMultiSelectCheckbox:$,propertyIndex:h}):null,(0,Ge.jsx)("div",{style:Me.propertyValueContainer,children:Pe}),ve?(0,Ge.jsx)("div",{style:Me.tableSelectionOverlay}):void 0,(0,Ge.jsx)(o(241262).O,{rowStore:U,property:J,collectionStore:i})]});return we?(0,Ge.jsx)(Wo().m,{placement:"top",renderTooltip:()=>we,render:e=>(0,Ge.jsx)("div",{...e,children:Re}),textWrap:!0}):Ie?(0,Ge.jsxs)("div",{ref:oe,style:Me.tourtip,children:[(0,Ge.jsx)(_p().O,{contentRef:oe,tutorialStepId:Ce?"database_onboarding_status_property_tooltip":"database_onboarding_database_page_tooltip",type:"database_onboarding",teamIds:le}),Re]}):Re})),Fp=r.memo((function(e){const{blockPropertyValueOverlayStore:t,propertyFormats:o,propertyFormatsMap:n,visiblePropertiesLength:r,store:i,tableWrap:l,shouldSetCellHeight:a,indexAddendum:s,frozoneProps:c,normalizedTableSelection:d,canEdit:u,isInHomeWidget:p,...g}=e,m=(0,_t().ET)(),S=(0,k().K8)((()=>m.collectionViewStore()),[m]),h=(0,k().K8)((()=>{if(i.isDefined())return ne().Dj({store:i,collectionContextStore:m})}),[i,m]),y=(0,k().K8)((()=>!t.state.isOpen&&Et().default.state.stores.length>0&&Et().default.state.stores[0]===i),[t,i]),v=(0,k().O$)(m.currentSubitemFormatStoreForUiDisplayStore),f=(0,k().K8)((()=>"title"===(null==S?void 0:S.getFormatStore().getKeyStore("table_subitem_toggle_column").getValue())),[S]),b=(0,k().K8)((()=>m.frozoneStore.state.frozenIndex),[m]),x=(0,k().K8)((()=>{if(!u)return;if(p)return;if(m.isInlineViewStore.state&&m.isUnlistedViewStore.state)return;const e=Ap().default.state;return Boolean(e.isOpen&&e.currentStore===i)}),[u,m,p,i]);if(!h)return null;const w=r??o.length;return(0,Ge.jsx)(Ge.Fragment,{children:o.map(((e,o)=>{const r=(null==n?void 0:n[o])??o+(s??0);return(0,Ge.jsx)(Vp,{index:r,store:i,propertyFormat:e,isLastColumn:r===w-1,isRightMostFrozenColumn:b===r,collectionViewStore:S,collectionStore:h,tableWrap:l,shouldSetCellHeight:a,forceMouseEntered:"title"===e.property?x:void 0,shouldCaptureKeyboard:y,subitemFormat:v,isSubitemToggleOnTitleColumn:f,blockPropertyValueOverlayStore:t,isScrolled:(null==c?void 0:c.isScrolled)??!1,normalizedTableSelection:d,canEdit:u,isInHomeWidget:p,...g},e.property)}))})})),Ep=r.memo((function({propertyFormats:e,...t}){const{propertiesInRange:o,propertiesInRangeIndices:n,beforeWidth:r,afterWidth:i}=(0,pu().UB)();return(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)("div",{style:{width:`${r}px`}}),(0,Ge.jsx)(Fp,{...t,propertyFormats:o,propertyFormatsMap:n}),(0,Ge.jsx)("div",{style:{width:`${i}px`}})]})})),Op=r.memo(r.forwardRef((function(e,t){const{disabled:n,store:i,groupFormat:l,collectionContextStore:s,propertyFormats:c,frozoneProps:u,shouldShowMultiSelectCheckbox:p,isLast:g,isInHomeWidget:m,isCollectionViewBlockSelected:S,allRows:h,isInEphemeralView:y,normalizedTableSelection:v,unfrozenIndexAddendum:f,frozenPropertyFormats:b,unfrozenPropertyFormats:w,tableWrap:C,shouldSetCellHeight:T,isNonEditable:j,shouldShowRightActionSpacer:A,...M}=e,{handleOpenPeekPage:P}=e,_=Boolean(e.passesFilter),R=(0,r.useRef)(null),B=(0,x().v3)(),V=(0,k().K8)((()=>!n&&i.canEdit()),[n,i]),F=(0,r.useMemo)((()=>h.findIndex((e=>e===i))),[h,i]),E=null==u?void 0:u.frozenIndex,O=void 0!==E,D=-1===E,z=(0,k().K8)((()=>{if(void 0===E)return!1;const e=xu().A.state,t=s.collectionViewBlockStore();if(!t)return!1;if(!e.isActive||!(0,xu().g)(e.selectionKey,{collectionViewBlockStore:t,groupFormat:l})||!v)return!1;const o=v,{start:n}=o;return F===n.row&&n.col<=E}),[l,s,v,E,F]),{background:L}=(0,ls().y)(i)??{},W=(0,d().X)("collection_view_conditional_colors_property_level"),H=(0,r.useMemo)((()=>O?{...null==u?void 0:u.frozenStyles,...z?{zIndex:86}:{zIndex:85},...D?{background:void 0}:{},...m?{insetInlineStart:xn().hj}:{},...!L||D||W?{}:{background:L}}:{}),[O,null==u?void 0:u.frozenStyles,z,D,m,L,W]),N=(0,I().IS)((()=>{const e={display:"flex",width:"100%",...L&&!W&&{background:L}},t={...g&&m?{}:{borderBottom:`1px solid ${K().Tj.border.secondaryTranslucent}`}};return{tableViewRowStyle:{...e,...W?{flex:"0 0 fit-content"}:t},tableViewRowStyleWithBorder:{...e,...t},checkboxContainer:{position:"absolute",insetInlineStart:-xn().Fh,...!D&&{background:null==u?void 0:u.frozenStyles.background,height:"100%"}}}}),[D,null==u?void 0:u.frozenStyles.background,m,g,L,W]),G=(0,r.useCallback)((()=>{const{mainEditorCurrentBlockStore:e}=a().default.state,t=ne().wy({environment:B,store:i,mainEditorCurrentBlockStore:e,collectionContextStore:s,fullyQualified:!1,overridePeekMode:y?"center_peek":void 0});t&&(P(),(0,Da().navigate)({environment:B,url:t}))}),[s,B,P,y,i]),$=(0,pu().DV)(),U=C||c.some((e=>e.wrap)),q=(0,Ge.jsxs)(r.Fragment,{children:[(0,Ge.jsx)("div",{className:fn().Eo4,style:N.tableViewRowStyle,ref:R,children:(0,Ge.jsx)(Ne().c,{store:i,step:"demo_collection_record",children:(0,Ge.jsxs)(Ip,{collectionContextStore:s,store:i,anyWrapping:U,children:[(0,Ge.jsx)("div",{style:H,children:(0,Ge.jsx)(o(1511).x,{isCollectionViewBlockSelected:S,passesFilter:_,shouldFreeze:!D,children:(0,Ge.jsxs)(Ge.Fragment,{children:[p?(0,Ge.jsx)(fe().A,{animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},config:{timingFunction:"ease-out"},children:(0,Ge.jsx)("div",{style:N.checkboxContainer,children:(0,Ge.jsx)(Mp,{store:i,passesFilter:_,frozoneProps:u,canEdit:V})})}):void 0,(0,Ge.jsx)(Fp,{store:i,canEdit:V,propertyFormats:b,visiblePropertiesLength:b.length,shouldSetCellHeight:T,indexAddendum:0,rowIndex:F,disabled:n,groupFormat:l,tableWrap:C,isLocked:j,isCollectionViewBlockSelected:S,passesFilter:_,shouldShowMultiSelectCheckbox:p,frozoneProps:u,normalizedTableSelection:v,isInHomeWidget:m,...M})]})})}),$?(0,Ge.jsx)(Ep,{store:i,canEdit:V,propertyFormats:w,visiblePropertiesLength:w.length,shouldSetCellHeight:T,indexAddendum:f,rowIndex:F,disabled:n,groupFormat:l,tableWrap:C,isLocked:j,isCollectionViewBlockSelected:S,passesFilter:_,shouldShowMultiSelectCheckbox:p,frozoneProps:u,normalizedTableSelection:v,isInHomeWidget:m,...M}):(0,Ge.jsx)(Fp,{store:i,canEdit:V,propertyFormats:w,visiblePropertiesLength:w.length,shouldSetCellHeight:T,indexAddendum:f,rowIndex:F,disabled:n,groupFormat:l,tableWrap:C,isLocked:j,isCollectionViewBlockSelected:S,passesFilter:_,shouldShowMultiSelectCheckbox:p,frozoneProps:u,normalizedTableSelection:v,isInHomeWidget:m,...M})]})})}),W?(0,Ge.jsx)("div",{style:{...N.tableViewRowStyleWithBorder,flex:"1 0 fit-content"}}):null,A?(0,Ge.jsx)("div",{style:{...N.tableViewRowStyleWithBorder,display:"flex",justifyContent:"flex-start",flexGrow:1,width:64}}):null]});return(0,Qt().NW)(i,t,(0,r.useMemo)((()=>({renderedType:"table_row",getNode:()=>R.current,getBlockStore:()=>i,activate:G})),[G,i]),q)})));const Dp=function(e){const{frozenColumnRepositionStore:t,frozenIndex:o,maxFrozenIndex:n,xForFirstCellInRow:i,showPropertyFormats:l,frozenSectionWidth:a}=e,s=(0,x().v3)(),c=(0,_t().Ks)(),d=(0,r.useRef)(null),u=(0,r.useRef)(null),[p,g]=r.useState({x:0,y:0,width:0,maxY:0,isEntered:!1,isMouseDown:!1}),[S,h]=r.useState(0),[y,v]=r.useState(0),f=(0,k().K8)((()=>t.state.isRepositioning||p.isMouseDown),[t,p.isMouseDown]),b=(0,k().K8)((()=>t.state.newFrozenIndex),[t]),w=(0,k().K8)((()=>!!c&&(0,ne().f5)({collectionContextStore:c})),[c]),C=(0,k().K8)((()=>null==c?void 0:c.frozoneStore.state.isScrolled),[c]),T=(0,k().K8)((()=>!C&&-1===o&&w?-4:0),[o,C,w]),j=p.isEntered||f,A=(0,k().K8)((()=>t.state.newFrozenColumnXPosition),[t]),M=(0,r.useContext)(m().U),P=null==M?void 0:M.horizontalScroller,_=(0,r.useCallback)((()=>{var e,t,o;if(!P||!d.current)return 0;const n=(null===(e=d.current.getBoundingClientRect())||void 0===e?void 0:e.top)??0,r=null===(t=P.getNode())||void 0===t?void 0:t.getElementsByClassName(fn().FYj);return(r&&r.length>0?null===(o=r[0].getBoundingClientRect())||void 0===o?void 0:o.top:0)-n}),[P]),R=(0,r.useCallback)((()=>{var e,t,o,n,r;if(!P||!d.current)return 0;const i=(null===(e=d.current)||void 0===e||null===(e=e.getBoundingClientRect())||void 0===e?void 0:e.bottom)??0,l=null===(t=P.getNode())||void 0===t?void 0:t.getElementsByClassName(fn().Eo4),a=l&&l.length>0?null===(o=l[l.length-1].getBoundingClientRect())||void 0===o?void 0:o.bottom:0,s=null===(n=P.getNode())||void 0===n?void 0:n.getElementsByClassName(fn().Mbm),c=s&&s.length>0?null===(r=s[s.length-1].getBoundingClientRect())||void 0===r?void 0:r.bottom:0;return Math.max(a,c)-i}),[P]),B=(0,k().K8)((()=>{var e;const t=null===(e=d.current)||void 0===e?void 0:e.getBoundingClientRect();return t&&void 0!==a?new DOMRect(t.x+a+p.x+10,t.y+p.y+10,3,3):void 0}),[a,p]),V=(0,k().K8)((()=>{const e=(null==c?void 0:c.frozoneStore.state.scrollerLeftOffset)??0,t=(0,no().kf)(s),o=Math.max(t-e,0);return c&&(0,te().QP)(s,c)?o:0}),[c,s]),F=(0,k().K8)((()=>c&&(0,ne().f5)({collectionContextStore:c})),[c]),E=(0,r.useCallback)((e=>{if(void 0===o||void 0===n||void 0===a||null===d.current||null===u.current)return;const r=d.current.getBoundingClientRect(),s=e.clientX-r.x;if(null==c||c.frozoneStore.setState({...null==c?void 0:c.frozoneStore.state,tryShowHiddenFrozenColumn:s<42}),!j)return;const p=_();h(p);const m=R();v(m);const S=2+a,y=Math.max(s-S,-S),b=e.clientY-r.y-14,x=r.bottom-r.top-14+m,w=f?p:-14,k=Math.max(Math.min(b,x),w);if(g((e=>({...e,x:f?y:0,y:k}))),f){const e=l,r=u.current.getBoundingClientRect();let c=s,d=i,p=-1,g=d,m=Math.abs(d-c);for(let t=0;t<e.length&&!(t>n);t++){const n=e[t];d+=(null==n?void 0:n.width)??0,C&&t===o+1&&(c-=r.x);const i=Math.abs(d-c);i<m&&(m=i,g=d,p=t)}t.setState({...t.state,newFrozenIndex:p,newFrozenColumnXPosition:g-a-1})}}),[o,n,a,null==c?void 0:c.frozoneStore,j,_,R,f,l,i,t,C]);(0,r.useEffect)((()=>{const e=W().nF((e=>{E(e)}),25);return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[E]);const O=(0,r.useCallback)((e=>{f||(E(e.nativeEvent),g((e=>({...e,isEntered:!0,isMouseDown:!1}))))}),[f,E]),D=(0,r.useCallback)((e=>{f||g((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[f]),z=(0,r.useCallback)((e=>{g((e=>({...e,isMouseDown:!0})))}),[]),L=(0,r.useCallback)((e=>{f&&g((e=>({...e,isEntered:!0})))}),[f]),H=(0,r.useCallback)((e=>{g((e=>({...e,isEntered:!1,isMouseDown:!1})))}),[]),N=(0,r.useCallback)((e=>{f&&g((e=>({...e,x:0,isEntered:!1,isMouseDown:!1})))}),[f]),G=(0,I().eP)(),$=(0,I().IS)((()=>{const e=void 0!==b&&void 0!==o&&b<=o;return{repositionerContainer:{zIndex:87,display:"flex",position:"absolute",width:"100%",height:"100%",cursor:f?"grabbing":"grab",pointerEvents:f?void 0:"none"},repositionerOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)",height:"100%"},repositionerInsideStickyWrapper:{position:"sticky",insetInlineStart:V+(F?xn().Fh:0),height:"100%"},tooltipContainer:{position:"absolute",insetInlineStart:-1!==a||C?a??0:5,zIndex:30,height:"100%"},tooltipOrigin:{position:"absolute",insetInlineStart:-3,top:0,width:8,pointerEvents:"auto",cursor:f?"grabbing":"grab",height:"100%"},tooltipColumn:{position:"absolute",insetInlineStart:f?p.x-1:-1,top:f?S:0,width:2,height:f?`calc(100% + ${y-S}px`:"100%",background:"dark"===G?K().Tj.palette.gray[500]:K().Tj.palette.gray[200]},ghostColumnBase:{position:"absolute",top:f?S:0,width:1,height:f?`calc(100% + ${y-S}px`:"100%",background:K().Tj.palette.uiBlue[300]},frozenGhostColumn:{insetInlineStart:A,opacity:f&&e?1:0},unfrozenGhostColumn:{insetInlineStart:(a??0)+(A??0),opacity:j&&f&&!e?1:0},tooltipDraggable:{position:"absolute",insetInlineStart:f?p.x-2:-2,top:p.y,width:4,height:28,background:K().Tj.palette.uiBlue[600],borderRadius:4}}}),[b,o,f,V,F,a,C,p.x,p.y,S,y,A,j,G]);return(0,Ge.jsx)("div",{className:fn().FZs,style:$.repositionerContainer,onMouseEnter:L,onMouseLeave:H,onMouseUp:N,children:(0,Ge.jsxs)("div",{style:$.repositionerOutsideStickyWrapper,ref:u,children:[(0,Ge.jsx)("div",{style:$.repositionerInsideStickyWrapper,ref:d,children:(0,Ge.jsx)(Wo().m,{renderTooltip:()=>f&&void 0!==b&&b!==o?(0,Ge.jsx)(Le().sA,{id:"tableView.selectionOverlay.repositioner.dynamicTooltip",defaultMessage:"Freeze {numColumns} {numColumns, select, 1 {column} other {columns}}",values:{numColumns:b+1}}):(0,Ge.jsx)(Le().sA,{id:"tableView.selectionOverlay.repositioner.tooltip",defaultMessage:"Drag horizontally to freeze columns"}),delayThreshold:300,forceVisibleState:f||void 0,placement:"right",originRect:B,render:e=>(0,Ge.jsxs)(fe().A,{animate:{translateX:T,opacity:j?1:0},...e,style:$.tooltipContainer,children:[(0,Ge.jsx)("div",{style:$.tooltipOrigin,onMouseEnter:O,onMouseLeave:D,onMouseDown:z}),(0,Ge.jsx)("div",{style:{...$.ghostColumnBase,...$.frozenGhostColumn}}),(0,Ge.jsx)("div",{style:$.tooltipColumn}),(0,Ge.jsx)("div",{style:$.tooltipDraggable})]})})}),(0,Ge.jsx)("div",{style:{...$.ghostColumnBase,...$.unfrozenGhostColumn}})]})})},zp={tableSelectionOverlayActions:new(T().O2)("tableSelectionOverlayActions",(async()=>await Promise.all([o.e(88723),o.e(95496)]).then(o.bind(o,339016)))),tableSelectionOverlayPropertyActions:new(T().O2)("tableSelectionOverlayPropertyActions",(async()=>await Promise.all([o.e(88723),o.e(40589)]).then(o.bind(o,233035))))};var Lp=()=>o(556148);class Kp extends P().Store{getInitialState(){}}const Wp=Kp;class Hp extends P().Store{getInitialState(){return{isRepositioning:!1,newFrozenIndex:void 0,newFrozenColumnXPosition:void 0}}}const Np=Hp,Gp=new Set(["rollup","formula","verification"]);function $p(e){const{dragAndFillStore:t,frozenIndex:o,rowsWrapRect:n,schema:i,selection:l,selectionStartRectStore:a,showPropertyFormats:s}=e,c=(0,_t().ET)(),d=(0,k().O$)(t),u=(0,k().K8)((()=>{var e;const t=(null==d?void 0:d.start)||l.start,o=s[t.col];return o?null===(e=i[o.property])||void 0===e?void 0:e.type:void 0}),[d,l,s,i]),p=(0,k().O$)(a),g=void 0!==o&&l.start.col<=o,m=(0,k().O$)(c.isInHomeWidgetStore),S=(0,k().K8)((()=>(0,ne().f5)({collectionContextStore:c})),[c]),h=(0,I().IS)((()=>{const e=g?"sticky":void 0;let t=0;m?t=xn().hj:S&&(t=xn().Fh);return{dragAndFillContainer:{zIndex:91,display:"flex",position:"relative"},dragAndFillOutsideStickyWrapper:{display:"flex",width:"calc(100% - 64px)"},dragAndFillInsideStickyWrapper:{position:e,insetInlineStart:t},tooltipContainer:p?{position:"absolute",insetInlineStart:p.left+p.width-6-(S?xn().Fh:0)}:{},tooltipOrigin:{position:"absolute",insetInlineStart:0,top:p?p.bottom-7:void 0,width:10,height:15,pointerEvents:"auto",cursor:"ns-resize"},tooltipCircle:{position:"absolute",insetInlineStart:0,top:p?p.bottom-5:void 0,width:9,height:9,border:`2px solid ${K().Tj.simpleTableSelectionBorder}`,transform:d?"scale(1.3)":void 0,transition:"transform 0.2s ease",background:K().Tj.background.primary,borderRadius:"50%",cursor:"ns-resize"},tooltipText:{color:K().Tj.text.inverseSecondary,maxWidth:200,...pe().RC}}}),[g,m,S,p,d]),y=(0,r.useMemo)((()=>{if(p&&n)return new DOMRect(p.x+n.x+p.width-4,p.y+n.y+p.height-4,7,7)}),[p,n]),v=(0,r.useCallback)((()=>(0,Ge.jsx)(Le().sA,{id:"tableView.selectionOverlay.dragAndFill.tooltip",defaultMessage:"Drag vertically to fill value"})),[]),f=(0,r.useCallback)((e=>(0,Ge.jsx)("div",{...e,style:h.dragAndFillContainer,children:(0,Ge.jsx)("div",{style:h.dragAndFillOutsideStickyWrapper,children:(0,Ge.jsx)("div",{style:h.dragAndFillInsideStickyWrapper,children:(0,Ge.jsxs)("div",{style:h.tooltipContainer,children:[(0,Ge.jsx)("div",{style:h.tooltipOrigin}),(0,Ge.jsx)("div",{className:fn().yle,style:h.tooltipCircle})]})})})})),[h]);return p?!u||(0,er().F_)(u)||Gp.has(u)?null:(0,Ge.jsx)(Wo().m,{renderTooltip:v,delayThreshold:300,forceVisibleState:!!d||void 0,originRect:y,placement:"right",render:f}):null}function Up(e){const{selectionStartRectStore:t,selectionEndRectStore:o}=e,n=(0,_t().ET)(),r=(0,k().O$)(t),i=(0,k().O$)(o),l=(0,k().K8)((()=>(0,Lp().$u)(n)),[n]),a=(0,I().IS)((()=>{if(!r||!i)return{border:{}};const e=Math.min(r.left,i.left),t=Math.min(r.top,i.top),o=Math.max(r.right,i.right),n=Math.max(r.bottom,i.bottom);return{border:{position:"absolute",insetInlineStart:e-l+1,top:t+1,width:o-e-2,height:n-t-2,border:`solid ${K().Tj.simpleTableSelectionBorder}`,borderWidth:1,borderRadius:2,zIndex:87,pointerEvents:"none"}}}),[r,i,l]);return r&&i?(0,Ge.jsx)("div",{style:a.border}):null}const qp=r.memo((function(e){const{groupFormat:t}=e,n=(0,x().v3)(),i=(0,r.useContext)(Ea().n),l=(0,pu().PD)(),a=(0,r.useRef)(null),s=(0,r.useRef)(void 0),c=(0,d().X)("improved_drag_and_fill"),u=(0,d().X)("multi_cell_selection_border"),{value:p}=(0,T().fJ)(Rt().g),{value:g}=(0,T().fJ)(Bt().S),{value:m}=(0,T().fJ)($t().T.formulas),S=(0,r.useMemo)((()=>zp.tableSelectionOverlayActions.load()),[]),h=(0,k().uB)(void 0,Wp),y=(0,k().uB)(void 0,Np),v=(0,k().r6)((()=>(0,Pt().v2)(t,e.collectionContextStore)),[t,e.collectionContextStore]),f=(0,k().K8)((()=>(0,ne().f5)({collectionContextStore:e.collectionContextStore})),[e.collectionContextStore]),b=(0,k().K8)((()=>e.collectionContextStore.normalizedSchemaStore.state),[e.collectionContextStore]),w=(0,k().r6)((()=>{const n=e.collectionContextStore.collectionViewBlockStore();if(!n)return;const r=xu().A.state;if(!r.isActive||!(0,xu().g)(r.selectionKey,{collectionViewBlockStore:n,groupFormat:t}))return;const i=(0,te().yR)(r.selection,e.showPropertyFormats.length,v.state.length);return o(770703).kn(v.state[i.start.row]),i}),[e.collectionContextStore,e.showPropertyFormats.length,t,v],{useDeepEqual:!0}),C=(0,k().O$)(w),I=(0,k().K8)((()=>{const e=w.state;return e&&e.start.col===e.end.col&&e.start.row===e.end.row}),[w]),j=(0,k().K8)((()=>{const e=w.state;return e&&e.start.row===e.end.row}),[w]),A=c?j:I,M=(0,k().r6)((()=>{const t=w.state;if(!t)return;if(!a.current)return;const o=t.start,n=e.showPropertyFormats,r=v.state[o.row],i=(0,Lp().Xw)(r,a.current);if(!i)return;const l=a.current.getBoundingClientRect(),s=i.height,c=i.top-l.top-1,d=n[o.col].width||0,u=s+1;let p=(0,Lp().$u)(e.collectionContextStore);for(let e=0;e<o.col;e++){const t=n[e];t.width&&(p+=t.width)}return new DOMRect(p-1,c,d+1,u)}),[v,w,e.collectionContextStore,e.showPropertyFormats]),P=(0,k().r6)((()=>{const t=w.state;if(!t)return;if(!a.current)return;const o=t.end,n=e.showPropertyFormats,r=v.state[o.row],i=(0,Lp().Xw)(r,a.current);if(!i)return;const l=a.current.getBoundingClientRect(),s=i.height,c=i.top-l.top-1,d=n[o.col].width||0,u=s+1;let p=(0,Lp().$u)(e.collectionContextStore);for(let e=0;e<o.col;e++){const t=n[e];t.width&&(p+=t.width)}return new DOMRect(p-1,c,d+1,u)}),[v,w,e.collectionContextStore,e.showPropertyFormats]),_=(0,k().r6)((()=>j?P.state:void 0),[P,j]),R=c?_:M,B=(0,k().r6)((()=>e.collectionContextStore.frozoneStore.state.frozenIndex),[e.collectionContextStore]),V=(0,k().K8)((()=>{const t=e.collectionContextStore,o=t.collectionViewStore(),n=t.frozoneStore.state.scrollerWidth;return null==o?void 0:o.getTableMaxFrozenColumnIndex(n,t.normalizedFormatStore.state)}),[e.collectionContextStore]),F=(0,k().r6)((()=>{const t=B.state;if(void 0!==t){let o=(0,Lp().$u)(e.collectionContextStore);const n=e.showPropertyFormats;for(let e=0;e<=t&&!(e>=n.length);e++){const t=n[e];t.width&&(o+=t.width)}return o-1-(f?xn().Fh:0)}}),[B,f,e.collectionContextStore,e.showPropertyFormats]),E=(0,k().K8)((()=>(0,Lp().$u)(e.collectionContextStore)-(f?xn().Fh:0)),[e.collectionContextStore,f]),O=(0,k().K8)((()=>{let t=!1;const o=(0,Lp().yA)(e.collectionContextStore,e.groupFormat),n=o.length,r=Et().default.state.stores.filter((e=>o.includes(e))).length;return t=0!==n&&0!==r&&(r===n||"indeterminate"),void 0!==B.state&&!h.state&&!t&&!xu().A.state.isActive&&void 0===e.tableStore.state.temporaryFormat&&e.collectionContextStore.permissionScopesStore.state.canConfigureBlock}),[h,B,e.collectionContextStore,e.groupFormat,e.tableStore]);(0,r.useEffect)((()=>{a.current&&(s.current=new MutationObserver((()=>{M.recompute()})),s.current.observe(a.current,{attributes:!0,childList:!0,characterData:!0,subtree:!0}));const e=s.current;return()=>{e&&e.disconnect()}}),[M]);const D=(0,r.useCallback)((async t=>{(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:Lp().Dp.Left,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:w.state,allRows:v.state,frozenSectionWidth:F.state,frozenIndex:B.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,n,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,e.disableHorizontalEdgeScroll,w,v,F,B,l]),z=(0,r.useCallback)((async t=>{(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:Lp().Dp.Right,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:w.state,allRows:v.state,frozenSectionWidth:F.state,frozenIndex:B.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,v,n,B,F,w,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),L=(0,r.useCallback)((async t=>{(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:Lp().Dp.Up,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:w.state,allRows:v.state,frozenSectionWidth:F.state,frozenIndex:B.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,v,n,B,F,w,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),K=(0,r.useCallback)((async t=>{(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:Lp().Dp.Down,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:w.state,allRows:v.state,frozenSectionWidth:F.state,frozenIndex:B.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,v,n,B,F,w,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),W=(0,r.useCallback)((async t=>{(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:Lp().Dp.Up,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:w.state,allRows:v.state,frozenSectionWidth:F.state,frozenIndex:B.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,v,n,B,F,w,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),H=(0,r.useCallback)((async t=>{(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:Lp().Dp.Down,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:w.state,allRows:v.state,frozenSectionWidth:F.state,frozenIndex:B.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,v,n,B,F,w,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),N=(0,r.useCallback)((async t=>{(await S).handleEnter({shortcutEvent:t,environment:n,schema:b,showPropertyFormats:e.showPropertyFormats,disabled:e.disabled,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,collectionContextStore:e.collectionContextStore,normalizedTableSelection:w.state,allRows:v.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[S,v,n,w,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,b]),G=(0,r.useCallback)((async t=>{t.preventDefault();(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:Lp().Dp.Right,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:w.state,allRows:v.state,frozenSectionWidth:F.state,frozenIndex:B.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,v,n,B,F,w,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),$=(0,r.useCallback)((async t=>{t.preventDefault();(await S).handleDirection({shortcutOrKeyboardEvent:t,direction:Lp().Dp.Left,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:w.state,allRows:v.state,frozenSectionWidth:F.state,frozenIndex:B.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,columnVirtualizer:l})}),[S,v,n,B,F,w,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,l]),U=(0,r.useCallback)((async e=>{(await S).handleEsc({keyboardEvent:e,environment:n,normalizedTableSelection:w.state,allRows:v.state})}),[v,n,w,S]),q=(0,r.useCallback)((async()=>{(await S).handleDelete({environment:n,collectionContextStore:e.collectionContextStore,disabled:e.disabled,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:w.state,allRows:v.state})}),[v,n,w,e.collectionContextStore,e.disabled,e.showPropertyFormats,S]),X=(0,r.useCallback)((async t=>{(await S).handleCut({clipboardEvent:t,environment:n,collectionContextStore:e.collectionContextStore,disabled:e.disabled,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:w.state,allRows:v.state,formulasModule:m})}),[S,n,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,w,v,m]),Y=(0,r.useCallback)((async t=>{(await S).handleCopy({clipboardEvent:t,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,allRows:v.state,formulasModule:m,normalizedTableSelection:w.state,environment:n})}),[S,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,v,m,w,n]),Q=(0,r.useCallback)((async t=>{const o=await S,r=await It().R.clipboardActions.load();o.handlePaste({clipboardEvent:t,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,schema:b,showPropertyFormats:e.showPropertyFormats,markdownLinkifyIt:p,tinyMceMicrosoftWordPasteFilter:g,disabled:e.disabled,allRows:v.state,clipboardActions:r,normalizedTableSelection:w.state})}),[S,v,n,p,w,e.collectionContextStore,e.disabled,e.groupFormat,e.showPropertyFormats,b,g]),Z=(0,r.useCallback)((async()=>{(await S).handleCommandEnter({environment:n,collectionContextStore:e.collectionContextStore,normalizedTableSelection:w.state,allRows:v.state,overrideLinkClick:i})}),[v,n,w,i,e.collectionContextStore,S]),J=(0,r.useCallback)((async()=>{(await S).handleShiftEnter({environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:w.state,allRows:v.state,selectionStartRectStore:M,frozenSectionWidth:F.state,frozenIndex:B.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[S,v,n,B,F,w,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.groupFormat,e.showPropertyFormats,M]),ee=(0,r.useCallback)((async()=>{(await S).handleCommandShiftEnter({environment:n,normalizedTableSelection:w.state,allRows:v.state})}),[S,v,n,w]),oe=(0,r.useCallback)((async t=>{(await S).handleDuplicate({keyboardEvent:t,environment:n,disabled:e.disabled,schema:b,showPropertyFormats:e.showPropertyFormats,normalizedTableSelection:w.state,allRows:v.state,store:e.store})}),[S,v,n,e.store,w,b,e.disabled,e.showPropertyFormats]),re=(0,r.useCallback)((async t=>{(await S).handleKeypress({keyboardEvent:t,environment:n,schema:b,showPropertyFormats:e.showPropertyFormats,disabled:e.disabled,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,collectionContextStore:e.collectionContextStore,normalizedTableSelection:w.state,allRows:v.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})}),[S,v,n,w,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.disabled,e.showPropertyFormats,b]),ie=(0,r.useCallback)((async e=>{(await S).handleMoveTo({shortcutOrKeyboardEvent:e,environment:n,normalizedTableSelection:w.state,allRows:v.state})}),[S,v,n,w]),le=(0,r.useCallback)((async t=>{(await S).handleDragStart({dragEvent:t,environment:n,collectionContextStore:e.collectionContextStore,showPropertyFormats:e.showPropertyFormats,paddingLeft:e.paddingLeft,disabled:e.disabled,dragAndFillStore:h,frozenColumnRepositionStore:y,frozenIndex:B.state,allRows:v.state,normalizedTableSelection:w.state})}),[S,v,h,n,y,B,w,e.collectionContextStore,e.showPropertyFormats,e.disabled,e.paddingLeft]),ae=(0,r.useCallback)((async t=>{(await S).handleDragMove({dragEvent:t,environment:n,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,dragAndFillStore:h,frozenColumnRepositionStore:y,normalizedTableSelection:w.state,allRows:v.state,selectionStartRectStore:M})}),[S,v,h,n,y,w,e.collectionContextStore,e.groupFormat,e.showPropertyFormats,M]),se=(0,r.useCallback)((async()=>{(await S).handleDragEnd({environment:n,collectionContextStore:e.collectionContextStore,showPropertyFormats:e.showPropertyFormats,schema:b,dragAndFillStore:h,frozenColumnRepositionStore:y,normalizedTableSelection:w.state,allRows:v.state})}),[S,v,h,n,y,w,e.collectionContextStore,e.showPropertyFormats,b]),ce=(0,r.useCallback)((async()=>{(await S).handleDragCancel({dragAndFillStore:h,frozenColumnRepositionStore:y})}),[h,y,S]);return(0,Ge.jsx)(mt().N,{debugName:"TableSelectionOverlay",capture:void 0!==C,onLeft:D,onRight:z,onUp:L,onDown:K,onMoveUp:W,onMoveDown:H,onEnter:N,onTab:G,onUntab:$,onEsc:U,onDelete:q,onBackspace:q,onCut:X,onCopy:Y,onPaste:Q,onCommandEnter:Z,onShiftEnter:J,onCommandShiftEnter:ee,onDuplicate:oe,onKeypress:re,onMoveTo:ie,children:(0,Ge.jsx)(xd().A,{disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll,onDraggableDragStart:le,onDraggableDragMove:ae,onDraggableDragEnd:se,onDraggableDragCancel:ce,render:t=>{var o;return(0,Ge.jsxs)("div",{ref:a,style:{position:"relative",minWidth:e.minWidth,isolation:"auto"},...t,children:[(0,Lp().Gd)(Boolean(e.disableHorizontalEdgeScroll),e.collectionContextStore)&&C&&(A||h.state)?(0,Ge.jsx)($p,{dragAndFillStore:h,frozenIndex:B.state,rowsWrapRect:null===(o=a.current)||void 0===o?void 0:o.getBoundingClientRect(),schema:b,selection:C,selectionStartRectStore:R,showPropertyFormats:e.showPropertyFormats}):null,!I&&u?(0,Ge.jsx)(Up,{selectionStartRectStore:M,selectionEndRectStore:P}):null,O?(0,Ge.jsx)(Dp,{frozenColumnRepositionStore:y,xForFirstCellInRow:E,maxFrozenIndex:V,showPropertyFormats:e.showPropertyFormats,frozenIndex:B.state,frozenSectionWidth:F.state}):void 0,(0,Ge.jsx)(Xp,{...e,allRowsStore:v,selectionStartRectStore:M,normalizedTableSelectionStore:w,frozenSectionWidthStore:F,frozenIndexStore:B})]})}})})}),Fn().A),Xp=r.memo((function(e){const t=(0,x().v3)(),o=(0,r.useMemo)((()=>zp.tableSelectionOverlayActions.load()),[]),n=(0,r.useMemo)((()=>zp.tableSelectionOverlayPropertyActions.load()),[]),i=(0,r.useMemo)((()=>({onPropertyTab:async()=>{(await n).handlePropertyTabOrUntab({type:"tab",environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyUntab:async()=>{(await n).handlePropertyTabOrUntab({type:"untab",environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyEnter:async()=>{(await n).handlePropertyEnter({environment:t,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state})},onPropertyClick:async(o,r,i)=>{(await n).handlePropertyClick({store:o,property:r,schema:i,environment:t,showPropertyFormats:e.showPropertyFormats,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore})},onPropertyEsc:async()=>{(await n).handlePropertyEsc({environment:t,collectionContextStore:e.collectionContextStore,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,showPropertyFormats:e.showPropertyFormats,groupFormat:e.groupFormat,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore,normalizedTableSelection:e.normalizedTableSelectionStore.state,frozenSectionWidth:e.frozenSectionWidthStore.state,frozenIndex:e.frozenIndexStore.state,disableHorizontalEdgeScroll:e.disableHorizontalEdgeScroll})},onPropertyBgClick:async()=>{(await n).handlePropertyBgClick(t,e.blockPropertyValueOverlayStore,e.showPropertyFormats,e.collectionContextStore,e.groupFormat,e.allRowsStore.state,e.selectionStartRectStore,e.normalizedTableSelectionStore.state,e.frozenSectionWidthStore.state,e.frozenIndexStore.state,e.disableHorizontalEdgeScroll)},onPropertyContextMenu:async o=>{(await n).handlePropertyContextMenu({mouseEvent:o,environment:t,collectionContextStore:e.collectionContextStore,allRows:e.allRowsStore.state,normalizedTableSelection:e.normalizedTableSelectionStore.state})},onOpenProperty:async o=>{(await n).handlePropertyOpenProperty({openProperty:o,blockPropertyValueOverlayStore:e.blockPropertyValueOverlayStore,disableHorizontalEdgeScroll:Boolean(e.disableHorizontalEdgeScroll),collectionContextStore:e.collectionContextStore,environment:t})},onSelectableEnter:async n=>{(await o).handleRowSelectableEnter({onEnterArgs:n,environment:t,collectionContextStore:e.collectionContextStore,groupFormat:e.groupFormat,showPropertyFormats:e.showPropertyFormats,allRows:e.allRowsStore.state,selectionStartRectStore:e.selectionStartRectStore})}})),[o,n,t,e.allRowsStore,e.blockPropertyValueOverlayStore,e.collectionContextStore,e.disableHorizontalEdgeScroll,e.frozenIndexStore,e.frozenSectionWidthStore,e.groupFormat,e.normalizedTableSelectionStore,e.selectionStartRectStore,e.showPropertyFormats]);return(0,Ge.jsx)(Ge.Fragment,{children:e.render(i)})}),Fn().A);const Yp=r.memo((function(e){var t;const{blockPropertyValueOverlayStore:n,collectionContextStore:i,disabled:l,format:a,groupFormat:c,isFullScreen:d,isInPeekRenderer:u,minWidth:p,paddingBottom:m,paddingLeft:S,paddingRight:h,query:y,schema:v,showHoverActionsStore:f,store:b,tableStore:w,headerWidth:C}=e,T=(0,x().v3)(),{isPhone:j}=(0,x().Y0)(),A=(0,Le().tz)(),M=(0,I().DP)(),P=(0,r.useContext)(Ea().n),_=(0,Ue().Zp)(),R=(0,r.useRef)(null);(0,r.useEffect)((()=>{const e=()=>{var e;const t=null===(e=R.current)||void 0===e?void 0:e.clientHeight;if(!t)return;const o=t-xn().sH;o>0&&i.collectionSuggestionStore.setContainerHeight(o)};requestAnimationFrame((()=>{e()}));const t=new ResizeObserver((()=>{requestAnimationFrame((()=>{e()}))})),o=R.current;return o&&t.observe(o),()=>{t.disconnect()}}),[i]);const B=Boolean(c),V=(0,r.useMemo)((()=>c?[c]:[]),[c]),F=(0,k().K8)((()=>i.groupsStore.getGroupState(V)),[i.groupsStore,V]),{reducerResult:E,isReady:O,hasPartialResults:D,pageCount:z,shouldShowShimmer:L}=(0,k().K8)((()=>{const e=null==F?void 0:F.reducerResultStore.state,t=void 0!==e,o=(null==e?void 0:e.blockIds.length)||0,n=void 0!==e&&e.blockIds.length>0;return{reducerResult:e,isReady:t,hasPartialResults:n,pageCount:o,shouldShowShimmer:(0,Yr().iv)({collectionContextStore:i,groupsPointer:V,hasPartialResults:n})}}),[i,F,V]),W=0===z&&O&&!L,H=(0,k().K8)((()=>(0,Yr().Kk)({collectionContextStore:i,groupsPointer:V})),[i,V]),N=(0,k().O$)(i.permissionScopesStore),G=(0,Qt().bx)(e.store,e.disabled)&&!N.isSyncedCollection&&N.canEditContent,$=(0,wi().V)(i),{showPropertyFormats:U,titleColumnIndex:q,propertyWidths:X,totalPropertyWidth:Y}=(0,k().K8)((()=>{const e=(0,te().GW)(a,w).filter((e=>e.visible)),t=e.findIndex((({property:e})=>"title"===e)),o=e.map((({width:e})=>e||ys().kp));return{showPropertyFormats:e,titleColumnIndex:t,propertyWidths:o,totalPropertyWidth:e.reduce(((e,t)=>e+(t.width||0)),0)}}),[a,w],{useDeepEqual:!0}),Q=(0,k().K8)((()=>(0,te().Ty)(a,w)),[a,w],{useDeepEqual:!0}),Z=Y+(N.canEditContent?bu().m7:0),J=(0,k().O$)(i.isInHomeWidgetStore),ee=(0,k().O$)(i.isUnlistedViewStore),oe=(0,k().O$)(i.isInlineViewStore),re=ee&&oe,ie=(0,k().K8)((()=>(0,qt().s)(b.id)),[b]),le=(0,k().K8)((()=>ne().fG({collectionContextStore:i,environment:T,intl:A})),[i,T,A]),ae=(0,k().K8)((()=>(0,qn().N)({collectionContextStore:i}).length>0),[i]),se=(0,k().K8)((()=>""!==i.searchQueryStore.state),[i]),ce=Kl(i),ue=W&&(ae||se),{shouldShowAddRowButton:pe,canAddRow:ge}=(0,k().K8)((()=>{const e=O&&!J&&($||G||"collectionTypedView"===i.contextTypeFromStoreState)&&Boolean(i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}));return ue||ce?{shouldShowAddRowButton:!1,canAddRow:e}:{shouldShowAddRowButton:e,canAddRow:e}}),[ue,O,J,G,i,$,ce]),me=!ue&&O&&!L&&0===z&&pe&&!ae&&!B&&!ce,he=d?5:3,ye=Boolean(null===(t=y.aggregations)||void 0===t?void 0:t.length),ve=!ue&&ye&&!ee&&!(null!=_&&_.hideAggregation),fe=(0,k().K8)((()=>ne().XQ({collectionContextStore:i,reducerResult:E,isFullScreen:d})),[i,d,E]),be=(0,k().K8)((()=>{const e=(0,Pt().v2)(V[0],i);return Et().default.state.stores.filter((t=>e.includes(t))).length>0}),[V,i]),xe=(0,k().K8)((()=>{const{isScrolled:e,frozenIndex:t,tryShowHiddenFrozenColumn:o}=i.frozoneStore.state;if(void 0===t)return{isScrolled:!1,frozenIndex:void 0,frozenStyles:{},shouldFreezeMultiSelectColumn:!1,shouldShowStickyMultiSelectColumn:!1,isCollectionViewBlockSelected:!1};const n={...(0,te().wy)({environment:T,collectionContextStore:i,isPhone:j,theme:M}),display:"flex"},r=Boolean(e&&-1===t),l=Boolean(r&&(o||be)),a=i.collectionViewBlockStore(),s=!!a&&(0,fu().d1)(a);return{isScrolled:Boolean(e),frozenIndex:t,frozenStyles:n,shouldFreezeMultiSelectColumn:r,shouldShowStickyMultiSelectColumn:l,isCollectionViewBlockSelected:s}}),[be,i,T,j,M],{useDeepEqual:!0}),we=(0,k().K8)((()=>{const e=i.collectionViewStore();return G&&g().A.isMobile&&!(null!=e&&e.isSyncedCollection())}),[G,i]),Ce=(0,k().O$)(i.defaultPageTemplateStore),Ie=(0,k().K8)((()=>{var e,t;const o=null===(e=i.collectionStore())||void 0===e?void 0:e.id;return(n.state.isOpen&&(null===(t=n.state.collectionContextStore)||void 0===t||null===(t=t.collectionStore())||void 0===t?void 0:t.id))===o}),[n,i]),Te=(0,r.useCallback)((()=>{if(!F)return;const e=i.collectionStore();if(!e||!i.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0}))return;const t=Et().default.state.stores[0];if(!t)return;const o=i.subitemTreeStore.state,r=(0,nr().Qe)(o.children,(e=>e.value.store===t));if(!r)return;const l=r?(0,Pt().kY)(r.map((e=>e.value.store))):"",a=i.subitemExpandedStore.state.get(l);Boolean(null==a?void 0:a.isExpanded)&&et().createAndCommit({userAction:"TableGroupResults.onItemShiftEnter",environment:T,canUndo:!0,perform:o=>{const l=(0,aa().u)({environment:T,collectionContextStore:i,groupsPointer:F.groupsPointer,store:t,before:!1,collectionStore:e,transaction:o,subitemPath:r,subitemInsertDirection:"into",from:"table_group_results_shift_enter"});if(l&&n){const e=()=>{Un().ho({isNewBlock:!0,environment:T,blockPropertyValueOverlayStore:n,store:l,property:"title",surface:"table",collectionContextStore:i})};i.registerCallbackForItemMounted(l,e)}}})}),[n,i,T,F]),je=(0,r.useCallback)((e=>{const t=new(o(838256).aD)({environment:T,entryPointName:"TableGroupResults.handleAddRowClick",from:"table_group_results"}),r=(0,s().f)(i.collectionStore());if(!(0,co().E)(T,r)||!F)return t.fail("invalid_state"),void(0,za().Q)(T,r);i.searchQueryStore.state&&(0,Cr().S)({searchQuery:"",collectionContextStore:i,isFullScreen:d}),et().createAndCommit({userAction:"TableGroupResults.handleAddRowClick",environment:T,canUndo:!0,perform:e=>{const o=(0,Xn().Q)({environment:T,collectionContextStore:i,groupsPointer:c?[c]:[],shouldCoerce:!0,templateStore:Ce,transaction:e,from:{createBlock:"table_group_results"},tracker:t,inMemoryRecordCache:T.defaultRecordCache.inMemoryRecordCache});if(!o)return;const r=o.newStore;if(g().A.isMobile){const e=(0,Se().Ay)({store:r,fullyQualified:!1,pageVisitSource:de().y8.Create});return void(P?P(e):(0,Da().navigate)({environment:T,url:e}))}if(o.coercionSucceeded){const t=()=>{Un().ho({isNewBlock:!0,environment:T,blockPropertyValueOverlayStore:n,store:r,property:"title",surface:"table",collectionContextStore:i})};i.registerCallbackForItemMounted(r,t),e.postSubmitCallbacks.push((async e=>{if(!e)return i.virtualizedModule.waitToScrollToBlock({blockStore:r,groupsPointer:V})}))}else(0,Kr().V)({environment:T,store:r,peekMode:ne().hH(i),resultsStore:F.resultsStore,collectionContextStore:i,pageVisitSource:de().y8.Create});const l=i.currentSubitemFormatStoreForCollectionStore.state;$n().vH(T,{from:l?"table_add_parent_item_bottom":"table_add_item_bottom",type:"page",new_page_id:r.id,creating_block_id:r.id,...(0,Lt().sl)(i)})}})}),[T,F,i,d,c,Ce,P,n,V]),Ae=(0,r.useCallback)((e=>{F&&((0,Ii().k)(e),E&&(0,Vl().H)({collectionContextStore:i,environment:T,incrementLimitArgs:{isFullScreen:d,currentResultCount:E.blockIds.length,groupsPointer:F.groupsPointer,incrementLimitsInRelatedGroups:!1}}),(0,hu().K)(T))}),[i,T,F,d,E]),Me=(0,ne().Oz)(i),Pe=(0,I().IS)((()=>{const{button:e,buttonInner:t,icon:o}=(0,te().BJ)({hideTextWithTransition:me,hideTextWithoutTransition:me&&Ie});return{wrapper:{position:"relative",marginBottom:12},iconStyle:o,viewAllButton:{borderTop:`1px solid ${K().Tj.border.secondaryTranslucent}`,paddingTop:6,paddingBottom:6},loadMoreButton:{...e,borderBottom:`1px solid ${K().Tj.border.secondaryTranslucent}`,whiteSpace:"break-spaces"},loadMoreButtonHovered:{...H?{background:K().Tj.whiteButtonBackground}:{background:K().Tj.tableRowHoveredBackground}},loadMoreButtonInner:{...t,position:"sticky",insetInlineStart:S+8},text:{color:K().Tj.text.tertiary,flexGrow:1,fontSize:g().A.isMobile?gi().hN:gi().Mi},addRowButtonWrapper:{...e,display:"flex",alignItems:"center",gap:4,position:"sticky",insetInlineStart:S,width:"fit-content",paddingInlineStart:2,paddingInlineEnd:2},addRowButton:{display:"inline-flex",height:28,borderRadius:6,paddingInlineStart:6,paddingInlineEnd:8,background:(null==Me?void 0:Me.background)||(u?K().Tj.background.elevated:K().Tj.background.primary)},addRowButtonHovered:{background:K().Tj.buttonHoveredBackground},addRowButtonInner:{...t,fontSize:g().A.isMobile?gi().hN:gi().Mi},linkExistingButton:{paddingInlineStart:6,paddingInlineEnd:8,borderRadius:6},linkExistingButtonInner:{display:"flex",alignItems:"center",gap:8,fontSize:g().A.isMobile?gi().hN:gi().Mi,height:28,color:K().Tj.text.tertiary},aggregationRow:{...(!O||J)&&{opacity:0,pointerEvents:"none",insetInlineStart:0,insetInlineEnd:0}},spinner:{marginTop:1,marginInlineStart:8,marginInlineEnd:8}}}),[me,Ie,H,S,null==Me?void 0:Me.background,u,O,J]),_e=(0,r.useCallback)((e=>(0,Ge.jsx)(Qp,{args:e,store:b,collectionContextStore:i,collectionViewFormat:Q,blockPropertyValueOverlayStore:n,groupFormat:c,groupsPointer:V,propertyFormats:U,schema:v,canDrag:we,disabled:l,titleColumnIndex:q,onShiftEnter:Te,frozoneProps:xe,isInHomeWidget:J,isFullScreen:d,isInEphemeralView:re,paddingLeft:S,paddingRight:h,headerWidth:C,shouldShowShimmer:L})),[b,i,Q,n,c,V,U,v,we,l,q,Te,xe,J,d,re,S,h,C,L]);return F?(0,Ge.jsxs)("div",{ref:R,style:Pe.wrapper,children:[(0,Ge.jsx)(Cp,{store:b,format:Q,groupFormat:c,schema:v,query:y,collectionContextStore:i,isInPeekRenderer:u,minWidth:p,paddingBottom:m,paddingLeft:S,paddingRight:h,blockPropertyValueOverlayStore:n,resultStore:F.reducerResultStore,showPropertyFormats:U,showRightActions:!re&&!ie,showHoverActionsStore:f,allowHidingTitle:!1,tableStore:w,formatKey:"table_properties",disabled:l||!N.canConfigureBlock,disableTopBorder:!0,height:xn().sH,frozoneProps:xe,isInHomeWidget:J,hasMoreReducerResults:Boolean(null==E?void 0:E.hasMore)}),(0,Ge.jsx)(qp,{store:b,collectionContextStore:i,minWidth:p,blockPropertyValueOverlayStore:n,showPropertyFormats:U,disabled:!G,groupFormat:c,tableStore:w,paddingLeft:S,render:_e}),L?(0,Ge.jsx)(o(298577).E,{isFullScreen:d,hasGroups:void 0!==c,propertyWidths:X,hasPartialResults:D,hasSearchQuery:se,frozoneProps:xe}):void 0,me?(0,Ge.jsx)(Au,{collectionContextStore:i,handleAddRowClick:je,numberOfBlankRows:he,propertyFormats:U,isBlockPropertyValueOverlayOpen:Ie,query:y}):void 0,(0,Ge.jsx)("div",{style:{width:Z}}),fe?J?(0,Ge.jsx)(zl().jJ,{groupsPointer:V,store:b,collectionContextStore:i,format:a,isFullScreen:d,incrementLimitsInRelatedGroups:!1,style:Pe.viewAllButton}):(0,Ge.jsx)(ui().Ay,{onMouseDown:Ti().t,onClick:Ae,disabled:H,hoveredStyle:Pe.loadMoreButtonHovered,style:Pe.loadMoreButton,children:(0,Ge.jsxs)("span",{style:Pe.loadMoreButtonInner,children:[(0,Ge.jsx)(ke().I,{icon:o(886358).arrowStraightDownFillSmallIcon,size:"sm",colorVariant:"tertiary"}),(0,Ge.jsx)("div",{style:Pe.text,children:(0,Ge.jsx)(Le().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),H?(0,Ge.jsx)("div",{style:Pe.spinner,children:(0,Ge.jsx)(Xi().A,{size:"sm"})}):G&&(0,Ge.jsx)(vu().w,{collectionContextStore:i,format:a})]})}):void 0,pe&&!me?(0,Ge.jsxs)("div",{style:Pe.addRowButtonWrapper,children:[(0,Ge.jsx)(ui().Ay,{onClick:je,onMouseDown:Ti().t,style:Pe.addRowButton,hoveredStyle:Pe.addRowButtonHovered,className:fn().$0P,children:(0,Ge.jsxs)("span",{style:Pe.addRowButtonInner,children:[(0,Ge.jsx)(ke().I,{icon:Ho().plusSmallIcon,style:Pe.iconStyle}),(0,Ge.jsx)(Oa().w,{collectionContextStore:i})]})}),le?(0,Ge.jsx)(kr().O,{collectionContextStore:i,groupFormat:c,renderLinkButton:e=>(0,Ge.jsx)(ui().Ay,{style:Pe.linkExistingButton,...e,children:(0,Ge.jsxs)("span",{style:Pe.linkExistingButtonInner,children:[(0,Ge.jsx)(ke().I,{icon:zn().arrowDiagonalUpRightSmallIcon,colorVariant:"tertiary",size:"sm"}),(0,Ge.jsx)(Le().sA,{id:"database.findOrCreatePage",defaultMessage:"Link existing"})]})})}):void 0]}):void 0,ve?(0,Ge.jsx)(Tu,{pageCount:z,collectionContextStore:i,disabled:l||!ge,groupFormat:c,isFullScreen:d,isInPeekRenderer:u,paddingLeft:S,paddingRight:h,query:y,schema:v,showPropertyFormats:U,showRightActionsSpacer:N.canConfigureCollection,style:Pe.aggregationRow}):void 0]}):null})),Qp=r.memo((function(e){const{args:t,blockPropertyValueOverlayStore:o,canDrag:n,collectionContextStore:i,collectionViewFormat:l,disabled:a,frozoneProps:s,groupFormat:c,groupsPointer:d,isFullScreen:u,isInHomeWidget:p,onShiftEnter:g,propertyFormats:m,schema:S,store:h,titleColumnIndex:y,isInEphemeralView:v,paddingLeft:f,paddingRight:b,headerWidth:w,shouldShowShimmer:C}=e,j=(0,x().v3)(),A=(0,k().K8)((()=>i.getIsInDashboardBuildMode()),[i]),M=(0,k().K8)((()=>Boolean(i.normalizedFormatStore.state.hide_table_vertical_lines)),[i.normalizedFormatStore]),P=(0,k().K8)((()=>ne().f5({collectionContextStore:i})),[i]),_=(0,k().K8)((()=>(0,eo().S)(h)),[h]),R=(0,se().y)(),B=(0,I().IS)((()=>({wrapper:{position:"relative"},itemSelectableHalo:{borderRadius:3,zIndex:86,...R&&{borderRadius:0,inset:0,bottom:1}},itemSelectableStyle:{display:"flex",height:"calc(100% + 2px)"}})),[R]),V=(0,r.useCallback)((()=>B.itemSelectableStyle),[B]),F=(0,r.useCallback)((e=>{const{store:t,parentStore:n,subitemPath:r,indentLevel:l}=e;if(n)return(0,Ge.jsx)($d,{store:t,collectionStore:n,subitemPath:r,indentLevel:l,collectionContextStore:i,disabled:a,groupsPointer:d,paddingLeft:f,onSubitemCreate:e=>{if(!o)return;i.registerCallbackForItemMounted(e,(()=>{Un().ho({isNewBlock:!0,environment:j,blockPropertyValueOverlayStore:o,store:e,property:"title",surface:"table",collectionContextStore:i})}))}})}),[o,i,a,j,d,f]),E=(0,k().K8)((()=>{const e=i.collectionViewBlockStore();return!(!e||i.isFullScreenStore.state)&&(0,fu().d1)(e)}),[i]),O=(0,k().K8)((()=>(0,Pt().v2)(c,i)),[c,i]),D=(0,k().K8)((()=>{const e=xu().A.state;if(e.isActive)return(0,te().yR)(e.selection,m.length,O.length)}),[O.length,m.length],{useDeepEqual:!0}),z=null==s?void 0:s.frozenIndex,L=(0,k().K8)((()=>ne().qi(z)),[z]),[K,W]=(0,r.useMemo)((()=>void 0!==z?[m.slice(0,z+1),m.slice(z+1)]:[[],m]),[z,m]),H=(0,k().K8)((()=>{var e;return Boolean(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getFormatStore().getKeyStore("table_wrap").getValue())}),[i]),N=(0,k().K8)((()=>{var e;return Boolean("timeline"===(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())||!H&&!m.some((e=>e.wrap)))}),[i,m,H]),G=(0,k().K8)((()=>{const e=i.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[i.permissionScopesStore]),$=(0,k().K8)((()=>{var e;return!p&&"timeline"!==(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())}),[i,p]),U=(0,pu().DV)(),q=(0,r.useMemo)((()=>({schema:S,collectionContextStore:i,propertyFormats:m,onPropertyTab:t.onPropertyTab,onPropertyUntab:t.onPropertyUntab,onPropertyEnter:t.onPropertyEnter,onPropertyClick:t.onPropertyClick,onPropertyEsc:t.onPropertyEsc,onPropertyBgClick:t.onPropertyBgClick,onPropertyContextMenu:t.onPropertyContextMenu,onOpenProperty:t.onOpenProperty,disabled:a,blockPropertyValueOverlayStore:o,disableCellBorderRight:M,disableHorizontalEdgeScroll:!1,disableLastCellBorderRight:_,disableTableWrap:!1,onShiftEnter:g,titleColumnIndex:y,groupFormat:c,frozoneProps:s,shouldShowMultiSelectCheckbox:P,isInHomeWidget:p,isCollectionViewBlockSelected:E,allRows:O,isInEphemeralView:v,normalizedTableSelection:D,unfrozenIndexAddendum:L,frozenPropertyFormats:K,unfrozenPropertyFormats:W,tableWrap:H,shouldSetCellHeight:N,isNonEditable:G,shouldShowRightActionSpacer:$,hasColumnVirtualizer:U})),[t.onOpenProperty,t.onPropertyBgClick,t.onPropertyClick,t.onPropertyContextMenu,t.onPropertyEnter,t.onPropertyEsc,t.onPropertyTab,t.onPropertyUntab,o,i,a,M,g,m,S,y,c,s,P,_,p,E,O,v,D,L,K,W,H,N,G,$,U]),X=u,Y=yu(i),Q=(0,T().fJ)(Su().fy,{disabled:!Y}),Z=(0,k().K8)((()=>i.collectionSuggestionStore.getActiveSuggestions()),[i]),J=(0,r.useMemo)((()=>"resolved"!==Q.status?[]:Z.map((e=>Q.value.calculateSuggestionWidth(e.name)))),[Z,Q]),ee=(0,r.useMemo)((()=>m.reduce(((e,t)=>e+(t.width||ys().kp)),0)),[m]),oe=(0,k().K8)((()=>i.userAddedPropertyStore.state),[i]),re=(0,k().K8)((()=>{var e;const t=i.userAddedPropertyStore.state,o=i.collectionSuggestionStore,n=(null===(e=i.collectionStore())||void 0===e?void 0:e.getSchema())||{},r=Object.values(n).some((e=>(null==e?void 0:e.type)&&"title"!==(null==e?void 0:e.type)));return!(!Y||t||!o.state.isEnabled||!o.state.isLoading||r)}),[i,Y]),ie=(0,k().K8)((()=>Y&&i.collectionSuggestionStore.state.isEnabled&&!oe&&Z.length>0),[Y,i,oe,Z]),le=(0,r.useMemo)((()=>{const e=[180,180,180];return"resolved"===Q.status&&J.length>0?J.slice(0,3):e.slice(0,3)}),[J,Q]);return(0,Ge.jsxs)("div",{style:B.wrapper,children:[ie?(0,Ge.jsx)(Su().xY,{collectionContextStore:i,suggestions:Z,widths:J,titleColumnWidth:ee,paddingRight:b,renderLoading:()=>null}):null,re?(0,Ge.jsx)(Su().xY,{collectionContextStore:i,suggestions:[],widths:le,titleColumnWidth:ee,paddingRight:b,isLoading:!0,shimmerColumnCount:3}):null,(0,Ge.jsx)(fa,{collectionContextStore:i,groupsPointer:d,format:l,canDrag:n,itemProps:q,canDrop:!0,renderItem:Op,disabled:a,direction:ya.Vertical,getItemSelectableStyle:V,itemSelectableHaloStyle:B.itemSelectableHalo,shouldShowHoverMenu:!A,analyticsName:"table",emptyDroppableSize:0,touchDragOnly:!0,onSelectableEnter:t.onSelectableEnter,blockPropertyValueOverlayStore:o,titleColumnIndex:y,nestedCreateSubitemButton:F,virtualizeResults:X,paddingLeft:f,paddingRight:b,headerWidth:w,shouldShowShimmer:C})]})}),Fn().A),Zp=r.memo((function(e){const{store:t,paddingBottom:o,paddingLeft:n,paddingRight:i,collectionContextStore:l,format:a,schema:s,disabled:c,isFullScreen:d,isRootChild:u,isInPeekRenderer:p,isPreviewing:g,query:m,showHoverActionsStore:S,blockPropertyValueOverlayStore:h,minWidth:y,placementStore:v,headerWidth:f}=e,b=(0,x().v3)(),w=(0,k().uB)(void 0,cu),C=(0,r.useRef)(null),T=a.collection_group_by,j=d&&!T,A=(0,k().K8)((()=>(0,te().GW)(a,w)),[a,w]),M=(0,k().K8)((()=>(0,ne().mM)(l,d)),[l,d]),P=(0,k().O$)(l.isInHomeWidgetStore),_=(0,k().K8)((()=>Boolean(l.viewsModuleContextStore.getViewModuleType())),[l]),R=(0,k().K8)((()=>{const e=l.settingsStore.state.open,t="sidebar"===v.state;return e&&t}),[l.settingsStore,v]),B=r.useCallback((e=>{const t=l.isLoadingStore.state,o=l.groupsStore.getGroupState([]),n=null==o?void 0:o.reducerResultStore.state;e<Mo().B.incrementScrollOffset&&n&&!t&&n.hasMore&&(l.infiniteScrollLongTaskObserver.observe(),(0,Vl().H)({collectionContextStore:l,environment:b,incrementLimitArgs:{isFullScreen:d,currentResultCount:n.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}}))}),[l,b,d]),V=(0,I().IS)((()=>({selectable:{position:"relative",marginInlineEnd:R?bn().vE:void 0},container:{position:"relative",float:"inline-start",minWidth:"100%",WebkitUserSelect:"none",fontVariantNumeric:"lining-nums tabular-nums",paddingBottom:o,paddingInlineStart:n,paddingInlineEnd:i,marginTop:4}})),[o,n,i,R]),F=(0,Ue().Zp)();return(0,Ol().A)((e=>{const r=(0,Ge.jsx)(oo().Ay,{location:"collectionTableView",store:t,shouldShowHalo:!d&&!P&&!g,canSelect:!d&&!_,disablePointerEvents:null==F?void 0:F.disableContentPointerEvents,analyticsName:"table",style:V.selectable,...e,children:T?(0,Ge.jsx)(Jp,{collectionContextStore:l,store:t,format:a,schema:s,query:m,isFullScreen:d,isRootChild:u,isInPeekRenderer:p,paddingLeft:n,paddingBottom:o,paddingRight:i,minWidth:y,tableStore:w,showHoverActionsStore:S,blockPropertyValueOverlayStore:h,disabled:c,headerWidth:f}):(0,Ge.jsx)(tg,{collectionContextStore:l,store:t,format:a,schema:s,query:m,isFullScreen:d,isInPeekRenderer:p,paddingLeft:n,paddingRight:i,headerWidth:f,paddingBottom:o,minWidth:y,tableStore:w,showHoverActionsStore:S,blockPropertyValueOverlayStore:h,disabled:c,groupFormat:void 0})});return(0,Ge.jsx)("div",{className:fn().EOV,style:V.container,ref:C,children:(0,Ge.jsxs)(ha.Provider,{value:C,children:[T?(0,Ge.jsx)(mu,{collectionContextStore:l,tableProperties:A,paddingLeft:n,paddingRight:i,children:r}):(0,Ge.jsx)(fi().b,{nodeRef:C,children:(0,Ge.jsx)(mu,{collectionContextStore:l,tableProperties:A,paddingLeft:n,paddingRight:i,children:r})}),M||j?void 0:(0,Ge.jsx)(Bl().A,{onChange:e=>B(e)})]})})}))})),Jp=r.memo((function({collectionContextStore:e,store:t,format:o,schema:n,query:i,disabled:l,isFullScreen:a,paddingLeft:s,paddingRight:c,isRootChild:d,isInPeekRenderer:u,showHoverActionsStore:p,blockPropertyValueOverlayStore:m,minWidth:S,paddingBottom:h,tableStore:y,headerWidth:v}){const f=(0,x().v3)(),b=(0,r.useCallback)((()=>({})),[]),w=(0,r.useCallback)(((t,o)=>{if(g().A.isMobile)(0,El().u)({environment:f,store:t,pageVisitSource:de().y8.Create});else{const{groupFormat:n}=o,r=n?[n]:[],i=e.groupsStore.getGroupState(r),l="collectionTypedView"===e.contextTypeFromStoreState;(0,Kr().V)({environment:f,store:t,peekMode:(0,ne().hH)(e),showMoveTo:l,resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:e,pageVisitSource:de().y8.Create})}}),[e,f]);return(0,Ge.jsx)(Qs,{reducerId:Bn().Tt,store:t,collectionContextStore:e,disabled:l,isFullScreen:a,isRootChild:d,paddingLeft:s,paddingRight:c,stickyLeft:!0,headerWidth:v,renderGroupResults:r=>(0,Ge.jsx)(tg,{store:t,format:o,schema:n,query:i,collectionContextStore:e,showHoverActionsStore:p,isFullScreen:a,isInPeekRenderer:u,disabled:l,blockPropertyValueOverlayStore:m,minWidth:S,paddingBottom:h,paddingLeft:s,paddingRight:c,headerWidth:v,tableStore:y,groupFormat:r}),getGroupStyle:b,renderHeader:e=>(0,Ge.jsx)(eg,{args:e,isInPeekRenderer:u}),onGroupHeaderAddItem:(e,t,o)=>{w(e,o)}})})),eg=r.memo((function({args:e,isInPeekRenderer:t}){const{collectionContextStore:o}=e,n=(0,k().O$)(o.isInHomeWidgetStore),r=(0,I().IS)((()=>({stickyStyle:{boxShadow:`0 -1px 0 ${t?K().Tj.background.elevated:K().Tj.background.primary}`}})),[t]);return(0,Ge.jsx)(Sl,{...e,height:n?Fl().ag:xn().n1,paddingTop:0,toggleClosedMarginBottom:8,stickyStyle:r.stickyStyle})})),tg=r.memo((function({groupFormat:e,store:t,format:o,schema:n,query:r,collectionContextStore:i,showHoverActionsStore:l,isFullScreen:a,isInPeekRenderer:s,disabled:c,blockPropertyValueOverlayStore:d,minWidth:u,paddingBottom:p,paddingLeft:g,paddingRight:m,headerWidth:S,tableStore:h}){const y=(0,k().uB)(h,cu);return(0,k().K8)((()=>i.groupsStore.getGroupState(e?[e]:[])),[i,e])?(0,Ge.jsx)(Yp,{tableStore:y,groupFormat:e,store:t,format:o,schema:n,query:r,collectionContextStore:i,showHoverActionsStore:l,isFullScreen:a,isInPeekRenderer:s,disabled:c,blockPropertyValueOverlayStore:d,minWidth:u,paddingBottom:p,paddingLeft:g,paddingRight:m,headerWidth:S}):null}));var og=()=>o(317406),ng=()=>o(839106);class rg extends P().Store{constructor(){super("groupsReducerResultStore")}getInitialState(){}}function ig({collectionContextStore:e,isFullScreen:t,paddingBottom:o,createDateProperty:n}){const r=(0,k().O$)(e.canConfigureBlockStore),i=(0,I().IS)((()=>({container:{paddingBottom:t?void 0:o}})),[t,o]);return(0,Ge.jsx)(ac().Ay,{style:i.container,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"No date property",id:"database.timelineView.missingDatePropertyTitle"}),description:r?(0,Ge.jsx)(Le().sA,{defaultMessage:"<opensettingslink>Add a date property</opensettingslink> to your database in order to display a Timeline view.",id:"database.timelineView.missingDateProperty",values:{opensettingslink:e=>(0,Ge.jsx)(ac().P6,{onClick:()=>{n()},children:e})}}):(0,Ge.jsx)(Le().sA,{defaultMessage:"Timeline views require a date property in order to display.",id:"database.timelineView.missingDatePropertyNoPermissions"})})}var lg=()=>o(396182);function ag({timelineState:e}){const t=(0,lg().I)(),o=(0,r.useCallback)((()=>{0===(new Date).getSeconds()&&t("TimelineBackground","TimelineBackground/handleSeconds")}),[t]);(0,r.useEffect)((()=>{const e=setInterval(o,1e3);return()=>clearInterval(e)}),[o]);const n=(0,k().O$)(e.zoomLevelStore),{startTimestamp:i,endTimestamp:l}=(0,k().O$)(e.currentRangeStore);return(0,Ge.jsxs)("div",{style:{position:"absolute",width:"100%",height:"100%",overflow:"hidden",cursor:"default"},children:[(0,Ge.jsx)(pg,{zoomLevel:n,startTimestamp:i,endTimestamp:l}),(0,Ge.jsx)(gg,{zoomLevel:n,startTimestamp:i,endTimestamp:l}),(0,Ge.jsx)(ug,{zoomLevel:n,startTimestamp:i})]})}const sg=r.memo(ag,Fn().A),cg=r.memo((function({start:e,zoomLevel:t,startTimestamp:o}){const n=(0,I().IS)((()=>{const n=e.plus({day:2}).startOf("day"),r=(0,wn().w0)(t,e.valueOf()-o);return{weekendIndicator:{position:"absolute",insetInlineStart:r,width:(0,wn().w0)(t,n.valueOf()-o)-r,height:"100%",background:K().Tj.timelineDarkerBackground}}}),[e,o,t]);return(0,Ge.jsx)("div",{style:n.weekendIndicator},e.valueOf())}),Fn().A),dg=r.memo((function({time:e,zoomLevel:t,startTimestamp:o}){const n=(0,I().IS)((()=>({verticalDivider:{position:"absolute",insetInlineStart:(0,wn().w0)(t,e-o),height:"100%",borderInlineEnd:`1px solid ${K().Tj.border.secondaryTranslucent}`}})),[o,e,t]);return(0,Ge.jsx)("div",{style:n.verticalDivider},e)}),Fn().A),ug=r.memo((function({zoomLevel:e,startTimestamp:t}){const o=(0,I().IS)((()=>{const o=n().DateTime.now().startOf("minute");return{nowVerticalDivider:{position:"absolute",insetInlineStart:Math.floor((0,wn().w0)(e,o.valueOf()-t)),height:"100%",borderInlineEnd:`1px solid ${K().Tj.red.border.accentPrimary}`}}}),[t,e]);return(0,Ge.jsx)("div",{style:o.nowVerticalDivider})}),Fn().A),pg=r.memo((function({zoomLevel:e,startTimestamp:t,endTimestamp:o}){const{showWeekendIndicators:r}=wn().eM[e];if(!r)return null;let i=(0,wn().DY)(n().DateTime.fromMillis(t),"day");const l=[];for(;i.valueOf()<o;)6===i.weekday&&l.push((0,Ge.jsx)(cg,{start:i,zoomLevel:e,startTimestamp:t},i.valueOf())),i=(0,wn().Vz)(i,"day");return(0,Ge.jsx)(Ge.Fragment,{children:l})}),Fn().A),gg=r.memo((function({zoomLevel:e,startTimestamp:t,endTimestamp:o}){const{verticalDividerUnit:r}=wn().eM[e];if(!r)return null;const i=[];let l=(0,wn().DY)(n().DateTime.fromMillis(t),r);for(;l.valueOf()<o;)i.push((0,Ge.jsx)(dg,{time:l.valueOf(),zoomLevel:e,startTimestamp:t},l.valueOf())),l=(0,wn().Vz)(l,r);return(0,Ge.jsx)(Ge.Fragment,{children:i})}),Fn().A);var mg=()=>o(324254);const Sg=r.memo((function(e){const{zoomLevel:t,onChange:o}=e,n=(0,r.useCallback)((e=>(0,Ge.jsx)(Fr().p,{size:"sm",colorPalette:"gray",iconTrailing:mg().arrowChevronSingleDownSmallIcon,...e,children:(0,Ge.jsx)(hg,{zoomLevel:t})})),[t]),i=(0,r.useCallback)((e=>(0,Ge.jsx)(yg,{parent:e,zoomLevel:t,onChange:o})),[t,o]);return(0,Ge.jsx)(Ce().A,{popupType:g().A.isMobile?we().nl.SlideUp:we().nl.Popup,originGap:8,renderOrigin:n,render:i})})),hg=r.memo((function(e){const{zoomLevel:t}=e;return"hours"===t?(0,Ge.jsx)(Le().sA,{id:"database.timelineView.zoomLevel.hours",defaultMessage:"Hours"}):"day"===t?(0,Ge.jsx)(Le().sA,{id:"database.timelineView.zoomLevel.day",defaultMessage:"Day"}):"week"===t?(0,Ge.jsx)(Le().sA,{id:"database.timelineView.zoomLevel.week",defaultMessage:"Week"}):"bi_week"===t?(0,Ge.jsx)(Le().sA,{id:"database.timelineView.zoomLevel.biWeek",defaultMessage:"Bi-week"}):"month"===t?(0,Ge.jsx)(Le().sA,{id:"database.timelineView.zoomLevel.month",defaultMessage:"Month"}):"quarter"===t?(0,Ge.jsx)(Le().sA,{id:"database.timelineView.zoomLevel.quarter",defaultMessage:"Quarter"}):"year"===t?(0,Ge.jsx)(Le().sA,{id:"database.timelineView.zoomLevel.year",defaultMessage:"Year"}):"5_years"===t?(0,Ge.jsx)(Le().sA,{id:"database.timelineView.zoomLevel.years",defaultMessage:"5 Years"}):void(0,H().HB)(t)})),yg=r.memo((function(e){const{zoomLevel:t,onChange:o,parent:n}=e,i=(0,r.useMemo)((()=>[{key:"calendar by section",render:e=>(0,Ge.jsx)(Pe().A,{...e}),items:ys().Ui.map((e=>{const t={key:e,render:t=>(0,Ge.jsx)(Ae().A,{...t,title:(0,Ge.jsx)(hg,{zoomLevel:e})}),action:()=>{o(e),n.close()}};return t}))}]),[o,n]),l=(0,r.useCallback)((e=>{const o=g().A.isMobile?{menuType:Te().gu.Modal,title:(0,Ge.jsx)(Le().sA,{defaultMessage:"Select a zoom level",id:"database.timelineView.mobileTimelineZoomPicker.title"}),right:(0,Ge.jsx)(Le().sA,{...xe().W.done}),onClickRight:n.close,...e}:{menuType:Te().gu.Popup,width:180,...e};return(0,Ge.jsx)(je().A,{...o,children:(0,Ge.jsx)(Me().A,{type:Me().O.Vertical,sections:i,initialFocus:ys().Ui.indexOf(t)})})}),[n.close,i,t]);return(0,Ge.jsx)(c().A,{capture:!0,allowEsc:!0,render:l})})),vg=6,fg=wn().tp+wn().lH,bg=r.memo((function({timelineState:e,scrollerLeftOffset:t,paddingLeft:i,showTable:l,isFullScreen:a,isRootChild:s,isReady:c,collectionContextStore:d,isInPeekRenderer:u,format:p,paddingRight:m}){const S=(0,x().v3)(),h=(0,k().K8)((()=>{const o=e.zoomLevelStore.state,{primaryDisplayUnit:r,secondaryDisplayUnit:s}=wn().eM[o],c=e.scrollLeftStore.state,{startTimestamp:d}=e.currentRangeStore.state;if(void 0!==c){const e=d+(0,wn().C1)(o,c+t+(!l&&a?i:0));return(0,wn().DY)(n().DateTime.fromMillis(e),r).startOf(s).valueOf()}}),[e,t,i,l,a]),y=(0,x().Y0)(),v=(0,k().O$)(e.zoomLevelStore),f=(0,k().K8)((()=>e.outerSizeObserver.rect.state.width),[e]),{secondaryDisplayUnit:b}=wn().eM[v],w=(0,k().K8)((()=>(0,wn().DG)({environment:S,isFullScreen:a,isRootChild:s})),[S,a,s]),C=(0,k().O$)(d.canConfigureBlockStore),T=!l&&w&&C,j=(0,ne().Oz)(d),A=(null==j?void 0:j.background)||(u?K().Tj.background.elevated:K().Tj.background.primary),M=u?K().Tj.cardContentBackgroundTransparent:K().Tj.contentBackgroundTransparent,P=(0,I().IS)((()=>({secondaryDisplayUnit:{position:"absolute",top:1,insetInlineStart:"calc(-1 * var(--sticky-horizontal-offset, 0px))",paddingInlineStart:a&&!l?t+i:t,display:"flex",alignItems:"center",height:fg,paddingTop:vg+(g().A.isMobile?2:0),background:A,fontSize:14,fontWeight:pe().Wy.medium},outerContainer:{position:"sticky",insetInlineStart:0,width:f,zIndex:2,height:0},controlBarRight:{position:"absolute",top:1,insetInlineEnd:"var(--sticky-horizontal-offset, 0px)",paddingInlineEnd:m,display:"flex",alignItems:"center",height:fg,paddingTop:vg+1,background:A},hideTableIcon:{paddingInlineStart:4,paddingInlineEnd:4,marginInlineStart:2,marginInlineEnd:4,marginTop:y.isIOS?0:1,height:22,fill:K().Tj.icon.tertiary}})),[A,y.isIOS,a,f,i,m,t,l]),_=(0,r.useRef)(null),R=(0,r.useCallback)((t=>{og().k3({timelineState:e,environment:S,zoomLevel:t,centerTimestamp:(0,wn().o$)(e)}),(0,ng().z2)(S,(0,ng().ZR)({environment:S,collectionContextStore:d,timelineState:e,isFullScreen:a,isRootChild:s}))}),[e,S,d,a,s]);return(0,Ge.jsx)(Ci().g,{stickyAttachPoint:"ceiling",nodeRef:_,noPlaceholder:!0,children:(0,Ge.jsxs)("div",{style:P.outerContainer,ref:_,children:[h?(0,Ge.jsxs)("div",{style:P.secondaryDisplayUnit,children:[T?(0,Ge.jsx)(Wo().m,{render:t=>(0,Ge.jsx)(Fr().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=n.collectionViewStore();if(!l)return;et().createAndCommit({userAction:"TimelineControlBar.handleShowTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,wn().iH)(t,!0);We().zA({stores:[l],update:o,transaction:e})}}),(0,ng().VD)(e,{...(0,ng().ZR)({environment:e,collectionContextStore:n,timelineState:o,isFullScreen:r,isRootChild:i}),show:!0})}(S,p,e,d,a,s),style:P.hideTableIcon,...t,children:(0,Ge.jsx)(ke().I,{icon:o(216128).R,size:"sm",colorVariant:"secondary"})}),renderTooltip:()=>(0,Ge.jsx)(Le().sA,{id:"database.timelineView.controlHeader.showTableButton.title",defaultMessage:"Show table"})}):void 0,(0,Ge.jsx)("span",{style:{paddingInlineStart:T||y.isPhone?0:a||l?16:2},children:(0,wn().Kx)(h,b)}),c||l?void 0:(0,Ge.jsx)(xg,{}),(0,Ge.jsx)("div",{style:{width:30,marginInlineEnd:-30,height:"100%",backgroundImage:`linear-gradient(calc(var(--direction) * 90deg), ${A} 20%, ${M} 100%)`}})]}):void 0,(0,Ge.jsxs)("div",{style:P.controlBarRight,children:[(0,Ge.jsx)("div",{style:{width:30,marginInlineStart:-30,height:"100%",backgroundImage:`linear-gradient(calc(var(--direction) * -90deg), ${A} 20%, ${M} 100%)`}}),(0,Ge.jsxs)(o(396896).fI,{gap:8,children:[(0,Ge.jsx)(Ld().A,{collectionContextStore:d,entrypoint:"timeline_view"}),(0,Ge.jsx)(Sg,{zoomLevel:v,onChange:R})]}),(0,Ge.jsx)(Fr().p,{size:"sm",colorPalette:"gray",onClick:()=>function(e,t,o,n,r,i,l){const a=t.zoomLevelStore.state,s=t.outerSizeObserver.rect.state.width,c=(0,wn().Ho)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(s-c)/2,u=(0,wn().o$)(t),p=u-(0,wn().C1)(a,d);og().k3({timelineState:t,environment:e,zoomLevel:a,centerTimestamp:p}),(0,ng().i6)(e,{...(0,ng().ZR)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"left"})}(S,e,i,p,a,s,d),style:{marginInlineStart:4,paddingInlineStart:4,paddingInlineEnd:4},children:(0,Ge.jsx)(ke().I,{icon:o(481975).s,size:"sm",colorVariant:"secondary"})}),(0,Ge.jsx)(Fr().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i,l){const a=t.zoomLevelStore.state,s=(0,wn().uW)({timestamp:Date.now(),environment:e,timelineState:t,paddingLeft:o,format:n});og().k3({timelineState:t,environment:e,zoomLevel:a,centerTimestamp:s}),(0,ng().AP)(e,{...(0,ng().ZR)({environment:e,collectionContextStore:r,timelineState:t,isFullScreen:i,isRootChild:l})})}(S,e,i,p,d,a,s),children:(0,Ge.jsx)(Le().sA,{id:"database.timelineView.controlHeader.todayButton.title",defaultMessage:"Today"})}),(0,Ge.jsx)(Fr().p,{size:"sm",colorPalette:"gray",onClick:()=>function(e,t,o,n,r,i,l){const a=t.zoomLevelStore.state,s=t.outerSizeObserver.rect.state.width,c=(0,wn().Ho)({environment:e,paddingLeft:o,format:n,isFullScreen:r,isRootChild:i}),d=(s-c)/2,u=(0,wn().o$)(t),p=u+(0,wn().C1)(a,d);og().k3({timelineState:t,environment:e,zoomLevel:a,centerTimestamp:p}),(0,ng().i6)(e,{...(0,ng().ZR)({environment:e,collectionContextStore:l,timelineState:t,isFullScreen:r,isRootChild:i}),type:"right"})}(S,e,i,p,a,s,d),style:{paddingInlineStart:4,paddingInlineEnd:4},children:(0,Ge.jsx)(ke().I,{icon:o(906380).arrowChevronSingleRightSmallIcon,size:"sm",colorVariant:"secondary"})})]})]})})}));function xg(){return(0,Ml().A)(!0,400,0)?(0,Ge.jsx)(Xi().A,{style:{marginInlineStart:8,marginTop:1}}):null}class wg extends P().Store{getInitialState(){return new Set}}class Cg extends(()=>o(959180))().A{constructor(...e){super(...e),this.itemsRefStore=new wg}findTimelineItems(e){return this.getMembersByDOMOrder({filter:t=>e.uiContains(t.props.store)})}register(e){const t=super.register(e);return this.itemsRefStore.state.has(e)||this.itemsRefStore.setState(new Set(this.itemsRefStore.state).add(e)),t}unregister(e){if(super.unregister(e),this.itemsRefStore.state.has(e)){const t=new Set(this.itemsRefStore.state);t.delete(e),this.itemsRefStore.setState(t)}}getItemsRefStore(){return this.itemsRefStore}}const kg=new Cg;(0,o(852832).exposeDebugValue)("GlobalTimelineItemRegistry",kg);var Ig=()=>o(126912),Tg=()=>o(323550);const jg=xn().wc,Ag=jg/2,Mg=12,Pg={position:"absolute",insetInlineStart:0,top:0,zIndex:86,width:"100%",height:"100%",pointerEvents:"none"};function _g(e){const{startItemRect:t,value:o}=e;if(!t||!o)return o;const n=(0,uu().A1)(),r=n?t.right-Mg:t.left+Mg;return n?o.right>=r&&(o.left>t.right?o.right=o.left:(o.right=r,o.top=o.top-Ag)):o.left<=r&&(o.right<t.left?o.left=o.right:(o.left=r,o.top=o.top-Ag)),o}function Rg(e){const{startItem:t,endItem:o,endRelationPointer:n,timelineState:i,disabled:l,isFullScreen:a,isRootChild:s,relationType:c,isUserDrawnTemp:d,isNewSubitemPlaceholder:u,renderEmitter:p}=e,g=(0,_t().ET)(),m=(0,x().v3)(),S=(0,lg().I)(),[h,y]=(0,r.useState)(!1),[v,f]=(0,r.useState)(null),[w,C]=(0,r.useState)(null),T=(0,r.useCallback)((e=>{f(e.state)}),[]),j=(0,r.useCallback)((e=>{C(e.state)}),[]),A=(0,r.useCallback)((()=>{b().default.afterNextFlush((()=>{S("CollectionTimelineRelationArrow","CollectionTimelineRelationArrow/resetTopPositions")}))}),[S]);(0,r.useEffect)((()=>(f(t.stores.nodeStore.state),C(o?o.stores.nodeStore.state:null),t.stores.nodeStore.addListener(T),null==o||o.stores.nodeStore.addListener(j),null==p||p.addListener(A),g.filtersBarOpenStore.addListener(A),()=>{t.stores.nodeStore.removeListener(T),null==o||o.stores.nodeStore.removeListener(j),null==p||p.removeListener(A),g.filtersBarOpenStore.removeListener(A)})),[t,o,p,T,j,A,g.filtersBarOpenStore]);const M=(0,k().K8)((()=>En().Ay.state.isDragging&&En().Ay.state.draggedStores.includes(t.props.store)),[t]),P=(0,k().K8)((()=>o&&En().Ay.state.isDragging&&En().Ay.state.draggedStores.includes(o.props.store)),[o]),_=(0,k().K8)((()=>{const e=En().Ay.state;return e.isDragging?e.currentY-e.startY:0}),[]),R=(0,k().K8)((()=>{const e=i.zoomLevelStore.state,{startTimestamp:t,endTimestamp:o}=i.currentRangeStore.state;return(0,wn().w0)(e,o-t)}),[i]),B=v&&v.getBoundingClientRect().y+(M?_:0),V=(0,k().K8)((()=>{const e=t.itemPositionStore.state;if(!B||!e)return;const o=(0,uu().A1)();let n,r;return o?(n=R-e.right,r=R-e.left):(n=e.left,r=e.right),"subitem"===c&&(o?n=r-Mg:r=n+Mg),{left:n,right:r,top:"subitem"===c?B+Ag:B}}),[c,R,t.itemPositionStore,B]),F=w&&w.getBoundingClientRect().y+(P?_:0),E=(0,k().K8)((()=>{const e=null==o?void 0:o.itemPositionStore.state;if(!F||!e)return;const n=(0,uu().A1)();let r,i;n?(r=R-e.right,i=R-e.left):(r=e.left,i=e.right);const l={left:r,right:i,top:F};if("subitem"===c){const e=t.itemPositionStore.state;return _g({startItemRect:e?n?{left:R-e.right,right:R-e.left}:e:void 0,value:l})}return l}),[o,F,c,R,t.itemPositionStore]),O=(0,k().O$)(t.dateValueStore),D=(0,k().K8)((()=>null==o?void 0:o.dateValueStore.state),[o]),z=(0,k().K8)((()=>void 0!==i.dragStateStore.state),[i]),L=(0,k().K8)((()=>void 0!==i.drawStateStore.state),[i]),W=(0,k().O$)(i.hoveredItemStore),H=h&&!z&&!L,N=(0,r.useCallback)((()=>{n&&!l&&og().cd({dependency:{store:t.props.store,relationPointer:n},collectionContextStore:g,environment:m,timelineState:i,isFullScreen:a,isRootChild:s})}),[t,l,n,g,m,i,a,s]),G=(0,r.useCallback)((()=>{y(!0)}),[y]),$=(0,r.useCallback)((()=>{y(!1)}),[y]),U=(0,r.useCallback)((e=>{if(E)return(0,Ge.jsx)(Bg,{topOffset:e,endPosition:E,handleCloseButtonClick:N})}),[E,N]),q=(0,k().K8)((()=>g.permissionScopesStore.state.canEditContent),[g.permissionScopesStore]),X=W===t.props.store,Y=o&&W===o.props.store,Q=X||Y||H||"subitem"===c?1:.7;let Z;const J=(0,k().K8)((()=>t.props.store.canEdit()),[t.props.store]),ee=(0,k().K8)((()=>"subitem"!==c&&(J&&("collectionTypedView"===g.contextTypeFromStoreState||q))),[c,J,g,q]);"subitem"===c?Z=K().Tj.collectionUnsetDependencyArrow:O&&D&&(Z=O<=D?K().Tj.collectionValidDependencyArrow:K().Tj.red.icon.accentPrimary);const te=(0,I().IS)((()=>({svgStyle:{zIndex:"dependency"===c&&(H||Y)?86:83}})),[c,H,Y]);return V?d?(0,Ge.jsx)(Vg,{startPosition:V,timelineState:i}):u?(0,Ge.jsx)(Fg,{startPosition:V,timelineState:i}):t!==o&&E?(0,Ge.jsx)(Eg,{startPosition:V,endPosition:E,strokeOpacity:Q,strokeColorOverride:Z,svgStyle:te.svgStyle,cornerRadiusOverride:"subitem"===c?8:void 0,relationType:c,handleMouseMove:G,handleMouseLeave:$,renderChildren:ee&&H?U:void 0}):null:null}function Bg(e){const{topOffset:t,endPosition:o,handleCloseButtonClick:n}=e,r=(0,uu().A1)(),i=(0,I().IS)((()=>({icon:{background:K().Tj.white,borderRadius:5}})),[]),l=r?o.right:o.left-16;return(0,Ge.jsx)(Ge.Fragment,{children:(0,Ge.jsx)("foreignObject",{width:16,height:16,x:l,y:o.top-t+8,style:{cursor:"pointer",pointerEvents:"all"},onClick:n,children:(0,Ge.jsx)(ke().I,{icon:Ig().xMarkCircleFillSmallIcon,size:"sm",colorPalette:"red",colorVariant:"accentPrimary",style:i.icon})})})}function Vg(e){const{startPosition:t,timelineState:o}=e,n=(0,uu().A1)(),r=(0,k().K8)((()=>{const e=o.drawStateStore.state;if(!e||void 0===e.xOffsetPx||void 0===e.yOffsetPx)return;const r=(n?t.left:t.right)+(n?-e.xOffsetPx:e.xOffsetPx)+(n?-18:18);return{left:r,right:r,top:t.top+e.yOffsetPx}}),[t,o.drawStateStore,n]);return r?(0,Ge.jsx)(Eg,{startPosition:t,endPosition:r,strokeOpacity:1,relationType:"dependency"}):null}function Fg(e){var t;const{startPosition:o,timelineState:n}=e,r=(0,uu().A1)(),i=(0,k().O$)(n.dateRangePlaceholderStore),l=(0,k().K8)((()=>null!=i&&i.active?i.date:void 0),[i]),a=null!=i&&i.active?null===(t=i.newTimelineItemProps)||void 0===t?void 0:t.subitemPath:void 0,s=a?a[a.length-1].children.length:0,c=o.top+s*jg+Ag+5,d=(0,k().K8)((()=>{const e=n.zoomLevelStore.state,{startTimestamp:t,endTimestamp:o}=n.currentRangeStore.state;return(0,wn().w0)(e,o-t)}),[n]),u=(0,k().K8)((()=>{const e=(0,wn().BD)({timelineState:n,dateValue:l,placeholderDate:l,subitemPlaceholderDate:void 0});if(!c||!e)return;let t,i;r?(t=d-e.right,i=d-e.left):(t=e.left,i=e.right);return _g({startItemRect:o,value:{left:t,right:i,top:c}})}),[l,c,r,d,o,n]);return u?(0,Ge.jsx)(Eg,{startPosition:o,endPosition:u,strokeOpacity:1,strokeColorOverride:K().Tj.collectionUnsetDependencyArrow,relationType:"subitem"}):null}function Eg(e){const{startPosition:t,endPosition:o,strokeColorOverride:n,cornerRadiusOverride:i,strokeOpacity:l,relationType:a,svgStyle:s,handleMouseMove:c,handleMouseLeave:d}=e,u=(0,_t().ET)(),[p,g]=(0,r.useState)(0),m=(0,uu().A1)(),S=m?t.left:t.right,h=t.top+Ag-p,y=m?o.right+3:o.left-3,v=o.top+Ag-p,f=(0,k().K8)((()=>{if(n)return n;const e=(0,wn().tH)(u),r=m?t.left&&o.right:t.right&&o.left;if(!e||!r)return K().Tj.collectionUnsetDependencyArrow;return(m?t.left>o.right:t.right<o.left)?K().Tj.collectionValidDependencyArrow:K().Tj.red.icon.accentPrimary}),[u,o.left,o.right,t.left,t.right,n,m]);return(0,Ge.jsx)("svg",{style:{...Pg,...s},ref:e=>{e&&g(e.getBoundingClientRect().top)},children:(0,Ge.jsx)(Tg().A,{startPoint:{x:S,y:h},endPoint:{x:y,y:v},style:{stroke:f,strokeWidth:wn().cC,strokeOpacity:l},useRightAngles:"subitem"===a,showArrowHead:"dependency"===a&&!e.renderChildren,cornerRadiusOverride:i,handleMouseMove:c,handleMouseLeave:d,isRtl:m,children:e.renderChildren?e.renderChildren(p):void 0})})}function Og(e){const{timelineState:t,disabled:o,isReady:n,isFullScreen:i,isRootChild:l,renderEmitter:a}=e,s=(0,_t().ET)(),c=(0,r.useCallback)((()=>{t.drawStateStore.setState(void 0)}),[t.drawStateStore]),d=(0,k().K8)((()=>s.collectionViewBlockStore()),[s]),u=(0,k().K8)((()=>s.settingsStore.state.open),[s]);if((0,r.useEffect)((()=>{var e;!u&&null!==(e=t.drawStateStore.state)&&void 0!==e&&e.tryToCompleteDrawnArrow&&c()}),[u,t.drawStateStore,c]),!n||!d)return null;const p=kg.findTimelineItems(d);return(0,Ge.jsx)(Ge.Fragment,{children:p.map((e=>{const{store:n,groupFormat:s}=e.props,c=null==s?void 0:s.value,d=c?(0,Vn().AC)(c):"noGroup";return(0,Ge.jsxs)(r.Fragment,{children:[(0,Ge.jsx)(Dg,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:a,relationType:"dependency"},`${n.id}-${d}-${n.key}-dependency`),(0,Ge.jsx)(Dg,{startItem:e,timelineState:t,disabled:o,isFullScreen:i,isRootChild:l,renderEmitter:a,relationType:"subitem"},`${n.id}-${d}-${n.key}-subitem`)]},`${n.id}-${d}-${n.key}`)}))})}function Dg(e){const{startItem:t,timelineState:o,disabled:n,isFullScreen:i,isRootChild:l,relationType:a,renderEmitter:s}=e,{store:c,schema:d}=t.props,u=(0,_t().ET)(),p=(0,k().K8)((()=>"dependency"===a?o.drawStateStore.state:void 0),[o.drawStateStore,a]),g=(0,k().K8)((()=>(null==p?void 0:p.startStore)===c),[c,p]),m=(0,k().K8)((()=>g&&!(null!=p&&p.tryToCompleteDrawnArrow)),[p,g]),S=(0,k().K8)((()=>"dependency"===a?g&&p?p.temporaryDependencyRelationPointers:(0,wn().GW)(u,c,d):"subitem"===a?(0,wn().s0)(u,c,d):[]),[a,g,p,u,c,d]),h=(0,k().K8)((()=>u.collectionViewBlockStore()),[u]),y=(0,k().K8)((()=>{var e;const n=o.dateRangePlaceholderStore.state;if("subitem"!==a||null==n||!n.active||!n.newTimelineItemProps)return;const r=n.newTimelineItemProps.subitemPath;return(r?null===(e=r[r.length-1])||void 0===e?void 0:e.value.store:void 0)===t.props.store?n:void 0}),[a,t.props.store,o.dateRangePlaceholderStore]),v=(0,k().K8)((()=>[...kg.getItemsRefStore().state]),[]);return h?(0,Ge.jsxs)(Ge.Fragment,{children:[S.map((e=>{if(c.id===e.id)return null;const d=v.filter((t=>t.props.store.id===e.id));return(0,Ge.jsx)(r.Fragment,{children:d.map((r=>{const c=r.props.store,d=r.props.groupFormat;return(0,Ge.jsx)(Rg,{startItem:t,endItem:r,endRelationPointer:e,timelineState:o,disabled:n,isFullScreen:i,isRootChild:l,renderEmitter:s,relationType:a},`${c.id}-${null==d?void 0:d.value.value}-${c.key}`)}))},e.id)})),"dependency"===a&&m?(0,Ge.jsx)(Rg,{isUserDrawnTemp:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"dependency"}):void 0,"subitem"===a&&y?(0,Ge.jsx)(Rg,{isNewSubitemPlaceholder:!0,startItem:t,endItem:void 0,endRelationPointer:void 0,timelineState:o,disabled:!1,isFullScreen:i,isRootChild:l,relationType:"subitem"}):void 0]}):null}function zg({collectionContextStore:e,isFullScreen:t,disabled:o,format:n,showTable:i,canEditCollectionTimeline:l}){return(0,r.useCallback)((r=>{const{groupFormat:a,groupsDisplayState:s}=r,c=n.collection_group_by,d=e.groupsStore.getGroupState(a),u=Boolean(a&&!(null!=d&&d.toggleStateStore.state)),{currentGroups:p,visibleGroups:g,hiddenGroups:m}=s,S=function(e,t,o,n){if(!e)return!0;const r=o.indexOf(e);return!t&&!o.find(((e,t)=>{if(t<r){const t=n.groupsStore.getGroupState([e]);return null==t?void 0:t.toggleStateStore.state}return!1}))}(a,u,p,e),h=null==d?void 0:d.reducerResultStore.state,y=ne().XQ({collectionContextStore:e,reducerResult:h,isFullScreen:t}),v=a===g[g.length-1],f=(0,ci().Zl)(s,e,!1),b=e.permissionScopesStore.state,x=v&&!o&&b.canConfigureBlock&&c&&(0,Vn().pP)(c,b.canConfigureCollection),w=h&&0===h.blockIds.length;return{groupHeader:Boolean(a&&(!i||!S)),tableHeaderRow:Boolean(i&&!u&&!S),tableAggregationRow:Boolean(i&&!u),addItemRow:Boolean(l&&!u),hiddenGroupsButton:Boolean(v&&m.length>0),groupsLoadMoreButton:Boolean(v&&f),loadMoreButton:Boolean(!u&&y),tableEmptyRow:Boolean(i&&!u&&w),extraGroupMarginBottom:Boolean(i&&u),addGroupButton:Boolean(x)}}),[l,e,o,n.collection_group_by,t,i])}const Lg=function({store:e,collectionContextStore:t,groupFormat:o}){const n=(0,x().v3)(),r=(0,k().K8)((()=>Kg(e)),[e]),{value:i}=(0,T().fJ)($t().T.formulas),{value:l}=(0,T().fJ)(Vt().VI.duplicateActions),a=(0,I().IS)((()=>({row:{width:"100%",height:xn().wc}})),[]);return(0,Ge.jsx)(oo().Ay,{store:e,style:a.row,canDropBelow:!0,canNativeDropBelow:!0,shouldShowDropZone:!0,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,canInsertAbove:!0,canInsertBelow:!0,onInsertBelow:r?Wg(r,n,e,t,o):void 0,onInsertAbove:r?Hg(r,n,e,t,o):void 0,onSelectableDrop:r=>function(e,t,o,n,r,i,l){const{droppedDirection:a,droppedStores:s,duplicate:c}=e,d=Kg(o);if(!d)return;const u=n.subitemTreeStore.state,p=(0,nr().Qe)(u.children,(e=>e.value.store===o)),g=B().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");B().default.DO_NOT_USE_measureAfterNextFlushLegacy(g,{environment:t,getData:()=>Lt().tv({collectionContextStore:n,is_native_drop:!1,is_empty:!1})});const m="collectionTypedView"===n.contextTypeFromStoreState;et().createAndCommit({userAction:"TimelineDroppableRow.handleDrop",environment:t,canUndo:!0,perform:e=>{xr({environment:t,collectionStore:m?void 0:d,targetStore:o,droppedDirection:a,collectionContextStore:n,groupsPointer:r?[r]:[],droppedStores:s,duplicate:c,transaction:e,subitemPath:p,collapsedGroup:!1,formulasModule:i,duplicateActions:l})}})}(r,n,e,t,o,i,l),onNativeDrop:r=>function(e,t,o,n,r,i,l){const{files:a,droppedDirection:s}=e,c=Kg(r);if(!c)return;const d=o.collectionViewBlockStore(),u=B().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");B().default.DO_NOT_USE_measureAfterNextFlushLegacy(u,{environment:t,getData:()=>Lt().tv({collectionContextStore:o,is_native_drop:!0,is_empty:!1})}),d&&et().createAndCommit({userAction:"TimelineDroppableRow.handleNativeDrop",environment:t,canUndo:!0,perform:e=>{Gl({environment:t,collectionStore:c,targetStore:d,droppedDirection:s,collectionContextStore:o,groupsPointer:n?[n]:[],files:a,transaction:e,formulasModule:i,duplicateActions:l})}})}(r,n,t,o,e,i,l),onRemove:t=>function(e,t){const{transaction:o}=e,n=Kg(t);if(!n)return;ir().by({childStore:t,transaction:o})}(t,e),analyticsName:"timeline"},e.id)};function Kg(e){return e.getAssociatedCollectionStore()}function Wg(e,t,o,n,r){return i=>{const{insertStores:l,transaction:a}=i,s="collectionTypedView"===n.contextTypeFromStoreState;return(0,la().D)({environment:t,collectionStore:s?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!1,transaction:a})}}function Hg(e,t,o,n,r){return i=>{const{insertStores:l,transaction:a}=i,s="collectionTypedView"===n.contextTypeFromStoreState;return(0,la().D)({environment:t,collectionStore:s?void 0:e,collectionContextStore:n,groupsPointer:r?[r]:[],insertStores:l,store:o,before:!0,transaction:a})}}function Ng({store:e,groupFormat:t,collectionContextStore:n,canEdit:i,disabled:l,format:a,paddingLeft:s,paddingRight:c,headerWidth:d,shouldShowShimmer:u}){const p=(0,x().v3)(),{value:m}=(0,T().fJ)($t().T.formulas),[S]=(0,r.useState)((()=>new(ae().B)(p,e.pointer))),h=(0,k().K8)((()=>n.groupsStore.getGroupState(t)),[n,t]),y=(0,k().O$)(n.permissionScopesStore),v=(0,k().K8)((()=>n.collectionViewStore()),[n]),f=(0,k().K8)((()=>i&&y.canEditContent&&!y.isSyncedCollection&&g().A.isMobile&&!(null!=v&&v.isSyncedCollection())),[i,v,y]),{value:b}=(0,T().fJ)(Vt().VI.duplicateActions),w=(0,r.useMemo)((()=>{if(S)return(0,Ge.jsx)(oo().Ay,{store:S,shouldShowDropZone:i,canDropBelow:i,canNativeDropBelow:i,dropzoneShouldNeverUseOrigin:!0,dropzoneMustBeWithinHorizontalBound:!0,onSelectableDrop:e=>function(e,t,o,n,r,i){const{droppedDirection:l,droppedStores:a,duplicate:s}=e,c=o.collectionStore();if(!c)return;const d=o.groupsStore.getGroupState(t);if(!d)return;const u=o.collectionViewBlockStore(),p=B().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");B().default.DO_NOT_USE_measureAfterNextFlushLegacy(p,{environment:n,getData:()=>Lt().tv({collectionContextStore:o,is_native_drop:!1,is_empty:!0})}),u&&et().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableDrop",environment:n,canUndo:!0,perform:e=>{xr({environment:n,collectionStore:c,targetStore:u,droppedDirection:l,collectionContextStore:o,groupsPointer:d.groupsPointer,droppedStores:a,duplicate:s,transaction:e,collapsedGroup:!1,formulasModule:r,duplicateActions:i})}})}(e,t,n,p,m,b),onNativeDrop:e=>function(e,t,o,n,r,i){const{files:l,droppedDirection:a}=e,s=t.collectionStore();if(!s)return;const c=t.collectionViewBlockStore(),d=B().default.DO_NOT_USE_markLegacy("collections.drop_item_lag");B().default.DO_NOT_USE_measureAfterNextFlushLegacy(d,{environment:n,getData:()=>Lt().tv({collectionContextStore:t,is_native_drop:!0,is_empty:!0})}),c&&et().createAndCommit({userAction:"TimelineDropzoneSelectableGroupResults.handleEmptyDroppableNativeDrop",environment:n,canUndo:!0,perform:e=>{Gl({environment:n,collectionStore:s,targetStore:c,droppedDirection:a,collectionContextStore:t,groupsPointer:o?[o]:[],files:l,transaction:e,formulasModule:r,duplicateActions:i})}})}(e,n,t,p,m,b),analyticsName:"timeline",style:{width:"100%"}})}),[S,i,t,n,p,m,b]),C=(0,r.useMemo)((()=>({groupFormat:t,collectionContextStore:n,isLast:!1,handleOpenPeekPage:o(806080).lQ})),[t,n]);return h?(0,Ge.jsxs)(Ge.Fragment,{children:[w,(0,Ge.jsx)(fa,{collectionContextStore:n,groupsPointer:h.groupsPointer,format:a,canDrag:f,disableRequest:!0,itemProps:C,canDrop:!0,renderItem:Lg,disabled:l,direction:ya.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,touchDragOnly:!0,disableSelectable:!0,nestedCreateSubitemButton:$g,paddingLeft:s,paddingRight:c,headerWidth:d,shouldShowShimmer:u,timelineType:"dropzone"})]}):null}const Gg=r.memo(Ng,Fn().A);function $g(e){return(0,Ge.jsx)("div",{style:{width:"100%",height:xn().wc+1}})}function Ug({timelineState:e,...t}){const{collectionContextStore:o,isFullScreen:n,paddingLeft:r,isInPeekRenderer:i}=t,l=(0,k().O$)(o.isInHomeWidgetStore),a=(0,k().K8)((()=>e.outerSizeObserver.rect.state.width),[e]),s=(0,I().IS)((()=>({outerDiv:{position:"sticky",insetInlineStart:0,width:a,height:wn().tp,zIndex:87},headerStyle:{width:"100%",height:"100%",paddingInlineStart:n?r:32,zIndex:void 0,transition:"background 200ms ease-in-out, border 200ms  ease-in-out",background:"transparent",borderBottom:"1px solid transparent"},stickyStyle:{...l?{}:{background:K().Tj.background.primary,boxShadow:`0 -1px 0 ${K().Tj.border.primary}`}}})),[n,l,a,r]);return(0,Ge.jsx)("div",{style:s.outerDiv,children:(0,Ge.jsx)(Sl,{...t,style:s.headerStyle,stickyStyle:s.stickyStyle,preventToggleBackground:i})})}var qg=()=>o(381175);const Xg=new(T().O2)("TimelineItemDateRange",(async()=>await o.e(11922).then(o.bind(o,117686)))),Yg=(0,T()._h)(Xg,(e=>e.TimelineItemDateRange));var Qg=function(e){return e[e.Hidden=0]="Hidden",e[e.VisibleInItem=1]="VisibleInItem",e[e.VisibleOutOfItem=2]="VisibleOutOfItem",e[e.NotDefined=3]="NotDefined",e}(Qg||{});function Zg({store:e,type:t,timelineState:n,scrollerLeftOffset:i,paddingLeft:l,format:a,itemPositionStore:s,dateValueStore:c,isDraggingViaTimelineItemStore:d,collectionContextStore:u,isFullScreen:p,isInPeekRenderer:g,isRootChild:m}){const S=(0,x().v3)(),h=(0,r.useRef)(Qg.NotDefined),y=(0,r.useRef)(null),v=(0,r.useRef)(null),[f,b]=(0,r.useState)(!1),w="left"===t?o(84923).arrowStraightLeftFillSmallIcon:o(160438).arrowStraightRightFillSmallIcon,C=(0,k().O$)(n.outerSizeObserver.rect),T=(0,k().r6)((()=>{const e=s.state;if(e){const{left:o,right:r}=e;if(d.state)return Qg.Hidden;const l=n.scrollLeftStore.state;if(void 0!==l){if("left"===t){const e=l+i;if(e-r>0)return Qg.VisibleOutOfItem;if(e-o>0)return Qg.VisibleInItem}else{const e=l+C.width;if(o-e>0)return Qg.VisibleOutOfItem;if(r-e>0)return Qg.VisibleInItem}return Qg.Hidden}}return Qg.NotDefined}),[d,s,C,i,n,t]),j=(0,I().IS)((()=>({arrow:{display:"flex",alignItems:"center",width:16,height:16,flexShrink:0,pointerEvents:"auto",background:f?K().Tj.icon.primary:K().Tj.icon.secondary,borderRadius:4,border:`1px solid ${K().Tj.background.primary}`,..."left"===t&&{marginInlineStart:8,marginInlineEnd:4},..."right"===t&&{marginInlineEnd:8,marginInlineStart:4}},icon:{height:12,fill:g?K().Tj.background.elevated:K().Tj.background.primary},wrap:{position:"sticky",insetInlineStart:"left"===t?i:C.width-220,width:220,height:xn().sH-6,marginTop:2,display:"flex",alignItems:"center",cursor:"pointer",flexDirection:"right"===t?"row-reverse":void 0,whiteSpace:"nowrap",textOverflow:"ellipsis"}})),[f,g,C,i,t]);(0,r.useLayoutEffect)((()=>{A()}),[]),(0,r.useEffect)((()=>(T.addListener(A),()=>{T.removeListener(A)})),[]),(0,r.useEffect)((()=>{T.enqueueRecompute()}));const A=(0,r.useCallback)((()=>{const e=y.current,t=v.current;if(e&&t){const o=T.state,n=o===Qg.VisibleInItem||o===Qg.VisibleOutOfItem;e.style.opacity=""+(n?1:0),e.style.transform=`scale(${n?1:.3})`,t.style.pointerEvents=o===Qg.VisibleOutOfItem?"":"none";h.current!==Qg.NotDefined&&o!==Qg.NotDefined&&!e.style.transition&&(e.style.transition="transform 160ms ease-in-out, opacity 160ms ease-in-out"),h.current=o}}),[T]),M=(0,r.useCallback)((()=>{const o=c.state,r=n.zoomLevelStore.state,{snapUnit:i}=wn().eM[r],s=(0,wn().C1)(r,200);if(o)if("left"===t){const{start:e}=(0,wn().yl)(o,i),t=(0,wn().zb)({timestamp:e.valueOf(),environment:S,timelineState:n,paddingLeft:l,format:a})-s;og().k3({timelineState:n,environment:S,zoomLevel:r,centerTimestamp:t})}else{const{end:e}=(0,wn().yl)(o,i),t=(0,wn()._r)({timestamp:e.valueOf(),timelineState:n})+s;og().k3({timelineState:n,environment:S,zoomLevel:r,centerTimestamp:t})}b(!1),(0,Va().L)({environment:S,store:e}),(0,ng().iT)(S,{...(0,ng().ZR)({environment:S,collectionContextStore:u,timelineState:n,isFullScreen:p,isRootChild:m}),type:t})}),[u,c,S,a,p,m,l,e,n,t]),P=(0,r.useCallback)((()=>{S.device.isPhone||io().A.state||b(!0)}),[S]),_=(0,r.useCallback)((()=>{S.device.isPhone||b(!1)}),[S]);return(0,Ge.jsxs)("div",{style:j.wrap,onMouseOver:P,onMouseOut:_,onMouseDown:Ti().t,onClick:M,ref:v,children:[(0,Ge.jsx)("div",{style:j.arrow,ref:y,children:w(j.icon)}),f?(0,Ge.jsx)(em,{dateValueStore:c,timelineState:n,isInPeekRenderer:g}):void 0]})}const Jg=r.memo(Zg,Fn().A);function em({dateValueStore:e,timelineState:t,isInPeekRenderer:o}){const n=(0,I().IS)((()=>({dateRange:{fontSize:12,paddingInlineStart:4,paddingInlineEnd:4,borderRadius:4,background:o?K().Tj.peekTimelineBackground:K().Tj.timelineBackground,pointerEvents:"none"}})),[o]),r=(0,k().O$)(e),i=(0,k().O$)(t.zoomLevelStore);return r?(0,Ge.jsx)("span",{style:n.dateRange,children:(0,wn().tX)(r,i)}):null}class tm extends P().Store{getInitialState(){return null}}function om({store:e,timelineState:t,scrollerLeftOffset:o,paddingLeft:i,format:l,query:a,schema:s,blockPropertyValueOverlayStore:c,disabled:d,showProperties:u,collectionContextStore:p,isFullScreen:m,isRootChild:S,toggleButton:h,groupFormat:f,subitemPath:b,isInPeekRenderer:w,handleOpenPeekPage:C}){const j=(0,x().v3)(),{value:A}=(0,T().fJ)($t().T.formulas),M=(0,r.useRef)(null),[P]=(0,r.useState)((()=>e.clone())),_=(0,r.useRef)(null),R=(0,k().K8)((()=>{const o=t.dateRangePlaceholderStore.state;if(o.active&&o.store===e&&!o.newTimelineItemProps&&(0,Vn().Mn)(o.groupFormat,f))return o.date}),[f,e,t]),B=(0,k().r6)((()=>{const o=t.dragStateStore.state;if(R)return R;if(o){const t=o.stores.indexOf(e);if(t>=0)return o.temporaryValues[t]}return nm(e,a,s,j,A)}),[j,R,a,s,e,t,A],{useDeepEqual:!0}),V=(0,k().O$)(B),F=(0,k().K8)((()=>{const e=(0,nr().dC)(b);if(!e||Boolean(V))return;const t=e.value.store,o=kg.findTimelineItems(t);if(o.length>0){return o[0].dateValueStore.state}}),[V,b]),E=(0,k().r6)((()=>(0,wn().BD)({timelineState:t,dateValue:V,placeholderDate:R,subitemPlaceholderDate:F})),[V,R,F,t]),O=(0,k().uB)(void 0,tm);(0,Uu().b)(kg,(()=>({getNode:()=>M.current,props:{store:e,groupFormat:f,schema:s},stores:{nodeStore:O},dateValueStore:B,itemPositionStore:E})),[e,M,B,f,s,E,O]);const D=(0,k().O$)(E),z=(0,k().K8)((()=>{var e;return null===(e=p.groupsStore.getGroupState(f))||void 0===e?void 0:e.reducerResultStore}),[f,p]),L=(0,Ue().Zp)(),K=Boolean(D&&!D.isPlaceholder&&!(null!=L&&L.disableContentPointerEvents)),W=(0,k().r6)((()=>{const o=t.dragStateStore.state,n=En().Ay.state;return Boolean(o&&o.stores.includes(e)&&n.isDragging&&n.draggedStores.includes(e))}),[e,t]);(0,k().O$)(W);const H=(0,k().K8)((()=>e.getAssociatedCollectionStore()),[e]),N=(0,r.useCallback)((o=>{const n=t.dateRangePlaceholderStore.state,r=p.groupsStore.getGroupState(f);if(r)if(n.active){const{date:o}=n;et().createAndCommit({userAction:"TimelineItem.handleClick",environment:j,canUndo:!0,perform:t=>{og().Xt({environment:j,store:e,query:a,schema:s,date:o,transaction:t})}}),t.dateRangePlaceholderStore.setState({active:!1})}else{const{horizontalScroller:n}=t,i=t.scrollLeftStore.state,l=E.state,a=_.current;if(!n||void 0===i||!l||!a)return;const s=n.getBoundingClientRect(),c=i+((0,uu().A1)()?s.right-o.clientX:o.clientX-s.left),d=_.current;if(!d)return;const u=d.lastElementChild;if(!u)return;const g=i+(u.getBoundingClientRect().right-s.left);c>l.right&&c<=g&&(0,y().SQ)(o,y().y$.Click,(()=>{(0,v().Z)()||(0,Kr().V)({environment:j,store:e,openInNew:(0,qg().V)(o),peekMode:(0,ne().hH)(p),resultsStore:r.resultsStore,collectionContextStore:p,pageVisitSource:de().y8.PeekOpen})}))}}),[p,j,f,E,a,s,e,t]),G=(0,r.useCallback)((()=>{t.dateRangePlaceholderStore.setState({active:!1})}),[t]),$=(0,r.useCallback)((e=>{const{target:t}=e;!g().A.isMobile&&t instanceof HTMLElement&&(0,y().SQ)(e,y().y$.EditorMouseDown,(()=>{e.preventDefault(),(0,to().j)({environment:j,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}))}),[j]),U=(0,r.useCallback)((o=>{const r=t.dragStateStore.state,i=t.drawStateStore.state,{horizontalScroller:l}=t,c=t.scrollLeftStore.state,u=t.zoomLevelStore.state,p=t.currentRangeStore.state,{snapUnit:g,getDateRangePlaceholderDuration:m}=wn().eM[u];if(!i&&io().A.state||r||nm(e,a,s,j,A)||!l||void 0===c||d)return;const S=l.getBoundingClientRect(),h=c+((0,uu().A1)()?S.right-o.clientX:o.clientX-S.left),y=(0,wn().C1)(u,h),v=n().DateTime.fromMillis(p.startTimestamp+y),b=(0,wn().DY)(v,g),x=(0,wn().DY)(m(v),g),w=(0,ed().p6)(b.valueOf(),(0,tr().P)()),C=(0,wn().oJ)({startValue:w,snapUnit:g,desiredStart:b,desiredEnd:x});t.dateRangePlaceholderStore.setState({active:!0,store:e,parentStore:H,groupFormat:f,date:C,newTimelineItemProps:void 0,existingTimelineItemProps:{query:a,schema:s}})}),[j,t,e,f,d,a,s,H,A]),q=(0,r.useCallback)((e=>{O.setState(e)}),[O]),X=(0,I().IS)((()=>({scrollArrows:{display:"flex",height:0,position:"relative",zIndex:86},dateRange:{display:"flex",height:xn().wc,width:"100%",cursor:"default",isolation:"auto"}})),[]);if(!z)return null;const Y=Boolean(D);return(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsxs)("div",{ref:M,style:X.scrollArrows,children:[K?(0,Ge.jsx)(Jg,{store:e,type:"left",timelineState:t,scrollerLeftOffset:o,itemPositionStore:E,dateValueStore:B,paddingLeft:i,format:l,isDraggingViaTimelineItemStore:W,collectionContextStore:p,isFullScreen:m,isInPeekRenderer:w,isRootChild:S}):void 0,K?(0,Ge.jsx)(Jg,{store:e,type:"right",timelineState:t,scrollerLeftOffset:o,itemPositionStore:E,dateValueStore:B,paddingLeft:i,format:l,isDraggingViaTimelineItemStore:W,collectionContextStore:p,isInPeekRenderer:w,isFullScreen:m,isRootChild:S}):void 0]}),(0,Ge.jsx)("div",{style:X.dateRange,onMouseDown:$,onMouseMove:U,onMouseLeave:G,onClick:N,className:fn().ZLF,ref:q,children:Y?(0,Ge.jsx)(Yg,{store:e,parentStore:H,toggleButton:h,clonedStore:P,itemPositionStore:E,dateValueStore:B,query:a,schema:s,timelineState:t,blockPropertyValueOverlayStore:c,disabled:d,showProperties:u,scrollerLeftOffset:o,isDraggingViaTimelineItemStore:W,collectionContextStore:p,isFullScreen:m,isInPeekRenderer:w,isRootChild:S,propertiesWrapElementRef:_,resultStore:z,handleOpenPeekPage:C}):void 0})]})}function nm(e,t,o,n,r){return(0,wn().GM)({store:e,query:t,schema:o,userId:n.currentUser.id,intl:Yn().A.getIntl(),formulasModule:r,environment:n})}var rm=()=>o(140934);function im(e){const{store:t,parentStore:i,timelineState:l,scrollerLeftOffset:a,query:c,schema:d,blockPropertyValueOverlayStore:u,disabled:p,showProperties:m,collectionContextStore:S,isFullScreen:h,isRootChild:v,toggleButton:f,groupFormat:b,canEditTimelineItems:w,subitemPath:C,paddingLeft:T,showTable:j}=e,A=(0,x().v3)(),[M,P]=(0,r.useState)(),_=(0,I().IS)((()=>({container:{display:"flex",height:xn().wc,width:"100%",cursor:"default",isolation:"auto"}})),[]);(0,r.useEffect)((()=>{P(null==t?void 0:t.clone())}),[t]);const R=(0,k().K8)((()=>{var e;return null===(e=S.groupsStore.getGroupState(b))||void 0===e?void 0:e.reducerResultStore}),[S.groupsStore,b]),B=(0,k().K8)((()=>{const e=l.dateRangePlaceholderStore.state;if(e.active&&e.store===t&&e.newTimelineItemProps&&e.parentStore===i&&(0,Vn().Mn)(e.groupFormat,b))return e.date}),[b,i,t,l.dateRangePlaceholderStore]),V=(0,o(951500).l)(B),F=(0,k().K8)((()=>(0,wn().BD)({timelineState:l,dateValue:V,placeholderDate:B,subitemPlaceholderDate:void 0})),[V,B,l]),E=Boolean(F),O=(0,k().K8)((()=>!S.isInHomeWidgetStore.state&&!t&&!E&&S.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})),[S,E,t]),D=(0,k().O$)(S.isInPeekRendererStore),z=(0,r.useMemo)((()=>new(rm().ComputedStore)((()=>F),{debugName:"itemPositionStore"})),[F]),L=(0,r.useMemo)((()=>new(rm().ComputedStore)((()=>V),{debugName:"dateValueStore"})),[V]),K=(0,r.useMemo)((()=>new(rm().ComputedStore)((()=>!1),{debugName:"isDraggingViaTimelineItemStore"})),[]);return R?(0,Ge.jsxs)("div",{style:_.container,onMouseDown:e=>function(e,t){const{target:o}=e;if(g().A.isMobile||!(o instanceof HTMLElement))return;(0,y().SQ)(e,y().y$.EditorMouseDown,(()=>{e.preventDefault(),(0,to().j)({environment:t,target:o,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:!0})}))}(e,A),onMouseMove:e=>function(e,t,o,r,i,l,a,s,c,d,u,p){var g;const m=t.drawStateStore.state,S=t.dragStateStore.state,{horizontalScroller:h}=t,y=t.scrollLeftStore.state,v=t.zoomLevelStore.state,f=t.currentRangeStore.state,{snapUnit:b,getDateRangePlaceholderDuration:x}=wn().eM[v];if(!m&&io().A.state||S||!h||void 0===y||i)return;const w=null===(g=d.groupsStore.getGroupState(r))||void 0===g?void 0:g.resultsStore;if(!w)return;const C=h.getBoundingClientRect(),k=y+((0,uu().A1)()?C.right-e.clientX:e.clientX-C.left),I=(0,wn().C1)(v,k),T=n().DateTime.fromMillis(f.startTimestamp+I),j=(0,wn().DY)(T,b),A=(0,wn().DY)(x(T),b),M=(0,ed().p6)(j.valueOf(),(0,tr().P)()),P=(0,wn().oJ)({startValue:M,snapUnit:b,desiredStart:j,desiredEnd:A});t.dateRangePlaceholderStore.setState({active:!0,store:o,parentStore:u,groupFormat:r,date:P,newTimelineItemProps:{query:l,schema:a,resultsStore:w,isFullScreen:s,canEditTimelineItems:c,subitemPath:p},existingTimelineItemProps:void 0})}(e,l,t,b,p,c,d,h,w,S,i,C),onMouseLeave:()=>function(e){e.dateRangePlaceholderStore.setState({active:!1})}(l),onClick:e=>function(e,t,o,n,r,i,l,a,c,d,u,p){const g=r.dateRangePlaceholderStore.state;if(g.active){const{date:e}=g,m=p?p.length>0?"timeline_add_subitem_bottom":"timeline_add_parent_item_bottom":"timeline_add_item_bottom",S=(0,s().f)(d);if(!(0,co().E)(t,S))return void(0,za().Q)(t,S);et().createAndCommit({userAction:"TimelineItemNew.handleClick",environment:t,canUndo:!0,perform:r=>{const s=og().dO({environment:t,transaction:r,date:e,store:d,parentStore:u,query:o,schema:n,isFullScreen:i,groupFormat:l,canEditTimelineItems:a,collectionContextStore:c,subitemPath:p,from:m});$n().vH(t,{from:m,type:"page",new_page_id:null==s?void 0:s.id,creating_block_id:null==s?void 0:s.id,...(0,Lt().sl)(c)})}}),r.dateRangePlaceholderStore.setState({active:!1})}}(0,A,c,d,l,h,b,w,S,t,i,C),className:fn().ZLF,children:[E?(0,Ge.jsx)(Yg,{store:i?void 0:t,parentStore:i,toggleButton:f,clonedStore:M,itemPositionStore:z,dateValueStore:L,query:c,schema:d,timelineState:l,blockPropertyValueOverlayStore:u,disabled:p,showProperties:m,scrollerLeftOffset:a,isDraggingViaTimelineItemStore:K,collectionContextStore:S,isFullScreen:h,isInPeekRenderer:D,isRootChild:v,resultStore:R,handleOpenPeekPage:am}):void 0,O?(0,Ge.jsx)(cm,{parentStore:i,collectionContextStore:S,paddingLeft:T,isFullScreen:h,showTable:j}):void 0]}):null}const lm=r.memo(im);function am(){}function sm(e,t,o){return{position:"sticky",insetInlineStart:t&&!o?e+8:8,display:"flex",alignItems:"center"}}function cm({parentStore:e,collectionContextStore:t,paddingLeft:o,isFullScreen:n,showTable:r}){const i=(0,k().O$)(t.currentSubitemFormatStoreForUiDisplayStore),l=(0,k().K8)((()=>{var t;return i&&e?null===(t=e.getSchema()[i.property])||void 0===t?void 0:t.name:""}),[i,e]);return(0,Ge.jsx)("div",{style:sm(o,n,r),children:(0,Ge.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:6,paddingBottom:2,fontSize:14,height:xn().wc,lineHeight:pe().K_.UIRegular.desktop},children:[(0,Ge.jsx)(ke().I,{icon:Ho().plusSmallIcon,size:"sm",colorVariant:"secondary"}),(0,Ge.jsx)("span",{style:{color:K().Tj.text.secondary},children:e&&l?(0,Ge.jsx)(Le().sA,{defaultMessage:"New page in {propertyName}",id:"database.timelineView.nest.addSubitemWithPropertyName",values:{propertyName:l}}):(0,Ge.jsx)(Le().sA,{defaultMessage:"New",id:"database.timelineView.item.addRowButton"})})]})})}function dm(e){const{store:t,parentStore:o,subitemPath:n,timelineState:r,disabled:i,query:l,format:a,schema:s,collectionContextStore:c,blockPropertyValueOverlayStore:u,isFullScreen:p,isRootChild:g,groupFormat:m,paddingLeft:S,showTimelineProperties:h,scrollerLeftOffset:y,showTable:v,canEditTimelineItems:f,isInPeekRenderer:b,isReady:x,canEdit:w}=e,C=(0,k().K8)((()=>c.groupsStore.getGroupState(m)),[c,m]),I=(0,k().O$)(c.permissionScopesStore),T=(0,k().K8)((()=>"collectionTypedView"===c.contextTypeFromStoreState),[c]),j=(0,k().O$)(c.isInHomeWidgetStore),A=(0,d().X)("can_create_pages_in_collection_permission"),M=(0,k().K8)((()=>A?c.isFullyNonInteractiveStore.state:i),[c.isFullyNonInteractiveStore,i,A]),P=(0,wi().V)(c),_=I.canEditContent||P;return!j&&C&&x&&(w||_||T)&&!I.isSyncedCollection?(0,Ge.jsx)(lm,{store:t,disabled:M||!_&&!T,timelineState:r,schema:s,query:l,format:a,scrollerLeftOffset:y,paddingLeft:S,showProperties:h,blockPropertyValueOverlayStore:u,collectionContextStore:c,isFullScreen:p,showTable:v,isRootChild:g,groupFormat:m,canEditTimelineItems:f,isInPeekRenderer:b,parentStore:o,subitemPath:n}):null}const um=function(e){const{collectionContextStore:t,schema:o,groupFormat:n,query:i,showTable:l,store:a,format:s,isFullScreen:c,paddingLeft:d,paddingRight:u,isInPeekRenderer:p,timelineState:g,blockPropertyValueOverlayStore:m,isRootChild:S,isReady:h,canEdit:y,disabled:v,scrollerLeftOffset:f,headerWidth:b}=e,w=(0,x().v3)(),C=(0,k().K8)((()=>{if(n)return;if(!i.timeline_by)return;const e=t.groupsStore.getGroupState(n);if(!e)return;const o=e.currentLimit.state,r=W().oE([!l&&{property:i.timeline_by,filter:{operator:"is_not_empty"}}]);return{type:"results",filter:r.length>0?{operator:"and",filters:r}:void 0,limit:o}}),[t,n,i,l]),I=(0,k().K8)((()=>t.groupsStore.getGroupState(n)),[t,n]),T=n?[n]:[],j=(0,k().K8)((()=>null==I?void 0:I.reducerResultStore.state),[null==I?void 0:I.reducerResultStore]),A=(0,k().K8)((()=>ne().XQ({collectionContextStore:t,reducerResult:j,isFullScreen:c})),[t,j,c]),M=(0,k().K8)((()=>ne().Cn({query:i,schema:o})),[i,o]),P=(0,r.useMemo)((()=>(s.timeline_properties||[]).filter((({visible:e})=>e)).map((({property:e})=>e))),[s]);return I?(0,Ge.jsxs)(Ge.Fragment,{children:[C?(0,Ge.jsx)(Xr().A,{id:T.length>0?`results:${(0,Vn().Hm)(T)}`:Bn().MZ,reducer:C,groupsPointer:T,collectionContextStore:t,resultStore:I.reducerResultStore}):void 0,(0,Ge.jsx)(gm,{groupFormat:n,format:s,collectionContextStore:t,store:a,schema:o,query:i,isInPeekRenderer:p,timelineState:g,blockPropertyValueOverlayStore:m,showTimelineProperties:P,paddingLeft:d,paddingRight:u,isFullScreen:c,isRootChild:S,isReady:h,canEdit:y,canEditTimelineItems:M,disabled:v,showTable:l,scrollerLeftOffset:f,headerWidth:b}),A?(0,Ge.jsx)("div",{style:{width:"100%"},children:l?(0,Ge.jsx)("div",{style:{height:zl().LA}}):(0,Ge.jsx)(zl().jJ,{style:{position:"sticky",insetInlineStart:c?d:3,width:"max-content",height:zl().LA},groupsPointer:T,store:a,collectionContextStore:t,format:s,isFullScreen:c,incrementLimitsInRelatedGroups:!1})}):void 0,(0,Ge.jsx)(dm,{...e,store:void 0,indentLevel:0,handleOpenPeekPage:()=>pm(t,n,w),canEditTimelineItems:M,showTimelineProperties:P})]}):null};function pm(e,t,o){const n=e.groupsStore.getGroupState(t);if(!n)return;B().default.DO_NOT_USE_markLegacy("collections.open_item_page_lag");const r=e.collectionViewStore();$().Ey({collectionContextStore:e,resultsStore:n.resultsStore});const i=null==r?void 0:r.getFormat().collection_peek_mode,l=i||ra().C9.timeline;na().bn(o,{is_peek:!0,from:"timeline",peek_mode:l})}function gm(e){const t=(0,x().v3)(),{groupFormat:o,format:n,collectionContextStore:r,disabled:i,query:l,schema:a,blockPropertyValueOverlayStore:s,isFullScreen:c,isRootChild:d,showTable:u,canEditTimelineItems:p,scrollerLeftOffset:g,timelineState:m,paddingLeft:S,paddingRight:h,showTimelineProperties:y,isInPeekRenderer:v,headerWidth:f}=e,b=(0,k().K8)((()=>({disabled:i,timelineState:m,schema:a,query:l,format:n,scrollerLeftOffset:g,paddingLeft:S,showProperties:y,blockPropertyValueOverlayStore:s,collectionContextStore:r,isFullScreen:c,showTable:u,isRootChild:d,groupFormat:o,canEditTimelineItems:p,isInPeekRenderer:v,handleOpenPeekPage:()=>pm(r,o,t),isLast:!1})),[r,o,n,t,i,l,a,s,c,d,u,p,g,m,S,y,v]),w=(0,k().K8)((()=>r.groupsStore.getGroupState(o)),[r,o]);return w?(0,Ge.jsx)(fa,{disableSelectable:!0,collectionContextStore:r,groupsPointer:w.groupsPointer,format:n,canDrag:!1,disableRequest:!0,itemProps:b,canDrop:!1,renderItem:om,disabled:!0,direction:ya.Vertical,shouldShowHoverMenu:!1,analyticsName:"timeline",emptyDroppableSize:0,nestedCreateSubitemButton:o=>function(e,t,o){return(0,Ge.jsx)(dm,{...o,store:e.store,indentLevel:e.indentLevel,parentStore:e.parentStore,subitemPath:e.subitemPath,handleOpenPeekPage:()=>pm(o.collectionContextStore,o.groupFormat,t),canEditTimelineItems:o.canEditTimelineItems,showTimelineProperties:o.showTimelineProperties})}(o,t,e),timelineType:"item",paddingLeft:S,paddingRight:h,headerWidth:f,shouldShowShimmer:!1}):null}const mm=r.memo((function({store:e,collectionContextStore:t,timelineState:o,disabled:n,isFullScreen:i,isInPeekRenderer:l,paddingLeft:a,paddingRight:s,headerWidth:c,isRootChild:d,format:u,schema:p,query:g,showTable:m,groupsReducerResultStore:S,canEditCollectionTimeline:h,isReady:y,blockPropertyValueOverlayStore:v,tableStore:f,scrollerLeftOffset:b,onGroupHeaderAddItem:x}){const w=(0,r.useCallback)((e=>{if(!m)return(0,Ge.jsx)(Ug,{timelineState:o,...e})}),[m,o]),C=(0,k().K8)((()=>(0,te().Ty)(u,f)),[u,f]),I=(0,r.useCallback)((r=>(0,Ge.jsx)(um,{store:e,groupFormat:r,schema:p,query:g,isInPeekRenderer:l,timelineState:o,collectionContextStore:t,blockPropertyValueOverlayStore:v,paddingLeft:a,paddingRight:s,format:C,isFullScreen:i,isRootChild:d,isReady:y,canEdit:h,disabled:n,showTable:m,scrollerLeftOffset:b,headerWidth:c})),[v,h,t,C,n,c,i,l,y,d,a,s,g,p,b,m,e,o]),T=function({collectionContextStore:e,isFullScreen:t,disabled:o,format:n,showTable:i,canEditCollectionTimeline:l}){const a=zg({collectionContextStore:e,isFullScreen:t,disabled:o,format:n,showTable:i,canEditCollectionTimeline:l});return(0,r.useCallback)((e=>{const t=a(e);let o=0,n=0;return t.groupHeader&&i&&(o+=wn().tp+wn().lH),t.tableHeaderRow&&(o+=wn().MR-1),t.tableAggregationRow&&(n+=xn().wc),t.addItemRow||(n+=1),t.tableEmptyRow&&(n+=xn().wc),t.hiddenGroupsButton&&i&&(n+=44),t.groupsLoadMoreButton&&i&&(n+=38),t.addGroupButton&&i&&(n+=mi+hi+Si),{paddingTop:o,paddingBottom:n,minHeight:wn().tp}}),[a,i])}({collectionContextStore:t,isFullScreen:i,disabled:n,format:u,showTable:m,canEditCollectionTimeline:h});return u.collection_group_by?(0,Ge.jsx)(Ci().l,{children:(0,Ge.jsx)(Qs,{reducerId:Bn().qK,store:e,collectionContextStore:t,disabled:n,isFullScreen:i,isRootChild:d,paddingLeft:a,paddingRight:s,stickyLeft:!1,renderGroupResults:I,getGroupStyle:T,renderHeader:w,onGroupHeaderAddItem:x,timelineType:"item",groupsResultStore:S,headerWidth:c})}):I()}));const Sm=r.memo((function({store:e,collectionContextStore:t,disabled:o,isFullScreen:n,isRootChild:i,paddingLeft:l,paddingRight:a,headerWidth:s,onGroupHeaderAddItem:c,format:d,groupsReducerResultStore:u,canEditCollectionTimeline:p,showTable:g}){const m=(0,r.useCallback)((()=>null),[]),S=function({collectionContextStore:e,isFullScreen:t,disabled:o,format:n,showTable:i,canEditCollectionTimeline:l}){const a=zg({collectionContextStore:e,isFullScreen:t,disabled:o,format:n,showTable:i,canEditCollectionTimeline:l});return(0,r.useCallback)((e=>{if(!e)return{paddingTop:0,paddingBottom:0};const t=a(e),o=xn().wc;let n=0,r=0;return t.groupHeader&&(n+=wn().tp+wn().lH-1),t.tableHeaderRow&&(n+=wn().MR),t.tableEmptyRow&&(n+=o),t.addItemRow&&(r+=xn().wc),t.loadMoreButton&&(r+=zl().LA),t.tableAggregationRow&&(r+=o-1),t.addItemRow||(r-=1),t.hiddenGroupsButton&&(r+=44),t.groupsLoadMoreButton&&(r+=38),t.addGroupButton&&(r+=mi+hi+Si),{paddingTop:n,paddingBottom:r}}),[a])}({collectionContextStore:t,isFullScreen:n,disabled:o,format:d,showTable:g,canEditCollectionTimeline:p}),h=(0,r.useCallback)((n=>(0,Ge.jsx)(Gg,{store:e,groupFormat:n,collectionContextStore:t,canEdit:p,format:d,disabled:o&&p,paddingLeft:l,paddingRight:a,headerWidth:s,shouldShowShimmer:!1})),[t,e,d,o,p,l,a,s]);return d.collection_group_by?(0,Ge.jsx)(Qs,{reducerId:Bn().qK,store:e,collectionContextStore:t,disabled:o,isFullScreen:n,isRootChild:i,paddingLeft:l,paddingRight:a,headerWidth:s,stickyLeft:!1,renderGroupResults:h,getGroupStyle:S,renderHeader:m,onGroupHeaderAddItem:c,timelineType:"dropzone",groupsResultStore:u}):(0,Ge.jsx)("div",{style:S(void 0),children:h(void 0)})}));const hm=function({isGrouped:e,format:t,collectionContextStore:n,isFullScreen:r,isRootChild:i,timelineState:l}){const a=(0,x().v3)(),{device:s}=a;return(0,Ge.jsx)(Wo().m,{render:c=>(0,Ge.jsx)(Fr().p,{size:"sm",onClick:()=>function(e,t,o,n,r,i){const l=o.collectionViewStore();if(!l)return;et().createAndCommit({userAction:"TimelineHideTableButton.handleHideTableClick",environment:e,canUndo:!0,perform:e=>{const o=(0,wn().iH)(t,!1);We().zA({stores:[l],update:o,transaction:e})}}),(0,ng().VD)(e,{...(0,ng().ZR)({environment:e,collectionContextStore:o,timelineState:i,isFullScreen:n,isRootChild:r}),show:!1})}(a,t,n,r,i,l),style:{position:"absolute",top:e?s.isIOS?3:4:s.isIOS?7:8,insetInlineEnd:e?6:8,zIndex:84},...c,children:(0,Ge.jsx)(ke().I,{icon:o(430042).R,size:"sm",colorVariant:"tertiary"})}),renderTooltip:()=>(0,Ge.jsx)(Le().sA,{id:"database.timelineView.tableGroupResults.hideTableButton.title",defaultMessage:"Hide table"})})};function ym(){const e=(0,I().IS)((()=>({rowContainer:{display:"flex",height:xn().wc,padding:"7px 0px",alignItems:"center",gap:6,alignSelf:"stretch",flex:"1 0 0",borderBottom:`1px solid ${K().Tj.border.secondaryTranslucent}`},rowShimmer:{width:"80%",height:10,flexShrink:0,borderRadius:12,marginInlineStart:12,backgroundColor:K().Tj.background.tertiaryTranslucent}})),[]);return(0,Ge.jsx)("div",{style:e.rowContainer,children:(0,Ge.jsx)(zo().P,{style:e.rowShimmer})})}const vm=function(e){const{showTablePropertyFormatsStore:t,groupFormat:o,isFullScreen:n,collectionContextStore:i,blockPropertyValueOverlayStore:l,isReady:a,store:s,disabled:c,format:d,schema:u,isInPeekRenderer:p,query:g,paddingBottom:m,tableStore:S,timelineState:h,isRootChild:y,canEdit:v,paddingLeft:f,paddingRight:b,headerWidth:x}=e,w=(0,k().K8)((()=>t.state.findIndex((e=>"title"===e.property))),[t]),C=(0,r.useMemo)((()=>o?[o]:[]),[o]),I=(0,k().K8)((()=>i.groupsStore.getGroupState(C)),[i,C]),T=(0,k().K8)((()=>null==I?void 0:I.reducerResultStore.state),[I]),j=(0,k().K8)((()=>(0,ne().XQ)({collectionContextStore:i,reducerResult:T,isFullScreen:n})),[i,T,n]),A=(0,k().O$)(i.shouldShowSpinnerStore),M=(0,k().O$)(i.permissionScopesStore),P=(0,k().O$)(t),_=(0,k().O$)(i.isInHomeWidgetStore),R=(0,k().K8)((()=>"collectionTypedView"===i.contextTypeFromStoreState),[i]),B=a&&0===(null==T?void 0:T.blockIds.length)&&!A,V=Boolean(!_&&a&&(v||R)&&!M.isSyncedCollection)&&!B;return I?(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)(xm,{store:s,format:d,schema:u,query:g,collectionContextStore:i,disabled:c,paddingBottom:m,isInPeekRenderer:p,blockPropertyValueOverlayStore:l,tableStore:S,showTablePropertyFormats:P,timelineState:h,isFullScreen:n,isRootChild:y,groupFormat:o,isInHomeWidget:_,paddingLeft:f,paddingRight:b}),(0,Ge.jsx)(Pm,{store:s,schema:u,collectionContextStore:i,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:t,canEdit:v,format:d,tableStore:S,paddingLeft:f,paddingRight:b,headerWidth:x,disabled:c,groupFormat:o,titleColumnIndex:w,groupsPointer:C,shouldShowShimmer:A}),A?(0,Ge.jsx)(ym,{}):void 0,j?(0,Ge.jsx)(Tm,{collectionContextStore:i,format:d,canEdit:v,groupFormat:o,isFullScreen:n,groupsPointer:C}):void 0,V?(0,Ge.jsx)(Im,{collectionContextStore:i,isFullScreen:n,groupFormat:o,blockPropertyValueOverlayStore:l,isInPeekRenderer:p}):void 0,(0,Ge.jsx)(Tu,{groupFormat:o,pageCount:(null==T?void 0:T.blockIds.length)??0,style:bm(a,o,n,f),disabled:c||!M.canConfigureBlock,schema:u,query:g,collectionContextStore:i,isInPeekRenderer:p,isFullScreen:n,showPropertyFormats:P,showRightActionsSpacer:!1,paddingLeft:f,paddingRight:b,disableSticky:!0,forViewType:"timeline"})]}):null};function fm(){}function bm(e,t,o,n){return{...!e&&{opacity:0,pointerEvents:"none"},...!o&&!t&&{position:"sticky",insetInlineStart:n},...o&&!t&&{insetInlineStart:n}}}function xm({groupFormat:e,store:t,format:o,schema:n,query:r,collectionContextStore:i,disabled:l,paddingBottom:a,isInPeekRenderer:s,blockPropertyValueOverlayStore:c,tableStore:d,showTablePropertyFormats:u,timelineState:p,isFullScreen:g,isRootChild:m,isInHomeWidget:S,paddingLeft:h,paddingRight:y}){const v=(0,k().K8)((()=>i.groupsStore.getGroupState(e)),[i,e]),f=(0,k().O$)(i.permissionScopesStore),b=(0,k().K8)((()=>i.viewIsFlushToTopbar()),[i]);if(!v)return null;const x=Boolean(e);return(0,Ge.jsx)(Cp,{store:t,format:o,schema:n,query:r,collectionContextStore:i,isInPeekRenderer:s,minWidth:void 0,paddingBottom:a,blockPropertyValueOverlayStore:c,showPropertyFormats:u,showRightActions:!1,allowHidingTitle:!0,tableStore:d,formatKey:"timeline_table_properties",disabled:l||!f.canConfigureBlock,disableHorizontalEdgeScroll:!0,height:(0,wn().Zk)(x),paddingTop:x?0:wn().jI-wn().MR,disableTopBorder:!b||x,groupFormat:e,isInHomeWidget:S,hasMoreReducerResults:!1,paddingLeft:h,paddingRight:y,children:!x&&f.canConfigureBlock?(0,Ge.jsx)(hm,{isGrouped:!1,format:o,collectionContextStore:i,timelineState:p,isFullScreen:g,isRootChild:m}):void 0})}function wm(e){return{display:"flex",alignItems:"center",height:xn().wc,width:"100%",paddingInlineStart:8,fontSize:14,lineHeight:pe().K_.UIRegular.desktop,background:e?K().Tj.background.elevated:K().Tj.background.primary}}function Cm(){return{width:Kn().Ev.sm,height:Kn().Ev.sm,marginInlineEnd:6,fill:K().Tj.icon.tertiary}}function km(e,t,o,n,r,i){const l=n?[n]:[],a=t.groupsStore.getGroupState(l);if(!(0,co().E)(e,(0,s().f)(t.collectionStore()))||!a)return;t.searchQueryStore.state&&(0,Cr().S)({searchQuery:"",collectionContextStore:t,isFullScreen:o});const c=t.currentSubitemFormatStoreForCollectionStore.state;et().createAndCommit({userAction:"TimelineTableGroupResults.handleAddRowClick",environment:e,canUndo:!0,perform:o=>{const l=(0,Xn().Q)({environment:e,collectionContextStore:t,groupsPointer:n?[n]:[],shouldCoerce:!0,templateStore:t.defaultPageTemplateStore.state,transaction:o,from:{createBlock:"timeline_table_group_results"},inMemoryRecordCache:e.defaultRecordCache.inMemoryRecordCache});if(l){if(g().A.isMobile){!function(e,t,o){o?o(e):(0,Da().navigate)({environment:t,url:e})}((0,Se().Ay)({store:l.newStore,fullyQualified:!1,pageVisitSource:de().y8.Create}),e,i)}else if(l.coercionSucceeded){const o=()=>{Un().ho({environment:e,blockPropertyValueOverlayStore:r,store:l.newStore,property:"title",surface:"table",collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(l.newStore,o)}else{const o=n?[n]:[],r=t.groupsStore.getGroupState(o);(0,Kr().V)({environment:e,store:l.newStore,peekMode:(0,ne().hH)(t),resultsStore:null==r?void 0:r.resultsStore,collectionContextStore:t,pageVisitSource:de().y8.Create})}$n().vH(e,{from:c?"timeline_add_parent_item_bottom":"timeline_add_item_bottom",type:"page",new_page_id:l.newStore.id,creating_block_id:l.newStore.id,...(0,Lt().sl)(t)})}}})}function Im({collectionContextStore:e,isFullScreen:t,groupFormat:o,blockPropertyValueOverlayStore:n,isInPeekRenderer:i}){const l=(0,x().v3)(),a=(0,r.useContext)(Ea().n),s=(0,r.useCallback)((()=>km(l,e,t,o,n,a)),[l,e,t,o,n,a]);return(0,Ge.jsxs)(ui().Ay,{onClick:s,style:wm(i),className:fn().$0P,onMouseDown:Ti().t,children:[(0,Ge.jsx)(ke().I,{icon:Ho().plusSmallIcon,style:Cm()}),(0,Ge.jsx)("span",{style:{color:K().Tj.text.tertiary},children:(0,Ge.jsx)(Le().sA,{defaultMessage:"New",id:"database.timelineView.addRowButton"})})]})}function Tm({groupsPointer:e,collectionContextStore:t,format:o,canEdit:n,groupFormat:r,isFullScreen:i}){const l=(0,x().v3)(),a=(0,k().K8)((()=>t.groupsStore.getGroupState(e)),[t,e]),s=(0,k().K8)((()=>(0,Yr().Kk)({collectionContextStore:t,groupsPointer:e})),[t,e]);return a?(0,Ge.jsxs)(ui().Ay,{onMouseDown:Ti().t,onClick:e=>function(e,t,o,n,r){const i=t.groupsStore.getGroupState(o);if(!i)return;const l=i.reducerResultStore.state;(0,Ii().k)(e),(0,Ye().I)({environment:r}),l&&(0,Vl().H)({collectionContextStore:t,environment:r,incrementLimitArgs:{isFullScreen:n,currentResultCount:l.blockIds.length,groupsPointer:i.groupsPointer,incrementLimitsInRelatedGroups:!1}}),(0,hu().K)(r)}(e,t,r,i,l),disabled:s,hoveredStyle:s?{background:K().Tj.whiteButtonBackground}:{},style:{display:"flex",alignItems:"center",height:zl().LA,width:"100%",paddingInlineStart:8,paddingBottom:2,fontSize:14,lineHeight:pe().K_.UIRegular.desktop,boxShadow:`0 -1px 0 ${K().Tj.border.primary}`,borderBottom:`1px solid ${K().Tj.border.primary}`,whiteSpace:"break-spaces"},children:[(0,Ge.jsx)(ke().I,{icon:Cl().arrowStraightDownSmallIcon,style:Cm()}),(0,Ge.jsx)("span",{style:{color:K().Tj.text.tertiary,flexGrow:1},children:(0,Ge.jsx)(Le().sA,{id:"database.loadMoreButtonTitle",defaultMessage:"Load more"})}),s?(0,Ge.jsx)("div",{style:{marginTop:1,marginInlineStart:8,marginInlineEnd:8},children:(0,Ge.jsx)(Xi().A,{size:"sm"})}):n&&(0,Ge.jsx)(vu().w,{collectionContextStore:t,format:o})]}):null}function jm(e){const t=(0,x().v3)(),{store:o,parentStore:n,subitemPath:r,indentLevel:i,groupsPointer:l,collectionContextStore:a,disabled:s,blockPropertyValueOverlayStore:c,paddingLeft:d}=e;return n?(0,Ge.jsx)($d,{store:o,collectionStore:n,subitemPath:r,indentLevel:i,collectionContextStore:a,disabled:s,groupsPointer:l,paddingLeft:d,onSubitemCreate:e=>function(e,t,o,n){if(o){const r=()=>{Un().ho({isNewBlock:!0,environment:n,blockPropertyValueOverlayStore:o,store:e,property:"title",surface:"table",collectionContextStore:t,disableHorizontalEdgeScroll:!0})};t.registerCallbackForItemMounted(e,r)}}(e,a,c,t),styles:{height:xn().wc}}):null}const Am=[];function Mm({args:e,schema:t,disabled:o,collectionContextStore:n,blockPropertyValueOverlayStore:i,showTablePropertyFormatsStore:l,canEdit:a,format:s,groupFormat:c,titleColumnIndex:d,paddingLeft:u,paddingRight:p,headerWidth:m,shouldShowShimmer:S}){const h=(0,k().K8)((()=>n.collectionViewStore()),[n]),{groupsPointer:y}=e,v=(0,k().K8)((()=>n.groupsStore.getGroupState(y)),[n,y]),f=(0,k().O$)(l),b=(0,k().K8)((()=>!a&&g().A.isMobile&&!(null!=h&&h.isSyncedCollection())),[a,h]),x=(0,k().O$)(n.isInHomeWidgetStore),w=(0,k().K8)((()=>{const e=n.collectionViewBlockStore();return!(!e||n.isFullScreenStore.state)&&(0,fu().d1)(e)}),[n]),C=(0,k().K8)((()=>(0,Pt().v2)(c,n)),[c,n]),I=(0,k().K8)((()=>n.isUnlistedViewStore.state&&n.isInlineViewStore.state),[n]),T=(0,k().K8)((()=>{const e=xu().A.state;if(e.isActive)return(0,te().yR)(e.selection,f.length,C.length)}),[C,f]),j=Am,A=f,M=(0,k().K8)((()=>n.getIsInDashboardBuildMode()),[n]),P=(0,k().K8)((()=>{const e=n.permissionScopesStore.state;return e.isLocked||!e.canConfigureCollection||!e.canConfigureBlock}),[n.permissionScopesStore]),_=(0,r.useMemo)((()=>({schema:t,collectionContextStore:n,propertyFormats:f,onPropertyTab:e.onPropertyTab,onPropertyUntab:e.onPropertyUntab,onPropertyEnter:e.onPropertyEnter,onPropertyClick:e.onPropertyClick,onPropertyEsc:e.onPropertyEsc,onPropertyBgClick:e.onPropertyBgClick,onPropertyContextMenu:e.onPropertyContextMenu,onOpenProperty:e.onOpenProperty,disabled:o,blockPropertyValueOverlayStore:i,showRightActionsSpacer:!1,disableHorizontalEdgeScroll:!0,disableCellBorderRight:!1,disableLastCellBorderRight:!0,onShiftEnter:fm,titleColumnIndex:d,groupFormat:c,shouldShowMultiSelectCheckbox:!1,isInHomeWidget:x,isCollectionViewBlockSelected:w,allRows:C,isInEphemeralView:I,normalizedTableSelection:T,unfrozenIndexAddendum:0,frozenPropertyFormats:j,unfrozenPropertyFormats:A,tableWrap:!1,shouldSetCellHeight:!0,isNonEditable:P,shouldShowRightActionSpacer:!1,hasColumnVirtualizer:!1})),[C,e.onOpenProperty,e.onPropertyBgClick,e.onPropertyClick,e.onPropertyContextMenu,e.onPropertyEnter,e.onPropertyEsc,e.onPropertyTab,e.onPropertyUntab,i,n,o,j,c,w,I,x,P,T,f,t,d,A]);if(!h||!v)return null;return(0,Ge.jsx)(fa,{collectionContextStore:n,groupsPointer:y,disableRequest:!0,format:s,canDrag:b,shouldShowShimmer:S,itemProps:_,renderItem:Op,canDrop:!1,disabled:o,direction:ya.Vertical,getItemSelectableStyle:()=>({display:"flex",width:"fit-content",height:xn().wc}),shouldShowHoverMenu:!M,analyticsName:"timeline",emptyDroppableSize:0,onSelectableEnter:e.onSelectableEnter,disableScrollToRevealHorizontal:!0,blockPropertyValueOverlayStore:i,titleColumnIndex:d,nestedCreateSubitemButton:({store:e,parentStore:t,subitemPath:r,indentLevel:l})=>(0,Ge.jsx)(jm,{collectionContextStore:n,disabled:o,blockPropertyValueOverlayStore:i,store:e,parentStore:t,subitemPath:r,indentLevel:l,groupsPointer:y,paddingLeft:u}),paddingLeft:u,paddingRight:p,headerWidth:m,timelineType:"table"})}function Pm({groupFormat:e,groupsPointer:t,store:o,schema:n,collectionContextStore:i,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:a,canEdit:s,format:c,tableStore:d,paddingLeft:u,paddingRight:p,headerWidth:g,disabled:m,titleColumnIndex:S,shouldShowShimmer:h}){const y=(0,k().K8)((()=>i.collectionViewStore()),[i]),v=(0,k().K8)((()=>i.groupsStore.getGroupState(e)),[i,e]),f=(0,k().O$)(a),b=(0,r.useCallback)((o=>(0,Ge.jsx)(Mm,{schema:n,disabled:m,collectionContextStore:i,blockPropertyValueOverlayStore:l,showTablePropertyFormatsStore:a,canEdit:s,format:c,groupFormat:e,titleColumnIndex:S,paddingLeft:u,paddingRight:p,headerWidth:g,shouldShowShimmer:h,args:{...o,groupsPointer:t}})),[n,m,i,l,a,s,c,e,S,u,p,g,h,t]);return y&&v?(0,Ge.jsx)(qp,{store:o,collectionContextStore:i,minWidth:void 0,blockPropertyValueOverlayStore:l,showPropertyFormats:f,disabled:!s,disableHorizontalEdgeScroll:!0,groupFormat:e,render:b,tableStore:d,paddingLeft:u}):null}const _m=r.memo((function({store:e,tableStore:t,collectionContextStore:n,timelineState:i,format:l,schema:a,query:s,isFullScreen:c,groupBy:d,paddingLeft:u,paddingRight:p,headerWidth:g,paddingBottom:m,scrollerLeftOffset:S,isInPeekRenderer:h,isInHomeWidget:y,computedOuterHeight:v,blockPropertyValueOverlayStore:f,isRootChild:b,isReady:x,disabled:w,canEditCollectionTimeline:C,viewIsFlushToTopbar:T,groupsReducerResultStore:j,onGroupHeaderAddItem:A}){const M=(0,r.useRef)(null),P=(0,k().r6)((()=>{const e=(0,te().Ty)(l,t);return(e&&e.timeline_table_properties?e.timeline_table_properties:[]).filter((e=>e.visible))}),[l,t],{useDeepEqual:!0});(0,k().O$)(P);const _=(0,k().K8)((()=>P.state.reduce(((e,t)=>e+(t.width||0)),0)),[P]),R=(0,I().IS)((()=>({selectable:{whiteSpace:"nowrap",...!y&&{background:h?K().Tj.background.elevated:K().Tj.background.primary},paddingInlineStart:u,boxSizing:"border-box",borderInlineEnd:`1px solid ${K().Tj.border.secondaryTranslucent}`,boxShadow:K().Tj.timelineTableBoxShadow,clipPath:"polygon(0% 0%, 120% 0%, 120% 100%, 0% 100%)",width:_+u,height:y?"100%":v},tableGroupHeaderSticky:{borderInlineEnd:`1px solid ${K().Tj.border.secondaryTranslucent}`},tableGroupHeaderTransition:{borderInlineEnd:void 0},tableGroupHeader:{boxShadow:void 0}})),[y,h,u,_,v]),B=(0,k().K8)((()=>(0,te().Ty)(l,t)),[l,t]),V=(0,r.useCallback)((o=>(0,Ge.jsx)(vm,{store:e,groupFormat:o,schema:a,query:s,isInPeekRenderer:h,timelineState:i,collectionContextStore:n,blockPropertyValueOverlayStore:f,showTablePropertyFormatsStore:P,tableStore:t,paddingLeft:u,paddingRight:p,headerWidth:g,paddingBottom:m,format:B,isFullScreen:c,isRootChild:b,isReady:x,canEdit:C,disabled:w&&C})),[f,C,n,w,B,c,h,x,b,m,u,p,s,a,P,e,t,i,g]),F=(0,r.useCallback)((e=>{const t=n.permissionScopesStore.state;return(0,Ge.jsx)(Sl,{...e,height:wn().tp,paddingTop:wn().lH,stickyStyle:R.tableGroupHeaderSticky,transitionStickyStyle:R.tableGroupHeaderTransition,style:0!==e.index||T?R.tableGroupHeader:{},stickyWrapStyle:{marginBottom:wn().lH},children:0===e.index&&t.canConfigureBlock?(0,Ge.jsx)(hm,{isGrouped:!0,format:l,collectionContextStore:n,timelineState:i,isFullScreen:c,isRootChild:b}):void 0})}),[n,l,c,b,R.tableGroupHeader,R.tableGroupHeaderSticky,R.tableGroupHeaderTransition,i,T]),E=(0,r.useCallback)((()=>({})),[]),O=(0,r.useCallback)((()=>(0,Ge.jsx)(Qs,{reducerId:Bn().qK,store:e,collectionContextStore:n,disabled:w,isFullScreen:c,isRootChild:b,paddingLeft:u,paddingRight:p,headerWidth:g,stickyLeft:!1,renderGroupResults:V,getGroupStyle:E,renderHeader:F,onGroupHeaderAddItem:A,timelineType:"table",groupsResultStore:j})),[n,w,E,j,c,b,A,u,p,F,V,e,g]);return(0,Ge.jsx)("div",{style:{position:"sticky",insetInlineStart:0,height:0,width:_,zIndex:3},children:(0,Ge.jsx)(oo().Ay,{style:R.selectable,store:e,shouldShowHalo:!1,canSelect:!1,analyticsName:"timeline",children:(0,Ge.jsx)(o(725976).q,{name:"timeline-side-table",stickyHorizontally:!0,horizontalWidthLimiter:S,children:d?O():(0,Ge.jsx)(fi().b,{nodeRef:M,children:(0,Ge.jsx)("div",{ref:M,children:V(void 0)})})})})})}));var Rm=()=>o(402390);function Bm(e){const{shouldShowShimmer:t,children:o}=e,n=(0,Ml().A)(t,0,100)?"notion-shimmer-timeline-transition notion-shimmer-timeline":"notion-shimmer-timeline-transition";return(0,Ge.jsx)("div",{className:n,style:{height:"100%"},children:o})}const Vm=4,Fm=22,Em=110,Om=7,Dm=22,zm=12,Lm=4,Km=32;function Wm(e){var t;const{collectionContextStore:o,isInPeekRenderer:i,timelineState:l,query:a,schema:s}=e,c=(0,x().Y0)(),d=(0,Le().tz)(),u=(0,r.useRef)(null),{value:p}=(0,T().fJ)($t().T.formulas),g=(0,lg().I)(),m=(0,r.useCallback)((()=>{0===(new Date).getSeconds()&&g("TimelineTimeBar","TimelineTimeBar/handleSeconds")}),[g]);(0,r.useEffect)((()=>{const e=setInterval(m,1e3);return()=>clearInterval(e)}),[m]);const{primaryDisplayUnit:S,activeRangeType:h}=(0,k().K8)((()=>{const e=l.zoomLevelStore.state;return wn().eM[e]}),[l]),y=(0,wn().LH)(S),v=n().DateTime.now(),f=y?v.startOf("minute"):v.startOf("day"),b=v.startOf("minute"),w=(0,k().K8)((()=>!o.groupsStore.anyGroupHasNonEmptyResults()&&(0,Yr().iv)({collectionContextStore:o,groupsPointer:[],hasPartialResults:!1})),[o]),C=(0,x().v3)(),j=new(rm().ComputedStore)((()=>{const e=o.collectionStore();if(!e)return;const t=l.dragStateStore.state,n=l.zoomLevelStore.state,r=l.hoveredItemStore.state,i=l.dateRangePlaceholderStore.state,{activeRangeType:c}=wn().eM[n];if(!c)return;let u;if(t)u=t.temporaryValues.map((e=>(0,wn().yl)(e,"day")));else if(i.active)u=[(0,wn().yl)(i.date,"day")];else{const{stores:t}=Et().default.state,n=t.filter((t=>t.getAssociatedCollectionId()===e.id)),i=W().sb(W().oE([...n,r]));u=W().oE(i.map((e=>{const t=(0,wn().GM)({store:e,query:a,schema:s,userId:o.getCurrentUserId(),intl:d,formulasModule:p,environment:C});if(t)return(0,wn().yl)(t,"day")})))}const g=W().wq(u,(({start:e})=>e.valueOf())),m=W().Sk(u,(({end:e})=>e.valueOf()));return g&&m?{start:g.start.valueOf(),end:m.end.valueOf()}:void 0}),{debugName:"activeRangeStore"}),A=null===(t=(0,ne().Oz)(o))||void 0===t?void 0:t.background,M=(0,I().IS)((()=>({wrapper:{position:"absolute",insetInlineStart:0,top:0,width:"100%",background:A||(i?K().Tj.background.elevated:K().Tj.background.primary),boxSizing:"border-box"},controlBar:{height:fg,position:"relative",overflow:"hidden"},primaryTimeBar:{height:Km,boxShadow:`inset 0 -1px 0 0 ${K().Tj.border.primary}`,boxSizing:"border-box",position:"relative",overflow:"hidden"},stickyStyle:{outline:void 0},transitionStickyStyle:{display:"none"}})),[A,i]);return(0,Ge.jsx)(Ci().g,{stickyAttachPoint:"ceiling",nodeRef:u,stickyStyle:M.stickyStyle,transitionStickyStyle:M.transitionStickyStyle,noPlaceholder:!0,children:(0,Ge.jsxs)("div",{style:M.wrapper,ref:u,children:[(0,Ge.jsx)("div",{style:M.controlBar,children:c.isPhone?void 0:(0,Ge.jsx)(Zm,{timelineState:l})}),(0,Ge.jsxs)("div",{style:M.primaryTimeBar,children:[(0,Ge.jsx)(Bm,{shouldShowShimmer:w,children:(0,Ge.jsx)(Qm,{timelineState:l,nowTimeStartOfPrimaryDisplayUnit:f})}),"highlight_days"===h?(0,Ge.jsx)(eS,{timelineState:l,activeRangeStore:j}):void 0,(0,Ge.jsx)(Jm,{timelineState:l,time:f}),"display_range"===h?(0,Ge.jsx)(eS,{timelineState:l,activeRangeStore:j}):void 0]}),(0,Ge.jsx)(Um,{timelineState:l,time:b})]})})}function Hm(e){const{time:t,isNowIndicator:o,timelineState:n}=e,r=n.zoomLevelStore.state,{startTimestamp:i}=n.currentRangeStore.state,{primaryDisplayUnit:l,primaryDisplayUnitAlignment:a}=wn().eM[r],s=(0,wn().DY)(t,l),c=(0,wn().Vz)(t,l),d=(0,wn().w0)(r,s.valueOf()-i),u=(0,wn().w0)(r,t.valueOf()-i),p=(0,wn().w0)(r,c.valueOf()-i)-d,g=o?Lm:0;return{left:("range_start"===a?u-p/2:u)-g,width:p+2*g}}function Nm(){return{color:K().Tj.text.primary,fontSize:zm}}function Gm(){return{background:K().Tj.red.background.accentPrimary,width:Dm,height:Dm,borderRadius:Dm/2,position:"absolute",insetInlineStart:`calc(50% - ${Dm/2}px)`,top:`calc(50% - ${Dm/2}px)`}}function $m(e){const{time:t,accent:o,timelineState:n}=e,i=(0,k().O$)(n.zoomLevelStore),{left:l,width:a}=(0,k().K8)((()=>Hm({time:t,isNowIndicator:!1,timelineState:n})),[t,n]),s=(0,I().IS)((()=>({container:{position:"absolute",top:0,insetInlineStart:l,width:a,height:Km-4,display:"flex",alignItems:"start",lineHeight:Km-4+"px"},text:{fontSize:zm,margin:"0 auto"},singleColor:{color:o?K().Tj.text.primary:K().Tj.text.tertiary},twoColorDarker:{color:o?K().Tj.text.primary:K().Tj.text.secondary},twoColorLighter:{color:o?K().Tj.text.secondary:K().Tj.text.tertiary}})),[o,l,a]),c=(0,r.useMemo)((()=>{const{primaryDisplayUnit:t}=wn().eM[i],o=e.time.setLocale(ds().locale),n=(0,wn().IW)(),r=o.toFormat("t").startsWith(o.toFormat("a"));if("fifteen_minutes"===t){if(n)return(0,Ge.jsx)("span",{style:s.singleColor,children:o.toFormat("H:mm")});{const e=(0,Ge.jsx)("span",{style:{...s.twoColorDarker,paddingInlineEnd:r?void 0:3},children:o.toFormat("h:mm")}),t=(0,Ge.jsx)("span",{style:{...s.twoColorLighter,paddingInlineEnd:r?3:void 0},children:o.toFormat("a")});return r?(0,Ge.jsxs)(Ge.Fragment,{children:[t,e]}):(0,Ge.jsxs)(Ge.Fragment,{children:[e,t]})}}if("hour"===t){if(n)return(0,Ge.jsx)("span",{style:s.singleColor,children:o.toFormat("H:mm")});{const e=(0,Ge.jsx)("span",{style:{...s.twoColorDarker,paddingInlineEnd:r?void 0:3},children:o.toFormat("h")}),t=(0,Ge.jsx)("span",{style:{...s.twoColorLighter,paddingInlineEnd:r?3:void 0},children:o.toFormat("a")});return r?(0,Ge.jsxs)(Ge.Fragment,{children:[t,e]}):(0,Ge.jsxs)(Ge.Fragment,{children:[e,t]})}}return"day"===t||"week"===t?"week"===i||"bi_week"===i?(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)("span",{style:{...s.twoColorLighter,paddingInlineEnd:3},children:o.toFormat("ccccc")}),(0,Ge.jsx)("span",{style:{...s.twoColorDarker,padding:"2px 7px"},children:o.toFormat("d")})]}):(0,Ge.jsx)("span",{style:s.singleColor,children:o.toFormat("d")}):"month"===t?(0,Ge.jsx)("span",{style:s.singleColor,children:o.toFormat("M")}):void(0,H().HB)(t)}),[i,e.time,s.singleColor,s.twoColorDarker,s.twoColorLighter]);return(0,Ge.jsx)("div",{style:s.container,children:(0,Ge.jsx)("div",{style:s.text,children:c})})}function Um(e){const{time:t,timelineState:o}=e,n=(0,k().O$)(o.zoomLevelStore),i=(0,k().K8)((()=>o.currentRangeStore.state.startTimestamp),[o.currentRangeStore]),l=(0,r.useMemo)((()=>Math.floor((0,wn().w0)(n,t.valueOf()-i))),[n,t,i]),a=(0,I().IS)((()=>({container:{position:"absolute",insetInlineStart:l-Om/2+.5,top:Math.floor(Km+fg-Om/2+.5),width:Om,height:Om,background:K().Tj.red.background.accentPrimary,borderRadius:"100%"}})),[l]);return(0,Ge.jsx)("div",{style:a.container})}function qm(e){const{time:t,timelineState:o,intl:n}=e,i=(0,k().O$)(o.zoomLevelStore),l=(0,k().K8)((()=>o.currentRangeStore.state.startTimestamp),[o.currentRangeStore]),a=(0,r.useMemo)((()=>(0,wn().w0)(i,t.valueOf()-l)),[i,t,l]),s=(0,r.useMemo)((()=>{const{secondaryDisplayUnit:e}=wn().eM[i];return(0,wn().u7)((0,Rm().H)(n),t.valueOf(),e)}),[i,n,t]),c=(0,I().IS)((()=>({container:{position:"absolute",top:0,insetInlineStart:a,height:Km,color:K().Tj.text.primary,fontSize:14,fontWeight:pe().Wy.medium,verticalAlign:"middle",paddingTop:vg+(g().A.isMobile?2:7),display:"flex",alignItems:"center"}})),[a]);return(0,Ge.jsx)("div",{style:c.container,children:s},a)}function Xm({start:e,end:t,rangeWidth:o}){return e&&t?o>=Em?(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)("div",{style:Nm(),children:(0,vd().W_)(e.valueOf(),"month_day",ds().locale)}),(0,Ge.jsx)("div",{style:{flexGrow:1}}),(0,Ge.jsx)("div",{style:Nm(),children:(0,vd().W_)(t.valueOf(),"month_day",ds().locale)})]}):(0,Ge.jsxs)("div",{style:Nm(),children:[(0,vd().W_)(e.valueOf(),"month_day",ds().locale)," – ",e.month===t.month?(0,vd().W_)(t.valueOf(),"day",ds().locale):(0,vd().W_)(t.valueOf(),"month_day",ds().locale)]}):(0,Ge.jsx)("div",{style:Nm(),children:(0,vd().W_)(e.valueOf(),"month_day",ds().locale)})}function Ym(e,t,o){const n=e.setLocale(ds().locale),r=(0,wn().LH)(o),i=(0,wn().IW)();return r?i?(0,Ge.jsx)("span",{style:{color:K().Tj.red.text.accentPrimary},children:n.toFormat("H:mm")}):(0,Ge.jsx)("span",{style:{color:K().Tj.red.text.accentPrimary,paddingInlineEnd:3},children:n.toFormat("t")}):"week"===t||"bi_week"===t?(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)("span",{style:{color:K().Tj.text.tertiary,paddingInlineEnd:3},children:n.toFormat("ccccc")}),(0,Ge.jsxs)("div",{style:{position:"relative"},children:[(0,Ge.jsx)("div",{style:Gm()}),(0,Ge.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:n.toFormat("d")})]})]}):(0,Ge.jsxs)("div",{style:{position:"relative"},children:[(0,Ge.jsx)("div",{style:Gm()}),(0,Ge.jsx)("span",{style:{position:"relative",color:"white",padding:"2px 7px"},children:n.toFormat("d")})]})}function Qm({nowTimeStartOfPrimaryDisplayUnit:e,timelineState:t}){const o=(0,k().O$)(t.zoomLevelStore),{startTimestamp:r,endTimestamp:i}=(0,k().O$)(t.currentRangeStore),l=wn().eM[o],{primaryDisplayUnit:a,hidePrimaryIndicatorIntersectionOffset:s}=l,c=s||0,d=(0,k().K8)((()=>Hm({time:e,isNowIndicator:!0,timelineState:t})),[e,t]),u=d.left+c,p=d.left+d.width-c,g=[];let m=(0,wn().DY)(n().DateTime.fromMillis(r),a);const S=(0,k().K8)((()=>Hm({time:m,isNowIndicator:!1,timelineState:t})),[m,t]);for(;m.valueOf()<i;){const e=S.left+c,o=S.left+S.width-c;void 0!==s&&(u>=e&&u<=o||p>=e&&p<=o)||g.push((0,Ge.jsx)($m,{timelineState:t,time:m,accent:!1},m.valueOf()));const n=(0,wn().Vz)(m,a);m=n}return(0,Ge.jsx)(Ge.Fragment,{children:g})}function Zm({timelineState:e}){const t=(0,Le().tz)(),o=(0,k().O$)(e.zoomLevelStore),{startTimestamp:r,endTimestamp:i}=(0,k().O$)(e.currentRangeStore),l=wn().eM[o],{primaryDisplayUnit:a,secondaryDisplayUnit:s}=l,c=[];let d=(0,wn().DY)(n().DateTime.fromMillis(r),s);for(;d.valueOf()<i;){c.push((0,Ge.jsx)(qm,{timelineState:e,intl:t,time:d},d.valueOf()));const o=(0,wn().Vz)(d,s);d=(0,wn().zj)(o,a)}return(0,Ge.jsx)(Ge.Fragment,{children:c})}function Jm({time:e,timelineState:t}){const o=(0,k().O$)(t.zoomLevelStore),{primaryDisplayUnit:n}=wn().eM[o],{left:r,width:i}=(0,k().K8)((()=>Hm({time:e,isNowIndicator:!0,timelineState:t})),[e,t]);return(0,Ge.jsx)("div",{style:{position:"absolute",top:0,insetInlineStart:r,width:i,height:Km-4,display:"flex",alignItems:"center",fontWeight:500},children:(0,Ge.jsx)("div",{style:{fontSize:zm,margin:"0 auto",display:"flex"},children:Ym(e,o,n)})},r)}function eS({timelineState:e,activeRangeStore:t}){const o=(0,k().O$)(e.zoomLevelStore),{startTimestamp:r,endTimestamp:i}=(0,k().O$)(e.currentRangeStore),l=wn().eM[o],{activeRangeType:a}=l,s=(0,k().O$)(t);if(s){const t=(0,wn().DY)(n().DateTime.fromMillis(s.start),"day"),l=(0,wn().w0)(o,t.valueOf()-r);if("highlight_days"===a){const a=[];let c=n().DateTime.fromMillis(Math.max(t.valueOf(),(0,wn().DY)(n().DateTime.fromMillis(r),"day").valueOf()));for(;c.valueOf()<s.end&&c.valueOf()<i;){a.push(c);c=(0,wn().Vz)(c,"day")}const d=(0,wn().w0)(o,c.valueOf()-r)-l+2*Vm,u=a.map(((t,o)=>(0,Ge.jsx)($m,{timelineState:e,time:t,accent:0===o||o===a.length-1},`${t.toString()}-${o}`)));return(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)("div",{style:{position:"absolute",top:0,insetInlineStart:l-Vm,width:d,marginTop:(Km-Fm)/2-2,height:Fm,background:K().Tj.timelineDarkerBackground,borderRadius:Fm/2}}),u]})}{const e=(0,wn().DY)(n().DateTime.fromMillis(s.end),"day"),i=(0,wn().NB)(n().DateTime.fromMillis(s.end),"day"),a=(0,wn().w0)(o,e.valueOf()-r)-l+2*Vm;return(0,Ge.jsx)("div",{style:{display:"flex",alignItems:"center",position:"absolute",top:0,insetInlineStart:l-Vm,minWidth:a,marginTop:(Km-Fm)/2-2,height:Fm,background:K().Tj.timelineDarkerBackground,borderRadius:Fm/2,paddingInlineStart:6,paddingInlineEnd:6},children:(0,Ge.jsx)(Xm,{start:t,end:t.valueOf()!==i.valueOf()?i:void 0,rangeWidth:a})})}}return null}const tS=r.memo(r.forwardRef((function({store:e,collectionContextStore:t,query:n,schema:i,format:l,paddingLeft:a,paddingRight:s,isFullScreen:c,isPreviewing:d,isRootChild:u,disabled:p,isInPeekRenderer:m,paddingBottom:h,showHoverActionsStore:y,blockPropertyValueOverlayStore:v,headerWidth:b},T){const j=(0,Le().tz)(),A=function({isFullScreen:e,isRootChild:t}){const[o]=(0,r.useState)((()=>(0,wn().o8)({isFullScreen:e,isRootChild:t})));return o}({isFullScreen:c,isRootChild:u}),M=(0,x().v3)(),P=(0,r.useContext)(Do().w);(0,w().l)((()=>{const e=t.collectionViewStore();e&&og().n_({timelineState:A,environment:M,collectionViewStore:e,collectionContextStore:t}),(0,ng().iH)(M,(0,ng().ZR)({environment:M,collectionContextStore:t,timelineState:A,isFullScreen:c,isRootChild:u}))})),function({collectionContextStore:e,query:t,schema:o,environment:n}){(0,r.useEffect)((()=>{const r=e.collectionStore();if(r&&!t.timeline_by&&r.isDefined()){const t=e.permissionScopesStore.state,r=e.collectionStore();if(!r||!r.isDefined())return;const i=e.collectionViewStore();if(!i||!t.canConfigureBlock)return;et().createAndCommit({userAction:"Timeline.updateTimelineBy",environment:n,canUndo:!0,perform:e=>{let t;const l=ne().HG(o);l&&((0,Vi().f)({collectionViewStore:i,update:{timeline_by:l},transaction:e}),He().zv({store:i,data:{type:"timeline"},transaction:e}),t&&(0,ec().F)({environment:n,collectionStore:r,update:t,transaction:e}))}})}}),[t,e,o,n])}({collectionContextStore:t,query:n,schema:i,environment:M}),function(e){(0,r.useEffect)((()=>{const t=()=>{io().A.state&&e.hoveredItemStore.setState(void 0)};return io().A.addListener(t),()=>{io().A.removeListener(t)}}),[e])}(A),function({environment:e,collectionContextStore:t,timelineState:o,isFullScreen:n,isRootChild:i}){(0,r.useEffect)((()=>{const r=o.drawStateStore.state;if(null!=r&&r.tryToCompleteDrawnArrow){(0,wn().tH)(t)&&et().createAndCommit({userAction:"TimelineItemDependencyDrawHandle.completeUserDrawnArrow",environment:e,canUndo:!0,perform:r=>{og().sd({timelineState:o,environment:e,transaction:r,collectionContextStore:t,isFullScreen:n,isRootChild:i})}})}}))}({environment:M,collectionContextStore:t,timelineState:A,isFullScreen:c,isRootChild:u}),(0,C().X)((()=>{A.destroyed=!0,A.outerSizeObserver.destroy(),A.timelineSizeObserver.destroy(),A.horizontalScroller&&(A.horizontalScroller.scrollLeft=0,(0,f().O)(A.horizontalScroller,"scroll",z))}));const _=(0,k().uB)(void 0,cu),R=(0,k().uB)(void 0,rg),B=(0,k().O$)(t.isInHomeWidgetStore),V=(0,r.useCallback)((()=>{const{horizontalScroller:e,outerSizeObserver:t}=A;if(!e)return;const o=A.zoomLevelStore.state,{startTimestamp:n,endTimestamp:r}=A.currentRangeStore.state,i=e.scrollLeft,l=(0,wn().Ul)(i,e.scrollWidth,e.clientWidth),a=t.rect.state.width,s=(0,wn().w0)(o,r-n),c=(0,wn().o$)(A);if(l<wn().XK){const e=-(0,wn().C1)(o,wn().E6);A.currentRangeStore.setState({startTimestamp:n+e,endTimestamp:r+e}),og().k3({timelineState:A,environment:M,zoomLevel:o,centerTimestamp:c})}else if(l+a>s-wn().XK){const e=(0,wn().C1)(o,wn().E6);A.currentRangeStore.setState({startTimestamp:n+e,endTimestamp:r+e}),og().k3({timelineState:A,environment:M,zoomLevel:o,centerTimestamp:c})}}),[A,M]),E=(0,_l().U)(V,200),O=(0,k().K8)((()=>Boolean(t.remoteErrorStore.state&&!t.remoteResultStore.state)),[t]),D=(0,r.useRef)(!1),z=(0,r.useCallback)((()=>{const{horizontalScroller:e,savePreference:t}=A;if(!e)return;const o=e.scrollLeft,n=(0,wn().Ul)(o,e.scrollWidth,e.clientWidth),r=A.scrollLeftStore.state;M.device.isIOS&&void 0!==r&&0===n&&r>wn().XK?e.scrollLeft=((0,uu().A1)()?-1:1)*r:(t&&t(),A.scrollLeftStore.setState(n),(0,wn().nS)(M,P)?E():V())}),[A,M,E,V,P]),L=(0,r.useCallback)((()=>{const{startTimestamp:e,endTimestamp:t}=A.currentRangeStore.state;og().bu({timelineState:A,centerTimestamp:(e+t)/2})}),[A]),W=(0,r.useRef)(null),H=(0,r.useCallback)((e=>{if(e){W.current=e;const{outerSizeObserver:t}=A;t.observe(e);const o=(0,F().T8)(e);o&&(A.horizontalScroller=o,(0,S().P)(o,"scroll",z),D.current=!0,L())}}),[z,L,A]);(0,r.useEffect)((()=>{if(O&&D.current){if(!A.horizontalScroller)return;(0,f().O)(A.horizontalScroller,"scroll",z),D.current=!1,A.horizontalScroller.scrollLeft=0}if(!O&&!D.current){if(!W.current)return;const e=A.horizontalScroller;e&&((0,S().P)(e,"scroll",z),D.current=!0,L())}}),[O,L,D,z,A]);const N=(0,k().K8)((()=>t.viewIsFlushToTopbar()),[t]),G=(0,r.useRef)(null),$=(0,k().K8)((()=>{const e=A.zoomLevelStore.state,{startTimestamp:t,endTimestamp:o}=A.currentRangeStore.state;return(0,wn().w0)(e,o-t)}),[A]),U=(0,k().K8)((()=>!d&&(0,wn().Od)({environment:M,isRootChild:u,isFullScreen:c,format:l})?wn().HV:a),[d,u,c,l,a,M]),q=(0,k().K8)((()=>(0,wn().Ho)({environment:M,paddingLeft:U,format:l,isFullScreen:c,isRootChild:u})),[M,l,c,u,U]);(0,Uu().b)(o(403750).A,(()=>({getNode:()=>G.current,customizeEdgeScrollRect(e){const t=q;return Qc().z8.from({top:e.top,height:e.height,left:e.left+t,width:e.width-t})}})),[q]),(0,r.useImperativeHandle)(T,(()=>({addBlockToView({store:e,transaction:o}){const r=e.getAssociatedCollectionStore()??t.collectionStore();if(r)return og().$N({environment:M,store:e,timelineState:A,query:n,collectionStore:r,collectionContextStore:t,groupFormat:void 0,transaction:o})}})));const X=(0,k().K8)((()=>(0,wn().iw)({environment:M,format:l,isFullScreen:c,isRootChild:u})),[M,l,c,u]),Y=(0,k().K8)((()=>Boolean(t.normalizedFormatStore.state.collection_group_by)),[t.normalizedFormatStore]),Z=(0,k().K8)((()=>t.groupsStore.anyGroupHasResults()),[t]),ee=(0,k().K8)((()=>Boolean(t.viewsModuleContextStore.getViewModuleType())),[t]),te=(0,Ue().Zp)(),oe=(0,k().K8)((()=>ne().mM(t,c)),[t,c]),re=(0,k().K8)((()=>{const{timelineSizeObserver:e}=A,o=(e.rect.state.height||120)+h+(c?0:72)+(!c&&X?28:0)+(c&&g().A.isMobile?72:0);return t.groupsStore.getAllGroupStates().every((e=>0===e.resultsStore.state.length))?Math.max(o,144+(0,wn().Zk)(Y)):o}),[A,h,c,X,Y,t.groupsStore]),ie=function(e,t){const o=(0,Qt().bx)(e,!1);return(0,k().K8)((()=>{const e=t.permissionScopesStore.state;return o&&!e.isSyncedCollection}),[o,t])}(e,t),le=(0,r.useCallback)((e=>{if(e){const{timelineSizeObserver:t}=A;t.observe(e)}}),[A]),ae=(0,r.useCallback)(((e,o,n)=>{if(g().A.isMobile)(0,El().u)({environment:M,store:e,pageVisitSource:de().y8.Create});else{const{groupFormat:o}=n,r=o?[o]:[],i=t.groupsStore.getGroupState(r),l="collectionTypedView"===t.contextTypeFromStoreState;(0,Kr().V)({environment:M,store:e,peekMode:ne().hH(t),showMoveTo:l,resultsStore:null==i?void 0:i.resultsStore,collectionContextStore:t,pageVisitSource:de().y8.Create})}}),[M,t]),se=(0,r.useCallback)((e=>{const o=t.isLoadingStore.state,n=t.groupsStore.getGroupState([]);if(!n)return;const r=n.reducerResultStore.state;e<Mo().B.incrementScrollOffset&&r&&!o&&r.hasMore&&(0,Vl().H)({collectionContextStore:t,environment:M,incrementLimitArgs:{isFullScreen:c,currentResultCount:r.blockIds.length,groupsPointer:[],incrementLimitsInRelatedGroups:!1}})}),[t,M,c]),ce=(0,r.useCallback)((()=>{const e=t.collectionStore();if(e&&!n.timeline_by&&e.isDefined()){const e=t.permissionScopesStore.state,o=t.collectionStore();if(!o||!o.isDefined())return;const n=t.collectionViewStore();if(!n||!e.canConfigureBlock)return;et().createAndCommit({userAction:"Timeline.createTimelineProperty",environment:M,canUndo:!0,perform:r=>{let l,a=ne().HG(i);if(!a&&e.canConfigureCollection){a=(0,td().Ay)();l={[a]:{name:j.formatMessage({id:"database.timelineView.dateProperty.defaultName",defaultMessage:"Date"}),type:"date"}}}if(!a)return;(0,Vi().f)({collectionViewStore:n,update:{timeline_by:a},transaction:r});const s=t.settingsStore;(0,J().O)({collectionContextStore:t,collectionSettingsStore:s}),Q().a2({collectionSettingsStore:s,item:{type:"property",property:a,formatKey:void 0,selectNameInitial:!0}}),He().zv({store:n,data:{type:"timeline"},transaction:r}),l&&(0,ec().F)({environment:M,collectionStore:o,update:l,transaction:r})}})}}),[n,t,i,M,j]),ue=(0,I().IS)((()=>({container:{position:"relative",float:"inline-start",minWidth:"100%",width:$,...B?{}:{background:m?K().Tj.peekTimelineBackground:K().Tj.timelineBackground},...!c&&!X&&!B&&{borderBottom:`1px solid ${K().Tj.border.primary}`},...(!Z||B)&&{minHeight:150},...c&&{paddingBottom:h},height:B?"100%":re}})),[re,c,B,m,Z,h,$,X]),{timeline_by:pe}=n;if(!pe)return(0,Ge.jsx)(ig,{collectionContextStore:t,isFullScreen:c,paddingBottom:h,createDateProperty:ce});const ge=i[pe];return ge&&(0,Zc().$)(ge)?(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)("div",{ref:H}),N||d?void 0:(0,Ge.jsx)("div",{style:{height:4}}),(0,Ol().A)((o=>(0,Ge.jsx)(fi().b,{nodeRef:G,width:$,clipLeftExtra:q||(c?0:U),children:(0,Ge.jsx)("div",{style:ue.container,className:fn().dBr,ref:G,...o,children:(0,Ge.jsxs)(oo().Ay,{store:e,analyticsName:"timeline",shouldShowHalo:!c&&!B&&!d,canSelect:!c&&!ee,disablePointerEvents:null==te?void 0:te.disableContentPointerEvents,style:B?{height:"100%"}:{},children:[(0,Ge.jsx)(sg,{timelineState:A}),(0,Ge.jsxs)("div",{style:{position:"absolute",width:"100%",zIndex:0,top:wn().jI},ref:le,children:[(0,Ge.jsx)(mm,{store:e,schema:i,query:n,showTable:X,collectionContextStore:t,timelineState:A,disabled:p,isFullScreen:c,isRootChild:u,isInPeekRenderer:m,paddingLeft:U,paddingRight:s,groupsReducerResultStore:R,format:l,canEditCollectionTimeline:ie,isReady:Z,blockPropertyValueOverlayStore:v,tableStore:_,scrollerLeftOffset:q,onGroupHeaderAddItem:ae,headerWidth:b}),(0,Ge.jsx)(Og,{timelineState:A,disabled:p,isReady:Z,renderEmitter:t.renderEmitter,isFullScreen:c,isRootChild:u})]}),(0,Ge.jsx)(Wm,{isInPeekRenderer:m,timelineState:A,query:n,schema:i,scrollerLeftOffset:q,collectionContextStore:t,showTable:X}),null!=te&&te.disableContentPointerEvents?void 0:(0,Ge.jsx)(bg,{timelineState:A,isInPeekRenderer:m,paddingLeft:U,paddingRight:!c&&u?8:s,format:l,scrollerLeftOffset:q,isFullScreen:c,isRootChild:u,showTable:X,collectionContextStore:t,isReady:Z}),X?(0,Ge.jsx)(_m,{store:e,collectionContextStore:t,groupBy:l.collection_group_by,paddingLeft:U,disabled:p,isFullScreen:c,isRootChild:u,format:l,schema:i,query:n,tableStore:_,scrollerLeftOffset:q,isInPeekRenderer:m,paddingRight:s,paddingBottom:h,isInHomeWidget:B,computedOuterHeight:re,timelineState:A,blockPropertyValueOverlayStore:v,viewIsFlushToTopbar:N,isReady:Z,canEditCollectionTimeline:ie,groupsReducerResultStore:R,onGroupHeaderAddItem:ae,headerWidth:b}):void 0,(0,Ge.jsx)("div",{style:{paddingTop:wn().jI,pointerEvents:"none"},children:(0,Ge.jsx)(Sm,{store:e,collectionContextStore:t,disabled:p,isFullScreen:c,paddingLeft:U,paddingRight:s,headerWidth:b,isRootChild:u,format:l,groupsReducerResultStore:R,canEditCollectionTimeline:ie,onGroupHeaderAddItem:ae,showTable:X})}),oe?void 0:(0,Ge.jsx)(Bl().A,{onChange:se})]})})})))]}):(0,Ge.jsx)(ig,{collectionContextStore:t,isFullScreen:c,paddingBottom:h,createDateProperty:ce})})));const oS=new(T().O2)("CollectionChartView",(async()=>await Promise.all([o.e(9773),o.e(36556),o.e(40537),o.e(37571),o.e(62475),o.e(3151),o.e(98629),o.e(42838),o.e(38293),o.e(39986),o.e(53352),o.e(93980),o.e(22)]).then(o.bind(o,409274)))),nS=(0,T()._h)(oS,(e=>e.CollectionChartView)),rS=new(T().O2)("CollectionFormEditorView",(async()=>await Promise.all([o.e(35530),o.e(9773),o.e(36556),o.e(40537),o.e(44711),o.e(53321),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(14578),o.e(46414),o.e(37384),o.e(72659),o.e(94995),o.e(69668),o.e(60713),o.e(23133)]).then(o.bind(o,890032)))),iS=(0,T()._h)(rS,(e=>e.CollectionFormEditorView));var lS=()=>o(753851);const aS=r.memo((function({store:e,collectionViewStore:t,isDisabled:n,isFullScreen:i,isInPeekRenderer:l,isPreviewing:s,isRootChild:c,paddingLeft:u,paddingRight:p,paddingBottom:g,headerSizeObserver:m,viewType:S,timelineViewRef:h,showHoverActionsStore:y,isInFrameWhenSidePeekOpen:v,query:f,schema:b,format:w,maxHeight:C,placementStore:I,templatePickerMenuListStore:T,editorContentContainerRef:j}){const A=(0,_t().ET)(),M=(0,k().O$)(A.shouldShowSpinnerStore),[P,_]=(0,k().K8)((()=>["collectionSystemView"===A.contextTypeFromStoreState,A.isInHomeWidgetStore.state]),[A]),R=(0,k().K8)((()=>(0,ql().b)({collectionContextStore:A})),[A]),B=(0,In().X)(A),V=P&&!B&&!R||n;(0,d().X)("can_create_pages_in_collection_permission")&&A.isFullyNonInteractiveStore.setState(V);const F=!(0,Qt().bx)(e,V),E=(0,k().K8)((()=>nn({store:e,collectionViewStore:t,collectionContextStore:A})),[e,t,A]),O=!(0,Qt().bx)(E,P);(0,r.useEffect)((()=>{"rendered"!==a().default.state.renderPhase&&a().default.setPageRendered()}),[]);const D=function({isFullScreen:e,viewType:t,isInFrameWhenSidePeekOpen:n,isInHomeWidget:r,isInPeekRenderer:i,isPreviewing:l,isRootChild:a,isMyMeetings:s,store:c}){const d=(0,x().v3)();return(0,k().K8)((()=>{const{device:u}=d,p=u.isPhone,g=("gallery"===t||("calendar"===t||"list"===t)&&e)&&n,m=(0,no().zo)(d,i),S=ve().default.state;return r||l||s?void 0:e||a?p?`calc(100% - ${2*(0,lS().F)(d)}px - ${m}px)`:i?`calc(100% - ${2*ve().PeekModePadding.horizontal[S.mode]}px - ${m}px)`:n?(0,no().Uh)(d)+(g?(0,no().Ql)(d):0):e?`calc(100% - ${2*(0,o(103018).W)(d)}px - ${m}px)`:(0,he().Ck)(c,void 0,u)?`calc(100% - ${2*(0,lS().F)(d)}px - ${m}px)`:he().x6-2*(0,lS().F)(d)-m:`calc(100% - ${m}px)`}),[d,t,e,n,i,r,l,a,s,c])}({isFullScreen:i,viewType:S,isInFrameWhenSidePeekOpen:v,isInHomeWidget:_,isInPeekRenderer:l,isPreviewing:s,isRootChild:c,isMyMeetings:B,store:e}),z=l?_n().A:Pn().A,L=(0,k().K8)((()=>m.rect.state.width),[m.rect]);return"table"===S?(0,Ge.jsx)(Zp,{schema:b,format:w,query:f,store:e,collectionContextStore:A,showHoverActionsStore:y,isFullScreen:i,isInPeekRenderer:l,isPreviewing:s,paddingLeft:u,paddingRight:p,minWidth:D,paddingBottom:g,disabled:F,blockPropertyValueOverlayStore:z,isRootChild:c,placementStore:I,headerWidth:L},t.id):"board"===S?(0,Ge.jsx)(Yc,{schema:b,format:w,query:f,store:e,collectionContextStore:A,isFullScreen:i,isInPeekRenderer:l,isPreviewing:s,paddingLeft:u,paddingRight:p,paddingBottom:g,disabled:F,blockPropertyValueOverlayStore:z,isRootChild:c,headerWidth:L},t.id):"page"===S?E?(0,Ge.jsx)(sS,{targetStore:E,collectionViewStore:t,disabled:O,templatePickerMenuListStore:T,isFullScreen:i,editorContentContainerRef:j}):null:"calendar"===S?(0,Ge.jsx)(Hd,{schema:b,format:w,query:f,store:e,collectionContextStore:A,isFullScreen:i,isInPeekRenderer:l,isPreviewing:s,paddingLeft:u,paddingRight:p,maxHeight:C,minWidth:D,paddingBottom:g,disabled:F,blockPropertyValueOverlayStore:z,isRootChild:c,headerWidth:L},t.id):"list"===S?(0,Ge.jsx)(ru,{schema:b,format:w,query:f,store:e,collectionContextStore:A,isFullScreen:i,isInPeekRenderer:l,isPreviewing:s,paddingLeft:u,paddingRight:v&&!_?24:p,minWidth:D,paddingBottom:g,disabled:F,blockPropertyValueOverlayStore:z,isRootChild:c,headerWidth:L},t.id):"gallery"===S?(0,Ge.jsx)(Os,{schema:b,format:w,query:f,store:e,collectionContextStore:A,isFullScreen:i,isInPeekRenderer:l,isPreviewing:s,paddingLeft:u,paddingRight:p,paddingBottom:g,headerWidth:L,minWidth:D,disabled:F,blockPropertyValueOverlayStore:z,isRootChild:c},t.id):"timeline"===S?(0,Ge.jsx)(tS,{schema:b,format:w,query:f,store:e,collectionContextStore:A,isFullScreen:i,isRootChild:c,isInPeekRenderer:l,isPreviewing:s,minWidth:D,paddingBottom:g,disabled:F,blockPropertyValueOverlayStore:z,showHoverActionsStore:y,ref:h,paddingLeft:u,paddingRight:p,headerWidth:L},t.id):"form_editor"===S?(0,Ge.jsx)(cS,{collectionViewStore:t,collectionContextStore:A,paddingLeft:u,paddingRight:p},t.id):"chart"===S?(0,Ge.jsx)(dS,{collectionViewStore:t,isPreviewing:s,paddingLeft:u,paddingRight:p,headerSizeObserver:m,collectionContextStore:A}):"dashboard"===S?(0,Ge.jsx)(Gd,{collectionContextStore:A,paddingLeft:u,paddingRight:p},t.id):"feed"===S?(0,Ge.jsx)(o(732430).jS,{collectionViewStore:t,collectionContextStore:A,blockPropertyValueOverlayStore:z,paddingLeft:u,paddingRight:p,paddingBottom:g,disabled:F}):"teamspace_directory"===S?(0,Ge.jsx)(o(525271).W,{collectionViewStore:t,collectionContextStore:A,paddingLeft:u,paddingRight:p,disabled:F}):"library_external_pages"===S?(0,Ge.jsx)(Mn,{collectionViewStore:t,collectionContextStore:A,paddingLeft:u,paddingRight:p,disabled:F}):"map"===S?(0,Ge.jsx)(o(495748).wC,{collectionContextStore:A,paddingLeft:u,paddingRight:p,query:f,format:w,schema:b,store:e,renderGroupResults:e=>(0,Ge.jsx)(fa,{disabled:!1,canDrag:!1,canDrop:!1,direction:ya.Vertical,collectionContextStore:A,format:w,groupsPointer:[],shouldShowHoverMenu:!1,emptyDroppableSize:0,analyticsName:"map",paddingLeft:u,paddingRight:p,headerWidth:L,shouldShowShimmer:M,...e})}):null}));function sS({targetStore:e,collectionViewStore:t,disabled:o,templatePickerMenuListStore:n,isFullScreen:r,editorContentContainerRef:i}){const l=(0,_t().ET)(),a=(0,k().K8)((()=>l.collectionStore()),[l]);return(0,Ge.jsx)(hn,{canEdit:!o,disabled:o,store:e,collectionViewStore:t,templatePickerMenuListStore:n,collectionStore:a,isFullScreen:r,editorContentContainerRef:i})}const cS=r.memo((function({collectionViewStore:e,collectionContextStore:t,paddingLeft:n,paddingRight:r}){const i=(0,I().IS)((()=>({disabledBuilderWrapper:{minHeight:void 0,height:void 0,marginTop:120-ac().l1,marginBottom:120-ac().l1,padding:0,paddingInlineStart:n,paddingInlineEnd:r},disabledBuilderTitle:{fontSize:14,fontWeight:pe().Wy.regular},disabledBuilderIcon:{margin:"0 auto"},offlineErrorWrapper:{padding:0,marginInlineStart:n,marginInlineEnd:r,height:bn().iZ},offlineErrorIcon:{fill:K().Tj.text.secondary},offlineErrorTitle:{fontSize:14,color:K().Tj.text.secondary,fontWeight:void 0}})),[n,r]),l=!(0,k().O$)(j().e);return g().A.isMobile?(0,Ge.jsx)(ac().Ay,{style:i.disabledBuilderWrapper,title:(0,Ge.jsx)("span",{style:i.disabledBuilderTitle,children:(0,Ge.jsx)(Le().sA,{id:"formsInner.disabledBuilder.title",defaultMessage:"Forms can only be edited on desktop"})}),icon:(0,Ge.jsx)(ke().I,{icon:o(556402).i,size:72,colorVariant:"tertiary",style:i.disabledBuilderIcon})}):l?(0,Ge.jsx)(ac().Ay,{style:i.offlineErrorWrapper,title:(0,Ge.jsx)(Le().sA,{id:"formsInner.offlineBuilder.title",defaultMessage:"Go online to edit this form"}),titleStyle:i.offlineErrorTitle,icon:(0,Ge.jsx)(ke().I,{icon:o(553034).C,size:25,style:i.offlineErrorIcon})}):(0,Ge.jsx)(iS,{collectionContextStore:t,paddingLeft:n,paddingRight:r},e.id)}));function dS({collectionViewStore:e,isPreviewing:t,paddingLeft:o,paddingRight:n,headerSizeObserver:r,collectionContextStore:i}){const l=(0,k().K8)((()=>r.rect.state.width),[r]);return(0,Ge.jsx)(nS,{collectionContextStore:i,isPreviewing:t,headingWidth:l,paddingLeft:o,paddingRight:n},e.id)}const uS=r.memo(aS);var pS=()=>o(132855),gS=()=>o(491761),mS=()=>o(817126),SS=()=>o(991249),hS=()=>o(412236),yS=()=>o(324043),vS=()=>o(620791);const fS=(0,Le().YK)({plus:{id:"subscriptionTier.plus",defaultMessage:"Plus"},business:{id:"subscriptionTier.business",defaultMessage:"Business"},enterprise:{id:"subscriptionTier.enterprise",defaultMessage:"Enterprise"}});function bS({isFullScreen:e,paddingLeft:t,paddingRight:n,paddingBottom:r}){const i=(0,_t().ET)(),l=(0,k().K8)((()=>{const e=i.collectionStore();return null==e?void 0:e.getFormat().integration_id}),[i]),a=(0,o(462853).l)(l);return l?a?(0,Ge.jsx)(xS,{isFullScreen:e,paddingLeft:t,paddingRight:n,paddingBottom:r,integrationId:l,featureName:a}):(0,Ge.jsx)(wS,{isFullScreen:e,paddingLeft:t,paddingRight:n,paddingBottom:r,integrationId:l}):null}function xS({isFullScreen:e,paddingLeft:t,paddingRight:o,paddingBottom:n,integrationId:r,featureName:i}){const l=(0,x().v3)(),a=(0,Le().tz)(),c=(0,_t().ET)(),[u,p]=(0,k().K8)((()=>[c.settingsStore,c.collectionStore()]),[c]),g=(0,k().K8)((()=>u.state.open),[u]),m=(0,k().K8)((()=>{if(p)return p.getIcon()}),[p]),S=(0,k().K8)((()=>_().A.integrations.state.find((e=>e.id===r))),[r]),h=(0,I().IS)((()=>({integrationTitle:{fontSize:17,fontWeight:pe().Wy.medium,textAlign:"center"},upgradeDescription:{fontSize:17,fontWeight:pe().Wy.medium,textAlign:"center",color:K().Tj.text.tertiary,marginTop:12}})),[]),y=(0,mS().uF)({featureName:i,collectionStore:p}),v=(0,d().X)("upgrade_system_db_properties_automations"),f=(0,k().K8)((()=>p?(0,s().f)(p):void 0),[p]);if(!r||!S||null==y||!y.upsell)return(0,Ge.jsx)(wS,{isFullScreen:e,paddingLeft:t,paddingRight:o,paddingBottom:n,integrationId:r});const{isAvailable:b,upsell:w,upsellTier:C}=y;return"none"!==w.type&&C?b&&w?(0,Ge.jsx)(wS,{isFullScreen:e,paddingLeft:t,paddingRight:o,paddingBottom:n,integrationId:r,featureName:i}):(0,Ge.jsx)("div",{style:{paddingInlineStart:t,paddingInlineEnd:o,paddingTop:8,paddingBottom:e?void 0:n,height:250,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,Ge.jsxs)("div",{style:{paddingInlineEnd:g?bn().vE:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ge.jsx)(ge().B6,{icon:m,iconRecordCategory:"collection",size:48,disabled:!0,isEmptyPage:!1}),(0,Ge.jsx)("div",{style:h.integrationTitle,children:(0,Ge.jsx)(Le().sA,{defaultMessage:"{integrationName}",id:"collectionViewBlock.externalCollectionUpsell.title",values:{integrationName:S.name}})}),(0,Ge.jsx)("div",{style:h.upgradeDescription,children:(0,Ge.jsx)(Le().sA,{defaultMessage:"Upgrade to {subscriptionTier} to use this feature. {learnMoreLink}",id:"collectionViewBlock.externalCollectionUpsell.description",values:{subscriptionTier:a.formatMessage(fS[C]),learnMoreLink:(0,Ge.jsx)(hS().V,{})}})}),v?(0,Ge.jsx)("div",{style:{marginTop:12},children:(0,Ge.jsx)(yS().j,{source:"collection_synced_database",upsell:w,display:"button",width:"hug",spaceStore:f})}):(0,Ge.jsx)(On().A,{size:"md",iconLeading:{icon:pS().arrowInCircleUpFillIcon,size:"default",colorPalette:"blue",colorVariant:"accentPrimary"},style:{marginTop:12},onClick:()=>{SS().K(l,{from:"collection_synced_database",upsell:w,spaceStore:(0,s().f)(p)})},children:(0,Ge.jsx)(Le().sA,{defaultMessage:"Upgrade",id:"collectionViewBlock.externalCollectionUpsell.upgradeButton.label"})})]})}):(0,Ge.jsx)(wS,{isFullScreen:e,paddingLeft:t,paddingRight:o,paddingBottom:n,integrationId:r})}function wS({isFullScreen:e,paddingLeft:t,paddingRight:o,paddingBottom:n,integrationId:r,featureName:i}){const l=(0,_t().ET)(),[a,s,c]=(0,k().K8)((()=>[l.permissionScopesStore.state,l.settingsStore,l.collectionStore()]),[l]),d=(0,k().K8)((()=>s.state.open),[s]),u=(0,k().K8)((()=>{if(c)return c.getIcon()}),[c]),{isMobileBrowser:p}=(0,x().Y0)(),g=(0,k().K8)((()=>{if(!c)return!1;const e=c.getFormat().integration_id,t=_().A.integrations.state.find((t=>t.id===e));return!(!e||!t)&&(0,vS().jw)(e).length>0}),[c]),m=(0,k().K8)((()=>_().A.integrations.state.find((e=>e.id===r))),[r]);if(!m)return null;const S=!(p&&!g);return(0,Ge.jsxs)("div",{style:{paddingInlineStart:t,paddingInlineEnd:o,paddingTop:8,paddingBottom:e?void 0:n,minHeight:250,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",position:"relative",gap:32},children:[(0,Ge.jsxs)("div",{style:{paddingInlineEnd:d?bn().vE:void 0,display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Ge.jsx)(ge().B6,{icon:u,iconRecordCategory:"collection",size:48,disabled:!0,isEmptyPage:!1}),(0,Ge.jsx)("div",{style:{fontSize:17,fontWeight:pe().Wy.medium,color:K().Tj.text.tertiary,textAlign:"center",marginBottom:-2},children:(0,Ge.jsx)(Le().sA,{defaultMessage:"{integrationName}",id:"collectionViewBlock.setExternalSource.title",values:{integrationName:m.name}})}),a.canConfigureBlock?(0,Ge.jsx)("div",{style:{margin:"0 auto",width:"max-content",fontSize:14,textAlign:"center",color:K().Tj.text.tertiary},children:S?(0,Ge.jsx)(Le().sA,{defaultMessage:"<button>Link to {integrationName}</button> to continue",id:"collectionViewBlock.setExternalSourceButton.title",values:{integrationName:m.name,button:e=>(0,Ge.jsx)(ui().Ay,{style:{display:"inline",padding:"1px 2px",borderRadius:4,textDecoration:"underline"},onClick:()=>{Q().Ho({collectionSettingsStore:s})},children:e})}}):void 0}):void 0]}),i?(0,Ge.jsx)(gS().z,{featureName:i,source:"collection_synced_database",collectionContextStore:l}):null]})}const CS={viewBox:"0 0 20 20",fittedViewBox:"0.5 3.09 17.07 16.41",svg:(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)("path",{d:"M4.5 11.5a4 4 0 1 1 0 8 4 4 0 0 1 0-8m-.09 5.468a.463.463 0 1 0 0 .926.463.463 0 0 0 0-.926m.077-3.761c-.675 0-1.316.39-1.471 1.009a.331.331 0 1 0 .641.16c.062-.248.371-.508.83-.508.54 0 .846.337.846.611 0 .166-.101.346-.316.477l-.008.005-.44.3-.003.002c-.31.215-.51.563-.51.943a.331.331 0 0 0 .662 0c0-.145.077-.297.223-.398l.427-.291c.356-.22.626-.589.626-1.037 0-.769-.746-1.273-1.507-1.273"}),(0,Ge.jsx)("path",{d:"M7.09 3.099c.338 0 .658.152.872.415L9.066 4.87h5.877a2.625 2.625 0 0 1 2.625 2.625v5.755a2.625 2.625 0 0 1-2.625 2.625H9.584q.015-.186.016-.375-.001-.447-.077-.875h5.42c.76 0 1.375-.616 1.375-1.375V8.664H3.625v1.813a5 5 0 0 0-1.25.387v-6.64c0-.622.504-1.125 1.125-1.125zM3.625 7.564h12.693v-.069c0-.76-.615-1.375-1.375-1.375H9.008c-.338 0-.66-.153-.873-.415L7.03 4.35H3.625z"})]})},kS=(0,Kn().wt)("folderQuestionMark",CS,"default");function IS({viewType:e,isFullScreen:t,paddingLeft:o,paddingRight:n,paddingBottom:i}){const l=(0,x().v3)(),a=(0,_t().ET)(),s=(0,k().O$)(a.canConfigureBlockStore),c=(0,r.useMemo)((()=>({style:{paddingInlineStart:o,paddingInlineEnd:n,paddingBottom:t?void 0:i},icon:(0,Ge.jsx)(ke().I,{icon:kS,size:48,colorVariant:"tertiary",style:{margin:"0 auto"}})})),[t,i,o,n]),d=(0,r.useCallback)((()=>{!function(e,t){var o;const n=e.settingsStore,r=(null===(o=e.collectionViewBlockStore())||void 0===o?void 0:o.getCollectionViewStores())??[],i=e.collectionViewStore(),l=1===r.length&&r[0].id===(null==i?void 0:i.id)&&void 0===r[0].getCollectionStore();(0,J().O)({collectionContextStore:e,collectionSettingsStore:n}),Q().R8({collectionSettingsStore:n,item:l?{type:"createViewSource",existingCollectionStore:void 0,createdCollectionRecordPointerMap:void 0,analytics:void 0}:{type:"linkToDatabase",existingCollectionStore:void 0,analytics:void 0}}),(0,N().X)({environment:t,collectionContextStore:e,action:"click_select_data_source"})}(a,l)}),[a,l]);return s?(0,Ge.jsx)(ac().Ay,{title:e?(0,Ge.jsx)(Le().sA,{defaultMessage:"New {viewType}",id:"database.viewSettings.createView.newViewType",values:{viewType:Fl().to[e].toLocaleLowerCase()}}):(0,Ge.jsx)(Le().sA,{defaultMessage:"New view",id:"database.viewSettings.createView.newView"}),buttonText:(0,Ge.jsx)(Le().sA,{defaultMessage:"Link a data source",id:"collectionViewBlock.linkDatabase"}),buttonOnClick:d,...c}):(0,Ge.jsx)(ac().Ay,{title:(0,Ge.jsx)(Le().sA,{defaultMessage:"No data source",id:"collectionViewBlock.noSourcePlaceholder.title"}),description:(0,Ge.jsx)(Le().sA,{defaultMessage:"This block is not connected to any data source.",id:"collectionViewBlock.noSourcePlaceholder.description"}),...c})}const TS=new(T().O2)("RemoteErrorViewIfNoResults",(async()=>await o.e(73476).then(o.bind(o,979989)))),jS=(0,T()._h)(TS,(e=>e.RemoteErrorViewIfNoResults)),AS=r.memo((function({collectionContentWrapperStyle:e,collectionContextStore:t,store:o,collectionStore:n,collectionViewStore:i,showHoverActionsStore:l,viewSettingsPlacementStore:a,templatePickerMenuListStore:s,leftRightPaddingStore:c,leftRightMarginStore:d,headerHeightStore:u,currentViewType:m,query:S,schema:h,format:y,maxHeight:v,fullWidth:f,scrollerLeftPadding:b,contentEditableVoidLeft:w,additionalCollectionViewInnerHorizontalPadding:C,rootRef:T,timelineViewRef:j,editorContentContainerRef:A,headerSizeObserver:M,isDisabled:P,isFullScreen:_,isInPeek:R,isPreviewing:B,isRootOrDirectChild:V,isPlaceholderExternalCollection:F,isMyTasksEmpty:E,isInFrameWhenSidePeekOpen:O,showHomeCustomDbEmptyState:D,showMyTasksEmptyState:L,showMyTasksAddSourcesCallout:W,isInHomeWidget:N,isHomeCustomDbEmpty:G,isUnlistedView:$,isViewModule:U,handleAddItemClick:q,handleEditorClick:X,handleHorizontalScrollerMount:Y,handleEditorMouseDown:Q,handleContentMount:Z}){const J=(0,x().WS)(),ee=(0,k().K8)((()=>Boolean(null==t?void 0:t.isDashboardWidget())),[t]),te=_?(0,z().Px)(Z,T):Z,oe=(0,r.useContext)(Do().w),{paddingLeft:ne,paddingRight:re}=(0,k().K8)((()=>{var e,t;const o=C??0;return{paddingLeft:((null===(e=c.state)||void 0===e?void 0:e.paddingLeft)??0)+o,paddingRight:((null===(t=c.state)||void 0===t?void 0:t.paddingRight)??0)+o}}),[c,C]),ie=(0,k().K8)((()=>"collectionSettings"===t.contextTypeFromStoreState?0:_?"timeline"===m?96:g().A.isMobile?90:180:"timeline"===m||"gallery"===m?0:$?16:oe),[t,_,m,$,oe]),le=(0,k().K8)((()=>function(e){switch(e){case"chat":case"custom":case"page":case"dashboard":case"teamspace_directory":case"library_external_pages":return!1;case"table":case"board":case"calendar":case"list":case"gallery":case"timeline":case"chart":case"feed":case"map":case"form_editor":return!0;default:(0,H().HB)(e)}}(m)&&t.hasSingleCollection()),[m,t]),[ae,se,ce]=(0,k().K8)((()=>[null==n?void 0:n.isReady(),null==n?void 0:n.isDefined(),null==n?void 0:n.canRead()]),[n]),de=(0,I().eP)(),ue=(0,k().K8)((()=>{var e;return null===(e=i.getCollectionSource())||void 0===e?void 0:e.type}),[i]),pe=_||B||ee,ge="custom"===m,me="myMeetings"===ue,Se=(0,k().K8)((()=>{var o,n;const r={flexGrow:1,flexShrink:0,display:"flex",flexDirection:"column",position:"relative",marginInlineStart:null===(o=d.state)||void 0===o?void 0:o.marginLeft,marginInlineEnd:null===(n=d.state)||void 0===n?void 0:n.marginRight,...!_&&!B&&{...b&&{marginInlineStart:-b},maxHeight:v?v-u.state:"inherit",...N&&t.isEditableHomeCollectionStore.state||me?{...(0,Jt().V$)({isPhone:J,themeMode:de}),paddingInline:16}:{},width:f,insetInlineStart:w},...e};return{shimmer:{backgroundColor:K().Tj.largeShimmerColor,height:48,marginBottom:10,width:"100%"},content:r,pageViewContent:{...r,position:void 0,marginInlineStart:void 0,maxWidth:"100%"},contentInner:pe?{...ge&&{height:"100%"}}:{position:"relative",...N?{height:"100%",maxHeight:"inherit"}:{},...ge&&{height:"100%"}},myTasksAddSourcesCalloutContainer:{height:221}}}),[pe,d,_,B,b,v,u,N,t.isEditableHomeCollectionStore,J,de,f,w,e,ge,me]),he=(0,k().K8)((()=>t.settingsStore.state.open),[t]);return(0,Ge.jsx)(Oo().A,{name:"CollectionViewBlockContent",children:(()=>{if(le){if(!n)return ee&&he?(0,Ge.jsx)(p().s,{ref:te,allowSelectionWithin:!1,style:Se.content}):(0,Ge.jsx)(p().s,{ref:te,allowSelectionWithin:!1,style:Se.content,children:(0,Ge.jsx)(IS,{viewType:m,isFullScreen:_,paddingLeft:ne,paddingRight:re,paddingBottom:ie})});if(!ae)return(0,Ge.jsx)(p().s,{ref:te,allowSelectionWithin:!1,style:Se.content,children:(0,Ge.jsx)("div",{style:Se.shimmer,children:(0,Ge.jsx)(zo().P,{emphasized:!1,style:Se.shimmer})})});if(!se)return ce?(0,Ge.jsx)(p().s,{ref:te,allowSelectionWithin:!1,style:Se.content,children:(0,Ge.jsx)(IS,{viewType:m,isFullScreen:_,paddingLeft:ne,paddingRight:re,paddingBottom:ie})}):(0,Ge.jsx)(p().s,{ref:te,allowSelectionWithin:!1,style:Se.content,children:(0,Ge.jsx)(on().P2,{collectionStore:n,paddingLeft:ne,paddingRight:re})})}if(F)return(0,Ge.jsx)(p().s,{ref:te,allowSelectionWithin:!1,style:Se.content,children:(0,Ge.jsx)(bS,{isFullScreen:_,paddingLeft:ne,paddingRight:re,paddingBottom:ie})});if(E&&"calendar"!==m)return(0,Ge.jsx)(p().s,{ref:te,allowSelectionWithin:!1,style:Se.content,children:(0,Ge.jsx)(tn,{collectionContextStore:t,onAddTaskClick:q,from:N?"home_tile_tasks":"home_tasks"})});if(W)return(0,Ge.jsx)(p().s,{ref:te,allowSelectionWithin:!1,style:Se.content,children:(0,Ge.jsx)("div",{style:Se.myTasksAddSourcesCalloutContainer,children:(0,Ge.jsx)(Zt().Kk,{collectionContextStore:t,paddingLeft:ne,paddingRight:re})})});if(D)return(0,Ge.jsx)(p().s,{ref:te,allowSelectionWithin:!1,style:Se.content,children:(0,Ge.jsx)(Zt().Y8,{collectionContextStore:t,onAddItemClick:q,from:N?"home_tile_custom_db":"home_custom_db"})});const e=(0,Ge.jsx)(uS,{store:o,collectionViewStore:i,viewType:m,isDisabled:P,isFullScreen:Boolean(_),isInPeekRenderer:R,isPreviewing:B,isRootChild:V,paddingLeft:ne,paddingRight:re,paddingBottom:ie,headerSizeObserver:M,timelineViewRef:j,showHoverActionsStore:l,isInFrameWhenSidePeekOpen:O,query:S,schema:h,format:y,maxHeight:v,placementStore:a,templatePickerMenuListStore:s,editorContentContainerRef:A}),r=L?e:(0,Ge.jsx)(jn,{store:o,paddingLeft:b,isPreviewing:B,isFullScreen:Boolean(_),currentViewType:m,isInPeek:R,isInHomeWidget:N,isUnlistedView:$,viewSettingsPlacementStore:a,format:y,isMyTasksEmpty:E,isHomeCustomDbEmpty:G,isInFrameWhenSidePeekOpen:O,handleEditorMouseDown:Q,isRootOrDirectChild:V,leftRightPaddingStore:c,paddingBottom:ie,handleHorizontalScrollerMount:Y,handleEditorClick:X,isDashboardWidget:ee,children:e});if("page"===m)return(0,Ge.jsx)(yn,{store:o,collectionViewStore:i,isFullScreen:Boolean(_),editorContentContainerRef:A,templatePickerMenuListStore:s,isViewsModule:U,style:Se.pageViewContent});const d=(0,Ge.jsx)("div",{style:Se.contentInner,children:r});return(0,Ge.jsxs)(p().s,{ref:te,allowSelectionWithin:!0,style:Se.content,children:[(0,Ge.jsx)(jS,{collectionContextStore:t,viewType:m,maxHeight:v}),d]})})()})}));o(16280);function MS(e){const{collectionContextStore:t,headerSizeObserver:n,contentSizeObserver:i,settingsHeaderSizeObserver:l,placementStore:a,placementToOrigin:s="bottom",alignmentToOrigin:c="start",marginTop:d=-1,originGap:u,headerRef:p,handleAddItemClick:m}=e,S=(0,x().v3)(),h=(0,k().O$)(a),[y,v]=(0,r.useState)(!1),[f,b]=(0,r.useState)(!0),w=(0,k().O$)(t.isInPeekRendererStore),C=(0,k().O$)(t.isFullScreenStore),[I,T]=(0,r.useState)(!1),j=(0,k().K8)((()=>function(e){const t=e.settingsStore.state;return t.open&&!0!==t.hideSettingsPopup}(t)),[t]),A=(0,k().K8)((()=>function(e){var t;const o=null===(t=e.collectionViewStore())||void 0===t?void 0:t.getType();if(!o)throw new Error("View type was not defined.");return o}(e.collectionContextStore)),[e.collectionContextStore]),M=(0,k().K8)((()=>{const e=n.rect.state;return 0!==e.width?(0,ee().wW)(t,g().A.isMobile,e.width):"popup"}),[t,n.rect]);(0,r.useEffect)((()=>{j&&(n.recompute(),l.recompute(),a.setState(M)),j&&!C&&"form_editor"!==A&&(v(!0),b(!1))}),[j,C,a,n,l,A,M]);const P=(0,k().K8)((()=>function(e){var t;return null===(t=e.settingsStore.state.ref)||void 0===t||null===(t=t.current)||void 0===t?void 0:t.getBoundingClientRect()}(t)||DOMRect.fromRect({x:(0,uu().A1)()?l.rect.state.left+2:l.rect.state.right-2,y:l.rect.state.y-2,width:0,height:l.rect.state.height})),[t,l.rect]);return(0,r.useEffect)((()=>{if(y){const e=null==p?void 0:p.current;if(e){const t=e.getBoundingClientRect();S.WindowSizeStore.state.height-t.top<bn().iZ&&((0,o(856337).v)(e,{edgeDist:0,animate:!1}),n.recompute(),l.recompute())}v(!1),b(!0)}}),[t,S.WindowSizeStore,n,l,w,y,p]),(0,r.useEffect)((()=>{T(!(!j||!f))}),[j,f]),"sidebar"===h?(0,Ge.jsx)(PS,{collectionContextStore:t,headerSizeObserver:n,contentSizeObserver:i,paddingRight:e.paddingRight,shouldScrollIntoView:y,headerHeightStore:e.headerHeightStore,settingsOpen:I,isInPeekRenderer:w}):(0,Ge.jsx)(_S,{collectionContextStore:t,placementToOrigin:s,alignmentToOrigin:c,originGap:u??0,marginTop:d,settingsOpen:I,shouldScrollIntoView:y,originRect:P,handleAddItemClick:m})}function PS(e){const{collectionContextStore:t,headerSizeObserver:o,contentSizeObserver:n,paddingRight:r,shouldScrollIntoView:i,settingsOpen:l}=e,a=(0,x().v3)(),s=(0,k().K8)((()=>{const e=o.rect.state;return a.WindowSizeStore.state.height-(e.top+go().Lq)}),[a.WindowSizeStore,o.rect]),d=(0,k().K8)((()=>n.rect.state.height),[n.rect]),u=(0,k().O$)(t.isInPeekRendererStore),p=(0,k().O$)(e.headerHeightStore),g=(0,k().K8)((()=>t.allowScrollingWhenCollectionSettingsSidebarOpen()),[t]),m=(0,I().IS)((()=>({topLevelDiv:{position:"absolute",top:p,insetInlineEnd:-r,background:u?K().Tj.background.elevated:K().Tj.background.primary,borderInlineStart:`1px solid ${K().Tj.border.primary}`,borderImage:`linear-gradient(180deg, ${K().Tj.background.primary} 0px, ${K().Tj.border.primary} 12px) 1 100%`,paddingInlineEnd:r,zIndex:88,...g?{height:d,minHeight:s}:{height:s}}})),[p,r,u,g,d,s]);return l?(0,Ge.jsx)(c().A,{capture:!0,allowMobileAutoScroll:!0,allowUndo:!0,render:e=>(0,Ge.jsx)(fe().A,{initial:{opacity:0,translateX:12},animate:{opacity:1,translateX:0},exit:{opacity:0,translateX:12},style:m.topLevelDiv,className:fn().N11,...(0,$i().A)({onMouseDown:e=>function(e,t){(0,y().SQ)(e,y().y$.EditorMouseDown,(()=>{(0,xs().clear)({environment:t})}))}(e,a)},e),children:(0,Ge.jsxs)("div",{style:{display:"flex",...g?{height:"fit-content",position:"sticky",top:0}:{height:"100%"}},children:[(0,Ge.jsx)(RS,{collectionContextStore:t,shouldScrollIntoView:i,isSidebar:!0}),(0,Ge.jsx)("div",{style:{width:r}})]})})}):null}function _S(e){const{collectionContextStore:t,placementToOrigin:o,alignmentToOrigin:n,originGap:i,marginTop:l,settingsOpen:a,shouldScrollIntoView:s,originRect:c,origin:d=(0,Ge.jsx)("div",{}),handleAddItemClick:u}=e,p=(0,r.useCallback)((e=>(0,Ge.jsx)(RS,{collectionContextStore:t,shouldScrollIntoView:s,isSidebar:e,handleAddItemClick:u})),[t,s,u]),m=function({collectionContextStore:e}){const t=(0,x().v3)(),o=(0,x().WS)(),n=(0,k().K8)((()=>t.WindowSizeStore.isLandscape()),[t.WindowSizeStore]);return(0,k().K8)((()=>"chart"===(null==e?void 0:e.getViewType())&&o&&!n),[e,o,n])}({collectionContextStore:t}),S=(0,r.useCallback)((async t=>{var o;await e.collectionContextStore.abortDismissSettings()||(null===(o=e.onDismiss)||void 0===o||o.call(e),function(e,t){Q().os({collectionSettingsStore:t.settingsStore})}(0,e.collectionContextStore))}),[e]);return(0,Ge.jsx)(we().zD,{popupType:g().A.isMobile?we().nl.BottomSheet:we().nl.Popup,bottomSheetInitialState:m?"half":"full",className:`${fn().N11} ${fn().xeF}`,open:a,placementToOrigin:o,alignmentToOrigin:n,style:{marginTop:l},origin:d,originGap:i,render:p,onDismiss:S,originRect:c,keepFocus:!0,trapFocus:!0,preventScaleTransition:!0,preventOpacityTransition:!0})}function RS({isSidebar:e,collectionContextStore:t,shouldScrollIntoView:o,handleAddItemClick:n}){const r=g().A.isMobile?ee().Bd.MobileSheet:ee().Bd.ViewSettings;return o?null:(0,Ge.jsx)(Lu().m$,{context:r,collectionContextStore:t,collectionSettingsStore:t.settingsStore,fullHeight:e,handleAddItemClick:n})}const BS=r.memo((function({store:e,leftRightPaddingStore:t,viewSettingsPlacementStore:o,headerHeightStore:n,headerSizeObserver:r,contentSizeObserver:i,settingsHeaderSizeObserver:l,currentViewType:a,isInHomeWidget:s,placementToOrigin:c,alignmentToOrigin:d,headerRef:u,handleAddItemClick:p}){const g=(0,_t().Ks)(),m=(0,k().K8)((()=>(null==g?void 0:g.isDashboardWidget())??!1),[g]),S=(0,k().K8)((()=>(0,ye().RX)(e)?{paddingLeft:0,paddingRight:0}:t.state),[t,e]),h=(0,k().K8)((()=>{var e;return void 0!==(null==g||null===(e=g.viewsModuleContextStore.getState())||void 0===e?void 0:e.viewsModule)}),[null==g?void 0:g.viewsModuleContextStore]),y="form_editor"===a,v=(0,k().K8)((()=>{var e;if(c)return c;if(!y)return;return!(null==g||!g.settingsStore.state.open)&&(0,H().Xk)(["formQuestionCreateSettings","formQuestionEditSettings"],null==g||null===(e=g.settingsStore.state.stack[0])||void 0===e?void 0:e.type)?"right":"bottom"}),[c,y,null==g?void 0:g.settingsStore]),f=d??(s?"end":void 0),b=y?"right"===v?24:12:void 0,x=(0,k().K8)((()=>(null==g?void 0:g.isInlineViewStore.state)&&(null==g?void 0:g.isUnlistedViewStore.state)),[null==g?void 0:g.isInlineViewStore,null==g?void 0:g.isUnlistedViewStore]);return h&&!m?null:S&&g?(0,Ge.jsx)(MS,{collectionContextStore:g,headerSizeObserver:r,contentSizeObserver:i,settingsHeaderSizeObserver:l,headerHeightStore:n,placementStore:o,marginTop:x?-10:void 0,placementToOrigin:v,alignmentToOrigin:f,originGap:b,headerRef:u,...S,handleAddItemClick:p}):null}));var VS=()=>o(606712);const FS=(0,Le().YK)({defaultAddViewAriaLabel:{id:"collectionViewTabBar.addView",defaultMessage:"Add view"},defaultAddViewTooltip:{id:"collectionViewTabBar.addViewTooltip",defaultMessage:"Add a new view"},linkedAddViewAriaLabel:{id:"collectionViewTabBar.linkedAddView",defaultMessage:"Add view"},linkedAddViewTooltip:{id:"collectionViewTabBar.linkedAddViewTooltip",defaultMessage:"Add a new view"},viewsModuleAddViewAriaLabel:{id:"collectionViewTabBar.viewsModuleAddView",defaultMessage:"Add tab"},viewsModuleAddViewTooltip:{id:"collectionViewTabBar.viewsModuleAddViewTooltip",defaultMessage:"Add a new tab"}}),ES=r.memo((function(e){const{renderState:t,collectionContextStore:o,preventRectangularSelection:n,variant:r}=e,i=(0,k().K8)((()=>"viewsMain"===o.viewsModuleContextStore.getViewModuleType()),[o]),l=(0,I().IS)((()=>({flex:{display:"flex"}})),[]);return t.showAddViewButton?(0,Ge.jsx)(fe().A,{visible:t.addViewButtonAnimatedIn,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:l.flex,onMouseDown:n,children:i?(0,Ge.jsx)(OS,{variant:r}):(0,Ge.jsx)(DS,{collectionContextStore:o,variant:r})}):null})),OS=r.memo((function(e){const{variant:t}=e,n=(0,Le().tz)(),i=(0,I().eP)(),l=(0,I().IS)((()=>({button:{..."pills"===t?{height:28,width:28,borderRadius:"100%"}:void 0,background:K().Tj.blue.background.secondary},hoveredButton:{color:K().Tj.blue.text.accentPrimary,background:(0,VS().R)({color:K().Tj.blue.background.secondary,mode:i})},pressedButton:{color:K().Tj.blue.text.accentPrimary,background:(0,VS().y)({color:K().Tj.blue.background.secondary,mode:i})}})),[t,i]),a=(0,r.useCallback)((()=>(0,Ge.jsx)(Le().sA,{...FS.viewsModuleAddViewTooltip})),[]),s=(0,r.useCallback)(((e,t)=>(0,Ge.jsx)(Ie().A,{ariaLabel:n.formatMessage(FS.viewsModuleAddViewAriaLabel),className:fn().Tel,icon:Ho().plusSmallIcon,colorPalette:"blue",colorVariant:"accentPrimary",style:l.button,hoveredStyle:l.hoveredButton,pressedStyle:l.pressedButton,...t,...e})),[n,l.button,l.hoveredButton,l.pressedButton]),c=(0,r.useCallback)((e=>(0,Ge.jsx)(Wo().m,{renderTooltip:a,render:t=>s(t,e)})),[s,a]);return(0,Ge.jsx)(o(621866).i,{renderOrigin:c})})),DS=r.memo((function(e){const{collectionContextStore:t,variant:o}=e,n=(0,Le().tz)(),i=(0,k().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isLinkedCollectionView()}),[t]),l=(0,I().IS)((()=>({button:{..."pills"===o?{height:28,width:28,borderRadius:"100%"}:void 0}})),[o]),a=(0,r.useCallback)((e=>(0,Ge.jsx)(Ke().zS,{collectionContextStore:t,onClose:e.close,hideAddDataSource:!1})),[t]),s=(0,r.useCallback)((()=>(0,Ge.jsx)(Le().sA,{...i?FS.linkedAddViewTooltip:FS.defaultAddViewTooltip})),[i]),c=(0,r.useCallback)(((e,t)=>(0,Ge.jsx)(Ie().A,{ariaLabel:n.formatMessage(i?FS.linkedAddViewAriaLabel:FS.defaultAddViewAriaLabel),className:fn().Tel,icon:Ho().plusSmallIcon,style:l.button,...t,...e})),[n,i,l.button]),d=(0,r.useCallback)((e=>(0,Ge.jsx)(Wo().m,{renderTooltip:s,render:t=>c(t,e)})),[c,s]);return(0,Ge.jsx)(Ce().A,{popupType:g().A.isMobile?Ce().z.BottomSheet:Ce().z.Popup,alignmentToOrigin:"start",originGap:4,render:a,renderOrigin:d},"suggested-views")}));var zS=()=>o(392459);const LS=r.memo((function(e){const{variant:t="headerActions"}=e,o=(0,I().IS)((()=>({container:{display:"flex",alignItems:"center",flexDirection:"column",marginInlineEnd:"tabBar"===t?6:4}})),[t]);return(0,Ge.jsx)("div",{style:o.container,children:(0,Ge.jsx)(Xi().k,{size:"sm"})})}));function KS(e){const{origin:t}=e,o=(0,x().v3)();return(0,Ge.jsx)(Ku().k,{origin:t,placementToOrigin:"bottom",header:(0,Ge.jsx)(Le().sA,{id:"WikiHomeOnboardingTooltip.header",defaultMessage:"Welcome to your new wiki!"}),content:(0,Ge.jsx)(Le().sA,{defaultMessage:"Viewers will have the same reading experience as before, but editors have new features to keep content up to date",id:"WikiHomeOnboardingTooltip.content"}),onCloseClick:()=>{Hu().A6(o)},enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,pointerPosition:"18%",pointerLength:Gu().gO,pointerOffset:Gu().Nu,style:{width:Gu().Sw}})}function WS(e){const{origin:t}=e,o=(0,x().v3)();return(0,Ge.jsx)(Ku().k,{origin:t,placementToOrigin:"right",header:(0,Ge.jsx)(Le().sA,{id:"WikiViewsOnboardingTooltip.header",defaultMessage:"New views"}),content:(0,Ge.jsx)(Le().sA,{defaultMessage:"The <bold>All pages</bold> and <bold>Pages I own</bold> views will give you an overview of pages in your wiki",id:"WikiViewsOnboardingTooltip.content",values:{bold:e=>(0,Ge.jsx)("span",{style:{fontWeight:pe().Wy.semibold},children:e})}}),onCloseClick:()=>{Hu().A6(o)},pointerPosition:"50%",pointerLength:Gu().gO,pointerOffset:Gu().j$,enableMouseCapture:!0,shouldDismissUponOutsideClick:!0,style:{width:Gu().Sw}})}var HS=()=>o(713590);function NS(e){const{collectionContextStore:t,isPlaceholderExternalCollection:o,previewContext:n,showOnlyCurrentView:r}=e;return"collectionSettings"!==t.contextTypeFromStoreState&&(!(r||o||null!=n&&n.disableHeaderPointerEvents)&&(!!t.permissionScopesStore.state.canConfigureBlock&&(!t.isMultiSourceViewFromStoreState&&!t.isInLibraryBlock())))}const GS={default:{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:120,MORE_BUTTON_MAX_WIDTH:100,ADD_VIEW_BUTTON_MAX_WIDTH:105,VIEW_TAB_PADDING:40},pills:{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:120,MORE_BUTTON_MAX_WIDTH:85,ADD_VIEW_BUTTON_MAX_WIDTH:28,VIEW_TAB_PADDING:52}},$S=5;function US({viewStores:e,shouldTryToShowAddViewButton:t,variant:n,viewSelectContainerSizeObserver:i,previousViewSelectState:l}){const a=(0,_t().ET)(),{MORE_BUTTON_MAX_WIDTH:s,ADD_VIEW_BUTTON_MAX_WIDTH:c,VIEW_TAB_PADDING:d}=(0,r.useMemo)((()=>GS[n]),[n]),u=(0,r.useRef)(new Map),p=(0,r.useCallback)((e=>{let t=u.current.get(e.id);t||(t=new(o(773363).k)({style:{fontSize:`${pe().J.UIRegular.desktop}px`,fontWeight:pe().Wy.medium}}),u.current.set(e.id,t));const n=(0,ne().OO)({collectionViewName:e.getName(),collectionViewType:e.getType()}),r=t.measure(n);return Math.min(d+r.width,Cs().PB)}),[d]);return(0,k().K8)((()=>{var o;const n=a.collectionViewStore();if(!n)return;if("collectionSettings"===a.contextTypeFromStoreState)return[];const r=Math.max(s,t?c:0);let d=((null===(o=i.current)||void 0===o?void 0:o.rect.state.width)??0)-r;const u=[],g=p(n);if(!qS({itemWidth:g,availableSpace:d,wasVisible:"dropdown"!==l.current}))return u;u.push(n),d-=g;const m=e.filter((e=>e.id!==n.id));for(const e of m.slice(0,-1)){const t=p(e);if(!(t<=d))break;u.push(e),d-=t}if(u.length===m.length){const e=m[m.length-1];qS({itemWidth:p(e),availableSpace:d,wasVisible:"allTabsVisible"===l.current})&&u.push(e)}const S=u.filter((e=>e.id!==n.id)),h=e.findIndex((e=>e.id===n.id));return S.splice(h,0,n),S}),[a,s,t,c,p,e,l,i])}function qS({itemWidth:e,availableSpace:t,wasVisible:o}){return o?e<=t+$S:e<=t-$S}var XS=()=>o(745266),YS=()=>o(115512),QS=()=>o(764242),ZS=()=>o(58357);function JS(e){var t;const{collectionContextStore:o,collectionViewStore:n,schema:r}=e,i=o.collectionStore();if(!i)return n.getName();const l=i.getPropertyMapping(),a=n.getName(),s=null==l?void 0:l[Qn().yx.TaskToSprintRelation];if(!r||!s||a!==Yn().A.formatMessage(QS().DZ.tasksCurrentSprintV2ViewName))return n.getName();const c=r[s],d=c&&(0,er().nC)(c)?(0,er().Nv)(c):void 0;if(!d)return n.getName();const u=null===(t=(0,ZS().ax)(o,"current",d,i))||void 0===t?void 0:t.getBlockTitleStore().getValue();return u?`${Yn().A.formatMessage(QS().DZ.tasksCurrentSprintV2ViewNamePrefix)}: ${u[0]}`:n.getName()}function eh(e){const{collectionViewStore:t,collectionContextStore:n}=e,[r,i]=(0,k().K8)((()=>{const e=n.settingsStore.state;return[e.open,e.stack.at(-1)]}),[n.settingsStore]),l=(0,k().O$)(n.viewsModuleContextStore),a=(0,k().K8)((()=>{var e;return null===(e=n.collectionViewStore())||void 0===e?void 0:e.id}),[n]),s=(0,k().K8)((()=>t.getCollectionStore()),[t]),c=(0,k().K8)((()=>{if(!t.isDefined())return;return(null==t?void 0:t.getFormatStore().getKeyStore("app_config_uri").getValue())===Qn().Lu&&null!=s&&s.isDefined()?{name:JS({collectionContextStore:n,collectionViewStore:t,schema:s.getSchema()}),type:t.getType()}:{name:t.getName(),type:t.getType()}}),[t,s,n]),d=r&&i&&("duplicateExistingView"===i.type||"createView"===i.type);return!c||a===t.id&&d&&!l?(0,Ge.jsx)(Le().sA,{defaultMessage:"New view",id:"collectionTabBar.newViewPlaceholder.title"}):(0,Ge.jsx)(o(31902).A,{collectionViewName:c.name,collectionViewType:c.type})}var th=()=>o(244407);const oh=r.memo((function(e){var t,n;const{collectionViewStore:i,collectionContextStore:l,hideUnderline:s,onViewClick:c,disabled:u,variant:p="default"}=e,m=(0,x().v3)(),S=(0,Pp().u)(),h=(0,d().X)("allow_empty_view_name"),v=(0,r.useRef)(null),[f,b]=(0,r.useState)(!1),w=(0,o(937199).v$)(),C=(0,Ue().Zp)(),[T,j]=(0,k().K8)((()=>{var e;return[l.viewsModuleContextStore.isInLayoutBuilder(),null===(e=l.viewsModuleContextStore.getViewsModule())||void 0===e?void 0:e.id]}),[l.viewsModuleContextStore]),A=(0,k().K8)((()=>l.collectionViewStore()),[l]),M=(0,k().K8)((()=>l.collectionViewBlockStore()),[l]),P=(0,k().O$)(l.isInHomeWidgetStore),_=(0,Rp().f)({tutorialType:"database_onboarding",stepType:"database_onboarding_board_view_tooltip",additionalChecks:e=>"database_onboarding_board_view_tooltip"===(null==e?void 0:e.stepType)&&(null==e?void 0:e.collectionBoardViewId)===i.id}),{isDefinedCollectionViewStore:R,viewIcon:B,viewType:V,viewName:F}=(0,k().K8)((()=>({isDefinedCollectionViewStore:null==i?void 0:i.isDefined(),viewIcon:null==i?void 0:i.getFormat().collection_view_icon,viewType:null==i?void 0:i.getType(),viewName:null==i?void 0:i.getName()})),[i]),E=(0,k().K8)((()=>{var e,t;return!((null==M?void 0:M.getSpaceId())!==(null===(e=(0,Ir().S)())||void 0===e?void 0:e.id))&&i.getFormat().app_config_uri===Qn().Lu&&"sprint_board"===(null===(t=a().default.state.mainEditorCurrentBlockStore)||void 0===t?void 0:t.getFormat().special_page_for_pm_launch)}),[i,M]),O=(0,k().K8)((()=>{var e;return!0===(null===(e=a().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getFormat().is_asana_imported_project)&&l.isInPeekRendererStore.state}),[l]),D=(0,k().K8)((()=>{var e;const t=null===(e=l.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores();return t&&t.length>1}),[l]),z=(0,r.useCallback)((()=>{b(!1)}),[]),{renderMenu:L,hasMenuItems:W}=(0,o(939556).y)({collectionViewStore:i,collectionContextStore:l,onClose:z}),H=(0,r.useCallback)((()=>{!W||null!=C&&C.disableHeaderPointerEvents||b(!0)}),[C,W]),G=(0,r.useCallback)((e=>{e.preventDefault(),(0,y().SQ)(e,y().y$.EditorContextMenu,H)}),[H]),$=(0,r.useCallback)((e=>{const t=l.collectionViewStore();if(!t)return;const n=l.viewsModuleContextStore.state?void 0:(0,qg().V)(e);if(c({currentCollectionViewStore:t,newCollectionViewStore:i,openInNew:n}),t.id===i.id?H():(0,o(180762).t)({environment:m,collectionContextStore:l,collectionViewId:i.id,openInNew:n,isFullScreen:l.isFullScreenStore.state,isRootChild:l.isRootChildStore.state,isInPeekRenderer:l.isInPeekRendererStore.state}),T&&w){var r;const e=null===(r=l.viewsModuleContextStore.getViewsModule())||void 0===r?void 0:r.id;e&&(w.setModuleSelection({type:"existing_module",moduleId:e,isDragging:!1}),(0,J().O)({collectionContextStore:l,collectionSettingsStore:l.settingsStore,closeOnEscape:!1}))}(0,N().X)({environment:m,collectionContextStore:l,action:"click_view_tab",new_view_type:i.getType(),new_view_id:i.id}),_&&cr().tutorialGoToNextStep(m,"database_onboarding")}),[l,c,H,i,T,w,m,_]),U=(null==A?void 0:A.id)===i.id,q=U&&T&&"existing_module"===(null==w||null===(t=w.currentModuleSelection)||void 0===t?void 0:t.type)&&w.currentModuleSelection.moduleId===j,X=T?U&&!q:("pills"!==p||!P)&&("pills"===p?f||U:f),Y=(0,k().K8)((()=>{var e;if(!l.isInLibraryBlock())return;const t=null==i||null===(e=i.getCollectionSource())||void 0===e?void 0:e.type;return(0,Nn().a0)(t)?t:void 0}),[l,i]),Q="pills"!==p&&!s&&U&&D,Z=(null===(n=(0,ne().Oz)(l))||void 0===n?void 0:n.background)??"none",ee=(0,I().eP)(),te=(0,I().IS)((()=>({originContainer:{display:"flex",alignItems:"center",background:T?void 0:Z,height:"100%",...Q&&{borderBottom:`2px solid ${K().Tj.text.primary}`,paddingTop:2},..."pills"===p&&{marginInlineEnd:1}},tooltipOriginContainer:{display:"flex",alignItems:"center",height:Cs().r2,fontSize:14,fontWeight:pe().Wy.medium,color:U?K().Tj.text.primary:K().Tj.text.secondary,maxWidth:Cs().PB,..."pills"===p&&{borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,padding:"6px 12px",whiteSpace:"nowrap",height:g().A.isMobile?Cs().G1:Cs().r2},...T?q?(0,YS().nl)({width:3,color:K().Tj.blue.border.accentPrimary}):(0,YS().nl)({width:1.5,color:K().Tj.blue.border.strong}):void 0,...T&&{marginInlineEnd:4,transition:"box-shadow 0.3s"},..._&&{borderRadius:20,boxShadow:K().Tj.buttonBlueFocusRing}},tooltipOriginContainerHovered:T?{...(0,YS().nl)({width:3,color:K().Tj.blue.border.strong}),background:"none"}:"dark"===ee?{background:K().Tj.gray.background.secondaryTranslucent}:{},tooltipOriginContainerPressed:T?{...(0,YS().nl)({width:3,color:K().Tj.blue.border.accentPrimary}),background:"none"}:{},collectionViewIcon:{marginInlineEnd:h&&""===F?0:6,...P&&{fill:K().Tj.text.secondary,transform:"scale(0.75)"}},collectionViewTabTitle:{...pe().RC,marginTop:1,...P&&{color:K().Tj.text.secondary,fontSize:pe().J.UISmall.desktop,fontWeight:pe().Wy.medium},...g().A.isMobile&&{fontSize:15}}})),[Z,h,U,q,T,P,Q,p,F,_,ee]),oe=(0,r.useCallback)((e=>(0,Ge.jsxs)(Fr().p,{"aria-selected":U,role:"tab",ref:v,size:"pills"===p?"lg":"md",style:te.tooltipOriginContainer,hovered:X,hoveredStyle:te.tooltipOriginContainerHovered,pressedStyle:te.tooltipOriginContainerPressed,onClick:$,disabled:u,...e,children:[(0,Ge.jsx)(XS().h,{color:U?"regular":"light",viewIcon:B,viewType:V,style:te.collectionViewIcon,libraryViewSource:Y}),(0,Ge.jsx)("span",{style:te.collectionViewTabTitle,children:(0,Ge.jsx)(eh,{collectionContextStore:l,collectionViewStore:i})})]},i.id)),[l,i,Y,u,$,X,U,te.collectionViewIcon,te.collectionViewTabTitle,te.tooltipOriginContainer,te.tooltipOriginContainerHovered,te.tooltipOriginContainerPressed,p,B,V]);return R&&A&&M?(0,Ge.jsx)(we().zD,{popupType:g().A.isMobile?we().nl.BottomSheet:we().nl.Popup,alignmentToOrigin:"start",open:f,render:L,onDismiss:z,trapFocus:!0,origin:(0,Ge.jsxs)("div",{className:fn().f_$,style:te.originContainer,onContextMenu:G,children:[E?(0,Ge.jsx)($a().U7,{origin:v}):null,O?(0,Ge.jsx)(Qu().gO,{origin:v,store:l}):null,_?(0,Ge.jsx)(_p().O,{contentRef:v,type:"database_onboarding",tutorialStepId:"database_onboarding_board_view_tooltip",teamIds:S}):null,(0,Ge.jsx)(th().q,{collectionViewStore:i,render:oe})]})}):null})),nh=r.memo((function(e){const{collectionContextStore:t,showHoverActionsStore:n,isPlaceholderExternalCollection:i,showOnlyCurrentView:l,onViewClick:a,disabled:s,variant:c="default",forceDropdownState:u=!1}=e,p=(0,x().v3)(),m=(0,x().WS)(),S=(0,d().X)("allow_empty_view_name"),h=(0,se().y)(),v=(0,r.useRef)(null),f=(0,r.useRef)(null),b=(0,r.useRef)(new(so().E)({throttleMs:50})),w=(0,r.useRef)("allTabsVisible"),C=(0,k().O$)(n),[T,j]=(0,r.useState)(!1),A=(0,r.useCallback)((()=>{j(!0)}),[]),M=(0,r.useCallback)((()=>{j(!1)}),[]),P=(0,Ue().Zp)(),_=(0,r.useRef)(null),{MOBILE_FORM_VIEW_TAB_MAX_WIDTH:R}=(0,r.useMemo)((()=>GS[c]),[c]),{isInCollectionViewPageWithContent:B,isEditingViewsModuleInPageBuilder:V}=(0,k().K8)((()=>{var e;return{isInCollectionViewPageWithContent:null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.isCollectionViewPageWithContent(),isEditingViewsModuleInPageBuilder:t.viewsModuleContextStore.isInLayoutBuilder()}}),[t]),F=(0,k().O$)(t.canConfigureBlockStore),E=(0,k().O$)(t.isFullScreenStore),O=(0,k().O$)(t.isInHomeWidgetStore),D=(0,k().K8)((()=>{var e;const o=null===(e=t.collectionViewStore())||void 0===e||null===(e=e.getParentBlockStore())||void 0===e?void 0:e.id;return!!o&&((0,qt().s)(o)&&t.isInHomeWidgetStore.state)}),[t]),z=(0,k().O$)(t.isEditableHomeCollectionStore),L=(0,k().K8)((()=>{var e;if(l)return[];const n=(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[],r=t.isInLibraryBlock();return n.filter((e=>!(0,o(462402).p)({viewStore:e,viewIsInLibrary:r})))}),[t,l]),W=(0,k().K8)((()=>NS({collectionContextStore:t,isPlaceholderExternalCollection:i,previewContext:P,showOnlyCurrentView:l})),[t,i,P,l]);(0,r.useEffect)((()=>{const e=b.current;return()=>{e.destroy()}}),[b]);const H=US({viewStores:L,shouldTryToShowAddViewButton:W,variant:c,viewSelectContainerSizeObserver:b,previousViewSelectState:w}),G=(0,r.useMemo)((()=>null==H?void 0:H.reduce(((e,t)=>(e[t.id]=t,e)),{})),[H]),$=(0,k().K8)((()=>"collectionSettings"===t.contextTypeFromStoreState),[t]),U=(0,k().K8)((()=>{const e=t.collectionViewStore();if(null!=e&&e.isDefined())return e}),[t]),q=(0,k().K8)((()=>{const e=t.collectionViewStore();if(null!=e&&e.isDefined())return e.getType()}),[t]),X=(0,r.useMemo)((()=>{const e=(null==H?void 0:H.length)||0,t=L.length-e,o=H&&(0===e||1===e&&L.length>1),n=$?"allTabsVisible":u||(o||m||B||z)?"dropdown":t>0?"someTabsNotVisible":"allTabsVisible";return{showMoreViewsButton:"someTabsNotVisible"===n||"dropdown"===n,showAddViewButton:W&&"allTabsVisible"===n&&T,addViewButtonAnimatedIn:E||C||V,viewSelectState:n,moreViewsCount:t}}),[H,L.length,m,B,z,T,W,E,C,V,$,u]);(0,r.useEffect)((()=>{w.current=X.viewSelectState}),[X.viewSelectState]);const Y=(0,r.useCallback)((e=>{e&&b.current.observe(e)}),[b]),Q=(0,r.useCallback)((()=>{(0,N().X)({environment:p,collectionContextStore:t,action:"click_views_dropdown"})}),[t,p]),Z=(0,r.useCallback)((e=>{const n=t.collectionViewBlockStore();n&&et().createAndCommit({userAction:"CollectionViewTabBar.handleViewTabsDrop",environment:p,canUndo:!0,perform:t=>{(0,o(92253).i)({collectionViewBlockStore:n,newViewIds:e,transaction:t})}})}),[t,p]),J=(0,r.useCallback)((e=>{(0,y().SQ)(e,y().y$.EditorMouseDown,(()=>{e.preventDefault()}))}),[]),ee=(0,k().K8)((()=>{const e=t.collectionViewStore();if(null!=e&&e.isDefined())return e.getName()}),[t]),te=(0,I().IS)((()=>{const e=s||O,t=e&&"pills"!==c||"pills"===c?0:5,o="form_editor"===q&&g().A.isMobile?R:m?"100%":Cs().PB;return{draggableContainer:{height:"100%"},tabContainer:{display:"flex",alignItems:"center",height:Cs().r2,...g().A.isMobile&&{height:Cs().G1},fontSize:e?pe().J.UISmall.desktop:14,fontWeight:e?pe().Wy.regular:pe().Wy.medium,color:e?K().Tj.text.secondary:K().Tj.text.primary,maxWidth:o,..."pills"===c&&{background:O?"none":"rgba(55, 53, 47, 0.06)",borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,paddingTop:6,paddingBottom:6,paddingInlineStart:10,paddingInlineEnd:10,whiteSpace:"nowrap"}},moreViewsContainer:{display:"flex",alignItems:"center",height:Cs().r2,...g().A.isMobile&&{height:Cs().G1},fontSize:pe().J.UIRegular.desktop,color:K().Tj.text.secondary,..."pills"===c&&{borderRadius:20,flexShrink:0,lineHeight:1.2,minWidth:0,paddingTop:6,paddingBottom:6,paddingInlineStart:10,paddingInlineEnd:10,whiteSpace:"nowrap"}},viewIcon:{marginInlineStart:t,marginInlineEnd:S&&""===ee?0:6,...D&&{transform:"scale(0.75)"}},viewTitle:{...pe().RC,marginInlineEnd:4,...O&&{fontWeight:pe().Wy.medium},...g().A.isMobile&&{fontSize:15}},viewSelectContainer:{display:"flex",alignItems:"center",height:"100%",marginTop:-3,flexGrow:m?0:10,overflow:"hidden",...h?{marginInlineStart:0}:{marginInlineStart:-4},...V&&{paddingInlineStart:2}},innerContainer:{display:"contents"},viewSelectInner:{display:"flex",alignItems:"center",flexShrink:1,height:"100%",...m&&{width:"100%"}}}}),[s,O,c,S,ee,D,m,V,q,R,h]),oe=(0,r.useCallback)(((e,o)=>{if(!G)return null;const n=G[e];if(!n)return null;const i=r.createRef();return(0,Ge.jsx)(rh,{collectionContextStore:t,store:n,isFirst:0===o,onViewClick:a,disabled:s,showOnlyCurrentView:l,variant:c,origin:i})}),[t,s,a,l,G,c]),ne=(0,r.useMemo)((()=>H&&G&&"dropdown"!==X.viewSelectState?!F||null!=P&&P.disableHeaderPointerEvents?H.map(((e,o)=>{const n=r.createRef();return(0,Ge.jsx)(rh,{collectionContextStore:t,store:e,isFirst:0===o,onViewClick:a,disabled:s,showOnlyCurrentView:l,variant:c,origin:n},e.id)})):(0,Ge.jsx)(tc().Ay,{keys:Object.keys(G),renderKey:oe,onDrop:Z,direction:"horizontal",style:te.draggableContainer,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0}):null),[H,X.viewSelectState,F,null==P?void 0:P.disableHeaderPointerEvents,G,te.draggableContainer,oe,Z,t,a,s,l,c]),re=(0,k().K8)((()=>m&&Boolean(t.shouldShowSpinnerStore.state)),[t.shouldShowSpinnerStore,m]),ie=(0,Ml().A)(re,500,100),le=(0,r.useCallback)(((e,o)=>{if(!U)return;const n=U.getType(),r=U.getFormat().collection_view_icon,i=s||O;return(0,Ge.jsxs)(Fr().p,{ref:v,style:te.tabContainer,hovered:"pills"===c&&!O||void 0,size:"pills"===c?"lg":"md",disabled:s,...(0,$i().A)(e,o),children:[ie?(0,Ge.jsx)(LS,{variant:"tabBar"}):(0,Ge.jsx)(XS().h,{color:i?"lightGray":"regular",viewType:n,viewIcon:r,style:te.viewIcon,size:i?Kn().Ev.sm:void 0}),(0,Ge.jsx)("span",{style:te.viewTitle,children:(0,Ge.jsx)(eh,{collectionContextStore:t,collectionViewStore:U})}),s?null:(0,Ge.jsx)(ke().I,{icon:mg().arrowChevronSingleDownSmallIcon,size:"sm",colorVariant:"tertiary"})]})}),[t,U,s,O,te.tabContainer,te.viewIcon,te.viewTitle,c,ie]),ae=(0,r.useCallback)((e=>{const o=t.collectionViewStore();if(null!=o&&o.isDefined()){if("dropdown"===X.viewSelectState){var n;const r="page"===o.getType()&&(null===(n=t.collectionStore())||void 0===n?void 0:n.getFormat().app_config_uri)===Qn().pW;return(0,Ge.jsxs)(Ge.Fragment,{children:[!g().A.isMobile&&r&&"home"===Hu().WH()?(0,Ge.jsx)(KS,{origin:v}):null,(0,Ge.jsx)(th().q,{collectionViewStore:o,render:t=>le(e,t)})]})}return"someTabsNotVisible"===X.viewSelectState?(0,Ge.jsx)(Fr().p,{style:te.moreViewsContainer,size:"pills"===c?"lg":"md",...e,children:(0,Ge.jsx)("span",{children:(0,Ge.jsx)(Le().sA,{defaultMessage:"{moreViewsCount} more…",id:"collectionTabBar.showMoreViews.title",values:{moreViewsCount:X.moreViewsCount}})})}):void 0}}),[t,X.viewSelectState,X.moreViewsCount,le,te.moreViewsContainer,c]),ce=(0,r.useCallback)((e=>{var o;const n=(null===(o=t.collectionStore())||void 0===o?void 0:o.getFormat().app_config_uri)===Qn().pW;return(0,Ge.jsxs)(Ge.Fragment,{children:[!g().A.isMobile&&"views"===Hu().WH()&&n?(0,Ge.jsx)(WS,{origin:f}):void 0,g().A.isMobile?(0,Ge.jsx)(Ke().W5,{collectionContextStore:t,onClose:e.close,onViewClick:a}):(0,Ge.jsx)("div",{ref:f,children:(0,Ge.jsx)(Ke().W5,{collectionContextStore:t,onClose:e.close,onViewClick:a})})]})}),[t,a]);return(0,Ge.jsx)(uo().lC,{collectionContextStore:t,step:"views",containerRef:_,children:(0,Ge.jsx)("div",{role:"tablist",tabIndex:-1,onMouseEnter:A,onMouseLeave:M,style:te.viewSelectContainer,ref:Y,children:(0,Ge.jsxs)("div",{ref:_,style:te.viewSelectInner,children:[ne,X.showMoreViewsButton?(0,Ge.jsx)("div",{onMouseDown:J,style:te.innerContainer,children:(0,Ge.jsx)(Ce().A,{alignmentToOrigin:"start",originGap:4,popupType:m?we().nl.BottomSheet:we().nl.Popup,render:ce,renderOrigin:ae,onClick:Q})}):null,(0,Ge.jsx)(ES,{renderState:X,collectionContextStore:t,preventRectangularSelection:J,variant:c})]})})})}));function rh(e){const{collectionContextStore:t,store:n,origin:r,isFirst:i,onViewClick:l,disabled:s,showOnlyCurrentView:c,variant:d}=e,u=(0,k().K8)((()=>Boolean(o(351337).Ay.state.showOnboardingTour&&"database-views-and-filters-tooltip"===(0,o(646355).gt)(a().default.state.currentUserSettingsStore,"jira-sync-onboarding"))),[]),p=(0,I().IS)((()=>({jiraOnboardingContainer:{boxShadow:o(638013).p.inputBlueFocusRing.light,borderRadius:6}})),[]);return i&&u?(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)("div",{ref:r,style:p.jiraOnboardingContainer,children:(0,Ge.jsx)(oh,{collectionContextStore:t,collectionViewStore:n,onViewClick:l,disabled:s,hideUnderline:c,variant:d},n.id)}),(0,Ge.jsx)(HS().dM,{origin:r})]}):(0,Ge.jsx)(oh,{collectionContextStore:t,collectionViewStore:n,onViewClick:l,disabled:s,hideUnderline:c,variant:d},n.id)}var ih=()=>o(250031),lh=()=>o(170479),ah=()=>o(249046);const sh=r.memo((function(e){const{collectionContextStore:t}=e,o=(0,k().K8)((()=>{const e=t.collectionViewStore(),o=null==e?void 0:e.getParentBlockStore();return o&&o.pathIsDead()}),[t]),{parentBlockStore:n,isCollectionOrParentBlockDead:r}=(0,k().K8)((()=>{const e=t.collectionStore(),o=null==e?void 0:e.getParentBlockStore(),n=!1===(null==e?void 0:e.getAlive()),r=o&&(null==o?void 0:o.pathIsDead());return{parentBlockStore:o,isCollectionOrParentBlockDead:n||r}}),[t]);return n&&(!o&&r)?(0,Ge.jsx)(ch,{parentBlockStore:n}):null})),ch=r.memo((function({parentBlockStore:e}){const t=(0,x().v3)(),n=g().A.isMobile?ah().wt:ah().Ye,l=(0,I().IS)((()=>({layoutComponent:{color:K().Tj.text.secondary,background:K().Tj.palette.gray[30],paddingTop:16,paddingInlineEnd:16,paddingBottom:16,paddingInlineStart:12,borderRadius:4,fontSize:14},trashIcon:{flexShrink:0,marginInlineEnd:10,padding:2},viewCollectionButton:{fontWeight:pe().Wy.semibold}})),[]),a=(0,r.useCallback)((()=>{(0,i().DO_NOT_USE_trackLegacy)(t,"view_deleted_database_from_deleted_collection_view_banner"),(0,o(975394).Y)({environment:t,store:e,pageVisitSource:de().y8.LinkInPage})}),[t,e]);return(0,Ge.jsxs)(n,{style:l.layoutComponent,alignItems:"center",justifyContent:g().A.isMobile?"":"space-between",children:[(0,Ge.jsxs)(ah().Ye,{alignItems:"center",children:[(0,Ge.jsx)(ke().I,{icon:Ri().trashIcon,size:24,style:l.trashIcon}),(0,Ge.jsx)(Le().sA,{id:"collectionViewBlock.deletedContainerBanner.collectionInTrash",defaultMessage:"The original database has been deleted and cannot be edited"})]}),(0,Ge.jsx)(Fr().p,{style:l.viewCollectionButton,onClick:a,colorVariant:"tertiary",iconTrailing:o(940563).arrowStraightRightIcon,children:(0,Ge.jsx)(Le().sA,{id:"collectionViewBlock.deletedContainerBanner.collection.viewCollectionButton",defaultMessage:"View database"})})]})}));const dh=(0,T()._h)(new(T().O2)("DashboardWidgetMoreMenu",(()=>Promise.all([o.e(38293),o.e(80325)]).then(o.bind(o,21967)))),(e=>e.DashboardWidgetMoreMenu));const uh=new(T().O2)("CrossSpaceWarningButton",(async()=>await Promise.resolve().then(o.bind(o,646836)))),ph=(0,T()._h)(uh,(e=>e.default));var gh=()=>o(314161),mh=()=>o(559378);const Sh=new(T().O2)("FormulaDependencyWarningPopup",(async()=>await o.e(8790).then(o.bind(o,139795)))),hh=(0,T()._h)(Sh,(e=>e.FormulaDependencyWarningPopup));var yh=()=>o(344417);var vh=()=>o(19676);const fh=(0,Le().YK)({searchLabel:{id:"database.searchButton.tooltip",defaultMessage:"Search"},searchInputPlaceholder:{id:"database.searchInputPlaceholder",defaultMessage:"Type to search..."}}),bh=r.memo((function(e){const{collectionContextStore:t,isFullScreen:o,currentViewType:n,isInHomeWidget:i}=e,l=(0,Le().tz)(),a=(0,k().K8)((()=>t.searchOpenStore.state),[t]),s=(0,r.useCallback)((()=>l.formatMessage(fh.searchLabel)),[l]),d=(0,r.useCallback)((e=>(0,Ge.jsx)(xh,{ignoreAreaEvents:e,collectionContextStore:t,isFullScreen:o,currentViewType:n,isSearchOpen:a})),[t,o,n,a]),u=(0,r.useCallback)((e=>(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)(wh,{tooltipEvents:e,collectionContextStore:t,isInHomeWidget:i}),(0,Ge.jsx)(fe().A,{visible:a,animate:{width:150,opacity:1},initial:{width:0,opacity:0},exit:{width:0,opacity:0},children:(0,Ge.jsx)(c().A,{capture:a,allowEsc:!0,render:d})})]})),[t,d,a,i]);return(0,Ge.jsx)(Wo().m,{renderTooltip:s,render:u})}),Fn().A);function xh({ignoreAreaEvents:e,collectionContextStore:t,isFullScreen:n,currentViewType:l,isSearchOpen:a}){const s=(0,x().v3)(),c=(0,Le().tz)(),{isPhone:d}=(0,x().Y0)(),u=(0,k().O$)(t.searchQueryStore),[p,g]=(0,r.useState)(!1),m=(0,I().IS)((()=>({input:{fontSize:14,lineHeight:1,paddingInlineEnd:4,color:K().Tj.text.primary,marginBottom:1},ignoreArea:{display:"flex",alignItems:"center",overflow:"hidden"}})),[]),S=(0,r.useCallback)((()=>{Et().default.reset(),St().default.reset(),xu().A.reset(),g(!0)}),[]),h=(0,r.useCallback)((()=>{t.searchQueryStore.setState(""),t.searchOpenStore.setState(!1)}),[t]),y=(0,r.useCallback)((()=>{t.searchQueryStore.state||h(),g(!1)}),[t,h]),v=(0,r.useCallback)((e=>{27===e.keyCode&&h()}),[h]),f=(0,r.useCallback)((e=>{(0,Cr().S)({searchQuery:e.target.value,collectionContextStore:t,isFullScreen:Boolean(n)});const o=(0,Lt().L0)(t.collectionStore());!function(e,t){(0,i().DO_NOT_USE_trackLegacy)(e,"collection_search",t)}(s,{view_type:l,...o})}),[t,l,s,n]),b=(0,_l().Y)(f,250);return r.useEffect((()=>{t.searchOpenStore.state&&S()}),[t.searchOpenStore,S]),(0,Ge.jsxs)("div",{...e,style:m.ignoreArea,children:[(0,Ge.jsx)(o(31511).A,{style:m.input,format:"transparent",value:u,onChange:b,placeholder:c.formatMessage(fh.searchInputPlaceholder),focusInitial:a,showClearButton:!0,onFocus:S,onBlur:y,onCancel:h,onClick:Ii().k,onClearButtonClick:h,onKeyDown:v}),d?(0,Ge.jsx)(o(797324).A,{show:p}):null]})}function wh({tooltipEvents:e,collectionContextStore:t,isInHomeWidget:n}){const i=(0,Le().tz)(),l=(0,x().v3)(),{isPhone:a}=(0,x().Y0)(),s=(0,k().K8)((()=>t.isDashboardWidget()),[t]),c=(0,I().IS)((()=>{const{button:e,icon:t}=(0,vh().i)({isInHomeWidget:n,isInDashboardWidget:s,isMobile:g().A.isMobile});return{button:e,icon:t}}),[n,s]),d=(0,k().K8)((()=>0===t.collectionStoresStore.state.length),[t]),u=(0,r.useCallback)((()=>{t.searchOpenStore.update((e=>!e)),(0,N().X)({environment:l,collectionContextStore:t,action:"click_topbar_search"})}),[t,l]);return(0,Ge.jsx)(Ie().A,{...e,icon:a?o(207207).magnifyingGlassIcon:yh().magnifyingGlassSmallIcon,iconStyle:c.icon,style:c.button,disabled:d,onClick:u,ariaLabel:i.formatMessage(fh.searchLabel)})}var Ch=()=>o(255311),kh=()=>o(187696);function Ih(e){(0,i().DO_NOT_USE_trackLegacy)(e,"collection_empty_organize_by_menu_view")}var Th=()=>o(305390);class jh extends P().Store{getInitialState(){return{query:"",limit:20}}}const Ah=(0,Le().YK)({searchPlaceholder:{defaultMessage:"Search for a page…",id:"collectionEmptyOrganizeByMenu.searchPlaceholder"}}),Mh=P().Store.createClass(void 0,{name:"ResultStore"});function Ph({collectionViewBlockStore:e,collectionViewType:t,property:n,collectionContextStore:i,onClose:l,onAddPage:a}){const s=(0,x().v3)(),c=(0,k().uB)(void 0,jh),d=(0,k().uB)(void 0,Mh),u=(0,k().K8)((()=>c.state.query),[c]),p=(0,k().O$)(d),m=(0,Le().tz)(),S=(0,k().K8)((()=>{const{query:e,limit:t}=c.state;return{type:"results",filter:{operator:"and",filters:[{property:n,filter:{operator:"is_empty"}}]},limit:t,searchQuery:e}}),[n,c]),h=(0,r.useCallback)((e=>{c.setState({query:e.target.value,limit:Bh})}),[c]),y=(0,r.useCallback)((e=>{const t=c.state.limit,o=i.isLoadingStore.state;e<Rh&&p&&p.hasMore&&!o&&c.setState({...c.state,limit:t+Bh})}),[i,p,c]),v=(0,r.useCallback)((()=>{let r;switch(t){case"calendar":r=g().A.isMobile?(0,Ge.jsx)(Le().sA,{defaultMessage:"Click to add date.",id:"collectionEmptyOrganizeByMenu.addResultToCalendar.prompt.basic"}):(0,Ge.jsx)(Le().sA,{defaultMessage:"Click or drag to calendar to add date.",id:"collectionEmptyOrganizeByMenu.addResultToCalendar.prompt"});break;case"timeline":r=(0,Ge.jsx)(Le().sA,{defaultMessage:"Click to add to the timeline",id:"collectionEmptyOrganizeByMenu.addResultToTimeline.prompt"});break;case"map":r=null;break;default:(0,H().HB)(t)}return p?p&&0===p.blockIds.length?(0,Ge.jsx)(Pe().A,{title:r,children:(0,Ge.jsx)(o(449279).u,{title:(0,Ge.jsx)(Le().sA,{defaultMessage:"No results",id:"collectionEmptyOrganizeByMenu.noResults.title"})})}):(0,Ge.jsx)(Me().A,{type:Me().O.Vertical,sections:[{key:"results",render:e=>(0,Ge.jsx)(Pe().A,{...e,title:r}),items:Oh(p.blockIds,i,e,n,a,s,t)}],initialFocus:u?0:void 0}):(0,Ge.jsx)(Pe().A,{children:(0,Ge.jsx)(Eh,{})})}),[e,t,p,i,n,a,s,u]);return(0,Ge.jsxs)(o(170356).Pq,{title:void 0,onCancel:l,desktopWidth:320,children:[(0,Ge.jsx)(Pe().A,{isInput:!0,children:(0,Ge.jsx)(o(419357).Ay,{placeholder:m.formatMessage(Ah.searchPlaceholder),focus:!g().A.isMobile||void 0,focusAfterAnimation:!0,value:u,onChange:h})}),(0,Ge.jsx)(Xr().A,{id:"empty_organize_by_results",reducer:S,collectionContextStore:i,render:v,resultStore:d}),(0,Ge.jsx)(Bl().A,{onChange:y})]})}const _h=r.memo(Ph,Fn().A),Rh=200,Bh=20;function Vh({props:e,store:t,disabled:o,url:n,collectionViewType:i}){const l=(0,x().v3)(),a=r.useRef(null),s="calendar"===i&&!g().A.isMobile,c="map"===i,d=(0,Ge.jsx)(Th().A,{...e,ref:a,store:t,hidePath:!0,disabled:o,href:c?n:void 0,onClick:c?()=>{Ih(l)}:e.onClick,right:c?void 0:(0,Ge.jsx)(Fh,{url:n,store:t,disabled:o,environment:l}),dontShrinkRight:!0});return s?(0,Ge.jsx)(oo().Ay,{canSelect:!1,canDrag:!o,canEditText:!1,store:t,shouldShowDropZone:!0,getGhostElement:()=>function(e){if(e.current){return[(0,Ch().u)(e.current)]}return[]}(a),analyticsName:"calendar_no_date_item",children:d}):d}function Fh({url:e,store:t,disabled:o,environment:n}){return void 0===e?null:(0,Ge.jsx)(Fr().p,{size:"sm",href:e,disabled:o,onClick:()=>{Ih(n)},children:(0,Ge.jsx)(Le().sA,{defaultMessage:"Open",id:"collectionEmptyOrganizeByMenu.view.button.label"})},t.id)}function Eh(){return(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)(zo().P,{style:{display:"flex",height:16,marginTop:4,marginInlineStart:12,marginInlineEnd:12,borderRadius:12,width:"50%"}}),(0,Ge.jsx)(zo().P,{style:{display:"flex",height:16,marginTop:6,marginInlineStart:12,marginInlineEnd:12,marginBottom:6,borderRadius:12,width:"75%"}})]})}function Oh(e,t,o,n,r,l,s){const c=e.map((e=>ae().B.createChildStore(o,{table:ht().ev,id:e}))).filter((e=>!(0,kh().b)(e.getPropertyStore(n).getValue()))).map((e=>{const{mainEditorCurrentBlockStore:o}=a().default.state;if(!o)return;const n=(0,ne().wy)({environment:l,store:e,mainEditorCurrentBlockStore:o,collectionContextStore:t,fullyQualified:!1}),c={key:e.id,render:t=>(0,Ge.jsx)(Vh,{props:t,store:e,disabled:!e.canEdit(),url:n,collectionViewType:s}),action:()=>{e.canEdit()&&(r(e),function(e){(0,i().DO_NOT_USE_trackLegacy)(e,"collection_empty_organize_by_menu_add")}(l))}};return c}));return W().oE(c)}function Dh({emptyTotal:e,emptyProperty:t,collectionViewType:o,timelineViewRef:n}){const i=(0,x().v3)(),l=(0,_t().ET)(),a=(0,k().K8)((()=>l.collectionViewBlockStore()),[l]),s=(0,r.useCallback)((()=>{(0,N().X)({environment:i,collectionContextStore:l,action:"click_topbar_empty_organize_by"})}),[l,i]),c=(0,I().IS)((()=>({buttonStyle:(0,vh().y)()})),[]),d=(0,r.useCallback)((e=>{const t=e.getAssociatedCollectionStore(),r=null==n?void 0:n.current;if(!t)return;const{performResult:a}=et().createAndCommit({userAction:"CollectionViewBlock.insertedStore",environment:i,canUndo:!0,perform:n=>"calendar"===o?(0,ud().$N)({environment:i,store:e,collectionStore:t,collectionContextStore:l,startDayOfWeek:Sr().XX.state,transaction:n}):"timeline"===o&&r?r.addBlockToView({store:e,transaction:n}):"map"===o?e:void 0});a&&(0,Ft().t)({environment:i,stores:[a]})}),[l,o,i,n]),u=(0,r.useCallback)((e=>a?(0,Ge.jsx)(_h,{collectionViewBlockStore:a,property:t,onClose:e.close,onAddPage:d,collectionViewType:o,collectionContextStore:l}):null),[l,a,o,t,d]);if(!(0,k().O$)(j().e))return null;const p=g().A.isMobile?Lo().n.SlideUp:Lo().n.Popup;return(0,Ge.jsx)(Ce().A,{popupType:p,placementToOrigin:"bottom",alignmentToOrigin:"start",originGap:4,render:u,onClick:s,renderOrigin:t=>{const n=e>=qi().iY?qi().iY-1+"+":e;return(0,Ge.jsx)(Fr().p,{colorPalette:"gray",style:c.buttonStyle,...t,children:"map"===o?(0,Ge.jsx)(Le().sA,{defaultMessage:"No place ({emptyTotalCount})",id:"collectionViewBlock.action.noPlaceButton.noProperty.label",values:{emptyTotalCount:n}}):(0,Ge.jsx)(Le().sA,{defaultMessage:"No date ({emptyTotalCount})",id:"collectionViewBlock.action.noDateButton.noProperty.label",values:{emptyTotalCount:n}})})}})}const zh=r.memo(Dh);var Lh=()=>o(267271),Kh=()=>o(789051);const Wh=(0,Le().YK)({filterLabel:{defaultMessage:"Filter",id:"collectionViewBlock.action.filter.title"}}),Hh=r.memo((function(e){const t=(0,Le().tz)(),{createFilterSettingsStore:n}=e,i=(0,x().v3)(),{isPhone:l}=(0,x().Y0)(),a=!(0,k().O$)(j().e),s=(0,_t().ET)(),c=(0,k().K8)((()=>n.state.open),[n]),d=(0,k().O$)(s.isInHomeWidgetStore),u=(0,k().K8)((()=>s.isDashboardWidget()),[s]),p=(0,k().K8)((()=>s.isDashboardWidget()&&s.getIsInDashboardBuildMode()),[s]),m=(0,k().K8)((()=>(0,qn().N)({collectionContextStore:s}).length>0),[s]),S=(0,k().K8)((()=>(0,Kh().I6)(s)),[s]),h=(0,k().K8)((()=>{var e;return a&&"chart"===(null===(e=s.collectionViewStore())||void 0===e?void 0:e.getType())}),[a,s]),y=h?t.formatMessage(Lh().AY.unavailableOfflineTooltip):t.formatMessage(Wh.filterLabel),v=(0,r.useCallback)((()=>{var e;const t=null===(e=s.collectionViewStore())||void 0===e?void 0:e.id,r=s.isEphemeralView(),a=(0,o(427537).H)(s)?s.currentCombinatorFilterStore.state:void 0,c=s.currentPropertyFiltersStore.state,p=s.filtersBarOpenStore.state;t&&!l&&((0,o(914701).E)({userId:i.currentUser.id,collectionViewId:t,isOpen:!p}),s.filtersBarOpenStore.setState(p)),d||u||r?p||c.length>0||a?Q().R8({collectionSettingsStore:s.settingsStore,item:{type:"filters"}}):(Q().R8({collectionSettingsStore:s.settingsStore,item:{type:"createFilter"}}),ni().Ms(s)):p||c.length>0||a?s.filtersBarOpenStore.setState(!p):(Q().R8({collectionSettingsStore:n,item:{type:"createFilter"}}),ni().Ms(s)),(0,N().X)({environment:i,collectionContextStore:s,action:"click_topbar_filter"})}),[s,n,i,d,l,u]),f=(0,r.useCallback)((()=>{Q().os({collectionSettingsStore:n})}),[n]),b=(0,I().IS)((()=>{const{button:e,icon:t}=(0,vh().i)({isInHomeWidget:d,isInDashboardWidget:u,isMobile:g().A.isMobile,isInDashboardBuildMode:p});return{button:e,icon:{...t,fill:m?K().Tj.blue.icon.accentPrimary:p?K().Tj.blue.icon.secondary:K().Tj.icon.secondary},tempFilterIndicator:{position:"absolute",top:3,insetInlineEnd:2,background:K().Tj.orange.icon.accentPrimary,border:`1px solid ${K().Tj.background.primary}`,width:9,height:9,borderRadius:9},iconContainer:{position:"relative"}}}),[d,u,m,p]),w=(0,r.useCallback)((()=>y),[y]),C=(0,r.useCallback)((()=>(0,Ge.jsx)(Lu().m$,{context:ee().Bd.TopbarFilterPopup,collectionContextStore:s,collectionSettingsStore:n,hideDesktopHeader:!0})),[s,n]);return(0,Ge.jsx)(we().zD,{trapFocus:!0,popupType:g().A.isMobile?Ce().z.SlideUp:Ce().z.Popup,open:c,placementToOrigin:"bottom",alignmentToOrigin:"start",origin:(0,Ge.jsx)(Wo().m,{renderTooltip:w,render:e=>(0,Ge.jsxs)("div",{style:b.iconContainer,children:[(0,Ge.jsx)(Ie().A,{...e,ariaLabel:y,icon:Ln().filterSmallIcon,iconStyle:b.icon,style:b.button,onClick:v,disabled:h}),S?(0,Ge.jsx)("div",{style:b.tempFilterIndicator}):void 0]})}),onDismiss:f,originGap:4,render:C})}));const Nh=(0,Le().YK)({followLabel:{defaultMessage:"Follow",id:"collectionViewBlock.action.follow.title"}});function Gh({createFollowSettingsStore:e}){const t=(0,Le().tz)(),n=(0,_t().ET)(),i=(0,k().K8)((()=>n.isDashboardWidget()),[n]),l=(0,k().O$)(n.isInHomeWidgetStore),a=(0,I().IS)((()=>{const{button:e,icon:t}=(0,vh().i)({isInHomeWidget:l,isMobile:g().A.isMobile,isInDashboardWidget:i});return{button:e,icon:t,iconContainer:{position:"relative"}}}),[l,i]),s=(0,r.useMemo)((()=>t.formatMessage(Nh.followLabel)),[t]),c=(0,k().K8)((()=>e.state.open),[e]),d=(0,r.useCallback)((()=>{Q().R8({collectionSettingsStore:e,item:{type:"follow"}})}),[e]),u=(0,r.useCallback)((()=>{Q().os({collectionSettingsStore:e})}),[e]),p=(0,r.useCallback)((()=>s),[s]),m=(0,r.useCallback)((()=>(0,Ge.jsx)(Lu().m$,{context:ee().Bd.TopbarFollowPopup,collectionContextStore:n,collectionSettingsStore:e,hideDesktopHeader:!0})),[n,e]);return(0,Ge.jsx)(we().zD,{trapFocus:!0,popupType:g().A.isMobile?Ce().z.BottomSheet:Ce().z.Popup,open:c,placementToOrigin:"bottom",alignmentToOrigin:"start",origin:(0,Ge.jsx)(Wo().m,{renderTooltip:p,render:e=>(0,Ge.jsx)("div",{style:a.iconContainer,children:(0,Ge.jsx)(Ie().A,{...e,ariaLabel:s,icon:o(588047).k,iconStyle:a.icon,style:a.button,onClick:d})})}),onDismiss:u,originGap:4,render:m})}function $h({store:e,viewType:t}){const n=(0,Le().tz)(),i=(0,x().v3)(),l=(0,_t().ET)(),a=(0,k().K8)((()=>{var t;return(0,Se().Ay)({store:e,fullyQualified:!1,pageVisitSource:de().y8.Expand,demoSettingsStore:mh().A,collectionViewId:null===(t=l.collectionViewStore())||void 0===t?void 0:t.id})}),[e,l]),s=(0,k().O$)(l.isInHomeWidgetStore),c=(0,k().K8)((()=>l.isDashboardWidget()),[l]),d=(0,I().IS)((()=>(0,vh().i)({isInHomeWidget:s,isInDashboardWidget:c,isMobile:g().A.isMobile})),[s,c]),u=(0,r.useCallback)((()=>{var n,r;return(0,o(989992).p)(i,{view_type:t,collection_id:null===(n=l.collectionStore())||void 0===n?void 0:n.id,collection_view_id:null===(r=l.collectionViewStore())||void 0===r?void 0:r.id,collection_view_block_id:e.id})}),[i,t,e,l]),p=n.formatMessage(o(65402).D.openFullscreenButton),m=(0,r.useMemo)((()=>g().A.isMobile?o(47218).arrowExpandDiagonalBottomLeftToTopRightIcon:o(662984).arrowExpandDiagonalBottomLeftToTopRightSmallIcon),[]);return(0,Ge.jsx)(Wo().m,{renderTooltip:()=>p,render:e=>(0,Ge.jsx)(Ie().A,{ariaLabel:p,href:a,onClick:u,icon:m,style:d.button,iconStyle:d.icon,...e})})}const Uh=r.memo($h);var qh=()=>o(959462);const Xh=(0,Le().YK)({offlineLabelOneView:{defaultMessage:"The top {numPages} pages are available offline",id:"collectionViewBlock.offlineIndicator.labelOneView"},offlineLabelMultipleViews:{defaultMessage:"The top {numPages} pages in the first view are available offline",id:"collectionViewBlock.offlineIndicator.labelMultipleViews"},lastSyncedOn:{defaultMessage:"Last synced on {date}",id:"collectionViewBlock.offlineIndicator.lastSyncedOn"}});function Yh(){const e=(0,Le().tz)(),t=(0,_t().ET)(),n=(0,k().O$)(t.isInHomeWidgetStore),i=(0,k().K8)((()=>t.isDashboardWidget()),[t]),l=(0,I().IS)((()=>{const{button:e,icon:t}=(0,vh().i)({isInHomeWidget:n,isInDashboardWidget:i,isMobile:g().A.isMobile});return{icon:t,iconContainer:{position:"relative",...e},secondaryText:{color:K().Tj.text.secondary}}}),[n,i]),a=(0,k().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id}),[t]),s=(0,k().K8)((()=>{var e;return(null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewIds().length)??0}),[t]),c=(0,k().K8)((()=>u().default.getConfigKey("offline_query_collection_settings","limit")),[]),d=(0,k().K8)((()=>{var e;return void 0!==a&&"success"===(null===(e=qh().A.state.offlinePages)||void 0===e||null===(e=e[a])||void 0===e?void 0:e.download_status)}),[a]),p=(0,k().K8)((()=>{var e;return d&&void 0!==a?null===(e=qh().A.state.offlinePages)||void 0===e||null===(e=e[a])||void 0===e?void 0:e.last_downloaded_at:void 0}),[a,d]),m=p?e.formatMessage(Xh.lastSyncedOn,{date:new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric",timeZoneName:"short"}).format(p)}):void 0,S=e.formatMessage(1===s?Xh.offlineLabelOneView:Xh.offlineLabelMultipleViews,{numPages:c}),h=(0,r.useCallback)((()=>(0,Ge.jsxs)("div",{style:{width:200},children:[(0,Ge.jsx)("div",{children:S}),m?(0,Ge.jsx)("div",{style:l.secondaryText,children:m}):void 0]})),[S,m,l.secondaryText]);return p?(0,Ge.jsx)(Wo().m,{renderTooltip:h,render:e=>(0,Ge.jsx)("div",{style:l.iconContainer,...e,children:(0,Ge.jsx)(ke().I,{icon:o(350646).k,style:l.icon})}),textWrap:!0}):null}const Qh=r.memo(Yh);const Zh=(0,Le().YK)({filterSortLabel:{defaultMessage:"Filter and Sort",id:"collectionViewBlock.action.filterSort.title"}}),Jh=r.memo((function(e){const t=(0,Le().tz)(),{phoneFilterSortSettingsStore:n}=e,i=(0,_t().ET)(),l=(0,k().K8)((()=>{const e=i.currentSortsStore.state.length>0,t=(0,Jl().tG)(i)>0;return e||t}),[i]),a=(0,k().K8)((()=>(0,Kh().ye)(i)||(0,Kh().gv)(i)),[i]),s=!(0,k().O$)(j().e),c=(0,k().K8)((()=>{var e;return s&&"chart"===(null===(e=i.collectionViewStore())||void 0===e?void 0:e.getType())}),[s,i]),d=c?t.formatMessage(Lh().AY.unavailableOfflineTooltip):t.formatMessage(Zh.filterSortLabel),u=(0,k().O$)(i.isInHomeWidgetStore),p=(0,k().K8)((()=>i.isDashboardWidget()),[i]),m=(0,I().IS)((()=>{const{button:e,icon:t}=(0,vh().i)({isInHomeWidget:u,isMobile:g().A.isMobile,isInDashboardWidget:p});return{button:e,icon:{...t,fill:l?K().Tj.blue.icon.accentPrimary:K().Tj.icon.secondary},iconContainer:{position:"relative"},diffDot:{position:"absolute",top:3,insetInlineEnd:2,background:K().Tj.orange.icon.accentPrimary,border:`1px solid ${K().Tj.background.primary}`,width:9,height:9,borderRadius:9}}}),[l,u,p]),S=(0,k().K8)((()=>n.state.open),[n]),h=(0,r.useCallback)((()=>(0,Ge.jsx)(Lu().m$,{context:ee().Bd.MobileSheet,collectionContextStore:i,collectionSettingsStore:n,hideDesktopHeader:!0})),[i,n]),y=(0,r.useCallback)((()=>{Q().R8({collectionSettingsStore:n,item:{type:"phoneFilterAndSort"}})}),[n]),v=(0,r.useCallback)((()=>{Q().os({collectionSettingsStore:n})}),[n]);return(0,Ge.jsx)(we().zD,{trapFocus:!0,open:S,popupType:we().nl.BottomSheet,origin:(0,Ge.jsxs)("div",{style:m.iconContainer,children:[(0,Ge.jsx)(Ie().A,{ariaLabel:d,icon:o(170350).filterIcon,iconStyle:m.icon,style:m.button,onClick:y,disabled:c}),a?(0,Ge.jsx)("div",{style:m.diffDot}):void 0]}),onDismiss:v,render:h})}));const ey=(0,Le().YK)({buttonTitle:{id:"collectionViewBlock.myTasksAddItem.buttonTitle",defaultMessage:"New task"}}),ty=r.memo((function(e){const{collectionContextStore:t,onAddItem:o}=e,n=(0,Le().tz)(),r=(0,k().uB)(void 0,V().A),i=(0,I().IS)((()=>({button:{marginInlineStart:6}})),[]);return(0,Ge.jsx)(Ce().A,{popupType:g().A.isMobile?Lo().n.BottomSheet:Lo().n.Popup,bottomSheetInitialState:"half",placementToOrigin:"bottom",alignmentToOrigin:"start",render:()=>(0,Ge.jsx)(Xo,{collectionContextStore:t,onAddItem:o,buttonPopupStore:r}),originGap:4,renderOrigin:e=>(0,Ge.jsx)(Er().A,{...e,colorPalette:"blue",style:i.button,children:n.formatMessage(ey.buttonTitle)}),buttonPopupStore:r})})),oy=r.memo((function(e){const{store:t,handleAddItemClick:n}=e,i=(0,x().v3)(),{isPhone:l}=(0,x().Y0)(),a=(0,Le().tz)(),s=(0,r.useRef)(null),c=(0,_t().ET)(),[u,p]=(0,k().K8)((()=>[c.isMultiSourceViewFromStoreState,c.isDashboardWidget()]),[c]),m=(0,k().O$)(c.isInHomeWidgetStore),S=(0,In().X)(c),h=(0,d().X)("collection_custom_item_name"),y=(0,k().K8)((()=>(0,ne().h6)({collectionContextStore:c,isCustomItemNameEnabled:h})),[c,h]),v=(0,k().K8)((()=>{if(!c.isMultiSourceViewFromStoreState)return;const e=c.collectionStoresStore.state;if(!e)return"loading";if(0===e.length)return"noDbs";const t=Boolean(e.find((e=>e.canEdit()||e.canEditCollection()||e.canEditContentOnly())));return t?void 0:en}),[c]),f=l||p||m,b=!l&&(p||m),w=(0,I().IS)((()=>({buttonWrapper:{position:"relative",display:"flex",alignItems:"center",justifyContent:"center",marginInlineStart:l?8:6},buttonStyle:{fontSize:l?15:14,height:l?32:b?24:28},mainButtonStyle:{...f&&{width:l?32:b?24:28}},titleStyle:{maxWidth:175,...pe().RC},iconStyle:{...f&&{width:l?17:14,marginInlineEnd:0}}})),[l,f,b]),C=(0,r.useMemo)((()=>{if(!f)return h?(0,Ge.jsx)("span",{style:w.titleStyle,children:y}):y}),[f,h,w.titleStyle,y]),T=(0,r.useCallback)((e=>{Q().Ub({environment:i,handleAddItemClick:n,buttonRef:s,event:e})}),[i,n,s]),j=(0,r.useCallback)((e=>{u?T(e):n(e)}),[u,T,n]),A=(0,r.useRef)(null),M=(0,r.useCallback)((e=>(0,Ge.jsx)("div",{style:w.buttonWrapper,ref:A,children:(0,Ge.jsx)(uo().lC,{collectionContextStore:c,containerRef:A,step:"new_page",children:(0,Ge.jsx)(o(430102).I,{ref:s,title:C,iconLeading:f?o(73822).plusFillIcon:void 0,color:"blue",onClick:j,mainButtonTooltip:v===en?(0,Ge.jsx)(Le().sA,{defaultMessage:"You do not have permissions{br}to edit the source databases",id:"collectionViewBlock.addItem.tooltip.noWritableDbs",values:{br:(0,Ge.jsx)("br",{})}}):void 0,onDropdownClick:e.onClick,style:w.buttonStyle,className:fn().kel,disabled:Boolean(v),disableDropdown:u||S,mainButtonStyle:w.mainButtonStyle,iconStyle:w.iconStyle,dropdownAriaLabel:a.formatMessage({id:"collectionViewBlock.addItem.dropdownAriaLabel",defaultMessage:"More add options"})})})})),[w.buttonWrapper,w.buttonStyle,w.mainButtonStyle,w.iconStyle,c,a,f,C,j,v,u,S]);return u?(0,Ge.jsx)(ty,{collectionContextStore:c,onAddItem:e=>{n(e)}}):(0,Ge.jsx)(o(776547).m,{store:t,popupType:g().A.isMobile?Lo().n.BottomSheet:Lo().n.Popup,renderOrigin:M,placementToOrigin:"bottom"})}));const ny=(0,Le().YK)({sortLabel:{defaultMessage:"Sort",id:"collectionViewBlock.action.sort.title"}});function ry({createSortSettingsStore:e}){const t=(0,Le().tz)(),n=(0,_t().ET)(),i=(0,x().v3)(),l=(0,k().K8)((()=>e.state.open),[e]),a=(0,k().K8)((()=>n.currentSortsStore.state.length>0),[n]),s=(0,k().K8)((()=>(0,Kh().gv)(n)),[n]),c=(0,k().O$)(n.isInHomeWidgetStore),d=(0,k().K8)((()=>n.isDashboardWidget()),[n]),u=(0,k().K8)((()=>n.isDashboardWidget()&&n.getIsInDashboardBuildMode()),[n]),p=(0,r.useCallback)((()=>{const t=n.permissionScopesStore.state.canConfigureBlock?n.currentCombinatorFilterStore.state:void 0,o=n.currentPropertyFiltersStore.state,r=n.filtersBarOpenStore.state,l=a||r||o.length>0||t;(c||d)&&Q().R8({collectionSettingsStore:n.settingsStore,item:{type:a?"sort":"createSort"}}),l?c||d||(n.filtersBarOpenStore.setState(!r),a?Q().R8({collectionSettingsStore:n.filterBarSortSettingsStore,item:{type:"sort"}}):Q().R8({collectionSettingsStore:e,item:{type:"createSort"}})):c||d||Q().R8({collectionSettingsStore:e,item:{type:"createSort"}}),(0,N().X)({environment:i,collectionContextStore:n,action:"click_topbar_sort"})}),[n,e,i,a,c,d]),m=(0,r.useCallback)((()=>{Q().os({collectionSettingsStore:e})}),[e]),S=t.formatMessage(ny.sortLabel),h=(0,I().IS)((()=>{const{button:e,icon:t}=(0,vh().i)({isInHomeWidget:c,isInDashboardWidget:d,isMobile:g().A.isMobile,isInDashboardBuildMode:u});return{icon:{...t,fill:a?K().Tj.blue.icon.accentPrimary:u?K().Tj.blue.icon.secondary:K().Tj.icon.secondary,transform:"rotate(180deg)"},button:e,tempSortIndicator:{position:"absolute",top:3,insetInlineEnd:2,background:K().Tj.orange.icon.accentPrimary,border:`1px solid ${K().Tj.background.primary}`,width:9,height:9,borderRadius:9}}}),[a,c,d,u]);return(0,Ge.jsx)(we().zD,{popupType:g().A.isMobile?Ce().z.SlideUp:Ce().z.Popup,placementToOrigin:"bottom",alignmentToOrigin:"start",open:l,origin:(0,Ge.jsx)(Wo().m,{renderTooltip:()=>S,render:e=>(0,Ge.jsxs)("div",{style:{position:"relative"},children:[(0,Ge.jsx)(Ie().A,{...e,ariaLabel:S,icon:o(513402).arrowUpDownSmallIcon,iconStyle:h.icon,style:h.button,onClick:p}),s?(0,Ge.jsx)("div",{style:h.tempSortIndicator}):void 0]})}),onDismiss:m,originGap:4,render:()=>(0,Ge.jsx)(Lu().m$,{context:ee().Bd.TopbarSortPopup,collectionContextStore:n,collectionSettingsStore:e,hideDesktopHeader:!0}),trapFocus:!0})}const iy=r.memo(ry);function ly(){const e=(0,x().v3)(),t=(0,_t().ET)(),n=(0,k().K8)((()=>{var e;return null===(e=t.collectionViewBlockStore())||void 0===e?void 0:e.id}),[t]),i=(0,I().IS)((()=>({button:{display:"flex",alignItems:"center",fontSize:14,fontWeight:pe().Wy.medium,color:K().Tj.text.secondary},searchIcon:{marginInlineEnd:6}})),[]),l=(0,r.useCallback)((()=>{n&&o(321874).UU({environment:e,pageId:n,analyticsFrom:"wiki-home-collection-view"})}),[e,n]);return n?(0,Ge.jsxs)(Fr().p,{style:i.button,onClick:l,children:[(0,Ge.jsx)(ke().I,{icon:yh().magnifyingGlassSmallIcon,size:"sm",colorVariant:"secondary",style:i.searchIcon}),(0,Ge.jsx)(Le().sA,{defaultMessage:"Search",id:"database.collectionViewBlock.pageView.search"})]}):null}const ay=r.memo(ly);var sy=()=>o(205557);const cy=(0,Le().YK)({tooltipTitle:{id:"pastMeetings.infoButton.tooltip.title",defaultMessage:"Learn more"},tooltipSubtitle:{id:"pastMeetings.infoButton.tooltip.subtitle",defaultMessage:"Questions and answers"},whichNotesTitle:{id:"pastMeetings.infoButton.menu.whichNotes.title",defaultMessage:"Which notes show up here"},whichNotesDescription:{id:"pastMeetings.infoButton.menu.whichNotes.description",defaultMessage:"All AI Meeting Notes you’ve created and those linked to calendar events you’ve attended are organized here."},connectCalendar:{id:"pastMeetings.infoButton.menu.connectCalendar",defaultMessage:"Connect calendar"},learnMoreLink:{id:"pastMeetings.infoButton.menu.learnMore",defaultMessage:"Learn more about this"},ariaLabel:{id:"pastMeetings.infoButton.ariaLabel",defaultMessage:"Learn more about past meetings"}});function dy(){const e=(0,Le().tz)(),t=(0,x().v3)(),n=(0,k().O$)(_().X),i=(0,I().IS)((()=>({tooltipContent:{display:"flex",flexDirection:"column",gap:2},tooltipTitle:{color:K().Tj.text.inversePrimary},tooltipSubtitle:{color:K().Tj.text.inverseSecondary},popup:{maxWidth:300},learnMoreTitle:{color:K().Tj.text.secondary}})),[]),l=(0,r.useCallback)((()=>(0,Ge.jsxs)("div",{style:i.tooltipContent,children:[(0,Ge.jsx)("div",{style:i.tooltipTitle,children:e.formatMessage(cy.tooltipTitle)}),(0,Ge.jsx)("div",{style:i.tooltipSubtitle,children:e.formatMessage(cy.tooltipSubtitle)})]})),[e,i]),s=(0,r.useCallback)((t=>(0,Ge.jsx)(Wo().m,{placement:"top",renderTooltip:l,render:o=>(0,Ge.jsx)(Ie().A,{icon:sy().lightBulbBrightSmallIcon,ariaLabel:e.formatMessage(cy.ariaLabel),...t,...o})})),[e,l]),c=(0,r.useCallback)((()=>{o(645200).Op({environment:t,spaceStore:a().AppStoreSidebarSpaceStore.state,collectionViewStore:void 0,from:"pastMeetingsInfoButton"})}),[t]),d=(0,r.useCallback)((t=>(0,Ge.jsxs)(Ge.Fragment,{children:[(0,Ge.jsx)(Pe().A,{children:(0,Ge.jsx)(Ae().A,{title:e.formatMessage(cy.whichNotesTitle),caption:e.formatMessage(cy.whichNotesDescription),shouldWrapCaption:!0,icon:(0,Ge.jsx)(ke().I,{icon:sy().lightBulbBrightSmallIcon,colorVariant:"primary",size:"sm"}),focused:!1,disabled:!0})}),(0,Ge.jsxs)(Pe().A,{topBorder:!0,children:[n?void 0:(0,Ge.jsx)(Ae().A,{title:e.formatMessage(cy.connectCalendar),icon:(0,Ge.jsx)(o(395198).y,{size:"sm",colorVariant:"primary"}),onClick:c,focused:!1}),(0,Ge.jsx)(Ae().A,{title:e.formatMessage(cy.learnMoreLink),icon:(0,Ge.jsx)(ke().I,{icon:o(721479).questionMarkCircleSmallIcon,colorVariant:"secondary",size:"sm"}),href:(0,Wu().x)("guides.meetingNotes"),external:!0,focused:!1,style:i.learnMoreTitle})]})]})),[e,i,n,c]);return(0,Ge.jsx)(Ce().A,{popupType:Ce().z.Popup,style:i.popup,alignmentToOrigin:"center",renderOrigin:s,render:d})}const uy=new(T().O2)("TableSuggestionToggle",(()=>o.e(79565).then(o.bind(o,685736)))),py=(0,T()._h)(uy,(e=>e.TableSuggestionToggle)),gy=r.memo((function(e){const{collectionContextStore:t,createFilterSettingsStore:n,createSortSettingsStore:i,phoneFilterSortSettingsStore:l,createFollowSettingsStore:a,currentViewType:s,handleAddItemClick:c,headerSizeObserver:u,isFullScreen:p,isInHomeWidget:m,isPlaceholderExternalCollection:S,minimizedActionViewStore:h,settingsHeaderSizeObserver:v,showHoverActionsStore:f,store:b,timelineViewRef:w,containerStyleOverrides:C,draggableHeaderProps:T,shouldShowFormulaDependencyWarning:A}=e,M=(0,r.useMemo)((()=>"teamspace_directory"===s?["search"]:e.allowedActions),[s,e.allowedActions]),_=(0,x().v3)(),{isPhone:R}=(0,x().Y0)(),B=(0,d().X)("download_for_offline"),V=(0,o(792485).S)(),F=(0,k().K8)((()=>t.collectionViewStore()),[t]),E=(0,k().K8)((()=>"view"===o(619206).A.getMode(_,b,b.getSpaceStore()).permission),[_,b]),O=(0,k().K8)((()=>(0,kn().w)(_)),[_]),D=(0,k().K8)((()=>({blockId:mh().A.getCurrentStepBlockId(),subStep:mh().A.getCurrentStepSubStep()??""})),[]),z=(0,k().K8)((()=>{const e=V&&V.publicEditModeStore.state.hasPublicPermission;return!(!mh().A.isActiveDemo()||!e)&&(!g().A.isMobile&&D.blockId===b.id)}),[D.blockId,V,b.id]),L=(0,k().O$)(t.wasCreatedThisSessionStore),K=(0,k().K8)((()=>{const e=t.resultSetStore.state;return((null==e?void 0:e.blockIds.size)??0)<3}),[t.resultSetStore]),W=(0,k().O$)(t.normalizedSchemaStore),H=(0,k().K8)((()=>{var e;return"page"===t.getViewType()&&"viewsMain"===t.viewsModuleContextStore.getViewModuleType()&&void 0===(null==F||null===(e=F.getFormat())||void 0===e?void 0:e.page_pointer)}),[t,F]),[N,G]=(0,r.useState)(!1);(0,r.useEffect)((()=>{L&&K&&Object.keys(W).length<=1||G(!0)}),[N,L,K,W]);const $=(0,k().K8)((()=>(void 0!==t.collectionStore()||"collectionTypedView"===t.contextTypeFromStoreState)&&!S&&(t.isDashboardWidget()||v.rect.state.width>=ee().xO)),[t,S,v]),U=(0,k().K8)((()=>!!z||f.state),[z,f]),q=(0,k().K8)((()=>{const e=u.rect.state;return!g().A.isMobile&&e.width>0&&e.width<400}),[u.rect]),{isUnlisted:X,isUnlistedFromSemanticQuery:Y}=(0,k().K8)((()=>{const e=null==F?void 0:F.getUnlistedStatus(),t=!0===(null==e?void 0:e.isUnlisted);return{isUnlisted:t,isUnlistedFromSemanticQuery:t&&!0===(null==e?void 0:e.isUnlistedFromSemanticQuery)}}),[F]),Q=(0,k().K8)((()=>{if(q||p||R||X||!b.canEditCollection())return null;const e=v.rect.state.width<=ee().xO;return(0,Ge.jsx)(o(389657).A,{store:b,isInlineCollection:!0,hideText:e,buttonStyle:{marginInlineStart:4}})}),[p,R,X,v.rect,q,b]),Z=(0,k().K8)((()=>{const e=v.rect.state.width<=ee().xO;return(0,Ge.jsx)(HS().GL,{store:b,collectionContextStore:t,hideText:e})}),[v.rect,b,t]),J=(0,k().K8)((()=>{var e,o,n;if(!M||M.includes("emptyOrganizeBy"))switch(s){case"timeline":return null===(e=t.normalizedQueryStore.state)||void 0===e?void 0:e.timeline_by;case"calendar":return null===(o=t.normalizedQueryStore.state)||void 0===o?void 0:o.calendar_by;case"map":return null===(n=t.normalizedQueryStore.state)||void 0===n?void 0:n.map_by;default:return}}),[M,t.normalizedQueryStore,s]),te=(0,k().uB)(void 0,P().Store),oe=(0,r.useMemo)((()=>{if(J)return{type:"aggregation",aggregation:{property:J,aggregator:"empty",enforceMaxAggregationLimit:!0}}}),[J]),ne=(0,k().K8)((()=>{if(oe){const e=te.state;return e&&"aggregation"===e.type&&"number"===e.aggregationResult.type&&e.aggregationResult.value?e.aggregationResult.value:0}}),[oe,te]),re=(0,k().K8)((()=>{if(!J||!ne||!$||q||"calendar"!==s&&"timeline"!==s&&"map"!==s)return null;const e=t.permissionScopesStore.state,o=t.collectionStore();return"collectionTypedView"===t.contextTypeFromStoreState||o&&e.canEditContent?(0,Ge.jsx)(zh,{emptyTotal:ne,emptyProperty:J,collectionViewType:s,timelineViewRef:w}):null}),[t,s,J,ne,$,q,w]),ie=(0,r.useMemo)((()=>R&&(!M||null!=M&&M.includes("filter"))?(0,Ge.jsx)(Jh,{phoneFilterSortSettingsStore:l}):null),[l,R,M]),le=(0,r.useMemo)((()=>N?!$||"page"===s||"form_editor"===s||"dashboard"===s||M&&!M.includes("filter")?null:z&&"filter"===D.subStep?(0,Ge.jsx)(gh().F,{subStep:"filter",step:"demo_collection",children:(0,Ge.jsx)(Hh,{createFilterSettingsStore:n})}):(0,Ge.jsx)(Hh,{createFilterSettingsStore:n}):null),[N,$,s,M,z,D.subStep,n]),ae=(0,k().K8)((()=>{if(!N)return null;if(!$||"page"===s||"form_editor"===s||"map"===s||"dashboard"===s||M&&!M.includes("sort"))return null;if("chart"===s){var e,o;const n=null===(e=t.collectionViewStore())||void 0===e?void 0:e.getChartConfig();if("placeholder"===(null==n?void 0:n.type)||"results-advanced"!==(null==n||null===(o=n.chartFormat)||void 0===o?void 0:o.mainSort))return null}return z&&"sort"===D.subStep?(0,Ge.jsx)(gh().F,{subStep:"sort",step:"demo_collection",children:(0,Ge.jsx)(iy,{createSortSettingsStore:i})}):(0,Ge.jsx)(iy,{createSortSettingsStore:i})}),[N,$,s,M,z,D.subStep,i,t]),ce=(0,k().K8)((()=>N?!$||"chart"===s||"page"===s||"dashboard"===s||S||!(0,o(637759).aS)(t)||E||M&&!M.includes("automations")?null:z&&"automations"===D.subStep?(0,Ge.jsx)(gh().F,{subStep:"automations",step:"demo_collection",children:(0,Ge.jsx)(on().nC,{})}):(0,Ge.jsx)(on().nC,{}):null),[N,$,s,S,t,E,M,z,D.subStep]),de=(0,d().X)("database_agents"),pe=(0,r.useMemo)((()=>N?!de||!$||"chart"===s||"page"===s||"dashboard"===s||S||E||M&&!M.includes("agents")?null:(0,Ge.jsx)(on().pv,{}):null),[N,de,$,s,S,E,M]),ge=(0,k().K8)((()=>R&&t.searchOpenStore.state),[R,t]),me=(0,k().K8)((()=>R?(0,Ge.jsx)(wh,{collectionContextStore:t,isInHomeWidget:Boolean(m)}):null),[R,t,m]),Se=(0,k().K8)((()=>R?(0,Ge.jsx)(fe().A,{visible:ge,animate:{opacity:1,translateX:0},initial:{opacity:0,translateX:-50},exit:{opacity:0,translateX:-50},style:{position:"absolute",insetInlineStart:0},children:(0,Ge.jsx)(xh,{collectionContextStore:t,isFullScreen:Boolean(p),currentViewType:s,isSearchOpen:ge})}):null),[R,t,ge,p,s]),he=(0,k().K8)((()=>{return N?!$||"form_editor"===s||"chart"===s||"dashboard"===s||q||M&&!M.includes("search")||S?null:"page"===s?null!==(e=t.collectionViewBlockStore())&&void 0!==e&&e.isCollectionViewPageWithContent()?(0,Ge.jsx)(ay,{}):null:(0,Ge.jsx)(bh,{collectionContextStore:t,isFullScreen:Boolean(p),currentViewType:s,isInHomeWidget:Boolean(m)}):null;var e}),[N,$,s,q,M,S,t,p,m]),ye=(0,r.useMemo)((()=>R||p||E||M&&!M.includes("fullScreen")?null:(0,Ge.jsx)(Uh,{store:b,viewType:s})),[p,b,s,M,E,R]),ve=(0,k().K8)((()=>t.isDashboardWidget()&&t.getIsInDashboardBuildMode()),[t]),be=(0,k().K8)((()=>t.isDashboardWidget()),[t]),xe=(0,k().K8)((()=>E||M&&!M.includes("viewSettings")||S?null:z&&"settings"===D.subStep?(0,Ge.jsx)(gh().F,{subStep:"settings",step:"demo_collection",children:(0,Ge.jsx)(on().XA,{collectionContextStore:t,buttonAndIconStyle:(0,vh().i)({isInHomeWidget:Boolean(m),isInDashboardWidget:be,isMobile:g().A.isMobile,isInDashboardBuildMode:ve})})}):(0,Ge.jsx)("div",{style:{position:"relative"},children:(0,Ge.jsx)(on().XA,{collectionContextStore:t,buttonAndIconStyle:(0,vh().i)({isInHomeWidget:Boolean(m),isInDashboardWidget:be,isMobile:g().A.isMobile,isInDashboardBuildMode:ve})})})),[t,m,be,S,M,z,D,E,ve]),we=(0,k().K8)((()=>!O&&$&&null!=M&&M.includes("saveOrOpenOverflow")?(0,Ge.jsx)(on().fV,{collectionContextStore:t,shouldHideSaveViewOption:Y}):null),[$,M,t,Y,O]),Ce=(0,k().K8)((()=>"page"===s||"form_editor"===s||S||!t.shouldAllowNewItemCreation({overrideAllowForTypedViews:!0})||M&&!M.includes("addItem")||(0,o(915508).R)(t)?null:(0,Ge.jsx)(oy,{store:b,settingsHeaderSizeObserver:v,handleAddItemClick:c})),[s,S,t,M,b,v,c]),ke=(0,k().K8)((()=>{var e;return(null===(e=b.inMemoryRecordCache)||void 0===e?void 0:e.isTemporaryData)??!1}),[b]),Ie=(0,r.useMemo)((()=>"form_editor"!==s||M&&!M.includes("formActionButtons")||ke?null:(0,Ge.jsx)(o(171559).Pe,{collectionContextStore:t,showCompactDesktopHeader:q})),[s,M,q,t,ke]),Te=(0,k().K8)((()=>null!=M&&M.includes("closeCollectionViewInModal")&&t.isUnlistedViewStore.state?(0,Ge.jsx)(on().YL,{}):null),[M,t]),je=(0,k().K8)((()=>M&&!M.includes("dashboardBuildMode")||!t.isDashboardView()?null:(0,Ge.jsx)(Uo,{collectionContextStore:t})),[t,M]),Ae=(0,k().K8)((()=>M&&!M.includes("dashboardWidgetActionsMenu")||!t.isDashboardWidget()?null:(0,Ge.jsx)(dh,{collectionContextStore:t})),[t,M]),Me=(0,r.useMemo)((()=>M&&M.includes("info")?(0,Ge.jsx)(dy,{}):null),[M]),Pe=(0,k().K8)((()=>{const e=t.collectionViewStore(),o=t.collectionStore();return!(!e||!o)&&o.getSpaceId()!==e.getSpaceId()}),[t]),_e=(0,r.useCallback)((e=>{(0,y().SQ)(e,y().y$.EditorMouseDown,(()=>{e.preventDefault()}))}),[]),Re=(0,k().O$)(t.shouldShowSpinnerStore),Be=(0,Ml().A)(Re,500,100),Ve=yu(t,!0),Fe=(0,k().K8)((()=>t.userAddedPropertyStore.state),[t]),Ee=(0,r.useMemo)((()=>"table"===s&&!Fe&&Ve),[s,Fe,Ve]),Oe=(0,k().K8)((()=>{if(!Ee)return null;return 0===t.collectionSuggestionStore.getActiveSuggestions().length?null:(0,Ge.jsx)(py,{isEnabled:t.collectionSuggestionStore.state.isEnabled,environment:_,collectionContextStore:t,renderLoading:()=>null})}),[Ee,t,_],{useDeepEqual:!0}),De=(0,k().O$)(j().e),ze=(0,r.useMemo)((()=>De||!B?null:(0,Ge.jsx)(Qh,{})),[De,B]),Le=(0,k().K8)((()=>t.databaseTypeFromStoreState),[t]),Ke=(0,o(152077).Vs)(),We=(0,k().K8)((()=>{var e;return(null===(e=t.collectionStore())||void 0===e?void 0:e.isUserAllowedToFollow())??!1}),[t]),He=(0,r.useMemo)((()=>N&&$?"feed"!==s||Le||Ke&&!We?null:(0,Ge.jsx)(Gh,{createFollowSettingsStore:a}):null),[s,a,N,$,Le,Ke,We]),Ne=(0,se().y)(),$e=(0,k().O$)(f),Ue=(0,I().IS)((()=>({container:{height:"100%",flexGrow:1,...Ne&&{paddingInlineEnd:ue().dE.paddingInlineEnd},opacity:$e?1:0,transition:"opacity 200ms ease-in-out",...C},phoneSearchInputContainer:{position:"relative",display:"flex",alignItems:"center",overflow:"hidden"},phoneInputButtons:{display:"flex",alignItems:"center",pointerEvents:ge?"none":"auto"}})),[Ne,C,ge,$e]);if(H)return null;if(R)return(0,Ge.jsxs)(fe().A,{visible:U,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center"},children:[ze,Pe?(0,Ge.jsx)(ph,{type:"linkedView"}):A?(0,Ge.jsx)(hh,{}):void 0,ye,me,(0,Ge.jsxs)("div",{style:Ue.phoneSearchInputContainer,children:[(0,Ge.jsxs)(fe().A,{animate:{opacity:ge?0:1},style:Ue.phoneInputButtons,children:[ie,xe,Ce,Ie,we]}),Se]})]});const qe=(0,Ge.jsxs)(Ge.Fragment,{children:[Be?(0,Ge.jsx)(LS,{}):null,Me,ze,Pe?(0,Ge.jsx)(ph,{type:"linkedView"}):A?(0,Ge.jsx)(hh,{}):void 0,Q,Z,oe?(0,Ge.jsx)(Xr().A,{id:Bn().au,collectionContextStore:t,reducer:oe,resultStore:te}):void 0,pe,re,He,le,ae,ce,he,ye,xe,Oe,we,Ce,Ie,Te,je,Ae]}),Xe=e=>(0,Ge.jsx)("div",{style:Ue.container,...e,children:g().A.isMobile?(0,Ge.jsx)(fe().A,{visible:U,animate:{opacity:1},initial:{opacity:0},exit:{opacity:0},style:{display:"flex",alignItems:"center",justifyContent:"flex-end"},onMouseDown:_e,children:qe}):(0,Ge.jsx)(Go,{settingsHeaderSizeObserver:v,isFullScreen:p,collectionContextStore:t,viewSettingsButton:xe,minimizedActionViewStore:h,allowedActions:M,children:qe})});return T?(0,Ge.jsx)(xd().A,{...T,render:Xe}):Xe(void 0)}));var my=function(e){return e[e.TabBar=0]="TabBar",e[e.Source=1]="Source",e[e.None=2]="None",e}(my||{});function Sy(e){const{currentViewType:t,store:o,isFullScreen:n,hideViewTabBar:i,collectionViewHeaderText:l,headerActionsBehavior:a,allowedActions:s,isInHomeWidget:c,isMyTasksPage:d,isHomeCustomDbPage:u,showHoverActionsStore:g,headerSizeObserver:m,isPlaceholderExternalCollection:S,handleEditorMouseDown:h,handleHeaderMouseMove:v,handleHeaderMouseLeave:f,handleHeaderMount:b,handleSettingsHeaderMount:w,leftRightPaddingStore:C,headerHeightStore:T,canEdit:j,contentSizeObserver:A,settingsHeaderSizeObserver:M,viewSettingsPlacementStore:_,showOnlyCurrentView:R,switchViewMetric:F,handleAddItemClick:E,timelineViewRef:O,createFilterSettingsStore:D,filterBarCreateFilterSettingsStore:L,headerWrapStyle:K,headerRef:W,headerStyleOverrides:H,minimizedActionViewStore:N,createFollowSettingsStore:G,draggableHeaderProps:$,forceDropdownState:U=!1}=e,q=(0,x().v3)(),{isPhone:X}=(0,x().Y0)(),Y=(0,_t().ET)(),Z=(0,Ue().Zp)(),J=(0,In().X)(Y),ee=(0,k().K8)((()=>Y.collectionStore()),[Y]),te=(0,k().uB)(void 0,P().Store),oe=(0,r.useMemo)((()=>{if(d){return{type:"results",filter:{operator:"and",filters:[]},limit:1}}}),[d]),re=(0,k().uB)(void 0,P().Store),ie=(0,r.useMemo)((()=>{if(u)return{type:"results",filter:{operator:"and",filters:[]},limit:1}}),[u]),le=(0,k().uB)(void 0,V().A),ae=(0,k().uB)(void 0,P().Store.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),se=(0,k().uB)(void 0,P().Store.createClass({open:!1,stack:[]},{name:"phoneFilterSortSettingsStore"}));(0,r.useEffect)((()=>{(!s||null!=s&&s.includes("minimize"))&&Q().d9({environment:q,collectionContextStore:Y})}),[q,Y,s]);const ce=(0,k().O$)(C),de=(0,k().O$)(T),ue=(0,k().K8)((()=>(0,eo().S)(o)),[o]),pe=(0,k().K8)((()=>{var e;return Boolean(!S&&!(null!=Z&&Z.hideViewBlockSource)&&Y.shouldShowSourceStore.state&&!Y.isUnlistedViewStore.state&&(null===(e=Y.collectionStore())||void 0===e?void 0:e.canRead()))}),[Y,S,Z]),ge=(0,k().K8)((()=>{const e=Y.formulaDependencyWarningsStore.state;return void 0!==e&&e.length>0}),[Y]),me=(0,k().K8)((()=>{const e=Y.collectionViewStore();return!(!ee||!e)&&ee.getSpaceId()!==e.getSpaceId()}),[Y,ee]),Se=ge&&!me,he=(0,r.useCallback)((({currentCollectionViewStore:e,newCollectionViewStore:t,openInNew:o})=>{if(e.id!==t.id&&!o){const o=e.getType(),r=t.getType();if(o&&r){var n;if(F)F.current={from:o,to:r,metric:B().default.DO_NOT_USE_markLegacy("collections.switch_view_lag"),sizeHintAtStart:null===(n=Y.remoteResultStore.state)||void 0===n?void 0:n.sizeHint};"form_editor"===o&&Y.isClientModeEnabledStore.setState(!1),"form_editor"===r&&Q().os({collectionSettingsStore:Y.settingsStore})}}}),[Y.isClientModeEnabledStore,Y.remoteResultStore,Y.settingsStore,F]),ye=(0,k().K8)((()=>{var e;return(null===(e=Y.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[Y]),ve=(0,k().K8)((()=>NS({collectionContextStore:Y,isPlaceholderExternalCollection:S,previewContext:Z,showOnlyCurrentView:R})),[Y,S,Z,R]),fe=(0,r.useMemo)((()=>({showMoreViewsButton:!1,showAddViewButton:ve,addViewButtonAnimatedIn:!0,viewSelectState:"allTabVisible",moreViewsCount:0})),[ve]),be=(0,r.useCallback)((e=>{(0,y().SQ)(e,y().y$.EditorMouseDown,(()=>{e.preventDefault()}))}),[]),xe=(0,r.useMemo)((()=>(0,Ge.jsx)(ES,{renderState:fe,collectionContextStore:Y,preventRectangularSelection:be,variant:"default"})),[Y,be,fe]),we=(0,k().K8)((()=>i?my.None:c||n||!pe||1!==(null==ye?void 0:ye.length)||Y.isInViewTabLayout()?my.TabBar:my.Source),[i,null==ye?void 0:ye.length,n,pe,c,Y]),Ce=(0,k().K8)((()=>Boolean(null==ee?void 0:ee.isSyncedCollection())),[ee])&&we===my.Source,ke=(0,I().IS)((()=>({headerPositioningStyle:{insetInlineStart:null==ce?void 0:ce.paddingLeft,paddingInlineStart:c?Jt().Fq:void 0,width:"100%"},headerStyle:{display:"flex",alignItems:Ce?"flex-start":"center",...!Ce&&{height:de},insetInlineStart:null==ce?void 0:ce.paddingLeft,paddingInlineStart:c?Jt().Fq:void 0,width:"100%",...X&&{gap:10,justifyContent:"space-between"},...H},selectableStyle:{position:"relative"},headerActionsStyle:{...Ce&&{marginTop:6}}})),[de,H,c,null==ce?void 0:ce.paddingLeft,Ce,X]),Ie=(0,r.useMemo)((()=>{switch(we){case my.TabBar:return(0,Ge.jsx)(nh,{collectionContextStore:Y,showHoverActionsStore:g,isPlaceholderExternalCollection:S,showOnlyCurrentView:R??!1,onViewClick:he,disabled:d,variant:"pills",forceDropdownState:U});case my.Source:return(0,Ge.jsx)(pt,{store:o,collectionContextStore:Y,isFullScreen:n,showHoverActionsStore:g,canEdit:j,addViewButton:xe});case my.None:return null}}),[we,xe,Y,g,S,R,he,d,o,n,j,U]),Te=(0,r.useMemo)((()=>"hidden"===a?null:(0,Ge.jsx)(gy,{showHoverActionsStore:g,isFullScreen:n,store:o,currentViewType:t,collectionContextStore:Y,isPlaceholderExternalCollection:S,settingsHeaderSizeObserver:M,createFilterSettingsStore:D,createSortSettingsStore:ae,phoneFilterSortSettingsStore:se,createFollowSettingsStore:G,isInHomeWidget:c,handleAddItemClick:E,headerSizeObserver:m,timelineViewRef:O,allowedActions:s,minimizedActionViewStore:N,containerStyleOverrides:ke.headerActionsStyle,draggableHeaderProps:$,shouldShowFormulaDependencyWarning:Se})),[a,g,n,o,t,Y,S,M,D,ae,se,G,c,E,m,O,s,N,ke.headerActionsStyle,$,Se]);return(0,Ge.jsxs)(p().s,{allowSelectionWithin:!0,style:K,onMouseDown:h,onMouseMove:v,onMouseLeave:f,ref:(0,z().Px)(b,W),children:[n?(0,Ge.jsx)(BS,{currentViewType:t,headerSizeObserver:m,contentSizeObserver:A,settingsHeaderSizeObserver:M,headerHeightStore:T,viewSettingsPlacementStore:_,store:o,leftRightPaddingStore:C,isInHomeWidget:c,headerRef:W,handleAddItemClick:E}):void 0,ce?(0,Ge.jsxs)(oo().Ay,{store:o,shouldShowCopyLinkButton:ue,analyticsName:(0,ne().LI)(t),style:ke.selectableStyle,shouldShowHalo:!(n||c||J||null!=Z&&Z.isPreviewing),children:[(0,Ge.jsxs)("div",{style:ke.headerStyle,ref:w,children:[Ie,l,Te]}),oe?(0,Ge.jsx)(Xr().A,{id:"tasks_results",collectionContextStore:Y,reducer:oe,resultStore:te}):void 0,ie?(0,Ge.jsx)(Xr().A,{id:"custom_db_results",collectionContextStore:Y,reducer:ie,resultStore:re}):void 0]}):void 0,(0,Ge.jsxs)("div",{style:ke.headerPositioningStyle,children:[(0,Ge.jsx)(sh,{collectionContextStore:Y}),(0,Ge.jsx)(hy,{collectionContextStore:Y,showHoverActionsStore:g,filterBarCreateFilterSettingsStore:L,saveControlMoreActionsButtonPopupStore:le,currentViewType:t,isInHomeWidget:c})]})]})}function hy({collectionContextStore:e,showHoverActionsStore:t,filterBarCreateFilterSettingsStore:o,saveControlMoreActionsButtonPopupStore:n,currentViewType:r,isInHomeWidget:i}){const l=(0,x().v3)(),a=(0,x().WS)(),s=(0,k().K8)((()=>(0,ih().J)(l)),[l]),c=(0,k().O$)(e.filtersBarOpenStore),d=(0,k().O$)(e.shouldShowSourceStore),u=(0,k().O$)(e.completeSprintButtonContextStore),p=(0,k().K8)((()=>e.isDashboardWidget()),[e]),g=d?8:12;return"teamspace_directory"===r||"library_external_pages"===r||"page"===r||"form_editor"===r||p||"feed"===r&&(s||a)||i||a?null:c?(0,Ge.jsx)(zS().N9,{collectionContextStore:e,showHoverActionsStore:t,createFilterSettingsStore:o,saveControlMoreActionsButtonPopupStore:n}):u?(0,Ge.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingBottom:a?12:8,paddingTop:g},children:[(0,Ge.jsx)("div",{style:{flex:1}}),(0,Ge.jsx)(lh().A,{collectionContextStore:e})]}):null}const yy=r.memo(r.forwardRef((function(e,t){const{store:L,isFullScreen:Z,productUseCase:re,viewsModuleContext:ie,overrideViewType:le,headerActionsBehavior:ae="default",overridePaddingLeft:se,overridePaddingRight:ce,fullWidth:de,headerText:ue,hideViewTabBar:pe,headerAllowedActions:ge,maxHeight:me,disabled:Se,forceLocalQueryCollection:fe=!1,isUnlistedView:be,viewId:xe,onMount:we,setCollectionContextStore:Ce,showOnlyCurrentView:ke,additionalCollectionViewInnerHorizontalPadding:Ie,templatePickerMenuListStore:Te,editorContentContainerRef:je,handleAddItemClickOverride:Ae,collectionContentWrapperStyle:Me,headerActionsWrapperStyle:Pe,forceDropdownStateInTabBar:_e=!1,renderInfo:Re,draggableHeaderProps:Be}=e,{mountedBeforeInitialPageRender:Ve,navigationStartTime:Fe,cvbLoadingStateOnInitialRender:Ee,lazyRenderStartedAtRef:Oe,trackPendingCollectionItemRender:De,dependencyLoadingMetrics:ze}=Re,Le=(0,I().eP)(),Ke=(0,x().Y0)(),{isPhone:We}=Ke,He=(0,r.useRef)(null),Ne=(0,x().v3)(),$e=(0,o(664594).T)(),qe=(0,Ue().Zp)(),Xe=(null==qe?void 0:qe.isPreviewing)??!1,Ye=(0,r.useMemo)((()=>new(Mo().B)(Ne)),[Ne]);(0,r.useEffect)((()=>{var e;if(Z&&(null===(e=a().default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.id)===L.id)return ro().j.setState(Ye),()=>{ro().j.setState(void 0)}}),[Ye,Z,L.id]);const Qe=(0,r.useContext)(m().U),Ze=(0,k().uB)(void 0,o(505776).A),Je=(0,r.useMemo)((()=>new(so().E)),[]),tt=(0,r.useMemo)((()=>new(so().E)),[]),ot=(0,r.useMemo)((()=>new(so().E)),[]),nt=(0,r.useRef)(null),rt=(0,r.useRef)(),it=(0,r.useRef)(null),[lt]=(0,r.useState)((()=>performance.now())),at=(0,r.useRef)(new Map),st=(0,r.useRef)(),ct=(0,r.useRef)(null);ct.current||(ct.current=new Fo(Ye,Ne)),(0,r.useEffect)((()=>{Ye.previewContextStore.setState(qe)}),[qe,Ye]),(0,r.useEffect)((()=>{const e=ct.current;return async function(){const{createHasSchemaChangedForQueryStore:t}=await Kt.load();Ye.hasSchemaChangedForQueryStore=t(Ye),null==e||e.subscribeToSchemaChanges(Ye.hasSchemaChangedForQueryStore)}(),()=>{null==e||e.unsubscribeFromSchemaChanges()}}),[ct,Ye]),(0,r.useEffect)((()=>()=>{var e;const t=$e,n=u().default.getConfig({configName:"collection_request_orchestrator_config"}).cancelOnUnmountPercentage??0,r=null===(e=Ye.collectionViewBlockStore())||void 0===e?void 0:e.id;t&&r&&(0,o(745875).Yo)(t,n)&&o(758050).QY.cancelAllRequestsForCVB({collectionViewBlockId:r,cancelReason:"unmount",environment:Ne})}),[Ye,Ne,$e]);const dt=(0,d().X)("can_create_pages_in_collection_permission");(0,w().w)((()=>{dt&&mo(Ye)}));const{didDelayOffscreenRenderRef:ut,collectionViewVisibilityStore:gt}=function({collectionContextStore:e,isFullScreen:t,rootRef:n,trackPendingCollectionItemRender:i}){const l=(0,r.useRef)(t),a=(0,r.useRef)(!1),s=(0,r.useRef)(void 0),c=(0,k().uB)(void 0,P().Store.createClass(!0,{name:"collectionViewVisibilityStore"})),d=(0,r.useCallback)((()=>{Gt().Ay.isOpen()&&(l.current||(l.current=!0,e.shouldDelayRenderStore.setState(!1)))}),[e]);(0,r.useEffect)((()=>(Gt().Ay.addListener(d),()=>{Gt().Ay.removeListener(d)})),[d]);const u=(0,r.useCallback)((t=>{t.state&&s.current&&(l.current||(l.current=!0,e.shouldDelayRenderStore.setState(!1)))}),[e]);(0,r.useEffect)((()=>(e.didItemsMountStore.addListener(u),()=>{e.didItemsMountStore.removeListener(u)})),[e,u]);const p="on"===(0,o(477293).r)("collections_allow_offscreen_before_loaded",{enableEventTrailLogging:!0}),g=(0,r.useCallback)((t=>{const o=t.reduce(((e,t)=>t.time>e.time?t:e),t[0]);if(s.current=o.isIntersecting,c.setState(o.isIntersecting),l.current)return;const n=!o.isIntersecting;n?(a.current=!0,null==i||i()):p?e.didItemsMountStore.state&&(l.current=!0):l.current=!0,e.shouldDelayRenderStore.setState(n)}),[p,e,c,i]);return(0,r.useEffect)((()=>{var e;if(l.current)return;if(null===(e=n.current)||void 0===e||!e.parentElement)return;const t=new IntersectionObserver(g);return t.observe(n.current.parentElement),()=>t.disconnect()}),[g,n]),{didDelayOffscreenRenderRef:a,collectionViewVisibilityStore:c}}({collectionContextStore:Ye,isFullScreen:Z,rootRef:He,trackPendingCollectionItemRender:De});(0,r.useEffect)((()=>{const e=()=>{var e;gt.state&&(null===(e=ct.current)||void 0===e||e.maybeProcessDeferredCollectionEmit("msg"))};return gt.addListener(e),()=>{gt.removeListener(e)}}),[gt,ct]);const mt=(0,r.useCallback)((()=>{var e;return!M().A.state.isVisible||(!(!ve().default.isCenterPeekOpen()||null!==(e=ve().default.peekTargetStore.state)&&void 0!==e&&e.uiContains(L))||!Boolean(Z)&&!gt.state)}),[Z,gt,L]),St=(0,r.useRef)(),ht=(0,r.useRef)(),[yt,vt]=(0,r.useState)(!1),[ft,bt]=(0,r.useState)(!1),[xt,wt]=(0,r.useState)(!1),Ct=(0,k().uB)(void 0,P().Store.createClass({open:!1,stack:[]},{name:"createFilterSettingsStore"})),kt=(0,k().uB)(void 0,P().Store.createClass({open:!1,stack:[]},{name:"createFollowSettingsStore"})),It=(0,k().uB)(void 0,P().Store.createClass({open:!1,stack:[]},{name:"filterBarCreateFilterSettingsStore"})),Tt=(0,k().uB)(void 0,P().Store.createClass({open:!1,stack:[]},{name:"createSortSettingsStore"})),jt=(0,k().uB)(void 0,P().Store.createClass(void 0,{name:"viewSettingsPlacementStore"})),At=(0,k().uB)(void 0,V().A);(0,o(236248).b)(Ye);const Mt=(0,r.useCallback)((()=>{var e;return le??(null===(e=Ye.collectionViewStore())||void 0===e?void 0:e.getType())}),[le,Ye]),Pt=(0,k().r6)((()=>(0,ye().cq)(L)),[L]),Rt=(0,k().O$)(Pt),Bt=(0,k().O$)(Ye.isInHomeWidgetStore),Vt=(0,k().K8)((()=>{const e=Ye.viewsModuleContextStore;return Boolean(e.getViewModuleType())}),[Ye]),Ft=(0,k().K8)((()=>(0,ye().RX)(L)),[L]),Et=(0,Nt().Lc)(),Dt="nested"===(null==Et?void 0:Et.layout),zt=(0,k().r6)((()=>{const e=(0,no().Uh)(Ne)-he().x6;if(Ft&&!Z&&!(0,he().Ck)(L,void 0,Ke)&&e>0&&!Bt&&!Ye.isDashboardWidget())return e/2}),[Ne,Ft,Z,L,Ke,Bt,Ye]),Xt=(0,k().O$)(zt),So=(0,k().K8)((()=>{var e;return(null===(e=nt.current)||void 0===e?void 0:e.getStore().state.elementRef)??{current:null}}),[nt]),ho=(0,r.useCallback)((e=>{var t,o;if(Ye.isInHomeWidgetStore.state)return;const n=Ye.normalizedFormatStore.state,r=null===(t=So.current)||void 0===t?void 0:t.clientWidth;Ye.frozoneStore.setState({isScrolled:!1,scrollerWidth:r,scrollerLeftOffset:(null==nt||null===(o=nt.current)||void 0===o||null===(o=o.getClientRect())||void 0===o?void 0:o.left)??0,scrollerLeftPadding:zt.state,frozenIndex:null==e?void 0:e.getTableFrozenColumnIndex(r,n),tryShowHiddenFrozenColumn:!1})}),[Ye,So,zt]),yo=(0,k().K8)((()=>L.isRootOrDirectChild()),[L]),vo=(0,k().K8)((()=>(0,Wt().dC)(Ne,L)),[Ne,L]),bo=(0,Nt().Lc)(),xo=Boolean(bo),wo=(0,k().r6)((()=>{const e=Mt(),t=(0,ne().l0)({environment:Ne,store:L,isFullScreen:Z,isInFeedView:xo,sizeObserver:Je,viewType:e,collectionContextStore:Ye});return t&&void 0!==se&&(t.paddingLeft=se),t&&void 0!==ce&&(t.paddingRight=ce),t&&yo&&vo&&(0,he().Ck)(L,void 0,Ke)&&"page"!==e&&(t.paddingRight+=Wt().Qb),t}),[Mt,Ne,L,Z,Je,Ye,se,ce,yo,vo,Ke,xo]);(0,k().O$)(wo);const Co=(0,r.useCallback)((e=>{const t=e.target;null!==t&&t instanceof HTMLElement&&(0,o(819121).p)(t)&&wt(!0)}),[wt]),ko=(0,r.useCallback)((()=>{wt(!1)}),[wt]),Io=(0,r.useCallback)((()=>{io().A.state||vt(!0)}),[vt]),To=(0,r.useCallback)((()=>{vt(!1)}),[vt]),jo=(0,r.useCallback)((()=>{var e,t;if(Bt)return;const o=null===(e=nt.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.getBoundingClientRect().width,n=Ye.frozoneStore.state.scrollerWidth,r=null===(t=nt.current)||void 0===t||null===(t=t.getNode())||void 0===t?void 0:t.getBoundingClientRect().left,i=Ye.frozoneStore.state.scrollerLeftOffset;if(o===n&&r===i)return;const l=Ye.collectionViewStore(),a=Ye.normalizedFormatStore.state;Ye.frozoneStore.update((e=>({...e,scrollerWidth:o,scrollerLeftOffset:r,scrollerLeftPadding:zt.state,frozenIndex:null==l?void 0:l.getTableFrozenColumnIndex(o,a),tryShowHiddenFrozenColumn:!1})))}),[Ye,nt,zt,Bt]),Po=(0,r.useCallback)((()=>{var e,t;const o=null===(e=nt.current)||void 0===e||null===(e=e.getNode())||void 0===e?void 0:e.scrollLeft,n=null===(t=wo.state)||void 0===t?void 0:t.paddingLeft;if(void 0===o||void 0===n)return;const r=o>n;r!==Ye.frozoneStore.state.isScrolled&&(Ye.frozoneStore.setState({...Ye.frozoneStore.state,isScrolled:r}),jo())}),[Ye,jo,wo]),_o=(0,r.useRef)(!1);!function({environment:e,collectionContextStore:t}){const o=(0,r.useCallback)((o=>{o.state.online||(0,oe().M)(e,t,{src:"initial_load"})}),[e,t]);(0,w().l)((()=>{j().A.state.online&&j().A.addListener(o)})),(0,C().X)((()=>{j().A.removeListener(o)}))}({environment:Ne,collectionContextStore:Ye});const{collectionViewStore:Ro,collectionStore:Bo}=(0,k().K8)((()=>{var e;const t=Ye.collectionViewStore(),n=Ye.collectionStore(),r=Ne.currentUser.id,i=null==t?void 0:t.id,l=null==n?void 0:n.id,a=L.getCollectionViewStores(),s=a.map((e=>e.id)),c=null!==(e=a[0])&&void 0!==e&&e.isDefined()?a[0]:void 0,d=L.id,u=(0,q().cf)({userId:r,viewBlockId:d}),p=Ne.RouterStore.state.route,g=L.getParentTable()===o(144081).zx,m=L.inMemoryRecordCache===Ne.defaultRecordCache.inMemoryRecordCache;let S;const h=e=>!!be||(!!s.includes(e)||"collectionSettings"===Ye.contextTypeFromStoreState);if(xe&&h(xe)?S=xe:g&&m&&"page"===p.name&&p.collectionViewId&&h(p.collectionViewId)?S=p.collectionViewId:t&&h(t.id)?S=t.id:u&&h(u)?S=u:c&&h(c.id)&&(S=c.id),S){const e=o(569797).p.createChildStore(L,{table:o(869558).Gy,id:S});if(e.isDefined()){S!==u&&(0,q().st)({userId:r,viewBlockId:d,viewId:S});const n=null==t?void 0:t.inMemoryRecordCache,a=null==e?void 0:e.inMemoryRecordCache,s=n!==a&&((null==n?void 0:n.name)===U().AGENT_PREVIEW_CACHE_NAME||(null==a?void 0:a.name)===U().AGENT_PREVIEW_CACHE_NAME),c=e.getCollectionStore();e&&(!_o.current||S!==i||s||c&&c.id!==l)&&(_o.current=!0,Ye.forceLocalQueryCollection=fe,(0,o(3167).d)({environment:Ne,collectionViewBlockStore:L,collectionViewStore:e,collectionStore:c,collectionContextStore:Ye,isFullScreen:Z??!1,productUseCase:re,isRootChild:L.isRootOrDirectChild(),isInPeekRenderer:Rt,viewsModuleContext:ie}))}}return{collectionViewStore:Ye.collectionViewStore(),collectionStore:Ye.collectionStore()}}),[L,Ye,Ne,Z,re,Rt,ie,fe,be,xe]),{frozenIndex:Vo,tableFrozenColumnIndex:Oo}=(0,k().K8)((()=>({frozenIndex:Ye.frozoneStore.state.frozenIndex,tableFrozenColumnIndex:null==Ro?void 0:Ro.getTableFrozenColumnIndex(Ye.frozoneStore.state.scrollerWidth,Ye.normalizedFormatStore.state)})),[Ye.frozoneStore,Ye.normalizedFormatStore,Ro]);(0,r.useEffect)((()=>{void 0===Vo&&Ro&&ho(Ro)}),[Ye,Ro,Vo,ho]);const Do=(0,r.useRef)(!1);(0,r.useEffect)((()=>(Do.current=!0,()=>{Do.current=!1})),[]);const zo=(0,r.useRef)(!0);(0,r.useEffect)((()=>{if(zo.current){const e=Mt();e&&(h().e.withListenerIgnored((()=>{const t=Ye.collectionStore(),o=(0,Lt().L0)(t),n=Ye.collectionViewStore(),r=null==n?void 0:n.getChartType(),i=null==n?void 0:n.getChartPlaceholderType();(0,l().u)({environment:Ne,event:{eventName:"database_visit",eventProperties:{collection_id:null==t?void 0:t.id,collection_view_id:null==n?void 0:n.id,collection_view_block_id:L.id,owned_collection_count:L.getOwnedCollectionStores().length,linked_collection_count:L.getLinkedCollectionStores().length,type:e,is_full_screen:Z,is_peek:Pt.state,peek_mode:ve().default.state.mode,database_visit_id:Ye.visitSessionId,chart_type:"placeholder"===r?i:r,is_chart_placeholder:"placeholder"===r,product_use_case:re,...o}}})})),zo.current=!1)}}),[]);const{value:Lo}=(0,T().fJ)($t().T.formulas);(0,r.useEffect)((()=>{(0,H().O9)(Lo)&&Ye.formulasCodeStore.setState(Lo)}),[Lo,Ye.formulasCodeStore]),(0,r.useEffect)((()=>{Ut(Ne)}),[Ne]),(0,r.useEffect)((()=>{h().e.withListenerIgnored((()=>{const e=Ye.collectionViewStore();if(e&&"collectionTypedView"===Ye.contextTypeFromStoreState){const t=Ye.databaseTypeFromStoreState,n=Mt();t&&n&&(0,o(601002).W)(Ne,"type_aggregated_database_visit",`type_aggregated_database_visit-${t}`,60,{collection_view_id:e.id,collection_view_block_id:L.id,type:n,databaseType:t,is_my_tasks:(0,o(696746).NY)("myTasks")===L.id})}}))}),[]),(0,r.useEffect)((()=>{const e=B().default.DO_NOT_USE_markLegacy("collections.collection_view_block_render");B().default.DO_NOT_USE_measureAfterNextFlushLegacy(e,{environment:Ne,getData:()=>({...(0,Lt().kz)(Ye),is_first_render:zo.current})})})),ht.current&&h().e.withListenerIgnored((()=>{if(!ht.current)return;const{from:e,to:t,metric:o,sizeHintAtStart:n}=ht.current;B().default.DO_NOT_USE_measureAfterNextFlushLegacy(o,{environment:Ne,getData:()=>{const o=(0,Lt().kz)(Ye),{view_type:r,row_count_category:i,...l}=o;return{from:e,to:t,did_trigger_fetch:Ye.isLoadingStore.state,row_count_category:(0,Lt().Cu)(n),...l}}}),ht.current=void 0})),(0,r.useEffect)((()=>{const e=()=>{var e;if(!Ye.isLoadedStore.state||!Do.current||Ye.wasCreatedThisSessionStore.state||Ye.didFireLoadEventsStore.state)return;Ye.didFireLoadEventsStore.setState(!0);const t=Ne.RouterStore.state;let r;"page"===t.route.name&&(r=t.route.mobileData);const l=null===(e=Ye.collectionViewStore())||void 0===e?void 0:e.getType(),a=()=>({...(0,Lt().kz)(Ye),wasm_sqlite_initialized:A().A.state.metricDataStore.state.wasm_sqlite_initialized,collectionViewType:l,...ao().A.getDatabaseNavigationMetrics(Fe,ze)});var s,c;if(Ye.isFullScreenStore.state)if(!A().A.state.initialRenderCompleted&&Ve){var d;o(561503).setInitialRenderCompleted(),n().oh.hackyOffsetParsesCorrectly()||(0,i().DO_NOT_USE_trackLegacy)(Ne,"luxon_hacky_offset_parses_correctly_false");const e=()=>{var e,t;const n=(0,Lt().kz)(Ye),i=Ye.collectionViewStore(),a=null==i?void 0:i.id,s=(0,Y().A)(a);return{...n,is_push:(null===(e=r)||void 0===e?void 0:e.isPush)??!1,collectionViewType:l,initial_route:Ne.RouterStore.state.initialRoute.name,prefetchCache:null===(t=Ne.prefetcher.cache)||void 0===t||null===(t=t.getPrefetchAnalytic(s))||void 0===t?void 0:t.type,cvb_loading_state:Ee,wasm_sqlite_initialized:A().A.state.metricDataStore.state.wasm_sqlite_initialized,is_mobile_background_launch:(0,o(248566).A)(),sub_metrics:Yt().getSubMetricsAndMetricDataForTracking({isPrewarmedTab:!1}).sub_metrics,includes_page_origin_to_app_start:!0}};B().default.measureFromPageOriginAfterNextFlush("initial_database_render",{environment:Ne,getData:e,shouldSendIfStatsigNotInitialized:!0}),null===(d=Ye.databaseItemsVisibleTracker)||void 0===d||d.handleInitialDatabaseRender()}else{var u;const{timings:e}=ao().A.popTimings();e&&B().default.measureAfterNextFlush({metricName:"navigation_database_render",startTime:e.navigationStart},{environment:Ne,getData:a}),lo().A.state.isMeasuring&&lo().A.update((e=>({...e,isMeasuring:!1}))),null===(u=Ye.databaseItemsVisibleTracker)||void 0===u||u.handleNavigationDatabaseRender(null==e?void 0:e.navigationStart)}else Ve?null===(s=Ye.databaseItemsVisibleTracker)||void 0===s||s.handleInitialDatabaseRender():(Fe&&B().default.measureAfterNextFlush({metricName:"navigation_database_render",startTime:Fe},{environment:Ne,getData:a}),null===(c=Ye.databaseItemsVisibleTracker)||void 0===c||c.handleNavigationDatabaseRender(Fe))};return Ye.isLoadedStore.addListener(e),e(),()=>{Ye.isLoadedStore.removeListener(e)}}),[Ye,Ne,Ve,Ee,Fe,ze]),(0,k().K8)((()=>{for(const t of L.getCollectionViewStores())t.getValue();const e=Ye.collectionStore();if(e){e.getTemplatePageStores().map((e=>e.getValue()))}}),[L,Ye]),(0,r.useEffect)((()=>{const e=()=>!ve().default.isCenterPeekOpen()&&M().A.state.isVisible,t=()=>{var t;e()&&(null===(t=ct.current)||void 0===t||t.maybeProcessDeferredCollectionEmit("page_show"))},o=()=>{var t;e()&&(null===(t=ct.current)||void 0===t||t.maybeProcessDeferredCollectionEmit("exit_peek"))};return M().A.addListener(t),ve().default.addListener(o),()=>{M().A.removeListener(t),ve().default.removeListener(o)}}),[ct]),(0,r.useEffect)((()=>{const e=e=>{o(778708).bE({environment:Ne,sprintSettingsContext:e.state})};return Ye.sprintSettingsContextStore.addListener(e),()=>{Ye.sprintSettingsContextStore.removeListener(e)}}),[Ye,Ne]),(0,r.useEffect)((()=>{const e=async e=>{if(e.state){const e=Ye.collectionViewBlockStore(),t=Ye.collectionViewStore(),o=Ye.collectionStore();if(!e||!t||!o)return;await(0,oe().M)(Ne,Ye,{src:"relative_variables_stale",queuedTimestamp:Date.now()})}};return Ye.relativeVariablesAreStaleStore.addListener(e),()=>{Ye.relativeVariablesAreStaleStore.removeListener(e)}}),[Ye,Ne,fe]);const{contextType:Ko,databaseType:Wo,remoteCollectionIds:Ho}=(0,k().K8)((()=>({contextType:Ye.contextTypeFromStoreState,databaseType:Ye.databaseTypeFromStoreState,remoteCollectionIds:Ye.remoteCollectionIdsStore.state})),[Ye]);(0,r.useEffect)((()=>{if(st.current)return;if("collectionTypedView"!==Ko||!Wo)return;const e=new(po().C)(Ne,(0,D().aW)({spaceId:L.getSpaceId(),databaseType:Wo}),((e,t)=>{var o;null===(o=ct.current)||void 0===o||o.handleCollectionEmit({src:"msg",passThroughData:t,shouldDeferCollectionEmit:mt(),isCollectionTypeChange:!0})}));e.subscribe(),st.current=e;const t=st.current;return()=>{t.unsubscribe()}}),[Ye,Ne,ct,L,Ko,Wo,mt]),(0,r.useEffect)((()=>{null==Ce||Ce(Ye)}),[Ce,Ye]),(0,r.useEffect)((()=>{null==we||we(Mt())}),[]),(0,r.useEffect)((()=>{void 0===Oo||Bt||Ye.frozoneStore.setState({...Ye.frozoneStore.state,frozenIndex:Oo})}),[Ye.frozoneStore,Bt,Oo]),(0,r.useEffect)((()=>{const e=e=>{const t=Array.from(at.current.keys()??[]),o=W().R9(t,e),n=W().R9(e,t);for(const i of o){var r;null===(r=at.current.get(i))||void 0===r||r.unsubscribe(),at.current.delete(i)}for(const i of n){const e=new(po().C)(Ne,(0,D().eG)(i),((e,t)=>{var o;null===(o=ct.current)||void 0===o||o.handleCollectionEmit({src:"msg",passThroughData:t,shouldDeferCollectionEmit:mt(),isCollectionTypeChange:!1})}));e.subscribe(),at.current.set(i,e)}};if(Bo)e([Bo.id]);else if("collectionTypedView"===Ko){e(Ho??[]);const t=t=>{e(t.state)};return Ye.remoteCollectionIdsStore.addListener(t),()=>{Ye.remoteCollectionIdsStore.removeListener(t)}}}),[Ye.remoteCollectionIdsStore,ct,Bo,Ko,Ne,Ho,L,mt]),(0,r.useEffect)((()=>{const e=at.current;return()=>{if(e)for(const t of e.values())t.unsubscribe()}}),[]);const No=(0,r.useMemo)((()=>({onFocus:Co,onBlur:ko,onMouseMove:Io,onMouseLeave:To})),[Co,ko,Io,To]);(0,r.useEffect)((()=>{var e;const t=null===(e=nt.current)||void 0===e?void 0:e.getNode();return t&&(0,S().P)(t,"scroll",Po),()=>{t&&(0,f().O)(t,"scroll",Po)}}),[Po]),(0,r.useEffect)((()=>()=>{(0,o(436371).u)({collectionContextStore:Ye})}),[Ye]),(0,r.useEffect)((()=>()=>{Je.destroy(),tt.destroy(),ot.destroy()}),[Je,tt,ot]),(0,r.useEffect)((()=>()=>{var e;null==rt||null===(e=rt.current)||void 0===e||e.disconnect()}),[]),(0,X().L)({collectionContextStore:Ye,collectionViewStore:Ro,isFullScreen:Boolean(Z),wasCreatedThisSessionStore:Ye.wasCreatedThisSessionStore,environment:Ne,didDelayOffscreenRenderRef:ut});const Go=(0,k().K8)((()=>{var e;return null===(e=a().AppStoreCurrentUserSettingsStore.state)||void 0===e?void 0:e.getSettings()}),[]),$o=(0,k().K8)((()=>_().A.getState().loaded),[]);(0,r.useEffect)((()=>{var e;if(!L.isCollectionView())return;const t=null===(e=Ye.collectionStore())||void 0===e?void 0:e.getFormat();if(!t)return;const n=(0,ye().cq)(L)?o(612587).A:o(150193).A,r=(0,o(838434).W)({collectionFormat:t,userSettings:Go,collectionStore:Ye.collectionStore(),collectionContextStore:Ye});r.shouldShowBanner?G().HQ({bannerStore:n,id:r.bannerId,contentKey:r.contentKey,styleKey:r.styleKey,blockStore:L,...L.isCollectionView()&&{context:R().R.CollectionViewBlockFullScreen}}):(G().zA({bannerStore:n,id:"JiraTwoWaySyncInfoBanner"}),G().zA({bannerStore:n,id:"AuthMissingForJiraSyncedCollectionPageBanner"}))}),[Ye,L,Ne,Go,Bo,$o]);const{pendingOpenSource:Uo,pendingOpenFrom:qo}=(0,k().O$)(Ht().y);(0,r.useEffect)((()=>{var e;const t=null===(e=Ye.collectionStore())||void 0===e?void 0:e.getFormat();if(!t)return;const o=Ye.settingsStore;t.external_collection_type&&t.synced_collection_external_url&&Uo&&(Q().eM({collectionSettingsStore:o,source:Uo,openedFrom:qo}),Ht().y.clearPendingOpen())}),[Ye,Uo,qo]);const Xo=(0,k().r6)((()=>{var e;const t=null==Bo?void 0:Bo.isSyncedCollection(),o=!0===(null==Bo||null===(e=Bo.getFormat().sync_state)||void 0===e?void 0:e.syncing);return Boolean(t&&o&&!g().A.isMobile)}),[Bo]);(0,k().O$)(Xo),(0,r.useEffect)((()=>{const e=async t=>{const n=await o(753812).callApi({eventName:"getExternalCollectionSyncState",environment:Ne,data:t});if("success"===n.type&&n.data.result){const o=n.data.result,r=Ye.numberChildrenReceivedStore,i=Ye.numberChildrenUnfurledStore;r.setState(o.numberChildrenReceived),i.setState(o.numberChildrenUnfurled),i.state/r.state<1&&(St.current=setTimeout((async()=>{await e(t)}),1e4))}},t=async()=>{if(Xo){const t=Ye.collectionStore(),o=null==t?void 0:t.getFormat().uri,n=null==t?void 0:t.getFormat().bot_id,r=null==t?void 0:t.id;if(!o||!n||!r)return;await e({uri:o,botId:n,collectionId:r})}};return Xo.addListener(t),()=>{Xo.removeListener(t),clearTimeout(St.current)}}),[Xo,Ye,Ne]);const Yo=Se||Boolean(null==qe?void 0:qe.disableContentPointerEvents),Qo=(0,Qt().bx)(L,Yo),Zo=(0,k().K8)((()=>!!Bo&&(0,O().Qu)(Bo.getValue())),[Bo]),Jo=(0,k().K8)((()=>(0,qt().s)(L.id)),[L]),en=(0,k().K8)((()=>(0,o(665020).W)(L.id)),[L]),tn=(0,k().K8)((()=>!!Jo&&Ye.isEmptyStore.state),[Jo,Ye]),on=(0,k().K8)((()=>!!en&&Ye.isEmptyStore.state),[en,Ye]),nn=(0,k().K8)((()=>(0,o(860116).I)(L.getAssociatedLayoutStore())),[L]),rn=(0,k().K8)((()=>Bt&&Jo&&0===Ye.collectionStoresStore.state.length&&Ye.isLoadedStore.state),[Bt,Jo,Ye]),ln=(0,k().K8)((()=>Bt&&en&&0===Ye.collectionStoresStore.state.length&&L.getCollectionViewStores().length<=1),[Bt,en,Ye,L]),an=(0,k().K8)((()=>{if(!Jo||tn)return!1;const e=a().AppStoreCurrentUserSettingsStore.state;if(null==e||!e.isDefined())return!1;return!(void 0!==e.getSettingsStore().getKeyStore("personal_home_my_tasks_main_callout_dismissed_at").getValue())}),[Jo,tn]),sn=(0,k().r6)((()=>{if(!yo||!vo||!(0,he().Ck)(L,void 0,Ke)||L.isCollectionViewPageWithContent())return{marginLeft:void 0,marginRight:void 0};return{marginLeft:void 0,marginRight:-(Wt().Qb/2)}}),[Ke,yo,vo,L]);(0,k().O$)(sn);const cn=(0,k().r6)((()=>{var e;if(rn||ln)return 0;const t="viewsMain"===(null===(e=Ye.viewsModuleContextStore)||void 0===e?void 0:e.getViewModuleType())&&!Ye.isDashboardWidget();return ue||"hidden"!==ae||!pe?t?go().WK:be||Ye.isInHomeWidgetStore.state?go().nh:go().Lq:0}),[rn,ln,Ye,ue,ae,pe,be]);(0,k().O$)(cn);const dn=function(e){const{collectionContextStore:t,previewContext:o,isPlaceholderExternalCollection:n}=e;return(0,k().K8)((()=>{var e,r,i;return Boolean(!n&&!(null!=o&&o.hideViewBlockSource)&&t.shouldShowSourceStore.state&&!t.isUnlistedViewStore.state&&!t.isInViewTabLayout()&&(null===(e=t.collectionStore())||void 0===e?void 0:e.canRead())&&"custom"!==(null===(r=t.collectionViewStore())||void 0===r?void 0:r.getType())&&"chat"!==(null===(i=t.collectionViewStore())||void 0===i?void 0:i.getType()))}),[t,o,n])}({collectionContextStore:Ye,previewContext:qe,isPlaceholderExternalCollection:Zo}),un=(0,k().K8)((()=>{var e;return(null===(e=Ye.collectionViewBlockStore())||void 0===e?void 0:e.getCollectionViewStores())??[]}),[Ye]),pn=(0,r.useMemo)((()=>{const e=1===(null==un?void 0:un.length);return dn&&(Z||!e)&&!Bt}),[dn,un,Z,Bt]),gn=(0,k().r6)((()=>{if(yt||ft||xt||Z)return!0;if("always_show"===ae)return!0;if(g().A.isMobile)return!0;if("form_editor"===Mt())return!0;const e=Ye.isInHomeWidgetStore.state,t=Ye.isDashboardWidget();if(!e&&!t)return!0;if(t&&Ye.getIsInDashboardBuildMode())return!0;if(Ye.settingsStore.state.open)return!0;if(Ye.searchOpenStore.state)return!0;if(Tt.state.open)return!0;if(kt.state.open)return!0;if(Ct.state.open)return!0;if(It.state.open)return!0;if(Ye.filterBarSortSettingsStore.state.open)return!0;if(Array.from(Ye.filterBarItemSettingsStoreMap.values()).some((e=>e.state.open)))return!0;return!!At.state.open}),[yt,ft,xt,Z,ae,Mt,Ye,Tt,kt,Ct,It,At]);(0,k().O$)(gn);const mn=(0,k().r6)((()=>Ye.collectionActionsMinimizedStore.state&&!Z?ne().xE.Collapsed:ne().xE.Expanded),[Ye.collectionActionsMinimizedStore,Z]);(0,k().O$)(mn);const Sn=(0,k().K8)((()=>{const e=Mt();return!!e&&(0,ee().II)({currentViewType:e,isPlaceholderExternalCollection:Zo,collectionContextStore:Ye,allowedActions:ge,settingsHeaderSizeObserver:tt})}),[Mt,Ye,ge,Zo,tt]);(0,k().K8)((()=>{Sn&&Q().IW({collectionSettingsStore:Ye.settingsStore,showAddItemButton:!0})}),[Sn,Ye]);const hn=(0,r.useCallback)((e=>{if(Ae)return void Ae(e);if(!Ye.collectionViewBlockStore()||!(0,co().E)(Ne,(0,s().f)(L)))return;const t=Ye.isMultiSourceViewFromStoreState;(0,o(414822).U)({userAction:"CollectionViewBlock.handleAddItemClick",environment:Ne,collectionContextStore:Ye,collectionViewBlockStore:L,shouldCoerce:!0,templateStore:Ye.defaultPageTemplateStore.state,showMoveTo:t,peekModeOverride:Bt?"center_peek":void 0,from:{createBlock:"cvb_add_item"}}),(0,N().X)({environment:Ne,collectionContextStore:Ye,action:"click_topbar_new_item"})}),[Ye,Ne,L,Bt,Ae]),yn=(0,r.useCallback)((e=>{const{target:t}=e;if(!Ro||g().A.isMobile||!(t instanceof HTMLElement))return;const o=Mt();o&&0===e.button&&function({viewType:e,isDashboardWidget:t}){return!t&&"form_editor"!==e&&"dashboard"!==e}({viewType:o,isDashboardWidget:Ye.isDashboardWidget()})&&(0,y().SQ)(e,y().y$.EditorMouseDown,(()=>{e.preventDefault(),(0,to().j)({environment:Ne,target:t,startX:e.clientX,startY:e.clientY,showSelectionRect:!0,preventSelectStores:[],allowVerticalEdgeScroll:!0,allowHorizontalEdgeScroll:"board"===o||"table"===o})}))}),[Ne,Ro,Mt,Ye]),vn=(0,r.useCallback)(((e,t)=>{(0,y().SQ)(e,y().y$.Click,(()=>{if(Pt.state||$().Cx(Ne),"page"===t&&!(0,v().Z)()){const{clientX:t,clientY:n,target:r}=e;b().default.afterNextFlush((()=>{et().createAndCommit({userAction:"CollectionViewBlock.PageView.click",environment:Ne,canUndo:!0,perform:e=>{(0,o(440577).t)(Ne,{x:t,y:n,target:r instanceof Element?r:void 0},e,nn)}})}))}}))}),[Ne,Pt,nn]),fn=(0,r.useMemo)((()=>W().sg(jo,100)),[jo]),bn=(0,r.useCallback)((()=>{io().A.state||bt(!0)}),[bt]),xn=(0,r.useCallback)((()=>{bt(!1)}),[bt]),wn=(0,r.useCallback)((e=>{e&&Je.observe(e)}),[Je]),Cn=(0,r.useCallback)((e=>{e&&ot.observe(e)}),[ot]),kn=(0,r.useCallback)((e=>{e&&tt.observe(e)}),[tt]),In=(0,r.useCallback)((e=>{var t,n;const r=null==e||null===(t=e.getNode())||void 0===t?void 0:t.classList.contains(o(771329).Dk);nt.current=r?e:(null==Qe?void 0:Qe.horizontalScroller)||null;const i=Ye.collectionViewStore();ho(i);const l=null===(n=nt.current)||void 0===n?void 0:n.getNode();"undefined"!=typeof ResizeObserver&&l&&(rt.current=new ResizeObserver(fn),rt.current.observe(l))}),[Ye,fn,ho,Qe]),Tn=(0,k().K8)((()=>{var e,t,n,r;if("form_editor"!==Mt()&&Ye.settingsStore.state.open&&"sidebar"===jt.state&&!0!==o(184701).b.state.visible)return(0,Ge.jsx)("div",{style:{paddingInlineStart:null===(e=wo.state)||void 0===e?void 0:e.paddingLeft,paddingInlineEnd:null===(t=wo.state)||void 0===t?void 0:t.paddingRight,marginInlineStart:null===(n=sn.state)||void 0===n?void 0:n.marginLeft,marginInlineEnd:null===(r=sn.state)||void 0===r?void 0:r.marginRight,borderTop:`1px solid ${K().Tj.border.primary}`,height:12}})}),[Ye,sn,wo,jt,Mt]),jn=(0,k().K8)((()=>{const e=null==Bo?void 0:Bo.getValue();return Boolean(e&&(0,O().SJ)(e))}),[Bo]),An=(0,k().K8)((()=>{var e;const t=Mt();if(t)return(0,te().B2)({blockStore:L,isFullScreen:Boolean(Z),collectionContextStore:Ye})||xo&&"feed"!==t?0:-((null===(e=wo.state)||void 0===e?void 0:e.paddingLeft)??0)}),[Mt,L,Z,wo,Ye,xo]),[Mn,Pn,_n]=(0,k().K8)((()=>[Ye.normalizedSchemaStore.state,Ye.normalizedQueryStore.state,Ye.normalizedFormatStore.state]),[Ye]),Rn=(0,k().K8)((()=>{if("library_external_pages"===(null==Ro?void 0:Ro.getType()))return"hidden";if("collectionTypedView"===Ye.contextTypeFromStoreState)return ae;if("collectionSystemView"===Ye.contextTypeFromStoreState){const e=Ye.collectionViewStore(),t=null==e?void 0:e.getCollectionSource();return(0,E().TR)(t)?"default":"hidden"}return"dashboard"===(null==Ro?void 0:Ro.getType())||Bo&&!1!==Bo.canRead()&&Bo.isDefined()?ae??"default":"hidden"}),[Ye,Bo,Ro,ae]),Bn=(0,r.useRef)(null),Vn=(0,k().K8)((()=>{var e,t,o,n;const r=Mt(),i=Ft&&!ve().default.isSidePeekOpeningStore.state&&!be,l=i?Z?{paddingInlineStart:(null==wo||null===(e=wo.state)||void 0===e?void 0:e.paddingLeft)??0,paddingInlineEnd:16}:{paddingInlineStart:0,paddingInlineEnd:((null==wo||null===(t=wo.state)||void 0===t?void 0:t.paddingRight)??0)+16}:(null==wo?void 0:wo.state)&&{paddingInlineStart:wo.state.paddingLeft,paddingInlineEnd:wo.state.paddingRight},a=(0,no().Uh)(Ne),s=(0,he().Ck)(L,void 0,Ke)||Z?a:Math.min(he().x6,a);return{minHeight:cn.state,paddingInlineStart:null==l?void 0:l.paddingInlineStart,paddingInlineEnd:null==l?void 0:l.paddingInlineEnd,width:de,position:"relative",insetInlineStart:xo&&"feed"!==r?0:-((null==l?void 0:l.paddingInlineStart)??0),flexShrink:0,...(Z||Xe||i)&&{position:"sticky",zIndex:86,insetInlineStart:0,width:!Ft||!l||Z||Xe||be?void 0:s-l.paddingInlineStart/2},...(0,eo().S)(L)&&{cursor:"default"},marginInlineStart:null===(o=sn.state)||void 0===o?void 0:o.marginLeft,marginInlineEnd:null===(n=sn.state)||void 0===n?void 0:n.marginRight,...Pe}}),[Ft,be,Z,wo,Ne,L,Ke,cn,de,Xe,sn,xo,Mt,Pe]),Fn=(0,r.useCallback)((e=>{(0,J().O)({collectionContextStore:Ye,collectionSettingsStore:Ye.settingsStore,hideSettingsHeader:!0,ref:e,initialStack:[{type:"linkToDatabase",existingCollectionStore:Bo,analytics:void 0}]})}),[Ye,Bo]),{currentViewType:En,paddingLeft:On}=(0,k().K8)((()=>{var e;return{currentViewType:Mt(),paddingLeft:null===(e=wo.state)||void 0===e?void 0:e.paddingLeft}}),[Mt,wo]),Dn="dashboard"===En;let zn;if(Ro&&Mn&&Pn&&_n&&En)if(Dt)zn=(0,Ge.jsx)(by,{store:L});else if(jn)zn=(0,Ge.jsx)(_t().RI,{value:Ye,children:(0,Ge.jsx)(p().s,{allowSelectionWithin:!0,style:Vn,onMouseDown:yn,onMouseMove:bn,onMouseLeave:xn,onClick:vn,ref:(0,z().Px)(wn,He),children:(0,Ge.jsx)(oo().Ay,{store:L,shouldShowHoverMenu:!0,analyticsName:(0,ne().LI)(En),shouldShowHalo:!Z&&!Xe&&!Bt,canSelect:!(Z||Xe||Bt||Vt),children:(0,Ge.jsx)(o(469732).A,{store:L,style:{width:"auto"},disabled:!1})})})});else if(ln)zn=(0,Ge.jsx)(_t().RI,{value:Ye,children:(0,Ge.jsx)("div",{ref:He,...No,style:{display:"contents"},children:(0,Ge.jsxs)("div",{style:(0,Jt().V$)({isPhone:We,themeMode:Le}),ref:Bn,children:[(0,Ge.jsx)("div",{style:{position:"relative"},children:(0,Ge.jsx)(BS,{currentViewType:En,headerSizeObserver:Je,contentSizeObserver:ot,settingsHeaderSizeObserver:tt,headerHeightStore:cn,viewSettingsPlacementStore:jt,store:L,leftRightPaddingStore:wo,isInHomeWidget:Bt,placementToOrigin:"right",alignmentToOrigin:"center",headerRef:Bn})}),(0,Ge.jsx)(Zt().Ww,{feature:"custom_db",onSetup:Fn})]})})});else{const e=(0,Ge.jsx)(AS,{collectionContentWrapperStyle:Me,collectionContextStore:Ye,store:L,collectionStore:Bo,collectionViewStore:Ro,currentViewType:En,isDisabled:Yo,isFullScreen:Boolean(Z),isInPeek:Rt,isPreviewing:Xe,isRootOrDirectChild:yo,headerSizeObserver:Je,timelineViewRef:it,showHoverActionsStore:gn,handleAddItemClick:hn,isPlaceholderExternalCollection:Zo,isMyTasksEmpty:tn,isInFrameWhenSidePeekOpen:Ft,query:Pn,schema:Mn,format:_n,showHomeCustomDbEmptyState:ln,maxHeight:me,viewSettingsPlacementStore:jt,templatePickerMenuListStore:Te,editorContentContainerRef:je,showMyTasksEmptyState:rn,showMyTasksAddSourcesCallout:an,isInHomeWidget:Bt,isUnlistedView:be,isHomeCustomDbEmpty:on,handleHorizontalScrollerMount:In,handleEditorMouseDown:yn,handleEditorClick:vn,leftRightPaddingStore:wo,handleContentMount:Cn,rootRef:He,isViewModule:Vt,additionalCollectionViewInnerHorizontalPadding:Ie,scrollerLeftPadding:Xt,headerHeightStore:cn,fullWidth:de,contentEditableVoidLeft:An,leftRightMarginStore:sn});zn=(0,Ge.jsx)(_t().RI,{value:Ye,children:(0,Ge.jsx)(o(532564).Z,{value:Ze,children:(0,Ge.jsxs)("div",{ref:He,...No,style:{display:"contents"},children:[Z?void 0:(0,Ge.jsx)("div",{style:{position:"relative"},children:(0,Ge.jsx)(BS,{currentViewType:En,headerSizeObserver:Je,contentSizeObserver:ot,settingsHeaderSizeObserver:tt,headerHeightStore:cn,viewSettingsPlacementStore:jt,store:L,leftRightPaddingStore:wo,isInHomeWidget:Bt,headerRef:Bn,handleAddItemClick:hn})}),(0,Ge.jsx)(Ot,{}),(0,Ge.jsx)(Eo,{isFullScreen:Boolean(Z),leftRightPaddingStore:wo,leftRightMarginStore:sn,overrideViewType:le}),pn?(0,Ge.jsx)(p().s,{allowSelectionWithin:!0,onMouseDown:yn,onMouseMove:bn,onMouseLeave:xn,ref:(0,z().Px)(wn,Bn),style:{position:"sticky",insetInlineStart:0},children:(0,Ge.jsx)("div",{style:{marginBottom:6},children:(0,Ge.jsx)(pt,{store:L,collectionContextStore:Ye,showHoverActionsStore:gn,isFullScreen:Boolean(Z),canEdit:Qo,paddingLeft:On})})}):void 0,(0,Ge.jsx)(Sy,{currentViewType:En,store:L,headerWrapStyle:Vn,headerActionsBehavior:Rn,allowedActions:ge,hideViewTabBar:pe??!1,showHoverActionsStore:gn,headerSizeObserver:Je,isFullScreen:Boolean(Z),isInHomeWidget:Bt,isMyTasksPage:Jo,isHomeCustomDbPage:en,isPlaceholderExternalCollection:Zo,collectionViewHeaderText:ue,handleEditorMouseDown:yn,handleHeaderMouseMove:bn,handleHeaderMouseLeave:xn,handleHeaderMount:wn,handleSettingsHeaderMount:kn,leftRightPaddingStore:wo,headerHeightStore:cn,canEdit:Qo,viewSettingsPlacementStore:jt,contentSizeObserver:ot,settingsHeaderSizeObserver:tt,handleAddItemClick:hn,timelineViewRef:it,filterBarCreateFilterSettingsStore:It,createFilterSettingsStore:Ct,createFollowSettingsStore:kt,switchViewMetric:ht,showOnlyCurrentView:Boolean(ke),headerRef:Bn,headerStyleOverrides:{...be&&{paddingInlineStart:24,paddingInlineEnd:24,paddingTop:12}},minimizedActionViewStore:mn,draggableHeaderProps:Be,forceDropdownState:_e}),"form_editor"===En?(0,Ge.jsx)(c().N,{capture:!0,allowSearch:!0,allowEsc:!0,allowUndo:!0,allowOpenLinkMenu:!0,allowBackspace:!0,allowMenuList:!0,wrapperTag:"div",children:e}):e,Tn,(0,Ge.jsx)(uo().DG,{collectionContextStore:Ye,paddingLeft:On}),(0,Ge.jsx)(Ao,{skipTracking:Dn,collectionContextStore:Ye,collectionViewBlockRenderStartTime:lt,didDelayOffscreenRenderRef:ut,mountedBeforeInitialPageRender:Ve,cvbLoadingStateOnInitialRender:Ee,lazyRenderStartedAtRef:Oe,trackPendingCollectionItemRender:De,dependencyLoadingMetrics:ze}),(0,Ge.jsx)(fo,{collectionContextStore:Ye,mountedBeforeInitialPageRender:Boolean(Ve)})]})})})}else zn=null;return(0,Qt().NW)(L,t,(0,k().K8)((()=>({renderedType:"collection_view_page"===L.getType()?"collection_view_page":"collection_view",getBlockStore:()=>L,getNode:()=>He.current,collectionContextStore:Ye,resetLeftScrollAfterFlush:()=>{b().default.afterNextFlush((()=>{var e;const t=null===(e=nt.current)||void 0===e?void 0:e.getNode();if(t){t.scrollLeft=0;const e=(0,F().T8)(t);e&&(e.scrollLeft=0)}}))},handleCreated:()=>vy(Ne,Ye)})),[L,Ye,Ne]),zn)})));function vy(e,t){(0,Ye().I)({environment:e}),b().default.afterNextFlush((()=>{const o=t.collectionStore(),n=t.collectionViewStore(),r=t.collectionViewBlockStore(),i=t.settingsStore;if(!r)return;const l=r.getCollectionStoreIfSingleSource(),a=null==n?void 0:n.getType(),s=null!=n&&n.id?(0,re().v)(null==n?void 0:n.id):void 0;if(null!=s&&s.shouldOpenDashboardBuildMode&&t.setIsInDashboardBuildMode(!0),o&&(0,O().Qu)(o.getValue()))Q().Ho({collectionSettingsStore:i});else if(l)"form_editor"!==a?((0,J().O)({collectionContextStore:t,collectionSettingsStore:i}),Q().R8({collectionSettingsStore:i,item:{type:"createViewSource",existingCollectionStore:l,createdCollectionRecordPointerMap:void 0,analytics:void 0}}),"chart"===a&&t.isCreatingNewChartCollectionStore.setState(!0)):(0,le().P)({environment:e,collectionContextStore:t});else if(o)n?(!function(e){var t;const{collectionStore:o,collectionViewStore:n,collectionViewBlockStore:r,collectionContextStore:i,environment:l}=e,a=null==n?void 0:n.id,s=a?null===(t=(0,re().v)(a))||void 0===t||null===(t=t.viewPointer)||void 0===t?void 0:t.id:void 0,c=ne().Mf({collectionStore:o,sourceCollectionViewBlockStore:r,currentCollectionViewBlockStore:r,currentCollectionViewStore:n,constraints:(0,re().v)(n.id)}).find((e=>e.id===s));c&&(0,ie().U)({viewToDuplicateStore:c,collectionContextStore:i,collectionViewStore:n,environment:l})}({collectionStore:o,collectionViewStore:n,collectionViewBlockStore:r,collectionContextStore:t,environment:e}),(0,J().O)({collectionContextStore:t,collectionSettingsStore:i}),Q().R8({collectionSettingsStore:i,item:{type:"duplicateExistingView"}})):(0,Z().M)({environment:e,collectionStore:o,collectionContextStore:t,collectionSettingsStore:i});else{const e=null==s?void 0:s.viewSettingsStack;"skip"!==(null==e?void 0:e.type)&&(0,J().O)({collectionContextStore:t,collectionSettingsStore:i,initialStack:null==e?void 0:e.stack})}}))}const fy=yy;function by({store:e}){const t=(0,x().v3)(),n=(0,I().DP)();return(0,k().K8)((()=>{const r=e.getSpaceId();return(0,Ge.jsx)(Ge.Fragment,{children:Xt().S5({environment:t,textValue:{value:[L().Ey_(e.pointer.id,[["p",e.pointer.id,r]])],spaceId:r},parentStore:e,disableHover:!1,disableStyleAnnotations:!1,disableInsertedDeletedAnnotations:!1,disableDateStyleAnnotations:!1,disableSuggestionAnnotations:!1,disabled:!1,emojiType:(0,o(712030).FN)(t),theme:n,katex:t.KatexStore.getKatex(),formulaValueTypes:[]})})}),[t,e,n])}},636740:(e,t,o)=>{function n(e){const{dateRangeStart:t,dateRangeEnd:o,collectionContextStore:n}=e;n.dateRangeStartStore.setState(t),n.dateRangeEndStore.setState(o)}o.d(t,{r:()=>n})},637096:(e,t,o)=>{o.d(t,{W:()=>d});var n=o(296540),r=()=>o(907258),i=()=>o(484714),l=()=>o(590526),a=()=>o(365917),s=()=>o(40970),c=()=>o(645200);function d(e){const{collectionContextStore:t,entrypoint:o}=e,d=(0,i().v3)(),u=(0,l().O$)(r().AppStoreSidebarSpaceStore),p=(0,l().O$)(a().X);return(0,n.useCallback)((()=>{const e=t.collectionViewStore(),n=t.collectionStore(),r=null==n?void 0:n.getParentBlockStore();e&&n&&r&&u&&(s().tC(d,{is_calendar_connected:p,collection_id:n.id,collection_view_id:e.id,collection_view_block_id:r.id,entrypoint:o}),c().Op({environment:d,collectionViewStore:e,spaceStore:u,from:"openInCalendarButton"}))}),[d,t,u,p,o])}},638001:(e,t,o)=>{o.d(t,{j:()=>n});const n=o(757695).Store.createValue(void 0,{name:"CurrentFullScreenCollectionContextStore"})},646355:(e,t,o)=>{o.d(t,{KD:()=>s,gt:()=>c,i9:()=>a,ll:()=>i,tb:()=>l,x$:()=>r});o(18107),o(967357);var n=()=>o(541235);function r(e,t){return i(c(e,t))}function i(e){return void 0!==e&&(e===n().q_||e===n().YD)}function l(e,t){if(i(t))return;const o=n().c$[e],r=o.steps.findIndex((e=>e.id===t));return-1===r?o.steps[0].id:r===o.steps.length-1?n().q_:o.steps[r+1].id}function a(e,t){const o=c(e,t);if(o&&!i(o))return l(t,o)}function s(e,t){const o=c(e,t);if(o)return function(e,t){const o=n().c$[e];var r;if(i(t))return null===(r=o.steps.at(-1))||void 0===r?void 0:r.id;const l=o.steps.findIndex((e=>e.id===t));return-1!==l&&0!==l?o.steps[l-1].id:void 0}(t,o)}function c(e,t){var o;if(!e)return;const r=((null===(o=e.getSettings())||void 0===o?void 0:o.tutorials)||{})[t];return void 0===r?n().c$[t].steps[0].id:r}},646836:(e,t,o)=>{o.r(t),o.d(t,{default:()=>u});var n=o(296540),r=()=>o(81068),i=()=>o(663639),l=()=>o(736847),a=()=>o(69708),s=()=>o(100622),c=o(474848);const d=(0,a().YK)({relation:{defaultMessage:"This relation links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceRelationError.message"},formula:{defaultMessage:"This formula links to another workspace. Cross-workspace features are limited, so syncing may break and filtering, sorting, and search will not work.",id:"collection.tableHeaderCell.crossSpaceFormulaError.message"},linkedView:{defaultMessage:"This view references content from another workspace. Cross-workspace functionality is limited, so some content may not sync correctly.",id:"collection.tableHeaderCell.crossSpaceLinkedViewError.message"}}),u=n.memo((function({type:e}){const t=(0,o(484714).v3)(),u=(0,a().tz)(),p=(0,n.useRef)(null),g=(0,o(401497).IS)((()=>({icon:{fill:s().Tj.orange.icon.accentPrimary},text:{width:300,color:s().Tj.text.secondary,padding:"12px 16px",fontSize:14},footer:{display:"flex",flexDirection:"row",justifyContent:"space-between",borderTop:`1px solid ${s().Tj.border.secondary}`},button:{width:"auto"},dismissButton:{color:s().Tj.blue.text.accentPrimary},learnMoreButton:{color:s().Tj.text.secondary},learnMoreIcon:{marginInlineEnd:0}})),[]),m=(0,o(232930).x)("guides.duplicateToSpace"),S=(0,n.useCallback)((()=>(0,c.jsxs)(o(890492).A,{menuType:o(546926).gu.Popup,children:[(0,c.jsx)(l().A,{style:g.text,children:u.formatMessage(d[e])}),(0,c.jsx)(i().A,{type:i().O.Vertical,initialFocus:void 0,sections:[{key:"footer",items:[{key:"dismiss",action:()=>{var e;null===(e=p.current)||void 0===e||e.setOpen(!1)},render:e=>(0,c.jsx)(r().A,{...e,title:(0,c.jsx)(a().sA,{defaultMessage:"Dismiss",id:"collection.tableHeaderCell.crossSpaceRelationError.dismiss"}),buttonStyle:{...g.button,...g.dismissButton}})},{key:"learn-more",action:e=>{var n,r,i;null===(n=(r=e.event).preventDefault)||void 0===n||n.call(r),null===(i=p.current)||void 0===i||i.setOpen(!1),(0,o(246766).navigate)({environment:t,url:m,openInNew:"tab"})},render:e=>(0,c.jsx)(r().A,{...e,title:(0,c.jsx)(a().sA,{defaultMessage:"Learn more",id:"collection.tableHeaderCell.crossSpaceRelationError.learnMore"}),icon:(0,c.jsx)(o(807449).I,{icon:o(721479).questionMarkCircleSmallIcon,size:"sm"}),desktopIconStyle:g.learnMoreIcon,buttonStyle:{...g.button,...g.learnMoreButton},href:m,external:!0})}],render:e=>(0,c.jsx)(l().A,{...e,style:g.footer})}]})]})),[g,u,t,m,e]),h=(0,n.useCallback)((t=>(0,c.jsx)(o(695115).A,{icon:o(765974).exclamationMarkTriangleFillIcon,iconStyle:g.icon,ariaLabel:u.formatMessage(d[e]),...t})),[g,u,e]);return(0,c.jsx)(o(250910).A,{popupType:o(30537).n.Popup,render:S,renderOrigin:h,ref:p})}))},662971:(e,t,o)=>{o.d(t,{A:()=>g});var n=o(296540),r=()=>o(30537);const i=function(){const[e,t]=n.useState({x:0,y:0});return n.useEffect((()=>{const e=e=>{t({x:e.clientX,y:e.clientY})};return window.addEventListener("mousemove",e),()=>{window.removeEventListener("mousemove",e)}}),[]),e};var l=o(474848);function a({x:e,mouseX:t}){return t>e?void 0:-Math.max(e-t,10)+"px"}function s({x:e,width:t,mouseX:o}){return o>e?-Math.max(o-(e+t),10)+"px":void 0}function c({x:e,width:t,mouseX:o}){return o>e?`${Math.max(o-(e+t),10)}px`:`${Math.max(e-o,10)}px`}function d({x:e,y:t,height:o,mouseX:n,mouseY:r}){return n>e?`polygon(0% 0%, 0% 100%, 100% ${100*(r-t)/o}%)`:`polygon(100% 0%, 0% ${100*(r-t)/o}%, 100% 100%)`}function u(e){const{x:t=0,y:o=0,height:r=0,width:u=0}=e.el.getBoundingClientRect()||{},{x:p,y:g}=i(),m={x:t,y:o,height:r,width:u,mouseX:p,mouseY:g},S=(0,n.useRef)(null),h=n.useCallback((e=>{if(S.current){S.current.style.pointerEvents="none";const t=document.elementFromPoint(e.clientX,e.clientY);if(S.current.style.pointerEvents="auto",t){const o=new MouseEvent(e.nativeEvent.type,e.nativeEvent);t.dispatchEvent(o)}}}),[]),y={insetInlineEnd:s(m),insetInlineStart:a(m),height:r,width:c(m),clipPath:d(m)};return(0,l.jsx)("div",{ref:S,onClick:h,style:{cursor:"pointer",position:"absolute",pointerEvents:"auto",top:0,...y}})}function p({onClick:e,renderOrigin:t,renderExtension:i,allowOptionalExtensionMenu:a,...s},c){const{disabled:d,disableDefaultClick:p,onFocus:g,focused:m,openOnFocus:S,placementToOrigin:h,alignmentToOrigin:y,disableCloseOnEnter:v,bottomSheetInitialState:f,popupTypeOverride:b}=s,x=(0,o(484714).WS)(),w=(0,o(546926).Tf)(),[C,k]=(0,n.useState)(!1),I=(0,n.useRef)(null),T=(0,n.useRef)(null),j=(0,n.useRef)(null),A=(0,n.useRef)(null),M=(0,n.useCallback)((()=>{j.current&&window.clearTimeout(j.current),A.current&&window.clearTimeout(A.current),j.current=null,A.current=null}),[]),P=(0,n.useCallback)((()=>{M(),d||k(!0)}),[d,M]),_=(0,n.useCallback)((()=>{M(),k(!1)}),[M]),R=(0,n.useCallback)((e=>{M(),C||(e&&e.preventDefault&&e.preventDefault(),j.current=window.setTimeout(P,120))}),[C,M,P]),B=(0,n.useCallback)((()=>{M(),C&&(A.current=window.setTimeout(_,100))}),[C,_,M]),V=(0,n.useCallback)((t=>{g(),P(),a&&(null==e||e(t),_())}),[g,P,a,e,_]),F=(0,n.useCallback)((()=>{R()}),[R]),E=(0,n.useCallback)((()=>{g(),R()}),[g,R]),O=(0,n.useCallback)((e=>{if(o(726637).A.isMobile)return;const t=I.current;C&&t&&!t.contains(e.target)&&_()}),[C,_]),D=(0,n.useCallback)((e=>{13===e.keyCode&&C&&!v&&_()}),[C,_,v]);(0,n.useEffect)((()=>{if(!Boolean(p))return window.addEventListener("click",O),()=>{window.removeEventListener("click",O)}}),[p,O]),(0,n.useEffect)((()=>(window.addEventListener("keydown",D),()=>{window.removeEventListener("keydown",D)})),[D]);const z=(0,n.useRef)(m);(0,n.useEffect)((()=>{S&&!z.current&&m?R():!m&&z.current&&B(),z.current=m}),[m,S,R,B]);const L=(0,o(401497).IS)((()=>({mobilePopupStyle:{borderRadius:12,backgroundColor:o(100622).Tj.background.secondary}})),[]),K={...(0,o(383036).A)({onMouseEnter:F,onClick:V},s),showExtensionArrow:!0};let W=r().n.Popup;return b?W=b:x&&(W=w?r().n.BottomSheet:r().n.SlideUp),(0,l.jsx)(o(782482).N,{debugName:"ExtensionMenuItem",capture:m,onEnter:C?void 0:R,onRight:R,onLeft:C?B:void 0,onEsc:C?B:void 0,children:(0,l.jsx)(o(127833).zD,{popupType:W,bottomSheetInitialState:f,open:C,origin:t(K,c),placementToOrigin:h??"right",alignmentToOrigin:y??"center",originGap:0,disableMouseCapture:!0,preventBlockRenderQueueOnEnter:!0,preventScaleTransition:!x,preventCaptureEsc:!0,ref:I,render:()=>(0,l.jsxs)(l.Fragment,{children:[!x&&T.current?(0,l.jsx)(u,{el:T.current}):null,(0,l.jsx)("div",{ref:T,style:{height:"100%"},children:i({onMouseEnter:E},{close:B})})]}),style:{overflow:"visible",...x&&L.mobilePopupStyle},trapFocus:!0,onDismiss:_})})}const g=n.forwardRef(p)},673657:(e,t,o)=>{o.d(t,{n:()=>i});var n=()=>o(590526),r=()=>o(964345);function i(e){return(0,n().K8)((()=>r().gZ.state&&(null==e?void 0:e.id)===r().Di.state),[e])}},701751:(e,t,o)=>{o.d(t,{p:()=>i});o(296540);var n=o(474848);const r={viewBox:"0 0 20 20",fittedViewBox:"3.97 1.94 14.91 15.66",svg:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("path",{d:"M10.55 12.808a1.35 1.35 0 1 0-1.1 0v1.242a.55.55 0 1 0 1.1 0z"}),(0,n.jsx)("path",{d:"M15.4 1.95a3.48 3.48 0 0 0-3.48 3.48v1.92H6.4a2.425 2.425 0 0 0-2.425 2.425v5.4A2.425 2.425 0 0 0 6.4 17.6h7.2a2.425 2.425 0 0 0 2.425-2.425v-5.4A2.425 2.425 0 0 0 13.6 7.35h-.43V5.43a2.23 2.23 0 1 1 4.46 0v2.095a.625.625 0 1 0 1.25 0V5.43a3.48 3.48 0 0 0-3.48-3.48M5.225 9.775c0-.649.526-1.175 1.175-1.175h7.2c.649 0 1.175.526 1.175 1.175v5.4c0 .649-.526 1.175-1.175 1.175H6.4a1.175 1.175 0 0 1-1.175-1.175z"})]})},i=(0,o(340498).wt)("lockOpen",r,"default")},713590:(e,t,o)=>{o.d(t,{C8:()=>p,Dz:()=>s,GC:()=>m,GL:()=>S,YY:()=>g,dM:()=>d,h9:()=>c,jX:()=>a,oF:()=>u,uj:()=>l});var n=()=>o(79926);const r={JiraSyncInfoPopup:new(n().O2)("JiraSyncInfoPopup",(async()=>await Promise.all([o.e(75134),o.e(68744)]).then(o.bind(o,664932)))),ImproveJiraSyncPopup:new(n().O2)("ImproveJiraSyncPopup",(async()=>await Promise.all([o.e(75134),o.e(2686)]).then(o.bind(o,787797)))),JiraDCAuthModal:new(n().O2)("JiraDCAuthModal",(async()=>await Promise.all([o.e(63515),o.e(28763)]).then(o.bind(o,363524)))),ExternalImportAndSyncIndicator:new(n().O2)("ExternalImportAndSyncIndicator",(async()=>await o.e(98288).then(o.bind(o,366792)))),JiraSyncedAllProjectsTooltip:new(n().O2)("JiraSyncedAllProjectsTooltip",(async()=>await o.e(21446).then(o.bind(o,844291)))),JiraSyncedAllIssuesTooltip:new(n().O2)("JiraSyncedAllIssuesTooltip",(async()=>await o.e(21446).then(o.bind(o,844291)))),JiraSyncedDatabaseViewsAndFiltersTooltip:new(n().O2)("JiraSyncedDatabaseViewsAndFiltersTooltip",(async()=>await o.e(21446).then(o.bind(o,844291)))),JiraSyncSourceTooltip:new(n().O2)("JiraSyncSourceTooltip",(async()=>await o.e(21446).then(o.bind(o,844291)))),JiraSyncedSettingsToSetupProjectsAndIssuesTooltip:new(n().O2)("JiraSyncedSettingsToSetupProjectsAndIssuesTooltip",(async()=>await o.e(21446).then(o.bind(o,844291))))},i={JiraSyncTeamSpaceModal:new(n().O2)("JiraSyncTeamSpaceModal",(async()=>Promise.all([o.e(35530),o.e(36556),o.e(55373),o.e(36192),o.e(27992),o.e(63452),o.e(66249),o.e(87249),o.e(79022),o.e(34877),o.e(11676),o.e(94522),o.e(38293),o.e(63515),o.e(55162),o.e(71003),o.e(32370),o.e(26264),o.e(64242),o.e(47160),o.e(76677),o.e(42056),o.e(53697),o.e(3261),o.e(54219),o.e(56188)]).then(o.bind(o,324026))))},l=(0,n()._h)(i.JiraSyncTeamSpaceModal,(e=>e.default)),a=(0,n()._h)(r.JiraSyncedAllProjectsTooltip,(e=>e.JiraSyncedAllProjectsTooltip)),s=(0,n()._h)(r.JiraDCAuthModal,(e=>e.default)),c=(0,n()._h)(r.JiraSyncedAllIssuesTooltip,(e=>e.JiraSyncedAllIssuesTooltip)),d=(0,n()._h)(r.JiraSyncedDatabaseViewsAndFiltersTooltip,(e=>e.JiraSyncedDatabaseViewsAndFiltersTooltip)),u=(0,n()._h)(r.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip,(e=>e.JiraSyncedSettingsToSetupProjectsAndIssuesTooltip)),p=(0,n()._h)(r.JiraSyncSourceTooltip,(e=>e.JiraSyncSourceTooltip)),g=(0,n()._h)(r.JiraSyncInfoPopup,(e=>e.JiraSyncInfoPopup)),m=(0,n()._h)(r.ImproveJiraSyncPopup,(e=>e.ImproveJiraSyncPopup)),S=(0,n()._h)(r.ExternalImportAndSyncIndicator,(e=>e.ExternalImportAndSyncIndicator))},739375:(e,t,o)=>{o.d(t,{RY:()=>S,ir:()=>h,xc:()=>p,yv:()=>m});var n=()=>o(242422),r=()=>o(726637),i=()=>o(484714),l=()=>o(590526),a=()=>o(929219),s=()=>o(891360),c=()=>o(506050),d=()=>o(748197),u=()=>o(353890);function p(){const e=(0,i().v3)(),t=(0,l().O$)(a().e),{state:o,canEdit:n,isEnabled:r,store:d}=(0,u().s)(),p=(0,l().K8)((()=>c().L.state.dismissed.includes("nux")),[]),m=(0,l().K8)((()=>{const e=s().W.state;return e&&"available"===e.type?e.usage:1/0}),[]);return g({environment:e,state:o,isOnline:t,canUse:r&&n,hasSeenNux:p,usage:m,creatorId:(0,l().K8)((()=>d.getCreatedById()??""),[d])})}function g(e){const{environment:t,isOnline:o,canUse:n,state:r,hasSeenNux:i,usage:l,creatorId:a}=e;return a===t.currentUser.id&&(!i&&(!!o&&(!!n&&("initial"===r.state&&0===l))))}function m({disableExposureLogging:e=!1}={}){const t=(0,l().O$)(a().e);return(0,l().K8)((()=>n().default.checkGate({gateName:"ai_meeting_notes_demo_available",disableExposureLogging:e})&&t),[t,e])}function S({disableExposureLogging:e=!1}={}){return n().default.checkGate({gateName:"ai_meeting_notes_demo_available",disableExposureLogging:e})&&a().A.state.online}function h(e){var t;const{environment:o,state:i,isOnline:l,canUse:a,dismissedAnnotations:c,store:u}=e;if(r().A.isMobile)return!1;if(c.includes("demo-banner"))return!1;if(!d().c.state.demoVideoModalOpenForBlockId&&"initial"!==i.state)return!1;if(!g({environment:o,isOnline:l,canUse:a,state:i,hasSeenNux:!1,usage:"available"===(null===(t=s().W.state)||void 0===t?void 0:t.type)?s().W.state.usage:1/0,creatorId:u.getCreatedById()??""}))return!1;if(!S())return!1;return"on"===n().default.getEligibleGroup({experimentId:"ai_meeting_notes_demo_nux_banner",defaultGroup:"control",disableExposureLogging:!1})}},740689:(e,t,o)=>{o.d(t,{o:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"1.77 1.79 12.45 12.42",svg:(0,o(474848).jsx)("path",{d:"M8.708 1.978a.625.625 0 0 0-.884.884l.914.913H3.84c-1.14 0-2.065.925-2.065 2.065v4.78a.625.625 0 0 0 1.25 0V5.84c0-.45.365-.815.815-.815h4.898l-.914.913a.625.625 0 0 0 .884.884l1.98-1.98a.625.625 0 0 0 0-.884zM13.6 4.755a.625.625 0 0 0-.625.625v4.78c0 .45-.365.815-.815.815H7.263l.913-.913a.625.625 0 0 0-.884-.884l-1.98 1.98a.625.625 0 0 0 0 .884l1.98 1.98a.625.625 0 1 0 .884-.884l-.913-.913h4.897c1.14 0 2.065-.924 2.065-2.065V5.38a.625.625 0 0 0-.625-.625"})},r=(0,o(340498).wt)("arrowSquareLeftRightSmall",n,"small")},782473:(e,t,o)=>{o.d(t,{Nu:()=>l,Sw:()=>n,gO:()=>r,j$:()=>i});const n=220,r=24,i=-7,l=-3},783793:(e,t,o)=>{o.d(t,{o:()=>c,x:()=>s});o(296540);var n=()=>o(401497),r=()=>o(100622),i=()=>o(278589),l=()=>o(200424),a=o(474848);function s(e){const{variant:t,imgSource:o,tintColor:l,faceStyle:s,shadowVariant:d="strong",style:u,...p}=e,g=(0,n().IS)((()=>{const e=(0,i().N)(t);return{faceImgWrap:{width:e,height:e,borderRadius:"100%",background:r().Tj.assistantCornerButtonBackground,..."strong"===d&&{boxShadow:e>=90?r().Tj.shadowMDThickerOutline:r().Tj.shadowMD},..."light"===d&&{borderRadius:"50%",boxShadow:e>=90?r().Tj.shadowSMThickerOutline:r().Tj.shadowSM},overflow:"hidden",...u}}}),[t,d,u]);return(0,a.jsx)("div",{...p,children:(0,a.jsx)("div",{style:g.faceImgWrap,children:(0,a.jsx)(c,{imgSource:o,variant:t,tintColor:l,style:s})})})}function c(e){const{imgSource:t,variant:o,tintColor:r,style:s,alt:c,...d}=e,u=(0,i().N)(o),p=t??l(),g=c??"Notion AI face",m=(0,n().IS)((()=>({faceImg:{height:u,width:u,transform:"scaleX(var(--direction, 1))",...s},tintedFace:{height:u,width:u,transform:"scaleX(var(--direction, 1))",backgroundColor:r,WebkitMaskImage:`url(${p})`,maskImage:`url(${p})`,WebkitMaskRepeat:"no-repeat",maskRepeat:"no-repeat",WebkitMaskPosition:"center",maskPosition:"center",WebkitMaskSize:"contain",maskSize:"contain",...s}})),[u,s,r,p]);return void 0!==r?(0,a.jsx)("div",{style:m.tintedFace,role:"img","aria-label":g}):(0,a.jsx)("img",{...d,style:m.faceImg,src:p,alt:g})}},791177:(e,t,o)=>{o.d(t,{$:()=>r});var n=o(296540);function r(){const[e,t]=(0,n.useState)({inputElementAttributes:void 0,suppressFocusRing:!1}),[o,r]=(0,n.useState)(!1),[i,l]=(0,n.useState)(!1);(0,n.useEffect)((()=>{if(o){function e(){l(!1)}function t(e){"ArrowDown"!==e.key&&"ArrowUp"!==e.key||l(!0)}return window.addEventListener("pointerdown",e),window.addEventListener("keydown",t),()=>{window.removeEventListener("pointerdown",e),window.removeEventListener("keydown",t)}}}),[o]);return[(0,n.useMemo)((()=>({inputElementAttributes:e.inputElementAttributes,suppressFocusRing:e.suppressFocusRing&&i,onFocus:()=>{r(!0)},onBlur:()=>{r(!1)}})),[e,i]),(0,n.useMemo)((()=>({setComboboxState:t,isFocusVisible:i,isComboboxFocused:o,onItemHover:()=>{l(!1)}})),[i,o])]}},803960:(e,t,o)=>{o.r(t),o.d(t,{arrowChevronSingleDownIcon:()=>r,iconDefinition:()=>n});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"3.97 6.97 12.06 6.66",svg:(0,o(474848).jsx)("path",{d:"M9.558 13.442c.244.244.64.244.884 0l5.4-5.4a.625.625 0 0 0-.884-.884L10 12.116 5.042 7.158a.625.625 0 1 0-.884.884z"})},r=(0,o(340498).wt)("arrowChevronSingleDown",n,"default")},824622:(e,t,o)=>{o.d(t,{As:()=>r,E7:()=>i,JY:()=>a,S8:()=>c,iq:()=>l});var n=()=>o(79926);const r=(0,n()._h)(new(n().O2)("topLevelMobileComponents",(async()=>await Promise.all([o.e(35530),o.e(36556),o.e(55373),o.e(36192),o.e(44711),o.e(51220),o.e(35837),o.e(85128),o.e(27992),o.e(63452),o.e(66249),o.e(87249),o.e(79022),o.e(34877),o.e(11676),o.e(94522),o.e(44584),o.e(38293),o.e(55162),o.e(91793),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(12452),o.e(22370),o.e(42056),o.e(19456),o.e(65375),o.e(60751),o.e(54742),o.e(71381),o.e(57418),o.e(76100),o.e(36902),o.e(83728)]).then(o.bind(o,909088)))),(e=>e.TopLevelMobileComponents)),i=(0,n()._h)(new(n().O2)("mobileNativeFullPageComponents",(async()=>await Promise.all([o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(51220),o.e(22926),o.e(85128),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(87017),o.e(34877),o.e(46414),o.e(11676),o.e(47668),o.e(94522),o.e(44584),o.e(38293),o.e(55162),o.e(91793),o.e(44590),o.e(7914),o.e(55113),o.e(85071),o.e(12452),o.e(52871),o.e(22370),o.e(42056),o.e(65375),o.e(54742),o.e(49175),o.e(27991),o.e(71381),o.e(2373),o.e(52598),o.e(76100),o.e(66042)]).then(o.bind(o,984633)))),(e=>e.MobileNativeFullPageComponents)),l=(0,n()._h)(new(n().O2)("mobileCalendarDayMenu",(async()=>{const{MobileCalendarDayMenu:e}=await Promise.all([o.e(71562),o.e(71003),o.e(15553),o.e(77345),o.e(68395),o.e(96654),o.e(51696),o.e(41797),o.e(15194),o.e(53638)]).then(o.bind(o,110938));return{MobileCalendarDayMenu:e}})),(e=>e.MobileCalendarDayMenu)),a=(0,n()._h)(new(n().O2)("mobileTopBar",(async()=>{const{MobileTopbar:e}=await Promise.all([o.e(75134),o.e(46414),o.e(71003),o.e(22181),o.e(39438),o.e(18102),o.e(70044),o.e(62061)]).then(o.bind(o,934976));return{MobileTopbar:e}})),(e=>e.MobileTopbar)),s=new(n().O2)("mobileRedesigned",(async()=>{const{MobileNativePhoneTopPageControls:e}=await Promise.all([o.e(75134),o.e(46414),o.e(71003),o.e(22181),o.e(39438),o.e(18102),o.e(70044),o.e(62061)]).then(o.bind(o,665858));return{MobileNativePhoneTopPageControls:e}})),c=(0,n()._h)(s,(e=>e.MobileNativePhoneTopPageControls))},825666:(e,t,o)=>{o.d(t,{Lq:()=>n,WK:()=>i,nh:()=>r});const n=40,r=48,i=60},845094:(e,t,o)=>{o.d(t,{DG:()=>l,lC:()=>i});var n=()=>o(79926);const r={postInstallTourTooltip:new(n().O2)("workflowTemplateTourTooltip",(()=>o.e(99013).then(o.bind(o,901175)))),onboardingPills:new(n().O2)("onboardingPills",(()=>o.e(96431).then(o.bind(o,191294))))},i=(0,n()._h)(r.postInstallTourTooltip,(e=>e.WorkflowTemplateTourTooltip)),l=(0,n()._h)(r.onboardingPills,(e=>e.PostInstallPills))},866976:(e,t,o)=>{o.r(t),o.d(t,{CollectionViewBlockErrorBoundary:()=>i,CollectionViewBlockWithErrorBoundary:()=>l});var n=o(296540),r=o(474848);class i extends n.Component{componentDidCatch(e){throw o(449412).lE("collections"),e}render(){const{collectionViewBlockRef:e,...t}=this.props;return(0,r.jsx)(o(636107).A,{...t,ref:e})}}const l=n.forwardRef(((e,t)=>(0,r.jsx)(i,{...e,collectionViewBlockRef:t})))},879765:(e,t,o)=>{o.d(t,{$:()=>r});o(296540);const n={viewBox:"0 0 20 20",fittedViewBox:"6.12 3.97 6.66 12.06",directional:!0,svg:(0,o(474848).jsx)("path",{d:"M6.308 9.558a.625.625 0 0 0 0 .884l5.4 5.4a.625.625 0 1 0 .884-.884L7.634 10l4.958-4.958a.625.625 0 1 0-.884-.884z"})},r=(0,o(340498).wt)("arrowChevronSingleLeft",n,"default")},884189:(e,t,o)=>{o.d(t,{$:()=>a});var n=()=>o(534177),r=()=>o(925832),i=()=>o(292985);function l({start:e,end:t,scrollStart:o,scrollEnd:r,containerSize:i,alignment:l}){switch(l){case"start":return e;case"end":return t-i;case"center":return e+(t-e)/2-i/2;case"nearest":const a=t-e>i,s=Math.abs(e-o)<Math.abs(t-r);return a||s?e:t-i;default:(0,n().HB)(l)}}function a(e){const{element:t,environment:o,additionalPadding:n={},blockAlignment:a,inlineAlignment:s,behavior:c="smooth",verticalVisibilityRequirement:d="topAndBottomVisible",horizontalVisibilityRequirement:u="leftAndRightVisible"}=e,{top:p=0,bottom:g=0,left:m=0,right:S=0}=n,h=(0,r().s)(t)[0],y=t.getBoundingClientRect(),v=y.top-p,f=y.bottom+g,b=y.left-m,x=y.right+S;if(!h)return;const w=h.getBoundingClientRect(),C=v>=w.top,k=f<=w.bottom,I=b>=w.left,T=x<=w.right,j=C&&k,A=I&&T;if(("topAndBottomVisible"===d?j:"topVisible"===d?C:"bottomVisible"!==d||k)&&("leftAndRightVisible"===u?A:"leftVisible"===u?I:"rightVisible"!==u||T))return;const M=h.scrollTop,P=h.scrollTop+h.clientHeight,_=h.scrollLeft,R=h.scrollLeft+h.clientWidth,B=l({start:j?M:M+(v-w.top),end:j?P:P+(f-w.bottom),scrollStart:M,scrollEnd:P,containerSize:h.clientHeight,alignment:a??"nearest"}),V=l({start:A?_:_+(b-w.left),end:A?R:R+(x-w.right),scrollStart:_,scrollEnd:R,containerSize:h.clientWidth,alignment:s??"nearest"});(0,i().V)({element:h,environment:o,options:{top:B,left:V,behavior:c}})}},888325:(e,t,o)=>{function n(e){return`${e.table}:${e.id}`}o.d(t,{_:()=>n})},893952:(e,t,o)=>{o.d(t,{A:()=>a});o(296540);var n=()=>o(726637),r=()=>o(401497),i=()=>o(100622),l=o(474848);const a=function(e){const{color:t}=e;return(0,l.jsx)(o(81068).A,{...e,icon:(0,l.jsx)(s,{color:t}),title:(0,o(27178).mN)(t)})};function s({color:e}){const t=(0,r().DP)(),o=(0,r().IS)((()=>{const o=(0,i().LD)(t,e),r="default"===e?i().Tj.border.primaryTranslucent:i().Tj[e].border.primaryTranslucent;return{tile:{width:n().A.isMobile?24:18,height:n().A.isMobile?24:18,background:o.backgroundColor,color:o.textColor,boxShadow:`inset 0 0 0 1px ${r}`,borderRadius:4}}}),[e,t]);return(0,l.jsx)("div",{style:o.tile})}},898009:(e,t,o)=>{o.d(t,{g:()=>p});var n=()=>o(59226),r=()=>o(484714),i=()=>o(590526),l=()=>o(79926),a=()=>o(89053),s=()=>o(908201),c=()=>o(842076),d=()=>o(862292),u=()=>o(186348);function p(e,t,o){const p=(0,s().Ks)(),g=(0,i().K8)((()=>null==p?void 0:p.getViewType()),[p]),m=(0,n().X)("collection_view_conditional_colors_property_level"),S=(0,r().v3)(),{value:h}=(0,l().fJ)(d().T.formulas),y=(0,i().K8)((()=>{var o,n;if(m&&e&&p)return null===(o=p.conditionalColorStore((0,a().i)()))||void 0===o||null===(o=o.state)||void 0===o?void 0:o.getPropertyConditionalColor({blockStore:e,propertyId:t,propertyMapping:null===(n=p.collectionStore())||void 0===n?void 0:n.getPropertyMapping(),formulasModule:h,getRelationEdgeList:(0,c().Y)({environment:S,spaceId:e.getSpaceId()})})}),[e,p,m,t,h,S]);return(0,u().h)({conditionalColor:y,store:e,schema:o,viewType:g})}},912474:(e,t,o)=>{o.d(t,{a:()=>i});var n=()=>o(79926);const r=new(n().O2)("StopDictationButton",(async()=>await Promise.all([o.e(75134),o.e(35530),o.e(9773),o.e(36556),o.e(55373),o.e(36192),o.e(40537),o.e(27992),o.e(63452),o.e(66249),o.e(92845),o.e(87249),o.e(79022),o.e(14578),o.e(87017),o.e(34877),o.e(46414),o.e(11676),o.e(61165),o.e(94522),o.e(44584),o.e(38293),o.e(40992),o.e(88455),o.e(52871),o.e(47160),o.e(49021),o.e(53697),o.e(17680),o.e(6039),o.e(71136),o.e(86341),o.e(29316),o.e(3101)]).then(o.bind(o,962309)))),i=(0,n()._h)(r,(e=>e.StopDictationButton))},915508:(e,t,o)=>{function n(e){return e.isDashboardView()}o.d(t,{R:()=>n})},923925:(e,t,o)=>{o.d(t,{f:()=>a});var n=()=>o(907258),r=()=>o(590526),i=()=>o(541235),l=()=>o(646355);function a(e){const{stepType:t,tutorialType:o,additionalChecks:a}=e,s=(0,r().O$)(n().AppStoreCurrentUserSettingsStore);return(0,r().K8)((()=>{var e;const n=(0,l().gt)(s,o),r=null==s||null===(e=s.getSettings())||void 0===e||null===(e=e.tutorial_step_settings)||void 0===e?void 0:e[o];if(!r)return!1;const c=(0,i().Ud)(t,r);return!(n!==t||(null==c?void 0:c.stepType)!==t)&&(!a||!c||a(c))}),[s,t,o,a])}},928196:(e,t,o)=>{o.d(t,{L:()=>p});var n=o(296540),r=()=>o(726637),i=()=>o(590526),l=()=>o(69708),a=()=>o(436696),s=()=>o(968021),c=()=>o(339798),d=o(474848);const u=["relation"],p=n.memo((function(e){const{collectionContextStore:t,aiSuggestion:p=null,hasTooltipSuggestion:g=!1,onSuggestionChange:m,onUserAddedProperty:S}=e,h=(0,o(484714).v3)(),y=(0,n.useRef)(null),v=(0,n.useRef)(null),f=(0,i().O$)(t.normalizedSchemaStore),b=(0,n.useMemo)((()=>Object.keys(f).length<=1),[f]),x=(0,i().uB)(void 0,o(118307).A),w=(0,i().O$)(x).open,C=(0,i().K8)((()=>{const e=t.collectionStore();return null==e?void 0:e.id}),[t]),k=(0,o(201941).u)(),I=(0,o(923925).f)({tutorialType:"database_onboarding",stepType:"database_onboarding_add_property_tooltip",additionalChecks:e=>"database_onboarding_add_property_tooltip"===e.stepType&&e.collectionId===C}),T=(0,i().K8)((()=>"on"===o(242422).default.getEligibleGroup({experimentId:"collection_table_header_add_property_menu",defaultGroup:"control"})),[]),j=(0,o(401497).IS)((()=>{const e={display:"flex",alignItems:"center",justifyContent:"start",height:o(236030).cR,width:"100%",paddingInlineStart:6,paddingInlineEnd:6,fontSize:r().A.isMobile?s().hN:s().Mi};return{addColumnContainer:{display:"flex",alignItems:"center",justifyContent:"start",gap:4},longButton:e,longButtonAnchor:{...e,width:T?200:378},smallButton:{display:"flex",alignItems:"center",justifyContent:"center",width:r().A.isMobile?32:28,height:r().A.isMobile?32:28},popupWrapStyle:{boxShadow:"none",overflow:void 0,background:"none"},tourtip:I?{boxShadow:o(100622).Tj.buttonBlueFocusRing,borderRadius:4}:{}}}),[I,T]),A=(0,n.useCallback)((()=>{y.current&&(0,o(884189).$)({element:y.current,environment:h,blockAlignment:"center",inlineAlignment:"nearest",behavior:"smooth",additionalPadding:{left:20,right:20}})}),[h]),M=(0,n.useCallback)((()=>{x.setState({...x.state,open:!1})}),[x]),P=(0,n.useCallback)((e=>{const{propertyType:n,isSuggestedProperty:i,propertyName:l,propertyIcon:a,selectOptions:s}=e;o(377093).nZ({environment:h,collectionContextStore:t,propertyType:n,isSuggestedProperty:i,propertyName:l,propertyIcon:a,selectOptions:s,from:"table",shouldOpenEditMenu:!1}),i||null==S||S(),r().A.isMobile&&!u.includes(n)?c().os({collectionSettingsStore:t.settingsStore}):M()}),[t,h,M,S]),_=(0,n.useCallback)((()=>{t.collectionStore()&&((0,o(755125).clear)({environment:h}),(0,o(440024).I)({environment:h}),(0,o(404779).y)(),(0,a().X)({environment:h,collectionContextStore:t,action:"click_new_property"}),c().R8({collectionSettingsStore:t.settingsStore,item:{type:"propertyType",onAccept:P}}))}),[t,h,P]),R=(0,n.useCallback)((e=>{const n="single_suggestion"===(null==p?void 0:p.suggestionType)||"multiple_suggestions"===(null==p?void 0:p.suggestionType),r=w?j.longButtonAnchor:b?{...j.longButton,...n?{width:"fit-content"}:{}}:j.smallButton,i=(0,d.jsx)(o(631524).p,{ref:y,testId:"add-column-button",style:r,onMouseDown:o(358898).tr,iconLeading:{icon:b?o(617668).plusIcon:o(863330).plusSmallIcon,size:b?"default":"sm"},colorPalette:"gray",...e,children:b&&!n?(0,d.jsx)(l().sA,{defaultMessage:"Add property",id:"collectionTable.addColumnContainer.addProperty"}):null});return I?(0,d.jsxs)("div",{style:j.tourtip,ref:v,children:[i,(0,d.jsx)(o(579372).O,{tutorialStepId:"database_onboarding_add_property_tooltip",contentRef:v,type:"database_onboarding",teamIds:k})]}):g&&null!=p&&p.suggestionProperty?(0,d.jsxs)("div",{style:j.tourtip,ref:v,children:[i,(0,d.jsx)(o(271238).i7,{originRef:v,property:p.suggestionProperty,collectionContextStore:t,onPropertyAdded:()=>{null==m||m(null)}})]}):b?i:(0,d.jsx)(o(26697).m,{placement:"top",renderTooltip:()=>(0,d.jsx)(l().sA,{defaultMessage:"Add property",id:"collectionTable.addColumnContainer.addProperty"}),render:e=>(0,d.jsx)("div",{...e,children:i})})}),[j.smallButton,w,b,j.longButton,j.longButtonAnchor,j.tourtip,I,null==p?void 0:p.suggestionProperty,null==p?void 0:p.suggestionType,t,g,m,k]),B=(0,n.useCallback)((()=>(0,d.jsx)(o(59400).FZ,{collectionContextStore:t,collectionSettingsStore:t.settingsStore,handleClosePopup:M,scrollOriginIntoView:A,onAccept:P})),[t,M,A,P]),V=(0,n.useCallback)((()=>{(0,a().X)({environment:h,collectionContextStore:t,action:"click_new_property"})}),[h,t]),F=(0,i().O$)(t.canConfigureBlockStore),E=(0,i().K8)((()=>t.permissionScopesStore.state.isExternallyImportedAndSyncedCollection),[t.permissionScopesStore]),O=(0,o(59226).X)("jira_notion_only_properties");return E&&!O?null:r().A.isMobile?R({onClick:_}):(0,d.jsx)("div",{style:j.addColumnContainer,children:(0,d.jsx)(o(250910).A,{popupType:o(30537).n.Popup,disabled:!F,originGap:0,alignmentToOrigin:"start",buttonPopupStore:x,renderOrigin:R,render:B,onClick:V,onClose:M,popupWrapStyle:j.popupWrapStyle,preventScaleTransition:!0,preventOpacityTransition:!0,disableFlippingPlacement:!0})})}))},937199:(e,t,o)=>{o.d(t,{LH:()=>i,Op:()=>r,bi:()=>s,sf:()=>a,v$:()=>l});o(16280);var n=o(296540);const r=(0,n.createContext)(null);function i(){const e=(0,n.useContext)(r);if(!e)throw new Error("usePageLayoutEditorContext must be used inside BaseLayoutEditorContext.Provider");return e}function l(){return(0,n.useContext)(r)}r.displayName="BaseLayoutEditorContext";const a=(0,n.createContext)(null);function s(){const e=(0,n.useContext)(a);if(!e)throw new Error("usePageLayoutEditorContext must be used inside PageLayoutEditorContextProvider");return e}a.displayName="PageLayoutEditorContext"},939556:(e,t,o)=>{o.d(t,{y:()=>x});o(898992),o(430670),o(581454);var n=o(296540),r=()=>o(59226),i=()=>o(726637),l=()=>o(484714),a=()=>o(590526),s=()=>o(79926),c=()=>o(546926),d=()=>o(890492),u=()=>o(663639),p=()=>o(736847),g=()=>o(69708),m=()=>o(496603),S=()=>o(320865),h=()=>o(106412),y=()=>o(955450),v=()=>o(637096),f=o(474848);const b={getCollectionViewActionMenuSections:new(s().O2)("getCollectionViewActionMenuSections",(async()=>await o.e(67561).then(o.bind(o,861477))))};function x({collectionViewStore:e,collectionContextStore:t,onClose:o}){const x=(0,l().v3)(),w=(0,g().tz)(),C=(0,h().Zp)(),k=(0,y().K)({collectionContextStore:t}),I=(0,r().X)("notion_calendar_db_integration_non_time_views"),T=(0,v().W)({collectionContextStore:t,entrypoint:"view_menu"}),j=(0,s().fJ)(b.getCollectionViewActionMenuSections),A=(0,a().K8)((()=>"resolved"===j.status&&j.value?j.value.getMenuSections({collectionViewStore:e,collectionContextStore:t,onClose:o,environment:x,intl:w,previewContext:C,canSeeCalendarButton:k&&I,openInCalendar:T}):[[{key:"loading-view-action-menu-sections",render:()=>(0,f.jsx)(S().A,{}),action:()=>{}}]]),[j,t,e,k,I,T,x,w,C,o]),M=A.flatMap((e=>e)).length>0;return{renderMenu:(0,n.useCallback)((()=>{if(!M)return null;const e=i().A.isMobile?{menuType:c().gu.Modal,title:(0,f.jsx)(g().sA,{defaultMessage:"View options",id:"database.viewSettings.viewActionMenu.title"})}:{menuType:c().gu.Popup,width:220};return(0,f.jsx)(d().A,{...e,children:(0,f.jsx)(u().A,{type:u().O.Vertical,initialFocus:void 0,sections:m().oE(A.map(((e,t)=>{if(e.length>0)return{key:t,render:e=>(0,f.jsx)(p().A,{...e,topBorder:0!==t}),items:e}})))})})}),[M,A]),hasMenuItems:M}}},955450:(e,t,o)=>{o.d(t,{K:()=>c});var n=()=>o(135168),r=()=>o(59226),i=()=>o(484714),l=()=>o(590526),a=()=>o(106412),s=()=>o(583238);function c(e){const{collectionContextStore:t}=e,o=(0,i().v3)(),c=(0,a().Zp)(),d=(0,l().O$)(t.normalizedSchemaStore),u=(0,l().K8)((()=>t.collectionViewStore()),[t]),p=(0,l().K8)((()=>null==u?void 0:u.getType()),[u]),g=(0,r().X)("notion_calendar_db_integration_non_time_views"),m=(0,l().K8)((()=>t.isDashboardWidget()),[t]),S=(0,l().K8)((()=>{const e=t.collectionStore();return(0,s().JF)({environment:o,spaceStore:(0,n().f)(e),schema:d,collectionContextType:t.contextTypeFromStoreState,collectionViewType:p,enableForNonTimeBasedViews:g})}),[o,d,t,p,g]);return!m&&(Boolean(S)&&!(null!=c&&c.disablePageLinks))}},966759:(e,t,o)=>{o.d(t,{i:()=>i});var n=()=>o(390650),r=()=>o(175213);function i(e){const{environment:t,collectionContextStore:o,property_type:i,from:l,property:a,...s}=e,c=(0,n().sl)(o)||{};(0,r().G)(t,{property:a,property_type:i,from:l,...s,...c})}},970236:(e,t,o)=>{o.d(t,{E:()=>a});o(296540);var n=()=>o(401497),r=()=>o(100622),i=()=>o(284371),l=o(474848);function a(e){const{color:t="gray",style:o,content:a,...s}=e,c=(0,n().IS)((()=>({badge:{alignSelf:"center",padding:"2px 4px",background:r().Tj[t].background.secondaryTranslucent,color:r().Tj[t].text.accentPrimary,borderRadius:4,fontSize:11,fontWeight:i().Wy.medium,lineHeight:1.3,...o}})),[t,o]);return(0,l.jsx)("div",{style:c.badge,...s,children:a})}},991941:(e,t,o)=>{o.d(t,{M:()=>r});o(296540);const n={viewBox:"0 0 16 16",fittedViewBox:"3.37 1.53 9.26 12.92",svg:(0,o(474848).jsx)("path",{d:"m10.225 6.095-.11-1.14.18-.16c.64-.57 1.01-1.4 1.01-2.26v-.38c0-.34-.28-.62-.62-.62h-5.36c-.34 0-.62.28-.62.62v.38c0 .86.37 1.68 1.01 2.26l.18.16-.11 1.14c-1.44.58-2.41 2-2.41 3.55v.5c0 .34.28.62.63.62h3.23v2.34c0 .14.03.27.09.4l.35.75c.05.11.14.18.26.2h.06c.09 0 .19-.04.26-.11l.06-.08.35-.77c.06-.12.09-.26.09-.4v-2.34h3.26c.34 0 .62-.28.62-.62v-.5c0-1.56-.96-2.98-2.41-3.55zm-3.66 1.05c.23-.08.4-.29.42-.53l.18-1.85c.02-.2-.06-.4-.21-.53l-.42-.38c-.32-.28-.52-.66-.58-1.08h4.07c-.06.42-.26.8-.58 1.08l-.42.38c-.15.13-.23.33-.21.53l.18 1.85c.02.24.19.45.42.53l.19.06c1 .34 1.7 1.27 1.75 2.32h-6.73c.05-1.05.74-1.98 1.75-2.32z"})},r=(0,o(340498).wt)("pinSmall",n,"small")},994006:(e,t,o)=>{o.d(t,{A:()=>r});o(296540);var n=o(474848);const r=function(e){const t={marginInlineEnd:e.avatarMarginRight??6,alignSelf:"center"},r={display:"flex",alignItems:"center",minWidth:0,...e.style},i=e.inline?{...t,width:"none",minHeight:"none"}:t,{userStore:l,avatarShouldShowShadow:a,avatarSize:s,hasTooltip:c,tooltipHeader:d,hasPersonHoverCard:u,spaceStore:p}=e,g=(0,o(69708).tz)(),m=(0,o(590526).K8)((()=>null==l?void 0:l.getDisplayName(g)),[l,g]),S=(0,n.jsxs)("div",{style:r,children:[(0,n.jsx)("div",{style:i,children:(0,n.jsx)(o(453697).A,{userStore:l,avatarShouldShowShadow:a,size:s,hasTooltip:c&&!u,hasPersonHoverCard:!1,tooltipHeader:d})}),(0,n.jsx)("div",{className:"notranslate",style:{...o(284371).RC},children:m})]});return u?(0,n.jsx)(o(436525).D,{userStore:l,spaceStore:p,children:S}):S}}}]);