"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[81074],{444796:(e,t,i)=>{i.d(t,{AS:()=>d,EH:()=>h});var n=()=>i(522419),o=()=>i(220719),a=()=>i(691648),r=()=>i(179266);const s=["png","jpg","jpeg","webp","heic","heif"];function d(e){if(!e)return!1;const t=n().QC(e);if(!t)return!1;const i=n()._J(e),o=s.includes(t.toLowerCase());return i&&o}async function h(e,t){const i=e.getOriginalImageSource();if((0,o().o9)(i),!i)return;const n=await(0,r().L)({url:i,isAuthenticated:!0,permissionRecord:e.pointer},t),{imageEditActions:s}=await a().h.load();return s.cropAndUploadImage({store:e,environment:t,proxiedOriginalUrl:n})}},471266:(e,t,i)=>{i.d(t,{A:()=>s});var n=()=>i(917992),o=()=>i(553819);const a={open:!0,isImageLoaded:!1,saveButtonLoading:!1,imageRef:void 0,fixedAspectSelection:void 0,aspectSelectionFlipped:!1,outerContainerSize:void 0,innerContainerSize:void 0};class r extends(()=>i(757695))().Store{getInitialState(){return{open:!1}}openModal(e){const{originalSource:t,blockStore:i}=e,r="uploading"===o().A.getStatus(i.id)&&o().A.getMetadataByBlockId(i.id)||{...n().b,...i.getImageEditMetadata()};this.setState({...a,blockStore:i,originalSource:t,editMetadata:r,cropAspect:"Circle"===r.mask?1:void 0})}setSaveButtonLoading(e){this.state.open&&this.setState({...this.state,saveButtonLoading:e})}closeModal(e){var t;null==e||null===(t=e.onClose)||void 0===t||t.call(e),this.setState({open:!1})}getEditMetadata(){return this.state.open&&this.state.editMetadata||n().b}getIsImageLoaded(){return!!this.state.open&&this.state.isImageLoaded}setIsImageLoaded(e){this.state.open&&this.setState({...this.state,isImageLoaded:!0,imageRef:e})}setCrop(e){if(this.state.open){const t={...this.state.editMetadata,crop:e};this.setState({...this.state,editMetadata:t})}}setMask(e){if(this.state.open)switch(this.setState({...this.state,fixedAspectSelection:void 0,aspectSelectionFlipped:!1}),e){case"None":return void this.setFreeform();case"Circle":return void this.setCircleMask();default:(0,i(534177).HB)(e)}}async setFixedAspectRatio(e,t){if(!this.state.open)return;const{width:i,height:o}=n().oU[e],a=t?o/i:i/o,r=this.state.editMetadata,s=await this.getAspectCrop(r,a);s&&this.setState({...this.state,cropAspect:a,editMetadata:{...r,crop:s,mask:"None"},fixedAspectSelection:e,aspectSelectionFlipped:t})}setFreeform(){if(!this.state.open)return;const e=this.state.editMetadata;this.setState({...this.state,cropAspect:void 0,editMetadata:{...e,mask:"None"}})}async setCircleMask(){if(!this.state.open)return;const e=this.state.editMetadata,t=await this.getAspectCrop(e,1);t&&this.setState({...this.state,cropAspect:1,editMetadata:{crop:t,mask:"Circle"}})}async getAspectCrop(e,t){if(this.state.open){var n;const o=null===(n=this.state.imageRef)||void 0===n?void 0:n.current,a=null==e?void 0:e.crop;if(!o||!a)return;const{makeAspectCrop:r}=await i(691648).h.load();return r(a,t,o.width,o.height)}}resetCrop(){this.state.open&&(this.setCrop(n().b.crop),this.setMask(n().b.mask))}}const s=new r},751229:(e,t,i)=>{i.r(t),i.d(t,{ImageEditModal:()=>me,imageEditActions:()=>n,makeAspectCrop:()=>E});var n={};i.r(n),i.d(n,{MIN_CROP_SIZE:()=>v,cropAndUploadImage:()=>f,uploadCroppedImage:()=>C});i(16280);var o=()=>i(675133),a=()=>i(792057),r=()=>i(304740),s=()=>i(206267),d=()=>i(201980),h=()=>i(69708),c=()=>i(896628),l=()=>i(384944),p=()=>i(222138),g=()=>i(747100),w=()=>i(622237),u=()=>i(553819),m=()=>i(244828);const x=2e3,v=100,y=(0,h().YK)({cropError:{id:"imageEditActions.cropError.message",defaultMessage:"Failed to crop image."}});async function f(e){const{store:t,environment:i,proxiedOriginalUrl:n}=e;u().A.setStatusDrawing(t.id);const s=await async function(e){const{store:t,proxiedOriginalUrl:i}=e,n=document.createElement("canvas"),o=n.getContext("2d");if(!o)throw Error("drawEditsToCanvas: missing 2d context");const a=u().A.getMetadataByBlockId(t.id);if(!a)throw Error("attempted to crop without setting ImageEditStore first");const r=await new Promise(((e,t)=>{const n=new Image;n.crossOrigin="anonymous",n.onload=()=>e(n),n.onerror=()=>{t()},n.src=i}));let s=function(e){const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("drawInitialCanvas: missing 2d context");const n=Math.min(x,e.naturalWidth),o=n/e.naturalWidth,a=e.naturalHeight*o;return t.width=n,t.height=a,i.drawImage(e,0,0,n,a),t}(r);const{crop:d,mask:h}=a;s=function(e,t){const i=document.createElement("canvas"),n=i.getContext("2d");if(!n)throw new Error("applyCropToCanvas: missing 2d context");const o=e.width*t.x/100,a=e.height*t.y/100,r=e.width*t.width/100,s=e.height*t.height/100;return i.width=r,i.height=s,n.drawImage(e,-o,-a),i}(s,d),"Circle"===h&&(s=function(e){const t=document.createElement("canvas"),i=t.getContext("2d");if(!i)throw new Error("applyCircleMaskToCanvas: missing 2d context");return t.width=e.width,t.height=e.height,i.drawImage(e,0,0),i.globalCompositeOperation="destination-in",i.fillStyle="#000",i.beginPath(),i.arc(.5*e.width,.5*e.height,.5*e.width,0,2*Math.PI),i.fill(),t}(s));return n.style.width=`${s.width}px`,n.style.height=`${s.height}px`,n.width=s.width,n.height=s.height,o.drawImage(s,0,0,s.width,s.height),n}({store:t,proxiedOriginalUrl:n});u().A.setStatusUploading(t.id,s.toDataURL());const d=s.width/s.height;let h=w().A.getWidth((0,g().cq)(t))??r().Xc,c=h/d;if(c>r().q3){const e=c/r().q3;h/=e,c/=e}return C({canvas:s,store:t,environment:i,newBlockWidth:h,newBlockHeight:c,onUploadComplete:e=>u().A.setStatusCompleted(t.id,e),onUploadError:()=>{u().A.setStatusError(t.id),a().f1(o().A.formatMessage(y.cropError))}})}async function C(e){const{environment:t,canvas:i,store:n,newBlockWidth:o,newBlockHeight:a}=e,r="image/png",h=await new Promise(((e,t)=>{i.toBlob((i=>{i?e(i):t()}),r,1)})),g=new File([h],`${s().JW()}.png`,{type:r});p().QM({environment:t,file:g,bucket:"secure",record:n.pointer,isFileBlock:!0,reportRichUploadMetrics:!0,onComplete:i=>{var r;const s=n.getOriginalImageSource(),h=u().A.getMetadataByBlockId(n.id);if(!h)throw Error("Missing edit metadata on format update!");if(!s)throw Error("Missing original image source on format update!");m().createAndCommit({userAction:"embedBlockActions.uploadEditedImage",environment:t,canUndo:!0,perform:e=>{c().zA({stores:[n],update:{display_source:i,original_source:s,image_edit_metadata:h,block_width:o,block_height:a,block_aspect_ratio:a/o},transaction:e}),l().zv({store:n.getPropertiesStore(),data:{source:d().x9d(i)},transaction:e})}}),null===(r=e.onUploadComplete)||void 0===r||r.call(e,i)},onError:t=>{var i;null===(i=e.onUploadError)||void 0===i||i.call(e)}})}var b=i(296540),M=Object.defineProperty,A=(e,t,i)=>((e,t,i)=>t in e?M(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i)(e,"symbol"!=typeof t?t+"":t,i);const k={x:0,y:0,width:0,height:0,unit:"px"},S=(e,t,i)=>Math.min(Math.max(e,t),i),D=(e,t)=>e===t||e.width===t.width&&e.height===t.height&&e.x===t.x&&e.y===t.y&&e.unit===t.unit;function E(e,t,i,n){const o=R(e,i,n);return e.width&&(o.height=o.width/t),e.height&&(o.width=o.height*t),o.y+o.height>n&&(o.height=n-o.y,o.width=o.height*t),o.x+o.width>i&&(o.width=i-o.x,o.height=o.width/t),"%"===e.unit?I(o,i,n):o}function I(e,t,i){return"%"===e.unit?{...k,...e,unit:"%"}:{unit:"%",x:e.x?e.x/t*100:0,y:e.y?e.y/i*100:0,width:e.width?e.width/t*100:0,height:e.height?e.height/i*100:0}}function R(e,t,i){return e.unit?"px"===e.unit?{...k,...e,unit:"px"}:{unit:"px",x:e.x?e.x*t/100:0,y:e.y?e.y*i/100:0,width:e.width?e.width*t/100:0,height:e.height?e.height*i/100:0}:{...k,...e,unit:"px"}}function j(e,t,i,n,o,a=0,r=0,s=n,d=o){const h={...e};let c=Math.min(a,n),l=Math.min(r,o),p=Math.min(s,n),g=Math.min(d,o);t&&(t>1?(c=r?r*t:c,l=c/t,p=s*t):(l=a?a/t:l,c=l*t,g=d/t)),h.y<0&&(h.height=Math.max(h.height+h.y,l),h.y=0),h.x<0&&(h.width=Math.max(h.width+h.x,c),h.x=0);const w=n-(h.x+h.width);w<0&&(h.x=Math.min(h.x,n-c),h.width+=w);const u=o-(h.y+h.height);if(u<0&&(h.y=Math.min(h.y,o-l),h.height+=u),h.width<c&&(("sw"===i||"nw"==i)&&(h.x-=c-h.width),h.width=c),h.height<l&&(("nw"===i||"ne"==i)&&(h.y-=l-h.height),h.height=l),h.width>p&&(("sw"===i||"nw"==i)&&(h.x-=p-h.width),h.width=p),h.height>g&&(("nw"===i||"ne"==i)&&(h.y-=g-h.height),h.height=g),t){const e=h.width/h.height;if(e<t){const e=Math.max(h.width/t,l);("nw"===i||"ne"==i)&&(h.y-=e-h.height),h.height=e}else if(e>t){const e=Math.max(h.height*t,c);("sw"===i||"nw"==i)&&(h.x-=e-h.width),h.width=e}}return h}const B={capture:!0,passive:!1};let _=0;const P=class e extends b.PureComponent{constructor(){super(...arguments),A(this,"docMoveBound",!1),A(this,"mouseDownOnCrop",!1),A(this,"dragStarted",!1),A(this,"evData",{startClientX:0,startClientY:0,startCropX:0,startCropY:0,clientX:0,clientY:0,isResize:!0}),A(this,"componentRef",(0,b.createRef)()),A(this,"mediaRef",(0,b.createRef)()),A(this,"resizeObserver"),A(this,"initChangeCalled",!1),A(this,"instanceId","rc-"+_++),A(this,"state",{cropIsActive:!1,newCropIsBeingDrawn:!1}),A(this,"onCropPointerDown",(e=>{const{crop:t,disabled:i}=this.props,n=this.getBox();if(!t)return;const o=R(t,n.width,n.height);if(i)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const a=e.target.dataset.ord,r=!!a;let s=e.clientX,d=e.clientY,h=o.x,c=o.y;if(a){const t=e.clientX-n.x,i=e.clientY-n.y;let r=0,l=0;"ne"===a||"e"==a?(r=t-(o.x+o.width),l=i-o.y,h=o.x,c=o.y+o.height):"se"===a||"s"===a?(r=t-(o.x+o.width),l=i-(o.y+o.height),h=o.x,c=o.y):"sw"===a||"w"==a?(r=t-o.x,l=i-(o.y+o.height),h=o.x+o.width,c=o.y):("nw"===a||"n"==a)&&(r=t-o.x,l=i-o.y,h=o.x+o.width,c=o.y+o.height),s=h+n.x+r,d=c+n.y+l}this.evData={startClientX:s,startClientY:d,startCropX:h,startCropY:c,clientX:e.clientX,clientY:e.clientY,isResize:r,ord:a},this.mouseDownOnCrop=!0,this.setState({cropIsActive:!0})})),A(this,"onComponentPointerDown",(e=>{const{crop:t,disabled:i,locked:n,keepSelection:o,onChange:a}=this.props,r=this.getBox();if(i||n||o&&t)return;e.cancelable&&e.preventDefault(),this.bindDocMove(),this.componentRef.current.focus({preventScroll:!0});const s=e.clientX-r.x,d=e.clientY-r.y,h={unit:"px",x:s,y:d,width:0,height:0};this.evData={startClientX:e.clientX,startClientY:e.clientY,startCropX:s,startCropY:d,clientX:e.clientX,clientY:e.clientY,isResize:!0},this.mouseDownOnCrop=!0,a(R(h,r.width,r.height),I(h,r.width,r.height)),this.setState({cropIsActive:!0,newCropIsBeingDrawn:!0})})),A(this,"onDocPointerMove",(e=>{const{crop:t,disabled:i,onChange:n,onDragStart:o}=this.props,a=this.getBox();if(i||!t||!this.mouseDownOnCrop)return;e.cancelable&&e.preventDefault(),this.dragStarted||(this.dragStarted=!0,o&&o(e));const{evData:r}=this;let s;r.clientX=e.clientX,r.clientY=e.clientY,s=r.isResize?this.resizeCrop():this.dragCrop(),D(t,s)||n(R(s,a.width,a.height),I(s,a.width,a.height))})),A(this,"onComponentKeyDown",(t=>{const{crop:i,disabled:n,onChange:o,onComplete:a}=this.props;if(n)return;const r=t.key;let s=!1;if(!i)return;const d=this.getBox(),h=this.makePixelCrop(d),c=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?e.nudgeStepLarge:t.shiftKey?e.nudgeStepMedium:e.nudgeStep;if("ArrowLeft"===r?(h.x-=c,s=!0):"ArrowRight"===r?(h.x+=c,s=!0):"ArrowUp"===r?(h.y-=c,s=!0):"ArrowDown"===r&&(h.y+=c,s=!0),s){t.cancelable&&t.preventDefault(),h.x=S(h.x,0,d.width-h.width),h.y=S(h.y,0,d.height-h.height);const e=R(h,d.width,d.height),i=I(h,d.width,d.height);o(e,i),a&&a(e,i)}})),A(this,"onHandlerKeyDown",((t,i)=>{const{aspect:n=0,crop:o,disabled:a,minWidth:r=0,minHeight:s=0,maxWidth:d,maxHeight:h,onChange:c,onComplete:l}=this.props,p=this.getBox();if(a||!o)return;if("ArrowUp"!==t.key&&"ArrowDown"!==t.key&&"ArrowLeft"!==t.key&&"ArrowRight"!==t.key)return;t.stopPropagation(),t.preventDefault();const g=(navigator.platform.match("Mac")?t.metaKey:t.ctrlKey)?e.nudgeStepLarge:t.shiftKey?e.nudgeStepMedium:e.nudgeStep,w=function(e,t,i,n){const o={...e};return"ArrowLeft"===t?"nw"===n?(o.x-=i,o.y-=i,o.width+=i,o.height+=i):"w"===n?(o.x-=i,o.width+=i):"sw"===n?(o.x-=i,o.width+=i,o.height+=i):"ne"===n?(o.y+=i,o.width-=i,o.height-=i):"e"===n?o.width-=i:"se"===n&&(o.width-=i,o.height-=i):"ArrowRight"===t&&("nw"===n?(o.x+=i,o.y+=i,o.width-=i,o.height-=i):"w"===n?(o.x+=i,o.width-=i):"sw"===n?(o.x+=i,o.width-=i,o.height-=i):"ne"===n?(o.y-=i,o.width+=i,o.height+=i):"e"===n?o.width+=i:"se"===n&&(o.width+=i,o.height+=i)),"ArrowUp"===t?"nw"===n?(o.x-=i,o.y-=i,o.width+=i,o.height+=i):"n"===n?(o.y-=i,o.height+=i):"ne"===n?(o.y-=i,o.width+=i,o.height+=i):"sw"===n?(o.x+=i,o.width-=i,o.height-=i):"s"===n?o.height-=i:"se"===n&&(o.width-=i,o.height-=i):"ArrowDown"===t&&("nw"===n?(o.x+=i,o.y+=i,o.width-=i,o.height-=i):"n"===n?(o.y+=i,o.height-=i):"ne"===n?(o.y+=i,o.width-=i,o.height-=i):"sw"===n?(o.x-=i,o.width+=i,o.height+=i):"s"===n?o.height+=i:"se"===n&&(o.width+=i,o.height+=i)),o}(R(o,p.width,p.height),t.key,g,i),u=j(w,n,i,p.width,p.height,r,s,d,h);if(!D(o,u)){const e=I(u,p.width,p.height);c(u,e),l&&l(u,e)}})),A(this,"onDocPointerDone",(e=>{const{crop:t,disabled:i,onComplete:n,onDragEnd:o}=this.props,a=this.getBox();this.unbindDocMove(),!i&&t&&this.mouseDownOnCrop&&(this.mouseDownOnCrop=!1,this.dragStarted=!1,o&&o(e),n&&n(R(t,a.width,a.height),I(t,a.width,a.height)),this.setState({cropIsActive:!1,newCropIsBeingDrawn:!1}))})),A(this,"onDragFocus",(()=>{var e;null==(e=this.componentRef.current)||e.scrollTo(0,0)}))}get document(){return document}getBox(){const e=this.mediaRef.current;if(!e)return{x:0,y:0,width:0,height:0};const{x:t,y:i,width:n,height:o}=e.getBoundingClientRect();return{x:t,y:i,width:n,height:o}}componentDidUpdate(e){const{crop:t,onComplete:i}=this.props;if(i&&!e.crop&&t){const{width:e,height:n}=this.getBox();e&&n&&i(R(t,e,n),I(t,e,n))}}componentWillUnmount(){this.resizeObserver&&this.resizeObserver.disconnect(),this.unbindDocMove()}bindDocMove(){this.docMoveBound||(this.document.addEventListener("pointermove",this.onDocPointerMove,B),this.document.addEventListener("pointerup",this.onDocPointerDone,B),this.document.addEventListener("pointercancel",this.onDocPointerDone,B),this.docMoveBound=!0)}unbindDocMove(){this.docMoveBound&&(this.document.removeEventListener("pointermove",this.onDocPointerMove,B),this.document.removeEventListener("pointerup",this.onDocPointerDone,B),this.document.removeEventListener("pointercancel",this.onDocPointerDone,B),this.docMoveBound=!1)}getCropStyle(){const{crop:e}=this.props;if(e)return{top:`${e.y}${e.unit}`,left:`${e.x}${e.unit}`,width:`${e.width}${e.unit}`,height:`${e.height}${e.unit}`}}dragCrop(){const{evData:e}=this,t=this.getBox(),i=this.makePixelCrop(t),n=e.clientX-e.startClientX,o=e.clientY-e.startClientY;return i.x=S(e.startCropX+n,0,t.width-i.width),i.y=S(e.startCropY+o,0,t.height-i.height),i}getPointRegion(e,t,i,n){const{evData:o}=this,a=o.clientX-e.x,r=o.clientY-e.y;let s,d;return s=n&&t?"nw"===t||"n"===t||"ne"===t:r<o.startCropY,d=i&&t?"nw"===t||"w"===t||"sw"===t:a<o.startCropX,d?s?"nw":"sw":s?"ne":"se"}resolveMinDimensions(e,t,i=0,n=0){const o=Math.min(i,e.width),a=Math.min(n,e.height);return t&&(o||a)?t>1?o?[o,o/t]:[a*t,a]:a?[a*t,a]:[o,o/t]:[o,a]}resizeCrop(){const{evData:t}=this,{aspect:i=0,maxWidth:n,maxHeight:o}=this.props,a=this.getBox(),[r,s]=this.resolveMinDimensions(a,i,this.props.minWidth,this.props.minHeight);let d=this.makePixelCrop(a);const h=this.getPointRegion(a,t.ord,r,s),c=t.ord||h;let l=t.clientX-t.startClientX,p=t.clientY-t.startClientY;(r&&"nw"===c||"w"===c||"sw"===c)&&(l=Math.min(l,-r)),(s&&"nw"===c||"n"===c||"ne"===c)&&(p=Math.min(p,-s));const g={unit:"px",x:0,y:0,width:0,height:0};"ne"===h?(g.x=t.startCropX,g.width=l,i?(g.height=g.width/i,g.y=t.startCropY-g.height):(g.height=Math.abs(p),g.y=t.startCropY-g.height)):"se"===h?(g.x=t.startCropX,g.y=t.startCropY,g.width=l,g.height=i?g.width/i:p):"sw"===h?(g.x=t.startCropX+l,g.y=t.startCropY,g.width=Math.abs(l),g.height=i?g.width/i:p):"nw"===h&&(g.x=t.startCropX+l,g.width=Math.abs(l),i?(g.height=g.width/i,g.y=t.startCropY-g.height):(g.height=Math.abs(p),g.y=t.startCropY+p));const w=j(g,i,h,a.width,a.height,r,s,n,o);return i||e.xyOrds.indexOf(c)>-1?d=w:e.xOrds.indexOf(c)>-1?(d.x=w.x,d.width=w.width):e.yOrds.indexOf(c)>-1&&(d.y=w.y,d.height=w.height),d.x=S(d.x,0,a.width-d.width),d.y=S(d.y,0,a.height-d.height),d}renderCropSelection(){const{ariaLabels:t=e.defaultProps.ariaLabels,disabled:i,locked:n,renderSelectionAddon:o,ruleOfThirds:a,crop:r}=this.props,s=this.getCropStyle();if(r)return b.createElement("div",{style:s,className:"ReactCrop__crop-selection",onPointerDown:this.onCropPointerDown,"aria-label":t.cropArea,tabIndex:0,onKeyDown:this.onComponentKeyDown,role:"group"},!i&&!n&&b.createElement("div",{className:"ReactCrop__drag-elements",onFocus:this.onDragFocus},b.createElement("div",{className:"ReactCrop__drag-bar ord-n","data-ord":"n"}),b.createElement("div",{className:"ReactCrop__drag-bar ord-e","data-ord":"e"}),b.createElement("div",{className:"ReactCrop__drag-bar ord-s","data-ord":"s"}),b.createElement("div",{className:"ReactCrop__drag-bar ord-w","data-ord":"w"}),b.createElement("div",{className:"ReactCrop__drag-handle ord-nw","data-ord":"nw",tabIndex:0,"aria-label":t.nwDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"nw"),role:"button"}),b.createElement("div",{className:"ReactCrop__drag-handle ord-n","data-ord":"n",tabIndex:0,"aria-label":t.nDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"n"),role:"button"}),b.createElement("div",{className:"ReactCrop__drag-handle ord-ne","data-ord":"ne",tabIndex:0,"aria-label":t.neDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"ne"),role:"button"}),b.createElement("div",{className:"ReactCrop__drag-handle ord-e","data-ord":"e",tabIndex:0,"aria-label":t.eDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"e"),role:"button"}),b.createElement("div",{className:"ReactCrop__drag-handle ord-se","data-ord":"se",tabIndex:0,"aria-label":t.seDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"se"),role:"button"}),b.createElement("div",{className:"ReactCrop__drag-handle ord-s","data-ord":"s",tabIndex:0,"aria-label":t.sDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"s"),role:"button"}),b.createElement("div",{className:"ReactCrop__drag-handle ord-sw","data-ord":"sw",tabIndex:0,"aria-label":t.swDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"sw"),role:"button"}),b.createElement("div",{className:"ReactCrop__drag-handle ord-w","data-ord":"w",tabIndex:0,"aria-label":t.wDragHandle,onKeyDown:e=>this.onHandlerKeyDown(e,"w"),role:"button"})),o&&b.createElement("div",{className:"ReactCrop__selection-addon",onPointerDown:e=>e.stopPropagation()},o(this.state)),a&&b.createElement(b.Fragment,null,b.createElement("div",{className:"ReactCrop__rule-of-thirds-hz"}),b.createElement("div",{className:"ReactCrop__rule-of-thirds-vt"})))}makePixelCrop(e){return R({...k,...this.props.crop||{}},e.width,e.height)}render(){const{aspect:e,children:t,circularCrop:i,className:n,crop:o,disabled:a,locked:r,style:s,ruleOfThirds:d}=this.props,{cropIsActive:h,newCropIsBeingDrawn:c}=this.state,l=o?this.renderCropSelection():null,p=((...e)=>e.filter((e=>e&&"string"==typeof e)).join(" "))("ReactCrop",n,h&&"ReactCrop--active",a&&"ReactCrop--disabled",r&&"ReactCrop--locked",c&&"ReactCrop--new-crop",o&&e&&"ReactCrop--fixed-aspect",o&&i&&"ReactCrop--circular-crop",o&&d&&"ReactCrop--rule-of-thirds",!this.dragStarted&&o&&!o.width&&!o.height&&"ReactCrop--invisible-crop",i&&"ReactCrop--no-animate");return b.createElement("div",{ref:this.componentRef,className:p,style:s},b.createElement("div",{ref:this.mediaRef,className:"ReactCrop__child-wrapper",onPointerDown:this.onComponentPointerDown},t),o?b.createElement("svg",{className:"ReactCrop__crop-mask",width:"100%",height:"100%"},b.createElement("defs",null,b.createElement("mask",{id:`hole-${this.instanceId}`},b.createElement("rect",{width:"100%",height:"100%",fill:"white"}),i?b.createElement("ellipse",{cx:`${o.x+o.width/2}${o.unit}`,cy:`${o.y+o.height/2}${o.unit}`,rx:`${o.width/2}${o.unit}`,ry:`${o.height/2}${o.unit}`,fill:"black"}):b.createElement("rect",{x:`${o.x}${o.unit}`,y:`${o.y}${o.unit}`,width:`${o.width}${o.unit}`,height:`${o.height}${o.unit}`,fill:"black"}))),b.createElement("rect",{fill:"black",fillOpacity:.5,width:"100%",height:"100%",mask:`url(#hole-${this.instanceId})`})):void 0,l)}};A(P,"xOrds",["e","w"]),A(P,"yOrds",["n","s"]),A(P,"xyOrds",["nw","ne","se","sw"]),A(P,"nudgeStep",1),A(P,"nudgeStepMedium",10),A(P,"nudgeStepLarge",100),A(P,"defaultProps",{ariaLabels:{cropArea:"Use the arrow keys to move the crop selection area",nwDragHandle:"Use the arrow keys to move the north west drag handle to change the crop selection area",nDragHandle:"Use the up and down arrow keys to move the north drag handle to change the crop selection area",neDragHandle:"Use the arrow keys to move the north east drag handle to change the crop selection area",eDragHandle:"Use the up and down arrow keys to move the east drag handle to change the crop selection area",seDragHandle:"Use the arrow keys to move the south east drag handle to change the crop selection area",sDragHandle:"Use the up and down arrow keys to move the south drag handle to change the crop selection area",swDragHandle:"Use the arrow keys to move the south west drag handle to change the crop selection area",wDragHandle:"Use the up and down arrow keys to move the west drag handle to change the crop selection area"}});let L=P;var O=()=>i(484714),H=()=>i(590526),z=()=>i(401497),K=()=>i(107975),$=()=>i(396406),U=()=>i(98126),Y=()=>i(631524),X=()=>i(160432),N=()=>i(100622),F=()=>i(360083),T=()=>i(471266),W=()=>i(444796),V=()=>i(250910),q=()=>i(807449),G=()=>i(81068),J=()=>i(340498),Q=i(474848);const Z={viewBox:"0 0 20 20",fittedViewBox:"1.62 1.62 16.25 16.26",svg:(0,Q.jsx)("path",{d:"M8 1.625a6.375 6.375 0 0 1 6.092 4.5h1.658c1.174 0 2.125.951 2.125 2.125v7.5a2.125 2.125 0 0 1-2.125 2.125h-7.5a2.125 2.125 0 0 1-2.125-2.125v-1.658A6.375 6.375 0 0 1 8 1.625m.25 5.75a.875.875 0 0 0-.875.875v7.5c0 .483.392.875.875.875h7.5a.875.875 0 0 0 .875-.875v-7.5a.875.875 0 0 0-.875-.875zM8 2.875a5.125 5.125 0 0 0-1.875 9.895V8.25c0-1.174.951-2.125 2.125-2.125h4.52A5.13 5.13 0 0 0 8 2.875"})},ee=(0,J().wt)("squareOnCircle",Z,"default"),te={viewBox:"0 0 20 20",fittedViewBox:"1.62 1.62 16.38 16.38",svg:(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)("path",{d:"M16 6a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2z"}),(0,Q.jsx)("path",{d:"M8 1.625a6.37 6.37 0 0 1 5.484 3.125H8A3.25 3.25 0 0 0 4.75 8v5.483A6.375 6.375 0 0 1 8 1.625"})]})},ie=(0,J().wt)("squareOnCircleFill",te,"fill");i(898992),i(354520),i(581454);var ne=()=>i(695115);const oe={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 15.25 11.75",svg:(0,Q.jsx)("path",{d:"M15.5 4.125c1.174 0 2.125.951 2.125 2.125v7.5a2.125 2.125 0 0 1-2.125 2.125h-11a2.125 2.125 0 0 1-2.125-2.125v-7.5c0-1.174.951-2.125 2.125-2.125zm-11 1.25a.875.875 0 0 0-.875.875v7.5c0 .483.392.875.875.875h11a.875.875 0 0 0 .875-.875v-7.5a.875.875 0 0 0-.875-.875z"})},ae=(0,J().wt)("rectangle",oe,"default"),re={viewBox:"0 0 20 20",fittedViewBox:"2.37 4.12 15.25 11.75",svg:(0,Q.jsx)("path",{d:"M15.5 4.125c1.174 0 2.125.951 2.125 2.125v7.5a2.125 2.125 0 0 1-2.125 2.125h-11a2.125 2.125 0 0 1-2.125-2.125v-7.5c0-1.174.951-2.125 2.125-2.125zm-2.753 2.714a.626.626 0 0 0-.858.215L9.335 11.31 7.899 9.635a.625.625 0 0 0-.949.813l2 2.334a.625.625 0 0 0 1.01-.086l3-5a.625.625 0 0 0-.213-.857"})},se=(0,J().wt)("rectangleCheckFill",re,"fill"),de={viewBox:"0 0 20 20",fittedViewBox:"4.12 2.37 11.75 15.25",svg:(0,Q.jsx)("path",{d:"M15.875 15.5a2.125 2.125 0 0 1-2.125 2.125h-7.5A2.125 2.125 0 0 1 4.125 15.5v-11c0-1.174.951-2.125 2.125-2.125h7.5c1.174 0 2.125.951 2.125 2.125zm-1.25-11a.875.875 0 0 0-.875-.875h-7.5a.875.875 0 0 0-.875.875v11c0 .483.392.875.875.875h7.5a.875.875 0 0 0 .875-.875z"})},he=(0,J().wt)("rectangleTall",de,"default"),ce={viewBox:"0 0 20 20",fittedViewBox:"4.12 2.37 11.75 15.25",svg:(0,Q.jsx)("path",{d:"M13.75 2.375c1.174 0 2.125.951 2.125 2.125v11a2.125 2.125 0 0 1-2.125 2.125h-7.5A2.125 2.125 0 0 1 4.125 15.5v-11c0-1.174.951-2.125 2.125-2.125zm-1.003 4.749a.626.626 0 0 0-.858.215l-2.554 4.256L7.899 9.92a.625.625 0 0 0-.949.813l2 2.333a.626.626 0 0 0 1.01-.085l3-5a.625.625 0 0 0-.213-.857"})},le=(0,J().wt)("rectangleTallCheckFill",ce,"fill");var pe=()=>i(917992);function ge(e){const t=(0,h().tz)(),{aspectRatio:i,flipped:n,rowIsSelected:o}=e,a=(0,b.useMemo)((()=>o&&n?le:he),[n,o]),r=(0,b.useMemo)((()=>o?n?ae:se:ae),[n,o]);return(0,Q.jsxs)("div",{style:{transform:"translate(5px, 0px)"},children:[(0,Q.jsx)(ne().A,{icon:a,iconStyle:{width:16,height:16},ariaLabel:t.formatMessage({id:"imageEdit.aspectRatio.portrait",defaultMessage:"Portrait"}),onClick:()=>T().A.setFixedAspectRatio(i,!0)}),(0,Q.jsx)(ne().A,{icon:r,iconStyle:{width:16,height:16},ariaLabel:t.formatMessage({id:"imageEdit.aspectRatio.landscape",defaultMessage:"Landscape"}),onClick:()=>T().A.setFixedAspectRatio(i,!1)})]})}const we=function(){const e=(0,H().K8)((()=>{if(T().A.state.open)return T().A.state.fixedAspectSelection}),[]),t=(0,H().K8)((()=>!!T().A.state.open&&T().A.state.aspectSelectionFlipped),[]),n=(0,i(59226).X)("image_cropping_aspect_ratios"),[o,a]=(0,b.useState)();return(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(G().A,{focused:!1,onClick:()=>T().A.setFixedAspectRatio("1:1",!1),title:"Square",isChecked:"1:1"===e},"1:1 aspect ratio"),n?Object.keys(pe().oU).filter((e=>"1:1"!==e)).map((i=>{const{width:n,height:r}=pe().oU[i],s=function(e,t,i){return i?`${t}:${e}`:`${e}:${t}`}(n,r,t),d=e===i,h=o===i,c=h?(0,Q.jsx)(ge,{aspectRatio:i,flipped:t,rowIsSelected:d}):void 0;return(0,Q.jsx)(G().A,{focused:!1,onMouseEnter:()=>a(i),onMouseLeave:()=>a(void 0),onClick:()=>T().A.setFixedAspectRatio(i,t),title:s,isChecked:d&&!h,right:c},s)})):void 0]})};const ue=function(e){const t=(0,H().K8)((()=>{var e;return null===(e=T().A.getEditMetadata())||void 0===e?void 0:e.mask}),[]),n=(0,H().K8)((()=>T().A.state.open&&T().A.state.fixedAspectSelection),[]),o="None"===t&&void 0===n,a=(0,z().IS)((()=>({button:{display:"flex",gap:2,color:N().Tj.icon.secondary},divider:{color:N().Tj.border.secondary,opacity:.2}})),[]),r=(0,b.useMemo)((()=>(0,Q.jsx)(q().I,{icon:o?ee:ie,colorPalette:o?void 0:"blue",colorVariant:o?void 0:"accentPrimary"})),[o]);return(0,Q.jsx)(V().A,{alignmentToOrigin:"start",renderOrigin:({onClick:e})=>(0,Q.jsxs)(i(124092).p,{onClick:e,style:a.button,children:[r,(0,Q.jsx)(q().I,{icon:i(324254).arrowChevronSingleDownSmallIcon,size:"sm"})]}),popupType:V().z.Popup,render:()=>(0,Q.jsx)(i(890492).A,{menuType:i(546926).gu.Popup,children:(0,Q.jsxs)(i(736847).A,{children:[(0,Q.jsx)(G().A,{focused:!1,onClick:()=>T().A.setMask("None"),title:"Freeform",isChecked:o},"free-mask"),(0,Q.jsx)("hr",{style:a.divider}),(0,Q.jsx)(G().A,{focused:!1,onClick:()=>T().A.setMask("Circle"),title:"Circle",isChecked:"Circle"===t},"circle-mask"),(0,Q.jsx)(we,{})]})})})};function me(e){const t=(0,h().tz)(),i=(0,O().v3)(),n=(0,h().YK)({image:{id:"imageEditModal.image.altText",defaultMessage:"Original image to edit"}}),o=(0,H().O$)(T().A),a=(0,H().K8)((()=>T().A.getIsImageLoaded()),[]),r=(0,H().K8)((()=>T().A.getEditMetadata()),[]),[s,d]=(0,b.useState)(),[c,l]=(0,b.useState)(),p=s?s.width<300:void 0,g=(0,b.useRef)(null),w=function(e){const{isImageLoaded:t,outerContainerSize:i,innerContainerSize:n}=e;return(0,z().IS)((()=>({modal:{display:"flex",visibility:t?"visible":"hidden"},modalInnerStyle:{borderRadius:"12px"},cropMask:{color:N().Tj.white,opacity:"0.5"},container:{flexDirection:"column",justifyContent:"center",alignItems:"center"},outerImageContainer:{...i,display:"flex",justifyContent:"center",alignItems:"center",transition:"all 0.2s ease-out",position:"relative",overflow:"hidden"},innerImageContainer:{maxWidth:"70vw",maxHeight:"75vh",position:n?"absolute":void 0,...n},cropWindow:{padding:"30px",background:N().Tj.background.secondary,overflow:"hidden",display:"flex",justifyContent:"center"},image:{width:"100%",height:"100%",objectFit:"contain"},loadingSpinner:{display:t?"none":"block"},loadingSpinnerOverlay:{zIndex:999,width:"100vw",height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",background:N().Tj.overlaySmokescreen}})),[t,i,n])}({isImageLoaded:a,outerContainerSize:s,innerContainerSize:c});(0,b.useEffect)((()=>{if(document.documentElement.style.setProperty("--crop-mask-color",w.cropMask.color),document.documentElement.style.setProperty("--crop-mask-opacity",w.cropMask.opacity),c){const e=c.width<v||c.height<v;document.documentElement.style.setProperty("--cardinal-handle-visibility",e?"hidden":"visible")}}),[w.cropMask,c]);const m=(0,b.useCallback)((e=>{d(e),l(e)}),[]);(0,b.useLayoutEffect)((()=>{if(a&&!s&&g.current){const e=ye(g.current);m(e)}}),[a,s,m]);const x=(0,b.useCallback)((()=>{if(g.current){const e=ye(g.current);m(e)}}),[m]);(0,b.useEffect)((()=>(window.addEventListener("resize",x),()=>window.removeEventListener("resize",x))),[x]);const y=(0,b.useCallback)((()=>{d(void 0),l(void 0)}),[]);function f(e){var t;T().A.setIsImageLoaded(e),null===(t=document.querySelector(".ReactCrop__crop-mask"))||void 0===t||t.setAttribute("height","100%")}return(0,b.useEffect)((()=>{o.open||y()}),[y,o.open]),o.open?(0,Q.jsxs)("div",{children:[(0,Q.jsx)($().O,{open:o.open&&!a,children:(0,Q.jsx)("div",{style:w.loadingSpinnerOverlay,children:(0,Q.jsx)(U().A,{onDarkBackground:!0,legacySize:32,style:w.loadingSpinner})})}),(0,Q.jsx)(K().a,{style:w.modal,innerStyle:w.modalInnerStyle,open:o.open,onDismiss:ve,render:()=>(0,Q.jsx)("div",{style:w.container,children:(0,Q.jsx)(F().A,{width:window.innerWidth,url:o.originalSource,render:(e,a)=>(0,Q.jsxs)(Q.Fragment,{children:[(0,Q.jsx)(xe,{hideTitle:p,onSave:()=>{var e;o.open&&(e={editMetadata:r,store:o.blockStore,environment:i},u().A.setStatusPending(e.store.id,e.editMetadata),(0,W().EH)(e.store,e.environment),T().A.setSaveButtonLoading(!0),setTimeout((()=>{T().A.closeModal()}),750))},onClose:()=>{ve()}}),(0,Q.jsx)("div",{style:w.cropWindow,children:(0,Q.jsx)(L,{onChange:(e,t)=>{T().A.setCrop(t)},crop:r.crop,minHeight:v,minWidth:v,keepSelection:!0,aspect:o.open&&o.cropAspect,circularCrop:"Circle"===(null==r?void 0:r.mask),children:(0,Q.jsx)("div",{style:w.outerImageContainer,children:(0,Q.jsx)("div",{style:w.innerImageContainer,children:(0,Q.jsx)("img",{ref:g,src:a,alt:t.formatMessage(n.image),onLoad:()=>f(g),style:w.image})})})})})]}),isAuthenticated:!0,permissionRecord:o.blockStore.pointer})})})]}):null}function xe(e){const{onSave:t,onClose:i,hideTitle:n}=e,o=(0,z().IS)((()=>({toolbar:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",width:"100%",background:N().Tj.background.elevated,borderBottom:`1px solid ${N().Tj.border.secondary}`,padding:"12px"},buttonGroup:{display:"flex",flexDirection:"row",justifyContent:"space-around",alignItems:"center",gap:"5px"},title:{position:"absolute",marginInlineStart:"auto",marginInlineEnd:"auto",insetInlineStart:0,insetInlineEnd:0,textAlign:"center",width:"fit-content",fontWeight:"400"},resetButton:{fontSize:13,color:N().Tj.icon.secondary}})),[]),a=(0,H().K8)((()=>T().A.state.open&&T().A.state.saveButtonLoading),[]);return(0,Q.jsxs)("div",{style:o.toolbar,children:[(0,Q.jsx)(ue,{}),n?void 0:(0,Q.jsx)("div",{style:o.title,children:(0,Q.jsx)(h().sA,{id:"imageEditModal.title",defaultMessage:"Crop image"})}),(0,Q.jsxs)("div",{style:o.buttonGroup,children:[(0,Q.jsx)(Y().p,{onClick:i,colorPalette:"gray",children:(0,Q.jsx)(h().sA,{id:"imageEditModal.cancelButton.label",defaultMessage:"Cancel"})}),(0,Q.jsx)(X().A,{colorPalette:"blue",onClick:t,isLoading:a,children:(0,Q.jsx)(h().sA,{id:"imageEditModal.saveButton.label",defaultMessage:"Save"})})]})]})}function ve(){T().A.closeModal()}function ye(e){const t=e.naturalWidth/e.naturalHeight;let i=e.height*t,n=e.height;return i>e.width&&(i=e.width,n=e.width/t),{width:i,height:n}}},917992:(e,t,i)=>{i.d(t,{b:()=>o,oU:()=>n});const n={"1:1":{width:1,height:1},"5:4":{width:5,height:4},"4:3":{width:4,height:3},"7:5":{width:7,height:5},"3:2":{width:3,height:2},"5:3":{width:5,height:3},"16:9":{width:16,height:9}},o={crop:{unit:"%",x:0,y:0,width:100,height:100},mask:"None"}}}]);