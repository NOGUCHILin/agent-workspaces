"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[77093],{191356:(e,t,o)=>{o.d(t,{C4:()=>_,Nf:()=>A,qM:()=>h});o(16280),o(944114),o(898992),o(430670),o(581454);var r=()=>o(726637),n=()=>o(675133),i=()=>o(792057),a=()=>o(732810),c=()=>o(617871),l=()=>o(388693),s=()=>o(519831),p=()=>o(161479),d=()=>o(534177),m=()=>o(753812),y=()=>o(457583),u=()=>o(384944),S=()=>o(594794),g=()=>o(620791),f=()=>o(661075);const v=(0,o(69708).YK)({authError:{defaultMessage:"Auth failed. Please try again or contact Notion support.",id:"database.viewSettings.propertyTypeSection.connected.authFail"},mobileAdminError:{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) app in settings to use this feature.",id:"database.viewSettings.propertyTypeSection.connected.mobileAdminError"},mobileError:{defaultMessage:"Please authorize this integration on the desktop app or a browser.",id:"database.viewSettings.propertyTypeSection.connected.mobileError"}});async function _(e,t,o,a){const c=null==t?void 0:t.getSpaceStore();if(!c)return;const l=(0,g().jw)(o.id).length;if(r().A.isMobile&&a&&!l){const e=n().A.formatMessage(v.mobileAdminError);throw i().f1(e),new Error(e)}if(r().A.isMobile&&!a&&!l){const e=n().A.formatMessage(v.mobileError);throw i().f1(e),new Error(e)}if(!l&&a&&c.canAdmin()||!l&&!a)try{await y().Jq({environment:e,integration:o,spaceId:c.id,from:"collection_settings_property_type"})}catch(s){const e=n().A.formatMessage(v.authError);throw i().f1(e),new Error(e)}if(!(0,g().jw)(o.id).length){const e=n().A.formatMessage(v.authError);throw i().f1(e),new Error(e)}}function h(e){const{environment:t,pattern:o,integration:r,parentCollectionStore:n,transaction:i}=e;if(!o.connected_relation_properties)throw new Error("Cannot create a connected relation collection without properties");const c=new(a().m)(t,(0,S().zP)({environment:t,table:s().Vl,spaceId:n.pointer.spaceId})),l={};o.connected_relation_sub_schemas&&(0,d().WP)(o.connected_relation_sub_schemas).map((([e,o])=>{const r=new(a().m)(t,(0,S().zP)({environment:t,table:s().Vl,spaceId:n.pointer.spaceId})),d={bot_id:void 0,external_object_id:void 0,uri:e,integration_id:void 0,is_placeholder:void 0,original_url:void 0,domain:void 0,external_schema:o,sync_state:void 0,pattern_name:void 0},m={id:r.id,version:0,space_id:(0,p().e)(n.pointer.spaceId),parent_table:s().Vl,parent_id:c.id,alive:!0,format:d,schema:{}};l[e]=r.id,u().zv({store:r,data:m,transaction:i})}));const m={id:c.id,version:0,space_id:(0,p().e)(n.pointer.spaceId),parent_table:s().Vl,parent_id:n.id,alive:!0,format:{attributes:[{id:"title",name:"title",type:"inline",format:{type:"title",section:"title"},values:[(0,f().Fe)({pattern:o,integration:r})]}],bot_id:void 0,external_object_id:void 0,uri:`notion://user-defined-collection/${r.id}/${o.name}`,integration_id:r.id,is_placeholder:void 0,original_url:void 0,domain:void 0,external_schema:o.connected_relation_properties,sync_state:void 0,pattern_name:o.name,related_external_object_uris_to_instance_ids:l},schema:{}};return u().zv({store:c,data:m,transaction:i}),c}async function A(e){const{bot:t,connected_relation_properties:o}=e;if(t.integration_id===c().Iy||t.integration_id===c().mn)return await async function(e){var t,o,r;const{environment:n,objectName:i,spaceId:a,bot:c}=e,s=await m().callApi({eventName:"describeSalesforceObject",environment:n,data:{spaceId:a,objectName:i,botId:c.id}});if("success"!==(null==s?void 0:s.type))return{error:l().qh.FAILED_TO_FETCH_SALESFORCE_PROPERTIES};var p,d;if((null===(t=s.data)||void 0===t?void 0:t.responseStatus)===l().qh.REAUTHENTICATION_REQUIRED||(null===(o=s.data)||void 0===o?void 0:o.responseStatus)===l().qh.NO_USER_API_ACCESS)return{error:`${null===(p=s.data)||void 0===p?void 0:p.responseStatus}:${null===(d=s.data)||void 0===d?void 0:d.userType}`};const y=null==s||null===(r=s.data)||void 0===r?void 0:r.properties;if(y){return{value:y.flatMap((e=>{const t=e.custom?e.label:e.relationshipName||e.label;return"User"===e.referenceTo||"Group"===e.referenceTo?[{id:e.name,name:t,isSelected:!1,type:e.type,metadata:e,isAlreadySynced:e.isAlreadySynced,isAdminNotAccessible:e.isAdminNotAccessible},{id:`mapped_${e.name}`,name:`${t} (Notion User)`,isSelected:!1,type:"person",metadata:e,isAlreadySynced:e.isAlreadySynced,isAdminNotAccessible:e.isAdminNotAccessible}]:[{id:"Name"===e.name?"title":e.name,name:"relation"===e.type?t:e.label,isSelected:!1,type:e.type,metadata:e,isAlreadySynced:e.isAlreadySynced,isAdminNotAccessible:e.isAdminNotAccessible}]}))}}return{error:l().qh.NO_PROPERTIES_FOUND}}(e);const r=[],n=o;for(const i in n){const e=n[i];null!=e&&e.name&&null!=e&&e.type&&r.push({id:i,name:e.name,isSelected:!1,type:e.type,metadata:{name:e.name,label:e.name,type:e.type,custom:!1},isAlreadySynced:!1})}return{value:r}}},377093:(e,t,o)=>{o.d(t,{XO:()=>q,h3:()=>z,nZ:()=>L,pG:()=>j});o(944114),o(898992),o(823215),o(354520),o(803949),o(581454);var r=()=>o(314529),n=()=>o(564884),i=()=>o(907258),a=()=>o(365917),c=()=>o(675133),l=()=>o(295633),s=()=>o(732810),p=()=>o(433337),d=()=>o(716016),m=()=>o(898244),y=()=>o(617871),u=()=>o(165358),S=()=>o(388693),g=()=>o(792071),f=()=>o(179034),v=()=>o(332393),_=()=>o(96689),h=()=>o(854150),A=()=>o(496603),w=()=>o(534177),b=()=>o(935664),I=()=>o(753812),C=()=>o(896628),P=()=>o(799427),N=()=>o(567700),F=()=>o(928213),T=()=>o(339798),E=()=>o(254497),x=()=>o(312296),R=()=>o(999140),k=()=>o(191356),V=()=>o(601734),U=()=>o(395963),K=()=>o(838038),D=()=>o(244828),O=()=>o(155269);const B=(0,o(69708).YK)({aiCustomPromptDefaultPropertyName:{id:"collectionSettingsCreatePropertyActions.createProperty",defaultMessage:"Text"}});function M(e){const{environment:t,collectionContextStore:o,collectionUri:n,feature:i,transaction:a,addFeatureFrom:c,createFeatureStartTime:l}=e;if("dependencies"in i)for(const r of i.dependencies)"property"===r.type&&r.collectionUri===n&&(0,b().Z)({environment:t,collectionContextStore:o,from:"view_settings",property:r.uri,property_type:r.propertySchema.type,is_suggested_property:!0,property_id:r.uri,feature:{id:r.uri,from:c,type:i.uri}});if("dependencies"in i&&i.dependencies.map((e=>e.type)).every((e=>"property"===e))){const e=o.collectionViewStore(),t=o.getPropertyFormatKey(),r=o.normalizedFormatStore.state;if(t&&e){const o=r[t]||[],n=[...o];i.dependencies.forEach((e=>{const t=o.findIndex((t=>t.property===e.uri));-1===t?n.push({visible:!0,property:e.uri}):n[t]={...o[t],visible:!0}})),C().zA({stores:[e],update:{[t]:n},transaction:a})}}if(void 0!==i.propertyIdCollectionSettingToNavigateTo){const e={type:"property",property:i.propertyIdCollectionSettingToNavigateTo,selectNameInitial:!1,formatKey:o.getPropertyFormatKey()};T().a2({collectionSettingsStore:o.settingsStore,item:e})}a.postSubmitCallbacks.push((e=>{(0,r().DO_NOT_USE_trackLegacy)(t,"collection_create_suggested_property_latency",{collection_uri:i.collectionUri,feature_uri:i.uri,time:Date.now()-l,status:Boolean(e)?"fail":"success"})}))}async function z(e){var t;const{appTemplatesSetupActions:o,appTemplatesSprintBoardActions:r,appConfigs:n}=await V().Aw.load(),{environment:c,collectionContextStore:s,feature:m,addFeatureFrom:g,customPropertyName:A}=e,{sidebarSpaceViewStore:w}=i().default.state,b=s.collectionStore(),T=null==b?void 0:b.getParentBlockStore(),E={},x=e=>{(0,u().log)({level:"error",from:"collectionSettingsCreatePropertyActions",type:"handleCreateNewSuggestedProperty",data:{collectionId:null==b?void 0:b.id,miscDataToConvertToString:{featureUri:m.uri,addFeatureFrom:g,...E,...e}}})};if(!b||!T)return void x({hasCollectionStore:Boolean(b),hasCollectionViewBlockStore:Boolean(T)});if((0,N().u)(m))return async function(e){const{environment:t,collectionContextStore:o,feature:r,addFeatureFrom:n}=e,{untypedFeaturesSetupActions:i}=await V().Aw.load(),a=o.collectionStore(),c=null==a?void 0:a.getParentBlockStore();if(!a||!c)return;const l=Date.now();D().createAndCommit({environment:t,userAction:"collectionSettingsCreatePropertyActions.handleCreateNewUntypedFeature",canUndo:!0,perform:e=>{i.applyUntypedFeature({environment:t,collectionStore:a,collectionViewBlockStore:c,feature:r,transaction:e}),M({environment:t,collectionContextStore:o,collectionUri:p().iH,feature:r,transaction:e,addFeatureFrom:n,createFeatureStartTime:l})}})}({environment:c,collectionContextStore:s,feature:m,addFeatureFrom:g});const R=s.collectionViewStore(),U=null==T?void 0:T.getParentStore(),K=null==b||null===(t=b.getFormat())||void 0===t?void 0:t.app_config_uri,O=K&&(0,P().l)(n(),K);if(E.appConfigUri=O&&O.uri,!U||U.table!==_().NX&&U.table!==f().ev&&U.table!==h().yK||!O)return void x({hasAppParentStore:Boolean(U),appParentStoreTable:null==U?void 0:U.table,appConfigUri:O?O.uri:void 0});const B=b.getSchema(),z=T.getFormat().app_id;E.appId=z;const j=z?await I().callApi({eventName:"getCollectionViewBlocksByAppId",environment:c,data:{spaceId:T.getSpaceId(),appId:z}}):void 0,L="success"===(null==j?void 0:j.type)&&j.data.result.length?j.data.result.map((e=>l().B.createChildStore(U,{table:f().ev,id:e.blockId,spaceId:T.getSpaceId()}))):[T],q=m.integrationId;if(q){const e=a().A.getIntegrationsAsRecordMap().getValue({table:v().Li,id:q});if(!e||!(0,S().v_)(e))return void x({hasIntegration:Boolean(e)});await k().C4(c,b,e,Boolean(m.canOnlyAdminAuth))}q===y().ob&&B&&0===(0,d().yP)(B).length&&await F().c({environment:c,collectionStore:b});const G=Date.now();D().createAndCommit({environment:c,userAction:"collectionSettingsCreatePropertyActions.handleCreateNewSuggestedProperty",canUndo:!0,perform:e=>{var t;if(!w)return void x({hasCurrentSpaceViewStore:!1});const n=null===(t=b.getFormat())||void 0===t?void 0:t.app_config_uri;if(!n)return void x({hasCollectionUri:!1});const i=o.applyTypedFeatures({environment:c,spaceViewStore:w,appParentStore:U,appUri:O.uri,features:[{type:"simple",featureUri:m.uri}],transaction:e,createOrModify:"modify",appCollectionViewBlockStores:L,customPropertyName:A});r.createSprintPage({environment:c,spaceViewStore:w,appParentStore:U,transaction:e,blockStores:i,creationEntryPoint:{type:"sprint_relation"}}),"notion://tasks/sub_task_feature"===m.uri&&C().zA({stores:[b],update:{subitem_property:p().yx.SubTaskRelation},transaction:e}),"notion://tasks/task_dependencies_feature"===m.uri&&(C().zA({stores:[b],update:{collection_default_arrows_by:p().yx.BlockingRelation},transaction:e}),R&&C().zA({stores:[R],update:{timeline_arrows_by:{property:p().yx.BlockingRelation}},transaction:e})),M({environment:c,collectionContextStore:s,collectionUri:n,feature:m,transaction:e,addFeatureFrom:g,createFeatureStartTime:G}),e.isEmpty()&&x({isEmptyTransaction:!0})}})}function j({propertyType:e,collectionContextStore:t,propertyId:o}){const r=t.normalizedSchemaStore.state[o];if(r)switch(e){case"ai_custom_prompt":case"ai_summary":case"ai_extract":case"ai_translate":return T().a2({collectionSettingsStore:t.settingsStore,item:{type:"propertyAiAutofill",propertySchema:r,property:o}});case"ai_keywords":return T().a2({collectionSettingsStore:t.settingsStore,item:{type:"property",property:o,formatKey:t.getPropertyFormatKey()}});default:(0,w().HB)(e)}}function L(e){const{environment:t,collectionContextStore:r,propertyType:n,isSuggestedProperty:i,propertyName:a,propertyIcon:l,selectOptions:s,from:p,shouldOpenEditMenu:d=!0,newPropertyFormat:y}=e,u=r.collectionStore(),S=r.collectionViewStore(),g=r.getPropertyFormatKey(),f=r.normalizedFormatStore.state;if(!u)return;if("relation"===n)return void T().a2({collectionSettingsStore:r.settingsStore,item:{type:"selectRelationSource",property:void 0,initialPropertyName:a,formatKey:g,newPropertyFormat:y}});let v=a;"ai_custom_prompt"===n&&(v=c().A.formatMessage(B.aiCustomPromptDefaultPropertyName));const _=y&&g?{...f,[g]:y}:f,{performResult:h}=D().createAndCommit({userAction:"collectionSettingsCreatePropertyActions.handleCreateNewStandardProperty",environment:t,canUndo:!0,perform:e=>(0,O().createProperty)({environment:t,collectionStore:u,collectionViewArgs:S&&g?{collectionViewStore:S,format:_,formatKey:g}:void 0,propertyName:v,propertyIcon:l,propertyType:n,selectOptions:s,transaction:e})});d&&((0,m().hN)(n)?j({propertyType:n,propertyId:h,collectionContextStore:r}):T().n1({collectionSettingsStore:r.settingsStore,property:h,formatKey:g,selectNameInitial:!0}));const A="view_settings"===p?{feature:{id:h,from:"new_property",type:n}}:{};(0,b().Z)({environment:t,collectionContextStore:r,from:p,property_type:(0,m().v2)(n),property:(0,m().hN)(n)?n:void 0,is_suggested_property:i,property_id:h,...A}),i||r.userAddedPropertyStore.update((()=>!0)),h&&!(0,m().hN)(n)&&o.e(52315).then(o.bind(o,830213)).then((e=>{e.maybeTriggerDatabaseViewNudgeOnCreateProperty({environment:t,collectionContextStore:r,propertyId:h,propertyType:(0,m().v2)(n)})}))}async function q(e){const{environment:t,collectionContextStore:o,intl:r,connectedRelationProperty:i,from:a,untypedFeatureArgs:c,propertyGroupId:l,propertyLimit:s,skipDatabaseActions:p,propertyName:S}=e,f=o.collectionStore(),v=o.collectionViewStore(),_=o.getPropertyFormatKey();if(!f||!_)return;const h=i.integration.id;(0,y().XO)(h)||await k().C4(t,f,i.integration,Boolean(i.canOnlyAdminAuth));const I=f.getSchema();let C;h===y().ob&&I&&0===(0,d().yP)(I).length&&(C=await F().c({environment:t,collectionStore:f}));const P=f.getDeletedSchema(),N=(0,w().WP)(P).map((([e,t])=>{if(t&&m().UU(t)&&t.connectedRelation.integration_id===y().ob)return{propertyId:e,propertySchema:t}})).filter(w().O9);let R;if(!A().Im(N)){const e=N[0];R={propertyId:e.propertyId,update:await G({collectionStore:f,property:e})}}D().createAndCommit({environment:t,userAction:"collectionSettingsCreatePropertyActions.handleCreateNewConnectedRelationProperty",canUndo:!0,perform:e=>{const{shouldCreateNewProperty:d,restoredPropertyId:m}=function(e){const{environment:t,generatedPrefix:o,integrationId:r,propertyGroupId:n,collectionStore:i,collectionContextStore:a,collectionViewStore:c,formatKey:l,transaction:s,maybeRestoreDeletedProperty:p}=e;o&&(0,O().createProperty)({environment:t,collectionStore:i,collectionViewArgs:c?{collectionViewStore:c,format:c.getFormat(),formatKey:l}:void 0,propertyType:"auto_increment_id",transaction:s,propertyGroupId:n});if(null!=p&&p.propertyId){if(p.update){n&&(0,U().En)({collectionStore:i,groupId:n,propertyId:p.propertyId,transaction:s}),(0,x().F)({environment:t,collectionStore:i,update:p.update.updateSchema,transaction:s}),(0,E().E)({collectionStore:i,update:p.update.updateDeletedSchema,transaction:s});const e={type:"property",property:p.propertyId,formatKey:l};return T().a2({collectionSettingsStore:a.settingsStore,item:e}),{shouldCreateNewProperty:!1,restoredPropertyId:p.propertyId}}return(0,u().log)({level:"error",from:"collectionSettingsCreatePropertyActions",type:"handleCreateNewConnectedRelationProperty",data:{message:"Invalid property found in deleted_schema",collectionId:null==i?void 0:i.id,miscDataToConvertToString:{integration:r,maybeRestoreDeletedProperty:p}}}),(0,E().E)({collectionStore:i,update:{[p.propertyId]:null},transaction:s}),{shouldCreateNewProperty:!0}}return{shouldCreateNewProperty:!0}}({environment:t,generatedPrefix:C,transaction:e,propertyGroupId:l,collectionStore:f,collectionViewStore:v,collectionContextStore:o,integrationId:h,formatKey:_,maybeRestoreDeletedProperty:R});if(!d&&m)return m;const y=function(e){const{environment:t,transaction:o,collectionStore:r,collectionViewStore:n,collectionContextStore:i,intl:a,connectedRelationProperty:c,untypedFeatureArgs:l,propertyLimit:s,propertyName:p,formatKey:d}=e,m=c.integration.id,y=g().Bj6.fromIntegration(c.integration),u=k().qM({environment:t,pattern:c.pattern,integration:y,parentCollectionStore:r,transaction:o}),S=(0,O().createProperty)({environment:t,collectionStore:r,collectionViewArgs:n&&d?{collectionViewStore:n,format:n.getFormat(),formatKey:d}:void 0,propertyType:"relation",transaction:o,propertyId:null==l?void 0:l.propertyId});return K().cT({environment:t,collectionContextStore:i,collectionStore:r,property:S,propertyName:p&&p.length>0?p:c.name,propertyIcon:c.integration.info.icon,propertyLimit:s??"no_limit",targetCollectionStore:u,hasInverseRelation:!0,autoRelate:void 0,intl:a,connectedRelation:{integration_id:m},transaction:o}),S}({environment:t,transaction:e,collectionStore:f,collectionViewStore:v,collectionContextStore:o,intl:r,connectedRelationProperty:i,untypedFeatureArgs:c,propertyLimit:s,propertyName:S,formatKey:_});if((0,b().Z)({environment:t,collectionContextStore:o,from:"view_settings",property_id:y,property_type:"relation",integration_id:h,feature:{id:y,from:a,type:`notion://feature/connection_${h}`}}),!c)if(p){const e=f.getSchema(),r=null==e?void 0:e[y];T().a2({collectionSettingsStore:o.settingsStore,item:{type:"connectedRelationDatabaseActions",source:"connectedRelationAddProperties",rootPropertyId:y,integrationId:h,rootPropertySchema:r,skipDatabaseActions:!0,eventSource:"first_time_setup"}}),(0,n().u)({environment:t,event:{eventName:"salesforce_actions",eventProperties:{actionType:"add_properties_clicked",details:{source:"first_time_setup"},integrationId:h,collectionId:null==f?void 0:f.id}}})}else{const e={type:"property",property:y,formatKey:_};T().a2({collectionSettingsStore:o.settingsStore,item:e})}return y}})}async function G(e){const{property:{propertyId:t,propertySchema:o},collectionStore:r}=e,n=(0,m().Nv)(o);if((null==n?void 0:n.spaceId)!==r.getSpaceId())return;const i=s().m.createChildStore(r,n);if(await i.load(),null==i||!i.isDefined())return;if(i.getParentId()!==r.id)return;return(0,R().KA)({deletedSchema:r.getDeletedSchema(),property:t})}},928213:(e,t,o)=>{o.d(t,{c:()=>a});var r=()=>o(165358),n=()=>o(519831),i=()=>o(753812);async function a(e){const{environment:t,collectionStore:o}=e,a={id:o.id,table:n().Vl,spaceId:o.getSpaceId()},c=await i().callApi({eventName:"suggestRecordKey",environment:t,data:{...a,shouldSetSuccessfullySuggestedRecord:!0}});if("success"===c.type)return c.data.key;r().log({level:"error",from:"collectionAutoIncrementIdActions.suggestRecordKeyResponse",type:"JSONParseError",error:{miscDataString:c.error.message}})}}}]);