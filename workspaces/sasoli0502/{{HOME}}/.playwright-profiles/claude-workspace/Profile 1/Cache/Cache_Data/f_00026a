"use strict";(globalThis.webpackChunknotion_next=globalThis.webpackChunknotion_next||[]).push([[14578],{433519:(e,t,o)=>{o.d(t,{i:()=>p});o(581454);var i=o.n(o(794148)),r=()=>o(534177);var a=()=>o(192845),n=()=>o(165358),d=()=>o(792071),l=()=>o(277153),c=()=>o(912720),s=()=>o(199378);function p(e){var t,o;const{originalRecord:p,duplicateRecord:u,mapper:_,options:m,actor:f}=e,v=l().L3.fromSpaceShardRecordId({id:p.id,spaceId:p.space_id},c().yB);u.copied_from_pointer=v;const g=(null===(t=_({requested:l().L3.fromPointerLike({table:u.parent_table,id:u.parent_id,spaceId:u.space_id}),requester:v}))||void 0===t?void 0:t.id)??u.parent_id;u.parent_id=g;const b=(u.action_ids??[]).map((e=>{var t;return(null===(t=_({requested:l().L3.fromPointerLike({table:s().SC,id:e,spaceId:u.space_id}),requester:v}))||void 0===t?void 0:t.id)??e}));u.action_ids=b;const y=Date.now();u.created_time=y,u.last_edited_time=y,u.last_executed_time=void 0,u.last_failed_time=void 0,u.last_failed_reason=void 0,(0,r().O9)(null===(o=u.properties)||void 0===o?void 0:o.schedule_id)&&(u.properties.schedule_id=void 0),(0,r().O9)(f)&&(u.created_by_id=f.id,u.created_by_table=f.table,u.last_edited_by_id=f.id,u.last_edited_by_table=f.table),"recurrence"===u.trigger.type&&m.shouldDisableRecurrenceAutomation&&(u.status="disabled_duplication"),function(e){return"event"===e.trigger.type}(u)&&function(e){var t;const{duplicateRecord:o,mapper:r,originalRecord:l}=e,s=d().Bj6.fromAutomation(o);i()(s.isEventType());const p={id:l.id,spaceId:l.space_id,table:c().yB},{value:u}=(0,a().n)({automationModel:s,visitors:{visitCollectionProperty:void 0,visitRecordPointer:e=>{const t=r({requested:e,requester:p});if(t){const e=t.spaceId??o.space_id;return e!==o.space_id?{type:"replace",value:void 0}:{type:"replace",value:{...t,spaceId:e}}}return{type:"replace",value:void 0}}}});i()(u.isEventType());const _=u.getTrigger();o.trigger=_;const m={sourceAutomationParentId:l.parent_id,sourceAutomationId:l.id,sourceAutomationName:(null===(t=l.properties)||void 0===t?void 0:t.name)??""};o.trigger.event.source||(n().log({data:{miscDataToConvertToString:m},from:"duplicateHelpers.duplicateAutomationEventValueHelper",level:"info",type:"duplicateAutomationMissingTriggerSource"}),o.status="disabled")}({duplicateRecord:u,mapper:_,originalRecord:p})}},514578:(e,t,o)=>{o.d(t,{initializeTemplate:()=>he});o(944114),o(898992),o(908872);var i=()=>o(726637),r=()=>o(770063),a=()=>o(295633),n=()=>o(175482),d=(o(517642),o(658004),o(733853),o(845876),o(432475),o(515024),o(731698),o(803949),o(581454),o(737550),()=>o(496603)),l=()=>o(534177),c=()=>o(700500),s=()=>o(898244),p=()=>o(641007),u=()=>o(206267),_=()=>o(792071),m=()=>o(134025),f=()=>o(912720),v=()=>o(199378),g=()=>o(179034),b=()=>o(201980);function y(e){var t;const{blockValue:o,factoryButtonDeprecationContext:i,source:r}=e,a=function(e){return _().Bj6.fromValue(g().ev,e).getCreatedByPointer()??{id:p().rb.id,table:p().rb.table}}(o),n=o.space_id,d=u().JW(),l=u().JW(),c=i.isRootBlockFactoryBlock&&i.isCurrentBlockRootBlock?i.rootTextContainerId:u().JW(),s=function(e){const{automationActionId:t,textContainerBlockId:o,creatorPointer:i,originalBlockValue:r,spaceId:a,blockContent:n}=e;return{table:g().ev,value:{id:o,space_id:a,alive:!0,parent_table:v().SC,parent_id:t,type:"text",version:0,content:n,created_time:r.created_time,created_by_table:i.table,created_by_id:i.id}}}({automationActionId:l,textContainerBlockId:c,creatorPointer:a,originalBlockValue:o,blockContent:"duplication"===r?null===(t=o.content)||void 0===t?void 0:t.map((t=>e.pointerMapper({id:t,table:g().ev}).id)):o.content,spaceId:n}),m=function(e){const{automationId:t,automationActionId:o,spaceId:i,textContainerBlockId:r}=e;return{table:v().SC,value:{id:o,space_id:i,alive:!0,parent_table:f().yB,parent_id:t,type:"duplicate_blocks",blocks:[r],version:0,config:void 0}}}({automationActionId:l,automationId:d,creatorPointer:a,originalBlockValue:o,spaceId:n,textContainerBlockId:c}),y=function(e){var t;const{creatorPointer:o,automationActionId:i,originalBlockValue:r,spaceId:a,automationId:n}=e,d=u().JW(),l=Date.now();return{table:f().yB,value:{id:n,space_id:a,alive:!0,trigger:{id:d,type:"button"},parent_id:r.id,parent_table:g().ev,action_ids:[i],status:"active",properties:{name:(0,b().q4_)(null===(t=r.properties)||void 0===t?void 0:t.title)},created_by_id:o.id,created_by_table:o.table,created_time:r.created_time??l,last_edited_time:r.last_edited_time??l,version:0,last_edited_by_id:r.last_edited_by_id??o.id,last_edited_by_table:r.last_edited_by_table??o.table}}}({automationActionId:l,automationId:d,creatorPointer:a,originalBlockValue:o,spaceId:n});return{textContainerBlock:s,automation:y,automationAction:m}}o(354520);class I{constructor(e,t,i){this.childToParentMap=new Map,this.unmappedContentIds=new Set,this.extraTranscludedChildren=new(o(99895).G)((()=>new Set)),this.logWarning=t,this.createCopyIndicator=i;for(const{model:o}of e)if(o instanceof _().zgg)for(const t of o.getContentPointers()){e.getModel(t)?this.childToParentMap.has(t.id)?this.extraTranscludedChildren.get(t.id).add(o.id):this.childToParentMap.set(t.id,o.pointer.id):this.unmappedContentIds.add(t.id)}!this.createCopyIndicator&&this.logWarning&&this.logWarning({type:"multiReferencedContentIds",contentIds:Array.from(this.extraTranscludedChildren.keys())})}remapDuplicateBlockParent(e){const{originalBlockPointer:t,duplicateMapper:o}=e,i=this.childToParentMap.get(t.id);if(!i)return;const r=o({requested:{table:g().ev,id:i},requester:t});return r&&r.table===g().ev?r:void 0}createCopyIndicatorBlockValue(e){const{type:t,targetSpaceId:o,sourceBlockId:i,duplicateParentId:r,createdBy:a,createOptions:n,additionalRecordsToMutate:d}=e,{model:l}=_().zgg.create({id:(0,u().JW)(),type:c().xd.copyIndicator,space_id:o,parentPointer:{id:r,table:g().ev,spaceId:o},createdBy:a}),s=l.__IM_SORRY__getValue();return n.onCreate({type:t,duplicateBlockId:s.id,sourceBlockId:i,duplicateParentId:r}),d.push({table:g().ev,value:s}),s.id}remapDuplicateBlockContent(e){const{originalBlockPointer:t,duplicateMapper:o,originalBlockContent:i,originalCreatedBy:r,duplicateBlockId:a,targetSpaceId:n}=e,d=[];return{content:i.map((e=>{if(this.createCopyIndicator&&this.extraTranscludedChildren.has(e)&&this.extraTranscludedChildren.get(e).has(t.id))return this.createCopyIndicatorBlockValue({type:"multi-transcluded-content",targetSpaceId:n,sourceBlockId:e,duplicateParentId:a,createdBy:r,createOptions:this.createCopyIndicator,additionalRecordsToMutate:d});const i=o({requested:{table:g().ev,id:e},requester:t});return i?i.id:this.isUnmappedContentId(e)?this.createCopyIndicator?this.createCopyIndicatorBlockValue({type:"unmapped-content",targetSpaceId:n,sourceBlockId:e,duplicateParentId:a,createdBy:r,createOptions:this.createCopyIndicator,additionalRecordsToMutate:d}):void(null===(l=this.logWarning)||void 0===l||l.call(this,{type:"unmappedContentId",block:t,contentId:e})):e;var l})).filter(l().O9),additionalRecords:d}}isUnmappedContentId(e){return this.unmappedContentIds.has(e)}}var k=()=>o(728396);function q(e,t,o){if((0,k().A8)(e)||(0,k().Jc)(e))return[];const i=[];return o&&i.push(...o),null!=t&&t.previousViewsMainCollectionViewBlockPointer&&i.push(t.previousViewsMainCollectionViewBlockPointer.id),i}var B=()=>o(142748),h=()=>o(813690),C=()=>o(388821),w=()=>o(277153),R=()=>o(519831),P=()=>o(869558),T=()=>o(37165),x=()=>o(144081),S=()=>o(161479),M=()=>o(743246);o(16280);function V(e){const{mapper:t,requested:o,requester:i,table:r}=e,a=O({mapper:t,requested:o,requester:i});if(!(0,w().Yt)(a,r))throw new Error(`Expected mapped duplicate for ${o.table} ${o.id} to be a ${r}, but it is a ${a.table} (while duplicating ${i.table} ${i.id})`);return a}function O(e){const{mapper:t,requested:o,requester:i}=e,r=t({requested:o,requester:i});if(!r)throw new Error(`Unable to find mapped duplicate for ${o.table} ${o.id} while duplicating ${i.table} ${i.id}`);return r}var L=()=>o(522328),D=()=>o(433519),A=()=>o(498212),U=()=>o(973647),j=()=>o(189141),F=()=>o(612740),W=()=>o(31503);const E="415fc269-e68f-4da0-b3e3-b1273b741a7f";var N=()=>o(651124),G=()=>o(68263),z=()=>o(651784),$=()=>o(824862),J=()=>o(665344);var Y=()=>o(931075);function Q(e){return e.type!==c().xd.collectionViewPage&&(!e.content||0===e.content.length)}var H=()=>o(457671),K=()=>o(142406);function Z({originalSpaceId:e,duplicateSpaceId:t,requester:o,collectionPointer:i,mapper:r}){const a=e===t,n=r({requested:i,requester:o})??(a?i:void 0);if(n){if(n.table!==R().Vl)throw new Error(`Collection pointer for duplicate collection is invalid: ${JSON.stringify(n)}`);return n}}function X(e){var t,o,i,r,a,n,s,u,m,v,I,k,q,B,h,C,w,T;const{originalBlock:x,duplicateBlock:V,mapper:O,options:L,originOptions:D,rewiredUriMap:X,typedCollectionViewBlocks:ee,actor:te,helperRecordMap:oe,getExternalRecordValue:ie,factoryButtonDeprecationContext:re,legacyTransclusionFixer:ae,installationImprint:ne,shouldExcludeBlocksFromLimit:de=!1}=e,le={table:g().ev,id:x.id,spaceId:x.space_id};if(null!==(t=x.format)&&void 0!==t&&t.app_config_uri&&null!==(o=V.format)&&void 0!==o&&o.app_config_uri)if((0,N().Sn)(x.format.app_config_uri))V.format.app_config_uri=void 0;else{if((0,c().Ef)(V.type)&&(ee.push({table:g().ev,id:V.id,spaceId:V.space_id}),V.format.app_id)){const e=O({requested:{table:g().ev,id:V.format.app_id,spaceId:V.space_id},requester:le,generateDeterministicId:!0});e&&(V.format.app_id=e.id)}X[x.id]=V.id}if(null!==(i=x.format)&&void 0!==i&&i.app_uri_map&&null!==(r=V.format)&&void 0!==r&&r.app_uri_map)for(const[d,l]of Object.entries(x.format.app_uri_map)){const e=O({requested:{id:l,table:g().ev,spaceId:V.space_id},requester:le});e&&(V.format.app_uri_map[d]=e.id??l,e.id&&(X[e.id]=V.id))}const ce=[];if(V.crdt_data&&delete V.crdt_data,V.crdt_format_version&&delete V.crdt_format_version,null!==(a=V.format)&&void 0!==a&&a.site_id&&delete V.format.site_id,null!==(n=V.format)&&void 0!==n&&n.marketplace_listing_id&&delete V.format.marketplace_listing_id,null!==(s=V.format)&&void 0!==s&&s.slug&&delete V.format.slug,null!==(u=V.format)&&void 0!==u&&u.trigger_id_to_schedule_id&&delete V.format.trigger_id_to_schedule_id,null!==(m=V.format)&&void 0!==m&&m.duplication_job_ids&&delete V.format.duplication_job_ids,null!==(v=V.format)&&void 0!==v&&v.workflow_instruction_artifact_pointer&&delete V.format.workflow_instruction_artifact_pointer,V.deleted_from_trash_id&&delete V.deleted_from_trash_id,V.deleted_from_trash_table&&delete V.deleted_from_trash_table,V.deleted_from_trash_time&&delete V.deleted_from_trash_time,"factory"===V.type&&re){const{automation:e,automationAction:t,textContainerBlock:o}=y({blockValue:V,source:"duplication",pointerMapper:e=>O({requested:e,requester:le})??e,factoryButtonDeprecationContext:re});ce.push(e,t,o),re.factoryBlockIdToNewTextContainerIdMap.set(x.id,{id:o.value.id,table:g().ev});const i=V;i.type="button",i.content=[],i.format={...i.format,automation_id:e.value.id}}let se;if((0,A().uj)(x.id)&&(V.format||(V.format={}),V.format.copied_from_pointer={table:g().ev,id:x.id,spaceId:x.space_id},V.copied_from=x.id),x.parent_table===g().ev&&(se=null==re?void 0:re.factoryBlockIdToNewTextContainerIdMap.get(x.parent_id)),se??=(null==ae?void 0:ae.remapDuplicateBlockParent({originalBlockPointer:le,duplicateMapper:O}))??O({requested:{table:V.parent_table,id:V.parent_id,spaceId:V.space_id},requester:le}),se&&(V.parent_id=se.id,V.parent_table!==se.table&&(0,F().LA)(se)&&(V.parent_table=se.table)),null!==(I=V.format)&&void 0!==I&&I.ai_instructions_page_pointer&&(V.format.ai_instructions_page_pointer=O({requested:V.format.ai_instructions_page_pointer,requester:le})),null!==(k=V.format)&&void 0!==k&&k.ai_block_configuration_menu){const e=(0,j().p8)(V.format.ai_block_configuration_menu);if(U().Q.isSuccess(e)){const t={...e.value};if("context"in t){const e=(t.context??[]).map((e=>{const t=x.space_id===V.space_id;if("slack"!==e.type||t){if("page"===e.type||"currentPage"===e.type){var o;const i=null===(o=O({requested:{table:g().ev,id:e.pageId,spaceId:V.space_id},requester:le}))||void 0===o?void 0:o.id;if(!i)return t?e:void 0;return{type:e.type,pageId:i}}if("collection"===e.type){var i,r;const o=null===(i=O({requested:{table:g().ev,id:e.pageId,spaceId:V.space_id},requester:le}))||void 0===i?void 0:i.id;if(!o)return t?e:void 0;const a=null===(r=O({requested:{table:R().Vl,id:e.collectionId,spaceId:V.space_id},requester:le}))||void 0===r?void 0:r.id;return a?{type:"collection",pageId:o,collectionId:a}:t?e:void 0}return e}})).filter(l().O9);t.context=e}V.format.ai_block_configuration_menu=t}}const pe=V;pe.view_ids&&(pe.view_ids=pe.view_ids.map((e=>{var t;return(null===(t=O({requested:{table:P().Gy,id:e,spaceId:pe.space_id},requester:le}))||void 0===t?void 0:t.id)||e})));const ue=_().Bj6.fromBlock(pe).getCollectionPointers(),_e=[];for(const d of ue){var me;const e=null==ie?void 0:ie({pointer:d}),t=_().Bj6.isModel(R().Vl,e)?e.getFormat().bot_id:void 0,o=null==oe?void 0:oe.getValue(d);if(!Boolean((null==o||null===(me=o.format)||void 0===me?void 0:me.bot_id)??t)){const e=Z({originalSpaceId:x.space_id,duplicateSpaceId:V.space_id,requester:le,collectionPointer:d,mapper:O});if(!e)continue;_e.push(e)}}_e.length>0?(pe.collection_id=_e[0].id,pe.format={...pe.format,collection_pointer:_e[0],collection_pointers:_e}):(pe.collection_id=void 0,pe.format={...pe.format,collection_pointer:void 0,collection_pointers:void 0}),null!==(q=V.format)&&void 0!==q&&q.form_layout_pointer&&(V.format.form_layout_pointer=O({requested:V.format.form_layout_pointer,requester:le})),null!==(B=V.format)&&void 0!==B&&B.suggestions&&delete V.format.suggestions,V.discussions&&delete V.discussions,V.permissions&&(L.duplicatePermissions?V.permissions=function(e){const{block:t,targetSpaceSettings:o,targetTeamSettings:i}=e;return(t.permissions||[]).filter((e=>!((0,G().P3)(e)||(0,G().Ds)(e)||(!i&&o.disablePublicAccess||i&&i.disable_public_access)&&(0,G().FP)(e)||(!i&&o.disableGuests||i&&i.disable_guests)&&(0,G().B2)(e)&&!o.memberUserIds.includes(e.user_id))))}({block:V,targetSpaceSettings:L.duplicatePermissions.targetSpaceSettings,targetTeamSettings:L.duplicatePermissions.targetTeamSettings}):(delete V.permissions,"form"===V.type&&(V.permissions=(0,W().eb)()))),V.content_classification&&delete V.content_classification,V.moved&&delete V.moved,V.properties||(V.properties={});for(const d in V.properties)V.properties[d]=b().Uee(V.properties[d],{removeSuggestionAnnotationsAndText:!0,removeSuggestionAnnotations:!0,removeDiscussions:!0});if(de&&Q(V)?V.ignore_block_count=!0:V.ignore_block_count&&delete V.ignore_block_count,V.properties){for(const e of Object.keys(V.properties)){const t=V.properties[e];t&&(V.properties[e]=(0,K().R)({...D,text:{value:t,spaceId:(0,S().e)(V.space_id)},mapper:O,requester:le,resolveTemplateVariables:L.resolveTemplateVariables||!1}))}if(!0!==L.preserveVerification)for(const e of[Y()._e.Verification,"verifier"])e in V.properties&&(V.properties[e]=[]);"title"in V.properties&&(V.properties.title=b().ooo(V.properties.title))}if("transclusion_reference"===V.type&&L.deepCopyTransclusionContainers){const e=V;if(e.format&&e.format.transclusion_reference_pointer){const t=e.format.transclusion_reference_pointer,o=O({requested:t,requester:le});o&&(e.format.transclusion_reference_pointer=o)}}if((0,c().$I)(V.type)&&L.shallowCopyNavigableBlock){const e=V;e.type="text";const t=b().ld4(x.id,x.space_id),o=[b().wmz(t)];e.properties={title:o},e.content=[]}if("transclusion_container"===V.type&&!L.deepCopyTransclusionContainers){const e=V;e.type="transclusion_reference",e.content=void 0;const t=e.format||{};t.transclusion_reference_pointer=le,e.format=t}if("alias"===V.type&&V.format&&V.format.alias_pointer){const e=V.format.alias_pointer,t=O({requested:e,requester:le});t&&(V.format.alias_pointer=t)}if("image"===V.type){var fe;const e=null===(fe=V.format)||void 0===fe?void 0:fe.image_hyperlink;if(V.format&&e){const[t]=(0,z().Jq)({url:e,isMobile:!1,baseUrl:"",publicDomainName:"",protocol:void 0,currentUrl:void 0});if(t){const e=(0,H().D)({route:t,targetSpaceId:V.space_id,mapper:O,requester:le});e&&(V.format.image_hyperlink=e)}}}if(ve=V,(0,c().p7)(ve.type)&&V.format)if(ne)V.format.installation_imprint={pointer:ne};else if(V.format.installation_imprint){const e=O({requested:V.format.installation_imprint.pointer,requester:le});e&&(V.format.installation_imprint={pointer:{id:e.id,table:J()._i}})}var ve,ge,be,ye;if((V.type===c().xd.externalObjectInstancePage&&(V.type=c().xd.externalObjectInstance),V.type===c().xd.externalObjectInstance)&&(null!==(ge=V.format)&&void 0!==ge&&ge.related_external_object_uris_to_instance_ids&&(V.format.related_external_object_uris_to_instance_ids=(0,l().MU)((0,l().WP)(V.format.related_external_object_uris_to_instance_ids).map((([e,t])=>{var o;return[e,(null===(o=O({requested:{table:g().ev,id:t,spaceId:pe.space_id},requester:le}))||void 0===o?void 0:o.id)||t]})))),L.convertExternalObjectInstancesToPlaceholders&&(null===(be=V.format)||void 0===be||!be.is_placeholder)&&null!==(ye=V.format)&&void 0!==ye&&ye.bot_id)){const e={table:$().GP,id:V.format.bot_id},t=null==oe?void 0:oe.getValue(e),o=null==ie?void 0:ie({pointer:e}),i=_().Bj6.isModel($().GP,o)?o.getIntegrationId():void 0,r=(null==t?void 0:t.integration_id)??i;if(r){const e={is_placeholder:!0,integration_id:r};V.format=e}}V.file_ids&&function(e){var t;const o=JSON.stringify(e.properties);e.file_ids=null==e||null===(t=e.file_ids)||void 0===t?void 0:t.filter((t=>{var i,r,a,n,d,l;return!(null===(i=e.format)||void 0===i||!i.display_source||-1===(null===(r=e.format)||void 0===r||null===(r=r.display_source)||void 0===r?void 0:r.indexOf(t)))||!(null===(a=e.format)||void 0===a||!a.page_cover||-1===(null===(n=e.format)||void 0===n||null===(n=n.page_cover)||void 0===n?void 0:n.indexOf(t)))||!(null===(d=e.format)||void 0===d||!d.page_icon||-1===(null===(l=e.format)||void 0===l||null===(l=l.page_icon)||void 0===l?void 0:l.indexOf(t)))||-1!==o.indexOf(t)}))}(V);const Ie=x,ke=V;if(ke.format&&(null!==(h=Ie.format)&&void 0!==h&&h.original_source||null!==(C=Ie.format)&&void 0!==C&&C.image_edit_metadata)&&(ke.format.original_source=void 0,ke.format.image_edit_metadata=void 0),null!==(w=V.format)&&void 0!==w&&w.automation_id){const e=O({requested:{table:f().yB,id:V.format.automation_id,spaceId:V.space_id},requester:le});e&&(V.format.automation_id=e.id)}var qe;null!==(T=V.format)&&void 0!==T&&T.workflow_id&&(V.format.workflow_id=null===(qe=O({requested:{table:M().C0,id:V.format.workflow_id,spaceId:V.space_id},requester:le}))||void 0===qe?void 0:qe.id);if(V.format&&"database_agent_ids"in V.format&&V.format.database_agent_ids&&(V.format.database_agent_ids=V.format.database_agent_ids.map((e=>{var t;return null===(t=O({requested:{table:M().C0,id:e,spaceId:V.space_id},requester:le}))||void 0===t?void 0:t.id})).filter(l().O9)),V.type===c().xd.transcription&&V.format){var Be,he,Ce,we;if(V.format.transcription_notes_id)V.format.transcription_notes_id=null===(he=O({requested:{table:g().ev,id:V.format.transcription_notes_id,spaceId:V.space_id},requester:le}))||void 0===he?void 0:he.id;if(V.format.transcription_transcript_id)V.format.transcription_transcript_id=null===(Ce=O({requested:{table:g().ev,id:V.format.transcription_transcript_id,spaceId:V.space_id},requester:le}))||void 0===Ce?void 0:Ce.id;if(V.format.transcription_summary_id)V.format.transcription_summary_id=null===(we=O({requested:{table:g().ev,id:V.format.transcription_summary_id,spaceId:V.space_id},requester:le}))||void 0===we?void 0:we.id;const e=null===(Be=V.format.transcription_state)||void 0===Be?void 0:Be.state;"transcribing"!==e&&"summarizing"!==e||(V.format.transcription_state={state:"paused"})}if("collection"===x.parent_table&&x.type===c().xd.copyIndicator&&V.properties&&(0,l().uv)(V.properties).length>0&&(V.type=c().xd.page),!L.preserveSourceMetadataTimestamps){const e=Date.now();V.created_time=e,V.last_edited_time=e}te&&(V.last_edited_by_id=te.id,V.last_edited_by_table=te.table,V.created_by_id=te.id,V.created_by_table=te.table),V.non_content_children&&(V.non_content_children=V.non_content_children.map((e=>{var t;return(null===(t=O({requested:{table:g().ev,id:e,spaceId:V.space_id},requester:le}))||void 0===t?void 0:t.id)||e})));const Re=V;if(Re.content){var Pe;if(ae){const e=ae.remapDuplicateBlockContent({originalBlockPointer:le,duplicateMapper:O,originalBlockContent:Re.content,originalCreatedBy:te||p().TI.pointer,duplicateBlockId:Re.id,targetSpaceId:V.space_id});Re.content=e.content,ce.push(...e.additionalRecords)}else Re.content=Re.content.map((e=>{var t;return null===(t=O({requested:{table:g().ev,id:e},requester:le,fromContentArray:!0}))||void 0===t?void 0:t.id})).filter(l().O9);if(V.space_id===E&&null!==(Pe=V.properties)&&void 0!==Pe&&Pe.title){var Te,xe,Se;const e=(0,b().RQ)(null===(Te=V.properties)||void 0===Te?void 0:Te.title);e&&e.length>0&&e[0].length>0&&null!==(xe=e[0][0])&&void 0!==xe&&null!==(xe=xe.trim())&&void 0!==xe&&xe.startsWith("ðŸŽ²")&&null!==(Se=e[0][0])&&void 0!==Se&&null!==(Se=Se.trim())&&void 0!==Se&&Se.endsWith("ðŸŽ²")&&(Re.content=d().k4(Re.content))}}return{duplicateRecord:V,additionalRecords:ce}}var ee=()=>o(713998),te=()=>o(443881);function oe({originalCollection:e,duplicateCollection:t,mapper:o,originOptions:i,rewiredUriMap:r,isTemplateInstantiation:a,options:n,actor:d}){var c,p,u,_,m;const v={table:R().Vl,id:e.id,spaceId:e.space_id};if(function(e,t,o){var i;if(null===(i=e.format)||void 0===i||!i.compound_workflow_template_instances)return;const r={table:R().Vl,id:e.id,spaceId:e.space_id};t.format||(t.format={});t.format.compound_workflow_template_instances=e.format.compound_workflow_template_instances.map((e=>({...e,instance_pointers:e.instance_pointers.map((e=>{const i=t.space_id;if("property"===e.type)return e;const a=e.type,n=V({table:a,mapper:o,requested:{table:a,id:e.id,spaceId:i},requester:r});return{type:n.table,id:n.id}}))})))}(e,t,o),null!==(c=e.format)&&void 0!==c&&c.app_config_uri&&(r[e.id]=t.id),t.template_pages&&(t.template_pages=t.template_pages.map((e=>{var t;return(null===(t=o({requested:{table:g().ev,id:e},requester:v}))||void 0===t?void 0:t.id)||e}))),(0,A().uj)(e.id)){if(t.format||(t.format={}),t.format.copied_from_pointer={table:R().Vl,id:e.id,spaceId:e.space_id},void 0!==t.format.collection_default_template&&"empty"!==t.format.collection_default_template){var b;const e=o({requested:{table:g().ev,id:t.format.collection_default_template.template_page_id},requester:v});e&&null!==(b=t.template_pages)&&void 0!==b&&b.includes(e.id)?t.format.collection_default_template={template_page_id:e.id}:t.format.collection_default_template="empty"}if(t.format.layout_pointer){const e=o({requested:t.format.layout_pointer,requester:v});e&&(0,w().Yt)(e,x().zx)?t.format.layout_pointer=e:t.format.layout_pointer=void 0}t.copied_from=e.id}const y=o({requested:{table:t.parent_table,id:t.parent_id},requester:v});y&&(t.parent_id=y.id);const I=s().Dp(t);for(const l in I){const r=I[l];if(r&&"relation"===r.type&&s().Nv(r)){const e=o({requested:s().Nv(r),requester:v});e?(r.collection_id=e.id,r.collection_pointer={id:e.id,table:R().Vl,spaceId:(0,S().e)(e.spaceId)}):r.property&&(r.property=void 0)}var k;if(r&&"title"===r.type&&t.name&&(t.name=(0,K().R)({...i,text:{value:t.name,spaceId:t.space_id},mapper:o,requester:v,resolveTemplateVariables:!1})),r&&"button"===r.type&&r.automation_id)r.automation_id=(null===(k=o({requested:{id:r.automation_id,spaceId:e.space_id,table:f().yB},requester:v}))||void 0===k?void 0:k.id)??r.automation_id;r&&s().DQ(r)&&r.options&&(r.options=(0,ee().ki)(r.options))}if(t.description&&(t.description=(0,K().R)({...i,text:{value:t.description,spaceId:t.space_id},mapper:o,requester:v,resolveTemplateVariables:!1})),!n.preserveSourceMetadataTimestamps){const e=Date.now();t.created_time=e,t.last_edited_time=e}d&&(t.last_edited_by_id=d.id,t.last_edited_by_table=d.table,t.created_by_id=d.id,t.created_by_table=d.table),null!==(p=t.format)&&void 0!==p&&p.metadata_copied_from&&(t.format.metadata_copied_from=void 0);for(const l in I){const e=I[l];if(!e||"formula"!==e.type||"v2"!==e.version||!e.formula2)continue;const{value:r}=(0,te().RI)({baseUrl:i.baseUrl,formula:e.formula2.code,publicDomainName:i.publicDomainName,spaceId:t.space_id,visitors:{visitFormulaContextValue:void 0,visitFormulaPageProperty:e=>{if("collection"in e&&e.collection){const t=o({requested:e.collection,requester:v});if(t&&t.table===R().Vl)return{type:"replace",value:{...e,collection:t}}}return{type:"keep"}},visitRecordPointer:void 0}});e.formula2.code=r}if(null!==(u=t.format)&&void 0!==u&&u.collection_mode&&"page_tree"===t.format.collection_mode.type){var q;const e=t.format.collection_mode.root_page_pointer,i=(null===(q=o({requested:w().L3.fromPointerLike({table:"block",id:e.id,spaceId:t.space_id}),requester:v}))||void 0===q?void 0:q.id)||e.id;t.format.collection_mode={type:"page_tree",root_page_pointer:{id:i,table:"block",spaceId:t.space_id}}}null!==(_=t.format)&&void 0!==_&&_.related_external_object_uris_to_instance_ids&&(t.format.related_external_object_uris_to_instance_ids=(0,l().MU)((0,l().WP)(t.format.related_external_object_uris_to_instance_ids).map((([e,i])=>{var r;return[e,(null===(r=o({requested:{table:R().Vl,id:i,spaceId:t.space_id},requester:v}))||void 0===r?void 0:r.id)||i]})))),delete t.deleted_schema,null!==(m=t.format)&&void 0!==m&&m.automation_ids&&(t.format.automation_ids=t.format.automation_ids.map((e=>{var i;return null===(i=o({requested:{id:e,table:f().yB,spaceId:t.space_id},requester:v}))||void 0===i?void 0:i.id})).filter(l().O9)),e.permissions&&(t.permissions=function(e,t,o){return e.filter((e=>!!(0,G().tb)(e)&&(t||o)))}(e.permissions,a,n.duplicateOnlyCollectionSchema))}var ie=()=>o(62371),re=()=>o(300525);var ae=()=>o(691678),ne=()=>o(976618);o(672577);var de=()=>o(966249);const le={block:!0,collection:!0,collection_view:!0,automation:!0,automation_action:!0,layout:!0,form_question:!0,workflow:!0};function ce(e){return e.table in le}function se(e){const{sourceBlockId:t,targetBlockPointer:o,recordMap:i,options:r,baseUrl:a,publicDomainName:n,actor:l,getRecordRole:c,mapper:s,preventLegacyTransclusions:p,createLegacyTransclusionCopyIndicator:m,logWarning:f,spaceIdCreator:v,installationImprint:b,isTemplateInstantiation:y}=e,k=[],w=e.recordPointerMap||C().RecordMapPolymorphic.create(),R={table:g().ev,id:t};for(const{pointer:d}of i){if(d.id===t){w.set(d,o);continue}let e=w.get(d);!e&&s&&(e=s({requested:d,requester:R})),e||(e={spaceId:o.spaceId,table:d.table,id:(null==v?void 0:v.idInSavedSpace(d.table))??u().Dt()}),w.set(d,e)}let P;p&&(P=new I(i,f,m??!1));const T=C().RecordMap.create(),S=({requested:e})=>w.get(e),M={},V=[],O=new Set,L=i.getModel({id:t,table:g().ev}),D=L?function(e){const t="duplication",o=new Map;let i;return"factory"===e.type?(i={type:t,isRootBlockFactoryBlock:!0,isCurrentBlockRootBlock:!1,factoryBlockIdToNewTextContainerIdMap:o,rootTextContainerId:u().JW()},i.factoryBlockIdToNewTextContainerIdMap.set(e.id,{id:i.rootTextContainerId,table:g().ev})):i={type:t,isRootBlockFactoryBlock:!1,factoryBlockIdToNewTextContainerIdMap:o},i}(L):void 0;for(const{pointer:d,model:u}of i){if(void 0===u)continue;if(!ce(u))continue;const e=Boolean((null==r?void 0:r.resolveTemplateVariables)&&_e({rootSourceBlockIds:[t],childSourcePointer:d,getSourceRecordValue:h().xb.fromRecordMap(i)}))?{...r,resolveTemplateVariables:!1}:r;if(u.table===x().zx){const e=q(u.getRawModules(),u.getFormat(),u.getBlocks());for(const t of e)O.add(t)}null!=D&&D.isRootBlockFactoryBlock&&(D.isCurrentBlockRootBlock=u.id===t);const{duplicateRecord:s,additionalRecords:p}=ue({table:u.table,record:u.__IM_SORRY__getValue(),mapper:S,options:e,rewiredUriMap:M,typedCollectionViewBlocks:V,originOptions:{baseUrl:a,publicDomainName:n},actor:l,getRecordRole:c,factoryButtonDeprecationContext:D,legacyTransclusionFixer:P,installationImprint:b,layoutCollectionViewBlocksToRemove:O,logWarning:f});if(void 0!==s){if(u.table===g().ev&&s.id===o.id){const e=s;delete e.parent_id,delete e.parent_table,delete e.alive}y&&u.table===g().ev&&u.autoGenerateOnTemplateDuplication()&&k.push({table:g().ev,id:s.id,spaceId:s.space_id}),pe({duplicateRecordMap:T,duplicateRecordResult:{duplicateRecord:s,additionalRecords:p,duplicateRecordTable:u.table}})}}!function(e){const{rewiredUriMap:t,typedCollectionViewBlocks:o,duplicateRecordMap:i}=e;if(d().Im(t)||0===o.length)return;const r=d().oE(o.map((e=>i.getValue(e))));r.forEach((e=>{var o;const i=null==e||null===(o=e.format)||void 0===o?void 0:o.app_uri_map;i&&Object.entries(i).forEach((([e,o])=>{i[e]=t[o]}))}));const a=r.reduce(((e,t)=>{var o;const i=null==t||null===(o=t.format)||void 0===o?void 0:o.app_id;return i&&(e[i]=e[i]?[...e[i],t]:[t]),e}),{});Object.entries(a).forEach((([e,t])=>{const o=u().JW();t.forEach((e=>{var t;null!=e&&null!==(t=e.format)&&void 0!==t&&t.app_id&&(e.format.app_id=o)}))}))}({rewiredUriMap:M,typedCollectionViewBlocks:V,duplicateRecordMap:T});const A=function(e,t,o,i){if(0===e.size)return t;const r=new Set;for(const c of e){const e=o({requested:{id:c,table:g().ev},requester:i});r.add((null==e?void 0:e.id)||c)}const a=t.clone(),n=_().b4_.fromRecordMap(a);function d(e){return(0,B().Yn)(e.pointer,n).some(((e,t)=>r.has(e.id)))}const l=[];for(const{pointer:c,model:s}of a)s&&!d(s)||l.push(c);return l.forEach((e=>a.delete(e))),a}(O,T,S,R);return{duplicateRecordMap:A,originalToDuplicate:w,aiBlocksToAutoGenerate:k}}function pe(e){const{duplicateRecordResult:t,duplicateRecordMap:o}=e,{additionalRecords:i,duplicateRecord:r,duplicateRecordTable:a}=t;o.setValue(w().L3.fromPointerLike({table:a,id:r.id,spaceId:r.space_id}),r);for(const n of i)o.setValue(w().L3.fromPointerLike({id:n.value.id,table:n.table,spaceId:n.value.space_id}),n.value)}function ue(e){const{table:t,record:o,mapper:i,options:r,originOptions:a,actor:n,helperRecordMap:c,getExternalRecordValue:s,getRecordRole:p,rewiredUriMap:u,typedCollectionViewBlocks:m,factoryButtonDeprecationContext:b,legacyTransclusionFixer:y,installationImprint:I,isTemplateInstantiation:k,shouldExcludeBlocksFromLimit:q,targetBlockIds:B,layoutCollectionViewBlocksToRemove:h,logWarning:C}=e,A=d().mg(o),U=O({mapper:i,requested:w().L3.fromPointerLike({table:t,id:o.id,spaceId:o.space_id}),requester:w().L3.fromPointerLike({table:t,id:o.id})});A.id=U.id,A.space_id=(0,S().e)(U.spaceId);const j=[];if(t===g().ev){const e=A,{additionalRecords:t}=X({originalBlock:o,duplicateBlock:e,mapper:i,options:r??{},rewiredUriMap:u,typedCollectionViewBlocks:m,originOptions:a,actor:n,helperRecordMap:c,getExternalRecordValue:s,factoryButtonDeprecationContext:b,legacyTransclusionFixer:y,installationImprint:I,shouldExcludeBlocksFromLimit:q});j.push(...t)}else if(t===R().Vl){oe({originalCollection:o,duplicateCollection:A,mapper:i,originOptions:a,rewiredUriMap:u,isTemplateInstantiation:k,options:r??{},actor:n})}else if(t===P().Gy){!function(e,t,o,i,r,a,n,d){var l,c,s,p,u,m,f,v,b,y;const I={table:P().Gy,id:e.id,spaceId:e.space_id};if(null!==(l=e.format)&&void 0!==l&&l.app_config_uri&&null!==(c=t.format)&&void 0!==c&&c.app_config_uri&&((0,N().Sn)(e.format.app_config_uri)?t.format.app_config_uri=void 0:i[e.id]=t.id),null!==(s=e.format)&&void 0!==s&&s.app_uri_map&&null!==(p=t.format)&&void 0!==p&&p.app_uri_map)for(const[_,w]of Object.entries(e.format.app_uri_map)){const r=o({requested:{id:w,table:g().ev,spaceId:e.space_id},requester:I});r&&(t.format.app_uri_map[_]=r.id??w,r.id&&(i[r.id]=t.id))}const k=null===(u=t.format)||void 0===u?void 0:u.collection_pointer;if(k){const i=null==r?void 0:r.getModel(k),a=null==d?void 0:d({pointer:k}),n=_().Bj6.isModel(R().Vl,a)?a.getFormat().bot_id:void 0;if(!Boolean(null==i?void 0:i.isSyncedCollection())&&!Boolean(n)){const i=Z({originalSpaceId:e.space_id,duplicateSpaceId:t.space_id,requester:I,collectionPointer:k,mapper:o});t.format={...t.format,collection_pointer:i}}}if(t.format){var q,B;const e=null===(q=t.format.collection_groups)||void 0===q?void 0:q.map((e=>{if("relation"===e.value.type&&(0,ie().WO)(e.value.value)&&e.value.value){const t=o({requested:e.value.value,requester:I});return{...e,value:{type:"relation",value:t&&(0,w().Yt)(t,g().ev)?t:e.value.value}}}return e}));t.format.collection_groups=e;const i=null===(B=t.format.board_columns)||void 0===B?void 0:B.map((e=>{if("relation"===e.value.type&&(0,ie().WO)(e.value.value)&&e.value.value){const t=o({requested:e.value.value,requester:I});return{...e,value:{type:"relation",value:t&&(0,w().Yt)(t,g().ev)?t:e.value.value}}}return e}));t.format.board_columns=i;const r=t.format.collection_view_default_template;if(void 0!==r&&"empty"!==r){const e=o({requested:{table:g().ev,id:r.template_page_id},requester:I});e&&(a&&(n?null==n?void 0:n.includes(e.id):e)||(t.format.collection_view_default_template={template_page_id:e.id}))}}const h=o({requested:{table:t.parent_table,id:t.parent_id,spaceId:t.space_id},requester:I});if(h&&(t.parent_id=h.id),t.page_sort&&(t.page_sort=t.page_sort.map((e=>{var i;return(null===(i=o({requested:{table:g().ev,id:e,spaceId:t.space_id},requester:I}))||void 0===i?void 0:i.id)||e}))),"page"===t.type&&null!==(m=t.format)&&void 0!==m&&m.page_pointer){var C;const e=t.format.page_pointer,i=(null===(C=o({requested:w().L3.fromPointerLike({table:"block",id:e.id,spaceId:t.space_id}),requester:I}))||void 0===C?void 0:C.id)||e.id;t.format.page_pointer={table:"block",id:i,spaceId:t.space_id}}if(null!==(f=t.format)&&void 0!==f&&f.property_filters){const e=t.format.property_filters;for(const t of e)t.filter&&(0,re().w)(t.filter,(e=>{var t;return null===(t=o({requested:e,requester:I}))||void 0===t?void 0:t.id}))}if(null!==(v=t.format)&&void 0!==v&&v.filters2){const e=t.format.filters2;for(const t of e)t.filter&&(0,re().w)(t.filter,(e=>{var t;return null===(t=o({requested:e,requester:I}))||void 0===t?void 0:t.id}))}const T=t.query2;if(T&&T.filter&&(0,re().w)(T.filter,(e=>{var t;return null===(t=o({requested:e,requester:I}))||void 0===t?void 0:t.id})),null!==(b=t.format)&&void 0!==b&&b.form_block_pointer){var x;const e=o({requested:null===(x=t.format)||void 0===x?void 0:x.form_block_pointer,requester:I});e&&"block"===e.table&&(t.format.form_block_pointer=e)}if(null!==(y=t.format)&&void 0!==y&&y.dashboard_layout_pointer){const e=o({requested:t.format.dashboard_layout_pointer,requester:I});e&&"layout"===e.table&&(t.format.dashboard_layout_pointer=e)}}(o,A,i,u,c,k,B,s)}else t===f().yB?(0,D().i)({originalRecord:o,duplicateRecord:A,mapper:i,options:r??{},actor:n}):t===v().SC?(0,L().I)({originalRecord:o,duplicateRecord:A,mapper:i,getRecordRole:p,options:r??{},originOptions:a}):t===M().C0?function(e){const{original:t,duplicate:o,mapper:i,logWarning:r}=e,a={table:M().C0,id:t.id,spaceId:t.space_id},n=i({requested:{table:g().ev,id:t.parent_id,spaceId:t.space_id},requester:a});if(n&&(o.parent_id=n.id),o.space_id=(null==n?void 0:n.spaceId)??t.space_id,!o.data)return;o.data.runtime_actor_pointer=void 0,o.data.draft_runtime_actor_pointer=void 0,o.data.usage_limit=void 0,o.data.status="runnable",o.data.paused_reason=void 0;for(const c of(null===(d=o.data)||void 0===d?void 0:d.modules)??[]){var d;if(c.state){const e=(0,de().jK)(c.type);null!=e&&e.stateDuplicator&&(c.state=e.stateDuplicator({original:c.state,mapper:i,requester:a}))}if("notion"===c.type&&c.permissions)for(const e of c.permissions)if("notion"===e.type&&"pageOrCollectionViewBlock"===e.identifier.type){const o=i({requested:{table:g().ev,id:e.identifier.blockId,spaceId:t.space_id},requester:a});o&&(e.identifier.blockId=o.id)}}const l=[];for(const c of o.data.triggers??[]){if(!c.state){null==r||r({type:"skippedInvalidWorkflowTrigger",triggerId:c.id,reason:"missingTriggerState"});continue}const e=(o.data.modules??[]).find((e=>e.id===c.moduleId));if(!e){null==r||r({type:"skippedInvalidWorkflowTrigger",triggerId:c.id,reason:"moduleNotFound"});continue}if(!(0,de().jK)(e.type)){null==r||r({type:"skippedInvalidWorkflowTrigger",triggerId:c.id,reason:"moduleDefinitionNotFound"});continue}const t=(0,de().C7)(e.type,c.state.type);t?(c.state=t.triggerDuplicator({original:c.state,mapper:i,requester:a}),l.push(c)):null==r||r({type:"skippedInvalidWorkflowTrigger",triggerId:c.id,reason:"triggerDefinitionNotFound"})}o.data.triggers=l}({original:o,duplicate:A,mapper:i,originOptions:a,logWarning:C}):t===x().zx?function({original:e,duplicate:t,mapper:o,layoutCollectionViewBlocksToRemove:i}){var r,a;const n={table:x().zx,id:e.id,spaceId:e.space_id};t.parent_id=O({mapper:o,requested:w().L3.fromPointerLike({table:t.parent_table,id:t.parent_id,spaceId:t.space_id}),requester:n}).id,t.format||(t.format={}),t.format.copied_from_pointer={table:x().zx,id:e.id,spaceId:e.space_id},t.modules=(0,ae().Pe)(t.modules);const d=e=>({...e,collection_view_id:V({table:P().Gy,mapper:o,requested:{table:P().Gy,id:e.collection_view_id,spaceId:t.space_id},requester:n}).id}),l=(0,ne().E)(t.modules,(e=>"views"===e.type||"viewsMain"===e.type?{type:e.type,id:e.id,collection_view_block_pointer:{...V({table:g().ev,mapper:o,requested:w().L3.fromPointerLike(e.collection_view_block_pointer),requester:n}),spaceId:t.space_id}}:"formQuestion"===e.type?{type:"formQuestion",id:e.id,formQuestionId:{...V({table:T().lo,mapper:o,requested:w().L3.fromPointerLike({table:T().lo,id:e.formQuestionId,spaceId:t.space_id}),requester:n}),spaceId:t.space_id}.id,parentModuleId:e.parentModuleId,parentConditionalGroupId:e.parentConditionalGroupId,conditionalGroups:e.conditionalGroups}:"placeholder"===e.type?{type:"placeholder",id:e.id,parentModuleId:e.parentModuleId,parentConditionalGroupId:e.parentConditionalGroupId}:"view"===e.type?d(e):"row"===e.type?{type:"row",id:e.id,modules:e.modules.map(d)}:(e.type,e))),c=Object.fromEntries(Object.entries(l.form_conditional_modules??{}).filter((e=>{const[t,o]=e;return"formQuestion"===o.type||"placeholder"===o.type})));t.modules={...l,form_conditional_modules:c},null!==(r=t.format)&&void 0!==r&&r.previousViewsMainCollectionViewBlockPointer&&null!=i&&i.has(t.format.previousViewsMainCollectionViewBlockPointer.id)&&delete t.format.previousViewsMainCollectionViewBlockPointer;const s=null===(a=e.blocks)||void 0===a?void 0:a.filter((e=>!(null!=i&&i.has(e))));s&&(t.blocks=s.map((e=>O({mapper:o,requested:{table:g().ev,id:e,spaceId:t.space_id},requester:n}).id)))}({original:o,duplicate:A,mapper:i,layoutCollectionViewBlocksToRemove:h}):t===T().lo?function(e){const{original:t,duplicate:o,mapper:i}=e,r={table:T().lo,id:t.id,spaceId:t.space_id},a=i({requested:w().L3.fromPointerLike({table:o.parent_table,id:o.parent_id,spaceId:o.space_id}),requester:r});a&&(o.parent_id=a.id)}({original:o,duplicate:A,mapper:i,originOptions:a}):(0,l().HB)(t);return{duplicateRecord:A,additionalRecords:j}}function _e(e){const{rootSourceBlockIds:t,childSourcePointer:o,getSourceRecordValue:i}=e;for(const r of(0,B()._N)(o,i))if(me({rootSourceBlockIds:t,recordWithTable:r}))return!0;return!1}function me(e){const{recordWithTable:t,rootSourceBlockIds:o}=e;if(t.table!==g().ev)return t.table===v().SC;if(o.includes(t.value.id))return!1;if(_().Bj6.fromBlock(t.value).isTemplateVariableContainerBlock())return!0}var fe=()=>o(583835),ve=()=>o(165358),ge=()=>o(416504),be=()=>o(416845),ye=()=>o(798880),Ie=()=>o(439180),ke=()=>o(357625),qe=()=>o(384944),Be=()=>o(244828);function he(e){const{environment:t,sourceBlockId:o,sourceBlockSubtree:r,targetBlockPointer:n,targetRecordCache:d,transaction:l,deepCopyTransclusionContainers:c,resolveTemplateVariables:s,recordPointerMap:p,preventLegacyTransclusions:u,createLegacyTransclusionCopyIndicator:_,spaceIdCreator:m,installationImprint:f,templateInstallationMetadata:v,isTemplateInstantiation:g,appendContentOnly:b,sourceBlockUpdateStrategy:y}=e,I=t.currentUser.id;let k=!1;("onboarding"===(null==v?void 0:v.source)||"team_home"===(null==v?void 0:v.source)||null!=v&&v.isFirstPartyPaidTemplate)&&(k=!0);const{duplicateRecordMap:q,originalToDuplicate:B,aiBlocksToAutoGenerate:h}=se({sourceBlockId:o,targetBlockPointer:n,recordMap:r,recordPointerMap:p,options:{deepCopyTransclusionContainers:c,resolveTemplateVariables:!!s&&{currentUserId:I,currentTimeZone:(0,ge().P)()}},baseUrl:i().A.domainBaseUrl,publicDomainName:i().A.publicDomainName,actor:I?{table:ye().oo,id:I}:void 0,getRecordRole:d.makeGetRecordRoleFn(I),preventLegacyTransclusions:u,createLegacyTransclusionCopyIndicator:_,installationImprint:f,logWarning:Ce,spaceIdCreator:m,isTemplateInstantiation:Boolean(g)}),C=new(a().B)(t,n,{inMemoryRecordCache:d});l.postPerformAssertions.push((function(){if(l.isLocal)return;if(!C.getParentStore())throw new(be().yI4)(`Initialized template was not given a parent before being committed in transaction ${l.getUserActionForAnalyticsPurposesOnly()}`)}));const w=y??(b?"append_only":void 0);for(const{model:i}of q)i&&we({transaction:l,model:i,rootStore:C,currentUserId:I,targetBlockPointer:n,targetRecordCache:d,isTemplateInstantiation:g,shouldExcludeBlocksFromLimit:k,sourceBlockUpdateStrategy:w});h.length>0&&l.postSubmitCallbacks.push((async()=>{await async function(e){const{environment:t,aiBlockPointers:o,parentPageId:i}=e,r=(0,fe().Dv)("generateAiBlockTask");for(const a of o)for await(const e of(0,ke().UT)(t,r,{blockId:a.id,spaceId:a.spaceId,parentPageId:i},{spaceIds:[]}));}({environment:t,aiBlockPointers:h,parentPageId:C.id})}));return{targetBlockStore:C,originalToDuplicate:B,subtreeSize:q.getSize()}}function Ce(e){"unmappedContentId"===e.type||("multiReferencedContentIds"===e.type?ve().log({level:"warning",from:"createBlockActions",type:"multiReferencedContentIds",data:{ids:e.contentIds}}):"skippedInvalidWorkflowTrigger"===e.type?ve().log({level:"warning",from:"createBlockActions",type:"skippedInvalidWorkflowTrigger",data:{triggerId:e.triggerId,duplicateSkipReason:e.reason}}):(0,l().HB)(e))}function we(e){const{transaction:t,model:o,rootStore:i,targetBlockPointer:d,currentUserId:c,targetRecordCache:s,isTemplateInstantiation:p,shouldExcludeBlocksFromLimit:u,sourceBlockUpdateStrategy:_}=e;if(o.table===g().ev)return void function(e){var t;const{transaction:o,model:i,rootStore:r,targetBlockPointer:d,currentUserId:c,targetRecordCache:s,isTemplateInstantiation:p,shouldExcludeBlocksFromLimit:u,sourceBlockUpdateStrategy:_}=e,f=i.__IM_SORRY__getValue(),v=a().B.createChildStore(r,i.pointer);i.id===d.id&&p&&f.is_template&&(f.is_template=!1,f.format&&delete f.format.automation_id);u&&Q(f)&&(f.ignore_block_count=!0);const g=i.pointer.table===d.table&&i.pointer.id===d.id?null===(t=s.getRecord({pointer:i.pointer,userId:c}))||void 0===t?void 0:t.value:void 0;g&&(delete f.created_by_id,delete f.created_by_table,delete f.created_time);if(g&&"append_only"===_&&i.id===r.id){const e=r.getContentIds()??[],t=i.getContentIds()??[];return void Be().applyOperation({store:v,operation:m().op.update({args:{content:[...e,...t]},pointer:i.pointer,path:[]}),transaction:o})}g&&"merge"===_&&i.id===r.id&&(f.properties=function(e){const{source:t,target:o}=e;return{...t,...o,title:(0,b().w9s)(null==o?void 0:o.title)?null==t?void 0:t.title:null==o?void 0:o.title}}({source:f.properties,target:g.properties}),f.format=function(e){const{source:t,target:o}=e;return{...t,...o,copied_from_pointer:null==t?void 0:t.copied_from_pointer}}({source:f.format,target:g.format}),f.file_ids=function(e){const{source:t,target:o}=e;return o&&o.length>0?o:t}({source:f.file_ids,target:g.file_ids}));const y=(null==g?void 0:g.format)??{},I=f.format??{},k=m().op.update({pointer:i.pointer,path:["format"],args:(0,l().uv)(y).reduce(((e,t)=>t in I&&void 0!==I[t]?e:{...e,[t]:null}),{})}),q=g?[k]:[],B=n().rF({block:f,existingBlock:g}).concat(q);for(const a of B)(0,Ie().ph)(a)?Be().applyCrdtTextOperation({store:v,operation:a,invertedOperation:void 0,transaction:o}):Be().applyOperation({store:v,operation:a,transaction:o})}({transaction:t,model:o,rootStore:i,targetBlockPointer:d,currentUserId:c,targetRecordCache:s,isTemplateInstantiation:p,shouldExcludeBlocksFromLimit:u,sourceBlockUpdateStrategy:_});if(p){var y;if(o.table===f().yB&&o.parent_id===d.id)return;if(o.table===v().SC&&o.isType("create_page")&&(null===(y=o.getConfig())||void 0===y?void 0:y.template_page_id)===d.id)return}const I=(0,r().v3)(i,o.pointer),k=o.__IM_SORRY__getValue();qe().KY({store:I,value:k,transaction:t})}},522328:(e,t,o)=>{o.d(t,{I:()=>v});o(898992),o(354520),o(581454),o(737550);var i=()=>o(534177),r=()=>o(496603),a=()=>o(239381),n=()=>o(792071),d=()=>o(277153),l=()=>o(199378),c=()=>o(179034),s=()=>o(519831),p=()=>o(192845);function u(e){const{duplicatedAction:t,mapper:o,options:u,originOptions:_,sourceSpaceId:m}=e,f=n().Bj6.fromAutomationAction(t),v=f.pointer;const g=e=>{const{visitPath:i,requested:r,requester:a}=e;return function(e,o){return Boolean("create_page"===t.type&&(null==u?void 0:u.isTemplateInstantiation)&&"config.template_page_id"===o&&e.table===c().ev&&u.sourceBlockIds.has(e.id))}(r,i)?r:o({requested:r,requester:a})};function b(e,t){const o=(0,a().y5)(e);if("action"===o.source){var r;const e=d().L3.fromSpaceShardRecordId({id:o.action_id,spaceId:f.space_id},l().SC),i=(null===(r=g({visitPath:t,requested:e,requester:v}))||void 0===r?void 0:r.id)??o.action_id;return(0,a().$y)({...o,action_id:i})}if("global"===o.source)return e;(0,i().HB)(o)}const y=f.pointer,{remappedRecordPointers:I,value:k}=(0,p().G)({automationActionModel:f,baseUrl:_.baseUrl,preventClearingConfig:!1,publicDomainName:_.publicDomainName,sourceSpaceId:m,visitors:{visitCollectionProperty:void 0,visitCollectionPropertyPointer:(e,o)=>{const i=g({visitPath:o,requested:e,requester:y});if(i){const o=i.spaceId??t.space_id;return o!==t.space_id||i.table!==s().Vl?{type:"replace",value:void 0}:{type:"replace",value:{...i,propertyId:e.propertyId,spaceId:o}}}return(e.spaceId??t.space_id)!==t.space_id?{type:"replace",value:void 0}:{type:"keep"}},visitFormulaContextValue:(e,t)=>({type:"replace",value:b(e,t)}),visitFormulaPageProperty:(e,o)=>{if("collection"in e&&e.collection){const i=g({visitPath:o,requested:e.collection,requester:v});if(i&&i.table===s().Vl){const o=i.spaceId??t.space_id;return o!==t.space_id?{type:"replace",value:void 0}:{type:"replace",value:{...e,collection:{...i,spaceId:o}}}}}else if("contextValueId"in e&&e.contextValueId)return{type:"replace",value:{...e,contextValueId:b(e.contextValueId)}};return{type:"keep"}},visitRecordPointer:(e,o)=>{const i=g({visitPath:o,requested:e,requester:y});if(i){const e=i.spaceId??t.space_id;return e!==t.space_id?{type:"replace",value:void 0}:{type:"replace",value:{...i,spaceId:e}}}return(e.spaceId??t.space_id)!==t.space_id?{type:"replace",value:void 0}:{type:"keep"}}}}),q=k.getConfig();if(t.config=q,!(0,r().Im)(q))return I}var _=()=>o(537012),m=()=>o(273900),f=()=>o(813690);function v(e){const{originalRecord:t,duplicateRecord:o,mapper:r,getRecordRole:a,options:n,originOptions:s,duplicateBlocks:p=!0}=e,v=t.space_id!==o.space_id,g={table:l().SC,id:t.id,spaceId:t.space_id},b=r({requested:d().L3.fromPointerLike({table:o.parent_table,id:o.parent_id,spaceId:o.space_id}),requester:g}),y=u({duplicatedAction:o,mapper:r,options:n.resolveAutomationConfig,originOptions:s,sourceSpaceId:t.space_id});let I=a;y&&(I=f().Oj.tryUntilFound(...Array.from(y).map((e=>f().Oj.constantForPointer(e,"editor"))),I));const k=(null==b?void 0:b.id)??o.parent_id;if(o.parent_id=k,v&&"http_request"===o.type&&o.config){o.config.url=void 0;for(const e of o.config.customHeaders??[])e.value=""}const q=(0,_().Mn)(o);if(q){q.some((e=>{const t=I(e.pointer);return!t||!(0,m().q_)(t,e.minimumRequiredRole)}))&&(o.config={})}const B=(o.blocks??[]).map((e=>{var t;return null===(t=r({requested:d().L3.fromPointerLike({table:c().ev,id:e,spaceId:o.space_id}),requester:g}))||void 0===t?void 0:t.id})).filter(i().O9);o.blocks=B.length>0?B:void 0,p||(o.blocks=void 0)}}}]);