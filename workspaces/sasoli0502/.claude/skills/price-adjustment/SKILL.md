---
name: price-adjustment
description: 買取価格調整。最新の買取価格・販売価格CSVから買取価格最適化Excelを生成し、Google Sheetsにインポートして価格調整を行う。
---

# 買取価格調整

買取価格の最適化ファイルを生成し、Google Sheetsで価格調整を行うスキル。

## 概要

- **目的**: 最新の買取価格・販売価格データから最適化Excelを生成し、粗利を確認しながら新しい買取価格を設定
- **出力**: 買取価格最適化_YYYYMMDD.xlsx → Google Sheetsにインポート
- **作業ディレクトリ**: `iphone-market-research/`

## 前提条件

- 最新の買取価格CSV: `price-data/買取価格YYYYMMDD.csv`
- 最新の販売価格CSV: `price-data/販売価格YYYYMMDD.csv`
- これらのCSVが存在しない場合は、先にデータ収集を行うこと

## 手順

### Step 1: 最適化Excelを生成

```bash
cd iphone-market-research
uv run python generate_optimizer.py
```

**スクリプトの処理内容:**
1. 最新の買取価格・販売価格CSVを自動検出
2. データ正規化・フィルタリング（除外機種: iPhone 7/8/8 Plus、除外等級: 新品・未開封/外装ジャンク）
3. 買取価格と販売価格を紐付け（ランク→グレードマッピング）
4. BM平均売価シートから背景色を取得し販売価格列に反映
5. 条件付き書式（G/H列: 1万未満は赤文字）
6. I/J列にデフォルト数式（=D-5000, =E-5000）を設定
7. Excelファイル保存、古いファイルをアーカイブ

**出力ファイル**: `買取価格最適化_YYYYMMDD.xlsx`

### Step 2: Google Sheetsにインポート

1. Google Sheetsを新規作成 or 既存シートを開く
2. `ファイル` → `インポート` → `アップロード`
3. 生成された `買取価格最適化_YYYYMMDD.xlsx` をアップロード
4. `新しいスプレッドシートを作成` → `今すぐ開く`

### Step 3: 価格調整

Google Sheets上で以下を確認・調整:

| 列 | 内容 | 備考 |
|----|------|------|
| A | 機種 | |
| B | 容量 | |
| C | ランク | 新品同様/美品/使用感あり/目立つ傷あり |
| D | 高額買取（現在） | |
| E | 特急買取（現在） | |
| F | 販売価格 | BM平均売価の色付き（黄/緑/無色） |
| G | 手引粗(高額) | 1万未満は赤文字 |
| H | 手引粗(特急) | 1万未満は赤文字 |
| I | 新高額買取 | デフォルト=D-5000、手動調整可 |
| J | 新特急買取 | デフォルト=E-5000、手動調整可 |
| K | 新手引粗(高額) | =F*0.89-I（自動計算） |
| L | 新手引粗(特急) | =F*0.89-J（自動計算） |

**調整のポイント:**
- G/H列の赤文字（粗利1万未満）は価格引き下げを検討
- I/J列を手動で調整し、K/L列の新粗利を確認
- F列の背景色はBM平均売価シートのグレード別色を反映

### Step 4: 価格変更の反映

価格調整が完了したら、AppleBuyersの管理画面で新価格を反映する。
（この手順は別途スキル化予定）

## ファイル構成

```
iphone-market-research/
├── generate_optimizer.py        # メインスクリプト
├── price-data/
│   ├── 買取価格YYYYMMDD.csv     # 買取価格データ
│   └── 販売価格YYYYMMDD.csv     # 販売価格データ
├── bm_avg_price_temp.xlsx       # BM色データキャッシュ
├── 買取価格最適化_YYYYMMDD.xlsx # 出力ファイル
└── archive/                     # 過去のファイル
```

## 技術詳細

### ランク→グレードマッピング

| ランク（買取） | グレード（販売） | 販売価格の計算 |
|----------------|------------------|----------------|
| 新品同様 | A | Aの平均売価 |
| 美品 | A, B | (A + B) / 2 |
| 使用感あり | B, C | (B + C) / 2 |
| 目立つ傷あり | C | Cの平均売価 |

### 粗利計算

```
手数料引き販売価格 = 販売価格 * 0.89
手引粗 = 手数料引き販売価格 - 買取価格
```

### BM背景色

BM平均売価(新)シートのセル背景色を販売価格列に反映:
- 黄色(#FFFF00): 在庫充足
- 緑色(#00FF00): 在庫不足
- 無色: データなし

色はモデル・容量・グレードの組み合わせで決定される。
