---
name: cashflow-update
description: 資金繰り表の更新。スマレジ・GMOあおぞら・UFJから残高を取得し、スプレッドシートに入力する。
---

# 資金繰り表の更新

## 認証情報

認証情報は `.claude/auth/credentials.md` を参照。

---

## 残高取得ワークフロー

### 1. スマレジ（実現金残高）

**取得場所**: 日次処理 → 日次締め状況 → アップルエイド秋葉原店

**手順**:
1. https://accounts.smaregi.jp/login?client_id=pos にアクセス
2. ログイン（info@uprose.co.jp / 4669uprose）
3. 左メニュー「日次処理」→「日次締め状況」
4. 締め日を選択（カレンダーから日付選択）→「検索」
5. 「アップルエイド秋葉原店」をクリック（処理済みであること確認）
6. 「現金管理」セクションの「**実現金残高**」を取得

**注意**: 前日の締め処理が完了していないとデータが取れない

---

### 2. GMOあおぞらネット銀行（残高）

**取得場所**: 法人口座 → 残高照会

**手順**:
1. https://sso.gmo-aozora.com/corp/b2c/login にアクセス
2. 法人口座ログイン（4096062799 / 4669uprose）
3. メニュー「残高・明細・振込状況」→「残高照会」
4. 「日付指定」を選択 → カレンダーから日付選択 →「検索」
5. **口座残高**を取得（円普通預金の金額）

**口座情報**: 法人営業部(101) / 口座番号: 2294929 / 株式会社ｅｃｏｔ

---

### 3. 三菱UFJ銀行（残高）

**取得場所**: Slack DM（野口器 自分宛て）の画像

**手順**:
1. Slack（japanconsulting.slack.com）にログイン
2. DM「野口器（自分）」を開く
3. 該当日付の画像（UFJ銀行のスクリーンショット）を確認
4. **照会期間最終残高**を取得

**注意**: 画像から手動で数値を読み取る必要がある

---

## スプレッドシート入力

**URL**: https://docs.google.com/spreadsheets/d/1Gg4Lvvlx25GGk-LdEnr8apUO2Q4e2ZOYovaAlBfV7os/edit?gid=419643659

**シート**: 資金繰り表

**表示は千円単位**（実際の金額を入力→千円単位で表示される）

### 対象日

**🔴 重要: 資金繰り表の更新対象は常に「前日」の行**
- 「資金繰り表を更新して」と言われたら、**昨日の日付の行**を更新する
- 例: 今日が2026/01/29なら、対象は2026/01/28（行1126）

### 入力手順

#### ステップ1: ゼロリセット
1. スプレッドシートを開く
2. 「資金繰り表」シートタブをクリック
3. 前日の行のB列〜AG列を確認
4. **数字が入っているセルはすべて `0` に変更**（空白のセルは空白のまま）
5. AH列（計算残高）は数式なので触らない

#### ステップ2: 明細確認・入力
1. 各金融機関・レジの明細を確認（スマレジ入出金、スマレジ取引履歴、GMO入出金、UFJ入出金）
2. 明細の各項目を「入力パターン」に従って対応する列に入力

#### ステップ3: 残高入力
1. 名前ボックスに `AI{行番号}` を入力してEnter
2. AI列（実残高）に**実際の合計金額（円単位）**を入力
   - 例: 1,946,699円 → `1946699` と入力 → 表示は `1,947`

### 日付と行番号の対応

| 日付 | 行番号 |
|------|--------|
| 2026-01-01 | 1099 |
| 2026-01-24 | 1122 |
| 2026-01-25 | 1123 |

**計算式**: 行番号 = 1099 + (日付 - 1月1日)

### 残高列の計算ロジック

- **AH列（計算残高）**: `=AH{前日行}+sum(B{行}:L{行})-sum(M{行}:AG{行})`
  - 前日の計算残高 + 収入合計 - 支出合計
- **AI列（実残高）**: 手入力（スマレジ + GMO + UFJ の合計）

### 差額確認

- **AH - AI の差額が 1,000〜2,000円以内なら正常**
- 差額が大きい場合は入力漏れや記載ミスを確認

---

## 列構成

### 収入列（B:L）

| 列 | 項目名 |
|----|--------|
| B | ムスビー売上 |
| C | バクマ売上 |
| D | アマゾン売上 |
| E | 直売 |
| F | 修理 |
| G | 店売 |
| H | 他 |
| I | stores |
| J | 秤量堂家賃 |
| K | 秤量堂補填金 |
| L | 借入 |

### 経費列（M:AG）

| 列 | 項目名 | 備考 |
|----|--------|------|
| M | 店頭買取 | |
| N | ホンダ | |
| O | 直接買取 | GMO買取振込を入力 |
| P | 法人買取 | |
| Q | クレカ買取 | |
| R | パーツ | |
| S | 徐店修 | |
| T | 徐店売 | |
| U | 送料 | |
| V | 広告 | |
| W | 広告費-修理 | |
| X | 他経費 | |
| Y | 支払手数料 | GMO振込手数料を入力 |
| Z | 家賃 | |
| AA | 人件費 | |
| AB | 税理 | |
| AC | 貸付 | |
| AD | クレカ | |
| AE | 融資 | |
| AF | 役員 | |
| AG | 税金 | |

### 残高列

| 列 | 項目名 | 説明 |
|----|--------|------|
| AH | 計算残高 | 自動計算（前日実残高 + 収入 - 支出） |
| AI | 実残高 | 手入力: 銀行残高の実際の値 |

---

## 入力パターン

### スマレジ入出金データ（入出金履歴）

| メモパターン | 入力先列 | 金額 |
|-------------|---------|------|
| 普通預金(業者名) | E列（直売） | 出金額 |
| 業者名のみ | E列（直売） | 出金額 |
| 日付+普通預金(業者名) | E列（直売） | 出金額 |
| 普通預金(修理売上) | F列（修理） | 出金額 |
| 数字のみ（取引ID） | M列（店頭買取） | 出金額 |
| 〇〇税、住民税等 | AG列（税金） | 出金額 |
| その他経費 | X列（他経費） | 出金額 |
| 入金+普通預金(業者名) | **入力しない** | - |
| 入金+普通預金（業者名なし） | **入力しない** | - |

**業者名の例**: モバステ、一丁目、買取Wiki、グエンさん、徐さん等

### スマレジ取引履歴一覧（店頭販売）

**取得場所**: 販売 → 取引履歴一覧

**確認手順**:
1. 左メニュー「販売」→「取引履歴一覧」
2. 日付範囲を指定して検索
3. 「通常」タイプの取引（店頭での現金販売）を確認
4. 各取引の詳細を開いて支払い方法を確認

| 支払い方法 | 入力先列 | 備考 |
|-----------|---------|------|
| 現金払い | G列（店売）またはF列（修理） | 現金がレジに入る |
| ストアーズ/コイニー（クレカ払い） | **入力しない** | 現金がレジに入らない |

**🔴 取引種別による列の分類（現金払いのみ）**

| 取引名パターン | 入力先列 | 例 |
|---------------|---------|-----|
| 端末販売 | G列（店売）| 端末販売 1,000円、5,000円 |
| 修理系売上 | F列（修理）| iPad 6バッテリー、一体型パネル交換 |

**修理系キーワード**: バッテリー、パネル、画面交換、修理、液晶、ガラス割れ等

**重要**:
- クレジットカード払い（ストアーズ/コイニー経由）の店頭販売は、現金がレジに直接入らないためG列・F列には入力しない
- 取引詳細の「支払い」欄で支払い方法を必ず確認すること
- 予測値（システムが自動入力した値）と実際の現金取引を区別すること

**🔴 スマレジ端末販売とスマレジ出金の関係（二重計上防止）**
- スマレジ取引履歴の「端末販売」とスマレジ入出金の「普通預金(業者名)」が同じ金額でペアになっている場合がある
- 例: 取引53699（端末販売 ¥570,000）+ 出金メモ「普通預金(モバステ・買取一丁目)」¥570,000
- これは「業者が来店→現金で端末購入→その現金をすぐ銀行口座へ入金」という流れ
- **E列（直売）にのみ入力**（スマレジ出金の業者名パターンで判定）
- G列（店売）には入力しない（二重計上になるため）

### GMO入出金データ

| 取引種別 | 入力先列 |
|---------|---------|
| 買取振込（個人への振込） | O列（直接買取） |
| 振込手数料 | Y列（支払手数料） |
| カ）エコット | **入力しない**（内部資金移動） |
| **野口沙羅・野口凛・本間久貴・江口夏への振込** | **AC列（貸付）** |

**🔴 重要: 貸付返済の判別ルール**
野口沙羅、野口凛、本間久貴、江口夏への振込は「会社への貸付金の返済」として扱う。
これらの名前が振込先に含まれる場合は、必ず**AC列（貸付）**に入力すること。
O列（直接買取）には入力しない。

### UFJ入出金データ

**入金パターン**:

| 取引種別 | 入力先列 |
|---------|---------|
| ムスビー | B列（ムスビー売上） |
| BACK MARKET JAP | C列（バクマ売上） |
| ストアーズ（カ）ケツサイ | I列（stores） |
| シヤ）ニホンチユウシヨウキギ | L列（借入） |
| カ）ゴールデンブル | H列（他） |
| エフワイエル（カ | E列（直売） |
| フジワラショウジ（カ | E列（直売） |
| ノグチ サラ | L列（借入） |
| 預金機 | **要確認**（下記ルール参照） |
| カ）エコット | **入力しない**（内部資金移動） |

**🔴 預金機の二重計上防止ルール**:
- UFJの「預金機」入金は、スマレジ出金（普通預金(業者名)）で現金を銀行に入金した記録
- スマレジ出金と同じ金額の「預金機」がUFJに表示される場合、**UFJ側は入力しない**（スマレジ出金側でE列に入力済み）
- 例: スマレジ出金「普通預金(モバステ)」¥570,000 → E列に入力 / UFJ「預金機」¥570,000 → 入力しない

**出金パターン**:

| 取引種別 | 入力先列 |
|---------|---------|
| フリコミ テスウリヨウ / 為替手数料 | Y列（支払手数料） |
| 口座振替 アメリカンエキスプレス | AD列（クレカ） |
| 口座振替 SMBC（浅草） | AE列（融資） |
| 金融公庫 | AE列（融資） |
| ZHゼイリシホウシュウ（口座振替） | AB列（税理） |
| 支払機 | **入力しない**（内部移動） |
| カ）エコット | **入力しない**（内部資金移動） |

---

## 入力ルール

### 🔴 入力前チェック（必須）

**手順:**
1. 名前ボックスに `B{行}:AI{行}` を入力してEnter（例: `B1123:AI1123`）
2. 左側（B〜Y列）と右側（Z〜AI列）をスクリーンショットで確認
3. 値が入っているセルを全てリストアップ
4. **B〜AG列の数字セルをすべて `0` にリセット**（空白はそのまま）
5. リセット後、明細を確認して正しい値を入力

**確認時の質問例:**
- 「AC列に300千円が既存入力されていますが、これは何の取引ですか？」
- 「G列に48千円が入っていますが、これは店頭現金売上ですか？」

**チェック結果の報告フォーマット:**
```
## 行{番号}（{日付}）既存値チェック結果

| 列 | 項目 | 値（千円）| 実際の金額 |
|---|---|---|---|
| G | 店売 | 48 | 48,000円 |
| AC | 貸付 | 300 | 300,000円 |
...

空欄の列: C, D, E, ...
```

---

### その他のルール

1. **複数取引がある場合**: 合計だけでなく計算過程を記載
   - 例: `816000+492000+50000`
2. **コメントルール**: 列名だけでは内容が自明でない場合にコメントを残す
   - **コメント不要**: 直接買取（O列）、支払手数料（Y列）、税理（AB列）など、列名で取引内容が明確なもの
   - **コメント推奨**: 複数取引を合算した場合の内訳、E列（直売）の業者名が判別できる場合 など
3. **AH-AI差額**: 1,000〜2,000円以内なら正常

---

## 実行例

### 例1: 2026/01/28分

```
実行日: 2026/01/29
対象日: 2026/01/28（前日）→ 行1126

取得結果:
- スマレジ実現金残高: ￥78,328
- GMOあおぞら残高: ￥2,827,431
- 三菱UFJ残高: ￥3,708,912

合計実残高: ￥6,614,671
スプレッドシート入力値: 6614671（実際の金額）
表示: 6,615（千円単位）

入力した明細:
- E列（直売）: 1437000（570,000+867,000 ← スマレジ出金・業者販売）
- O列（直接買取）: 438400（GMO買取振込合計）
- Y列（支払手数料）: 1935（GMO振込手数料合計）
- AB列（税理）: 104500（UFJ口座振替 ZHゼイリシホウシュウ）

差額確認:
- AH列（計算残高）: 6,616千円
- AI列（実残高）: 6,615千円
- 差額: 約1,000円 → 正常
```

### 例2: 2026/01/24分

```
実行日: 2026/01/25
対象日: 2026/01/24（前日）

取得結果:
- スマレジ実現金残高: ￥21,728
- GMOあおぞら残高: ￥25,501
- 三菱UFJ残高: ￥1,899,470

合計実残高: ￥1,946,699
スプレッドシート入力値: 1946699（実際の金額）
表示: 1,947（千円単位）
```
