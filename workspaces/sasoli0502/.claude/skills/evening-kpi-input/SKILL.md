---
name: evening-kpi-input
description: 夜の金額KPI入力。NotionとSlackからデータを取得し、Googleスプレッドシートに入力する。
---

# 夜の金額KPI入力

夜に行う金額KPIの入力作業を自動化するスキル。

## 概要

- **目的**: 当日のKPIデータを各ソースから取得し、Googleスプレッドシートの金額KPIシートに入力
- **入力先**: AG列、AW列、AY列、BY列、CB列、CV列
- **データソース**: Notion API（作業管理DB）、Slack（#robocoチャンネル）

## 入力データまとめ

| 項目 | 列 | データソース | 取得方法 |
|------|-----|--------------|----------|
| 集荷依頼数 | AE | 手動入力 | 担当者が直接入力（本スキル対象外） |
| キット数 | AG | Slack #roboco | 「ネコポス送状作成情報」の「作成済」行数を合計 |
| 到着数 | AW | Notion API | 「査定商品開封」タスクの件数プロパティを合計 |
| 査定数 | AY | Notion API | 「査定」タスクの件数プロパティを合計 |
| 修理数 | BY | Notion API | 「修理(販売商品)」タスクの件数プロパティを合計 |
| 出品数（BM） | CB | Notion API | 「出品(バックマーケット)」タスクの件数プロパティを合計 |
| 出品数（ムスビ） | CV | Notion API | 「出品(ムスビー)」タスクの件数プロパティを合計 |

## 自動化スクリプト

### Notionデータ取得

**スクリプト**: `scripts/test-notion-fetch.js`

```bash
# 当日のデータを取得
node scripts/test-notion-fetch.js 2026-01-24

# デバッグモード（全タスク名を表示）
node scripts/test-notion-fetch.js 2026-01-24 --debug
```

**出力例**:
```
AW列 (到着数): 3件
  - 査定商品開封 [佐々木悠斗]: 3件

AY列 (査定数): 0件
BY列 (修理数): 0件
CB列 (出品数(BM)): 0件
CV列 (出品数(ムスビ)): 0件
```

**Notion API設定**:
- Token: 設定済み（スクリプト内にハードコード）
- Database ID: `16983ea4-7788-80b0-b834-c5d077724297`

**タスク名マッピング**:
| KPI項目 | Notionタスク名（完全一致） |
|---------|---------------------------|
| 到着数 | `査定商品開封` |
| 査定数 | `査定` |
| 修理数 | `修理(販売商品)` |
| 出品数(BM) | `出品(バックマーケット)` |
| 出品数(ムスビ) | `出品(ムスビー)` |

**重要**: 各タスクの「件数」プロパティ（numberタイプ）の値を合計する。タスクの個数ではない。

---

## 手動手順（フォールバック用）

### Step 1: Googleスプレッドシートを開く

```
URL: https://docs.google.com/spreadsheets/d/1Gg4Lvvlx25GGk-LdEnr8apUO2Q4e2ZOYovaAlBfV7os/edit?pli=1&gid=888185656#gid=888185656
シート: 金額KPI
```

### Step 2: 当日の日付の行番号を確認

1. `Ctrl+F` で検索ダイアログを開く
2. 日付を検索（例: `1/24`）
3. 検索結果を確認し、対象年の日付を見つける
   - 形式: `26/01/24`（2026年1月24日）
   - 複数ヒットする場合は「次へ」で正しい年を探す
4. A列のセル番号を確認（例: A1154 → 行番号は1154）

---

## Slackからキット数を取得（AG列）

### Step 3: Slackで検索

```
URL: https://app.slack.com/client/T5CF8BCDP/C04LSUMKDCK
チャンネル: #roboco
検索クエリ: in:#roboco ネコポス
```

### Step 4: 当日の投稿を確認

検索結果から当日の投稿を探し、各時間帯の件数をカウント:
- **10時過ぎの投稿**: 「作成済」の行数をカウント
- **13時過ぎの投稿**: 「作成済」の行数をカウント
- **16時過ぎの投稿**: 「作成済」の行数をカウント

**投稿形式**:
```
@here ネコポス送状作成情報
338720 井上晃 作成済
338702 依知川優生 作成済
338699 石山舞桜 作成済
...
```

**キット数 = 全時間帯の「作成済」行数の合計**

### Step 5: AG列にキット数を入力

1. スプレッドシートの名前ボックスに `AG` + 行番号（例: `AG1154`）を入力してEnter
2. キット数の合計を入力してEnter

---

## Notionデータの入力（AW, AY, BY, CB, CV列）

### Step 6: スクリプトでデータ取得

```bash
node scripts/test-notion-fetch.js 2026-01-24
```

### Step 7: 各列にデータを入力

スクリプト出力を確認し、以下のセルに入力:

| 列 | セル例 | 入力値 |
|----|--------|--------|
| AW | AW1154 | 到着数 |
| AY | AY1154 | 査定数 |
| BY | BY1154 | 修理数 |
| CB | CB1154 | 出品数(BM) |
| CV | CV1154 | 出品数(ムスビ) |

---

## 完了確認

- 「ドライブに保存しました」のメッセージを確認
- 入力した行の全データが正しいか目視確認

## 関連リンク

- [財務管理表スプレッドシート](https://docs.google.com/spreadsheets/d/1Gg4Lvvlx25GGk-LdEnr8apUO2Q4e2ZOYovaAlBfV7os/)
- [Notion 作業管理DB](https://www.notion.so/japanconsulting/16983ea47788800faaa3f9631dcd7e90)
- [Slack #roboco](https://app.slack.com/client/T5CF8BCDP/C04LSUMKDCK)

## 手動入力項目

- **集荷依頼数（AE列）**: 担当者が手動で入力する項目のため、本スキルの対象外

---

## 実装状況

| 機能 | 状態 | 備考 |
|------|------|------|
| Notion API取得 | 完了 | 件数プロパティの合計を取得 |
| Slackキット数取得 | 確認済み | 検索→作成済カウント |
| スプレッドシート入力 | 未実装 | Playwright使用予定 |

**最終更新**: 2026-01-24
