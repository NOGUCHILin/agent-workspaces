# Kintone買取実績データ抽出ガイド

**作成日**: 2025-11-17 Monday
**対象アプリ**: 買取管理アプリ（Kintone）
**目的**: 競合比較分析用の弊社買取実績データの抽出

---

## 📋 抽出するデータの条件

### 対象期間
- **買取日**: 2025-08-17 Sunday 〜 2025-11-17 Monday（直近3ヶ月）

### 対象機種
- **機種名**: iPhone を含むレコードのみ

### 対象ステータス
以下のすべてのステータスを含める：
- 宅配買取成約
- 店頭買取成約
- 買取成約
- 販売完了
- 出品完了

※これらのステータスは全て買取価格データを持つため、すべて抽出対象となります。

---

## 🎯 Kintoneリスト設定の手順

### ステップ1: リスト表示の準備

1. Kintoneの買取管理アプリを開く
2. 画面右上の「⚙（設定）」→「一覧の設定」をクリック
3. 「一覧を追加する」をクリック
4. 一覧名を入力: **「iPhone買取実績_3ヶ月（競合分析用）」**

---

### ステップ2: フィールドの選択

以下の7つのフィールドを選択してください：

| # | フィールド名 | 必須 | 備考 |
|---|------------|------|------|
| 1 | レコード番号 | ✅ | 一意識別子 |
| 2 | 買取日 | ✅ | 期間絞り込みに使用 |
| 3 | 機種名 | ✅ | iPhone判定に使用 |
| 4 | 容量 | ✅ | 64GB, 128GB等 |
| 5 | 状態・ランク | ✅ | A, B, C等の買取ランク |
| 6 | 買取価格 | ✅ | 実際の買取価格 |
| 7 | 進捗ステータス | ✅ | 確認用 |

**注意事項**:
- **カラー・色フィールド**: 選択不要（Python側で最高価格を抽出するため）
- **キャリアフィールド**: 選択不要（SIMフリー以外はPython側で除外）
- 上記以外のフィールド（顧客名、住所等）: 選択不要

---

### ステップ3: 絞り込み条件の設定

#### 3-1. 買取日の絞り込み

```
買取日 が 2025-08-17 以降
かつ
買取日 が 2025-11-17 以前
```

#### 3-2. 機種名の絞り込み

```
機種名 に iPhone を含む
```

#### 3-3. 進捗ステータスの絞り込み

```
進捗ステータス が 宅配買取成約
または
進捗ステータス が 店頭買取成約
または
進捗ステータス が 買取成約
または
進捗ステータス が 販売完了
または
進捗ステータス が 出品完了
```

#### 3-4. 不具合なしデータの絞り込み（重要）

**目的**: 競合サイトとの公平な比較のため、不具合がないデータのみを抽出します。

以下の**22項目すべて**を「チェックなし」に設定してください：

**【不具合など】（15項目）**
```
表示やタッチ操作の劣化 が チェックなし
AND バッテリーの劣化 が チェックなし
AND TouchIDやFaceIDの故障 が チェックなし
AND アウトカメラの故障 が チェックなし
AND バイブレーション不具合 が チェックなし
AND サイドボタンの故障 が チェックなし
AND 端末上部の不具合 が チェックなし
AND 端末下部の不具合 が チェックなし
AND Wi-FiやBluetoothの不具合 が チェックなし
AND フラッシュの故障 が チェックなし
AND 正常に起動しない が チェックなし
AND 初期化できない が チェックなし
AND ネットワーク利用制限 が チェックなし
AND 水没歴あり が チェックなし
AND その他 が チェックなし
```

**【修理】（7項目）**
```
AND 画面修理 が チェックなし
AND ドック修理 が チェックなし
AND インカメラ修理 が チェックなし
AND アウトカメラ修理 が チェックなし
AND タプティックエンジン修理 が チェックなし
AND バッテリー交換 が チェックなし
AND アウトカメラガラス交換 が チェックなし
```

**設定のポイント**:
- 22項目すべてを設定する必要があります（1つでも漏れると不具合ありデータが混入）
- Kintoneの絞り込み条件画面で、各項目を「チェックなし」または「未選択」に設定
- 設定後、データ件数が大幅に減少します（約23,000件程度になる見込み）

**設定画面での入力例**:
```
買取日 >= 2025-08-17
AND 買取日 <= 2025-11-17
AND 機種名 LIKE "%iPhone%"
AND (
    進捗ステータス = "宅配買取成約"
    OR 進捗ステータス = "店頭買取成約"
    OR 進捗ステータス = "買取成約"
    OR 進捗ステータス = "販売完了"
    OR 進捗ステータス = "出品完了"
)
AND 表示やタッチ操作の劣化 = チェックなし
AND バッテリーの劣化 = チェックなし
AND TouchIDやFaceIDの故障 = チェックなし
（... 残り19項目も同様 ...）
```

---

### ステップ4: 並び替え設定

推奨設定:
```
買取日 降順（新しい順）
```

---

### ステップ5: リスト設定の保存

1. 設定内容を確認
2. 「保存」をクリック
3. リスト名「iPhone買取実績_3ヶ月（競合分析用）」が一覧に表示されることを確認

---

## 💾 CSVエクスポートの手順

### ステップ1: 作成したリストを表示

1. 一覧選択で「iPhone買取実績_3ヶ月（競合分析用）」を選択
2. データが正しく表示されることを確認

### ステップ2: CSVエクスポート

1. 画面右上の「…（その他）」→「ファイルへ書き出す」をクリック
2. 形式: **CSV**
3. 文字コード: **UTF-8（BOM付き）** ← Excelで開く場合に文字化け防止
4. 「書き出す」をクリック

### ステップ3: ファイルの保存

1. ダウンロードされたCSVファイルを確認
2. ファイル名を変更: **`kintone_buyback_data_YYYYMMDD.csv`**
   - 例: `kintone_buyback_data_20251117.csv`
3. 以下のディレクトリに保存:
   ```
   /Users/noguchisara/projects/work/iphone-market-research/buyback-market/data/raw/internal/
   ```

---

## ✅ データ品質チェック

エクスポート後、以下を確認してください：

### 必須チェック項目

- [ ] レコード件数が表示される（0件でないこと）
- [ ] 7つのフィールドがすべて含まれている
- [ ] 買取日が 2025-08-17 〜 2025-11-17 の範囲内
- [ ] 機種名に iPhone が含まれている
- [ ] 買取価格が数値で入っている（空白なし）
- [ ] 文字化けしていない

### 想定されるデータ件数

- **不具合なしデータ**: 約23,000件（全体の約88%）
- **期待される件数**: 数千件〜1万件程度
- **少なすぎる場合**: 不具合フィルタリングの設定を再確認

---

## 🔧 次のステップ（データ取得後）

CSVファイルを保存したら、以下のコマンドで弊社データを処理します：

```bash
cd /Users/noguchisara/projects/work/iphone-market-research/buyback-market

# 弊社データの処理・正規化
uv run python scripts/process_internal_data.py data/raw/internal/kintone_buyback_data_20251117.csv

# 処理されたデータの確認
ls -lh data/processed/
```

出力ファイル:
- `data/processed/normalized_internal_data.csv` - 正規化された弊社データ

その後、3社比較分析を実行：

```bash
# 弊社 vs じゃんぱら vs イオシスの3社比較
uv run python scripts/analyze_three_way.py
```

---

## 📝 トラブルシューティング

### Q1: データ件数が0件になる

**原因**:
- 絞り込み条件が厳しすぎる
- 日付フィールド名が異なる
- 機種名の表記が異なる（例: "iPhone" ではなく "アイフォン"）

**対処**:
1. 絞り込み条件を一つずつ外して確認
2. フィールド名を再確認
3. 機種名の表記を確認（"iPhone", "iphone", "アイフォン"等）

### Q2: CSVが文字化けする

**原因**: 文字コードが UTF-8 (BOM付き) になっていない

**対処**:
1. エクスポート時に「UTF-8（BOM付き）」を選択
2. それでも解決しない場合は「Shift-JIS」を試す

### Q3: 買取価格が空白のレコードがある

**原因**: ステータスによっては買取価格が未入力の可能性

**対処**:
- Python側で空白データを除外するため、そのままエクスポートしてOK
- `process_internal_data.py` が自動で処理します

### Q4: SIMフリー以外のデータが含まれている

**原因**: キャリア版（docomo, au, SoftBank等）のデータが混在

**対処**:
- Python側で自動除外するため、そのままエクスポートしてOK
- `process_internal_data.py` が機種名から判定して除外します

---

## 📞 サポート

不明点があれば、以下のファイルを参照してください：

- プロジェクト全体: [README.md](../README.md)
- 最新の引き継ぎ: [work/handover/personal/2025-11-17_session5_data-cleanup-and-kintone-prep.md](/Users/noguchisara/projects/work/handover/personal/2025-11-17_session5_data-cleanup-and-kintone-prep.md)

---

**最終更新**: 2025-11-17 Monday
**作成者**: Claude Code
