# iPhone市場調査・買取価格最適化

iPhone X（2017年）以降のモデルについて、買取市場と販売市場の価格相場を調査・分析し、最適な買取価格戦略を策定するプロジェクト。

---

## 🎯 現在の状況

### ✅ **ハイブリッド戦略の実装完了**（2025-11-19）

買取価格の2段階提示システムを実装し、**高粗利**と**成約率**を両立する戦略を確立しました。

**詳細**: [ハイブリッド戦略_運用マニュアル.md](ハイブリッド戦略_運用マニュアル.md)

---

## 🚀 クイックスタート

### 週次更新（毎週月曜日）

最新の買取価格・販売価格CSVを準備して、以下を実行:

```bash
cd /Users/noguchisara/projects/work/iphone-market-research
uv run python generate_optimizer_hybrid.py
```

生成されるファイル:
- `買取価格最適化_hybrid_YYYYMMDD.xlsx`

**使い方**: [ハイブリッド戦略_運用マニュアル.md](ハイブリッド戦略_運用マニュアル.md) を参照

---

## 📂 プロジェクト構成

### 買取価格最適化（メイン機能）

**スクリプト**:
- [generate_optimizer_hybrid.py](generate_optimizer_hybrid.py) - ハイブリッド戦略版（推奨）
- [generate_optimizer.py](generate_optimizer.py) - シンプル版（旧版）

**ドキュメント**:
- [ハイブリッド戦略_運用マニュアル.md](ハイブリッド戦略_運用マニュアル.md) - 運用方法の詳細
- [買取価格差額ルール.md](買取価格差額ルール.md) - 高額買取価格と特急買取価格の差額規則
- [販売価格マッピングルール.md](販売価格マッピングルール.md) - 買取ランクと販売グレードのマッピング

**出力ファイル**:
- `買取価格最適化_hybrid_YYYYMMDD.xlsx` - ハイブリッド戦略版
- `買取価格最適化_YYYYMMDD.xlsx` - シンプル版

**戦略の特徴**:
- **人気機種**（iPhone 15/16シリーズ）: 低い買取価格から提示して段階的にUP → 高粗利狙い
- **通常機種**（iPhone 14以前）: 高い買取価格から提示して交渉なし → 成約率重視
- 交渉段階: 初回 → -3% → -6% → 最終（最大2回交渉）
- 3段階の色分け: 🟢緑（優秀）/ 🟡黄（許容）/ 🔴赤（要改善）

---

### [resale-market/](resale-market/)
**中古販売市場の相場調査**

主要ECサイト（楽天市場、Yahoo!ショッピング等）でのiPhone中古販売価格を調査。

**目的**:
- 販売価格の決定
- 市場トレンド分析

**調査対象**:
- 楽天市場（API利用可能）
- Yahoo!ショッピング（API利用可能だが現在403エラー）
- メルカリ、バックマーケット、イオシス、ムスビー等（手動調査）

**状態**: 🟡 中途とん挫（楽天APIは動作確認済み、データ収集未完）

---

### [buyback-market/](buyback-market/)
**買取市場の相場調査**

主要買取業者でのiPhone買取価格を調査。

**目的**:
- 買取価格の決定
- 競合分析

**調査対象**: （未定義）

**状態**: 📝 未着手

---

## 📊 対象モデル

**iPhone X（2017年）～ iPhone 16（2024年）**

全86モデル×容量の組み合わせを調査対象としています。

---

## 📁 ファイル構造

```
work/iphone-market-research/
├── README.md                                # このファイル
├── generate_optimizer_hybrid.py             # ハイブリッド戦略版（推奨）
├── generate_optimizer.py                    # シンプル版（旧版）
├── ハイブリッド戦略_運用マニュアル.md         # 運用マニュアル
│
├── 買取価格YYYYMMDD.csv                     # 元データ（週次更新）
├── 販売価格YYYYMMDD.csv                     # 元データ（週次更新）
├── 買取価格最適化_hybrid_YYYYMMDD.xlsx      # 最新の最適化ファイル
│
├── archive/                                 # 古いファイル保管
│
├── buyback-market/                          # 買取市場調査
└── resale-market/                           # 販売市場調査
```

---

## 🔧 基準値のカスタマイズ

### 粗利・利率基準の変更

[generate_optimizer_hybrid.py](generate_optimizer_hybrid.py) の25行目からの`CRITERIA`を編集:

```python
CRITERIA = [
    {"price_min": 0, "price_max": 20000, "profit": 4000, "rate_min": 22, "rate_max": None},
    {"price_min": 20000, "price_max": 30000, "profit": 5000, "rate_min": 18, "rate_max": 29},
    # ...
]
```

### 人気機種リストの変更

[generate_optimizer_hybrid.py](generate_optimizer_hybrid.py) の44行目からの`POPULAR_MODELS`を編集:

```python
POPULAR_MODELS = [
    'iPhone 16 Pro Max',
    'iPhone 16 Pro',
    'iPhone 16',
    'iPhone 15 Pro Max',
    'iPhone 15 Pro',
    'iPhone 15',
]
```

### 交渉段階の変更

[generate_optimizer_hybrid.py](generate_optimizer_hybrid.py) の62行目の`NEGOTIATION_STEPS`を編集:

```python
NEGOTIATION_STEPS = [0, 3, 6]  # 初回、1回目(-3%)、2回目(-6%)
```

---

## 📈 次のステップ

1. **実運用開始**: スタッフに運用マニュアルを共有
2. **効果測定**: 1週間後に成約率・粗利額・交渉回数を分析
3. **基準値調整**: 実績データを基に基準値を最適化
4. **データ分析**: 粗利分布・成約率の可視化
5. **人気機種リストの更新**: 月1回程度で見直し

---

## 📊 買取価格決定のデータ構造（kintone）

### 買取価格の計算式

```
最終買取価格 = 基準価格 × 不具合減額率 - 修理減額固有値
```

---

### 変数の階層構造

#### レベル1: 基準価格を決定する変数（3つ）

1. **機種**（例: iPhone 15 Pro）
2. **容量**（例: 256GB）
3. **ランク**（後述の15変数で決定）

→ これらの組み合わせで**基準価格**が決まる

---

#### レベル2: ランクを決定する変数（15個 = 3カテゴリ × 5段階）

**3つのカテゴリ**（各5段階）:
- **表面の状態**（5段階）
- **背面の状態**（5段階）
- **側面の状態**（5段階）

**各状態の5段階**:
1. まったく劣化がない
2. ちいさな傷などがある
3. 使用感がある
4. 目立つ傷などがある
5. 割れやゆがみがある

**ランク決定ロジック**: （別途定義、TODO: 後で共有）

---

#### レベル3: 減額を決定する変数（22個 = 15 + 7）

##### 不具合等（15項目）- 減額率で計算

それぞれに**減額率**が設定（基準価格に対して**掛け算**で減額）

**グループA: お客様が認識しやすい**（減額率を上げにくい）:
1. TouchIDやFaceIDの故障
2. サイドボタンの故障
3. 正常に起動しない
4. 初期化できない
5. ネットワーク利用制限

**グループB: お客様が認識しにくい**（減額余地あり）:
1. **バッテリーの劣化**（最大容量80%**未満**）← 最重要
   - 現在の減額率: ×0.7（30%減額）
   - 候補: ×0.6（40%減額）から様子見
2. 表示やタッチ操作の劣化
3. アウトカメラの故障（微細な曇り等）
4. バイブレーション不具合
5. 端末上部の不具合
6. 端末下部の不具合
7. Wi-FiやBluetoothの不具合
8. フラッシュの故障
9. 水没歴あり
10. その他

---

##### 修理（7項目）- 減額固有値で計算

それぞれに**減額固有値**が設定（機種ごとに異なる金額、基準価格から**引き算**で減額）

**グループA: お客様が認識しやすい**（減額率を上げにくい）:
1. 画面修理
2. アウトカメラガラス交換

**グループB: お客様が認識しにくい**（減額余地あり）:
1. ドック修理
2. インカメラ修理
3. アウトカメラ修理
4. タプティックエンジン修理
5. バッテリー交換

---

### kintone CSVの列構造

**基本情報**:
- `レコード番号`
- `機種` (例: iPhone 15)
- `色` (例: グリーン)
- `容量` (例: 128GB)

**ランク関連**:
- `仮査定上限ランク` (例: 中古S)
- `仮査定下限ランク` (例: 中古E)
- `ランク` (例: 美品、新品・未開封、使用感あり、外装ジャンク、目立つ傷あり)
- `BMコンディション` (バックマーケット用)

**修理（7項目）**:
- `修理[画面修理]`
- `修理[ドック修理]`
- `修理[インカメラ修理]`
- `修理[アウトカメラ修理]`
- `修理[タプティックエンジン修理]`
- `修理[バッテリー交換]`
- `修理[アウトカメラガラス交換]`

**不具合等（15項目）**:
- `不具合など[表示やタッチ操作の劣化]`
- `不具合など[バッテリーの劣化]`
- `不具合など[TouchIDやFaceIDの故障]`
- `不具合など[アウトカメラの故障]`
- `不具合など[バイブレーション不具合]`
- `不具合など[サイドボタンの故障]`
- `不具合など[端末上部の不具合]`
- `不具合など[端末下部の不具合]`
- `不具合など[Wi-FiやBluetoothの不具合]`
- `不具合など[フラッシュの故障]`
- `不具合など[正常に起動しない]`
- `不具合など[初期化できない]`
- `不具合など[ネットワーク利用制限]`
- `不具合など[水没歴あり]`
- `不具合など[その他]`

**価格・成約情報**:
- `最高提示価格`
- `最低提示価格`
- `進捗` (例: 来店買取成約、宅配買取成約)
- `作成日時`
- `買取日`
- `最終買取価格`
- `買取媒体` (例: 秋葉原店、公式サイト)
- `想定販売経路` (例: バックマーケット、業者、ムスビー、徐さん、グウェンさん)

**その他**:
- `備考`
- `パーツ取り[パーツ取り]`
- `想定販売価格`
- `粗利(手数料引)`
- `卸売価格`
- `特記事項`

---

### 重要なルール

1. **新品・未開封はiPhone 14シリーズ以降のみ**
   - iPhone 13以前で「新品・未開封」が来た場合は、お客様の勘違い
   - 買取価格調査ではiPhone 14以降のみ新品・未開封を考慮

2. **不具合・修理の記録方法**
   - チェックあり: `"1"`
   - チェックなし: 空欄

3. **エンコーディング**
   - kintoneからのエクスポート: Shift-JIS
   - 読み込み時: `encoding='shift-jis'`を指定

4. **想定販売経路の種類**
   - 使用中: バックマーケット、アマゾン、ムスビー、店頭、業者、徐さん、グウェンさん
   - 使用予定なし: ヤフーショッピング、ドラゴン、イオシス、その他

---

## 🎯 買取価格最適化の目的

### 目標
**買取価格の最適化** = 粗利最大化 + 成約数の維持

### アプローチ
1. **買取価格が高すぎる構成を発見**
   - 成約率が高い → 価格を下げても成約数が変わらない可能性
   - → 価格を下げて粗利を増やす

2. **買取価格が低すぎる構成を発見**
   - 成約率が低い → 価格を上げて成約数を増やす

3. **最適化の対象**
   - 機種・容量・ランク別の**基準価格**
   - 不具合・修理の**減額率/減額固有値**（特にグループBの認識しにくい項目）

### データソース
- きんとんから過去1年間の仮査定・成約データをエクスポート
- 仮査定数、成約数、成約率、平均価格を集計
- 機種・容量・ランク・不具合・修理の組み合わせごとに分析

---

最終更新: 2025-11-25 (火)
