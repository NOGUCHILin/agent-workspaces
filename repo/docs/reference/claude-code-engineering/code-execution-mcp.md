# Code Execution with MCP

出典: [Anthropic Engineering](https://www.anthropic.com/engineering/code-execution-with-mcp)

---

## 課題

従来アプローチ: 全ツール定義をコンテキストに読み込み → トークン消費増加

---

## 解決策

MCPサーバーをコードAPIとして提示するアーキテクチャ。

```
servers/
├── google-drive/
│   ├── getDocument.ts
│   └── index.ts
└── salesforce/
    └── updateRecord.ts
```

**効果**: 150,000トークン → 2,000トークン（98.7%削減）

---

## ベストプラクティス

| 項目 | 説明 |
|------|------|
| **段階的ツール開示** | ファイルシステム探索、必要なツール定義のみ取得 |
| **コンテキスト効率** | データフィルタリング・変換を実行環境で実施 |
| **プライバシー保護** | PIIをトークン化、中間結果をモデルコンテキストに入れない |
| **状態永続性** | スキル・進捗をファイルシステムに保存、再利用可能 |

---

## 注意点

実装には以下が必要:
- 安全な実行環境
- サンドボックス
- リソース制限
- 監視

インフラ要件とセキュリティコストを利益と比較検討すること。
